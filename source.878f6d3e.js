!function(e,t,n,r){var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i="function"==typeof a.parcelRequire&&a.parcelRequire,o="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function s(n,r){if(!t[n]){if(!e[n]){var a="function"==typeof parcelRequire&&parcelRequire;if(!r&&a)return a(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}u.resolve=function(t){return e[n][1][t]||t},u.cache={};var l=t[n]=new s.Module(n);e[n][0].call(l.exports,u,l,l.exports,this)}return t[n].exports;function u(e){return s(u.resolve(e))}}s.isParcelRequire=!0,s.Module=function(e){this.id=e,this.bundle=s,this.exports={}},s.modules=e,s.cache=t,s.parent=i,s.register=function(t,n){e[t]=[function(e,t){t.exports=n},{}]},a.parcelRequire=s;for(var c=0;c<n.length;c++)s(n[c]);if(n.length){var l=s(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd&&define((function(){return l}))}}({abaa9ffbe3b7a8f82068e90ca2e8cce3:[function(e,t,n){e("./bundle-manifest").register(JSON.parse('{"4fbf1b244680f9c1":"source.878f6d3e.js","b72594e6465bde23":"manifest.dc27a8ff.webmanifest","5f716d0343311b2c":"predictor.427976eb.js","79de41c3db5d61cf":"share-menu.8456a496.js","2ba7824af5e268d5":"update.2b6259fb.js","5a6d2c92c35daabd":"service-worker.js"}'))},{"./bundle-manifest":"ebd9b292ac579e440f9aa79a03d1d067"}],ebd9b292ac579e440f9aa79a03d1d067:[function(e,t,n){"use strict";var r={};t.exports.register=function(e){for(var t=Object.keys(e),n=0;n<t.length;n++)r[t[n]]=e[t[n]]},t.exports.resolve=function(e){var t=r[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}},{}],efca12737c12381f691dd183f44917ef:[function(e,t,n){"use strict";var r=e("./install.js"),a=e("./store"),i=e("./audio/speech"),o=e("./record"),s=e("./audio/audio"),c=e("./audio/synthesizers"),l=e("./audio/midi-out"),u=e("./timing/timing.js"),d=e("./ui"),h=e("./visual/canvas"),f=e("./visual/2d"),p=e("./visual/spectrograms"),m=e("./visual/quantise"),g=e("./location-handler"),b=e("./camera"),y=e("./timing/patterns"),v=e("./models/instructions"),w=e("./reporting"),E=e("./version"),I=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var i=r?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}n.default=e,t&&t.set(e,n);return n}(e("./person")),S=e("./maths");function _(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _=function(){return e},e}const C=document.documentElement,T=document.querySelector("main"),M=document.querySelector("img"),{isRecording:A,startRecording:x,stopRecording:N}=(0,o.record)(),k=(0,a.createStore)(),O=[];let D,P,R,L,B,j,F,V,q,G,$=d.video,U=!0,H=!0,z=!1,Y=!1,W=!1,Q=!1,K=!1,X=!1,J=!1,Z=0;const ee={x:1,y:1};C.classList.toggle("loading",!0);const te=(0,g.getReferer)()||"interface.place",ne=(0,g.getLocationSettings)({metronome:!1,backingTrack:!1,clear:!0,transparent:!0,synch:!0,debug:!1,muted:!1,duet:!1,quantise:!0,text:!0,spectrogram:!0,speak:!0,midiChannel:"all",bpm:120}),re={maxFaces:ne.duet?2:1,shouldLoadIrisModel:!0};if(!ne.debug&&"localhost"!==location.hostname&&"https:"!==location.protocol)return H=!1,W=!0,(0,d.setToast)("Redirecting to a secure site, please stand by!"),void setTimeout(()=>location.replace("https:"+location.href.substring(location.protocol.length)),50);const ae=e=>{ne.speak&&(0,i.hasSpeech)()&&(0,i.say)(e,!0)},ie=e=>{const t=(0,s.setVolume)(e);return k.setItem("audio",{volume:t}),(0,d.setToast)(`Volume ${Math.ceil(100*t)}%`,0),t},oe=e=>(e=>{(0,u.setTimeBetween)(e);const t=(0,u.getBPM)();return(0,d.setToast)(`Tempo : Period set at ${e} milliseconds between bars<br>or ${t}BPM`),console.log({bpm:t,timer:j,tempo:e}),k.setItem("tempo",{period:e,bpm:t}),e})(6e4/e),se=async(e,t)=>O.map(async n=>{const r=await n[e](t);return(0,d.setToast)(`${n.name} has ${n.instrumentTitle} loaded`),console.log(`${n.name} has ${r} loaded`),r}),ce=async e=>await se("loadRandomInstrument",e),le=e=>{ne.duet;const t=I.EYE_COLOURS[e];if(null==O[e]){const n={dots:t,leftEyeIris:t,rightEyeIris:t,hue:360*Math.random(),debug:ne.debug,photoSensitive:window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches||!1},r=I.NAMES[e],a=k.has(r)?k.getItem(r):{},i=new I.default(r,s.audioContext,R,n),o=a.instrument||(0,s.randomInstrument)();return i.button.addEventListener("instrumentchange",e=>{const{detail:t}=e;k.setItem(r,{instrument:t.instrumentName});(0,d.setToast)(t.instrumentName+" Loaded")}),i.loadInstrument(o,e=>{}),O.push(i),i}return O[e]},ue=e=>{const t=e.length;if(t>0){let n=e.map(e=>e.name||"MIDI Instrument").join("<br>");t,T.classList.toggle("midi-no-devices",!1),T.classList.toggle("midi-connected",!0),T.classList.toggle("midi-devices-"+t,!0),T.classList.remove("midi-unavailable"),O.forEach((t,n)=>((e=0,t=[],n=0)=>{const r=le(e),a=t[e<t.length?e:0];a?r.setMIDI(a,n):console.error("No matching MIDI Instrument",ne.midiChannel,r.hasMIDI?"Enabling":"Disabling",`MIDI #${n} for ${r.name}`,{ui:ne,port:a,portIndex:n},L.outputs[n])})(n,e,ne.midiChannel)),n="MIDI Available<br>"+n,(0,d.setToast)(n),B.setText("<span class='hide-text'>Click to </span>Disable"),B.setLabel(n)}else(0,d.setFeedback)(Q?"Lost MIDI Device connection":"MIDI Available but no instruments detected",0),(0,d.setToast)("No MIDI Devices connected"),T.classList.toggle("midi-no-devices",!0),T.classList.toggle("midi-connected",!1)},de=async()=>(B=(0,d.setupMIDIButton)(async e=>(await(async()=>{try{L=await(0,l.setupMIDI)(),L.addListener("connected",e=>{console.log("Midi device connected!"),ue(L.outputs)}),L.addListener("disconnected",e=>ue(L.outputs)),ue(L.outputs),Q=L,T.classList.add("midi-available")}catch(e){return console.error("Total MIDI failure",e),(0,d.setFeedback)("MIDI NOT Available<br>"+e,0),T.classList.add("midi-unavailable"),!1}return!0})(),(0,d.setFeedback)("MIDI available<br>Connecting to instruments...",0),T.classList.add("midi-activated"),!1)),!0),he=async(e,t="Default")=>{let n;K=!0;try{n=await(0,b.setupCamera)(d.video,e),e&&e.length>0&&k.setItem("camera",{deviceId:e}),(0,w.track)("Action",{category:"Camera",label:t,value:e})}catch(n){throw console.error(e,"Camera errored",n),(0,w.trackError)(t+" camera could not be accessed",e,"Camera"),n}return K=!1,n},fe=()=>{let e="";window.addEventListener("keydown",async t=>{const n=!isNaN(parseInt(t.key));switch(t.key){case"CapsLock":ne.debug=!ne.debug,O.forEach(e=>e.debug=ne.debug),(0,d.setToast)("DEBUG : "+ne.debug),ae(ne.debug?"secret mode unlocked":"disabling developer mode");break;case"Space":ae(document.getElementById("toast").innerText),ce();break;case"ArrowLeft":(async e=>{await se("loadPreviousInstrument",e)})();break;case"ArrowRight":(async e=>{await se("loadNextInstrument",e)})();break;case"ArrowUp":let e=(0,u.getBars)()+1,t=(0,u.setBars)(e),r=(0,u.setTimeBetween)((0,u.timePerBar)());console.error("bars---",t,e,r),(0,d.setToast)(`Bars : ${t} / BPM : ${(0,u.getBPM)()}`);break;case"ArrowDown":let a=(0,u.getBars)()-1,i=(0,u.setBars)(a),o=(0,u.setTimeBetween)((0,u.timePerBar)());console.error("bars---",i,a,o),(0,d.setToast)(`Bars ${i} / BPM : ${(0,u.getBPM)()}`);break;case",":(0,f.setNodeCount)(-1);break;case".":(0,f.setNodeCount)(1);break;case"a":V.kick();break;case"b":ne.backingTrack=!ne.backingTrack,(0,d.setToast)(ne.backingTrack?"Backing track starting":"Ending Backing Track");break;case"c":ne.clear=!ne.clear;break;case"d":V.hat();break;case"e":V.clack();break;case"f":(0,d.toggleVisibility)(document.getElementById("shared-controls"));break;case"g":const s=(0,d.toggleVisibility)(document.getElementById("feedback"));(0,d.toggleVisibility)(document.getElementById("toast")),ne.text=s;break;case"h":(0,d.toggleVisibility)(h.canvas);break;case"j":(0,d.toggleVisibility)(d.video);break;case"k":break;case"m":ne.metronome=!ne.metronome,(0,d.setToast)(ne.metronome?"Quantised enabled":"Quantise disabled");break;case"q":ie(z?1:0),z=!z;break;case"r":A()?(console.error("Recording END",G),(0,d.setToast)("Recording Ended - now encoding"),N().then(e=>{const t=encodeRecording(e,"audio/mp3;"),n=window.URL.createObjectURL(t);console.error("Recording END",{recording:e,audioSrc:n,mp3:t})})):((0,d.setToast)("Recording START"),console.error("Recording START",R),G=await x(R),console.error("Recording...",G));break;case"s":V.snare();break;case"t":ne.text=!ne.text;break;case"v":(0,d.toggleVisibility)(d.video);break;case"w":V.cowbell();break;case"x":const c=(0,u.tapTempo)();c>1&&oe(c);break;case"?":ne.speak=!ne.speak,(0,d.setToast)(ne.speak?"Reading out instructions":"Staying quiet");break;case"Tab":break;default:n||(ce(),ae("Loading random instruments"))}if(n){if(e+=t.key,3===e.length){const t=parseFloat(e);console.log("Setting tempo to ",t),oe(t),e=""}}else e="";(0,g.addToHistory)(ne,t.key),console.log("key",ne,t)})},pe=(e,t,n=!0)=>{ne[e]=t,n&&(0,g.addToHistory)(ne,e),T.classList.toggle("flag-"+e,t)};(0,d.setFeedback)("Initialising...<br> Please wait"),F=(0,w.setupReporting)("InterFACE"),C.classList.toggle("debug",ne.debug);let me=null,ge=!1;const be=async()=>{if(!ge){ge=!0;try{await e("share-menu")}catch(e){C.classList.add("sharing-disabled")}if(me)try{const e=document.getElementById("shared-controls"),t=await me(e);U=t}catch(e){C.classList.add("installation-unavailable"),console.error("Install/Update issue",e)}else console.log("Loaded Webpage",E.VERSION)}},ye=async()=>{H?requestAnimationFrame(ye):W?(C.classList.add("failure"),(0,d.showReloadButton)()):(async()=>{const e=()=>{J?(ae("Hello! Open your mouth to begin!"),C.classList.toggle("searching-for-user",!1)):requestAnimationFrame(e)};C.classList.toggle("loading",!1),C.classList.toggle("loaded",!0),C.classList.toggle("searching-for-user",!0),e(),fe(),(0,d.setToast)(U?"You can install this as an app...<br>Click install when prompted!":""),ne.debug&&console.log(`Loaded App Version ${E.VERSION} from ${te}`)})()},ve=Object.assign({},re,{});(async(t,n)=>{let r=0;n(r++/3);const{loadModel:a}=await e("./models/predictor");return n(r++/3),(0,d.setupInterface)(ne),n(r++/3),(0,d.setToggle)("button-quantise",e=>{pe("quantise",e),(0,d.setToast)("Quantise "+(ne.quantise?"enabled":"disabled"))},ne.quantise),(0,d.setToggle)("button-metronome",e=>{pe("metronome",e),(0,d.setToast)("Metronome "+(ne.metronome?"enabled":"disabled"))},ne.metronome),(0,d.setToggle)("button-spectrogram",e=>{pe("spectrogram",e),(0,d.setToast)("Spectrogram "+(ne.spectrogram?"enabled":"disabled"))},ne.spectrogram),(0,d.setToggle)("button-transparent",e=>{pe("transparent",e),(0,d.setToast)("Video Synch "+(ne.spectrogram?"enabled":"disabled"))},ne.transparent),(0,d.setToggle)("button-clear",e=>{pe("clear",e)},ne.clear),(0,d.setToggle)("button-overlay",e=>(0,d.toggleVideoVisiblity)(),!(0,d.isVideoVisible)()),(0,d.setButton)("button-photograph",e=>{const t=Math.ceil(1e7*(0,u.now)()),n="photograph-"+t,r=(0,h.getCanvasDimensions)(),a=new Image;a.src=(0,f.takePhotograph)(),a.alt="Photograph taken "+Date.now().toString(),a.width=r.width,a.height=r.height;const i=document.createElement("a");i.href=a.src,i.innerHTML="Click to download this photograph",i.id=n,i.download=`snapshot-${t}.png`,i.appendChild(a),document.getElementById("photographs").appendChild(i),requestAnimationFrame(()=>document.getElementById(n).scrollIntoView())}),(0,d.setButton)("button-video",e=>ce()),(0,d.connectTempoControls)(e=>oe(e)),Object.entries(ne).forEach(([e,t])=>{T.classList.toggle("flag-"+e,t)}),n(r++/3),a($,t)})(ve,(e,t)=>{(0,d.setLoadProgress)(e,t)}).then(async e=>{(0,d.setFeedback)(""),(0,d.setToast)("");let t=setTimeout(()=>{(0,d.setToast)("Please select how many players you want to play"),t=setTimeout(()=>(0,d.setToast)("by clicking either button"),15e3)},6e4);C.classList.toggle("loading",!1),requestAnimationFrame(be);try{ne.duet=await(0,d.showPlayerSelector)(ve)}catch(e){console.error("player selection failed",e)}return(0,d.setFeedback)("Please wait loading! This can take <strong>some</strong> time..."),clearInterval(t),C.classList.toggle("loading",!0),(0,d.setToast)(""),(async(e,t,n)=>{let r=0;T.classList.add(te.split(".").pop());try{if((0,d.setFeedback)("Setting things up...<br>This can take a while!"),n(r++/7,"Setting things up..."),M&&((0,d.setFeedback)("Image downloaded...<br> Please wait"),P=await(0,f.setupImage)(M)),n(r++/7,"Looking for cameras"),d.video){const e=k.has("camera")?k.getItem("camera").deviceId:void 0;(0,d.setFeedback)(e?"Found saved camera":"Attempting to locate a camera...<br>Please click accept if you are prompted");const t=(0,b.filterVideoCameras)(await(0,b.detectCameras)());try{D=await he(e,"Saved"),(0,d.setFeedback)("Camera Found")}catch(e){t.length>1?((0,d.setFeedback)("Could not open saved camera, but found others..."),D=await he()):((0,d.setFeedback)("Could not open saved camera, looking for another..."),D=await he(),D||(0,d.setFeedback)("Could not find any camera :(")),k.removeItem("cameraId")}t.length>1&&((0,d.setupCameraForm)(t,async e=>{D=he(e.deviceId,e.label),(0,d.setToast)(`Camera ${e.label} changed`,0)}),T.classList.toggle("multiple-cameras",!0)),(0,d.setFeedback)("Camera connected",0),n(r++/7,"Camera connected")}T.style.setProperty("--width",d.video.width),T.style.setProperty("--height",d.video.height),T.classList.toggle("landscape",d.video.width>d.video.height),T.classList.toggle("portrait",d.video.width<d.video.height),T.classList.toggle("square",d.video.width===d.video.height),(0,h.updateCanvasSize)(d.video.width,d.video.height),n(r++/7)}catch(e){const t=String(e).replace("NotAllowedError: ","");return(0,d.setFeedback)(`Camera could not be accessed<br><strong>${t}</strong>`,0),(0,d.setToast)(t),H=!1,W=!0,void(0,w.trackError)("Camera Rejected or Not allowed")}try{const e=k.getItem("audio"),t=e?e.volume:1;R=(0,s.setupAudio)(),ie(t),n(r++/7),V=(0,c.createDrumkit)(),q=(0,y.kitSequence)(),(0,d.setFeedback)("Audio available...<br>Instrument Sounds ready"),n(r++/7)}catch(e){return W=!0,void(0,d.setFeedback)("Something went wrong with the Audio<br>"+e,0)}if((0,l.testForMIDI)()){try{await de()?T.classList.add("midi"):(T.classList.add("midi","no-instrument"),(0,d.setFeedback)("MIDI available<br>Connect a MIDI instrument <strong>and click the button</strong>",0))}catch(e){console.log("no MIDI!",e),T.classList.add("no-midi"),T.classList.add("midi-unavailable"),(0,d.setFeedback)("MIDI unavailable, or no instrument connected<br>"+e,0)}n(r++/7,"MIDI Located")}else n(r++/7),T.classList.add("midi-unavailable"),(0,d.setFeedback)("MIDI is not available in this browser,<br>It'll work better in Brave, Edge or Chrome",0);h.canvas.width=$.width,h.canvas.height=$.height,T.classList.add($.nodeName.toLowerCase()),(0,d.addToolTips)();const a=k.getItem("audio")?parseFloat(k.getItem("audio").volume):1;(0,s.setVolume)(a>0?a:1),n(r++/7);e($===d.video,e=>{if(Z++,H&&(H=!1),K)return;let t="";if(ne.clear)(0,h.clear)(),ne.transparent||(0,p.drawElement)($);else{const e=.01*Z%S.TAU;(0,h.overdraw)(-7*ee.x+Math.sin(e),-4*ee.y+Math.cos(e))}ne.spectrogram&&((0,s.updateByteFrequencyData)(),(0,p.drawBars)(s.dataArray,s.bufferLength));let n=!1;if(e){for(let r=0,a=e.length;r<a;++r){const a=e[r],i=le(r);if(!(a&&a.faceInViewConfidence>.9))return void(X||(T.classList.toggle(i.name+"-active",!1),T.classList.toggle("no-faces",!0),X=!0));if(X&&(X=!1,T.classList.toggle(i.name+"-active",!0),T.classList.toggle("no-faces",!1)),J=!0,n=!0,i.update(a),i.draw(a,ne.text),!ne.quantise&&!ne.muted){const e=i.sing();0===r&&(ee.x=e.eyeDirection,ee.y=e.pitch)}t+=`<br>PITCH:${a.pitch} ROLL:${a.roll} YAW:${a.yaw} MOUTH:${Math.ceil(100*a.mouthRange/I.DEFAULT_OPTIONS.LIPS_RANGE)}%`}n||(0,d.setFeedback)((0,v.getHelp)(Math.floor(Z/100)))}ne.quantise&&(0,m.drawQuantise)(Y,(0,u.getBar)(),(0,u.getBars)()),e?(0,d.setFeedback)((0,v.getInstruction)(Math.floor(Z/100))):(0,d.setFeedback)((0,v.getHelp)(Math.floor(Z/100))),Y&&(Y=!1)},()=>!K),j=(0,u.startTimer)(e=>{const{bar:t,bars:n,barsElapsed:r,timePassed:a,elapsed:i,expected:o,drift:c,level:l,intervals:u,lag:d}=e;if(!ne.muted){if(ne.metronome&&n){const e=.1;V.clack(e,n%4==0?.2:.1)}if(ne.quantise)for(let e=0,t=O.length;e<t;++e){const t=le(e).sing();0===e&&(ee.x=t.eyeDirection,ee.y=t.pitch)}if(ne.backingTrack&&t%2==0){(0,y.playNextPart)(q.kick,V.kick),(0,y.playNextPart)(q.snare,V.snare),(0,y.playNextPart)(q.hat,V.hat)}s.playing,Y=!0}},(0,u.timePerBar)())})(e,0,e=>{(0,d.setLoadProgress)(e)})}).then(e=>{(0,d.focusApp)()}).catch(e=>{(0,d.showError)(e,"Try hard refresh")}),(async()=>{try{me=await(0,r.installer)(!0);const{updateApp:t}=await e("./update.js"),{updater:n,updateAvailable:a}=await t();a&&((0,d.showUpdateButton)(document.getElementById("shared-controls"),n),(0,d.setToast)("An Update is available! Press update to install it"))}catch(e){console.error("PWA",e)}})(),ye(),window.onbeforeunload=()=>{(0,w.trackExit)(),(0,d.setToast)("bye bye!"),(0,d.setFeedback)("<strong>I hope you had fun!</strong>")},window.oncontextmenu=()=>{Z=0},window.addEventListener("popstate",e=>{})},{"./install.js":"c39d5b66b9168e68d7d95cbc570a6151","./store":"fb7b1c034fb63ed5d2a05ca7ac05c9c5","./audio/speech":"70eeccac3415262901f793501c0ab0ff","./record":"50659b8cfc25a32b08a2889c62d90b7f","./audio/audio":"96a3cf8e6eb7e0adf88768f97d328ae3","./audio/synthesizers":"20894d5885a697c12dfcbfca18b9fc7f","./audio/midi-out":"247ea146e45795daa49232bf1b7e1a74","./timing/timing.js":"af0b8472eefa4fe4e4000c4e9ae1bf1f","./ui":"225163ea33f2498ca7c169419e0a05ce","./visual/canvas":"5f3eb9e0efedd749e3ce8ece8e7af807","./visual/2d":"3f5dc1d45338b40d52343cf73ba2ceeb","./visual/spectrograms":"7c55e8edc49408ae4872370083d15079","./visual/quantise":"1c37ee1d40cab4f3081b573c35abb3a6","./location-handler":"3910cae853fcfe5e1eabe9e3adca6ecc","./camera":"304d4d4cb53eafff77715335feb81f75","./timing/patterns":"2846ae3be1a1a3fe3b66fd048499d96d","./models/instructions":"34612b22081aa381d2044c8f4b67a06c","./reporting":"8f1ee5619bd130ec46fad29dd6c1ad12","./version":"74bd8ba392f9c7813070227021da2766","./person":"031cb3b2740f0f1394fdd6d3e19f774d","./maths":"b35d1feb9582910dececcb2468237235","./models/predictor":"e7b6caadf340d1bc8ab94ffab80f749b","share-menu":"325e2e94a2166b9e05179c85ec56b2d9","./update.js":"f5f88b3c462ea3f5a47e0c1589bd10d2"}],c39d5b66b9168e68d7d95cbc570a6151:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.installer=n.isSupportingBrowser=void 0;var r,a=e("./ui"),i=e("./version"),o=(r=e("url:./manifest.webmanifest"))&&r.__esModule?r:{default:r};const s=document.documentElement,c=window.hasOwnProperty("BeforeInstallPromptEvent");let l;n.isSupportingBrowser=c;let u=!1,d=!1,h=!1;n.installer=async(e=!1)=>{let t,n=[];const r=navigator.userAgent.includes("iPhone")||navigator.userAgent.includes("iPad")||navigator.userAgent.includes("Macintosh")&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2,f=()=>new Promise((e,t)=>{h=!1,e()});document.addEventListener("keyup",e=>{"Escape"===e.key&&f()});const p=async()=>{try{const n=await fetch(o.default),r=await n.json();if(t=r,r)return(e=r).icons&&e.icons[0]?e.name?e.description||console.error("Your web manifest must have a description listed"):console.error("Your web manifest must have a name listed"):console.error("Your web manifest must have atleast one icon listed"),r}catch(e){return console.error("Manifest could not be loaded",e),null}var e},m=async e=>{const h=c&&n.length<1&&(d||r);if(d&&"standalone"in navigator&&!1===navigator.standalone||h&&!1===u){await(async()=>{if(o.default)try{await p()}catch(e){console.error("Error getting manifest, check that you have a valid web manifest")}"getInstalledRelatedApps"in navigator&&(n=await navigator.getInstalledRelatedApps())})();s.classList.add((navigator.standalone?navigator.standalone:matchMedia("(display-mode: standalone)").matches)?"installed":"not-installed");const r=document.createElement("button");return r.classList.add("install-app"),r.setAttribute("aria-label",`Click to install ${t.short_name} V-${i.VERSION.replaceAll(".","-")}<br>Date:${a.formattedDate}`),r.style.setProperty("--logo",`url(${t.icons[0].src})`),r.innerHTML="Install",(0,a.addTooltip)(r),r.addEventListener("click",async()=>{(0,a.setFeedback)("Installing",0);try{const e=await(async()=>new Promise(async(e,t)=>{if(l){l.prompt(),await f();"accepted"===(await l.userChoice).outcome?(console.log("Your PWA has been installed"),u=!0,e(!0)):(console.log("User chose to not install"),u=!1,e(!1))}else t("no prompt cached")}))();(0,a.setToast)(e?"The App was installed":"Maybe some other time"),e?document.querySelector(".install-app").style.display="none":r.classList.add("later")}catch(e){(0,a.setToast)("The App was not installed")}}),(e=e||s).appendChild(r),!0}return s.classList.add(u?"installed":"not-installed"),!1};return l||d||window.addEventListener("beforeinstallprompt",t=>{l=t,d=!0,t.preventDefault(),e||r||m()},{once:!0}),!e&&r&&window.addEventListener("load",async e=>{m()},{once:!0}),m},window.addEventListener("beforeinstallprompt",e=>{l=e,d=!0,e.preventDefault()},{once:!0})},{"./ui":"225163ea33f2498ca7c169419e0a05ce","./version":"74bd8ba392f9c7813070227021da2766","url:./manifest.webmanifest":"6f0d5c559bbc120613d5d4db008c4ea6"}],"225163ea33f2498ca7c169419e0a05ce":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.showError=n.focusApp=n.setupInterface=n.showPlayerSelector=n.addToolTips=n.showUpdateButton=n.connectTempoControls=n.updateTempo=n.showReloadButton=n.setToggle=n.setButton=n.addTooltip=n.setupMIDIButton=n.setupInstrumentForm=n.setupCameraForm=n.setControls=n.setToast=n.setFeedback=n.toggleVideoVisiblity=n.isVideoVisible=n.video=n.toggleVisibility=n.bindTextElement=n.controls=n.buttonVideo=n.buttonMIDI=n.buttonQuantise=n.getLoadProgress=n.setLoadProgress=n.formattedDate=void 0;var r,a=e("./audio/instruments"),i=e("./version"),o=e("./utils"),s=e("./full-screen"),c=e("./location-handler");(r=e("./palette"))&&r.__esModule;const l=new Date(i.DATE),u=`${l.getDate()}/${l.getMonth()+1}/${l.getFullYear()} ${l.toLocaleTimeString("en-GB",{hour12:!0,hour:"numeric",minute:"numeric"})}`;n.formattedDate=u;const d=document;let h=0;const f=["Please wait","Loading.","Loading..","Loading...","Almost done!"],p=d.getElementById("progress-bar"),m=d.querySelector("progress");n.setLoadProgress=(e,t)=>{h=e,m.setAttribute("value",parseInt(e)),t&&t.length||(t=f[Math.ceil(e*(f.length-1))]),console.log("load",{progress:e,message:t},Math.ceil(e*f.length),f),p.innerHTML!==t&&(p.innerHTML=t)};let g,b,y,v,w,E;n.getLoadProgress=()=>h,n.buttonQuantise=y,n.buttonMIDI=v,n.buttonVideo=w,n.controls=E;const I=d.querySelector("main"),S=(e,t=700,n=0,r=!1)=>{let a=null,i=-1,s=-1,c=null;const l=(0,o.debounce)(t=>{e.innerHTML=t},t);return e?(o,u=t)=>{r&&(o=o.split(/!|\./i).join("<br>")),c=o,""!==e.innerHTML&&a==o||(clearTimeout(s),a=o,0===u?(clearTimeout(i),e.innerHTML=o):i=l(o),n>0&&(s=(t=>{const r=n*t;return s=setTimeout(()=>{e.innerHTML=""},r),r})(o.length)))}:null};n.bindTextElement=S;n.toggleVisibility=e=>{const t="hidden"!==e.style.visibility;return e.style.visibility=t?"hidden":"visible",!t};const _=d.querySelector("video");n.video=_;const C=()=>"hidden"===_.style.visibility;n.isVideoVisible=C;n.toggleVideoVisiblity=e=>{const t=C();console.error("toggling video vis",{value:e,currentlyVisible:t}),_.style.visibility=t?"visible":"hidden"};const T=S(d.getElementById("feedback"),20);n.setFeedback=T;const M=S(d.getElementById("toast"),20,900,!0);n.setToast=M;n.setControls=e=>{d.getElementById("person-a-controls").appendChild(e)};n.setupCameraForm=(e,t)=>{const n=d.getElementById("camera").querySelector("select"),r=e.map((e,t)=>`<option value="${e.deviceId}">${e.label}</option>`);n.innerHTML=`<optgroup label="Detected Cameras">${r.join("")}</optgroup>`,n.addEventListener("change",r=>{const a=n.options.selectedIndex;t(e[a])})};n.setupInstrumentForm=e=>{const t=a.INSTRUMENT_FOLDERS.map((e,t)=>`<label for="${e}">${a.INSTRUMENT_NAMES[t]}<input id="${e}" name="instrument-selector" type="radio" value="${e}"></input></label>`);return t.unshift("<legend>Select an instrument</legend>"),""+t.join("")};n.setupMIDIButton=e=>{let t=!1;return v.addEventListener("mousedown",async n=>(n.preventDefault(),e&&e(),t=!0,!1),{once:!0}),{setText:e=>v.innerHTML=e,setLabel:e=>v.setAttribute("aria-label",e)}};const A=e=>e.addEventListener("mouseover",e=>{const t=e.target.getAttribute("aria-label")||e.target.innerHTML;M(t)});n.addTooltip=A;const x=(e,t)=>{const n=d.getElementById(e);return n.addEventListener("click",e=>{t&&t({element:n})}),n};n.setButton=x;const N=(e,t,n)=>{const r=x(e,()=>{n=!n,"LABEL"===r.parentNode.nodeName&&r.parentNode.classList.toggle("checked",n),t(n)});return n&&(r.setAttribute("checked",n),r.parentNode.classList.toggle("checked",n)),r};n.setToggle=N;n.showReloadButton=()=>{};const k=e=>{const t=d.getElementById("input-tempo");t&&t.setAttribute("value",e),console.log("Setting tempo",e)};n.updateTempo=k;const O=e=>{const t=d.getElementById("select-tempo");t.addEventListener("change",n=>{const r=t.options.selectedIndex,a=t.childNodes[r],i=parseInt(a.innerHTML);k(i),e&&e(i)})};n.connectTempoControls=O;n.showUpdateButton=(e,t)=>{const n=d.createElement("button");n.id="button-update",n.setAttribute("aria-label","Update to new version"),n.classList.add("update-available"),n.innerHTML="Update",n.addEventListener("click",()=>t()),e.appendChild(n)};n.addToolTips=(e="button, select, input")=>{E.querySelectorAll(e).forEach(e=>A(e))};n.showPlayerSelector=e=>new Promise((t,n)=>{const r=d.getElementById("onboard"),a=d.getElementById("player-selector"),i=a.querySelector("#button-solo"),o=a.querySelector("#button-duet"),s=a.querySelector("#button-trio"),c=(d.getElementById("button-start"),a.querySelector("#toggle-advanced-mode"));let l=!1,u=e.duet?2:1;c.setAttribute("checked",!l),d.documentElement.classList.toggle("player-selection",!0);const h=e=>{u=e,d.documentElement.classList.remove("solo","duet"),d.documentElement.classList.add(1===u?"solo":"duet")};i.addEventListener("click",e=>h(1)),o.addEventListener("click",e=>h(2)),s.addEventListener("click",e=>h(3)),c.addEventListener("change",e=>{l=!l,I.classList.toggle("beginner",!l)}),r.addEventListener("submit",e=>{var n;return e.preventDefault(),(n=u)<2?(i.classList.toggle("hide",!0),o.classList.toggle("hide",!1),I.classList.add("solo")):(o.classList.toggle("hide",!0),i.classList.toggle("hide",!1),I.classList.add("duet")),a.classList.add("completed"),d.documentElement.classList.toggle("player-selection",!0),setTimeout(()=>{d.documentElement.classList.toggle("advanced",l),d.documentElement.classList.toggle("player-selection",!1),a.classList.remove("completed")},45),t(n>1),!1},!0),I.classList.toggle("beginner",!l),h(u),a.focus()});n.setupInterface=e=>{d.querySelector("h1");const t=d.getElementById("share"),r=(d.getElementById("button-solo"),d.getElementById("button-duet"),d.getElementById("title"),d.querySelector("share-menu"));if(r.url=(0,c.getShareLink)(e),t.addEventListener("mousedown",t=>{r.setAttribute("url",(0,c.getShareLink)(e)),console.error("SHARING",{shareElement:r,url:r.url})},!1),n.controls=E=d.getElementById("controls"),g=d.getElementById("button-instrument"),n.buttonVideo=w=d.getElementById("button-video"),b=d.getElementById("button-record"),n.buttonMIDI=v=d.getElementById("button-midi"),n.buttonQuantise=y=d.getElementById("button-quantise"),(0,s.canFullscreen)()){const t=N("button-fullscreen",n=>{e.fullscreen=(0,s.toggleFullScreen)(),t.classList.toggle("fs",e.fullscreen)},!1)}else d.getElementById("button-fullscreen").classList.toggle("hide",!0);const a=d.getElementById("version"),i=a.innerHTML;a.innerHTML=`${i} <span id="release">${u}</span>`,E.addEventListener("submit",e=>{e.preventDefault()},!0),O()};n.focusApp=()=>{};n.showError=(e,t)=>{console.error("Could not load",e),console.warn("Try",t)}},{"./audio/instruments":"e5a876cfe90709c6f27591258fb40c97","./version":"74bd8ba392f9c7813070227021da2766","./utils":"6081707114f99d899cb8278594114104","./full-screen":"db0f72025fc5a46092d59b2524b273df","./location-handler":"3910cae853fcfe5e1eabe9e3adca6ecc","./palette":"4c4f18d38f1111efa08d8ccdf0962cfd"}],e5a876cfe90709c6f27591258fb40c97:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.storeInstrument=n.fetchInstrument=n.instrumentCache=n.INSTRUMENT_NAMES=n.cleanTitle=n.INSTRUMENT_FOLDERS=n.MUSICAL_NOTES=void 0;n.MUSICAL_NOTES=["â™«","ð…ž","ð…Ÿ","ð… ","ð…¡","ð…¢","ð…£","ð…¤"];const r=["accordion-mp3","acoustic_bass-mp3","acoustic_grand_piano-mp3","acoustic_guitar_nylon-mp3","acoustic_guitar_steel-mp3","agogo-mp3","alto_sax-mp3","applause-mp3","bagpipe-mp3","banjo-mp3","baritone_sax-mp3","bassoon-mp3","bird_tweet-mp3","blown_bottle-mp3","brass_section-mp3","breath_noise-mp3","bright_acoustic_piano-mp3","celesta-mp3","cello-mp3","choir_aahs-mp3","church_organ-mp3","clarinet-mp3","clavinet-mp3","contrabass-mp3","distortion_guitar-mp3","drawbar_organ-mp3","dulcimer-mp3","electric_bass_finger-mp3","electric_bass_pick-mp3","electric_grand_piano-mp3","electric_guitar_clean-mp3","electric_guitar_jazz-mp3","electric_guitar_muted-mp3","electric_piano_1-mp3","electric_piano_2-mp3","english_horn-mp3","fiddle-mp3","flute-mp3","french_horn-mp3","fretless_bass-mp3","fx_1_rain-mp3","fx_2_soundtrack-mp3","fx_3_crystal-mp3","fx_4_atmosphere-mp3","fx_5_brightness-mp3","fx_6_goblins-mp3","fx_7_echoes-mp3","fx_8_scifi-mp3","glockenspiel-mp3","guitar_fret_noise-mp3","guitar_harmonics-mp3","gunshot-mp3","harmonica-mp3","harpsichord-mp3","helicopter-mp3","honkytonk_piano-mp3","kalimba-mp3","koto-mp3","lead_1_square-mp3","lead_2_sawtooth-mp3","lead_3_calliope-mp3","lead_4_chiff-mp3","lead_5_charang-mp3","lead_6_voice-mp3","lead_7_fifths-mp3","lead_8_bass__lead-mp3","marimba-mp3","melodic_tom-mp3","music_box-mp3","muted_trumpet-mp3","oboe-mp3","ocarina-mp3","orchestra_hit-mp3","orchestral_harp-mp3","overdriven_guitar-mp3","pad_1_new_age-mp3","pad_2_warm-mp3","pad_3_polysynth-mp3","pad_4_choir-mp3","pad_5_bowed-mp3","pad_6_metallic-mp3","pad_7_halo-mp3","pad_8_sweep-mp3","pan_flute-mp3","percussive_organ-mp3","piccolo-mp3","pizzicato_strings-mp3","recorder-mp3","reed_organ-mp3","reverse_cymbal-mp3","rock_organ-mp3","seashore-mp3","shakuhachi-mp3","shamisen-mp3","shanai-mp3","sitar-mp3","slap_bass_1-mp3","slap_bass_2-mp3","soprano_sax-mp3","steel_drums-mp3","string_ensemble_1-mp3","string_ensemble_2-mp3","synth_bass_1-mp3","synth_bass_2-mp3","synth_brass_1-mp3","synth_brass_2-mp3","synth_choir-mp3","synth_drum-mp3","synth_strings_1-mp3","synth_strings_2-mp3","taiko_drum-mp3","tango_accordion-mp3","telephone_ring-mp3","tenor_sax-mp3","timpani-mp3","tinkle_bell-mp3","tremolo_strings-mp3","trombone-mp3","trumpet-mp3","tuba-mp3","tubular_bells-mp3","vibraphone-mp3","viola-mp3","violin-mp3","voice_oohs-mp3","whistle-mp3","woodblock-mp3","xylophone-mp3"];n.INSTRUMENT_FOLDERS=r;const a=e=>e&&e.length>1?e.replaceAll("_"," ").replace("-mp3",""):"";n.cleanTitle=a;const i=r.map(e=>a(e));n.INSTRUMENT_NAMES=i;const o={};n.instrumentCache=o;n.fetchInstrument=e=>o[e];n.storeInstrument=(e,t)=>{o[e]=t}},{}],"74bd8ba392f9c7813070227021da2766":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DATE=n.VERSION=void 0;n.VERSION="0.46.0";n.DATE=1621027039171},{}],"6081707114f99d899cb8278594114104":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.debounce=void 0;n.debounce=(e,t)=>{let n;return(...r)=>(clearTimeout(n),n=setTimeout(()=>e(...r),t),n)}},{}],db0f72025fc5a46092d59b2524b273df:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.toggleFullScreen=n.goFullscreen=n.exitFullscreen=n.canFullscreen=void 0;const r=()=>document.fullscreenEnabled||document.mozFullScreenEnabled||document.documentElement.webkitRequestFullScreen;n.canFullscreen=r;const a=()=>{document.exitFullscreen()};n.exitFullscreen=a;const i=e=>{r()&&document.documentElement.requestFullscreen()};n.goFullscreen=i;n.toggleFullScreen=()=>document.fullscreenElement?(document.exitFullscreen&&a(),!1):(i(),!0)},{}],"3910cae853fcfe5e1eabe9e3adca6ecc":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getShareLink=n.addToHistory=n.toQuery=n.refresh=n.getReferer=n.loadSoloMode=n.loadDuetMode=n.getLocationSettings=n.parseType=void 0;const r=e=>{if("string"==typeof e){const t=e.toLowerCase();return"true"===t||"1"===t||"false"!==t&&"0"!==t&&e}return Array.isArray(e)?e.toString():data};n.parseType=e=>"string"==typeof e?isNaN(parseFloat(e))?"true"===e.toLowerCase()||"false"!==e&&(e.indexOf(",")>=0?convertIntegerArrayToBooleans(e.split(",")):e):parseFloat(e):Array.isArray(e)?e.toString():e;n.getLocationSettings=e=>{{const t=Object.assign({},e),n=new URLSearchParams(window.location.search);for(const[e,a]of n)t[e]=r(a);return t}};n.loadDuetMode=()=>{new URLSearchParams(window.location.search).duet=!0};n.loadSoloMode=()=>{new URLSearchParams(window.location.search).duet=!1};n.getReferer=()=>document.referrer;n.refresh=e=>{window.location.reload()};const a=e=>new URLSearchParams(e).toString();n.toQuery=a;n.addToHistory=(e,t="")=>{const n=new URL(window.location);for(let t in e){const r=e[t];n.searchParams.set(t,r)}window.history.pushState(e,t,n)};n.getShareLink=e=>window.location+a(e)},{}],"4c4f18d38f1111efa08d8ccdf0962cfd":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.DEFAULT_COLOURS=void 0;n.DEFAULT_COLOURS={dots:"red",mouth:"rgba(255,0,0,0.5)",mouthClosed:"rgba(255,0,0,0.2)",lipsUpperInner:"pink",lipsLowerInner:"pink",midwayBetweenEyes:"blue",leftEyeLower0:"red",rightEyeLower0:"red",leftEyeIris:"yellow",rightEyeIris:"yellow"};var r={white:"hsl(22, 28%, 87%)",dark:"hsl(30, 6%, 14%)",grey:"hsl(11, 6%, 50%)",cream:"hsl(27, 30%, 45%)",brown:"hsl(23, 22%, 30%)",blue:"hsl(196, 18%, 33%)",green:"hsl(56, 18%, 33%)",yellow:"hsl(56, 18%, 33%)",orange:"hsl(28, 69%, 38%)",red:"hsl(9, 58%, 35%)"};n.default=r},{}],"6f0d5c559bbc120613d5d4db008c4ea6":[function(e,t,n){t.exports=e("./bundle-url").getBundleURL()+e("./relative-path")("4fbf1b244680f9c1","b72594e6465bde23")},{"./bundle-url":"34a193fc56a5d6c91978a6a2a73f8a25","./relative-path":"6df9a76891b0a602dcb789af9c631254"}],"34a193fc56a5d6c91978a6a2a73f8a25":[function(e,t,n){"use strict";var r=null;function a(e){return(""+e).replace(/^((?:https?|file|ftp):\/\/.+)\/[^/]+$/,"$1")+"/"}n.getBundleURL=function(){return r||(r=function(){try{throw new Error}catch(t){var e=(""+t.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g);if(e)return a(e[0])}return"/"}()),r},n.getBaseURL=a,n.getOrigin=function(e){let t=(""+e).match(/(https?|file|ftp):\/\/[^/]+/);if(!t)throw new Error("Origin not found");return t[0]}},{}],"6df9a76891b0a602dcb789af9c631254":[function(e,t,n){"use strict";var r=e("./bundle-manifest").resolve;function a(e){if(""===e)return".";var t="/"===e[e.length-1]?e.slice(0,e.length-1):e,n=t.lastIndexOf("/");return-1===n?".":t.slice(0,n)}function i(e,t){if(e===t)return"";var n=e.split("/");"."===n[0]&&n.shift();var r,a,i=t.split("/");for("."===i[0]&&i.shift(),r=0;(r<i.length||r<n.length)&&null==a;r++)n[r]!==i[r]&&(a=r);var o=[];for(r=0;r<n.length-a;r++)o.push("..");return i.length>a&&o.push.apply(o,i.slice(a)),o.join("/")}t.exports=function(e,t){return i(a(r(e)),r(t))},t.exports._dirname=a,t.exports._relative=i},{"./bundle-manifest":"ebd9b292ac579e440f9aa79a03d1d067"}],fb7b1c034fb63ed5d2a05ca7ac05c9c5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.createStore=void 0;var r=e("./utils");n.createStore=(e="Plops")=>{const t=localStorage.getItem(e),n=Object.assign({},JSON.parse(t)),a=(0,r.debounce)(t=>{const n=JSON.stringify(t);localStorage.setItem(e,n)},20);return{save:a,has:e=>!!n[e],removeItem:e=>{delete n[e]},getItem:e=>n[e],setItem:(e,t)=>(n[e]=Object.assign({},n[e],t),a(n),n)}}},{"./utils":"6081707114f99d899cb8278594114104"}],"70eeccac3415262901f793501c0ab0ff":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isVoiceActive=n.stopSpeaking=n.say=n.hasSpeech=void 0;const r=()=>"speechSynthesis"in window;n.hasSpeech=r;const a=async()=>new Promise((e,t)=>{let n;const r=Date.now(),a=()=>{if(n=window.speechSynthesis.getVoices(),n.length>0)e(n);else{Date.now()-r<1e4?setTimeout(a,0):t("No voices found")}};a()});n.say=async(e,t=!0,n=1,i=1,o=1,s,c)=>new Promise((l,u)=>{if(r){(async()=>{try{const r=(s&&c?await(async(e="en-US",t="Zira")=>{const n=a(),r=n.filter(n=>n.lang===e&&n.name.indexOf(t)>-1);return r.length<1?n:r})(s,c):await a())[0],d=new SpeechSynthesisUtterance;d.lang="en-US",d.voice=r,d.voiceURI="native",d.onend=e=>{d.onend=null,l(e)},d.onerror=e=>{u()},d.volume=n,d.rate=i,d.pitch=o,d.text=e,t&&window.speechSynthesis.cancel(),window.speechSynthesis.speak(d)}catch(e){u(e)}})()}else u("Speech tech not available")});n.stopSpeaking=()=>window.speechSynthesis.cancel();n.isVoiceActive=()=>window.speechSynthesis.pending},{}],"50659b8cfc25a32b08a2889c62d90b7f":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ParamaterRecorder=n.record=void 0;n.record=e=>{let t,n=!1;return{isAvailable:()=>!!(window&&window.MediaRecorder&&"function"==typeof window.MediaRecorder.isTypeSupported&&window.Blob),downloadRecording:()=>{var e=new Blob(recordedChunks,{type:"video/webm"}),t=URL.createObjectURL(e),n=document.createElement("a");document.body.appendChild(n),n.style="display: none",n.href=t,n.download="test.webm",n.click(),window.URL.revokeObjectURL(t)},encodeRecording:(e,t="audio/mp3;")=>new Blob(e,{type:t}),startRecording:e=>new Promise((r,a)=>{if(n)return a("already recording");t=[],mediaRecorder=new MediaRecorder(e),mediaRecorder.ondataavailable=n=>{t.push(n.data),r({mediaRecorder:mediaRecorder,dataArray:t,stream:e})},mediaRecorder.onwarning=function(e){console.log("onwarning fired")},mediaRecorder.onerror=e=>{switch(console.log("onerror fired"),e.name){case"InvalidState":case"OutOfMemory":case"IllegalStreamModification":case"OtherRecordingError":case"GenericError":break;default:console.error("MediaRecorder Error",e)}},mediaRecorder.start(),n=!0}),stopRecording:()=>new Promise((e,r)=>{if(!n)return r("Not recording");mediaRecorder.onstop=r=>{n=!1,e(t)},mediaRecorder.stop()}),isRecording:()=>n}};n.ParamaterRecorder=class{constructor(e,t={}){this.isRecording=!1,this.context=e,this.parameters,this.startTime}get recording(){return this.parameters}reset(){this.parameters={}}save(e){let t=this.context.currentTime;this.isRecording||(this.startTime=t,this.isRecording=!0),this.parameters[this.startTime-t]=parameters}getValuesAtTime(e){return this.parameters[e]}}},{}],"96a3cf8e6eb7e0adf88768f97d328ae3":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.loadInstrument=n.loadInstrumentParts=n.getNoteName=n.getNoteText=n.getNoteSound=n.NOTE_NAMES=n.playTrack=n.setAmplitude=n.setVolume=n.getVolume=n.setFrequency=n.setShape=n.playAudio=n.stopAudio=n.updateByteTimeDomainData=n.updateByteFrequencyData=n.setupAudio=n.inputDryNode=n.inputNode=n.active=n.playing=n.dataArray=n.bufferLength=n.audioContext=n.randomInstrument=n.SOLFEGE_SCALE=void 0;var r=e("../maths"),a=e("./instruments");const i=["A","Ab","B","Bb","C","D","Db","E","Eb","F","G","Gb"],o=["Ab","Bb","Db","Eb","Gb"],s=["A","B","C","D","E","F","G"],c=o.length-1,l=s.length-1,u=["Doe","Ray","Me","Far","Sew","La","Tea"];n.SOLFEGE_SCALE=u;let d,h,f,p,m,g,b,y,v,w;n.randomInstrument=()=>a.INSTRUMENT_FOLDERS[Math.floor(Math.random()*a.INSTRUMENT_FOLDERS.length)],n.audioContext=d,n.bufferLength=h,n.dataArray=f;let E=0,I=!1;n.playing=I;let S=!1;n.active=S;n.inputNode=()=>m;n.inputDryNode=()=>p;n.setupAudio=(e=2048,t=1,r=1)=>(n.audioContext=d=new(window.AudioContext||window.webkitAudioContext),p=d.createGain(),p.gain.value=0,y=d.createDynamicsCompressor(),y.threshold.value=-70,y.knee.value=40,y.ratio.value=15,y.attack.value=.2,y.release.value=.5,v=d.createConvolver(),m=d.createDelay(.01),g=d.createGain(),g.gain.value=.2,b=d.createAnalyser(),b.minDecibels=-90,b.maxDecibels=-10,b.smoothingTimeConstant=.85,b.fftSize=256,n.bufferLength=h=b.frequencyBinCount,n.dataArray=f=new Uint8Array(h),m.connect(g),g.connect(m),m.connect(p),p.connect(y),y.connect(b),w=d.createScriptProcessor(e,t,r),b.connect(d.destination),m);n.updateByteFrequencyData=()=>b.getByteFrequencyData(f);n.updateByteTimeDomainData=()=>b.getByteTimeDomainData(f);const _=()=>{const e=requestAnimationFrame(_);return b.getByteFrequencyData(f),e};n.stopAudio=()=>!!I&&(n.playing=I=!1,!0);n.playAudio=()=>!I&&("suspended"===d.state&&d.resume(),n.playing=I=!0,_(),!0);n.setShape=e=>{(void 0).type=e};n.setFrequency=e=>{(void 0).frequency.value=e};n.getVolume=()=>E;n.setVolume=e=>(e=(0,r.clamp)(e,0,1),p.gain.value=e,e);const C=e=>{const t=p.gain.value+.1*(e-p.gain.value);return p.gain.setValueAtTime(e,d.currentTime),p.gain.value===e||requestAnimationFrame(C),t};n.setAmplitude=e=>{E=e,C()};n.playTrack=(e,t=0,r=m,a={loop:!1})=>new Promise((i,o)=>{const s=d.createBufferSource();s.buffer=e,s.loop=a.loop,s.connect(r),s.onended=()=>{s.disconnect(),n.active=S=!1,i()},s.onerror=e=>{s.disconnect(),n.active=S=!1,o(e)},"suspended"===d.state&&d.resume(),0==t?s.start():s.start(0,d.currentTime-t),n.active=S=!0});const T=(e="mp3",t=".")=>{const n=[];for(let r=0;r<i.length;++r){const a=i[r];"A"===a&&n.push(`A0${t}${e}`);for(let r=1;r<8;++r)n.push(`${a}${r}${t}${e}`);"C"===a&&n.push(`C8${t}${e}`)}return n},M=T("","");n.NOTE_NAMES=M;const A={};M.forEach(e=>{A[e]=e});n.getNoteSound=(e,t=!1)=>u[Math.floor(e*(u.length-1))];n.getNoteText=e=>{const t=e.charAt(0);let n;return 3===e.length?(n=parseInt(e.charAt(2))+1,`${t}#${n}`):(n=parseInt(e.charAt(1))+1,`${t}${n}`)};n.getNoteName=(e,t=3,n=!1)=>{let a,i;return n?(a=Math.floor(e*c),i=o[a]):(a=Math.floor(e*l),i=s[a]),`${i}${(0,r.clamp)(t,1,7)}`};const x=(e="alto_sax-mp3",t="./FluidR3_GM")=>{const n=`${t}/${e}`;return T().map(e=>async function(e){const t=await fetch(e),n=await t.arrayBuffer();return await d.decodeAudioData(n)}(`${n}/${e}`))};n.loadInstrumentParts=x;n.loadInstrument=async(e="alto_sax-mp3",t="./FluidR3_GM",n)=>{const r={title:(0,a.cleanTitle)(e),name:e},i=await Promise.all(x(e,t));return M.forEach((e,t)=>{r[e.split(".")[0]]=i[t]}),r}},{"../maths":"b35d1feb9582910dececcb2468237235","./instruments":"e5a876cfe90709c6f27591258fb40c97"}],b35d1feb9582910dececcb2468237235:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.easeOutSine=function(e){return Math.sin(e*(Math.PI/2))},n.easeInOutSine=function(e){return-.5*(Math.cos(Math.PI*e)-1)},n.easeInQuad=function(e){return e*e},n.easeOutQuad=function(e){return e*(2-e)},n.easeInOutQuad=function(e){return e<.5?2*e*e:(4-2*e)*e-1},n.easeInCubic=function(e){return e*e*e},n.easeOutCubic=function(e){const t=e-1;return t*t*t+1},n.easeInOutCubic=function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},n.easeInQuart=function(e){return e*e*e*e},n.easeOutQuart=function(e){const t=e-1;return 1-t*t*t*t},n.easeInOutQuart=function(e){const t=e-1;return e<.5?8*e*e*e*e:1-8*t*t*t*t},n.easeInQuint=function(e){return e*e*e*e*e},n.easeOutQuint=function(e){const t=e-1;return 1+t*t*t*t*t},n.easeInOutQuint=function(e){const t=e-1;return e<.5?16*e*e*e*e*e:1+16*t*t*t*t*t},n.easeInExpo=function(e){if(0===e)return 0;return Math.pow(2,10*(e-1))},n.easeOutExpo=function(e){if(1===e)return 1;return 1-Math.pow(2,-10*e)},n.easeInOutExpo=function(e){if(0===e||1===e)return e;const t=2*e,n=t-1;if(t<1)return.5*Math.pow(2,10*n);return.5*(2-Math.pow(2,-10*n))},n.easeInCirc=function(e){const t=e/1;return-1*(Math.sqrt(1-t*e)-1)},n.easeOutCirc=function(e){const t=e-1;return Math.sqrt(1-t*t)},n.easeInOutCirc=function(e){const t=2*e,n=t-2;if(t<1)return-.5*(Math.sqrt(1-t*t)-1);return.5*(Math.sqrt(1-n*n)+1)},n.easeInBack=function(e,t=1.70158){return e*e*((t+1)*e-t)},n.easeOutBack=function(e,t=1.70158){const n=e/1-1;return n*n*((t+1)*n+t)+1},n.easeInOutBack=function(e,t=1.70158){const n=2*e,r=n-2,a=1.525*t;if(n<1)return.5*n*n*((a+1)*n-a);return.5*(r*r*((a+1)*r+a)+2)},n.easeInElastic=function(e,t=.7){if(0===e||1===e)return e;const n=e/1-1,r=1-t,a=r/(2*Math.PI)*Math.asin(1);return-Math.pow(2,10*n)*Math.sin((n-a)*(2*Math.PI)/r)},n.easeOutElastic=function(e,t=.7){const n=1-t,r=2*e;if(0===e||1===e)return e;const a=n/(2*Math.PI)*Math.asin(1);return Math.pow(2,-10*r)*Math.sin((r-a)*(2*Math.PI)/n)+1},n.easeInOutElastic=function(e,t=.65){const n=1-t;if(0===e||1===e)return e;const r=2*e,a=r-1,i=n/(2*Math.PI)*Math.asin(1);if(r<1)return Math.pow(2,10*a)*Math.sin((a-i)*(2*Math.PI)/n)*-.5;return Math.pow(2,-10*a)*Math.sin((a-i)*(2*Math.PI)/n)*.5+1},n.easeOutBounce=a,n.easeInBounce=i,n.easeInOutBounce=function(e){if(e<.5)return.5*i(2*e);return.5*a(2*e-1)+.5},n.easeInSine=n.linear=n.clamp=n.lerp=n.rescale=n.TAU=void 0;const r=2*Math.PI;n.TAU=r;n.rescale=(e,t=1)=>{const n=1/(t-e);return t=>n*(t-e)};n.lerp=(e,t,n)=>(1-n)*e+n*t;n.clamp=(e,t,n)=>e>n?n:e<t?t:e;n.linear=e=>e;function a(e){const t=e/1;if(t<1/2.75)return 7.5625*t*t;if(t<2/2.75){const e=t-1.5/2.75;return 7.5625*e*e+.75}if(t<2.5/2.75){const e=t-2.25/2.75;return 7.5625*e*e+.9375}{const e=t-2.625/2.75;return 7.5625*e*e+.984375}}function i(e){return 1-a(1-e)}n.easeInSine=e=>-1*Math.cos(e*(Math.PI/2))+1},{}],"20894d5885a697c12dfcbfca18b9fc7f":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.createDrumkit=n.createClacks=n.createCowbells=n.createHihats=n.createSnares=n.createKicks=n.createCowbell=n.createClack=n.createHihat=n.createSnare=n.createKick=n.createQueue=void 0;var r=e("./audio");const a=(e,t=5)=>{const n=[];for(let r=0;r<t;++r){const t=e();n.push(t)}let r=0;return(...e)=>{r=r+1<t?r+1:0;(0,n[r])(...e)}};n.createQueue=a;const i=()=>{const e=r.audioContext.createOscillator(),t=r.audioContext.createOscillator(),n=r.audioContext.createGain(),a=r.audioContext.createGain();e.type="triangle",t.type="sine";return e.connect(n),t.connect(a),n.connect((0,r.inputDryNode)()),a.connect((0,r.inputDryNode)()),(i=1,o=.05,s=.01,c=.5)=>{const l=r.audioContext.currentTime;n.gain.cancelScheduledValues(l),a.gain.cancelScheduledValues(l),e.frequency.cancelScheduledValues(l),t.frequency.cancelScheduledValues(l),n.gain.setValueAtTime(1,l),n.gain.exponentialRampToValueAtTime(1e-7,l+o),a.gain.setValueAtTime(1,r.audioContext.currentTime),a.gain.exponentialRampToValueAtTime(1e-7,l+o),e.frequency.setValueAtTime(90,r.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(s,l+o),t.frequency.setValueAtTime(50,r.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(s,l+o);try{e.start(l),t.start(l)}catch(e){}}};n.createKick=i;const o=()=>{const e=r.audioContext.createOscillator(),t=r.audioContext.createGain(),n=r.audioContext.createGain(),a=r.audioContext.createBufferSource(),i=r.audioContext.createBuffer(1,4096,r.audioContext.sampleRate),o=r.audioContext.createBiquadFilter();o.type="highpass",e.type="triangle",e.frequency.value=100;const s=i.getChannelData(0);for(var c=0;c<4096;c++)s[c]=Math.random();a.buffer=i,a.loop=!0,e.connect(t),t.connect((0,r.inputDryNode)()),a.connect(o),o.connect(n),n.connect((0,r.inputDryNode)());return(i=1,s=.2)=>{const c=r.audioContext.currentTime;n.gain.cancelScheduledValues(c),n.gain.setValueAtTime(1,c),n.gain.exponentialRampToValueAtTime(1e-7,c+s),t.gain.cancelScheduledValues(c),t.gain.setValueAtTime(1e-7,c),t.gain.exponentialRampToValueAtTime(1e-7,c+s/2),o.frequency.cancelScheduledValues(c),o.frequency.setValueAtTime(100,c),o.frequency.linearRampToValueAtTime(1e3,c+s);try{e.start(c),a.start(c)}catch(e){}}};n.createSnare=o;const s=()=>{const e=r.audioContext.createGain(),t=r.audioContext.createBiquadFilter();t.type="bandpass",t.frequency.value=1e4;const n=r.audioContext.createBiquadFilter();n.type="highpass",n.frequency.value=7e3;const a=[2,3,4.16,5.43,6.79,8.21].map(e=>{const n=r.audioContext.createOscillator();return n.type="square",n.frequency.value=40*e,n.connect(t),n});t.connect(n),n.connect(e),e.connect((0,r.inputDryNode)());return(t=1,n=.05)=>{const i=r.audioContext.currentTime;e.gain.cancelScheduledValues(i),a.forEach(e=>e.frequency.cancelScheduledValues(i)),e.gain.setValueAtTime(1,i),e.gain.exponentialRampToValueAtTime(1e-7,i+n);try{a.forEach(e=>e.start(i))}catch(e){}}};n.createHihat=s;const c=()=>{const e=r.audioContext.createGain(),t=r.audioContext.createBiquadFilter();t.type="bandpass",t.frequency.value=2640,t.Q.value=3.5;const n=r.audioContext.createBiquadFilter();n.type="highpass",n.frequency.value=7e3;const a=[587,845],i=a.map(e=>{const n=r.audioContext.createOscillator();return n.type="triangle",n.frequency.value=1*e,n.connect(t),n});t.connect(n),n.connect(e),e.connect((0,r.inputDryNode)());return(t=1,n=.05,o=1)=>{const s=r.audioContext.currentTime;e.gain.cancelScheduledValues(s),i.forEach((e,t)=>{e.frequency.cancelScheduledValues(s),e.frequency.value=o*a[t]}),e.gain.setValueAtTime(1,s),e.gain.exponentialRampToValueAtTime(1e-7,s+n);try{i.forEach(e=>e.start(s))}catch(e){}}};n.createClack=c;const l=()=>{const e=r.audioContext.createGain(),t=r.audioContext.createBiquadFilter();t.type="bandpass",t.frequency.value=2640,t.Q.value=3.5;const n=[587,845].map(e=>{const n=r.audioContext.createOscillator();return n.type="triangle",n.frequency.value=1*e,n.connect(t),n});t.connect(e),e.connect((0,r.inputDryNode)());return(t=1,a=.05)=>{const i=r.audioContext.currentTime;e.gain.cancelScheduledValues(i),n.forEach(e=>e.frequency.cancelScheduledValues(i)),e.gain.setValueAtTime(1,i),e.gain.exponentialRampToValueAtTime(1e-7,i+a);try{n.forEach(e=>e.start(i))}catch(e){}}};n.createCowbell=l;const u=(e=2)=>a(i,e);n.createKicks=u;const d=(e=3)=>a(o,e);n.createSnares=d;const h=(e=3)=>a(s,e);n.createHihats=h;n.createCowbells=(e=2)=>a(l,e);n.createClacks=(e=2)=>a(c,e);n.createDrumkit=()=>{const e=u(),t=h();return{kick:e,snare:d(),hat:t,cowbell:l(),clack:c()}}},{"./audio":"96a3cf8e6eb7e0adf88768f97d328ae3"}],"247ea146e45795daa49232bf1b7e1a74":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.setupMIDI=n.testForMIDI=void 0;var r=e("webmidi/dist/webmidi.esm");n.testForMIDI=()=>void 0!==navigator.requestMIDIAccess;n.setupMIDI=(e,t)=>new Promise((n,a)=>{r.WebMidi.enable().then(a=>{r.WebMidi.addListener("connected",(function(t){console.log(t),e&&e(t)})),r.WebMidi.addListener("disconnected",(function(e){console.log(e),t&&t()})),n(r.WebMidi)}).catch(e=>a(e))})},{"webmidi/dist/webmidi.esm":"13e2cf2ccfce1bfc9a1f91d78e129d45"}],"13e2cf2ccfce1bfc9a1f91d78e129d45":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.WebMidi=n.Note=void 0;var r=e("process");class a{constructor(e=!1){this.eventMap={},this.eventsSuspended=1==e}addListener(e,t,n={}){if("string"==typeof e&&e.length<1||e instanceof String&&e.length<1||"string"!=typeof e&&!(e instanceof String)&&e!==a.ANY_EVENT)throw new TypeError("The 'event' parameter must be a string or EventEmitter.ANY_EVENT.");if("function"!=typeof t)throw new TypeError("The callback must be a function.");const r=new i(e,this,t,n);return this.eventMap[e]||(this.eventMap[e]=[]),n.prepend?this.eventMap[e].unshift(r):this.eventMap[e].push(r),r}addOneTimeListener(e,t,n={}){n.remaining=1,this.addListener(e,t,n)}static get ANY_EVENT(){return Symbol.for("Any event")}hasListener(e,t){return void 0===e?!!(this.eventMap[a.ANY_EVENT]&&this.eventMap[a.ANY_EVENT].length>0)||Object.entries(this.eventMap).some(([,e])=>e.length>0):!!(this.eventMap[e]&&this.eventMap[e].length>0)&&(t instanceof i?this.eventMap[e].filter(e=>e===t).length>0:"function"==typeof t?this.eventMap[e].filter(e=>e.callback===t).length>0:null==t)}get eventNames(){return Object.keys(this.eventMap)}getListeners(e){return this.eventMap[e]||[]}suspendEvent(e){this.getListeners(e).forEach(e=>{e.suspended=!0})}unsuspendEvent(e){this.getListeners(e).forEach(e=>{e.suspended=!1})}getListenerCount(e){return this.getListeners(e).length}emit(e,...t){if("string"!=typeof e&&!(e instanceof String))throw new TypeError("The 'event' parameter must be a string.");if(this.eventsSuspended)return;let n=[],r=this.eventMap[a.ANY_EVENT]||[];return this.eventMap[e]&&(r=r.concat(this.eventMap[e])),r.forEach(e=>{if(e.suspended)return;let r=[...t];Array.isArray(e.arguments)&&(r=r.concat(e.arguments)),e.remaining>0&&(n.push(e.callback.apply(e.context,r)),e.count++),--e.remaining<1&&e.remove()}),n}removeListener(e,t,n={}){if(void 0===e)return void(this.eventMap={});if(!this.eventMap[e])return;let r=this.eventMap[e].filter(e=>t&&e.callback!==t||n.remaining&&n.remaining!==e.remaining||n.context&&n.context!==e.context);r.length?this.eventMap[e]=r:delete this.eventMap[e]}async waitFor(e,t={}){return t.duration=parseInt(t.duration),(isNaN(t.duration)||t.duration<=0)&&(t.duration=1/0),new Promise((n,r)=>{let a,i=this.addListener(e,()=>{clearTimeout(a),n()},{remaining:1});t.duration!==1/0&&(a=setTimeout(()=>{i.remove(),r("The duration expired before the event was emitted.")},t.duration))})}get eventCount(){return Object.keys(this.eventMap).length}}class i{constructor(e,t,n,r={}){if("string"!=typeof e&&!(e instanceof String)&&e!==a.ANY_EVENT)throw new TypeError("The 'event' parameter must be a string or EventEmitter.ANY_EVENT.");if(!t)throw new ReferenceError("The 'target' parameter is mandatory.");if("function"!=typeof n)throw new TypeError("The 'callback' must be a function.");void 0===r.arguments||Array.isArray(r.arguments)||(r.arguments=[r.arguments]),(r=Object.assign({context:t,remaining:1/0,arguments:void 0,duration:1/0},r)).duration!==1/0&&setTimeout(()=>this.remove(),r.duration),this.event=e,this.target=t,this.callback=n,this.context=r.context,this.remaining=parseInt(r.remaining)>=1?parseInt(r.remaining):1/0,this.count=0,this.arguments=r.arguments,this.suspended=!1}remove(){this.target.removeListener(this.event,this.callback,{context:this.context,remaining:this.remaining})}}class o extends a{constructor(e,t){super(),this.input=e,this.number=t,this._forwardTo=void 0}destroy(){this.input=null,this.number=null,this.removeListener()}_parseEvent(e){let t=null;e.data[0]!==d.MIDI_SYSTEM_MESSAGES.sysex&&(t=e.data.slice(1));let n={target:this,data:Array.from(e.data),rawData:e.data,statusByte:e.data[0],dataBytes:t,timestamp:e.timeStamp,type:"midimessage"};this.emit("midimessage",n),this._parseEventForStandardMessages(e)}getStructuredMidiMessage(e){return{command:e[0]>>4,data1:e.length>1?e[1]:void 0,data2:e.length>2?e[2]:void 0}}_parseEventForStandardMessages(e){let{command:t,data1:n,data2:r}=this.getStructuredMidiMessage(e.data),a={target:this,data:Array.from(e.data),rawData:e.data,timestamp:e.timeStamp};t===d.MIDI_CHANNEL_VOICE_MESSAGES.noteoff||t===d.MIDI_CHANNEL_VOICE_MESSAGES.noteon&&0===r?(a.type="noteoff",a.note=new u(n,{rawRelease:r}),a.release=a.note.release,a.rawRelease=a.note.rawRelease):t===d.MIDI_CHANNEL_VOICE_MESSAGES.noteon?(a.type="noteon",a.note=new u(n,{rawAttack:r}),a.attack=a.note.attack,a.rawAttack=a.note.rawAttack):t===d.MIDI_CHANNEL_VOICE_MESSAGES.keyaftertouch?(a.type="keyaftertouch",a.note=new u(n),a.value=r/127,a.rawValue=r):t===d.MIDI_CHANNEL_VOICE_MESSAGES.controlchange&&n>=0&&n<=119?(a.type="controlchange",a.controller={number:n,name:this.getCcNameByNumber(n)},a.value=r/127,a.rawValue=r):t===d.MIDI_CHANNEL_VOICE_MESSAGES.channelmode&&n>=120&&n<=127?(a.type="channelmode",a.controller={number:n,name:this.getChannelModeByNumber(n)},a.value=r,this._parseChannelModeMessage(e)):t===d.MIDI_CHANNEL_VOICE_MESSAGES.programchange?(a.type="programchange",a.value=n+1,a.rawValue=n):t===d.MIDI_CHANNEL_VOICE_MESSAGES.channelaftertouch?(a.type="channelaftertouch",a.value=n/127,a.rawValue=n):t===d.MIDI_CHANNEL_VOICE_MESSAGES.pitchbend?(a.type="pitchbend",a.value=((r<<7)+n-8192)/8192,a.rawValue=(r<<7)+n):a.type="unknownmessage",this.emit(a.type,a)}getChannelModeByNumber(e){if(d.validation&&(e=Math.floor(e)),!(e>=120&&e<=127))return!1;for(let t in d.MIDI_CHANNEL_MODE_MESSAGES)if(d.MIDI_CHANNEL_MODE_MESSAGES.hasOwnProperty(t)&&e===d.MIDI_CHANNEL_MODE_MESSAGES[t])return t;return!1}_parseChannelModeMessage(e){let t,n;e.data.length>1&&(t=e.data[1],n=e.data.length>2?e.data[2]:void 0);let r={target:this,data:Array.from(e.data),rawData:e.data,timestamp:e.timeStamp,type:this.getChannelModeByNumber(t)};"localcontrol"===r.type&&(r.value=127===n),"omnimodeon"===r.type?(r.type="omnimode",r.value=!0):"omnimodeoff"===r.type&&(r.type="omnimode",r.value=!1),"monomodeon"===r.type?(r.type="monomode",r.value=!0):"polymodeon"===r.type&&(r.type="monomode",r.value=!1),this.emit(r.type,r)}getCcNameByNumber(e){if(d.validation&&!((e=parseInt(e))>=0&&e<=119))throw new RangeError("Invalid control change number.");for(let t in d.MIDI_CONTROL_CHANGE_MESSAGES)if(d.MIDI_CONTROL_CHANGE_MESSAGES.hasOwnProperty(t)&&e===d.MIDI_CONTROL_CHANGE_MESSAGES[t])return t;return!1}}class s extends a{constructor(e){super(),this._midiInput=e,this.channels=[];for(let e=1;e<=16;e++)this.channels[e]=new o(this,e);this._midiInput.onstatechange=this._onStateChange.bind(this),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}async destroy(){this.removeListener(),this.channels.forEach(e=>e.destroy()),this.channels=[],this._midiInput.onstatechange=null,this._midiInput.onmidimessage=null,await this.close(),this._midiInput=null}_onStateChange(e){let t={timestamp:d.time,target:this};"open"===e.port.connection?(t.type="opened",this.emit("opened",t)):"closed"===e.port.connection&&"connected"===e.port.state?(t.type="closed",this.emit("closed",t)):"closed"===e.port.connection&&"disconnected"===e.port.state?(t.type="disconnected",t.target={connection:e.port.connection,id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this.emit("disconnected",t)):"pending"===e.port.connection&&"disconnected"===e.port.state||console.warn("This statechange event was not caught: ",e.port.connection,e.port.state)}_onMidiMessage(e){let t=null;e.data[0]!==d.MIDI_SYSTEM_MESSAGES.sysex&&(t=e.data.slice(1));let n={target:this,data:Array.from(e.data),rawData:e.data,statusByte:e.data[0],dataBytes:t,timestamp:e.timeStamp,type:"midimessage"};if(this.emit("midimessage",n),e.data[0]<240){let t=1+(15&e.data[0]);this.channels[t]._parseEvent(e)}else e.data[0]<=255&&this._parseEvent(e)}_parseEvent(e){let t=e.data[0];var n={target:this,data:Array.from(e.data),rawData:e.data,timestamp:e.timeStamp};t===d.MIDI_SYSTEM_MESSAGES.sysex?n.type="sysex":t===d.MIDI_SYSTEM_MESSAGES.timecode?n.type="timecode":t===d.MIDI_SYSTEM_MESSAGES.songposition?n.type="songposition":t===d.MIDI_SYSTEM_MESSAGES.songselect?(n.type="songselect",n.song=e.data[1]+1):t===d.MIDI_SYSTEM_MESSAGES.tunerequest?n.type="tunerequest":t===d.MIDI_SYSTEM_MESSAGES.clock?n.type="clock":t===d.MIDI_SYSTEM_MESSAGES.start?n.type="start":t===d.MIDI_SYSTEM_MESSAGES.continue?n.type="continue":t===d.MIDI_SYSTEM_MESSAGES.stop?n.type="stop":t===d.MIDI_SYSTEM_MESSAGES.activesensing?n.type="activesensing":t===d.MIDI_SYSTEM_MESSAGES.reset?n.type="reset":n.type="unknownmidimessage",this.emit(n.type,n)}async open(){try{return await this._midiInput.open(),Promise.resolve(this)}catch(e){return Promise.reject(e)}}async close(){return this._midiInput?this._midiInput.close():Promise.resolve()}getChannelModeByNumber(){d.validation&&console.warn("The 'getChannelModeByNumber()' method has been moved to the 'InputChannel' class.")}addListener(e,t,n){if(d.validation){if("function"==typeof n){let e=null!=t?[].concat(t):void 0;t=n,n={channels:e}}if(void 0!==d.MIDI_CHANNEL_VOICE_MESSAGES[e]&&void 0===n.channels)throw new Error("For channel-specific events, 'options.channels' must be defined.")}let r=[];return void 0===d.MIDI_CHANNEL_VOICE_MESSAGES[e]?r.push(super.addListener(e,t,n)):d.sanitizeChannels(n.channels).forEach(a=>{r.push(this.channels[a].addListener(e,t,n))}),r}addOneTimeListener(e,t,n={}){return n.remaining=1,this.addListener(e,t,n)}on(e,t,n,r){return this.addListener(e,t,n,r)}hasListener(e,t,n={}){if(d.validation){if("function"==typeof n){let e=[].concat(t);t=n,n={channels:e}}if(void 0!==d.MIDI_CHANNEL_VOICE_MESSAGES[e]&&void 0===n.channels)throw new Error("For channel-specific events, 'options.channels' must be defined.")}return void 0!==d.MIDI_CHANNEL_VOICE_MESSAGES[e]?d.sanitizeChannels(n.channels).every(n=>this.channels[n].hasListener(e,t)):super.hasListener(e,t)}removeListener(e,t,n={}){if(d.validation&&"function"==typeof n){let e=[].concat(t);t=n,n={channels:e}}if(void 0===n.channels&&(n.channels=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),null==e)return d.sanitizeChannels(n.channels).forEach(e=>this.channels[e].removeListener()),super.removeListener();void 0!==d.MIDI_CHANNEL_VOICE_MESSAGES[e]?d.sanitizeChannels(n.channels).forEach(r=>{this.channels[r].removeListener(e,t,n)}):super.removeListener(e,t,n)}get name(){return this._midiInput.name}get id(){return this._midiInput.id}get connection(){return this._midiInput.connection}get manufacturer(){return this._midiInput.manufacturer}get state(){return this._midiInput.state}get type(){return this._midiInput.type}get nrpnEventsEnabled(){return d.validation&&console.warn("The 'nrpnEventsEnabled' property has been moved to the 'InputChannel' class."),!1}}class c extends a{constructor(e,t){super(),this.output=e,this.number=t}destroy(){this.output=null,this.number=null,this.removeListener()}send(e,t=[],n={}){return this.output.send(e,t,n),this}setKeyAftertouch(e,t,n={}){if(d.validation){if(n.useRawValue&&(n.rawValue=n.useRawValue),isNaN(parseFloat(t)))throw new RangeError("Invalid key aftertouch value.");if(n.rawValue){if(!(t>=0&&t<=127&&Number.isInteger(t)))throw new RangeError("Key aftertouch raw value must be an integer between 0 and 127.")}else if(!(t>=0&&t<=1))throw new RangeError("Key aftertouch value must be a float between 0 and 1.")}return n.rawValue||(t=Math.round(127*t)),d.getValidNoteArray(e,n).forEach(e=>{this.send((d.MIDI_CHANNEL_VOICE_MESSAGES.keyaftertouch<<4)+(this.number-1),[e.number,t],d.convertToTimestamp(n.time))}),this}sendControlChange(e,t,n={}){if("string"==typeof e&&(e=d.MIDI_CONTROL_CHANGE_MESSAGES[e]),d.validation){if(void 0===e)throw new TypeError("Control change must be identified with a valid name or an integer between 0 and 119.");if(!Number.isInteger(e)||!(e>=0&&e<=119))throw new TypeError("Control change number must be an integer between 0 and 119.");if(!Number.isInteger(t)||!(t>=0&&t<=127))throw new TypeError("Control change value must be an integer between 0 and 127")}return this.send((d.MIDI_CHANNEL_VOICE_MESSAGES.controlchange<<4)+(this.number-1),[e,t],d.convertToTimestamp(n.time)),this}_selectNonRegisteredParameter(e,t={}){return this.sendControlChange(99,e[0],t),this.sendControlChange(98,e[1],t),this}_deselectRegisteredParameter(e={}){return this.sendControlChange(101,127,e),this.sendControlChange(100,127,e),this}_deselectNonRegisteredParameter(e={}){return this.sendControlChange(101,127,e),this.sendControlChange(100,127,e),this}_selectRegisteredParameter(e,t={}){return this.sendControlChange(101,e[0],t),this.sendControlChange(100,e[1],t),this}_setCurrentParameter(e,t={}){return e=[].concat(e),this.sendControlChange(6,e[0],t),e.length<2||this.sendControlChange(38,e[1],t),this}decrementRegisteredParameter(e,t={}){if(Array.isArray(e)||(e=d.MIDI_REGISTERED_PARAMETER[e]),d.validation){if(void 0===e)throw new TypeError("The specified registered parameter is invalid.");let t=!1;if(Object.getOwnPropertyNames(d.MIDI_REGISTERED_PARAMETER).forEach(n=>{d.MIDI_REGISTERED_PARAMETER[n][0]===e[0]&&d.MIDI_REGISTERED_PARAMETER[n][1]===e[1]&&(t=!0)}),!t)throw new TypeError("The specified registered parameter is invalid.")}return this._selectRegisteredParameter(e,t),this.sendControlChange(97,0,t),this._deselectRegisteredParameter(t),this}incrementRegisteredParameter(e,t={}){if(Array.isArray(e)||(e=d.MIDI_REGISTERED_PARAMETER[e]),d.validation){if(void 0===e)throw new TypeError("The specified registered parameter is invalid.");let t=!1;if(Object.getOwnPropertyNames(d.MIDI_REGISTERED_PARAMETER).forEach(n=>{d.MIDI_REGISTERED_PARAMETER[n][0]===e[0]&&d.MIDI_REGISTERED_PARAMETER[n][1]===e[1]&&(t=!0)}),!t)throw new TypeError("The specified registered parameter is invalid.")}return this._selectRegisteredParameter(e,t),this.sendControlChange(96,0,t),this._deselectRegisteredParameter(t),this}playNote(e,t={}){if(this.sendNoteOn(e,t),t.duration>0&&isFinite(String(t.duration).trim()||NaN)){let n={time:(d.convertToTimestamp(t.time)||d.time)+t.duration,release:t.release,rawRelease:t.rawRelease};this.sendNoteOff(e,n)}return this}sendNoteOff(e,t={}){if(d.validation){if(null!=t.rawRelease&&!(t.rawRelease>=0&&t.rawRelease<=127))throw new RangeError("The 'rawRelease' option must be an integer between 0 and 127");if(null!=t.release&&!(t.release>=0&&t.release<=1))throw new RangeError("The 'release' option must be an number between 0 and 1");t.rawVelocity&&(t.rawRelease=t.velocity,console.warn("The 'rawVelocity' option is deprecated. Use 'rawRelease' instead.")),t.velocity&&(t.release=t.velocity,console.warn("The 'velocity' option is deprecated. Use 'attack' instead."))}let n=64;null!=t.rawRelease?n=t.rawRelease:isNaN(t.release)||(n=Math.round(127*t.release));let r={rawRelease:parseInt(n)};return d.getValidNoteArray(e,r).forEach(e=>{this.send((d.MIDI_CHANNEL_VOICE_MESSAGES.noteoff<<4)+(this.number-1),[e.number,e.rawRelease],d.convertToTimestamp(t.time))}),this}stopNote(e,t={}){return this.sendNoteOff(e,t)}sendNoteOn(e,t={}){if(d.validation){if(null!=t.rawAttack&&!(t.rawAttack>=0&&t.rawAttack<=127))throw new RangeError("The 'rawAttack' option must be an integer between 0 and 127");if(null!=t.attack&&!(t.attack>=0&&t.attack<=1))throw new RangeError("The 'attack' option must be an number between 0 and 1");t.rawVelocity&&(t.rawAttack=t.velocity,t.rawRelease=t.release,console.warn("The 'rawVelocity' option is deprecated. Use 'rawAttack' or 'rawRelease'.")),t.velocity&&(t.attack=t.velocity,console.warn("The 'velocity' option is deprecated. Use 'attack' instead."))}let n=64;null!=t.rawAttack?n=t.rawAttack:isNaN(t.attack)||(n=Math.round(127*t.attack));let r={rawAttack:n};return d.getValidNoteArray(e,r).forEach(e=>{this.send((d.MIDI_CHANNEL_VOICE_MESSAGES.noteon<<4)+(this.number-1),[e.number,e.rawAttack],d.convertToTimestamp(t.time))}),this}sendChannelMode(e,t,n={}){if("string"==typeof e&&(e=d.MIDI_CHANNEL_MODE_MESSAGES[e]),d.validation){if(void 0===e)throw new TypeError("Invalid channel mode message name or number.");if(isNaN(e)||!(e>=120&&e<=127))throw new TypeError("Invalid channel mode message number.");if(isNaN(parseInt(t))||t<0||t>127)throw new RangeError("Value must be an integer between 0 and 127.")}return this.send((d.MIDI_CHANNEL_VOICE_MESSAGES.channelmode<<4)+(this.number-1),[e,t],d.convertToTimestamp(n.time)),this}setOmniMode(e,t={}){return void 0===e||e?this.sendChannelMode("omnimodeon",0,t):this.sendChannelMode("omnimodeoff",0,t),this}setChannelAftertouch(e,t={}){if(d.validation){if(isNaN(parseFloat(e)))throw new RangeError("Invalid channel aftertouch value.");if(t.rawValue){if(!(e>=0&&e<=127&&Number.isInteger(e)))throw new RangeError("Channel aftertouch raw value must be an integer between 0 and 127.")}else if(!(e>=0&&e<=1))throw new RangeError("Channel aftertouch value must be a float between 0 and 1.")}return this.send((d.MIDI_CHANNEL_VOICE_MESSAGES.channelaftertouch<<4)+(this.number-1),[Math.round(127*e)],d.convertToTimestamp(t.time)),this}setMasterTuning(e,t={}){if(e=parseFloat(e)||0,d.validation&&!(e>-65&&e<64))throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");let n=Math.floor(e)+64,r=e-Math.floor(e);r=Math.round((r+1)/2*16383);let a=r>>7&127,i=127&r;return this.setRegisteredParameter("channelcoarsetuning",n,t),this.setRegisteredParameter("channelfinetuning",[a,i],t),this}setModulationRange(e,t,n={}){if(d.validation){if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new RangeError("The semitones value must be an integer between 0 and 127.");if(!(null==t||Number.isInteger(t)&&t>=0&&t<=127))throw new RangeError("If specified, the cents value must be an integer between 0 and 127.")}return t>=0&&t<=127||(t=0),this.setRegisteredParameter("modulationrange",[e,t],n),this}setNonRegisteredParameter(e,t,n={}){if(t=[].concat(t),d.validation){if(!Array.isArray(e)||!Number.isInteger(e[0])||!Number.isInteger(e[1]))throw new TypeError("The specified NRPN is invalid.");if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The first byte of the NRPN must be between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The second byte of the NRPN must be between 0 and 127.");t.forEach(e=>{if(!(e>=0&&e<=127))throw new RangeError("The data bytes of the NRPN must be between 0 and 127.")})}return this._selectNonRegisteredParameter(e,n),this._setCurrentParameter(t,n),this._deselectNonRegisteredParameter(n),this}setPitchBend(e,t={}){if(d.validation)if(t.rawValue&&Array.isArray(e)){if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The pitch bend MSB must be an integer between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The pitch bend LSB must be an integer between 0 and 127.")}else if(t.rawValue&&!Array.isArray(e)){if(!(e>=0&&e<=127))throw new RangeError("The pitch bend MSB must be an integer between 0 and 127.")}else{if(isNaN(e)||null===e)throw new RangeError("Invalid pitch bend value.");if(!(e>=-1&&e<=1))throw new RangeError("The pitch bend MSB must be an integer between 0 and 127.")}let n=0,r=0;if(t.rawValue&&Array.isArray(e))n=e[0],r=e[1];else if(t.rawValue&&!Array.isArray(e))n=e;else{let t=Math.round((e+1)/2*16383);n=t>>7&127,r=127&t}return this.send((d.MIDI_CHANNEL_VOICE_MESSAGES.pitchbend<<4)+(this.number-1),[r,n],d.convertToTimestamp(t.time)),this}setPitchBendRange(e,t,n={}){if(d.validation){if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new RangeError("The semitones value must be an integer between 0 and 127.");if(!Number.isInteger(t)||!(t>=0&&t<=127))throw new RangeError("The cents value must be an integer between 0 and 127.")}return this.setRegisteredParameter("pitchbendrange",[e,t],n),this}setProgram(e,t={}){if(e=parseInt(e)||1,d.validation&&!(e>=1&&e<=128))throw new RangeError("The program number must be between 1 and 128.");return this.send((d.MIDI_CHANNEL_VOICE_MESSAGES.programchange<<4)+(this.number-1),[e-1],d.convertToTimestamp(t.time)),this}setRegisteredParameter(e,t,n={}){if(Array.isArray(e)||(e=d.MIDI_REGISTERED_PARAMETER[e]),d.validation){if(!Number.isInteger(e[0])||!Number.isInteger(e[1]))throw new TypeError("The specified NRPN is invalid.");if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The first byte of the RPN must be between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The second byte of the RPN must be between 0 and 127.");[].concat(t).forEach(e=>{if(!(e>=0&&e<=127))throw new RangeError("The data bytes of the RPN must be between 0 and 127.")})}return this._selectRegisteredParameter(e,n),this._setCurrentParameter(t,n),this._deselectRegisteredParameter(n),this}setTuningBank(e,t={}){if(d.validation&&(!Number.isInteger(e)||!(e>=1&&e<=128)))throw new RangeError("The tuning bank number must be between 1 and 128.");return this.setRegisteredParameter("tuningbank",e-1,t),this}setTuningProgram(e,t={}){if(d.validation&&(!Number.isInteger(e)||!(e>=1&&e<=128)))throw new RangeError("The tuning program number must be between 1 and 128.");return this.setRegisteredParameter("tuningprogram",e-1,t),this}setLocalControl(e,t={}){return e?this.sendChannelMode("localcontrol",127,t):this.sendChannelMode("localcontrol",0,t)}turnNotesOff(e={}){return this.sendChannelMode("allnotesoff",0,e)}turnSoundOff(e={}){return this.sendChannelMode("allsoundoff",0,e)}resetAllControllers(e={}){return this.sendChannelMode("resetallcontrollers",0,e)}setPolyphonicMode(e,t={}){return"mono"===e?this.sendChannelMode("monomodeon",0,t):this.sendChannelMode("polymodeon",0,t)}}class l extends a{constructor(e){if(super(),d.validation&&(!e||"output"!==e.type))throw new TypeError("The supplied MIDIOutput is invalid.");this._midiOutput=e,this.channels=[];for(let e=1;e<=16;e++)this.channels[e]=new c(this,e);this._midiOutput.onstatechange=this._onStateChange.bind(this)}async destroy(){this.removeListener(),this.channels.forEach(e=>e.destroy()),this.channels=[],this._midiOutput.onstatechange=null,await this.close(),this._midiOutput=null}_onStateChange(e){let t={timestamp:d.time};"open"===e.port.connection?(t.type="opened",t.target=this,this.emit("opened",t)):"closed"===e.port.connection&&"connected"===e.port.state?(t.type="closed",t.target=this,this.emit("closed",t)):"closed"===e.port.connection&&"disconnected"===e.port.state?(t.type="disconnected",t.target={connection:e.port.connection,id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this.emit("disconnected",t)):"pending"===e.port.connection&&"disconnected"===e.port.state||console.warn("This statechange event was not caught:",e.port.connection,e.port.state)}async open(){try{return await this._midiOutput.open(),Promise.resolve(this)}catch(e){return Promise.reject(e)}}async close(){this._midiOutput?await this._midiOutput.close():await Promise.resolve()}send(e,t={},n={}){if(d.validation){if(!Array.isArray(e)&&parseInt(e)>=128&&parseInt(e)<=255&&(e=[e],Array.isArray(t)&&(e=e.concat(t)),t="number"==typeof n?{time:n}:n),!(parseInt(e[0])>=128&&parseInt(e[0])<=255))throw new TypeError("The first byte (status) must be an integer between 128 and 255.");e.slice(1).forEach(e=>{if(e=parseInt(e),!(parseInt(e)>=0&&parseInt(e)<=255))throw new RangeError("Data bytes must be integers between 0 and 255.")})}return this._midiOutput.send(e,d.convertToTimestamp(t.time)),this}sendSysex(e,t,n={}){return t=(e=[].concat(e)).concat(t,d.MIDI_SYSTEM_MESSAGES.sysexend),this.send(d.MIDI_SYSTEM_MESSAGES.sysex,t,{time:n.time}),this}clear(){return this._midiOutput.clear?this._midiOutput.clear():d.validation&&console.warn("The 'clear()' method has not yet been implemented in your environment."),this}sendTimecodeQuarterFrame(e,t={}){if(d.validation&&(e=parseInt(e),isNaN(e)||!(e>=0&&e<=127)))throw new RangeError("The value must be an integer between 0 and 127.");return this.send(d.MIDI_SYSTEM_MESSAGES.timecode,[e],{time:t.time}),this}setSongPosition(e,t={}){var n=(e=Math.floor(e)||0)>>7&127,r=127&e;return this.send(d.MIDI_SYSTEM_MESSAGES.songposition,[n,r],{time:t.time}),this}sendSongPosition(e,t={}){return d.validation&&console.warn("The sendSongPosition() method has been deprecated. Use setSongPosition() instead."),this.setSongPosition(e,t)}setSong(e,t={}){if(d.validation&&(e=parseInt(e),isNaN(e)||!(e>=1&&e<=128)))throw new RangeError("The program value must be between 1 and 128");return this.send(d.MIDI_SYSTEM_MESSAGES.songselect,[e],{time:t.time}),this}sendSongSelect(e,t={}){return d.validation&&console.warn("The sendSongSelect() method has been deprecated. Use setSong() instead."),this.setSong(e,t)}sendTuneRequest(e={}){return this.send(d.MIDI_SYSTEM_MESSAGES.tunerequest,void 0,{time:e.time}),this}sendClock(e={}){return this.send(d.MIDI_SYSTEM_MESSAGES.clock,void 0,{time:e.time}),this}sendStart(e={}){return this.send(d.MIDI_SYSTEM_MESSAGES.start,void 0,{time:e.time}),this}sendContinue(e={}){return this.send(d.MIDI_SYSTEM_MESSAGES.continue,void 0,{time:e.time}),this}sendStop(e={}){return this.send(d.MIDI_SYSTEM_MESSAGES.stop,void 0,{time:e.time}),this}sendActiveSensing(e={}){return this.send(d.MIDI_SYSTEM_MESSAGES.activesensing,[],{time:e.time}),this}sendReset(e={}){return this.send(d.MIDI_SYSTEM_MESSAGES.reset,void 0,{time:e.time}),this}sendTuningRequest(e={}){return d.validation&&console.warn("The sendTuningRequest() method has been deprecated. Use sendTuningRequest() instead."),this.sendTuneRequest(e)}setKeyAftertouch(e,t,n={},r={}){if(d.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;t=n,(n=r).channels=e}return null==n.channels&&(n.channels="all"),d.sanitizeChannels(n.channels).forEach(r=>{this.channels[r].setKeyAftertouch(e,t,n)}),this}sendKeyAftertouch(e,t,n,r={}){return d.validation&&console.warn("The sendKeyAftertouch() method has been deprecated. Use setKeyAftertouch() instead."),r.channels=t,this.setKeyAftertouch(e,n,r)}sendControlChange(e,t,n={},r={}){if(d.validation&&(Array.isArray(n)||Number.isInteger(n)||"all"===n)){let e=n;(n=r).channels=e}return null==n.channels&&(n.channels="all"),d.sanitizeChannels(n.channels).forEach(r=>{this.channels[r].sendControlChange(e,t,n)}),this}setPitchBendRange(e,t,n={},r={}){if(d.validation&&(Array.isArray(n)||Number.isInteger(n)||"all"===n)){let e=n;(n=r).channels=e}return null==n.channels&&(n.channels="all"),d.sanitizeChannels(n.channels).forEach(r=>{this.channels[r].setPitchBendRange(e,t,n)}),this}setRegisteredParameter(e,t,n={},r={}){if(d.validation&&(Array.isArray(n)||Number.isInteger(n)||"all"===n)){let e=n;(n=r).channels=e}return null==n.channels&&(n.channels="all"),d.sanitizeChannels(n.channels).forEach(r=>{this.channels[r].setRegisteredParameter(e,t,n)}),this}setChannelAftertouch(e,t={},n={}){if(d.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),d.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].setChannelAftertouch(e,t)}),this}sendChannelAftertouch(e,t,n={}){return d.validation&&console.warn("The sendChannelAftertouch() method has been deprecated. Use setChannelAftertouch()."),n.channels=t,this.setChannelAftertouch(e,n)}setPitchBend(e,t={},n={}){if(d.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),d.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].setPitchBend(e,t)}),this}sendPitchBend(e,t,n={}){return d.validation&&console.warn("The sendPitchBend() method has been deprecated. Use setPitchBend() instead."),n.channels=t,this.setPitchBend(e,n)}setProgram(e,t={},n={}){if(d.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),d.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].setProgram(e,t)}),this}sendProgramChange(e,t,n={}){return d.validation&&console.warn("The sendProgramChange() method has been deprecated. Use setProgram() instead."),n.channels=t,this.setProgram(e,n)}setModulationRange(e,t,n={},r={}){if(d.validation&&(Array.isArray(n)||Number.isInteger(n)||"all"===n)){let e=n;(n=r).channels=e}return null==n.channels&&(n.channels="all"),d.sanitizeChannels(n.channels).forEach(r=>{this.channels[r].setModulationRange(e,t,n)}),this}setMasterTuning(e,t={},n={}){if(d.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),d.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].setMasterTuning(e,t)}),this}setTuningProgram(e,t={},n={}){if(d.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),d.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].setTuningProgram(e,t)}),this}setTuningBank(e,t={},n={}){if(d.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),d.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].setTuningBank(e,t)}),this}sendChannelMode(e,t,n={},r={}){if(d.validation&&(Array.isArray(n)||Number.isInteger(n)||"all"===n)){let e=n;(n=r).channels=e}return null==n.channels&&(n.channels="all"),d.sanitizeChannels(n.channels).forEach(r=>{this.channels[r].sendChannelMode(e,t,n)}),this}turnSoundOff(e={},t={}){if(d.validation&&(Array.isArray(e)||Number.isInteger(e)||"all"===e)){let n=e;(e=t).channels=n}return null==e.channels&&(e.channels="all"),d.sanitizeChannels(e.channels).forEach(t=>{this.channels[t].turnSoundOff(e)}),this}turnNotesOff(e={},t={}){if(d.validation&&(Array.isArray(e)||Number.isInteger(e)||"all"===e)){let n=e;(e=t).channels=n}return null==e.channels&&(e.channels="all"),d.sanitizeChannels(e.channels).forEach(t=>{this.channels[t].turnNotesOff(e)}),this}resetAllControllers(e={},t={}){if(d.validation&&(Array.isArray(e)||Number.isInteger(e)||"all"===e)){let n=e;(e=t).channels=n}return null==e.channels&&(e.channels="all"),d.sanitizeChannels(e.channels).forEach(t=>{this.channels[t].resetAllControllers(e)}),this}setPolyphonicMode(e,t={},n={}){if(d.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),d.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].setPolyphonicMode(e,t)}),this}setLocalControl(e,t={},n={}){if(d.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),d.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].setLocalControl(e,t)}),this}setOmniMode(e,t={},n={}){if(d.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),d.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].setOmniMode(e,t)}),this}setNonRegisteredParameter(e,t,n={},r={}){if(d.validation&&(Array.isArray(n)||Number.isInteger(n)||"all"===n)){let e=n;(n=r).channels=e}return null==n.channels&&(n.channels="all"),d.sanitizeChannels(n.channels).forEach(r=>{this.channels[r].setNonRegisteredParameter(e,t,n)}),this}incrementRegisteredParameter(e,t={},n={}){if(d.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),d.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].incrementRegisteredParameter(e,t)}),this}decrementRegisteredParameter(e,t={},n={}){if(d.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),d.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].decrementRegisteredParameter(e,t)}),this}sendNoteOff(e,t={},n={}){if(d.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),d.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].sendNoteOff(e,t)}),this}stopNote(e,t){return this.sendNoteOff(e,t)}playNote(e,t={},n={}){if(d.validation&&(t.rawVelocity&&console.warn("The 'rawVelocity' option is deprecated. Use 'rawAttack' instead."),t.velocity&&console.warn("The 'velocity' option is deprecated. Use 'velocity' instead."),Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),d.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].playNote(e,t)}),this}sendNoteOn(e,t={},n={}){if(d.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),d.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].sendNoteOn(e,t)}),this}get name(){return this._midiOutput.name}get id(){return this._midiOutput.id}get connection(){return this._midiOutput.connection}get manufacturer(){return this._midiOutput.manufacturer}get state(){return this._midiOutput.state}get type(){return this._midiOutput.type}}class u{constructor(e,t={}){Number.isInteger(e)?this.number=e:this.name=e,this.duration=null==t.duration?1/0:t.duration,this.attack=null==t.attack?.5:t.attack,this.release=null==t.release?.5:t.release,null!=t.rawAttack&&(this.rawAttack=t.rawAttack),null!=t.rawRelease&&(this.rawRelease=t.rawRelease)}get name(){return d.NOTES[this._number%12]+d.getOctave(this.number)}set name(e){if(d.validation&&!1===d.guessNoteNumber(e))throw new Error("Invalid note name.");this._number=d.guessNoteNumber(e)}get number(){return this._number}set number(e){if(d.validation&&!1===d.guessNoteNumber(e))throw new Error("Invalid note number.");this._number=d.guessNoteNumber(e)}get duration(){return this._duration}set duration(e){if(d.validation&&(e=parseFloat(e),isNaN(e)||null===e||e<0))throw new RangeError("Invalid duration.");this._duration=e}get attack(){return this._rawAttack/127}set attack(e){if(d.validation&&(e=parseFloat(e),isNaN(e)||null===e||!(e>=0&&e<=1)))throw new RangeError("Invalid attack value.");this._rawAttack=Math.round(127*e)}get rawAttack(){return this._rawAttack}set rawAttack(e){if(d.validation&&(e=parseFloat(e),isNaN(e)||null===e||!(e>=0&&e<=127)))throw new RangeError("Invalid rawAttack value.");this._rawAttack=e}get release(){return this._rawRelease/127}set release(e){if(d.validation&&(e=parseFloat(e),isNaN(e)||null===e||!(e>=0&&e<=1)))throw new RangeError("Invalid release value.");this._rawRelease=Math.round(127*e)}get rawRelease(){return this._rawRelease}set rawRelease(e){if(d.validation&&(e=parseFloat(e),isNaN(e)||null===e||!(e>=0&&e<=127)))throw new RangeError("Invalid rawRelease value.");this._rawRelease=e}get octave(){return Math.floor(Math.floor(this._number)/12-1)}}n.Note=u;const d=new class extends a{constructor(){super(),this.interface=null,this.validation=!0,this._inputs=[],this._outputs=[],this._stateChangeQueue=[],this._octaveOffset=0}async enable(e={},t=!1){if(this.enabled)return Promise.resolve();this.validation=!1!==e.validation,this.validation&&("function"==typeof e&&(e={callback:e,sysex:t}),t&&(e.sysex=!0));try{this.interface=await navigator.requestMIDIAccess({sysex:e.sysex,software:e.software})}catch(t){return"function"==typeof e.callback&&e.callback(t),Promise.reject(t)}let n={timestamp:this.time,target:this,type:"enabled"};this.emit("enabled",n),"function"==typeof e.callback&&e.callback(),this.interface.onstatechange=this._onInterfaceStateChange.bind(this);try{let e=await this._updateInputsAndOutputs();return Promise.resolve({inputs:e[0],outputs:e[1]})}catch(e){return Promise.reject(e)}}async disable(){return this._destroyInputsAndOutputs().then(()=>{"function"==typeof navigator.close&&navigator.close(),this.interface&&(this.interface.onstatechange=void 0),this.interface=null;let e={timestamp:this.time,target:this,type:"disabled"};this.emit("disabled",e),this.removeListener()})}getInputById(e){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return!1}for(let t=0;t<this.inputs.length;t++)if(this.inputs[t].id===e.toString())return this.inputs[t];return!1}getInputByName(e){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return!1;e=e.toString()}for(let t=0;t<this.inputs.length;t++)if(~this.inputs[t].name.indexOf(e))return this.inputs[t];return!1}getOutputByName(e){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return!1;e=e.toString()}for(let t=0;t<this.outputs.length;t++)if(~this.outputs[t].name.indexOf(e))return this.outputs[t];return!1}getOutputById(e){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return!1}for(let t=0;t<this.outputs.length;t++)if(this.outputs[t].id===e.toString())return this.outputs[t];return!1}getNoteNumberByName(e){this.validation&&"string"!=typeof e&&(e="");let t=e.match(/([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)/i);if(!t)return!1;let n={C:0,D:2,E:4,F:5,G:7,A:9,B:11}[t[1].toUpperCase()],r=12*(parseInt(t[3])+1-Math.floor(this.octaveOffset))+n;return t[2].toLowerCase().indexOf("b")>-1?r-=t[2].length:t[2].toLowerCase().indexOf("#")>-1&&(r+=t[2].length),!(r<0||r>127)&&r}noteNameToNumber(e){return console.warn("The noteNameToNumber() method has been deprecated. Use getNoteNumberByName() instead."),this.getNoteNumberByName(e)}getOctave(e){return this.validation&&(e=parseInt(e)),!isNaN(e)&&e>=0&&e<=127&&Math.floor(e/12-1)+this.octaveOffset}sanitizeChannels(e){let t;if(this.validation)if("all"===e)t=["all"];else if("none"===e)return[];return t=Array.isArray(e)?e:[e],t.indexOf("all")>-1&&(t=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),t.map((function(e){return parseInt(e)})).filter((function(e){return e>=1&&e<=16}))}toMIDIChannels(e){return this.validation&&console.warn("The toMIDIChannels() method has been deprecated. Use sanitizeChannels() instead."),this.sanitizeChannels(e)}guessNoteNumber(e){let t=!1;return Number.isInteger(e)&&e>=0&&e<=127||parseInt(e)>=0&&parseInt(e)<=127?t=parseInt(e):("string"==typeof e||e instanceof String)&&(t=this.getNoteNumberByName(e)),!1!==t&&t}getValidNoteArray(e,t={}){let n=[];return Array.isArray(e)||(e=[e]),e.forEach(e=>{n.push(this.getNoteObject(e,t))}),n}getNoteObject(e,t){if(e instanceof u)return e;{let n=this.guessNoteNumber(e);if(!1!==n)return new u(n,t);throw new TypeError(`The input could not be parsed as a note (${e})`)}}convertToTimestamp(e){let t=!1,n=parseFloat(e);return!isNaN(n)&&("string"==typeof e&&"+"===e.substring(0,1)?n>=0&&(t=this.time+n):n>=0&&(t=n),t)}async _destroyInputsAndOutputs(){let e=[];return this.inputs.forEach(t=>e.push(t.destroy())),this.outputs.forEach(t=>e.push(t.destroy())),Promise.all(e).then(()=>{this._inputs=[],this._outputs=[]})}_onInterfaceStateChange(e){this._updateInputsAndOutputs();let t={timestamp:e.timeStamp,type:e.port.state};this.interface&&"connected"===e.port.state?"output"===e.port.type?(t.port=this.getOutputById(e.port.id),t.target=t.port):"input"===e.port.type&&(t.port=this.getInputById(e.port.id),t.target=t.port):(t.port={connection:"closed",id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},t.target=t.port),this.emit(e.port.state,t)}async _updateInputsAndOutputs(){return Promise.all([this._updateInputs(),this._updateOutputs()])}async _updateInputs(){let e=[];for(let e=0;e<this._inputs.length;e++){let t=!0,n=this.interface.inputs.values();for(let r=n.next();r&&!r.done;r=n.next())if(this._inputs[e]._midiInput===r.value){t=!1;break}t&&this._inputs.splice(e,1)}return this.interface&&this.interface.inputs.forEach(t=>{let n=!0;for(let e=0;e<this._inputs.length;e++)this._inputs[e]._midiInput===t&&(n=!1);if(n){let n=new s(t);this._inputs.push(n),e.push(n.open())}}),Promise.all(e)}async _updateOutputs(){let e=[];for(let e=0;e<this._outputs.length;e++){let t=!0,n=this.interface.outputs.values();for(let r=n.next();r&&!r.done;r=n.next())if(this._outputs[e]._midiOutput===r.value){t=!1;break}t&&(this._outputs[e].close(),this._outputs.splice(e,1))}return this.interface&&this.interface.outputs.forEach(t=>{let n=!0;for(let e=0;e<this._outputs.length;e++)this._outputs[e]._midiOutput===t&&(n=!1);if(n){let n=new l(t);this._outputs.push(n),e.push(n.open())}}),Promise.all(e)}get enabled(){return null!==this.interface}get inputs(){return this._inputs}get isNode(){return"[object process]"===Object.prototype.toString.call(void 0!==r?r:0)}get isBrowser(){return"undefined"!=typeof window&&void 0!==window.document}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be a valid number.");this._octaveOffset=e}get outputs(){return this._outputs}get supported(){return"undefined"!=typeof navigator&&navigator.requestMIDIAccess}get sysexEnabled(){return!(!this.interface||!this.interface.sysexEnabled)}get time(){return performance.now()}get MIDI_CHANNEL_VOICE_MESSAGES(){return{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,channelmode:11,nrpn:11,programchange:12,channelaftertouch:13,pitchbend:14}}get MIDI_CHANNEL_MESSAGES(){return console.warn("MIDI_CHANNEL_MESSAGES has been deprecated. Use MIDI_CHANNEL_VOICE_MESSAGES instead."),this.MIDI_CHANNEL_VOICE_MESSAGES}get MIDI_CHANNEL_MODE_MESSAGES(){return{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127}}get MIDI_CONTROL_CHANGE_MESSAGES(){return{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101}}get MIDI_INTERFACE_EVENTS(){return["connected","disconnected"]}get MIDI_NRPN_MESSAGES(){return{entrymsb:6,entrylsb:38,increment:96,decrement:97,paramlsb:98,parammsb:99,nullactiveparameter:127}}get MIDI_REGISTERED_PARAMETER(){return{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]}}get MIDI_SYSTEM_MESSAGES(){return{sysex:240,timecode:241,songposition:242,songselect:243,tunerequest:246,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1}}get NOTES(){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"]}};n.WebMidi=d,d.constructor=null},{process:"ac6430a7e94322e886e4eb7d76499fba"}],ac6430a7e94322e886e4eb7d76499fba:[function(e,t,n){var r,a,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function c(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{a="function"==typeof clearTimeout?clearTimeout:s}catch(e){a=s}}();var l,u=[],d=!1,h=-1;function f(){d&&l&&(d=!1,l.length?u=l.concat(u):h=-1,u.length&&p())}function p(){if(!d){var e=c(f);d=!0;for(var t=u.length;t;){for(l=u,u=[];++h<t;)l&&l[h].run();h=-1,t=u.length}l=null,d=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===s||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new m(e,t)),1!==u.length||d||c(p)},m.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],af0b8472eefa4fe4e4000c4e9ae1bf1f:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.tapTempo=n.stopTimer=n.startTimer=n.setTimeBetween=n.setBPM=n.now=n.setBars=n.getBars=n.getBPM=n.getBarProgress=n.getBar=n.timePerBar=n.MAX_BARS_ALLOWED=n.EVENT_TICK=n.EVENT_STOPPING=n.EVENT_STARTING=n.EVENT_READY=n.CMD_UPDATE=n.CMD_STOP=n.CMD_START=void 0;n.CMD_START="start";n.CMD_STOP="stop";n.CMD_UPDATE="update";n.EVENT_READY="ready";n.EVENT_STARTING="starting";n.EVENT_STOPPING="stopping";n.EVENT_TICK="tick";n.MAX_BARS_ALLOWED=32;const r=window.AudioContext||window.webkitAudioContext,a=new Worker(e("data-url:./timing.settimeout.worker.js"));let i=-1,o=1,s=null,c=!1,l=0,u=16,d=0;const h=()=>2403/u;n.timePerBar=h;n.getBar=()=>l;n.getBarProgress=()=>l/u;n.getBPM=()=>6e4/h();n.getBars=()=>u;n.setBars=e=>(u=e<1?1:e>32?32:e,u);const f=()=>s.currentTime;n.now=f;n.setBPM=e=>(o=6e4/e,a.postMessage({command:"update",interval:o,time:f()}),o);n.setTimeBetween=e=>(o=e,a.postMessage({command:"update",interval:o,time:f()}),o);n.startTimer=(e,t=200,n={})=>(d=0,null===s&&(s=new r,"suspended"===s.state&&s.resume()),o=t,a.onmessage=n=>{const r=f(),a=n.data;switch(a.event){case"starting":a.time;i=r,c=!0;break;case"tick":const o=a.intervals,s=o*t*.001,h=r-i,f=a.time,p=f%t*.001,m=f-h,g=Math.floor(f/t);l=++d%u,e&&e({bar:l,bars:u,barsElapsed:d,timePassed:f,elapsed:h,expected:s,drift:m,level:g,intervals:o,lag:p});break;default:console.log("message: ",n)}},a.onerror=e=>{console.error("error...",{error:e}),a.postMessage({error:e,time:s.currentTime})},a.postMessage({command:"start",time:s.currentTime,interval:t,accurateTiming:!1}),{currentTime:f(),timingWorker:a});n.stopTimer=()=>{const e=f();return a.onmessage=e=>{switch(e.event){case"stopping":c=!1,s=null}},a.postMessage({command:"stop",time:e}),{currentTime:f(),timingWorker:a}};let p=[];n.tapTempo=(e=!0,t=1e4)=>{const n=Date.now();e&&p.length>0&&n-p[p.length-1]>t&&(p=[]),p.push(n);const r=p.length,a=r-1,i=p[a]-p[0];if(r>=2){return i/a}return-1}},{"data-url:./timing.settimeout.worker.js":"bddfcb7e7ce73ad3f1517f038ee0d2a9"}],bddfcb7e7ce73ad3f1517f038ee0d2a9:[function(e,t,n){t.exports="data:application/javascript,!function(e%2Ct%2Cn%2Co)%7Bvar%20r%3D%22undefined%22!%3Dtypeof%20globalThis%3FglobalThis%3A%22undefined%22!%3Dtypeof%20self%3Fself%3A%22undefined%22!%3Dtypeof%20window%3Fwindow%3A%22undefined%22!%3Dtypeof%20global%3Fglobal%3A%7B%7D%2Ci%3D%22function%22%3D%3Dtypeof%20r.parcelRequire%26%26r.parcelRequire%2Ca%3D%22undefined%22!%3Dtypeof%20module%26%26%22function%22%3D%3Dtypeof%20module.require%26%26module.require.bind(module)%3Bfunction%20s(n%2Co)%7Bif(!t%5Bn%5D)%7Bif(!e%5Bn%5D)%7Bvar%20r%3D%22function%22%3D%3Dtypeof%20parcelRequire%26%26parcelRequire%3Bif(!o%26%26r)return%20r(n%2C!0)%3Bif(i)return%20i(n%2C!0)%3Bif(a%26%26%22string%22%3D%3Dtypeof%20n)return%20a(n)%3Bvar%20f%3Dnew%20Error(%22Cannot%20find%20module%20'%22%2Bn%2B%22'%22)%3Bthrow%20f.code%3D%22MODULE_NOT_FOUND%22%2Cf%7Dc.resolve%3Dfunction(t)%7Breturn%20e%5Bn%5D%5B1%5D%5Bt%5D%7C%7Ct%7D%2Cc.cache%3D%7B%7D%3Bvar%20u%3Dt%5Bn%5D%3Dnew%20s.Module(n)%3Be%5Bn%5D%5B0%5D.call(u.exports%2Cc%2Cu%2Cu.exports%2Cthis)%7Dreturn%20t%5Bn%5D.exports%3Bfunction%20c(e)%7Breturn%20s(c.resolve(e))%7D%7Ds.isParcelRequire%3D!0%2Cs.Module%3Dfunction(e)%7Bthis.id%3De%2Cthis.bundle%3Ds%2Cthis.exports%3D%7B%7D%7D%2Cs.modules%3De%2Cs.cache%3Dt%2Cs.parent%3Di%2Cs.register%3Dfunction(t%2Cn)%7Be%5Bt%5D%3D%5Bfunction(e%2Ct)%7Bt.exports%3Dn%7D%2C%7B%7D%5D%7D%2Cr.parcelRequire%3Ds%3Bfor(var%20f%3D0%3Bf%3Cn.length%3Bf%2B%2B)s(n%5Bf%5D)%3Bif(n.length)%7Bvar%20u%3Ds(n%5Bn.length-1%5D)%3B%22object%22%3D%3Dtypeof%20exports%26%26%22undefined%22!%3Dtypeof%20module%3Fmodule.exports%3Du%3A%22function%22%3D%3Dtypeof%20define%26%26define.amd%26%26define((function()%7Breturn%20u%7D))%7D%7D(%7Bd794e24c4eb1ab253cc424f8e93002fc%3A%5Bfunction(e%2Ct%2Cn)%7Blet%20o%3Dnull%2Cr%3D!1%2Ci%3D-1%2Ca%3D-1%2Cs%3D-1%2Cf%3D0%2Cu%3D!0%3Bconst%20c%3D()%3D%3Eperformance.now()%2Cl%3D()%3D%3E.001*(c()-i)%2Cd%3De%3D%3E%7Bo%3DsetTimeout(()%3D%3E%7Bconst%20t%3Df*s*.001%2Cn%3Dl()%2Co%3Dt-n%3Ba%3Dc()%2Cf%2B%2B%2CpostMessage(%7Bevent%3A%22tick%22%2Ctime%3An%2Cintervals%3Af%7D)%3Bd(u%3Fe%2Bo%3Ae)%7D%2Ce)%7D%2Cp%3D(e%3D250)%3D%3E%7Br%26%26clearInterval(o)%2Cr%7C%7C(i%3Dc()%2Cr%3D!0%2CpostMessage(%7Bevent%3A%22starting%22%2Ctime%3A0%7D))%2Cs%3De%2Cd(s)%2CpostMessage(%7Bevent%3A%22tick%22%2Ctime%3Al()%2Cintervals%3Af%7D)%7D%3Bself.onmessage%3De%3D%3E%7Bconst%20t%3De.data%3Bswitch(t.command)%7Bcase%22start%22%3Au%3Dt.accurateTiming%7C%7C!1%2Cp(t.interval)%3Bbreak%3Bcase%22stop%22%3AclearInterval(o)%2Co%3Dnull%2Cr%3D!1%2CpostMessage(%7Bevent%3A%22stopping%22%2Ctime%3Al()%2Cintervals%3Af%7D)%3Bbreak%3Bcase%22update%22%3Ap(t.interval)%7D%7D%7D%2C%7B%7D%5D%7D%2C%7B%7D%2C%5B%22d794e24c4eb1ab253cc424f8e93002fc%22%5D)%3B"},{}],"5f3eb9e0efedd749e3ce8ece8e7af807":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.drawElement=n.copyCanvasToClipboard=n.overdraw=n.clear=n.getCanvasDimensions=n.updateCanvasSize=n.canvasContext=n.canvas=void 0;const r=document.querySelector("canvas");n.canvas=r;const a=r.getContext("2d");n.canvasContext=a;let i=r.width,o=r.height;n.updateCanvasSize=(e,t)=>{i=e||r.width,o=t||r.height};n.getCanvasDimensions=()=>({width:i,height:o});n.clear=()=>{a.clearRect(0,0,i,o)};n.overdraw=(e=0,t=-1)=>{a.save(),a.drawImage(r,e,t),a.restore()};n.copyCanvasToClipboard=async()=>r.toBlob(async e=>{await navigator.clipboard.write([new ClipboardItem({[e.type]:e})])});n.drawElement=e=>{a.save(),a.translate(i,0),a.scale(-1,1),a.drawImage(e,0,0),a.restore()}},{}],"3f5dc1d45338b40d52343cf73ba2ceeb":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.drawFace=n.drawFaceMesh=n.drawPoints=n.setNodeCount=n.drawBoundingBox=n.drawInstrument=n.drawParagraph=n.drawText=n.drawMouth=n.drawNode=n.drawTriangle=n.drawEye=n.drawPart=n.takePhotograph=n.setupImage=void 0;var r=e("../maths"),a=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=s();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var i=r?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}n.default=e,t&&t.set(e,n);return n}(e("../palette")),i=e("./canvas"),o=e("./face");function s(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return s=function(){return e},e}n.setupImage=async e=>new Promise(async(t,n)=>{const r=()=>{e.width=e.naturalWidth,e.height=e.naturalHeight};e.naturalWidth>0?(r(),t(e)):(e.onloaded=()=>{r(),t(e)},e.onerror=e=>n(e))});n.takePhotograph=(e="image/png")=>i.canvas.toDataURL(e);n.drawPart=(e,t=4,n="red",a=!0)=>{i.canvasContext.fillStyle=n,i.canvasContext.strokeStyle=n,i.canvasContext.moveTo(e[0][0],e[0][1]),i.canvasContext.beginPath();for(let n=0,o=e.length;n<o;n++){const o=e[n][0],s=e[n][1];i.canvasContext.arc(o,s,t,0,r.TAU),a&&i.canvasContext.lineTo(o,s)}i.canvasContext.fill(),a&&i.canvasContext.stroke()};n.drawEye=(e,t="blue")=>{const n=e[0],a=e[1],o=e[2],s=e[3],c=e[4];i.canvasContext.strokeWidth=0;i.canvasContext.beginPath(),i.canvasContext.fillStyle=t,i.canvasContext.arcTo(o[0],o[1],a[0],a[1],6),i.canvasContext.arcTo(a[0],a[1],c[0],c[1],6),i.canvasContext.arcTo(c[0],c[1],s[0],s[1],6),i.canvasContext.arcTo(s[0],s[1],o[0],o[1],6),i.canvasContext.fill();i.canvasContext.beginPath(),i.canvasContext.fillStyle="black",i.canvasContext.arc(n[0],n[1],2,0,r.TAU),i.canvasContext.fill()};const c=(e,t,n,r,a,o,s)=>{i.canvasContext.beginPath(),i.canvasContext.moveTo(e,t),i.canvasContext.lineTo(n,r),i.canvasContext.lineTo(a,o),i.canvasContext.closePath(),i.canvasContext.lineWidth=1,i.canvasContext.strokeStyle=s,i.canvasContext.stroke()};n.drawTriangle=c;const l=(e,t,n=5,o="blue",s=!1)=>{i.canvasContext.fillStyle=o,i.canvasContext.beginPath(),i.canvasContext.arc(t[0],t[1],n,0,r.TAU),i.canvasContext.fill(),i.canvasContext.beginPath(),i.canvasContext.arc(e[0],e[1],n,0,r.TAU),i.canvasContext.fill(),i.canvasContext.beginPath(),i.canvasContext.moveTo(e[0],e[1]),i.canvasContext.strokeStyle="orange",i.canvasContext.fillStyle="orange",i.canvasContext.lineTo(t[0],t[1]),s&&(i.canvasContext.stroke(),i.canvasContext.fillStyle=a.default.blue,i.canvasContext.font="12px Oxanium",i.canvasContext.textAlign="center",i.canvasContext.fillText(Math.floor(mouthRange)+"px",e[0],e[1]-20))};n.drawNode=l;const u=(e,t="yellow",n=!0)=>{const{annotations:r,mouthRange:o,mouthWidth:s,mouthOpen:c}=e,{lipsUpperInner:u,lipsLowerInner:d}=r,h=[u,d],f=u[5],p=d[5],m=i.canvasContext.createLinearGradient(0,0,s,o);m.addColorStop(0,t),m.addColorStop(.5,a.default.dark),m.addColorStop(1,t),i.canvasContext.beginPath(),i.canvasContext.moveTo(u[0][0],u[0][1]),i.canvasContext.fillStyle=m;for(let e=0,t=h.length;e<t;e++){const t=h[e];for(let e=0,n=t.length;e<n;e++){const n=t[e][0],r=t[e][1];i.canvasContext.lineTo(n,r)}}return i.canvasContext.fill(),n&&l(p,f,5),{lipUpperMiddle:f,lipLowerMiddle:p}};n.drawMouth=u;const d=(e,t,n="",r="10px",o="center")=>{i.canvasContext.font=`900 ${r} Oxanium`,i.canvasContext.textAlign=o,i.canvasContext.fillStyle=a.default.white,i.canvasContext.strokeStyle=a.default.dark,i.canvasContext.strokeText(""+n,e,t),i.canvasContext.fillText(""+n,e,t)};n.drawText=d;n.drawParagraph=(e,t,n=[],r="8px",a=20)=>{let i=t;for(const t of n)d(e,i,t,r,"left"),i+=a};n.drawInstrument=(e,t,n="")=>{const{bottomRight:r,topLeft:a}=e,i=`${t.toUpperCase()} - ${n}`;d(a[0],a[1],i,"24px")};n.drawBoundingBox=(e,t="red")=>{const{bottomRight:n,topLeft:r}=e;i.canvasContext.beginPath(),i.canvasContext.fillStyle=t,i.canvasContext.strokeRect(r[0],r[1],n[0],n[1]),i.canvasContext.fill()};const h=r.easeInQuad;let f=0;n.setNodeCount=e=>f+=e;let p=0;n.drawPoints=(e,t=60,n=3,o=!1,s=!0)=>{const{scaledMesh:c}=e,l=c.length;for(let e=0;e<l;e++){const u=c[e][0],d=c[e][1],m=1-(c[e][2]+45)/45,g=(0,r.clamp)(n*h(m),1,n),b=(0,r.clamp)(m,.5,1);if(i.canvasContext.beginPath(),s&&e===f%l)i.canvasContext.stroke(),i.canvasContext.font="22px Oxanium",i.canvasContext.textAlign="center",i.canvasContext.fillStyle=a.default.dark,i.canvasContext.fillText("#"+e,u+g+1,d),i.canvasContext.fillStyle="hsla(0,90%,70%,1)",i.canvasContext.arc(u,d,3*g,0,r.TAU);else{const n=o?(p+++t+360*e/l)%360:t;i.canvasContext.fillStyle=`hsla(${n},70%,50%,${b})`,i.canvasContext.arc(u,d,g,0,r.TAU)}i.canvasContext.fill()}};n.drawFaceMesh=(e,t=60,n=3,r=!0,a=!0)=>{const{scaledMesh:i}=e;for(let e=0,n=o.TRIANGLE_MATRIX.length-2;e<n;e+=3){const a=i[o.TRIANGLE_MATRIX[e]],s=i[o.TRIANGLE_MATRIX[e+1]],l=i[o.TRIANGLE_MATRIX[e+2]],u=`hsla(${r?(t+360*e/n)%360:t},70%,50%,0.4)`;c(a[0],a[1],s[0],s[1],l[0],l[1],u)}};n.drawFace=(e,t=a.DEFAULT_COLOURS,n=!1,r=!1,i=!1)=>{const{annotations:o}=e;u(e,r&&n?t.mouth:t.mouthClosed,i)}},{"../maths":"b35d1feb9582910dececcb2468237235","../palette":"4c4f18d38f1111efa08d8ccdf0962cfd","./canvas":"5f3eb9e0efedd749e3ce8ece8e7af807","./face":"2853dfb697b468730d87ad1ac9a3e821"}],"2853dfb697b468730d87ad1ac9a3e821":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TRIANGLE_MATRIX=void 0;n.TRIANGLE_MATRIX=[127,34,139,11,0,37,232,231,120,72,37,39,128,121,47,232,121,128,104,69,67,175,171,148,157,154,155,118,50,101,73,39,40,9,151,108,48,115,131,194,204,211,74,40,185,80,42,183,40,92,186,230,229,118,202,212,214,83,18,17,76,61,146,160,29,30,56,157,173,106,204,194,135,214,192,203,165,98,21,71,68,51,45,4,144,24,23,77,146,91,205,50,187,201,200,18,91,106,182,90,91,181,85,84,17,206,203,36,148,171,140,92,40,39,193,189,244,159,158,28,247,246,161,236,3,196,54,68,104,193,168,8,117,228,31,189,193,55,98,97,99,126,47,100,166,79,218,155,154,26,209,49,131,135,136,150,47,126,217,223,52,53,45,51,134,211,170,140,67,69,108,43,106,91,230,119,120,226,130,247,63,53,52,238,20,242,46,70,156,78,62,96,46,53,63,143,34,227,173,155,133,123,117,111,44,125,19,236,134,51,216,206,205,154,153,22,39,37,167,200,201,208,36,142,100,57,212,202,20,60,99,28,158,157,35,226,113,160,159,27,204,202,210,113,225,46,43,202,204,62,76,77,137,123,116,41,38,72,203,129,142,64,98,240,49,102,64,41,73,74,212,216,207,42,74,184,169,170,211,170,149,176,105,66,69,122,6,168,123,147,187,96,77,90,65,55,107,89,90,180,101,100,120,63,105,104,93,137,227,15,86,85,129,102,49,14,87,86,55,8,9,100,47,121,145,23,22,88,89,179,6,122,196,88,95,96,138,172,136,215,58,172,115,48,219,42,80,81,195,3,51,43,146,61,171,175,199,81,82,38,53,46,225,144,163,110,246,33,7,52,65,66,229,228,117,34,127,234,107,108,69,109,108,151,48,64,235,62,78,191,129,209,126,111,35,143,163,161,246,117,123,50,222,65,52,19,125,141,221,55,65,3,195,197,25,7,33,220,237,44,70,71,139,122,193,245,247,130,33,71,21,162,153,158,159,170,169,150,188,174,196,216,186,92,144,160,161,2,97,167,141,125,241,164,167,37,72,38,12,145,159,160,38,82,13,63,68,71,226,35,111,158,153,154,101,50,205,206,92,165,209,198,217,165,167,97,220,115,218,133,112,243,239,238,241,214,135,169,190,173,133,171,208,32,125,44,237,86,87,178,85,86,179,84,85,180,83,84,181,201,83,182,137,93,132,76,62,183,61,76,184,57,61,185,212,57,186,214,207,187,34,143,156,79,239,237,123,137,177,44,1,4,201,194,32,64,102,129,213,215,138,59,166,219,242,99,97,2,94,141,75,59,235,24,110,228,25,130,226,23,24,229,22,23,230,26,22,231,112,26,232,189,190,243,221,56,190,28,56,221,27,28,222,29,27,223,30,29,224,247,30,225,238,79,20,166,59,75,60,75,240,147,177,215,20,79,166,187,147,213,112,233,244,233,128,245,128,114,188,114,217,174,131,115,220,217,198,236,198,131,134,177,132,58,143,35,124,110,163,7,228,110,25,356,389,368,11,302,267,452,350,349,302,303,269,357,343,277,452,453,357,333,332,297,175,152,377,384,398,382,347,348,330,303,304,270,9,336,337,278,279,360,418,262,431,304,408,409,310,415,407,270,409,410,450,348,347,422,430,434,313,314,17,306,307,375,387,388,260,286,414,398,335,406,418,364,367,416,423,358,327,251,284,298,281,5,4,373,374,253,307,320,321,425,427,411,421,313,18,321,405,406,320,404,405,315,16,17,426,425,266,377,400,369,322,391,269,417,465,464,386,257,258,466,260,388,456,399,419,284,332,333,417,285,8,346,340,261,413,441,285,327,460,328,355,371,329,392,439,438,382,341,256,429,420,360,364,394,379,277,343,437,443,444,283,275,440,363,431,262,369,297,338,337,273,375,321,450,451,349,446,342,467,293,334,282,458,461,462,276,353,383,308,324,325,276,300,293,372,345,447,382,398,362,352,345,340,274,1,19,456,248,281,436,427,425,381,256,252,269,391,393,200,199,428,266,330,329,287,273,422,250,462,328,258,286,384,265,353,342,387,259,257,424,431,430,342,353,276,273,335,424,292,325,307,366,447,345,271,303,302,423,266,371,294,455,460,279,278,294,271,272,304,432,434,427,272,407,408,394,430,431,395,369,400,334,333,299,351,417,168,352,280,411,325,319,320,295,296,336,319,403,404,330,348,349,293,298,333,323,454,447,15,16,315,358,429,279,14,15,316,285,336,9,329,349,350,374,380,252,318,402,403,6,197,419,318,319,325,367,364,365,435,367,397,344,438,439,272,271,311,195,5,281,273,287,291,396,428,199,311,271,268,283,444,445,373,254,339,263,466,249,282,334,296,449,347,346,264,447,454,336,296,299,338,10,151,278,439,455,292,407,415,358,371,355,340,345,372,390,249,466,346,347,280,442,443,282,19,94,370,441,442,295,248,419,197,263,255,359,440,275,274,300,383,368,351,412,465,263,467,466,301,368,389,380,374,386,395,378,379,412,351,419,436,426,322,373,390,388,2,164,393,370,462,461,164,0,267,302,11,12,374,373,387,268,12,13,293,300,301,446,261,340,385,384,381,330,266,425,426,423,391,429,355,437,391,327,326,440,457,438,341,382,362,459,457,461,434,430,394,414,463,362,396,369,262,354,461,457,316,403,402,315,404,403,314,405,404,313,406,405,421,418,406,366,401,361,306,408,407,291,409,408,287,410,409,432,436,410,434,416,411,264,368,383,309,438,457,352,376,401,274,275,4,421,428,262,294,327,358,433,416,367,289,455,439,462,370,326,2,326,370,305,460,455,254,449,448,255,261,446,253,450,449,252,451,450,256,452,451,341,453,452,413,464,463,441,413,414,258,442,441,257,443,442,259,444,443,260,445,444,467,342,445,459,458,250,289,392,290,290,328,460,376,433,435,250,290,392,411,416,433,341,463,464,453,464,465,357,465,412,343,412,399,360,363,440,437,399,456,420,456,363,401,435,288,372,383,353,339,255,249,448,261,255,133,243,190,133,155,112,33,246,247,33,130,25,398,384,286,362,398,414,362,463,341,263,359,467,263,249,255,466,467,260,75,60,166,238,239,79,162,127,139,72,11,37,121,232,120,73,72,39,114,128,47,233,232,128,103,104,67,152,175,148,173,157,155,119,118,101,74,73,40,107,9,108,49,48,131,32,194,211,184,74,185,191,80,183,185,40,186,119,230,118,210,202,214,84,83,17,77,76,146,161,160,30,190,56,173,182,106,194,138,135,192,129,203,98,54,21,68,5,51,4,145,144,23,90,77,91,207,205,187,83,201,18,181,91,182,180,90,181,16,85,17,205,206,36,176,148,140,165,92,39,245,193,244,27,159,28,30,247,161,174,236,196,103,54,104,55,193,8,111,117,31,221,189,55,240,98,99,142,126,100,219,166,218,112,155,26,198,209,131,169,135,150,114,47,217,224,223,53,220,45,134,32,211,140,109,67,108,146,43,91,231,230,120,113,226,247,105,63,52,241,238,242,124,46,156,95,78,96,70,46,63,116,143,227,116,123,111,1,44,19,3,236,51,207,216,205,26,154,22,165,39,167,199,200,208,101,36,100,43,57,202,242,20,99,56,28,157,124,35,113,29,160,27,211,204,210,124,113,46,106,43,204,96,62,77,227,137,116,73,41,72,36,203,142,235,64,240,48,49,64,42,41,74,214,212,207,183,42,184,210,169,211,140,170,176,104,105,69,193,122,168,50,123,187,89,96,90,66,65,107,179,89,180,119,101,120,68,63,104,234,93,227,16,15,85,209,129,49,15,14,86,107,55,9,120,100,121,153,145,22,178,88,179,197,6,196,89,88,96,135,138,136,138,215,172,218,115,219,41,42,81,5,195,51,57,43,61,208,171,199,41,81,38,224,53,225,24,144,110,105,52,66,118,229,117,227,34,234,66,107,69,10,109,151,219,48,235,183,62,191,142,129,126,116,111,143,7,163,246,118,117,50,223,222,52,94,19,141,222,221,65,196,3,197,45,220,44,156,70,139,188,122,245,139,71,162,145,153,159,149,170,150,122,188,196,206,216,92,163,144,161,164,2,167,242,141,241,0,164,37,11,72,12,144,145,160,12,38,13,70,63,71,31,226,111,157,158,154,36,101,205,203,206,165,126,209,217,98,165,97,237,220,218,237,239,241,210,214,169,140,171,32,241,125,237,179,86,178,180,85,179,181,84,180,182,83,181,194,201,182,177,137,132,184,76,183,185,61,184,186,57,185,216,212,186,192,214,187,139,34,156,218,79,237,147,123,177,45,44,4,208,201,32,98,64,129,192,213,138,235,59,219,141,242,97,97,2,141,240,75,235,229,24,228,31,25,226,230,23,229,231,22,230,232,26,231,233,112,232,244,189,243,189,221,190,222,28,221,223,27,222,224,29,223,225,30,224,113,247,225,99,60,240,213,147,215,60,20,166,192,187,213,243,112,244,244,233,245,245,128,188,188,114,174,134,131,220,174,217,236,236,198,134,215,177,58,156,143,124,25,110,7,31,228,25,264,356,368,0,11,267,451,452,349,267,302,269,350,357,277,350,452,357,299,333,297,396,175,377,381,384,382,280,347,330,269,303,270,151,9,337,344,278,360,424,418,431,270,304,409,272,310,407,322,270,410,449,450,347,432,422,434,18,313,17,291,306,375,259,387,260,424,335,418,434,364,416,391,423,327,301,251,298,275,281,4,254,373,253,375,307,321,280,425,411,200,421,18,335,321,406,321,320,405,314,315,17,423,426,266,396,377,369,270,322,269,413,417,464,385,386,258,248,456,419,298,284,333,168,417,8,448,346,261,417,413,285,326,327,328,277,355,329,309,392,438,381,382,256,279,429,360,365,364,379,355,277,437,282,443,283,281,275,363,395,431,369,299,297,337,335,273,321,348,450,349,359,446,467,283,293,282,250,458,462,300,276,383,292,308,325,283,276,293,264,372,447,346,352,340,354,274,19,363,456,281,426,436,425,380,381,252,267,269,393,421,200,428,371,266,329,432,287,422,290,250,328,385,258,384,446,265,342,386,387,257,422,424,430,445,342,276,422,273,424,306,292,307,352,366,345,268,271,302,358,423,371,327,294,460,331,279,294,303,271,304,436,432,427,304,272,408,395,394,431,378,395,400,296,334,299,6,351,168,376,352,411,307,325,320,285,295,336,320,319,404,329,330,349,334,293,333,366,323,447,316,15,315,331,358,279,317,14,316,8,285,9,277,329,350,253,374,252,319,318,403,351,6,419,324,318,325,397,367,365,288,435,397,278,344,439,310,272,311,248,195,281,375,273,291,175,396,199,312,311,268,276,283,445,390,373,339,295,282,296,448,449,346,356,264,454,337,336,299,337,338,151,294,278,455,308,292,415,429,358,355,265,340,372,388,390,466,352,346,280,295,442,282,354,19,370,285,441,295,195,248,197,457,440,274,301,300,368,417,351,465,251,301,389,385,380,386,394,395,379,399,412,419,410,436,322,387,373,388,326,2,393,354,370,461,393,164,267,268,302,12,386,374,387,312,268,13,298,293,301,265,446,340,380,385,381,280,330,425,322,426,391,420,429,437,393,391,326,344,440,438,458,459,461,364,434,394,428,396,262,274,354,457,317,316,402,316,315,403,315,314,404,314,313,405,313,421,406,323,366,361,292,306,407,306,291,408,291,287,409,287,432,410,427,434,411,372,264,383,459,309,457,366,352,401,1,274,4,418,421,262,331,294,358,435,433,367,392,289,439,328,462,326,94,2,370,289,305,455,339,254,448,359,255,446,254,253,449,253,252,450,252,256,451,256,341,452,414,413,463,286,441,414,286,258,441,258,257,442,257,259,443,259,260,444,260,467,445,309,459,250,305,289,290,305,290,460,401,376,435,309,250,392,376,411,433,453,341,464,357,453,465,343,357,412,437,343,399,344,360,440,420,437,456,360,420,363,361,401,288,265,372,353,390,339,249,339,448,255]},{}],"7c55e8edc49408ae4872370083d15079":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.drawBars=n.drawWaves=void 0;var r=e("./canvas");!function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=a();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}n.default=e,t&&t.set(e,n)}(e("../palette"));function a(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return a=function(){return e},e}let i=0;const{width:o,height:s}=(0,r.getCanvasDimensions)();n.drawWaves=(e,t)=>{r.canvasContext.lineWidth=2,r.canvasContext.strokeStyle=`hsla(${i}, 100, 150, 0.5)`,r.canvasContext.beginPath(),i=i++%360;const n=1*o/t;let a=0;for(let i=0;i<t;i++){const t=e[i]/128*s/2;0===i?r.canvasContext.moveTo(a,t):r.canvasContext.lineTo(a,t),a+=n}r.canvasContext.lineTo(o,s/2),r.canvasContext.stroke()};n.drawBars=(e,t)=>{const n=o/t*2;let a,i=0;for(let o=0;o<t;o++)a=e[o],r.canvasContext.fillStyle="hsla("+a/s*360+",50%,50%,0.3)",r.canvasContext.fillRect(i,0,n,a),i+=n+1}},{"./canvas":"5f3eb9e0efedd749e3ce8ece8e7af807","../palette":"4c4f18d38f1111efa08d8ccdf0962cfd"}],"1c37ee1d40cab4f3081b573c35abb3a6":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.drawQuantise=void 0;var r=e("../maths"),a=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=o();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var i=r?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=e[a]}n.default=e,t&&t.set(e,n);return n}(e("../palette")),i=e("./canvas");function o(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return o=function(){return e},e}const{width:s,height:c}=(0,i.getCanvasDimensions)();n.drawQuantise=(e,t=-1,n=1,o=30,s=4)=>{const l=c/(n+1);for(let n=0,c=t+1;n<c;++n){let c=0,u=n*l+l;i.canvasContext.fillStyle=n===t?a.default.cream:a.default.orange,i.canvasContext.strokeStyle=n===t?a.default.orange:a.default.brown,i.canvasContext.strokeWidth=o,i.canvasContext.lineWidth=e&&n===t?8:4,i.canvasContext.beginPath(),i.canvasContext.arc(c,u,s,0,r.TAU),i.canvasContext.fill(),i.canvasContext.stroke()}}},{"../maths":"b35d1feb9582910dececcb2468237235","../palette":"4c4f18d38f1111efa08d8ccdf0962cfd","./canvas":"5f3eb9e0efedd749e3ce8ece8e7af807"}],"304d4d4cb53eafff77715335feb81f75":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.setupCamera=n.detectCameras=n.filterVideoCameras=void 0;n.filterVideoCameras=e=>e.filter(e=>"videoinput"===e.kind);n.detectCameras=async()=>navigator.mediaDevices.enumerateDevices();n.setupCamera=async(e,t)=>new Promise(async(n,r)=>{let a;(e=e||document.createElement("video")).onloadedmetadata=t=>{try{e.play(),e.width=e.videoWidth,e.height=e.videoHeight,n(a)}catch(e){r(a)}},e.onerror=e=>{console.error("VIDEO:Error",e),r(a)};const i={};t?i.deviceId={exact:t}:i.facingMode="user";const o={video:i,audio:!1};try{a=await navigator.mediaDevices.getUserMedia(o),e.srcObject=a}catch(e){r(e)}})},{}],"2846ae3be1a1a3fe3b66fd048499d96d":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.playNextPart=n.combinePatternWithInstrument=n.kitSequence=n.hatSequence=n.snareSequence=n.kickSequence=n.pattern=n.factory=n.createPattern=void 0;n.createPattern=(e,t=16)=>{new Array};n.factory=(e=16)=>new Array(4*e).fill(0);const r=(e,t=0)=>{let n=t;const r=e.length-1;return{reset:()=>(n=0,e[n]),previous:()=>{const t=n-1;return n=t<0?r:t,e[n]},next:()=>{const t=n+1;return n=t>r?0:t,e[n]},position:t=>e[t],length:e.length,current:()=>e[n],set:t=>e=t}};n.pattern=r;const a=[[255,0,0,0,255,0,0,0,255,0,0,0,255,0,0,0]],i=[[0,0,255,0,0,0,255,0,0,0,255,0,0,0,255,0]],o=new Array(16).map(e=>255*e/16),s=[[255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0]],c=r(a[0]);n.kickSequence=c;const l=r(i[0]);n.snareSequence=l;const u=r(s[0]);n.hatSequence=u;n.kitSequence=()=>({kick:r(a[0]),hat:r(s[0]),snare:r(i[0]),roll:r(o)});n.combinePatternWithInstrument=(e,t)=>{};n.playNextPart=(e,t,...n)=>{const r=e.next();return r>0&&(t(r,...n),!0)}},{}],"34612b22081aa381d2044c8f4b67a06c":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getNextInstruction=n.getInstruction=n.getHelp=n.INSTRUCTIONS=n.QUICK_START=void 0;const r=["Hello!","I'm looking for your pretty face","Look at me and open your mouth","Move your face close to the screen","Try and put it in the centre","I still cannot see you","Make sure you allowed the camera!"];n.QUICK_START=r;const a=["Welcome to the <strong>interFACE</strong>","Smile at the screen to begin...","Tilt your head forwards and backwards to change octave","Roll your head left and right to change pitch","Then open you mouth to make it louder!","Change instruments by closing both eyes for 1 bar","or by tapping your face on screen","to select an instrument from a list","hold your finger on your face for one bar to see all instruments","Facing left plays the black keys","Facing right plays the white keys","Use your eyes to shape the sound","Connect a MIDI instrument and click the MIDI button","In order to play the MIDI instrument with your head","You can change tempo using the arrow keys","Or just type a 3 digit number to set a BPM","Or tap the Q key in rhythm a few times","","","","","","","","","Hotkeys<br>(* means beta feature)","Type any three numbers to set the tempo","eg. 090 for 90BPM","eg. 120 for 120BPM","Arrow Up - add more bars","Arrow Down - remove a bar","Arrow Left - previous instrument","Arrow Right - next instrument","A - 808","B - Backing Percussion","C - Clear","D - Closed Hat","E - Clack","G - ","H - ","J - ","K - ","M - Metronome toggle on or off","Q - Quiet mode (mute / unmute)","R - Record*","S - Snare","T - Hide Instrument Text","V - Toggle video on screen","W - Cowbell","","","","","","","","","","","","","","","","","OMG I can't believe you are still here!","Secret Keys are as follows","CAPS Lock - developer debug","TAB - show more info on screen"];n.INSTRUCTIONS=a;n.getHelp=e=>r[e%(r.length-1)];n.getInstruction=e=>a[e%(a.length-1)];n.getNextInstruction=()=>a[1%(a.length-1)]},{}],"8f1ee5619bd130ec46fad29dd6c1ad12":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.trackError=n.trackExit=n.track=n.setupReporting=void 0;var r=i(e("analytics")),a=i(e("@analytics/google-analytics"));function i(e){return e&&e.__esModule?e:{default:e}}let o;n.setupReporting=(e="Interface",t="G-1XT0GV0L6J")=>(o=(0,r.default)({app:e,plugins:[(0,a.default)({trackingId:t})]}),o.page(),o);n.track=(e,t)=>{o&&o.track(e,t)};n.trackExit=()=>{};n.trackError=(e,t=42,n="Fails")=>{o&&o.track("Error",{category:n,label:e,value:t})}},{analytics:"d2222e489d044bed0047b3163e98e708","@analytics/google-analytics":"f8a390fc060e13098b0d808785519872"}],d2222e489d044bed0047b3163e98e708:[function(e,t,n){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(n,"__esModule",{value:!0});var a=e("@analytics/core"),i=r(a),o=r(e("@analytics/storage-utils"));var s=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e};function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var l=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(n,!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e};function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={storage:o};return i(l(l({},t),e))}n.EVENTS=a.EVENTS,n.CONSTANTS=a.CONSTANTS,n.default=u,n.init=u,n.Analytics=u},{"@analytics/core":"f365c4542411cf73ee82e45a52219cf8","@analytics/storage-utils":"fc8df5e707bd6b783787c5ac9a9612e5"}],f365c4542411cf73ee82e45a52219cf8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("analytics-utils");var a=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}};var i=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)};var o=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")};var s=function(e){return a(e)||i(e)||o()};function c(e,t){return e(t={exports:{}},t.exports),t.exports}var l=c((function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(r){return"function"==typeof Symbol&&"symbol"===t(Symbol.iterator)?e.exports=n=function(e){return t(e)}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":t(e)},n(r)}e.exports=n}));var u=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e};function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var h=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(n,!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e},f="function",p="undefined",m="@@redux/"+Math.random().toString(36),g=function(){return("undefined"==typeof Symbol?"undefined":l(Symbol))===f&&Symbol.observable||"@@observable"}(),b=" != "+f;function y(e,t,n){if(l(t)===f&&l(n)===p&&(n=t,t=void 0),l(n)!==p){if(l(n)!==f)throw new Error("enhancer"+b);return n(y)(e,t)}if(l(e)!==f)throw new Error("reducer"+b);var a=e,i=t,o=[],s=o,c=!1;function d(){s===o&&(s=o.slice())}function h(){return i}function m(e){if(l(e)!==f)throw new Error("Listener"+b);var t=!0;return d(),s.push(e),function(){if(t){t=!1,d();var n=s.indexOf(e);s.splice(n,1)}}}function v(e){if(!r.isObject(e))throw new Error("Act != obj");if(l(e.type)===p)throw new Error("ActType "+p);if(c)throw new Error("Dispatch in reducer");try{c=!0,i=a(i,e)}finally{c=!1}for(var t=o=s,n=0;n<t.length;n++){(0,t[n])()}return e}return v({type:"@@redux/INIT"}),u({dispatch:v,subscribe:m,getState:h,replaceReducer:function(e){if(l(e)!==f)throw new Error("next reducer"+b);a=e,v({type:"@@redux/INIT"})}},g,(function(){var e=m;return u({subscribe:function(t){if("object"!==l(t))throw new TypeError("Observer != obj");function n(){t.next&&t.next(h())}return n(),{unsubscribe:e(n)}}},g,(function(){return this}))}))}function v(e,t){var n=t&&t.type;return"action "+(n&&n.toString()||"?")+"reducer "+e+" returns "+p}function w(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++){var a=t[r];l(e[a])===f&&(n[a]=e[a])}var i,o=Object.keys(n);try{!function(e){Object.keys(e).forEach((function(t){var n=e[t],r=n(void 0,{type:"@@redux/INIT"});if(l(r)===p||l(n(void 0,{type:m}))===p)throw new Error("reducer "+t+" "+p)}))}(n)}catch(e){i=e}return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(i)throw i;for(var r=!1,a={},s=0;s<o.length;s++){var c=o[s],u=n[c],d=e[c],h=u(d,t);if(l(h)===p){var f=v(c,t);throw new Error(f)}a[c]=h,r=r||h!==d}return r?a:e}}function E(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function I(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return function(n,r,a){var i,o=e(n,r,a),c=o.dispatch,l={getState:o.getState,dispatch:function(e){return c(e)}};return i=t.map((function(e){return e(l)})),c=E.apply(void 0,s(i))(o.dispatch),h(h({},o),{},{dispatch:c})}}}var S=["bootstrap","params","campaign","initializeStart","initialize","initializeEnd","ready","resetStart","reset","resetEnd","pageStart","page","pageEnd","pageAborted","trackStart","track","trackEnd","trackAborted","identifyStart","identify","identifyEnd","identifyAborted","userIdChanged","registerPlugins","enablePlugin","disablePlugin","online","offline","setItemStart","setItem","setItemEnd","setItemAborted","removeItemStart","removeItem","removeItemEnd","removeItemAborted"],_=["name","EVENTS","config","loaded"],C=S.reduce((function(e,t){return e[t]=t,e}),{registerPluginType:function(e){return"registerPlugin:".concat(e)},pluginReadyType:function(e){return"ready:".concat(e)}});function T(e){return S.includes(e)}var M="__anon_id",A="__user_id",x="__user_traits",N=Object.freeze({ANON_ID:M,USER_ID:A,USER_TRAITS:x}),k=/^utm_/,O=/^an_prop_/,D=/^an_trait_/;function P(e){var t=e.storage,n=t.setItem,r=t.getItem;return function(t){return function(a){return function(i){if(i.type===C.bootstrap){var o=i.params,s=i.user;r(M)||n(M,s.anonymousId);var c=Object.keys(i.params);if(c.length){var l=o.an_uid,u=o.an_event,d=c.reduce((function(e,t){if(t.match(k)||t.match(/^(d|g)clid/)){var n=t.replace(k,""),r="campaign"===n?"name":n;e.campaign[r]=o[t]}return t.match(O)&&(e.props[t.replace(O,"")]=o[t]),t.match(D)&&(e.traits[t.replace(D,"")]=o[t]),e}),{campaign:{},props:{},traits:{}});t.dispatch(h(h({type:C.params,raw:o},d),l?{userId:l}:{})),l&&setTimeout((function(){return e.identify(l,d.traits)}),0),u&&setTimeout((function(){return e.track(u,d.props)}),0),Object.keys(d.campaign).length&&t.dispatch({type:C.campaign,campaign:d.campaign})}}return a(i)}}}}var R="userId",L="anonymousId";function B(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n.type===C.setItemEnd){if(n.key===M)return h(h({},t),{anonymousId:n.value});if(n.key===A)return h(h({},t),{userId:n.value})}switch(n.type){case C.identify:return Object.assign({},t,{userId:n.userId,traits:h(h({},t.traits),n.traits)});case C.reset:return[R,L,"traits"].forEach((function(e){r.globalContext[F(e)]=null})),[A,M,x].forEach((function(t){e.removeItem(t)})),Object.assign({},t,{userId:null,anonymousId:null,traits:{}});default:return t}}}function j(e,t){return{userId:t.getItem(A)||e.an_uid,anonymousId:t.getItem(M)||e.an_aid||r.uuid(),traits:t.getItem(x)||{}}}var F=function(e){return"__TEMP__"+e};function V(e){return function(t,n,a){var i=n.getState("user")[t];if(i)return i;if(a&&r.isObject(a)&&a[t])return a[t];var o=j({},e)[t];return o||(r.globalContext[F(t)]?r.globalContext[F(t)]:null)}}function q(e){var t=e.storage,n=t.setItem,a=t.removeItem,i=t.getItem;return function(e){return function(t){return function(o){var s=o.userId,c=o.traits,l=o.options,u=o.callback;if(o.type===C.reset&&([A,x,M].forEach((function(e){return a(e)})),[R,L,"traits"].forEach((function(e){r.globalContext[F(e)]=void 0})),r.isFunction(u)&&u()),o.type===C.identify){i(M)||n(M,r.uuid());var d=i(A),f=i(x)||{};d&&d!==s&&e.dispatch({type:C.userIdChanged,old:{userId:d,traits:f},new:{userId:s,traits:c},options:l}),s&&n(A,s),c&&n(x,h(h({},f),c))}return t(o)}}}}var G=c((function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var a=t&&t.prototype instanceof d?t:d,i=Object.create(a.prototype),o=new S(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return C()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var s=w(o,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=l(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,o),i}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var u={};function d(){}function h(){}function f(){}var p={};p[a]=function(){return this};var m=Object.getPrototypeOf,g=m&&m(m(_([])));g&&g!==t&&n.call(g,a)&&(p=g);var b=f.prototype=d.prototype=Object.create(p);function y(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){var r;this._invoke=function(a,i){function o(){return new t((function(r,o){!function r(a,i,o,s){var c=l(e[a],e,i);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,o,s)}),(function(e){r("throw",e,o,s)})):t.resolve(d).then((function(e){u.value=e,o(u)}),(function(e){return r("throw",e,o,s)}))}s(c.arg)}(a,i,r,o)}))}return r=r?r.then(o,o):o()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=l(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,u;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function _(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:C}}function C(){return{value:void 0,done:!0}}return h.prototype=b.constructor=f,f.constructor=h,h.displayName=s(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,o,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},y(v.prototype),v.prototype[i]=function(){return this},e.AsyncIterator=v,e.async=function(t,n,r,a,i){void 0===i&&(i=Promise);var o=new v(c(t,n,r,a),i);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},y(b),s(b,o,"Generator"),b[a]=function(){return this},b.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=_,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,u):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;I(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:_(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}));function $(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}var U=function(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){$(i,r,a,o,s,"next",e)}function s(e){$(i,r,a,o,s,"throw",e)}o(void 0)}))}},H={};function z(e,t){H[e]&&r.isFunction(H[e])&&(H[e](t),delete H[e])}function Y(e,t,n){return new Promise((function(r,a){return t()?r(e):n<1?a(h(h({},e),{},{queue:!0})):(i=10,new Promise((function(e){return setTimeout(e,i)}))).then((function(i){return Y(e,t,n-10).then(r,a)}));var i}))}function W(e,t,n){var a=t(),i=e.getState(),o=i.plugins,s=i.context,c=i.queue,l=i.user;if(!s.offline&&c&&c.actions&&c.actions.length){var u=c.actions.reduce((function(e,t,n){return o[t.plugin].loaded?(e.process.push(t),e.processIndex.push(n)):(e.requeue.push(t),e.requeueIndex.push(n)),e}),{processIndex:[],process:[],requeue:[],requeueIndex:[]});if(u.processIndex&&u.processIndex.length){u.processIndex.forEach((function(t){var i=c.actions[t],s=i.plugin,u=i.payload.type,d=a[s][u];if(d&&r.isFunction(d)){var f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return[R,L].reduce((function(e,n){return K(e,t,n)}),e)}(i.payload,l);d({payload:f,config:o[s].config,instance:n});var p="".concat(u,":").concat(s);e.dispatch(h(h({},f),{},{type:p,_:{called:p,from:"queueDrain"}}))}}));var d=c.actions.filter((function(e,t){return!~u.processIndex.indexOf(t)}));c.actions=d}}}function Q(e,t,n){return setInterval((function(){return W(e,t,n)}),3e3)}function K(e,t,n){return e.hasOwnProperty(n)&&!e[n]&&t[n]?Object.assign({},e,u({},"".concat(n),t[n])):e}var X=function(e){if(Array.isArray(e))return e};var J=function(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n};var Z=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")};var ee=function(e,t){return X(e)||J(e,t)||Z()};function te(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Object.keys(e).filter((function(e){var a=n.plugins||{};return r.isBoolean(a[e])?a[e]:!1!==a.all&&(!t[e]||!1!==t[e].enabled)})).map((function(t){return e[t]}))}var ne=/Start$/,re=/^bootstrap/,ae=/^ready/;function ie(e,t,n,r,a){return oe.apply(this,arguments)}function oe(){return(oe=U(G.mark((function e(t,n,a,i,o){var s,c,l,u,d,f,p,m,g,b,y,v;return G.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=r.isFunction(n)?n():n,c=t.type,l=c.replace(ne,""),!t._||!t._.called){e.next=5;break}return e.abrupt("return",t);case 5:return u=a.getState(),d=te(s,u.plugins,t.options),c===C.initializeStart&&t.fromEnable&&(d=Object.keys(u.plugins).filter((function(e){var n=u.plugins[e];return t.plugins.includes(e)&&!n.initialized})).map((function(e){return s[e]}))),f=d.map((function(e){return e.name})),p=pe(c,d,s),e.next=12,ce({action:t,data:{exact:p.before,namespaced:p.beforeNS},state:u,allPlugins:s,allMatches:p,instance:a,store:i,EVENTS:o});case 12:if(!ge(m=e.sent,f.length)){e.next=15;break}return e.abrupt("return",m);case 15:if(c!==l){e.next=19;break}g=m,e.next=22;break;case 19:return e.next=21,ce({action:h(h({},m),{},{type:l}),data:{exact:p.during,namespaced:p.duringNS},state:u,allPlugins:s,allMatches:p,instance:a,store:i,EVENTS:o});case 21:g=e.sent;case 22:if(!c.match(ne)){e.next=29;break}return b="".concat(l,"End"),e.next=26,ce({action:h(h({},g),{},{type:b}),data:{exact:p.after,namespaced:p.afterNS},state:u,allPlugins:s,allMatches:p,instance:a,store:i,EVENTS:o});case 26:y=e.sent,(v=se(y))&&v({payload:y});case 29:return e.abrupt("return",m);case 30:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function se(e){return!!e.meta&&Object.keys(e.meta).reduce((function(t,n){var a=e.meta[n];return r.isFunction(a)?a:t}),!1)}function ce(e){return le.apply(this,arguments)}function le(){return(le=U(G.mark((function e(t){var n,a,i,o,s,c,l,u,d,f,p,m,g,b,y,v,w,E;return G.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.data,a=t.action,i=t.instance,o=t.state,s=t.allPlugins,c=t.allMatches,l=t.store,u=t.EVENTS,d=o.plugins,f=o.context,p=a.type,m=p.match(ne),g=n.exact.map((function(e){return e.pluginName})),m&&(g=c.during.map((function(e){return e.pluginName}))),b=ve(i,g),y=n.exact.reduce((function(e,t){var n=t.pluginName,r=t.methodName,a=!1;return r.match(/^initialize/)||r.match(/^reset/)||(a=!d[n].loaded),f.offline&&r.match(/^(page|track|identify)/)&&(a=!0),e["".concat(n)]=a,e}),{}),e.next=10,n.exact.reduce(function(){var e=U(G.mark((function e(t,o,c){var l,u,f;return G.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=o.pluginName,e.next=3,t;case 3:if(u=e.sent,!n.namespaced||!n.namespaced[l]){e.next=11;break}return e.next=7,n.namespaced[l].reduce(function(){var e=U(G.mark((function e(t,n,a){var o,c,u,f;return G.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=function(e,t,n){return function(r,a){var i=n||t;return h(h({},e),{},{abort:{reason:r,plugins:a||[t],caller:p,from:i}})}},e.next=3,t;case 3:if(o=e.sent,n.method&&r.isFunction(n.method)){e.next=6;break}return e.abrupt("return",o);case 6:return we(n.methodName,n.pluginName),e.next=9,n.method({payload:o,instance:i,abort:c(o,l,n.pluginName),config:de(n.pluginName,d,s),plugins:d});case 9:return u=e.sent,f=r.isObject(u)?u:{},e.abrupt("return",Promise.resolve(h(h({},o),f)));case 12:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Promise.resolve(a));case 7:f=e.sent,u[l]=f,e.next=12;break;case 11:u[l]=a;case 12:return e.abrupt("return",Promise.resolve(u));case 13:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Promise.resolve({}));case 10:return v=e.sent,e.next=13,n.exact.reduce(function(){var e=U(G.mark((function e(t,a,o){var c,u,f,g,w,E,I,S,_,C,T,M;return G.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=n.exact.length===o+1,u=a.pluginName,f=s[u],e.next=5,t;case 5:if(g=e.sent,w=v[u]?v[u]:{},m&&(w=g),!me(w,u)){e.next=11;break}return ue({data:w,method:p,instance:i,pluginName:u,store:l}),e.abrupt("return",Promise.resolve(g));case 11:if(!me(g,u)){e.next=14;break}return c&&ue({data:g,method:p,instance:i,store:l}),e.abrupt("return",Promise.resolve(g));case 14:if(!y.hasOwnProperty(u)||!0!==y[u]){e.next=17;break}return l.dispatch({type:"queue",plugin:u,payload:w,_:{called:"queue",from:"queueMechanism"}}),e.abrupt("return",Promise.resolve(g));case 17:return E=b(v[u],s[u]),e.next=20,f[p]({abort:E.abort,payload:w,instance:i,config:de(u,d,s),plugins:d});case 20:return I=e.sent,S=r.isObject(I)?I:{},_=h(h({},g),S),me(C=v[u],u)?ue({data:C,method:p,instance:i,pluginName:u,store:l}):(T="".concat(p,":").concat(u),(T.match(/:/g)||[]).length<2&&!p.match(re)&&!p.match(ae)&&(M=m?_:w,i.dispatch(h(h({},M),{},{type:T,_:{called:T,from:"submethod"}})))),e.abrupt("return",Promise.resolve(_));case 26:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Promise.resolve(a));case 13:if(w=e.sent,p.match(ne)||p.match(/^registerPlugin/)||p.match(ae)||p.match(re)||p.match(/^params/)||p.match(/^userIdChanged/)){e.next=21;break}if(u.plugins.includes(p),!w._||w._.originalAction!==p){e.next=18;break}return e.abrupt("return",w);case 18:E=h(h({},w),{_:{originalAction:w.type,called:w.type,from:"engineEnd"}}),ge(w,n.exact.length)&&!p.match(/End$/)&&(E=h(h({},E),{type:w.type+"Aborted"})),l.dispatch(E);case 21:return e.abrupt("return",w);case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ue(e){var t=e.data,n=e.method,r=(e.instance,e.pluginName),a=n+"Aborted"+(r?":"+r:"");e.store.dispatch(h(h({},t),{},{type:a,_:{called:a,from:"abort"}}))}function de(e,t,n){var r=t[e]||n[e];return r&&r.config?r.config:{}}function he(e,t){return t.reduce((function(t,n){return n[e]?t.concat({methodName:e,pluginName:n.name,method:n[e]}):t}),[])}function fe(e,t){var n=function(e){return e.replace(ne,"")}(e),r=t?":".concat(t):"";return["".concat(e).concat(r),"".concat(n).concat(r),"".concat(n,"End").concat(r)]}function pe(e,t,n){var r=fe(e).map((function(e){return he(e,t)}));return t.reduce((function(n,r){var a=r.name,i=fe(e,a).map((function(e){return he(e,t)})),o=ee(i,3),s=o[0],c=o[1],l=o[2];return s.length&&(n.beforeNS[a]=s),c.length&&(n.duringNS[a]=c),l.length&&(n.afterNS[a]=l),n}),{before:r[0],beforeNS:{},during:r[1],duringNS:{},after:r[2],afterNS:{}})}function me(e,t){var n=e.abort;return!!n&&(!0===n||(ye(n,t)||n&&ye(n.plugins,t)))}function ge(e,t){var n=e.abort;if(!n)return!1;if(!0===n||r.isString(n))return!0;var a=n.plugins;return be(n)&&n.length===t||be(a)&&a.length===t}function be(e){return Array.isArray(e)}function ye(e,t){return!(!e||!be(e))&&e.includes(t)}function ve(e,t){return function(n,r,a){var i=r.config,o=r.name,s="".concat(o,".").concat(n.type);a&&(s=a.event);var c=n.type.match(ne)?function(e,t,n,r,a){return function(i,o){var s=r?r.name:e,c=o&&be(o)?o:n;if(r&&(!(c=o&&be(o)?o:[e]).includes(e)||1!==c.length))throw new Error("Method ".concat(t," can only abort ").concat(e," plugin. ").concat(JSON.stringify(c)," input valid"));return h(h({},a),{},{abort:{reason:i,plugins:c,caller:t,_:s}})}}(o,s,t,a,n):function(e,t){return function(){throw new Error(e.type+" action not cancellable. Remove abort in "+t)}}(n,s);return{payload:Ie(n),instance:e,config:i||{},abort:c}}}function we(e,t){var n=Ee(e);if(n&&n.name===t){var r=Ee(n.method),a=r?"or "+r.method:"";throw new Error([t+" plugin is calling method "+e,"Plugins cant call self","Use ".concat(n.method," ").concat(a," in ").concat(t," plugin insteadof ").concat(e)].join("\n"))}}function Ee(e){var t=e.match(/(.*):(.*)/);return!!t&&{method:t[1],name:t[2]}}function Ie(e){return Object.keys(e).reduce((function(t,n){return"type"===n||(r.isObject(e[n])?t[n]=Object.assign({},e[n]):t[n]=e[n]),t}),{})}function Se(e,t,n){var r={};return function(a){return function(i){return function(){var o=U(G.mark((function o(s){var c,l,u,d,f,p,m,g,b,y,v,w;return G.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(c=s.type,l=s.abort,u=s.plugins,d=s,!l){o.next=4;break}return o.abrupt("return",i(s));case 4:if(c===C.enablePlugin&&a.dispatch({type:C.initializeStart,plugins:u,disabled:[],fromEnable:!0,ts:s.ts}),c===C.disablePlugin&&setTimeout((function(){z(s.ts)}),0),c===C.initializeEnd&&(f=t(),p=Object.keys(f),m=p.filter((function(e){return u.includes(e)})).map((function(e){return f[e]})),g=[],b=[],y=s.disabled,v=m.map((function(e){var t=e.loaded,n=e.name;return Y(e,t,1e4).then((function(t){return r[n]||(a.dispatch({type:C.pluginReadyType(n),name:n,events:Object.keys(e).filter((function(e){return!_.includes(e)}))}),r[n]=!0),g=g.concat(n),e})).catch((function(e){if(e instanceof Error)throw new Error(e);return b=b.concat(e.name),e}))})),Promise.all(v).then((function(e){var t={plugins:g,failed:b,disabled:y};setTimeout((function(){p.length===v.length+y.length&&a.dispatch(h(h({},{type:C.ready}),t)),z(s.ts,t)}),0)}))),c===C.bootstrap){o.next=13;break}return/^ready:([^:]*)$/.test(c)&&setTimeout((function(){return W(a,t,e)}),0),o.next=11,ie(s,t,e,a,n);case 11:return w=o.sent,o.abrupt("return",i(w));case 13:return o.abrupt("return",i(d));case 14:case"end":return o.stop()}}),o)})));return function(e){return o.apply(this,arguments)}}()}}}function _e(){return(new Date).getTime()}function Ce(e){return function(t){return function(t){return function(n){var r=n.type,a=n.key,i=n.value,o=n.options;if(r===C.setItem||r===C.removeItem){if(n.abort)return t(n);r===C.setItem?e.setItem(a,i,o):e.removeItem(a,o)}return t(n)}}}}var Te,Me,Ae,xe,Ne=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},ke=function e(){var t=this;Ne(this,e),u(this,"before",[]),u(this,"after",[]),u(this,"addMiddleware",(function(e,n){t[n]=t[n].concat(e)})),u(this,"removeMiddleware",(function(e,n){var r=t[n].findIndex((function(t){return t===e}));-1!==r&&(t[n]=[].concat(s(t[n].slice(0,r)),s(t[n].slice(r+1))))})),u(this,"dynamicMiddlewares",(function(e){return function(n){return function(r){return function(a){var i={getState:n.getState,dispatch:function(e){return n.dispatch(e)}},o=t[e].map((function(e){return e(i)}));return E.apply(void 0,s(o))(r)(a)}}}}))};function Oe(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,r={};if("initialize:aborted"===n.type)return t;if(/^registerPlugin:([^:]*)$/.test(n.type)){var a=De(n.type,"registerPlugin"),i=e()[a];if(!i||!a)return t;var o=n.enabled;return r[a]={enabled:o,initialized:!!o&&Boolean(!i.initialize),loaded:!!o&&Boolean(i.loaded()),config:i.config||{}},h(h({},t),r)}if(/^initialize:([^:]*)$/.test(n.type)){var s=De(n.type,C.initialize),c=e()[s];return c&&s?(r[s]=h(h({},t[s]),{initialized:!0,loaded:Boolean(c.loaded())}),h(h({},t),r)):t}if(/^ready:([^:]*)$/.test(n.type))return r[n.name]=h(h({},t[n.name]),{loaded:!0}),h(h({},t),r);switch(n.type){case C.disablePlugin:return h(h({},t),Pe(n.plugins,!1,t));case C.enablePlugin:return h(h({},t),Pe(n.plugins,!0,t));default:return t}}}function De(e,t){return e.substring(t.length+1,e.length)}function Pe(e,t,n){return e.reduce((function(e,r){return e[r]=h(h({},n[r]),{enabled:t}),e}),n)}Te=function(){if(!r.inBrowser)return!1;var e=navigator.appVersion;return~e.indexOf("Win")?"Windows":~e.indexOf("Mac")?"MacOS":~e.indexOf("X11")?"UNIX":~e.indexOf("Linux")?"Linux":"Unknown OS"}(),Me=r.inBrowser?document.referrer:null,Ae=r.getBrowserLocale(),xe=r.getTimeZone();var Re={initialized:!1,sessionId:r.uuid(),app:null,version:null,debug:!1,offline:!!r.inBrowser&&!navigator.onLine,os:{name:Te},userAgent:r.inBrowser?navigator.userAgent:"node",library:{name:"analytics",version:"0.9.2"},timezone:xe,locale:Ae,campaign:{},referrer:Me};function Le(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Re,t=arguments.length>1?arguments[1]:void 0,n=e.initialized,r=t.type,a=t.campaign;switch(r){case C.campaign:return h(h({},e),{campaign:a});case C.offline:return h(h({},e),{offline:!0});case C.online:return h(h({},e),{offline:!1});default:return n?e:h(h(h({},Re),e),{initialized:!0})}}var Be=["plugins","reducers","storage"];function je(e){return Object.keys(e).reduce((function(t,n){return Be.includes(n)||(t[n]=e[n]),t}),{})}function Fe(e){var t=e;try{t=JSON.parse(JSON.stringify(e))}catch(e){}return t}var Ve=/#.*$/;function qe(e){var t=/(http[s]?:\/\/)?([^\/\s]+\/)(.*)/g.exec(e);return"/"+(t&&t[3]?t[3].split("?")[0].replace(Ve,""):"")}function Ge(e){var t=function(){if(r.inBrowser)for(var e,t=document.getElementsByTagName("link"),n=0;e=t[n];n++)if("canonical"===e.getAttribute("rel"))return e.getAttribute("href")}();return t?t.match(/\?/)?t:t+e:window.location.href.replace(Ve,"")}var $e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!r.inBrowser)return e;var t=document,n=t.title,a=t.referrer,i=window,o=i.location,s=i.innerWidth,c=i.innerHeight,l=o.hash,u=o.search,d=Ge(u),f={title:n,url:d,path:qe(d),hash:l,search:u,width:s,height:c};return a&&""!==a&&(f.referrer=a),h(h({},f),e)},Ue={last:{},history:[]};function He(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ue,t=arguments.length>1?arguments[1]:void 0,n=t.properties,r=t.options,a=t.meta;switch(t.type){case C.page:var i=Fe(h({properties:n,meta:a},Object.keys(r).length&&{options:r}));return h(h({},e),{last:i,history:e.history.concat(i)});default:return e}}var ze={last:{},history:[]};function Ye(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ze,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.meta,a=t.options,i=t.event,o=t.properties;switch(n){case C.track:var s=Fe(h(h({event:i,properties:o},Object.keys(a).length&&{options:a}),{},{meta:r}));return h(h({},e),{last:s,history:e.history.concat(s)});default:return e}}var We={actions:[]};function Qe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:We,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case"queue":var a;return a=r&&r.type&&r.type===C.identify?[t].concat(e.actions):e.actions.concat(t),h(h({},e),{},{actions:a});case"dequeue":return[];default:return e}}function Ke(e,t,n){if(!r.inBrowser)return!1;var a=window[(n?"add":"remove")+"EventListener"];e.split(" ").forEach((function(e){a(e,t)}))}function Xe(e){var t=Ke.bind(null,"online offline",(function(t){return Promise.resolve(!navigator.onLine).then(e)}));return t(!0),function(e){return t(!1)}}function Je(){return Array.prototype.slice.call(arguments).reduce((function(e,t){return e||(r.isFunction(t)?t:e)}),!1)}function Ze(){return r.globalContext.__analytics__=[],function(e){return function(t,n,a){var i=e(t,n,a),o=i.dispatch;return Object.assign(i,{dispatch:function(e){var t=e.action||e;return r.globalContext.__analytics__.push(t),o(e)}})}}}function et(e){return function(){return E(E.apply(null,arguments),Ze())}}function tt(e){return e?r.isString(e)?[e]:e:[]}var nt=function(e,t,n){return{type:C.setItemStart,timestamp:_e(),key:e,value:t,options:n}},rt=function(e,t){return{type:C.removeItemStart,timestamp:_e(),key:e,options:t}};function at(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.reducers||{},n=(e.plugins||[]).reduce((function(e,t){if(r.isFunction(t))return e.middlewares=e.middlewares.concat(t),e;if(t.NAMESPACE&&(t.name=t.NAMESPACE),!t.name)throw new Error("https://lytics.dev/errors/1");var n=t.EVENTS?Object.keys(t.EVENTS).map((function(e){return t.EVENTS[e]})):[],a=!(!1===t.enabled),i=!(t.config&&!1===t.config.enabled);e.pluginEnabled[t.name]=a&&i,delete t.enabled,t.methods&&(e.methods[t.name]=Object.keys(t.methods).reduce((function(e,n){return e[n]=ne(t.methods[n]),e}),{}),delete t.methods);var o=Object.keys(t).concat(n),s=new Set(e.events.concat(o));if(e.events=Array.from(s),e.pluginsArray=e.pluginsArray.concat(t),e.plugins[t.name])throw new Error(t.name+" already loaded");return e.plugins[t.name]=t,e.plugins[t.name].loaded||(e.plugins[t.name].loaded=function(){return!0}),e}),{plugins:{},pluginEnabled:{},methods:{},pluginsArray:[],middlewares:[],events:[]}),a=e.storage?e.storage:{getItem:function(e){return r.globalContext[e]},setItem:function(e,t){return r.globalContext[e]=t},removeItem:function(e){return r.globalContext[e]=void 0}},i=V(a),o=n.plugins,c=n.events.filter((function(e){return!_.includes(e)})),u=new Set(c.concat(S).filter((function(e){return!_.includes(e)}))),d=Array.from(u).sort(),f=c.sort(),p=function(){return o},m=new ke,g=m.addMiddleware,b=m.removeMiddleware,v=m.dynamicMiddlewares,A=function(){throw new Error("Abort disabled in listener")},x=function(e,t){return function(n){t&&t(n),e(n)}},N=r.paramsParse(),k=j(N,a),O=h({enable:function(e,t){var n=r.uuid();return new Promise((function(r){H[n]=x(r,t),J.dispatch({type:C.enablePlugin,plugins:tt(e),ts:n,_:{originalAction:C.enablePlugin}})}))},disable:function(e,t){var n=r.uuid();return new Promise((function(r){H[n]=x(r,t),J.dispatch({type:C.disablePlugin,plugins:tt(e),ts:n,_:{originalAction:C.disablePlugin}})}))}},n.methods),D={identify:function(e,t,n,a){var o=r.isString(e)?e:null,s=r.isObject(e)?e:t,c=n||{},l=D.user();r.globalContext[F(R)]=o;var u=o||s.userId||i(R,D,s);return new Promise((function(e,r){J.dispatch(h(h({type:C.identifyStart,userId:u,traits:s||{},options:c,anonymousId:l.anonymousId},l.id&&l.id!==o&&{previousId:l.id}),{},{meta:{timestamp:_e(),callback:x(e,Je(t,n,a))}}))}))},track:function(e,t,n,a){var o=r.isObject(e)?e.event:e;if(!o||!r.isString(o))throw new Error("Event missing");var s=r.isObject(e)?e:t||{},c=r.isObject(n)?n:{};return new Promise((function(e,r){J.dispatch({type:C.trackStart,event:o,properties:s,options:c,userId:i(R,D,t),anonymousId:i(L,D,t),meta:{timestamp:_e(),callback:x(e,Je(t,n,a))}})}))},page:function(e,t,n){var a=r.isObject(e)?e:{},o=r.isObject(t)?t:{};return new Promise((function(r,s){J.dispatch({type:C.pageStart,properties:$e(a),options:o,userId:i(R,D,a),anonymousId:i(L,D,a),meta:{timestamp:_e(),callback:x(r,Je(e,t,n))}})}))},user:function(e){if(e===R||"id"===e)return i(R,D);var t=D.getState("user");return e?r.dotProp(t,e):t},reset:function(e){return new Promise((function(t,n){J.dispatch({type:C.resetStart,timestamp:_e(),callback:x(t,e)})}))},ready:function(e){return D.on(C.ready,e)},on:function(e,t){if(!e||!r.isFunction(t))return!1;if(e===C.bootstrap)throw new Error(".on disabled for "+e);var n=/Start$|Start:/;if("*"===e){var a=function(e){return function(e){return function(r){return r.type.match(n)&&t({payload:r,instance:D,plugins:o}),e(r)}}},i=function(e){return function(e){return function(r){return r.type.match(n)||t({payload:r,instance:D,plugins:o}),e(r)}}};return g(a,it),g(i,ot),function(){b(a,it),b(i,ot)}}var s=e.match(n)?it:ot,c=function(n){return function(n){return function(r){return r.type===e&&t({payload:r,instance:D,plugins:o,abort:A}),n(r)}}};return g(c,s),function(){return b(c,s)}},once:function(e,t){if(!e||!r.isFunction(t))return!1;if(e===C.bootstrap)throw new Error(".once disabled for "+e);var n=D.on(e,(function(e){var r=e.payload;t({payload:r,instance:D,plugins:o,abort:A}),n()}));return n},getState:function(e){var t=J.getState();return e?r.dotProp(t,e):Object.assign({},t)},dispatch:function(e){var t=r.isString(e)?{type:e}:e;if(T(t.type))throw new Error("reserved action "+t.type);var n=t.meta||{},a=e._||{},i=h(h({},t),{},{meta:h({timestamp:_e()},n),_:h({originalAction:t.type},a)});J.dispatch(i)},enablePlugin:O.enable,disablePlugin:O.disable,plugins:O,storage:{getItem:a.getItem,setItem:function(e,t,n){J.dispatch(nt(e,t,n))},removeItem:function(e,t){J.dispatch(rt(e,t))}},setAnonymousId:function(e,t){D.storage.setItem(M,e,t)},events:{all:d,core:S,plugins:f}},G=n.middlewares.concat([v(it),Se(D,p,{all:d,plugins:f}),Ce(a),P(D),q(D),v(ot)]),$={context:Le,user:B(a),page:He,track:Ye,plugins:Oe(p),queue:Qe},U=E,z=E;if(r.inBrowser&&e.debug){var Y=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__;Y&&(U=Y({trace:!0,traceLimit:25})),z=function(){return 0===arguments.length?Ze():r.isObject(l(arguments[0]))?et():et().apply(null,arguments)}}var W=je(e),K=n.pluginsArray.reduce((function(e,t){var r=t.name,a=t.config,i=t.loaded,o=n.pluginEnabled[r];return e[r]={enabled:o,initialized:!!o&&Boolean(!t.initialize),loaded:Boolean(i()),config:a||{}},e}),{}),X={context:W,user:k,plugins:K},J=y(w(h(h({},$),t)),X,z(U(I.apply(void 0,s(G))))),Z=Object.keys(o);J.dispatch({type:C.bootstrap,plugins:Z,config:W,params:N,user:k});var ee=Z.filter((function(e){return n.pluginEnabled[e]})),te=Z.filter((function(e){return!n.pluginEnabled[e]}));function ne(e){return function(){var t=Array.prototype.slice.call(arguments),n=Array.apply(null,Array(e.length)).map((function(){})).map((function(e,n){if(t[n]||!1===t[n]||null===t[n])return t[n]})).concat(D);return e.apply({instance:D},n)}}return J.dispatch({type:C.registerPlugins,plugins:Z,enabled:n.pluginEnabled}),n.pluginsArray.map((function(e,t){var a=e.bootstrap,i=e.config,o=e.name;a&&r.isFunction(a)&&a({instance:D,config:i,payload:e}),J.dispatch({type:C.registerPluginType(o),name:o,enabled:n.pluginEnabled[o],plugin:e}),n.pluginsArray.length===t+1&&J.dispatch({type:C.initializeStart,plugins:ee,disabled:te})})),Xe((function(e){J.dispatch({type:e?C.offline:C.online})})),Q(J,p,D),D}var it="before",ot="after";n.default=at,n.init=at,n.Analytics=at,n.EVENTS=C,n.CONSTANTS=N},{"analytics-utils":"9b8f0f4db50dfb020d6712fe4dd91d9d"}],"9b8f0f4db50dfb020d6712fe4dd91d9d":[function(e,t,n){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(n,"__esModule",{value:!0});var a=r(e("dlv")),i=e("@analytics/storage-utils"),o=r(i);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}var l="undefined"!=typeof document;function u(e){if(!l)return!1;var t=e||document.referrer;if(t){var n=window.document.location.port,r=t.split("/")[2];return n&&(r=r.replace(":".concat(n),"")),r!==window.location.hostname}return!1}function d(e,t){var n=(e.split("?")||[,])[1];if(!n||-1===n.indexOf(t))return e;var r=new RegExp("(\\&|\\?)".concat(t,'([_A-Za-z0-9"+=.\\/\\-@%]+)'),"g"),a="?".concat(n).replace(r,"").replace(/^&/,"?");return e.replace("?".concat(n),a)}function h(e){return function(e){var t,n={},r=/([^&=]+)=?([^&]*)/g;for(;t=r.exec(e);){var a=c(t[1]),i=c(t[2]);"[]"===a.substring(a.length-2)?(a=a.substring(0,a.length-2),(n[a]||(n[a]=[])).push(i)):n[a]=""===i||i}for(var o in n){var s=o.split("[");s.length>1&&(f(n,s.map((function(e){return e.replace(/[?[\]\\ ]/g,"")})),n[o]),delete n[o])}return n}(function(e){if(e){var t=e.match(/\?(.*)/);return t&&t[1]?t[1].split("#")[0]:""}return l&&window.location.search.substring(1)}(e))}function f(e,t,n){for(var r=t.length-1,a=0;a<r;++a){var i=t[a];i in e||(e[i]={}),e=e[i]}e[t[r]]=n}function p(e){if(!l)return null;var t=document.createElement("a");return t.setAttribute("href",e),t.hostname}function m(e){return(p(e)||"").split(".").slice(-2).join(".")}function g(e){var t=e.split(".");return t.length>1?t.slice(0,-1).join("."):e}var b={trimTld:g,getDomainBase:m,getDomainHost:p};var y="q",v={"daum.net":y,"eniro.se":"search_word","naver.com":"query","yahoo.com":"p","msn.com":y,"aol.com":y,"ask.com":y,"baidu.com":"wd","yandex.com":"text","rambler.ru":"words",google:y,"bing.com":{p:y,n:"live"}};n.dotProp=a,n.storage=o,n.getCookie=i.getCookie,n.setCookie=i.setCookie,n.globalContext=i.globalContext,n.removeCookie=i.removeCookie,n.isFunction=function(e){return"function"==typeof e},n.isString=function(e){return"string"==typeof e},n.isArray=function(e){return Array.isArray(e)},n.isObject=function(e){if("object"!==s(e)||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t},n.isUndefined=function(e){return void 0===e},n.isBoolean=function(e){return"boolean"==typeof e},n.decodeUri=c,n.getBrowserLocale=function(){if(l){var e=navigator,t=e.language,n=e.languages,r=e.userLanguage;return r||(n&&n.length?n[0]:t)}},n.getTimeZone=function(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}},n.inBrowser=l,n.isExternalReferrer=u,n.isScriptLoaded=function(e){if(!l)return!0;var t=document.getElementsByTagName("script");return!!Object.keys(t).filter((function(n){var r=t[n].src;return"string"==typeof e?-1!==r.indexOf(e):e instanceof RegExp&&r.match(e)})).length},n.noOp=function(){},n.paramsClean=d,n.paramsGet=function(e,t){return c((RegExp("".concat(e,"=(.+?)(&|$)")).exec(t)||[,""])[1])},n.paramsParse=h,n.paramsRemove=function(e,t){return l?new Promise((function(n,r){if(window.history&&window.history.replaceState){var a=window.location.href,i=d(a,e);a!==i&&history.replaceState({},"",i)}return t&&t(),n()})):Promise.resolve()},n.parseReferrer=function(e,t){if(!l)return!1;var n={source:"(direct)",medium:"(none)",campaign:"(not set)"};e&&u(e)&&(n.referrer=e);var r=function(e){if(!e||!l)return!1;var t=m(e),n=document.createElement("a");n.href=e,n.hostname.indexOf("google")>-1&&(t="google");if(v[t]){var r=v[t],a="string"==typeof r?r:r.p,i=new RegExp(a+"=.*?([^&#]*|$)","gi"),o=n.search.match(i);return{source:r.n||g(t),medium:"organic",term:(o?o[0].split("=")[1]:"")||"(not provided)"}}var s=u(e)?"referral":"internal";return{source:n.hostname,medium:s}}(e);r&&Object.keys(r).length&&(n=Object.assign({},n,r));var a=h(t),i=Object.keys(a);if(!i.length)return n;var o=i.reduce((function(e,t){return t.match(/^utm_/)&&(e["".concat(t.replace(/^utm_/,""))]=a[t]),t.match(/^(d|g)clid/)&&(e.source="google",e.medium=a.gclid?"cpc":"cpm",e[t]=a[t]),e}),{});return Object.assign({},n,o)},n.url=b,n.uuid=function(){for(var e="",t=0,n=4294967295*Math.random()|0;t++<36;){var r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx"[t-1],a=15&n;e+="-"==r||"4"==r?r:("x"==r?a:3&a|8).toString(16),n=t%8==0?4294967295*Math.random()|0:n>>4}return e},n.throttle=function(e,t){var n,r,a,i=null,o=0,s=function(){o=new Date,i=null,a=e.apply(n,r)};return function(){var c=new Date;o||(o=c);var l=t-(c-o);return n=this,r=arguments,l<=0?(clearTimeout(i),i=null,o=c,a=e.apply(n,r)):i||(i=setTimeout(s,l)),a}}},{dlv:"c0e400296e0f447417641dfa08c1358f","@analytics/storage-utils":"fc8df5e707bd6b783787c5ac9a9612e5"}],c0e400296e0f447417641dfa08c1358f:[function(e,t,n){var r;r=this,"object"==typeof n&&void 0!==t?t.exports=function(e,t,n,r,a){for(t=t.split?t.split("."):t,r=0;r<t.length;r++)e=e?e[t[r]]:a;return e===a?n:e}:r.dlv=function(e,t,n,r,a){for(t=t.split?t.split("."):t,r=0;r<t.length;r++)e=e?e[t[r]]:a;return e===a?n:e}},{}],fc8df5e707bd6b783787c5ac9a9612e5:[function(e,t,n){"use strict";var r=arguments[3];Object.defineProperty(n,"__esModule",{value:!0});var a=e("@analytics/cookie-utils");function i(){try{if("undefined"==typeof localStorage||"undefined"==typeof JSON)return!1;localStorage.setItem("_t_","1"),localStorage.removeItem("_t_")}catch(e){return!1}return!0}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e){var t;try{void 0===(t=JSON.parse(e))&&(t=e),"true"===t&&(t=!0),"false"===t&&(t=!1),parseFloat(t)===t&&"object"!==o(t)&&(t=parseFloat(t))}catch(n){t=e}return t}var c="object"===("undefined"==typeof self?"undefined":o(self))&&self.self===self&&self||"object"===(void 0===r?"undefined":o(r))&&r.global===r&&r||void 0,l="localStorage",u="cookie",d="global",h=i(),f=a.hasCookieSupport();function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return null;var n=y(t);if("all"===n)return m(e);if(v(n)){var r=localStorage.getItem(e);if(r||n===l)return s(r)}if(w(n)){var i=a.getCookie(e);if(i||n===u)return s(i)}return c[e]||null}function m(e){return{cookie:s(a.getCookie(e)),localStorage:s(localStorage.getItem(e)),global:c[e]||null}}function g(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e||!t)return!1;var r=y(n),i=JSON.stringify(t);if(v(r)){var o=s(localStorage.getItem(e));return localStorage.setItem(e,i),{value:t,oldValue:o,location:l}}if(w(r)){var h=s(a.getCookie(e));return a.setCookie(e,i),{value:t,oldValue:h,location:u}}var f=c[e];return c[e]=t,{value:t,oldValue:f,location:d}}function b(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return!1;var n=y(t);return v(n)?(localStorage.removeItem(e),l):w(n)?(a.removeCookie(e),u):(c[e]=void 0,d)}function y(e){return"string"==typeof e?e:e.storage}function v(e){return h&&(!e||e===l)}function w(e){return f&&(!e||e===u)}var E={getItem:p,setItem:g,removeItem:b};n.getCookie=a.getCookie,n.setCookie=a.setCookie,n.removeCookie=a.removeCookie,n.hasCookieSupport=a.hasCookieSupport,n.getItem=p,n.setItem=g,n.removeItem=b,n.globalContext=c,n.hasLocalStorageSupport=i,n.default=E},{"@analytics/cookie-utils":"e2ee0d1469319bab771bf69a6222e0fe"}],e2ee0d1469319bab771bf69a6222e0fe:[function(e,t,n){"use strict";function r(e,t,n,r,a,i){if("undefined"!=typeof window)return arguments.length>1?document.cookie=e+"="+encodeURIComponent(t)+(n?"; expires="+new Date(+new Date+1e3*n).toUTCString()+(r?"; path="+r:"")+(a?"; domain="+a:"")+(i?"; secure":""):""):decodeURIComponent((("; "+document.cookie).split("; "+e+"=")[1]||"").split(";")[0])}Object.defineProperty(n,"__esModule",{value:!0});var a=r,i=r;n.hasCookieSupport=function(){try{r("_c_","1");var e=-1!==document.cookie.indexOf("_c_");return r("_c_","",-1),e}catch(e){return!1}},n.setCookie=i,n.getCookie=a,n.removeCookie=function(e){return r(e,"",-1)}},{}],f8a390fc060e13098b0d808785519872:[function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){r(e,t,n[t])}))}return e}Object.defineProperty(n,"__esModule",{value:!0});var i={trackingId:null,debug:!1,anonymizeIp:!1,customDimensions:{},resetCustomDimensionsOnPage:[],setCustomDimensionsToPage:!0},o={};function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!1,n=l(e),r=n.instanceName,s=n.instancePrefix;return{name:"google-analytics",config:a({},i,e),initialize:function(e){var t=e.config,n=e.instance;if(!t.trackingId)throw new Error("No GA trackingId defined");var i,l,u,d,f,p,m,g=t.customScriptSrc||"https://www.google-analytics.com/analytics.js";if(c(g)&&(i=window,l=document,u="script",d=g,f="ga",i.GoogleAnalyticsObject=f,i.ga=i.ga||function(){(i.ga.q=i.ga.q||[]).push(arguments)},i.ga.l=1*new Date,p=l.createElement(u),m=l.getElementsByTagName(u)[0],p.async=1,p.src=d,m.parentNode.insertBefore(p,m)),!o[r]){var b=a({cookieDomain:t.domain||"auto",siteSpeedSampleRate:t.siteSpeedSampleRate||1,sampleRate:t.sampleRate||100,allowLinker:!0},t.cookieConfig);if(r&&(b.name=r),ga("create",t.trackingId,b),t.debug&&(ga("".concat(s,"set"),"sendHitTask",null),window.ga_debug={trace:!0}),t.anonymizeIp&&ga("".concat(s,"set"),"anonymizeIp",!0),t.tasks){["customTask","previewTask","checkProtocolTask","validationTask","checkStorageTask","historyImportTask","samplerTask","buildHitTask","sendHitTask","timingTask","displayFeaturesTask"].forEach((function(e){if(t.tasks.hasOwnProperty(e)){var n=t.tasks[e];"function"==typeof n?ga(t.tasks[e]):null===n&&ga("".concat(s,"set"),e,n)}}))}var y=(n.user()||{}).traits||{};if(Object.keys(y).length){var v=h(y,t);ga("".concat(s,"set"),v)}o[r]=!0}},page:function(e){var n=e.payload,r=e.config,i=e.instance,o=n.properties,l=r.resetCustomDimensionsOnPage,u=r.customDimensions,h=i.getState("context.campaign");if(!c()){if(l&&l.length){var f=l.reduce((function(e,t){return u[t]&&(e[u[t]]=null),e}),{});Object.keys(f).length&&ga("".concat(s,"set"),f)}var m=o.path||document.location.pathname,g={page:m,title:o.title,location:o.url},b={page:m,title:o.title};o.referrer!==document.referrer&&(b.referrer=o.referrer);var y=a({},g,d(h),p(o,r,s));ga("".concat(s,"set"),b),t&&delete y.location,ga("".concat(s,"send"),"pageview",y),t=!0}},track:function(e){var t=e.payload,n=e.config,r=e.instance,a=t.properties,i=t.event,o=a.label,s=a.value;u({hitType:"event",event:i,label:o,category:a.category||"All",value:s,nonInteraction:a.nonInteraction,campaign:r.getState("context.campaign")},n,t)},identify:function(e){var t=e.payload,n=e.config;m(t.userId,t.traits,n)},loaded:function(){return!!window.gaplugins}}}function c(e){return e?!function(e){var t=document.querySelectorAll("script[src]");return!!Object.keys(t).filter((function(n){return(t[n].src||"")===e})).length}(e):"undefined"==typeof ga}function l(e){var t=e.instanceName;return{instancePrefix:t?"".concat(t,"."):"",instanceName:t}}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;if(!c()){var r=l(t),i=r.instancePrefix,o={hitType:e.hitType||"event",eventAction:e.event,eventLabel:e.label,eventCategory:e.category||"All",nonInteraction:void 0!==e.nonInteraction&&!!e.nonInteraction};e.value&&(o.eventValue=g(e.value));var s=d(e),u=p(n.properties,t,i),h=a({},o,s,u);return ga("".concat(i,"send"),"event",h),h}}function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={},n=e.name,r=e.source,a=e.medium,i=e.content,o=e.keyword;return n&&(t.campaignName=n),r&&(t.campaignSource=r),a&&(t.campaignMedium=a),i&&(t.campaignContent=i),o&&(t.campaignKeyword=o),t}function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.customDimensions;return Object.keys(n).reduce((function(t,r){var a=n[r],i=f(e,r)||e[r];return"boolean"==typeof i&&(i=i.toString()),i||0===i?(t[a]=i,t):t}),{})}function f(e,t,n,r,a){for(t=t.split?t.split("."):t,r=0;r<t.length;r++)e=e?e[t[r]]:a;return e===a?n:e}function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=h(e,t);return Object.keys(r).length?t.setCustomDimensionsToPage?(ga("".concat(n,"set"),r),{}):r:{}}function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!c()){var r=l(n),a=r.instancePrefix;if(e&&ga("".concat(a,"set"),"userId",e),Object.keys(t).length){var i=h(t,n);ga("".concat(a,"set"),i)}}}function g(e){return!e||e<0?0:Math.round(e)}var b=s,y=s,v=u,w=m;n.default=b,n.init=y,n.identify=w,n.track=v,n.page=void 0,n.initialize=void 0},{}],"031cb3b2740f0f1394fdd6d3e19f774d":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.DEFAULT_OPTIONS=n.EYE_COLOURS=n.NAMES=void 0;var r=e("./timing/timing.js"),a=e("./palette"),i=e("./audio/audio"),o=e("./maths"),s=e("./audio/instruments"),c=e("./ui"),l=e("./record"),u=e("./visual/2d");const d=["a","b","c"].map(e=>"person-"+e);n.NAMES=d;n.EYE_COLOURS=["blue","green","brown","orange"];const h={...a.DEFAULT_COLOURS,delayTime:.14,delayLength:10,swapControls:!1,photoSensitive:!1,drawMesh:!1,drawNodes:!0,mouseHoldDuration:.6,eyeShutHolddDuration:3500,feedback:.1,rollSensitivity:1.2,pitchSensitivity:1,mouthCutOff:.2,mouthSilence:.05,volumeRate:.7,precision:3,ease:o.easeInSine};n.DEFAULT_OPTIONS=h;n.default=class{constructor(e,t,n,r={}){this.options=Object.assign({},h,r),this.name=e,this.counter=0,this.index=0,this.instrumentLoading=!1,this.data=null,this.audioContext=t,this.active=!1,this.tracks=0,this.octave=4,this.midi=null,this.midiActive=!1,this.midiChannel="all",this.isLooping=!1,this.isPlayingBack=!1,this.hue=r.hue||360*Math.random(),this.saturation=40,this.precision=Math.pow(10,parseInt(this.options.precision)),this.parameterRecorder=new l.ParamaterRecorder(t),this.yaw=0,this.pitch=0,this.roll=0,this.singing=!1,this.isMouthOpen=!1,this.isLeftEyeOpen=!0,this.isRightEyeOpen=!0,this.isRecordingParameters=!1,this.mouseDownAt=-1,this.leftEyeClosedAt=-1,this.rightEyeClosedAt=-1,this.lastNoteName="A0",this.lastNoteSound="-",this.debug=r.debug||!1,this.mouthScale=(0,o.rescale)(this.options.mouthCutOff),this.stereoNode=t.createStereoPanner();const a=t.createDelay(this.options.delayLength),s=t.createGain();a.delayTime.value=this.options.delayTime,s.gain.value=this.options.feedback,this.gainNode=t.createGain(),this.gainNode.gain.value=0,this.stereoNode.connect(this.gainNode),this.gainNode.connect(n),this.button=document.getElementById(e),this.button.addEventListener("mousedown",e=>{this.mouseDownAt=t.currentTime;const n=()=>{this.mouseDownFor<this.options.mouseHoldDuration?requestAnimationFrame(n):this.isMouseDown&&(this.mouseDownAt=-1,this.showForm())};n(),e.preventDefault()}),this.button.addEventListener("mouseup",e=>{this.mouseDownFor;this.instrumentLoading||this.loadInstrument((0,i.randomInstrument)()),this.mouseDownAt=-1,e.preventDefault()}),this.button.addEventListener("mouseover",e=>{this.isMouseOver=!0}),this.button.addEventListener("mouseout",e=>{this.isMouseOver=!1})}get areEyesOpen(){return this.isLeftEyeOpen&&this.isRightEyeOpen}get mouseDownFor(){return this.audioContext.currentTime-this.mouseDownAt}get isMouseDown(){return this.mouseDownAt>-1}get isMouseHeld(){return this.options.mouseHoldDuration<this.mouseDownFor}get controlsID(){return this.name+"-controls"}get controls(){return document.getElementById(this.controlsID)}get instrumentName(){return this.instrument?this.instrument.name:"loading"}get instrumentTitle(){return this.instrument?this.instrument.title:"loading"}get instrumentIndex(){return s.INSTRUMENT_FOLDERS.indexOf(this.instrumentName)}get hasMIDI(){return null!==this.midi&&this.midiChannel&&this.midiChannel.length>0}get MIDIDeviceName(){return this.midi?this.midi.name:"unknown"}get history(){return this.parameterRecorder.recording}update(e){this.counter++,this.data=e,this.isRecordingParameters&&this.parameterRecorder.save(e),this.isLeftEyeOpen!==!e.leftEyeClosed&&(e.leftEyeClosed?this.onLeftEyeClose(e.time):this.onLeftEyeOpen(e.time-this.leftEyeClosedAt),this.isLeftEyeOpen=!e.leftEyeClosed),this.isRightEyeOpen!==!e.rightEyeClosed&&(e.rightEyeClosed?this.onRightEyeClose(e.time):this.onRightEyeOpen(e.time-this.rightEyeClosedAt),this.isRightEyeOpen=!e.rightEyeClosed)}draw(e,t=!0,n=!1){if(!(n||e||this.prediction||this.isPlayingBack))return;e&&!n||(e=this.prediction),this.isPlayingBack;let r=this.hue;this.instrumentLoading&&(r+=120);let a=this.saturation;const o=this.options,s=this.isRightEyeOpen?-1:e.time-this.rightEyeClosedAt,c=this.isLeftEyeOpen?-1:e.time-this.leftEyeClosedAt;o.dots=r,o.mouth=`hsla(${(r+30)%360},${a}%,40%,0.8)`,o.mouthClosed=`hsla(${(r+30)%360},${a}%,10%,0.99)`,o.lipsUpperInner=`hsla(${(r+50)%360},${a}%,50%,1)`,o.lipsLowerInner=`hsla(${(r+50)%360},${a}%,50%,1)`,o.midwayBetweenEyes=`hsla(${(r+270)%360},${a}%,50%,1)`,o.leftEyeLower0=`hsla(${(r+300)%360},${a}%,50%,0.8)`,o.rightEyeLower0=`hsla(${(r+300)%360},${a}%,50%,0.8)`,o.leftEyeIris=`hsla(${(this.isLeftEyeOpen?r+90:r-90)%360},${a}%,50%,1)`,o.rightEyeIris=`hsla(${(this.isRightEyeOpen?r+90:r-90)%360},${a}%,50%,1)`,o.drawMesh&&(0,u.drawFaceMesh)(e,o.dots,this.instrumentLoading,this.debug),o.drawNodes&&(0,u.drawPoints)(e,o.dots,3,this.instrumentLoading,this.debug),(0,u.drawFace)(e,o,this.singing,this.isMouthOpen,this.debug);const{bottomRight:l,topLeft:d}=e.boundingBox,h=Math.abs(l[0]-d[0]),f=Math.abs(l[1]-d[1]);this.counter%22==0&&this.button.setAttribute("style",`--${this.name}-x:${l[0]};--${this.name}-y:${d[1]};--${this.name}-w:${h};--${this.name}-h:${f};`);const{annotations:p}=e,{silhouette:m}=p,g=this.instrumentLoading||this.isRightEyeOpen||this.isLeftEyeOpen?-1:Math.max(c,s);if(g>o.eyeShutHolddDuration?(console.log("EYES SHUT",{rightEyeClosedFor:s,leftEyeClosedFor:c,eyesClosedFor:g,ro:this.isRightEyeOpen,lo:this.isLeftEyeOpen,time:e.time,rca:this.rightEyeClosedAt,lca:this.leftEyeClosedAt}),this.leftEyeClosedAt=e.time,this.rightEyeClosedAt=e.time,this.loadNextInstrument(e=>console.log("instrumnetName",e))):(this.isLeftEyeOpen&&(0,u.drawEye)(p.leftEyeIris,o.leftEyeIris),this.isRightEyeOpen&&(0,u.drawEye)(p.rightEyeIris,o.rightEyeIris)),t)if(this.isMouseOver||this.instrumentLoading)if(this.isMouseDown&&!this.instrumentLoading){const t=1-this.mouseDownFor/this.options.mouseHoldDuration,n=100-Math.ceil(100*t);this.isMouseHeld?((0,u.drawInstrument)(e.boundingBox,this.instrumentTitle,"Select"),(0,u.drawPart)(m,4,`hsla(${r},50%,${n}%,0.3)`,!0),(0,u.drawParagraph)(e.boundingBox.topLeft[0],e.boundingBox.topLeft[1]+40,["Press me"],"14px")):((0,u.drawInstrument)(e.boundingBox,this.instrumentTitle,""+(100-n)),(0,u.drawPart)(m,4,`hsla(${r},50%,${n}%,0.5)`,!0),(0,u.drawParagraph)(e.boundingBox.topLeft[0],e.boundingBox.topLeft[1]+40,["Hold me to see all instruments"],"14px"))}else(0,u.drawInstrument)(e.boundingBox,this.instrumentTitle,"Press to change instrument"),(0,u.drawPart)(m,4,"hsla("+r+",50%,50%,0.3)",!0);else if(this.instrumentLoading)(0,u.drawInstrument)(e.boundingBox,this.instrumentTitle,"loading...");else{const t=(this.debug," "+(0,i.getNoteText)(this.lastNoteName)),n=this.singing?"| â™« "+this.lastNoteSound:this.isMouthOpen?"<":"-";if((0,u.drawInstrument)(e.boundingBox,this.instrumentTitle,`${t} ${n}`),this.debug){const t=["Gain:"+this.gainNode.gain.value.toFixed(2),"Happiness:"+e.happiness.toFixed(3),`Smirks left:${e.leftSmirk.toFixed(3)} / right:${e.rightSmirk.toFixed(3)}`,"mouthRange:"+e.mouthRange.toFixed(3),"mouthRatio:"+e.mouthRatio.toFixed(3),"mouthWidth:"+e.mouthWidth.toFixed(3),"mouthOpen:"+e.mouthOpen.toFixed(3),`pitch:${e.pitch.toFixed(3)} roll:${e.roll.toFixed(3)} yaw:${e.yaw.toFixed(3)}`,`eyes direction:${e.eyeDirection.toFixed(3)} left:${e.leftEye.toFixed(3)} right:${e.rightEye.toFixed(3)}`,`eyes open :${this.areEyesOpen} left:${!e.leftEyeClosed} right:${!e.rightEyeClosed}`,`eye closed left:${e.leftEyeClosed} right:${e.rightEyeClosed}`,`dims:${e.mouthWidth.toFixed(2)}x${e.mouthRange.toFixed(2)}`,(e.lookingRight,"left")];(0,u.drawParagraph)(e.boundingBox.topLeft[0],e.boundingBox.topLeft[1]+40,t,"14px")}}}sing(){if(!this.data||this.tracks>18)return{yaw:0,pitch:0,lipPercentage:0,eyeDirection:0};i.active;const e=this.data,t=this.options,n=e.mouthOpen,a=e.yaw,s=(0,o.clamp)(.5*(e.pitch+1)*this.options.pitchSensitivity,0,1),c=(0,o.clamp)((e.roll+.5)*this.options.rollSensitivity,0,1),l=this.options.swapControls?c:s,u=this.options.swapControls?s:c,d=(0,o.clamp)(e.eyeDirection,-1,1),h=(0,o.clamp)(n,0,1),f=(t.ease(h),Math.round(7*l));this.octave=f;const p=e.lookingRight,m=(0,i.getNoteName)(u,this.octave,p),g=(0,i.getNoteSound)(u,p);let b;if(this.lastNoteName=m,this.lastNoteSound=g,this.hue=360*u,this.saturation=100*n,this.stereoNode.pan.value=d,this.instrument&&h>=t.mouthCutOff){const e=this.instrument[m];e||console.log("note not found!",{noteName:m,roll:u,octave:this.octave,isMinor:p}),this.tracks++;(0,i.playTrack)(e,0,this.stereoNode).then(()=>{this.active=!1,this.tracks--});if(b=this.mouthScale(h),b=t.ease(b),b=Math.round(b*this.precision)/this.precision,this.hasMIDI){const e={channels:this.midiChannel,attack:b};this.midi.playNote(m,e),this.midiActive?this.midi.setKeyAftertouch(m,.5*(d+1)):this.midiActive=!0}this.singing=!0,this.isMouthOpen=!0,this.active=!0}else h>t.mouthSilence&&h<t.mouthCutOff?(b=0,this.singing=!1,this.isMouthOpen=!0):(b=0,this.singing=!1,this.isMouthOpen=!1);return this.hasMIDI&&(this.midi.sendClock(),this.midi.setSongPosition(16383*(0,r.getBarProgress)()),this.singing||(this.midi.stopNote(m,{release:.2}),this.midi.turnSoundOff(),this.midi.turnNotesOff(),this.midiActive=!1,console.log(this.midi,"MIDI turnSoundOff",m,"Channel:"+this.midiChannel,{channel:this.midiChannel,hasMIDI:this.hasMIDI,MIDIDeviceName:this.MIDIDeviceName}))),this.gainNode.gain.value=b,this.yaw=a,this.pitch=l,this.roll=u,{yaw:a,pitch:l,roll:u,lipPercentage:n,eyeDirection:d}}async loadRandomInstrument(e){return await this.loadInstrument((0,i.randomInstrument)(),e)}async loadPreviousInstrument(e){const t=this.index,n=t-1<0?0:t-1;return await this.loadInstrument(s.INSTRUMENT_FOLDERS[n],e)}async loadNextInstrument(e){const t=this.index,n=t+1>=s.INSTRUMENT_FOLDERS.length?0:t+1;return await this.loadInstrument(s.INSTRUMENT_FOLDERS[n],e)}async loadInstrument(e,t){return this.instrumentLoading=!0,this.instrument=await(0,i.loadInstrument)(e),this.index=s.INSTRUMENT_FOLDERS.indexOf(e),this.instrumentLoading=!1,console.log(this.index,"Attempting to load instruments",e,this.instrument),t&&t(e),this.button.dispatchEvent(new CustomEvent("instrumentchange",{detail:{instrument:this.instrument,instrumentName:e}})),e}setMIDI(e,t="all"){this.midiChannel=t,this.midi=e}onInstrumentInput(e){const t=e.target.id;this.hideForm(),this.loadInstrument(t),e.preventDefault()}onLeftEyeOpen(e){this.leftEyeClosedAt=-1}onLeftEyeClose(e){this.leftEyeClosedAt=e}onRightEyeOpen(e){this.rightEyeClosedAt=-1}onRightEyeClose(e){this.rightEyeClosedAt=e}showForm(){this.controls.innerHTML=(0,c.setupInstrumentForm)(()=>{});this.controls.querySelectorAll("input").forEach(e=>e.addEventListener("change",e=>this.onInstrumentInput(e)),!1);const e=document.getElementById(this.instrumentName);e?e.focus():this.controls.focus(),this.controls.classList.toggle("showing",!0)}hideForm(){this.controls.innerHTML="",setTimeout(()=>this.controls.classList.toggle("showing",!1),303)}}},{"./timing/timing.js":"af0b8472eefa4fe4e4000c4e9ae1bf1f","./palette":"4c4f18d38f1111efa08d8ccdf0962cfd","./audio/audio":"96a3cf8e6eb7e0adf88768f97d328ae3","./maths":"b35d1feb9582910dececcb2468237235","./audio/instruments":"e5a876cfe90709c6f27591258fb40c97","./ui":"225163ea33f2498ca7c169419e0a05ce","./record":"50659b8cfc25a32b08a2889c62d90b7f","./visual/2d":"3f5dc1d45338b40d52343cf73ba2ceeb"}],e7b6caadf340d1bc8ab94ffab80f749b:[function(e,t,n){t.exports=e("./loaders/browser/js-loader")(e("./bundle-url").getBundleURL()+e("./relative-path")("4fbf1b244680f9c1","5f716d0343311b2c")).then(()=>parcelRequire("81d3e14b062ccc8bca44ae8a8465b649"))},{"./loaders/browser/js-loader":"34e5ef4c326f00e0ac137ca9f5c3937e","./bundle-url":"34a193fc56a5d6c91978a6a2a73f8a25","./relative-path":"6df9a76891b0a602dcb789af9c631254"}],"34e5ef4c326f00e0ac137ca9f5c3937e":[function(e,t,n){const r=e("../../cacheLoader");t.exports=r((function(e){return new Promise((function(t,n){var r=document.createElement("script");r.async=!0,r.type="text/javascript",r.charset="utf-8",r.src=e,r.onerror=function(e){r.onerror=r.onload=null,n(e)},r.onload=function(){r.onerror=r.onload=null,t()},document.getElementsByTagName("head")[0].appendChild(r)}))}))},{"../../cacheLoader":"00c3efd131eab2c500b42095784bb07b"}],"00c3efd131eab2c500b42095784bb07b":[function(e,t,n){"use strict";let r={};t.exports=function(e){return function(t){return r[t]?r[t]:r[t]=e(t).catch((function(e){throw delete r[t],e}))}}},{}],"325e2e94a2166b9e05179c85ec56b2d9":[function(e,t,n){t.exports=e("./loaders/browser/js-loader")(e("./bundle-url").getBundleURL()+e("./relative-path")("4fbf1b244680f9c1","79de41c3db5d61cf")).then(()=>parcelRequire("b8baee5fe9cffc0bb8bacbb247e0ad31"))},{"./loaders/browser/js-loader":"34e5ef4c326f00e0ac137ca9f5c3937e","./bundle-url":"34a193fc56a5d6c91978a6a2a73f8a25","./relative-path":"6df9a76891b0a602dcb789af9c631254"}],f5f88b3c462ea3f5a47e0c1589bd10d2:[function(e,t,n){t.exports=e("./loaders/browser/js-loader")(e("./bundle-url").getBundleURL()+e("./relative-path")("4fbf1b244680f9c1","2ba7824af5e268d5")).then(()=>parcelRequire("95686a1cc9fc85bc3a08e657010f6838"))},{"./loaders/browser/js-loader":"34e5ef4c326f00e0ac137ca9f5c3937e","./bundle-url":"34a193fc56a5d6c91978a6a2a73f8a25","./relative-path":"6df9a76891b0a602dcb789af9c631254"}]},{},["abaa9ffbe3b7a8f82068e90ca2e8cce3","efca12737c12381f691dd183f44917ef"]);