!function(e,t,n,r){var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},o="function"==typeof i.parcelRequire&&i.parcelRequire,a="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function s(n,r){if(!t[n]){if(!e[n]){var i="function"==typeof parcelRequire&&parcelRequire;if(!r&&i)return i(n,!0);if(o)return o(n,!0);if(a&&"string"==typeof n)return a(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}l.resolve=function(t){return e[n][1][t]||t},l.cache={};var u=t[n]=new s.Module(n);e[n][0].call(u.exports,l,u,u.exports,this)}return t[n].exports;function l(e){return s(l.resolve(e))}}s.isParcelRequire=!0,s.Module=function(e){this.id=e,this.bundle=s,this.exports={}},s.modules=e,s.cache=t,s.parent=o,s.register=function(t,n){e[t]=[function(e,t){t.exports=n},{}]},i.parcelRequire=s;for(var c=0;c<n.length;c++)s(n[c]);if(n.length){var u=s(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=u:"function"==typeof define&&define.amd&&define((function(){return u}))}}({"5314fba19ae42fb7cd92712bb7180d1d":[function(e,t,n){e("./bundle-manifest").register(JSON.parse('{"f56c669d1026d19f":"source.2ce4a500.js","b089253c118b6f40":"predictor.6fe6ec07.js","d54097c20170a850":"share-menu.0b6caca7.js","de0c4bbb21341183":"manifest.067d87cc.webmanifest","7a8ce0e9b4e134c6":"update.0f6f5c6a.js","5b8d97bef6056dba":"service-worker.js"}'))},{"./bundle-manifest":"7bd0744a1d6e904180ae29467f4e3090"}],"7bd0744a1d6e904180ae29467f4e3090":[function(e,t,n){"use strict";var r={};t.exports.register=function(e){for(var t=Object.keys(e),n=0;n<t.length;n++)r[t[n]]=e[t[n]]},t.exports.resolve=function(e){var t=r[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}},{}],"098cc988061dd902c257e1316c740bdd":[function(e,t,n){"use strict";var r=e("./install.js"),i=e("./store"),o=e("./speech"),a=e("./audio"),s=e("./timing.js"),c=e("./ui"),u=e("./location-handler"),l=e("./synthesizers"),d=e("./midi"),h=e("./camera"),f=e("./visual"),p=e("./patterns"),m=e("./instructions"),g=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=v();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}n.default=e,t&&t.set(e,n);return n}(e("./person")),y=e("./reporting"),b=e("./version");function v(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return v=function(){return e},e}const _=document.documentElement,w=document.querySelector("main"),I=document.querySelector("img"),{isRecording:S,startRecording:E,stopRecording:C}=(0,a.record)(),A=(0,i.createStore)(),M=[];let T,x,N,O,B,k,D,R,P,L=c.video,F=!0,V=!1,U=!1,j=!1,G=!1,q=0;const Q={x:1,y:1};_.classList.toggle("loading",!0);const z=(0,u.getLocationSettings)({metronome:!1,backingTrack:!1,clear:!0,transparent:!0,synch:!0,debug:!1,muted:!1,duet:!1,quantise:!0,text:!0,spectrogram:!0}),W={maxFaces:z.duet?2:1,shouldLoadIrisModel:!0},H=async(e,t)=>M.map(async n=>{const r=await n[e](t);return A.setItem(n.name,{instrument:r}),(0,c.setFeedback)(`${n.name} has ${r} loaded`),console.log(`${n.name} has ${r} loaded`),r}),Z=async e=>await H("loadRandomInstrument",e),Y=e=>{z.duet;if(null==M[e]){const t={dots:"green",leftEyeIris:"blue",rightEyeIris:"blue",hue:360*Math.random(),debug:z.debug},n=g.NAMES[e],r=A.has(n)?A.getItem(n):{},i=new g.default(n,a.audioContext,N,t),o=r.instrument||(0,a.randomInstrument)();return i.button.addEventListener("instrumentchange",e=>{const{detail:t}=e;A.setItem(n,{instrument:t.instrumentName})}),i.loadInstrument(o,e=>{}),O&&O.outputs&&O.outputs.length>0&&i.setMIDI(O.outputs[0]),M.push(i),i}return M[e]},X=(e=0,t=0)=>{const n=Y(e);n.setMIDI(O.outputs[t]),console.log("Enabling MIDI for",n)},J=async()=>(B=(0,c.setupMIDIButton)(async e=>(await(async()=>{try{O=await(0,d.setupMIDI)(),O.outputs.length>0?(console.log("MIDI devices",O.outputs,O),(0,c.setFeedback)("MIDI Available<br>Stand By",0),X(0,0)):(console.log("No MIDI devices detected",O),(0,c.setFeedback)("MIDI Available but no instruments detected",0),(0,c.setToast)("No MIDI Device connected"),w.classList.toggle("midi-no-devices",!0)),O.addListener("connected",e=>{console.log(e),(0,c.setFeedback)("MIDI Device connected!"),O.outputs.length>0&&(w.classList.toggle("midi-no-devices",!1),M.forEach((e,t)=>X(t,0))),B.setText("Click to disable")}),O.addListener("disconnected",e=>{console.log(e),(0,c.setFeedback)("Lost MIDI Device connection"),O.outputs.length>0||w.classList.toggle("midi-no-devices",!0)}),U=O,w.classList.add("midi-available"),(0,c.setToast)(O.outputs.length>0?"MIDI Connected":"Connect a MIDI Device to continue")}catch(e){return console.error("Total failure",e),(0,c.setFeedback)("MIDI NOT Available<br>"+e,0),!1}return!0})(),(0,c.setFeedback)("MIDI available<br>Connecting to instruments...",0),console.log("User input detected so enabling MIDI!"),w.classList.add("midi-activated"),!1)),!0),$=async(e,t="Default")=>{let n;j=!0;try{n=await(0,h.setupCamera)(c.video,e),e&&e.length>0&&(A.setItem("camera",{deviceId:e}),console.log(e,"Camera id saved")),(0,y.track)("Action",{category:"Camera",label:t,value:e})}catch(n){throw console.error(e,"Camera errored",n),(0,y.trackError)(t+" camera could not be accessed",e,"Camera"),n}return j=!1,n};(0,c.setFeedback)("Initialising...<br> Please wait");let K=null,ee=0;const te=async()=>{F?requestAnimationFrame(te):V?(_.classList.add("failure"),(0,c.showReloadButton)()):(async()=>{if(_.classList.toggle("loaded",!0),_.classList.remove("loading"),K)try{const e=document.getElementById("shared-controls"),t=await K(e);(0,c.setToast)(t?"You can install this as an app! Click install below":"")}catch(e){console.error("Install/Update issue",e)}else console.log("Loaded Webpage",b.VERSION);try{await e("share-menu")}catch(e){document.getElementById("share").style.display="none"}(0,o.hasSpeech)()&&(0,o.say)("Open your mouth to begin!",!0)})()};(async(t,n)=>{let r=0;n(r++/10);const{loadModel:i}=await e("./predictor");n(r++/10),(0,c.setupInterface)(z),n(r++/10),(0,c.setToggle)("button-quantise",e=>{z.quantise=e,(0,u.addToHistory)(z,"quantise"),w.classList.toggle("flag-quantise",e),(0,c.setToast)("Quantise "+(z.quantise?"enabled":"disabled"))},z.quantise),(0,c.setToggle)("button-metronome",e=>{z.metronome=e,(0,u.addToHistory)(z,"metronome"),w.classList.toggle("flag-metronome",e),(0,c.setToast)("Metronome "+(z.metronome?"enabled":"disabled"))},z.metronome),(0,c.setToggle)("button-spectrogram",e=>{z.spectrogram=e,(0,u.addToHistory)(z,"spectrogram"),w.classList.toggle("flag-spectrogram",e),(0,c.setToast)("Spectrogram "+(z.spectrogram?"enabled":"disabled"))},z.spectrogram),(0,c.setToggle)("button-transparent",e=>{z.transparent=e,(0,u.addToHistory)(z,"transparent"),w.classList.toggle("flag-transparent",e),(0,c.setToast)("Video Synch "+(z.spectrogram?"enabled":"disabled"))},z.transparent),(0,c.setToggle)("button-clear",e=>{z.clear=e,(0,u.addToHistory)(z,"clear"),w.classList.toggle("flag-clear",e)},z.clear),(0,c.setToggle)("button-overlay",e=>(0,c.toggleVideoVisiblity)(),!(0,c.isVideoVisible)()),(0,c.setButton)("button-video",e=>Z()),(0,c.setButton)("button-photograph",e=>{const t=Math.ceil(1e7*(0,s.now)()),n="photograph-"+t,r=(0,f.getCanvasDimensions)(),i=new Image;i.src=(0,f.takePhotograph)(),i.alt="Photograph taken "+Date.now().toString(),i.width=r.width,i.height=r.height;const o=document.createElement("a");o.href=i.src,o.innerHTML="Click to download this photograph",o.id=n,o.download=`snapshot-${t}.png`,o.appendChild(i),document.getElementById("photographs").appendChild(o),requestAnimationFrame(()=>document.getElementById(n).scrollIntoView())}),n(r++/10),k=(0,y.setupReporting)("InterFACE"),i(L,t).then(async e=>{try{if((0,c.setFeedback)("Setting things up"),n(r++/10),I&&((0,c.setFeedback)("Image downloaded...<br> Please wait"),x=await(0,f.setupImage)(I)),n(r++/10),c.video){const e=A.has("camera")?A.getItem("camera").deviceId:void 0;(0,c.setFeedback)(e?"Found saved camera":"Attempting to locate camera...");try{T=await $(e,"Saved")}catch(e){(0,c.setFeedback)("Could not open saved camera, looking for another..."),T=await $(),A.removeItem("cameraId")}const t=(0,h.filterVideoCameras)(await(0,h.detectCameras)());t.length>1&&(0,c.setupCameraForm)(t,async e=>{T=$(e.deviceId,e.label),(0,c.setToast)(`Camera ${e.label} changed`,0)}),(0,c.setFeedback)("Camera located!",0),n(r++/10)}w.style.setProperty("--width",c.video.width),w.style.setProperty("--height",c.video.height),w.classList.toggle("landscape",c.video.width>c.video.height),w.classList.toggle("portrait",c.video.width<c.video.height),w.classList.toggle("square",c.video.width===c.video.height),(0,f.updateCanvasSize)(c.video.width,c.video.height),n(r++/10)}catch(e){const t=String(e).replace("NotAllowedError: ","");return(0,c.setFeedback)("Camera could not be accessed<br>"+t,0),(0,c.setToast)(t),F=!1,V=!0,void(0,y.trackError)("Camera Rejected or Not allowed")}try{N=(0,a.setupAudio)(),(0,c.setFeedback)("Audio Available...<br>Instrument undefined Sounds downloaded",0),n(r++/10),D=(0,l.createDrumkit)(),R=(0,p.kitSequence)(),(0,c.setFeedback)("Audio available...<br>Instrument Sounds ready"),n(r++/10)}catch(e){return V=!0,void(0,c.setFeedback)("Something went wrong with the Audio<br>"+e,0)}try{await J()?(w.classList.add("midi"),(0,c.setFeedback)("MIDI available<br>Click the button to connect",0)):(w.classList.add("midi","no-instrument"),(0,c.setFeedback)("MIDI available<br>Connect an instrument <small>and click the button</small>",0)),n(r++/10)}catch(e){console.log("no MIDI!",e),w.classList.add("no-midi"),(0,c.setFeedback)("MIDI unavailable, or no instrument connected<br>"+e,0)}f.canvas.width=L.width,f.canvas.height=L.height,w.classList.add(L.nodeName.toLowerCase());const t=A.getItem("audio")?A.getItem("audio").volume:1;(0,a.setVolume)(t),n(r++/10);e(L===c.video,e=>{if(F&&(F=!1),j)return;let t="";if(q++,z.clear)(0,f.clear)(),z.transparent||(0,f.drawElement)(L);else{const e=.01*q;(0,f.overdraw)(-7*Q.x+Math.sin(e),-4*Q.y+Math.cos(e))}if(z.quantise&&(0,f.drawQuantise)(!0,(0,s.getBar)()),z.spectrogram&&((0,a.updateByteFrequencyData)(),(0,f.drawBars)(a.dataArray,a.bufferLength)),e)for(let n=0,r=e.length;n<r;++n){const r=e[n],i=Y(n);if(!(r&&r.faceInViewConfidence>.9))return void(G?(0,c.setFeedback)((0,m.getHelp)(Math.floor(q/100))):(w.classList.toggle(i.name+"-active",!1),w.classList.toggle("no-faces",!0),G=!0));if(G&&(G=!1,w.classList.toggle(i.name+"-active",!0),w.classList.toggle("no-faces",!1)),i.update(r),i.draw(r,z.text),!z.quantise&&!z.muted){const e=i.sing();0===n&&(Q.x=e.eyeDirection,Q.y=e.pitch)}t+=`<br>PITCH:${r.pitch} ROLL:${r.roll} YAW:${r.yaw} MOUTH:${Math.ceil(100*r.mouthRange/g.DEFAULT_OPTIONS.LIPS_RANGE)}%`}e?(0,c.setFeedback)((0,m.getInstruction)(Math.floor(q/100))):(0,c.setFeedback)((0,m.getHelp)(Math.floor(q/100)))},()=>!j);(0,s.start)(({bar:e,bars:t,barsElapsed:n,timePassed:r,elapsed:i,expected:o,drift:s,level:c,intervals:u,lag:l})=>{if(!z.muted){if(z.metronome){const e=.1;D.clack(e,t%4==0?.1:.2)}if(z.quantise)for(let e=0,t=M.length;e<t;++e){const t=Y(e).sing();0===e&&(Q.x=t.eyeDirection,Q.y=t.pitch)}if(z.backingTrack&&e%2==0){const e=(0,p.playNextPart)(R.kick,D.kick),t=(0,p.playNextPart)(R.snare,D.snare),n=(0,p.playNextPart)(R.hat,D.hat);console.error("backing|",{kick:e,snare:t,hat:n})}a.playing}},(0,s.timePerBar)())})})(Object.assign({},W,{}),e=>{c.progressBar.setAttribute("value",e),ee=e}),(0,c.setFeedback)("Loading...<br>Please wait"),(async()=>{try{K=await(0,r.installer)(!0);const{updateApp:t}=await e("./update.js"),{updater:n,updateAvailable:i}=await t();i&&((0,c.showUpdateButton)(n),(0,c.setToast)("An Update is available! Press update to install it")),console.log("installer",{installer:r.installer,installation:K})}catch(e){console.error("PWA",e)}})(),te(),window.onbeforeunload=()=>{(0,y.trackExit)(),(0,c.setToast)("bye bye!")},window.oncontextmenu=()=>{q=0},window.addEventListener("keydown",async e=>{switch(e.key){case"CapsLock":z.debug=!z.debug,M.forEach(e=>e.debug=z.debug),(0,c.setToast)("DEBUG : "+z.debug);break;case"Space":Z();break;case"ArrowLeft":(async e=>{await H("loadPreviousInstrument",e)})();break;case"ArrowRight":(async e=>{await H("loadNextInstrument",e)})();break;case"ArrowUp":let e=(0,s.getBars)()+1,t=(0,s.setBars)(e),n=(0,s.setTimeBetween)((0,s.timePerBar)());console.error("bars---",t,e,n),(0,c.setToast)(`Bars : ${t}} / BPM : ${(0,s.getBPM)()}`);break;case"ArrowDown":let r=(0,s.getBars)()-1,i=(0,s.setBars)(r),a=(0,s.setTimeBetween)((0,s.timePerBar)());console.error("bars---",i,r,a),(0,c.setToast)(`Bars ${i} / BPM : ${(0,s.getBPM)()}`);break;case",":(0,f.setNodeCount)(-1);break;case".":(0,f.setNodeCount)(1);break;case"w":D.cowbell();break;case"a":D.kick();break;case"s":D.snare();break;case"d":D.hat();break;case"q":D.clack();break;case"b":z.backingTrack=!z.backingTrack,(0,c.setToast)(z.backingTrack?"Backing track starting":"Ending Backing Track");break;case"c":z.clear=!z.clear;break;case"t":z.text=!z.text;break;case"r":S()?(console.error("Recording END",P),(0,c.setToast)("Recording Ended - now encoding"),C().then(e=>{const t=encodeRecording(e,"audio/mp3;"),n=window.URL.createObjectURL(t);console.error("Recording END",{recording:e,audioSrc:n,mp3:t})})):((0,c.setToast)("Recording START"),console.error("Recording START",N),P=await E(N),console.error("Recording...",P));break;case"Tab":break;case"v":c.video.style.visibility="hidden"===c.video.style.visibility?"visible":"hidden";break;case"m":z.metronome=!z.metronome,(0,c.setToast)(z.metronome?"Quantised enabled":"Quantise disabled");break;default:Z(),(0,o.say)("Loading random instruments",!0)}(0,u.addToHistory)(z,e.key),console.log("key",z,e)}),window.addEventListener("popstate",e=>{}),window.addEventListener("wheel",e=>{let t=e.detail;const n=e.deltaY||e.wheelDelta;let r;t=t?n&&(r=n/t)?t/r:-t/1.35:n/120,t=t<1?t<-1?(-Math.pow(t,2)-224)/225:t:(Math.pow(t,2)+224)/225;const i=.1*Math.min(Math.max(t/2,-1),1),o=(0,a.getVolume)(),s=(e=>{const t=(0,a.setVolume)(e);return A.setItem("audio",{volume:t}),(0,c.setToast)(`Volume ${Math.ceil(100*t)}%`,0),t})(o+i);console.log("mouse wheel",{wheel:i,volume:o,result:s},e)}),window.addEventListener("deviceorientation",e=>{})},{"./store":"ba5de09267de7d76186951c3db0534d9","./predictor":"72e9698d6e93910497e79689aabbebf2","./audio":"dd70e9d1edf82ea11611411db307fbf3","./timing.js":"bfab68a55c8ce3658ec0c92f8942684d","./ui":"cc509f6dc4e34d6bd3c8d4b98935925a","./location-handler":"99fcf05ce09eb6c13fde8b1abcb1879b","./synthesizers":"c4a8c05ce19cff181a1cac727798c03c","./midi":"b24ff78b69d5d45a293cadc71e7e5aed","./camera":"ce693141997b2d2648718d5ab03d6662","./visual":"65170211c1067042fc9b847ea066e7ce","./patterns":"e53dbd1dccb6fc721c56439b24350bb3","./instructions":"0bce1aa157a4a7e3c7c4cb99f9006f31","./person":"dd6a1e56851684b1b1584ee092f2589f","./version":"25488683cc04bb43faf629e105172bc8","./reporting":"dad49c631de14c19376524e29b658dc1","share-menu":"871cd3022c83973e381d7bf4518a0be5","./install.js":"f86476b6dfe525fe3e35c3b4270bbe11","./update.js":"e59f0caf2dbfcd7176158aec09f980e0","./speech":"590e4d478b3e99d42b27ee990cd750b8"}],ba5de09267de7d76186951c3db0534d9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.createStore=void 0;var r=e("./utils");n.createStore=(e="Plops")=>{const t=localStorage.getItem(e),n=Object.assign({},JSON.parse(t)),i=(0,r.debounce)(t=>{localStorage.setItem(e,JSON.stringify(t))},20);return{save:i,has:e=>!!n[e],removeItem:e=>{delete n[e]},getItem:e=>n[e],setItem:(e,t)=>(n[e]=Object.assign({},t,n[e]),i(n),n)}}},{"./utils":"569dc304b7e08c7a087e8d733528b9ee"}],"569dc304b7e08c7a087e8d733528b9ee":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.debounce=void 0;n.debounce=(e,t)=>{let n;return(...r)=>(clearTimeout(n),n=setTimeout(()=>e(...r),t),n)}},{}],"72e9698d6e93910497e79689aabbebf2":[function(e,t,n){t.exports=e("./loaders/browser/js-loader")(e("./bundle-url").getBundleURL()+e("./relative-path")("f56c669d1026d19f","b089253c118b6f40")).then(()=>parcelRequire("e68b6b48155dbccbcce05794bbedbf97"))},{"./loaders/browser/js-loader":"a9c840d63b072ad73ba68ab5bad5cba1","./bundle-url":"a079551cb6dc35425204fc0bb93fe7bb","./relative-path":"3d690079c6611245df705566cbbc1942"}],a9c840d63b072ad73ba68ab5bad5cba1:[function(e,t,n){const r=e("../../cacheLoader");t.exports=r((function(e){return new Promise((function(t,n){var r=document.createElement("script");r.async=!0,r.type="text/javascript",r.charset="utf-8",r.src=e,r.onerror=function(e){r.onerror=r.onload=null,n(e)},r.onload=function(){r.onerror=r.onload=null,t()},document.getElementsByTagName("head")[0].appendChild(r)}))}))},{"../../cacheLoader":"9bafdf9169957e2c85ca25fe116ad091"}],"9bafdf9169957e2c85ca25fe116ad091":[function(e,t,n){"use strict";let r={};t.exports=function(e){return function(t){return r[t]?r[t]:r[t]=e(t).catch((function(e){throw delete r[t],e}))}}},{}],a079551cb6dc35425204fc0bb93fe7bb:[function(e,t,n){"use strict";var r=null;function i(e){return(""+e).replace(/^((?:https?|file|ftp):\/\/.+)\/[^/]+$/,"$1")+"/"}n.getBundleURL=function(){return r||(r=function(){try{throw new Error}catch(t){var e=(""+t.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g);if(e)return i(e[0])}return"/"}()),r},n.getBaseURL=i,n.getOrigin=function(e){let t=(""+e).match(/(https?|file|ftp):\/\/[^/]+/);if(!t)throw new Error("Origin not found");return t[0]}},{}],"3d690079c6611245df705566cbbc1942":[function(e,t,n){"use strict";var r=e("./bundle-manifest").resolve;function i(e){if(""===e)return".";var t="/"===e[e.length-1]?e.slice(0,e.length-1):e,n=t.lastIndexOf("/");return-1===n?".":t.slice(0,n)}function o(e,t){if(e===t)return"";var n=e.split("/");"."===n[0]&&n.shift();var r,i,o=t.split("/");for("."===o[0]&&o.shift(),r=0;(r<o.length||r<n.length)&&null==i;r++)n[r]!==o[r]&&(i=r);var a=[];for(r=0;r<n.length-i;r++)a.push("..");return o.length>i&&a.push.apply(a,o.slice(i)),a.join("/")}t.exports=function(e,t){return o(i(r(e)),r(t))},t.exports._dirname=i,t.exports._relative=o},{"./bundle-manifest":"7bd0744a1d6e904180ae29467f4e3090"}],dd70e9d1edf82ea11611411db307fbf3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.record=n.loadInstrument=n.loadInstrumentParts=n.getNoteName=n.NOTE_NAMES=n.playTrack=n.setAmplitude=n.setVolume=n.getVolume=n.setFrequency=n.setShape=n.playAudio=n.stopAudio=n.updateByteTimeDomainData=n.updateByteFrequencyData=n.setupAudio=n.inputDryNode=n.inputNode=n.active=n.playing=n.dataArray=n.bufferLength=n.audioContext=n.randomInstrument=void 0;var r=e("./maths"),i=e("./instruments");const o=["A","Ab","B","Bb","C","D","Db","E","Eb","F","G","Gb"],a=["Ab","Bb","Db","Eb","Gb"],s=["A","B","C","D","E","F","G"];let c,u,l,d,h,f,p,m,g,y,b;n.randomInstrument=()=>i.INSTRUMENT_FOLDERS[Math.floor(Math.random()*i.INSTRUMENT_FOLDERS.length)],n.audioContext=c,n.bufferLength=l,n.dataArray=d;let v=0,_=!1;n.playing=_;let w=!1;n.active=w;n.inputNode=()=>f;n.inputDryNode=()=>h;n.setupAudio=(e=2048,t=1,r=1)=>(n.audioContext=c=new(window.AudioContext||window.webkitAudioContext),h=c.createGain(),h.gain.value=0,g=c.createDynamicsCompressor(),g.threshold.value=-70,g.knee.value=40,g.ratio.value=15,g.attack.value=.2,g.release.value=.5,y=c.createConvolver(),f=c.createDelay(.01),p=c.createGain(),p.gain.value=.2,m=c.createAnalyser(),m.minDecibels=-90,m.maxDecibels=-10,m.smoothingTimeConstant=.85,m.fftSize=256,n.bufferLength=l=m.frequencyBinCount,n.dataArray=d=new Uint8Array(l),f.connect(p),p.connect(f),f.connect(h),h.connect(g),g.connect(m),b=c.createScriptProcessor(e,t,r),m.connect(c.destination),f);n.updateByteFrequencyData=()=>m.getByteFrequencyData(d);n.updateByteTimeDomainData=()=>m.getByteTimeDomainData(d);const I=()=>{const e=requestAnimationFrame(I);return m.getByteFrequencyData(d),e};n.stopAudio=()=>!!_&&(n.playing=_=!1,!0);n.playAudio=()=>!_&&("suspended"===c.state&&c.resume(),n.playing=_=!0,I(),!0);n.setShape=e=>{(void 0).type=e};n.setFrequency=e=>{(void 0).frequency.value=e};n.getVolume=()=>v;n.setVolume=e=>(e=(0,r.clamp)(e,0,1),h.gain.value=e,e);const S=e=>{const t=h.gain.value+.1*(e-h.gain.value);return h.gain.setValueAtTime(e,c.currentTime),h.gain.value===e||requestAnimationFrame(S),t};n.setAmplitude=e=>{v=e,S()};n.playTrack=(e,t=0,r=f,i={loop:!1})=>new Promise((o,a)=>{const s=c.createBufferSource();s.buffer=e,s.loop=i.loop,s.connect(r),s.onended=()=>{s.disconnect(),n.active=w=!1,o()},s.onerror=e=>{s.disconnect(),n.active=w=!1,a(e)},"suspended"===c.state&&c.resume(),0==t?s.start():s.start(0,c.currentTime-t),n.active=w=!0});const E=(e="mp3",t=".")=>{const n=[];for(let r=0;r<o.length;++r){const i=o[r];"A"===i&&n.push(`A0${t}${e}`);for(let r=1;r<8;++r)n.push(`${i}${r}${t}${e}`);"C"===i&&n.push(`C8${t}${e}`)}return n},C=E("","");n.NOTE_NAMES=C;const A={};C.forEach(e=>{A[e]=e});n.getNoteName=(e,t=3,n=!1)=>{let i,o;return n?(i=Math.floor(e*(a.length-1)),o=a[i]):(i=Math.floor(e*(s.length-1)),o=s[i]),`${o}${(0,r.clamp)(t,1,7)}`};const M=(e="alto_sax-mp3",t="./FluidR3_GM")=>{const n=`${t}/${e}`;return E().map(e=>async function(e){const t=await fetch(e),n=await t.arrayBuffer();return await c.decodeAudioData(n)}(`${n}/${e}`))};n.loadInstrumentParts=M;n.loadInstrument=async(e="alto_sax-mp3",t="./FluidR3_GM",n)=>{const r={title:(0,i.cleanTitle)(e),name:e},o=await Promise.all(M(e,t));return C.forEach((e,t)=>{r[e.split(".")[0]]=o[t]}),r};n.record=e=>{let t,n=!1;return{isAvailable:()=>!!(window&&window.MediaRecorder&&"function"==typeof window.MediaRecorder.isTypeSupported&&window.Blob),downloadRecording:()=>{var e=new Blob(recordedChunks,{type:"video/webm"}),t=URL.createObjectURL(e),n=document.createElement("a");document.body.appendChild(n),n.style="display: none",n.href=t,n.download="test.webm",n.click(),window.URL.revokeObjectURL(t)},encodeRecording:(e,t="audio/mp3;")=>new Blob(e,{type:t}),startRecording:e=>new Promise((r,i)=>{if(n)return i("already recording");t=[],u=new MediaRecorder(e),u.ondataavailable=n=>{t.push(n.data),r({mediaRecorder:u,dataArray:t,stream:e})},u.onwarning=function(e){console.log("onwarning fired")},u.onerror=e=>{switch(console.log("onerror fired"),e.name){case"InvalidState":case"OutOfMemory":case"IllegalStreamModification":case"OtherRecordingError":case"GenericError":break;default:console.error("MediaRecorder Error",e)}},u.start(),n=!0}),stopRecording:()=>new Promise((e,r)=>{if(!n)return r("Not recording");u.onstop=r=>{n=!1,e(t)},u.stop()}),isRecording:()=>n}}},{"./maths":"30c371813e434b101ca68a9e5aac6342","./instruments":"65cd0bc3434dcf662af5a85fae344dc3"}],"30c371813e434b101ca68a9e5aac6342":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.easeOutSine=function(e){return Math.sin(e*(Math.PI/2))},n.easeInOutSine=function(e){return-.5*(Math.cos(Math.PI*e)-1)},n.easeInQuad=function(e){return e*e},n.easeOutQuad=function(e){return e*(2-e)},n.easeInOutQuad=function(e){return e<.5?2*e*e:(4-2*e)*e-1},n.easeInCubic=function(e){return e*e*e},n.easeOutCubic=function(e){const t=e-1;return t*t*t+1},n.easeInOutCubic=function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},n.easeInQuart=function(e){return e*e*e*e},n.easeOutQuart=function(e){const t=e-1;return 1-t*t*t*t},n.easeInOutQuart=function(e){const t=e-1;return e<.5?8*e*e*e*e:1-8*t*t*t*t},n.easeInQuint=function(e){return e*e*e*e*e},n.easeOutQuint=function(e){const t=e-1;return 1+t*t*t*t*t},n.easeInOutQuint=function(e){const t=e-1;return e<.5?16*e*e*e*e*e:1+16*t*t*t*t*t},n.easeInExpo=function(e){if(0===e)return 0;return Math.pow(2,10*(e-1))},n.easeOutExpo=function(e){if(1===e)return 1;return 1-Math.pow(2,-10*e)},n.easeInOutExpo=function(e){if(0===e||1===e)return e;const t=2*e,n=t-1;if(t<1)return.5*Math.pow(2,10*n);return.5*(2-Math.pow(2,-10*n))},n.easeInCirc=function(e){const t=e/1;return-1*(Math.sqrt(1-t*e)-1)},n.easeOutCirc=function(e){const t=e-1;return Math.sqrt(1-t*t)},n.easeInOutCirc=function(e){const t=2*e,n=t-2;if(t<1)return-.5*(Math.sqrt(1-t*t)-1);return.5*(Math.sqrt(1-n*n)+1)},n.easeInBack=function(e,t=1.70158){return e*e*((t+1)*e-t)},n.easeOutBack=function(e,t=1.70158){const n=e/1-1;return n*n*((t+1)*n+t)+1},n.easeInOutBack=function(e,t=1.70158){const n=2*e,r=n-2,i=1.525*t;if(n<1)return.5*n*n*((i+1)*n-i);return.5*(r*r*((i+1)*r+i)+2)},n.easeInElastic=function(e,t=.7){if(0===e||1===e)return e;const n=e/1-1,r=1-t,i=r/(2*Math.PI)*Math.asin(1);return-Math.pow(2,10*n)*Math.sin((n-i)*(2*Math.PI)/r)},n.easeOutElastic=function(e,t=.7){const n=1-t,r=2*e;if(0===e||1===e)return e;const i=n/(2*Math.PI)*Math.asin(1);return Math.pow(2,-10*r)*Math.sin((r-i)*(2*Math.PI)/n)+1},n.easeInOutElastic=function(e,t=.65){const n=1-t;if(0===e||1===e)return e;const r=2*e,i=r-1,o=n/(2*Math.PI)*Math.asin(1);if(r<1)return Math.pow(2,10*i)*Math.sin((i-o)*(2*Math.PI)/n)*-.5;return Math.pow(2,-10*i)*Math.sin((i-o)*(2*Math.PI)/n)*.5+1},n.easeOutBounce=i,n.easeInBounce=o,n.easeInOutBounce=function(e){if(e<.5)return.5*o(2*e);return.5*i(2*e-1)+.5},n.easeInSine=n.linear=n.clamp=n.lerp=n.rescale=n.TAU=void 0;const r=2*Math.PI;n.TAU=r;n.rescale=(e,t=1)=>{const n=1/(t-e);return t=>n*(t-e)};n.lerp=(e,t,n)=>(1-n)*e+n*t;n.clamp=(e,t,n)=>e>n?n:e<t?t:e;n.linear=e=>e;function i(e){const t=e/1;if(t<1/2.75)return 7.5625*t*t;if(t<2/2.75){const e=t-1.5/2.75;return 7.5625*e*e+.75}if(t<2.5/2.75){const e=t-2.25/2.75;return 7.5625*e*e+.9375}{const e=t-2.625/2.75;return 7.5625*e*e+.984375}}function o(e){return 1-i(1-e)}n.easeInSine=e=>-1*Math.cos(e*(Math.PI/2))+1},{}],"65cd0bc3434dcf662af5a85fae344dc3":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.INSTRUMENT_NAMES=n.cleanTitle=n.INSTRUMENT_FOLDERS=n.MUSICAL_NOTES=void 0;n.MUSICAL_NOTES=["â™«","ð…ž","ð…Ÿ","ð… ","ð…¡","ð…¢","ð…£","ð…¤"];const r=["accordion-mp3","acoustic_bass-mp3","acoustic_grand_piano-mp3","acoustic_guitar_nylon-mp3","acoustic_guitar_steel-mp3","agogo-mp3","alto_sax-mp3","applause-mp3","bagpipe-mp3","banjo-mp3","baritone_sax-mp3","bassoon-mp3","bird_tweet-mp3","blown_bottle-mp3","brass_section-mp3","breath_noise-mp3","bright_acoustic_piano-mp3","celesta-mp3","cello-mp3","choir_aahs-mp3","church_organ-mp3","clarinet-mp3","clavinet-mp3","contrabass-mp3","distortion_guitar-mp3","drawbar_organ-mp3","dulcimer-mp3","electric_bass_finger-mp3","electric_bass_pick-mp3","electric_grand_piano-mp3","electric_guitar_clean-mp3","electric_guitar_jazz-mp3","electric_guitar_muted-mp3","electric_piano_1-mp3","electric_piano_2-mp3","english_horn-mp3","fiddle-mp3","flute-mp3","french_horn-mp3","fretless_bass-mp3","fx_1_rain-mp3","fx_2_soundtrack-mp3","fx_3_crystal-mp3","fx_4_atmosphere-mp3","fx_5_brightness-mp3","fx_6_goblins-mp3","fx_7_echoes-mp3","fx_8_scifi-mp3","glockenspiel-mp3","guitar_fret_noise-mp3","guitar_harmonics-mp3","gunshot-mp3","harmonica-mp3","harpsichord-mp3","helicopter-mp3","honkytonk_piano-mp3","kalimba-mp3","koto-mp3","lead_1_square-mp3","lead_2_sawtooth-mp3","lead_3_calliope-mp3","lead_4_chiff-mp3","lead_5_charang-mp3","lead_6_voice-mp3","lead_7_fifths-mp3","lead_8_bass__lead-mp3","marimba-mp3","melodic_tom-mp3","music_box-mp3","muted_trumpet-mp3","oboe-mp3","ocarina-mp3","orchestra_hit-mp3","orchestral_harp-mp3","overdriven_guitar-mp3","pad_1_new_age-mp3","pad_2_warm-mp3","pad_3_polysynth-mp3","pad_4_choir-mp3","pad_5_bowed-mp3","pad_6_metallic-mp3","pad_7_halo-mp3","pad_8_sweep-mp3","pan_flute-mp3","percussive_organ-mp3","piccolo-mp3","pizzicato_strings-mp3","recorder-mp3","reed_organ-mp3","reverse_cymbal-mp3","rock_organ-mp3","seashore-mp3","shakuhachi-mp3","shamisen-mp3","shanai-mp3","sitar-mp3","slap_bass_1-mp3","slap_bass_2-mp3","soprano_sax-mp3","steel_drums-mp3","string_ensemble_1-mp3","string_ensemble_2-mp3","synth_bass_1-mp3","synth_bass_2-mp3","synth_brass_1-mp3","synth_brass_2-mp3","synth_choir-mp3","synth_drum-mp3","synth_strings_1-mp3","synth_strings_2-mp3","taiko_drum-mp3","tango_accordion-mp3","telephone_ring-mp3","tenor_sax-mp3","timpani-mp3","tinkle_bell-mp3","tremolo_strings-mp3","trombone-mp3","trumpet-mp3","tuba-mp3","tubular_bells-mp3","vibraphone-mp3","viola-mp3","violin-mp3","voice_oohs-mp3","whistle-mp3","woodblock-mp3","xylophone-mp3"];n.INSTRUMENT_FOLDERS=r;const i=e=>e&&e.length>1?e.replaceAll("_"," ").replace("-mp3",""):"";n.cleanTitle=i;const o=r.map(e=>i(e));n.INSTRUMENT_NAMES=o},{}],bfab68a55c8ce3658ec0c92f8942684d:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.stop=n.start=n.setTimeBetween=n.now=n.setBars=n.getBars=n.getBPM=n.getBar=n.timePerBar=n.MAX_BARS_ALLOWED=n.EVENT_TICK=n.EVENT_STOPPING=n.EVENT_STARTING=n.EVENT_READY=n.CMD_UPDATE=n.CMD_STOP=n.CMD_START=void 0;n.CMD_START="start";n.CMD_STOP="stop";n.CMD_UPDATE="update";n.EVENT_READY="ready";n.EVENT_STARTING="starting";n.EVENT_STOPPING="stopping";n.EVENT_TICK="tick";n.MAX_BARS_ALLOWED=32;const r=window.AudioContext||window.webkitAudioContext,i=new Worker(e("data-url:./timing.requestframe.worker.js"));let o=-1,a=1,s=null,c=!1,u=0,l=16,d=0;const h=()=>2403/l;n.timePerBar=h;n.getBar=()=>u;n.getBPM=()=>6e4/h();n.getBars=()=>l;n.setBars=e=>(l=e<1?1:l>32?32:l,l);const f=()=>s.currentTime;n.now=f;n.setTimeBetween=e=>(a=e,i.postMessage({command:"update",interval:a,time:f()}),a);n.start=(e,t=200,n={})=>(d=0,null===s&&(s=new r,"suspended"===s.state&&s.resume()),a=t,i.onmessage=n=>{const r=f(),i=n.data;switch(i.event){case"starting":i.time;o=r,c=!0;break;case"tick":const a=i.intervals,s=a*t*.001,h=r-o,f=i.time,p=f%t*.001,m=f-h,g=Math.floor(f/t);u=++d%l,e&&e({bar:u,bars:l,barsElapsed:d,timePassed:f,elapsed:h,expected:s,drift:m,level:g,intervals:a,lag:p});break;default:console.log("message: ",n)}},i.onerror=e=>{console.error("error...",{error:e}),i.postMessage({error:e,time:s.currentTime})},i.postMessage({command:"start",time:s.currentTime,interval:t,accurateTiming:!1}),{currentTime:f(),timingWorker:i});n.stop=()=>{const e=f();return i.onmessage=e=>{switch(e.event){case"stopping":c=!1,s=null}},i.postMessage({command:"stop",time:e}),{currentTime:f(),timingWorker:i}}},{"data-url:./timing.requestframe.worker.js":"0e137c3c3795d578b67a43c32c6b1405"}],"0e137c3c3795d578b67a43c32c6b1405":[function(e,t,n){t.exports="data:application/javascript,!function(e%2Ct%2Cn%2Ci)%7Bvar%20o%3D%22undefined%22!%3Dtypeof%20globalThis%3FglobalThis%3A%22undefined%22!%3Dtypeof%20self%3Fself%3A%22undefined%22!%3Dtypeof%20window%3Fwindow%3A%22undefined%22!%3Dtypeof%20global%3Fglobal%3A%7B%7D%2Cr%3D%22function%22%3D%3Dtypeof%20o.parcelRequire%26%26o.parcelRequire%2Ca%3D%22undefined%22!%3Dtypeof%20module%26%26%22function%22%3D%3Dtypeof%20module.require%26%26module.require.bind(module)%3Bfunction%20s(n%2Ci)%7Bif(!t%5Bn%5D)%7Bif(!e%5Bn%5D)%7Bvar%20o%3D%22function%22%3D%3Dtypeof%20parcelRequire%26%26parcelRequire%3Bif(!i%26%26o)return%20o(n%2C!0)%3Bif(r)return%20r(n%2C!0)%3Bif(a%26%26%22string%22%3D%3Dtypeof%20n)return%20a(n)%3Bvar%20f%3Dnew%20Error(%22Cannot%20find%20module%20'%22%2Bn%2B%22'%22)%3Bthrow%20f.code%3D%22MODULE_NOT_FOUND%22%2Cf%7Dc.resolve%3Dfunction(t)%7Breturn%20e%5Bn%5D%5B1%5D%5Bt%5D%7C%7Ct%7D%2Cc.cache%3D%7B%7D%3Bvar%20u%3Dt%5Bn%5D%3Dnew%20s.Module(n)%3Be%5Bn%5D%5B0%5D.call(u.exports%2Cc%2Cu%2Cu.exports%2Cthis)%7Dreturn%20t%5Bn%5D.exports%3Bfunction%20c(e)%7Breturn%20s(c.resolve(e))%7D%7Ds.isParcelRequire%3D!0%2Cs.Module%3Dfunction(e)%7Bthis.id%3De%2Cthis.bundle%3Ds%2Cthis.exports%3D%7B%7D%7D%2Cs.modules%3De%2Cs.cache%3Dt%2Cs.parent%3Dr%2Cs.register%3Dfunction(t%2Cn)%7Be%5Bt%5D%3D%5Bfunction(e%2Ct)%7Bt.exports%3Dn%7D%2C%7B%7D%5D%7D%2Co.parcelRequire%3Ds%3Bfor(var%20f%3D0%3Bf%3Cn.length%3Bf%2B%2B)s(n%5Bf%5D)%3Bif(n.length)%7Bvar%20u%3Ds(n%5Bn.length-1%5D)%3B%22object%22%3D%3Dtypeof%20exports%26%26%22undefined%22!%3Dtypeof%20module%3Fmodule.exports%3Du%3A%22function%22%3D%3Dtypeof%20define%26%26define.amd%26%26define((function()%7Breturn%20u%7D))%7D%7D(%7B%22930453687b793e7cba86bb9525d75cf3%22%3A%5Bfunction(e%2Ct%2Cn)%7Blet%20i%3D!1%2Co%3D-1%2Cr%3D-1%2Ca%3D-1%2Cs%3D0%2Cf%3D0%2Cu%3D!1%2Cc%3D!0%3Bconst%20l%3D()%3D%3Eperformance.now()%2Cd%3D()%3D%3E.001*(l()-o)%2Cp%3D()%3D%3E%7Bu%3Fu%3D!1%3A(r%3Dl()%2Cr%3E%3Da%26%26(c%3Fa%2B%3Ds%3Aa%3Dr%2Bs%2Cf%2B%2B%2CpostMessage(%7Bevent%3A%22tick%22%2Ctime%3Ad()%2Cintervals%3Af%7D))%2CrequestAnimationFrame(p))%7D%2Cm%3D(e%3D250%2Ct%3D!0)%3D%3E%7Bs%3De%2Ca%3Do%2Be%2Ci%7C%7C(o%3Dl()%2Ci%3D!0%2CpostMessage(%7Bevent%3A%22starting%22%2Ctime%3A0%2Cintervals%3Af%7D))%2Cp()%2CpostMessage(%7Bevent%3A%22tick%22%2Ctime%3Ad()%2Cintervals%3Af%7D)%7D%3Bself.onmessage%3De%3D%3E%7Bconst%20t%3De.data%3Bswitch(t.command)%7Bcase%22start%22%3Ac%3Dt.accurateTiming%7C%7C!1%2Cm(t.interval)%3Bbreak%3Bcase%22stop%22%3Au%3D!0%2Ci%3D!1%2CpostMessage(%7Bevent%3A%22stopping%22%2Ctime%3Ad()%2Cintervals%3Af%7D)%3Bbreak%3Bcase%22update%22%3Am(t.interval)%7D%7D%7D%2C%7B%7D%5D%7D%2C%7B%7D%2C%5B%22930453687b793e7cba86bb9525d75cf3%22%5D)%3B%0A%2F%2F%23%20sourceMappingURL%3Ddata%3Aapplication%2Fjson%3Bcharset%3Dutf-8%3Bbase64%2CeyJtYXBwaW5ncyI6IjRyQ0FTQSxJQUFJQSxHQUFZLEVBQ1pDLEdBQWEsRUFDYkMsR0FBZSxFQUNmQyxHQUFnQixFQUNoQkMsRUFBTSxFQUNOQyxFQUFZLEVBQ1pDLEdBQU8sRUFDUEMsR0FBaUIsRUFFckIsTUFBTUMsRUFBTSxJQUFNQyxZQUFZRCxNQUV4QkUsRUFBVSxJQUE0QixNQUFyQkYsSUFBUVAsR0FPekJVLEVBQU8sS0FFTEwsRUFFQUEsR0FBTyxHQUlYSixFQUFjTSxJQUdWTixHQUFlQyxJQUdYSSxFQUVBSixHQUFnQkMsRUFJaEJELEVBQWVELEVBQWNFLEVBSWpDQyxJQUVBTyxZQUFZLENBQUVDLE1BOUNILE9BOENxQkMsS0FBS0osSUFBV0wsVUFBQUEsS0FHcERVLHNCQUFzQkosS0FHcEJLLEVBQVEsQ0FBQ0MsRUFBUyxJQUFLVixHQUFlLEtBRXhDSCxFQUFNYSxFQUdOZCxFQUFlRixFQUFZZ0IsRUFFdEJqQixJQUVEQyxFQUFZTyxJQUNaUixHQUFZLEVBQ1pZLFlBQVksQ0FBQ0MsTUFqRUUsV0FpRW9CQyxLQUFLLEVBQUdULFVBQUFBLEtBRy9DTSxJQUVBQyxZQUFZLENBQUNDLE1BcEVFLE9Bb0VnQkMsS0FBS0osSUFBV0wsVUFBQUEsS0FTbkRhLEtBQUtDLFVBQVlDLElBRWIsTUFBTUMsRUFBT0QsRUFBRUMsS0FFZixPQUFRQSxFQUFLQyxTQUVULElBMUZVLFFBMkZMZixFQUFpQmMsRUFBS2QsaUJBQWtCLEVBQ3pDUyxFQUFNSyxFQUFLSixVQUNYLE1BRUosSUE5RlUsT0E4RWRYLEdBQU8sRUFDUE4sR0FBWSxFQUNaWSxZQUFZLENBQUVDLE1BM0VLLFdBMkVpQkMsS0FBS0osSUFBV0wsVUFBQUEsSUFnQjVDLE1BRUosSUFqR1ksU0FrR1JXLEVBQU1LLEVBQUtKIiwic291cmNlcyI6WyIuL3NvdXJjZS90aW1pbmcucmVxdWVzdGZyYW1lLndvcmtlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBDTURfU1RBUlQgPSBcInN0YXJ0XCJcbmNvbnN0IENNRF9TVE9QICA9IFwic3RvcFwiXG5jb25zdCBDTURfVVBEQVRFICA9IFwidXBkYXRlXCJcblxuY29uc3QgRVZFTlRfUkVBRFkgPSBcInJlYWR5XCJcbmNvbnN0IEVWRU5UX1NUQVJUSU5HID0gXCJzdGFydGluZ1wiXG5jb25zdCBFVkVOVF9TVE9QUElORyA9IFwic3RvcHBpbmdcIlxuY29uc3QgRVZFTlRfVElDSyA9IFwidGlja1wiXG5cbmxldCBpc1J1bm5pbmcgPSBmYWxzZVxubGV0IHN0YXJ0VGltZSA9IC0xXG5sZXQgY3VycmVudFRpbWUgPSAtMVxubGV0IG5leHRJbnRlcnZhbCA9IC0xXG5sZXQgZ2FwID0gMFxubGV0IGludGVydmFscyA9IDBcbmxldCBleGl0ID0gZmFsc2VcbmxldCBhY2N1cmF0ZVRpbWluZyA9IHRydWVcblxuY29uc3Qgbm93ID0gKCkgPT4gcGVyZm9ybWFuY2Uubm93KClcblxuY29uc3QgZWxhcHNlZCA9ICgpID0%2BIChub3coKSAtIHN0YXJ0VGltZSkgKiAwLjAwMVxuXG5jb25zdCByZXNldCA9ICgpID0%2Be1xuICAgIGludGVydmFscyA9IDBcbiAgICBzdGFydFRpbWUgPSBub3coKVxufVxuXG5jb25zdCBsb29wID0gKCkgPT4ge1xuXG4gICAgaWYgKGV4aXQpXG4gICAge1xuICAgICAgICBleGl0ID0gZmFsc2VcbiAgICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgY3VycmVudFRpbWUgPSBub3coKVxuICBcbiAgICAvLyBpZiB0aGUgY3VycmVudFRpbWUgaXMgZXF1YWwgb3IgZ3JlYXRlciB0byBvdXIgcm9sbGluZyB0aW1lICsgaW50ZXJ2YWxcbiAgICBpZiAoY3VycmVudFRpbWUgPj0gbmV4dEludGVydmFsKVxuICAgIHtcbiAgICAgICAgLy8gaXQgaGFzIGhhcHBlbmVkISBzbyByZS1hZGp1c3QgdGhlIG5leHQgaW50ZXJ2YWxcbiAgICAgICAgaWYgKGFjY3VyYXRlVGltaW5nKVxuICAgICAgICB7XG4gICAgICAgICAgICBuZXh0SW50ZXJ2YWwgKz0gZ2FwXG5cbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAvLyBwZXJjZXB0dWFsP1xuICAgICAgICAgICAgbmV4dEludGVydmFsID0gY3VycmVudFRpbWUgKyBnYXBcbiAgICAgICAgfVxuICAgICAgXG4gICAgICAgIC8vIHVwZGF0ZSBvdXIgY291bnRlclxuICAgICAgICBpbnRlcnZhbHMrK1xuICAgICAgICAvLyBjYWxsYmFja1xuICAgICAgICBwb3N0TWVzc2FnZSh7IGV2ZW50OkVWRU5UX1RJQ0ssIHRpbWU6ZWxhcHNlZCgpLCBpbnRlcnZhbHMgfSlcbiAgICB9XG5cbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUobG9vcClcbn1cblxuY29uc3Qgc3RhcnQgPSAoaW50ZXJ2YWw9MjUwLCBhY2N1cmF0ZVRpbWluZz10cnVlICk9PntcblxuICAgIGdhcCA9IGludGVydmFsXG4gICBcbiAgICAvLyB3b3JrIG91dCB0aGUgbmV4dCBzdGVwIGZyb20gdGhpcyBzdGVwLi4uXG4gICAgbmV4dEludGVydmFsID0gc3RhcnRUaW1lICsgaW50ZXJ2YWxcblxuICAgIGlmICghaXNSdW5uaW5nKVxuICAgIHsgICBcbiAgICAgICAgc3RhcnRUaW1lID0gbm93KClcbiAgICAgICAgaXNSdW5uaW5nID0gdHJ1ZVxuICAgICAgICBwb3N0TWVzc2FnZSh7ZXZlbnQ6RVZFTlRfU1RBUlRJTkcsIHRpbWU6MCwgaW50ZXJ2YWxzfSlcbiAgICB9XG4gICBcbiAgICBsb29wKClcbiAgICAvLyBJTklUSUFMIHRpY2tcbiAgICBwb3N0TWVzc2FnZSh7ZXZlbnQ6RVZFTlRfVElDSywgdGltZTplbGFwc2VkKCksIGludGVydmFsc30pXG59XG5cbmNvbnN0IHN0b3AgPSAoKSA9PiB7XG4gICAgZXhpdCA9IHRydWVcbiAgICBpc1J1bm5pbmcgPSBmYWxzZVxuICAgIHBvc3RNZXNzYWdlKHsgZXZlbnQ6RVZFTlRfU1RPUFBJTkcsIHRpbWU6ZWxhcHNlZCgpLCBpbnRlcnZhbHMgfSlcbn1cblxuc2VsZi5vbm1lc3NhZ2UgPSBlID0%2BIHtcblxuICAgIGNvbnN0IGRhdGEgPSBlLmRhdGFcblxuICAgIHN3aXRjaCAoZGF0YS5jb21tYW5kKVxuICAgIHtcbiAgICAgICAgY2FzZSBDTURfU1RBUlQ6XG4gICAgICAgICAgICAgYWNjdXJhdGVUaW1pbmcgPSBkYXRhLmFjY3VyYXRlVGltaW5nIHx8IGZhbHNlXG4gICAgICAgICAgICBzdGFydChkYXRhLmludGVydmFsKVxuICAgICAgICAgICAgYnJlYWtcblxuICAgICAgICBjYXNlIENNRF9TVE9QOlxuICAgICAgICAgICAgc3RvcCgpXG4gICAgICAgICAgICBicmVha1xuXG4gICAgICAgIGNhc2UgQ01EX1VQREFURTpcbiAgICAgICAgICAgIHN0YXJ0KGRhdGEuaW50ZXJ2YWwpXG4gICAgICAgICAgICBicmVha1xuICAgIH1cbn1cbiJdLCJuYW1lcyI6WyJpc1J1bm5pbmciLCJzdGFydFRpbWUiLCJjdXJyZW50VGltZSIsIm5leHRJbnRlcnZhbCIsImdhcCIsImludGVydmFscyIsImV4aXQiLCJhY2N1cmF0ZVRpbWluZyIsIm5vdyIsInBlcmZvcm1hbmNlIiwiZWxhcHNlZCIsImxvb3AiLCJwb3N0TWVzc2FnZSIsImV2ZW50IiwidGltZSIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsInN0YXJ0IiwiaW50ZXJ2YWwiLCJzZWxmIiwib25tZXNzYWdlIiwiZSIsImRhdGEiLCJjb21tYW5kIl0sInZlcnNpb24iOjMsImZpbGUiOiJ0aW1pbmcucmVxdWVzdGZyYW1lLndvcmtlci5IQVNIX1JFRl9hNWQ2YmQzZGEwYTFkN2Y1ZjZmYjlmYTA1ZjFmYTQ1OC5qcy5tYXAifQ%3D%3D%0A"},{}],cc509f6dc4e34d6bd3c8d4b98935925a:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.setupInterface=n.showUpdateButton=n.showReloadButton=n.setToggle=n.setButton=n.addTooltip=n.setupMIDIButton=n.setupInstrumentForm=n.setupCameraForm=n.setControls=n.setToast=n.setFeedback=n.toggleVideoVisiblity=n.isVideoVisible=n.video=n.bindTextElement=n.controls=n.buttonVideo=n.buttonMIDI=n.buttonQuantise=n.progressBar=void 0;var r,i=e("./instruments"),o=e("./version"),a=e("./utils"),s=e("./full-screen"),c=e("./location-handler");(r=e("./palette"))&&r.__esModule;const u=document.querySelector("progress");let l,d,h,f,p,m;n.progressBar=u,n.buttonQuantise=h,n.buttonMIDI=f,n.buttonVideo=p,n.controls=m;const g=(e,t=700,n=0,r=!1)=>{let i=null,o=-1,s=-1,c=null;const u=(0,a.debounce)(t=>{e.innerHTML=t},t);return e?(a,l=t)=>{r&&(a=a.split(/!|\./i).join("<br>")),c=a,""!==e.innerHTML&&i==a||(clearTimeout(s),i=a,0===l?(clearTimeout(o),e.innerHTML=a):o=u(a),n>0&&(s=(t=>{s=setTimeout(()=>{e.innerHTML=""},n*t)})(a.length)))}:null};n.bindTextElement=g;const y=document.querySelector("video");n.video=y;const b=()=>"hidden"===y.style.visibility;n.isVideoVisible=b;n.toggleVideoVisiblity=e=>{y.style.visibility=b()?"visible":"hidden",b()};const v=g(document.getElementById("feedback"),20);n.setFeedback=v;const _=g(document.getElementById("toast"),20,900,!0);n.setToast=_;n.setControls=e=>{document.getElementById("person-a-controls").appendChild(e)};n.setupCameraForm=(e,t)=>{const n=document.getElementById("camera").querySelector("select"),r=e.map((e,t)=>`<option value="${e.deviceId}">${e.label}</option>`);n.innerHTML=`<optgroup label="Detected Cameras">${r.join("")}</optgroup>`,n.addEventListener("change",r=>{const i=n.options.selectedIndex;t(e[i])})};n.setupInstrumentForm=e=>""+i.INSTRUMENT_FOLDERS.map((e,t)=>`<label for="${e}">${i.INSTRUMENT_NAMES[t]}<input id="${e}" name="instrument-selector" type="radio" value="${e}"></input></label>`).join("");n.setupMIDIButton=e=>{let t=!1;return f.addEventListener("mousedown",async n=>(n.preventDefault(),e&&e(),t=!0,!1),{once:!0}),{setText:e=>f.innerHTML=test}};const w=e=>e.addEventListener("mouseover",e=>{const t=e.target.getAttribute("aria-label")||e.target.innerHTML;_(t)});n.addTooltip=w;const I=(e,t)=>{const n=document.getElementById(e);return n.addEventListener("click",e=>{t&&t({element:n})}),n};n.setButton=I;const S=(e,t,n)=>{const r=I(e,()=>{n=!n,"LABEL"===r.parentNode.nodeName&&r.parentNode.classList.toggle("checked",n),t(n)});return n&&(r.setAttribute("checked",n),r.parentNode.classList.toggle("checked",n)),r};n.setToggle=S;n.showReloadButton=()=>{};n.showUpdateButton=e=>{const t=document.createElement("button");t.id="button-update",t.classList.add("update-available"),t.innerHTML="Update to new version",t.addEventListener("click",()=>e()),document.documentElement.appendChild(t)};n.setupInterface=e=>{const t=document.querySelector("main"),r=document.querySelector("h1"),i=document.getElementById("share"),a=document.getElementById("button-solo"),u=document.getElementById("button-duet"),g=document.getElementById("title"),y=document.querySelector("share-menu");if(y.url=(0,c.getShareLink)(e),i.addEventListener("mousedown",t=>{y.setAttribute("url",(0,c.getShareLink)(e)),console.error("SHARING",{shareElement:y,url:y.url})},!1),n.controls=m=document.getElementById("controls"),l=document.getElementById("button-instrument"),n.buttonVideo=p=document.getElementById("button-video"),d=document.getElementById("button-record"),n.buttonMIDI=f=document.getElementById("button-midi"),n.buttonQuantise=h=document.getElementById("button-quantise"),(0,s.canFullscreen)()){const t=S("button-fullscreen",n=>{e.fullscreen=(0,s.toggleFullScreen)(),t.classList.toggle("fs",e.fullscreen)},!1)}else document.getElementById("button-fullscreen").classList.toggle("hide",!0);const b=new Date(o.DATE),v=document.getElementById("version"),_=v.innerHTML,I=`${b.getDate()}/${b.getMonth()+1}/${b.getFullYear()} ${b.toLocaleTimeString("en-GB",{hour12:!0,hour:"numeric",minute:"numeric"})}`;v.innerHTML=`${_} <span id="release">${I}</span>`,e.duet?(r.innerHTML+=" duet",u.classList.toggle("hide",!0),a.classList.toggle("hide",!1),t.classList.add("duet"),u.addEventListener("click",e=>c.loadSoloMode,!1)):(a.classList.toggle("hide",!0),u.classList.toggle("hide",!1),t.classList.add("solo"),a.addEventListener("click",e=>c.loadDuetMode,!1));m.querySelectorAll("button, label").forEach(e=>w(e)),m.addEventListener("submit",e=>{e.preventDefault()},!0),g.innerHTML="The InterFACE is ready, open your mouth to begin"}},{"./instruments":"65cd0bc3434dcf662af5a85fae344dc3","./version":"25488683cc04bb43faf629e105172bc8","./utils":"569dc304b7e08c7a087e8d733528b9ee","./full-screen":"eaa4796c765a9db49742f1809363912b","./location-handler":"99fcf05ce09eb6c13fde8b1abcb1879b","./palette":"8c184ea81a7f9f2a10a21f3b44355276"}],"25488683cc04bb43faf629e105172bc8":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DATE=n.VERSION=void 0;n.VERSION="0.34.0";n.DATE=1611673819220},{}],eaa4796c765a9db49742f1809363912b:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.toggleFullScreen=n.goFullscreen=n.exitFullscreen=n.canFullscreen=void 0;const r=()=>document.fullscreenEnabled||document.mozFullScreenEnabled||document.documentElement.webkitRequestFullScreen;n.canFullscreen=r;const i=()=>{document.exitFullscreen()};n.exitFullscreen=i;const o=e=>{r()&&document.documentElement.requestFullscreen()};n.goFullscreen=o;n.toggleFullScreen=()=>document.fullscreenElement?(document.exitFullscreen&&i(),!1):(o(),!0)},{}],"99fcf05ce09eb6c13fde8b1abcb1879b":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getShareLink=n.addToHistory=n.toQuery=n.refresh=n.loadSoloMode=n.loadDuetMode=n.getLocationSettings=n.parseType=void 0;const r=e=>{if("string"==typeof e){const t=e.toLowerCase();return"true"===t||"1"===t||"false"!==t&&"0"!==t&&e}return Array.isArray(e)?e.toString():data};n.parseType=e=>"string"==typeof e?"true"===e.toLowerCase()||"false"!==e&&(e.indexOf(",")>=0?convertIntegerArrayToBooleans(e.split(",")):isNaN(parseFloat(e))?e:parseFloat(e)):Array.isArray(e)?e.toString():e;n.getLocationSettings=e=>{{const t=Object.assign({},e),n=new URLSearchParams(window.location.search);for(const[e,i]of n)t[e]=r(i);return t}};n.loadDuetMode=()=>{new URLSearchParams(window.location.search).duet=!0};n.loadSoloMode=()=>{new URLSearchParams(window.location.search).duet=!1};n.refresh=e=>{window.location.reload()};const i=e=>new URLSearchParams(e).toString();n.toQuery=i;n.addToHistory=(e,t="")=>{const n=new URL(window.location);for(let t in e){const r=e[t];n.searchParams.set(t,r)}window.history.pushState(e,t,n)};n.getShareLink=e=>window.location+i(e)},{}],"8c184ea81a7f9f2a10a21f3b44355276":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.DEFAULT_COLOURS=void 0;n.DEFAULT_COLOURS={dots:"red",mouth:"rgba(255,0,0,0.5)",mouthClosed:"rgba(255,0,0,0.2)",lipsUpperInner:"pink",lipsLowerInner:"pink",midwayBetweenEyes:"blue",leftEyeLower0:"red",rightEyeLower0:"red",leftEyeIris:"yellow",rightEyeIris:"yellow"};var r={white:"hsl(22, 28%, 87%)",dark:"hsl(30, 6%, 14%)",grey:"hsl(11, 6%, 50%)",cream:"hsl(27, 30%, 45%)",brown:"hsl(23, 22%, 30%)",blue:"hsl(196, 18%, 33%)",green:"hsl(56, 18%, 33%)",yellow:"hsl(56, 18%, 33%)",orange:"hsl(28, 69%, 38%)",red:"hsl(9, 58%, 35%)"};n.default=r},{}],c4a8c05ce19cff181a1cac727798c03c:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.createDrumkit=n.createClacks=n.createCowbells=n.createHihats=n.createSnares=n.createKicks=n.createCowbell=n.createClack=n.createHihat=n.createSnare=n.createKick=n.createQueue=void 0;var r=e("./audio");const i=(e,t=5)=>{const n=[];for(let r=0;r<t;++r){const t=e();n.push(t)}let r=0;return(...e)=>{r=r+1<t?r+1:0;(0,n[r])(...e)}};n.createQueue=i;const o=()=>{const e=r.audioContext.createOscillator(),t=r.audioContext.createOscillator(),n=r.audioContext.createGain(),i=r.audioContext.createGain();e.type="triangle",t.type="sine";return e.connect(n),t.connect(i),n.connect((0,r.inputDryNode)()),i.connect((0,r.inputDryNode)()),(o=1,a=.05,s=.01,c=.5)=>{const u=r.audioContext.currentTime;n.gain.cancelScheduledValues(u),i.gain.cancelScheduledValues(u),e.frequency.cancelScheduledValues(u),t.frequency.cancelScheduledValues(u),n.gain.setValueAtTime(1,u),n.gain.exponentialRampToValueAtTime(1e-7,u+a),i.gain.setValueAtTime(1,r.audioContext.currentTime),i.gain.exponentialRampToValueAtTime(1e-7,u+a),e.frequency.setValueAtTime(120,r.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(s,u+a),t.frequency.setValueAtTime(50,r.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(s,u+a);try{e.start(u),t.start(u)}catch(e){}}};n.createKick=o;const a=()=>{const e=r.audioContext.createOscillator(),t=r.audioContext.createGain(),n=r.audioContext.createGain(),i=r.audioContext.createBufferSource(),o=r.audioContext.createBuffer(1,4096,r.audioContext.sampleRate),a=r.audioContext.createBiquadFilter();a.type="highpass",e.type="triangle",e.frequency.value=100;const s=o.getChannelData(0);for(var c=0;c<4096;c++)s[c]=Math.random();i.buffer=o,i.loop=!0,e.connect(t),t.connect((0,r.inputDryNode)()),i.connect(a),a.connect(n),n.connect((0,r.inputDryNode)());return(o=1,s=.2)=>{const c=r.audioContext.currentTime;n.gain.cancelScheduledValues(c),n.gain.setValueAtTime(1,c),n.gain.exponentialRampToValueAtTime(1e-7,c+s),t.gain.cancelScheduledValues(c),t.gain.setValueAtTime(1e-7,c),t.gain.exponentialRampToValueAtTime(1e-7,c+s/2),a.frequency.cancelScheduledValues(c),a.frequency.setValueAtTime(100,c),a.frequency.linearRampToValueAtTime(1e3,c+s);try{e.start(c),i.start(c)}catch(e){}}};n.createSnare=a;const s=()=>{const e=r.audioContext.createGain(),t=r.audioContext.createBiquadFilter();t.type="bandpass",t.frequency.value=1e4;const n=r.audioContext.createBiquadFilter();n.type="highpass",n.frequency.value=7e3;const i=[2,3,4.16,5.43,6.79,8.21].map(e=>{const n=r.audioContext.createOscillator();return n.type="square",n.frequency.value=40*e,n.connect(t),n});t.connect(n),n.connect(e),e.connect((0,r.inputDryNode)());return(t=1,n=.05)=>{const o=r.audioContext.currentTime;e.gain.cancelScheduledValues(o),i.forEach(e=>e.frequency.cancelScheduledValues(o)),e.gain.setValueAtTime(1,o),e.gain.exponentialRampToValueAtTime(1e-7,o+n);try{i.forEach(e=>e.start(o))}catch(e){}}};n.createHihat=s;const c=()=>{const e=r.audioContext.createGain(),t=r.audioContext.createBiquadFilter();t.type="bandpass",t.frequency.value=2640,t.Q.value=3.5;const n=r.audioContext.createBiquadFilter();n.type="highpass",n.frequency.value=7e3;const i=[587,845],o=i.map(e=>{const n=r.audioContext.createOscillator();return n.type="triangle",n.frequency.value=1*e,n.connect(t),n});t.connect(n),n.connect(e),e.connect((0,r.inputDryNode)());return(t=1,n=.05,a=1)=>{const s=r.audioContext.currentTime;e.gain.cancelScheduledValues(s),o.forEach((e,t)=>{e.frequency.cancelScheduledValues(s),e.frequency.value=a*i[t]}),e.gain.setValueAtTime(1,s),e.gain.exponentialRampToValueAtTime(1e-7,s+n);try{o.forEach(e=>e.start(s))}catch(e){}}};n.createClack=c;const u=()=>{const e=r.audioContext.createGain(),t=r.audioContext.createBiquadFilter();t.type="bandpass",t.frequency.value=2640,t.Q.value=3.5;const n=[587,845].map(e=>{const n=r.audioContext.createOscillator();return n.type="triangle",n.frequency.value=1*e,n.connect(t),n});t.connect(e),e.connect((0,r.inputDryNode)());return(t=1,i=.05)=>{const o=r.audioContext.currentTime;e.gain.cancelScheduledValues(o),n.forEach(e=>e.frequency.cancelScheduledValues(o)),e.gain.setValueAtTime(1,o),e.gain.exponentialRampToValueAtTime(1e-7,o+i);try{n.forEach(e=>e.start(o))}catch(e){}}};n.createCowbell=u;const l=(e=2)=>i(o,e);n.createKicks=l;const d=(e=3)=>i(a,e);n.createSnares=d;const h=(e=3)=>i(s,e);n.createHihats=h;n.createCowbells=(e=2)=>i(u,e);n.createClacks=(e=2)=>i(c,e);n.createDrumkit=()=>{const e=l(),t=h();return{kick:e,snare:d(),hat:t,cowbell:u(),clack:c()}}},{"./audio":"dd70e9d1edf82ea11611411db307fbf3"}],b24ff78b69d5d45a293cadc71e7e5aed:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.setupMIDI=void 0;var r=e("../node_modules/webmidi/dist/webmidi.esm.js");n.setupMIDI=()=>new Promise((e,t)=>{r.WebMidi.enable().then(t=>{e(r.WebMidi)}).catch(e=>t(e))})},{"../node_modules/webmidi/dist/webmidi.esm.js":"334aec7d4e576dc12758c661787237f8"}],"334aec7d4e576dc12758c661787237f8":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.WebMidi=n.Note=void 0;var r=arguments[3],i=e("process");class o{constructor(e=!1){this.eventMap={},this.eventsSuspended=1==e}addListener(e,t,n={}){if("string"==typeof e&&e.length<1||e instanceof String&&e.length<1||"string"!=typeof e&&!(e instanceof String)&&e!==o.ANY_EVENT)throw new TypeError("The 'event' parameter must be a string or EventEmitter.ANY_EVENT.");if("function"!=typeof t)throw new TypeError("The callback must be a function.");const r=new a(e,this,t,n);return this.eventMap[e]||(this.eventMap[e]=[]),n.prepend?this.eventMap[e].unshift(r):this.eventMap[e].push(r),r}addOneTimeListener(e,t,n={}){n.remaining=1,this.addListener(e,t,n)}static get ANY_EVENT(){return Symbol.for("Any event")}hasListener(e,t){return void 0===e?!!(this.eventMap[o.ANY_EVENT]&&this.eventMap[o.ANY_EVENT].length>0)||Object.entries(this.eventMap).some(([,e])=>e.length>0):!!(this.eventMap[e]&&this.eventMap[e].length>0)&&(t instanceof a?this.eventMap[e].filter(e=>e===t).length>0:"function"==typeof t?this.eventMap[e].filter(e=>e.callback===t).length>0:null==t)}get eventNames(){return Object.keys(this.eventMap)}getListeners(e){return this.eventMap[e]||[]}suspendEvent(e){this.getListeners(e).forEach(e=>{e.suspended=!0})}unsuspendEvent(e){this.getListeners(e).forEach(e=>{e.suspended=!1})}getListenerCount(e){return this.getListeners(e).length}emit(e,...t){if("string"!=typeof e&&!(e instanceof String))throw new TypeError("The 'event' parameter must be a string.");if(this.eventsSuspended)return;let n=[],r=this.eventMap[o.ANY_EVENT]||[];return this.eventMap[e]&&(r=r.concat(this.eventMap[e])),r.forEach(e=>{if(e.suspended)return;let r=[...t];Array.isArray(e.arguments)&&(r=r.concat(e.arguments)),e.remaining>0&&(n.push(e.callback.apply(e.context,r)),e.count++),--e.remaining<1&&e.remove()}),n}removeListener(e,t,n={}){if(void 0===e)return void(this.eventMap={});if(!this.eventMap[e])return;let r=this.eventMap[e].filter(e=>t&&e.callback!==t||n.remaining&&n.remaining!==e.remaining||n.context&&n.context!==e.context);r.length?this.eventMap[e]=r:delete this.eventMap[e]}async waitFor(e,t={}){return t.duration=parseInt(t.duration),(isNaN(t.duration)||t.duration<=0)&&(t.duration=1/0),new Promise((n,r)=>{let i,o=this.addListener(e,()=>{clearTimeout(i),n()},{remaining:1});t.duration!==1/0&&(i=setTimeout(()=>{o.remove(),r("The duration expired before the event was emitted.")},t.duration))})}get eventCount(){return Object.keys(this.eventMap).length}}class a{constructor(e,t,n,r={}){if("string"!=typeof e&&!(e instanceof String)&&e!==o.ANY_EVENT)throw new TypeError("The 'event' parameter must be a string or EventEmitter.ANY_EVENT.");if(!t)throw new ReferenceError("The 'target' parameter is mandatory.");if("function"!=typeof n)throw new TypeError("The 'callback' must be a function.");void 0===r.arguments||Array.isArray(r.arguments)||(r.arguments=[r.arguments]),(r=Object.assign({context:t,remaining:1/0,arguments:void 0,duration:1/0},r)).duration!==1/0&&setTimeout(()=>this.remove(),r.duration),this.event=e,this.target=t,this.callback=n,this.context=r.context,this.remaining=parseInt(r.remaining)>=1?parseInt(r.remaining):1/0,this.count=0,this.arguments=r.arguments,this.suspended=!1}remove(){this.target.removeListener(this.event,this.callback,{context:this.context,remaining:this.remaining})}}class s extends o{constructor(e,t){super(),this.input=e,this.number=t}destroy(){this.input=null,this.number=null,this.removeListener()}_parseEvent(e){let t=null;e.data[0]!==f.MIDI_SYSTEM_MESSAGES.sysex&&(t=e.data.slice(1));let n={target:this,data:Array.from(e.data),rawData:e.data,statusByte:e.data[0],dataBytes:t,timestamp:e.timeStamp,type:"midimessage"};this.emit("midimessage",n),this._parseEventForStandardMessages(e)}getStructuredMidiMessage(e){return{command:e[0]>>4,data1:e.length>1?e[1]:void 0,data2:e.length>2?e[2]:void 0}}_parseEventForStandardMessages(e){let{command:t,data1:n,data2:r}=this.getStructuredMidiMessage(e.data),i={target:this,data:Array.from(e.data),rawData:e.data,timestamp:e.timeStamp};t===f.MIDI_CHANNEL_VOICE_MESSAGES.noteoff||t===f.MIDI_CHANNEL_VOICE_MESSAGES.noteon&&0===r?(i.type="noteoff",i.note=new d(n,{rawRelease:r}),i.release=i.note.release,i.rawRelease=i.note.rawRelease):t===f.MIDI_CHANNEL_VOICE_MESSAGES.noteon?(i.type="noteon",i.note=new d(n,{rawAttack:r}),i.attack=i.note.attack,i.rawAttack=i.note.rawAttack):t===f.MIDI_CHANNEL_VOICE_MESSAGES.keyaftertouch?(i.type="keyaftertouch",i.note=new d(n),i.value=r/127,i.rawValue=r):t===f.MIDI_CHANNEL_VOICE_MESSAGES.controlchange&&n>=0&&n<=119?(i.type="controlchange",i.controller={number:n,name:this.getCcNameByNumber(n)},i.value=r/127,i.rawValue=r):t===f.MIDI_CHANNEL_VOICE_MESSAGES.channelmode&&n>=120&&n<=127?(i.type="channelmode",i.controller={number:n,name:this.getChannelModeByNumber(n)},i.value=r,this._parseChannelModeMessage(e)):t===f.MIDI_CHANNEL_VOICE_MESSAGES.programchange?(i.type="programchange",i.value=n+1,i.rawValue=n):t===f.MIDI_CHANNEL_VOICE_MESSAGES.channelaftertouch?(i.type="channelaftertouch",i.value=n/127,i.rawValue=n):t===f.MIDI_CHANNEL_VOICE_MESSAGES.pitchbend?(i.type="pitchbend",i.value=((r<<7)+n-8192)/8192,i.rawValue=(r<<7)+n):i.type="unknownmessage",this.emit(i.type,i)}getChannelModeByNumber(e){if(f.validation&&(e=Math.floor(e)),!(e>=120&&e<=127))return!1;for(let t in f.MIDI_CHANNEL_MODE_MESSAGES)if(f.MIDI_CHANNEL_MODE_MESSAGES.hasOwnProperty(t)&&e===f.MIDI_CHANNEL_MODE_MESSAGES[t])return t}_parseChannelModeMessage(e){let t,n;e.data.length>1&&(t=e.data[1],n=e.data.length>2?e.data[2]:void 0);let r={target:this,data:Array.from(e.data),rawData:e.data,timestamp:e.timeStamp,type:this.getChannelModeByNumber(t)};"localcontrol"===r.type&&(r.value=127===n),"omnimodeon"===r.type?(r.type="omnimode",r.value=!0):"omnimodeoff"===r.type&&(r.type="omnimode",r.value=!1),"monomodeon"===r.type?(r.type="monomode",r.value=!0):"polymodeon"===r.type&&(r.type="monomode",r.value=!1),this.emit(r.type,r)}getCcNameByNumber(e){if(f.validation&&!((e=parseInt(e))>=0&&e<=119))throw new RangeError("Invalid control change number.");for(let t in f.MIDI_CONTROL_CHANGE_MESSAGES)if(f.MIDI_CONTROL_CHANGE_MESSAGES.hasOwnProperty(t)&&e===f.MIDI_CONTROL_CHANGE_MESSAGES[t])return t;return!1}}class c extends o{constructor(e){super(),this._midiInput=e,this.channels=[];for(let e=1;e<=16;e++)this.channels[e]=new s(this,e);this._midiInput.onstatechange=this._onStateChange.bind(this),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}async destroy(){this.removeListener(),this.channels.forEach(e=>e.destroy()),this.channels=[],this._midiInput.onstatechange=null,this._midiInput.onmidimessage=null,await this.close(),this._midiInput=null}_onStateChange(e){let t={timestamp:f.time,target:this};"open"===e.port.connection?(t.type="opened",this.emit("opened",t)):"closed"===e.port.connection&&"connected"===e.port.state?(t.type="closed",this.emit("closed",t)):"closed"===e.port.connection&&"disconnected"===e.port.state?(t.type="disconnected",t.target={connection:e.port.connection,id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this.emit("disconnected",t)):"pending"===e.port.connection&&"disconnected"===e.port.state||console.warn("This statechange event was not caught: ",e.port.connection,e.port.state)}_onMidiMessage(e){let t=null;e.data[0]!==f.MIDI_SYSTEM_MESSAGES.sysex&&(t=e.data.slice(1));let n={target:this,data:Array.from(e.data),rawData:e.data,statusByte:e.data[0],dataBytes:t,timestamp:e.timeStamp,type:"midimessage"};if(this.emit("midimessage",n),e.data[0]<240){let t=1+(15&e.data[0]);this.channels[t]._parseEvent(e)}else e.data[0]<=255&&this._parseEvent(e)}_parseEvent(e){let t=e.data[0];var n={target:this,data:Array.from(e.data),rawData:e.data,timestamp:e.timeStamp};t===f.MIDI_SYSTEM_MESSAGES.sysex?n.type="sysex":t===f.MIDI_SYSTEM_MESSAGES.timecode?n.type="timecode":t===f.MIDI_SYSTEM_MESSAGES.songposition?n.type="songposition":t===f.MIDI_SYSTEM_MESSAGES.songselect?(n.type="songselect",n.song=e.data[1]+1):t===f.MIDI_SYSTEM_MESSAGES.tunerequest?n.type="tunerequest":t===f.MIDI_SYSTEM_MESSAGES.clock?n.type="clock":t===f.MIDI_SYSTEM_MESSAGES.start?n.type="start":t===f.MIDI_SYSTEM_MESSAGES.continue?n.type="continue":t===f.MIDI_SYSTEM_MESSAGES.stop?n.type="stop":t===f.MIDI_SYSTEM_MESSAGES.activesensing?n.type="activesensing":t===f.MIDI_SYSTEM_MESSAGES.reset?n.type="reset":n.type="unknownmidimessage",this.emit(n.type,n)}async open(){try{return await this._midiInput.open(),Promise.resolve(this)}catch(e){return Promise.reject(e)}}async close(){return this._midiInput?this._midiInput.close():Promise.resolve()}getChannelModeByNumber(){f.validation&&console.warn("The 'getChannelModeByNumber()' method has been moved to the 'InputChannel' class.")}addListener(e,t,n){if(f.validation){if("function"==typeof n){let e=null!=t?[].concat(t):void 0;t=n,n={channels:e}}if(void 0!==f.MIDI_CHANNEL_VOICE_MESSAGES[e]&&void 0===n.channels)throw new Error("For channel-specific events, 'options.channels' must be defined.")}let r=[];return void 0===f.MIDI_CHANNEL_VOICE_MESSAGES[e]?r.push(super.addListener(e,t,n)):f.sanitizeChannels(n.channels).forEach(i=>{r.push(this.channels[i].addListener(e,t,n))}),r}addOneTimeListener(e,t,n={}){return n.remaining=1,this.addListener(e,t,n)}on(e,t,n,r){return this.addListener(e,t,n,r)}hasListener(e,t,n={}){if(f.validation){if("function"==typeof n){let e=[].concat(t);t=n,n={channels:e}}if(void 0!==f.MIDI_CHANNEL_VOICE_MESSAGES[e]&&void 0===n.channels)throw new Error("For channel-specific events, 'options.channels' must be defined.")}return void 0!==f.MIDI_CHANNEL_VOICE_MESSAGES[e]?f.sanitizeChannels(n.channels).every(n=>this.channels[n].hasListener(e,t)):super.hasListener(e,t)}removeListener(e,t,n={}){if(f.validation&&"function"==typeof n){let e=[].concat(t);t=n,n={channels:e}}if(void 0===n.channels&&(n.channels=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),null==e)return f.sanitizeChannels(n.channels).forEach(e=>this.channels[e].removeListener()),super.removeListener();void 0!==f.MIDI_CHANNEL_VOICE_MESSAGES[e]?f.sanitizeChannels(n.channels).forEach(r=>{this.channels[r].removeListener(e,t,n)}):super.removeListener(e,t,n)}get name(){return this._midiInput.name}get id(){return this._midiInput.id}get connection(){return this._midiInput.connection}get manufacturer(){return this._midiInput.manufacturer}get state(){return this._midiInput.state}get type(){return this._midiInput.type}get nrpnEventsEnabled(){return f.validation&&console.warn("The 'nrpnEventsEnabled' property has been moved to the 'InputChannel' class."),!1}}class u extends o{constructor(e,t){super(),this.output=e,this.number=t}destroy(){this.output=null,this.number=null,this.removeListener()}send(e,t=[],n={}){return this.output.send(e,t,n),this}setKeyAftertouch(e,t,n={}){if(f.validation){if(n.useRawValue&&(n.rawValue=n.useRawValue),isNaN(parseFloat(t)))throw new RangeError("Invalid key aftertouch value.");if(n.rawValue){if(!(t>=0&&t<=127&&Number.isInteger(t)))throw new RangeError("Key aftertouch raw value must be an integer between 0 and 127.")}else if(!(t>=0&&t<=1))throw new RangeError("Key aftertouch value must be a float between 0 and 1.")}return n.rawValue||(t=Math.round(127*t)),f.getValidNoteArray(e,n).forEach(e=>{this.send((f.MIDI_CHANNEL_VOICE_MESSAGES.keyaftertouch<<4)+(this.number-1),[e.number,t],f.convertToTimestamp(n.time))}),this}sendControlChange(e,t,n={}){if("string"==typeof e&&(e=f.MIDI_CONTROL_CHANGE_MESSAGES[e]),f.validation){if(void 0===e)throw new TypeError("Control change must be identified with a valid name or an integer between 0 and 119.");if(!Number.isInteger(e)||!(e>=0&&e<=119))throw new TypeError("Control change number must be an integer between 0 and 119.");if(!Number.isInteger(t)||!(t>=0&&t<=127))throw new TypeError("Control change value must be an integer between 0 and 127")}return this.send((f.MIDI_CHANNEL_VOICE_MESSAGES.controlchange<<4)+(this.number-1),[e,t],f.convertToTimestamp(n.time)),this}_selectNonRegisteredParameter(e,t={}){return this.sendControlChange(99,e[0],t),this.sendControlChange(98,e[1],t),this}_deselectRegisteredParameter(e={}){return this.sendControlChange(101,127,e),this.sendControlChange(100,127,e),this}_deselectNonRegisteredParameter(e={}){return this.sendControlChange(101,127,e),this.sendControlChange(100,127,e),this}_selectRegisteredParameter(e,t={}){return this.sendControlChange(101,e[0],t),this.sendControlChange(100,e[1],t),this}_setCurrentParameter(e,t={}){return e=[].concat(e),this.sendControlChange(6,e[0],t),e.length<2||this.sendControlChange(38,e[1],t),this}decrementRegisteredParameter(e,t={}){if(Array.isArray(e)||(e=f.MIDI_REGISTERED_PARAMETER[e]),f.validation){if(void 0===e)throw new TypeError("The specified registered parameter is invalid.");let t=!1;if(Object.getOwnPropertyNames(f.MIDI_REGISTERED_PARAMETER).forEach(n=>{f.MIDI_REGISTERED_PARAMETER[n][0]===e[0]&&f.MIDI_REGISTERED_PARAMETER[n][1]===e[1]&&(t=!0)}),!t)throw new TypeError("The specified registered parameter is invalid.")}return this._selectRegisteredParameter(e,t),this.sendControlChange(97,0,t),this._deselectRegisteredParameter(t),this}incrementRegisteredParameter(e,t={}){if(Array.isArray(e)||(e=f.MIDI_REGISTERED_PARAMETER[e]),f.validation){if(void 0===e)throw new TypeError("The specified registered parameter is invalid.");let t=!1;if(Object.getOwnPropertyNames(f.MIDI_REGISTERED_PARAMETER).forEach(n=>{f.MIDI_REGISTERED_PARAMETER[n][0]===e[0]&&f.MIDI_REGISTERED_PARAMETER[n][1]===e[1]&&(t=!0)}),!t)throw new TypeError("The specified registered parameter is invalid.")}return this._selectRegisteredParameter(e,t),this.sendControlChange(96,0,t),this._deselectRegisteredParameter(t),this}playNote(e,t={}){if(this.sendNoteOn(e,t),t.duration>0&&isFinite(String(t.duration).trim()||NaN)){let n={time:f.convertToTimestamp(t.time)+t.duration,release:t.release,rawRelease:t.rawRelease};this.sendNoteOff(e,n)}return this}sendNoteOff(e,t={}){if(f.validation){if(null!=t.rawRelease&&!(t.rawRelease>=0&&t.rawRelease<=127))throw new RangeError("The 'rawRelease' option must be an integer between 0 and 127");if(null!=t.release&&!(t.release>=0&&t.release<=1))throw new RangeError("The 'release' option must be an number between 0 and 1");t.rawVelocity&&(t.rawRelease=t.velocity,console.warn("The 'rawVelocity' option is deprecated. Use 'rawRelease' instead.")),t.velocity&&(t.release=t.velocity,console.warn("The 'velocity' option is deprecated. Use 'attack' instead."))}let n=64;null!=t.rawRelease?n=t.rawRelease:isNaN(t.release)||(n=Math.round(127*t.release));let r={rawRelease:parseInt(n)};return f.getValidNoteArray(e,r).forEach(e=>{this.send((f.MIDI_CHANNEL_VOICE_MESSAGES.noteoff<<4)+(this.number-1),[e.number,e.rawRelease],f.convertToTimestamp(t.time))}),this}stopNote(e,t={}){return this.sendNoteOff(e,t)}sendNoteOn(e,t={}){if(f.validation){if(null!=t.rawAttack&&!(t.rawAttack>=0&&t.rawAttack<=127))throw new RangeError("The 'rawAttack' option must be an integer between 0 and 127");if(null!=t.attack&&!(t.attack>=0&&t.attack<=1))throw new RangeError("The 'attack' option must be an number between 0 and 1");t.rawVelocity&&(t.rawAttack=t.velocity,t.rawRelease=t.release,console.warn("The 'rawVelocity' option is deprecated. Use 'rawAttack' or 'rawRelease'.")),t.velocity&&(t.attack=t.velocity,console.warn("The 'velocity' option is deprecated. Use 'attack' instead."))}let n=64;null!=t.rawAttack?n=t.rawAttack:isNaN(t.attack)||(n=Math.round(127*t.attack));let r={rawAttack:n};return f.getValidNoteArray(e,r).forEach(e=>{this.send((f.MIDI_CHANNEL_VOICE_MESSAGES.noteon<<4)+(this.number-1),[e.number,e.rawAttack],f.convertToTimestamp(t.time))}),this}sendChannelMode(e,t,n={}){if("string"==typeof e&&(e=f.MIDI_CHANNEL_MODE_MESSAGES[e]),f.validation){if(void 0===e)throw new TypeError("Invalid channel mode message name or number.");if(isNaN(e)||!(e>=120&&e<=127))throw new TypeError("Invalid channel mode message number.");if(isNaN(parseInt(t))||t<0||t>127)throw new RangeError("Value must be an integer between 0 and 127.")}return this.send((f.MIDI_CHANNEL_VOICE_MESSAGES.channelmode<<4)+(this.number-1),[e,t],f.convertToTimestamp(n.time)),this}setOmniMode(e,t={}){return void 0===e||e?this.sendChannelMode("omnimodeon",0,t):this.sendChannelMode("omnimodeoff",0,t),this}setChannelAftertouch(e,t={}){if(f.validation){if(isNaN(parseFloat(e)))throw new RangeError("Invalid channel aftertouch value.");if(t.rawValue){if(!(e>=0&&e<=127&&Number.isInteger(e)))throw new RangeError("Channel aftertouch raw value must be an integer between 0 and 127.")}else if(!(e>=0&&e<=1))throw new RangeError("Channel aftertouch value must be a float between 0 and 1.")}return this.send((f.MIDI_CHANNEL_VOICE_MESSAGES.channelaftertouch<<4)+(this.number-1),[Math.round(127*e)],f.convertToTimestamp(t.time)),this}setMasterTuning(e,t={}){if(e=parseFloat(e)||0,f.validation&&!(e>-65&&e<64))throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");let n=Math.floor(e)+64,r=e-Math.floor(e);r=Math.round((r+1)/2*16383);let i=r>>7&127,o=127&r;return this.setRegisteredParameter("channelcoarsetuning",n,t),this.setRegisteredParameter("channelfinetuning",[i,o],t),this}setModulationRange(e,t,n={}){if(f.validation){if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new RangeError("The semitones value must be an integer between 0 and 127.");if(!(null==t||Number.isInteger(t)&&t>=0&&t<=127))throw new RangeError("If specified, the cents value must be an integer between 0 and 127.")}return t>=0&&t<=127||(t=0),this.setRegisteredParameter("modulationrange",[e,t],n),this}setNonRegisteredParameter(e,t,n={}){if(t=[].concat(t),f.validation){if(!Array.isArray(e)||!Number.isInteger(e[0])||!Number.isInteger(e[1]))throw new TypeError("The specified NRPN is invalid.");if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The first byte of the NRPN must be between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The second byte of the NRPN must be between 0 and 127.");t.forEach(e=>{if(!(e>=0&&e<=127))throw new RangeError("The data bytes of the NRPN must be between 0 and 127.")})}return this._selectNonRegisteredParameter(e,n),this._setCurrentParameter(t,n),this._deselectNonRegisteredParameter(n),this}setPitchBend(e,t={}){if(f.validation)if(t.rawValue&&Array.isArray(e)){if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The pitch bend MSB must be an integer between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The pitch bend LSB must be an integer between 0 and 127.")}else if(t.rawValue&&!Array.isArray(e)){if(!(e>=0&&e<=127))throw new RangeError("The pitch bend MSB must be an integer between 0 and 127.")}else{if(isNaN(e)||null===e)throw new RangeError("Invalid pitch bend value.");if(!(e>=-1&&e<=1))throw new RangeError("The pitch bend MSB must be an integer between 0 and 127.")}let n=0,r=0;if(t.rawValue&&Array.isArray(e))n=e[0],r=e[1];else if(t.rawValue&&!Array.isArray(e))n=e;else{let t=Math.round((e+1)/2*16383);n=t>>7&127,r=127&t}return this.send((f.MIDI_CHANNEL_VOICE_MESSAGES.pitchbend<<4)+(this.number-1),[r,n],f.convertToTimestamp(t.time)),this}setPitchBendRange(e,t,n={}){if(f.validation){if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new RangeError("The semitones value must be an integer between 0 and 127.");if(!Number.isInteger(t)||!(t>=0&&t<=127))throw new RangeError("The cents value must be an integer between 0 and 127.")}return this.setRegisteredParameter("pitchbendrange",[e,t],n),this}setProgram(e,t={}){if(e=parseInt(e)||1,f.validation&&!(e>=1&&e<=128))throw new RangeError("The program number must be between 1 and 128.");return this.send((f.MIDI_CHANNEL_VOICE_MESSAGES.programchange<<4)+(this.number-1),[e-1],f.convertToTimestamp(t.time)),this}setRegisteredParameter(e,t,n={}){if(Array.isArray(e)||(e=f.MIDI_REGISTERED_PARAMETER[e]),f.validation){if(!Number.isInteger(e[0])||!Number.isInteger(e[1]))throw new TypeError("The specified NRPN is invalid.");if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The first byte of the RPN must be between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The second byte of the RPN must be between 0 and 127.");[].concat(t).forEach(e=>{if(!(e>=0&&e<=127))throw new RangeError("The data bytes of the RPN must be between 0 and 127.")})}return this._selectRegisteredParameter(e,n),this._setCurrentParameter(t,n),this._deselectRegisteredParameter(n),this}setTuningBank(e,t={}){if(f.validation&&(!Number.isInteger(e)||!(e>=1&&e<=128)))throw new RangeError("The tuning bank number must be between 1 and 128.");return this.setRegisteredParameter("tuningbank",e-1,t),this}setTuningProgram(e,t={}){if(f.validation&&(!Number.isInteger(e)||!(e>=1&&e<=128)))throw new RangeError("The tuning program number must be between 1 and 128.");return this.setRegisteredParameter("tuningprogram",e-1,t),this}setLocalControl(e,t={}){return e?this.sendChannelMode("localcontrol",127,t):this.sendChannelMode("localcontrol",0,t)}turnNotesOff(e={}){return this.sendChannelMode("allnotesoff",0,e)}turnSoundOff(e={}){return this.sendChannelMode("allsoundoff",0,e)}resetAllControllers(e={}){return this.sendChannelMode("resetallcontrollers",0,e)}setPolyphonicMode(e,t={}){return"mono"===e?this.sendChannelMode("monomodeon",0,t):this.sendChannelMode("polymodeon",0,t)}}class l extends o{constructor(e){if(super(),f.validation&&(!e||"output"!==e.type))throw new TypeError("The supplied MIDIOutput is invalid.");this._midiOutput=e,this.channels=[];for(let e=1;e<=16;e++)this.channels[e]=new u(this,e);this._midiOutput.onstatechange=this._onStateChange.bind(this)}async destroy(){this.removeListener(),this.channels.forEach(e=>e.destroy()),this.channels=[],this._midiOutput.onstatechange=null,await this.close(),this._midiOutput=null}_onStateChange(e){let t={timestamp:f.time};"open"===e.port.connection?(t.type="opened",t.target=this,this.emit("opened",t)):"closed"===e.port.connection&&"connected"===e.port.state?(t.type="closed",t.target=this,this.emit("closed",t)):"closed"===e.port.connection&&"disconnected"===e.port.state?(t.type="disconnected",t.target={connection:e.port.connection,id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this.emit("disconnected",t)):"pending"===e.port.connection&&"disconnected"===e.port.state||console.warn("This statechange event was not caught:",e.port.connection,e.port.state)}async open(){try{return await this._midiOutput.open(),Promise.resolve(this)}catch(e){return Promise.reject(e)}}async close(){this._midiOutput?await this._midiOutput.close():await Promise.resolve()}send(e,t=[],n={}){if(Array.isArray(t)||(t=[t]),f.validation){if(!(parseInt(e)>=128&&parseInt(e)<=255))throw new RangeError("The status must be an integer between 128 and 255.");t.forEach(e=>{if(e=parseInt(e),isNaN(e))throw new TypeError("Data bytes must be integers.");if(!(parseInt(e)>=0&&parseInt(e)<=255))throw new RangeError("The data bytes must be integers between 0 and 255.")}),"number"==typeof n&&(n={time:n})}return this._midiOutput.send([e].concat(t),f.convertToTimestamp(n.time)),this}sendSysex(e,t,n={}){return t=(e=[].concat(e)).concat(t,f.MIDI_SYSTEM_MESSAGES.sysexend),this.send(f.MIDI_SYSTEM_MESSAGES.sysex,t,{time:n.time}),this}clear(){return this._midiOutput.clear?this._midiOutput.clear():f.validation&&console.warn("The 'clear()' method has not yet been implemented in your environment."),this}sendTimecodeQuarterFrame(e,t={}){if(f.validation&&(e=parseInt(e),isNaN(e)||!(e>=0&&e<=127)))throw new RangeError("The value must be an integer between 0 and 127.");return this.send(f.MIDI_SYSTEM_MESSAGES.timecode,e,{time:t.time}),this}setSongPosition(e,t={}){var n=(e=Math.floor(e)||0)>>7&127,r=127&e;return this.send(f.MIDI_SYSTEM_MESSAGES.songposition,[n,r],{time:t.time}),this}sendSongPosition(e,t={}){return f.validation&&console.warn("The sendSongPosition() method has been deprecated. Use setSongPosition() instead."),this.setSongPosition(e,t)}setSong(e,t={}){if(f.validation&&(e=parseInt(e),isNaN(e)||!(e>=1&&e<=128)))throw new RangeError("The program value must be between 1 and 128");return this.send(f.MIDI_SYSTEM_MESSAGES.songselect,[e],{time:t.time}),this}sendSongSelect(e,t={}){return f.validation&&console.warn("The sendSongSelect() method has been deprecated. Use setSong() instead."),this.setSong(e,t)}sendTuneRequest(e={}){return this.send(f.MIDI_SYSTEM_MESSAGES.tunerequest,void 0,{time:e.time}),this}sendClock(e={}){return this.send(f.MIDI_SYSTEM_MESSAGES.clock,void 0,{time:e.time}),this}sendStart(e={}){return this.send(f.MIDI_SYSTEM_MESSAGES.start,void 0,{time:e.time}),this}sendContinue(e={}){return this.send(f.MIDI_SYSTEM_MESSAGES.continue,void 0,{time:e.time}),this}sendStop(e={}){return this.send(f.MIDI_SYSTEM_MESSAGES.stop,void 0,{time:e.time}),this}sendActiveSensing(e={}){return this.send(f.MIDI_SYSTEM_MESSAGES.activesensing,[],{time:e.time}),this}sendReset(e={}){return this.send(f.MIDI_SYSTEM_MESSAGES.reset,void 0,{time:e.time}),this}sendTuningRequest(e={}){return f.validation&&console.warn("The sendTuningRequest() method has been deprecated. Use sendTuningRequest() instead."),this.sendTuneRequest(e)}setKeyAftertouch(e,t,n={},r={}){if(f.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;t=n,(n=r).channels=e}return null==n.channels&&(n.channels="all"),f.sanitizeChannels(n.channels).forEach(r=>{this.channels[r].setKeyAftertouch(e,t,n)}),this}sendKeyAftertouch(e,t,n,r={}){return f.validation&&console.warn("The sendKeyAftertouch() method has been deprecated. Use setKeyAftertouch() instead."),r.channels=t,this.setKeyAftertouch(e,n,r)}sendControlChange(e,t,n={},r={}){if(f.validation&&(Array.isArray(n)||Number.isInteger(n)||"all"===n)){let e=n;(n=r).channels=e}return null==n.channels&&(n.channels="all"),f.sanitizeChannels(n.channels).forEach(r=>{this.channels[r].sendControlChange(e,t,n)}),this}setPitchBendRange(e,t,n={},r={}){if(f.validation&&(Array.isArray(n)||Number.isInteger(n)||"all"===n)){let e=n;(n=r).channels=e}return null==n.channels&&(n.channels="all"),f.sanitizeChannels(n.channels).forEach(r=>{this.channels[r].setPitchBendRange(e,t,n)}),this}setRegisteredParameter(e,t,n={},r={}){if(f.validation&&(Array.isArray(n)||Number.isInteger(n)||"all"===n)){let e=n;(n=r).channels=e}return null==n.channels&&(n.channels="all"),f.sanitizeChannels(n.channels).forEach(r=>{this.channels[r].setRegisteredParameter(e,t,n)}),this}setChannelAftertouch(e,t={},n={}){if(f.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),f.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].setChannelAftertouch(e,t)}),this}sendChannelAftertouch(e,t,n={}){return f.validation&&console.warn("The sendChannelAftertouch() method has been deprecated. Use setChannelAftertouch()."),n.channels=t,this.setChannelAftertouch(e,n)}setPitchBend(e,t={},n={}){if(f.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),f.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].setPitchBend(e,t)}),this}sendPitchBend(e,t,n={}){return f.validation&&console.warn("The sendPitchBend() method has been deprecated. Use setPitchBend() instead."),n.channels=t,this.setPitchBend(e,n)}setProgram(e,t={},n={}){if(f.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),f.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].setProgram(e,t)}),this}sendProgramChange(e,t,n={}){return f.validation&&console.warn("The sendProgramChange() method has been deprecated. Use setProgram() instead."),n.channels=t,this.setProgram(e,n)}setModulationRange(e,t,n={},r={}){if(f.validation&&(Array.isArray(n)||Number.isInteger(n)||"all"===n)){let e=n;(n=r).channels=e}return null==n.channels&&(n.channels="all"),f.sanitizeChannels(n.channels).forEach(r=>{this.channels[r].setModulationRange(e,t,n)}),this}setMasterTuning(e,t={},n={}){if(f.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),f.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].setMasterTuning(e,t)}),this}setTuningProgram(e,t={},n={}){if(f.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),f.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].setTuningProgram(e,t)}),this}setTuningBank(e,t={},n={}){if(f.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),f.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].setTuningBank(e,t)}),this}sendChannelMode(e,t,n={},r={}){if(f.validation&&(Array.isArray(n)||Number.isInteger(n)||"all"===n)){let e=n;(n=r).channels=e}return null==n.channels&&(n.channels="all"),f.sanitizeChannels(n.channels).forEach(r=>{this.channels[r].sendChannelMode(e,t,n)}),this}turnSoundOff(e={},t={}){if(f.validation&&(Array.isArray(e)||Number.isInteger(e)||"all"===e)){let n=e;(e=t).channels=n}return null==e.channels&&(e.channels="all"),f.sanitizeChannels(e.channels).forEach(t=>{this.channels[t].turnSoundOff(e)}),this}turnNotesOff(e={},t={}){if(f.validation&&(Array.isArray(e)||Number.isInteger(e)||"all"===e)){let n=e;(e=t).channels=n}return null==e.channels&&(e.channels="all"),f.sanitizeChannels(e.channels).forEach(t=>{this.channels[t].turnNotesOff(e)}),this}resetAllControllers(e={},t={}){if(f.validation&&(Array.isArray(e)||Number.isInteger(e)||"all"===e)){let n=e;(e=t).channels=n}return null==e.channels&&(e.channels="all"),f.sanitizeChannels(e.channels).forEach(t=>{this.channels[t].resetAllControllers(e)}),this}setPolyphonicMode(e,t={},n={}){if(f.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),f.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].setPolyphonicMode(e,t)}),this}setLocalControl(e,t={},n={}){if(f.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),f.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].setLocalControl(e,t)}),this}setOmniMode(e,t={},n={}){if(f.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),f.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].setOmniMode(e,t)}),this}setNonRegisteredParameter(e,t,n={},r={}){if(f.validation&&(Array.isArray(n)||Number.isInteger(n)||"all"===n)){let e=n;(n=r).channels=e}return null==n.channels&&(n.channels="all"),f.sanitizeChannels(n.channels).forEach(r=>{this.channels[r].setNonRegisteredParameter(e,t,n)}),this}incrementRegisteredParameter(e,t={},n={}){if(f.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),f.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].incrementRegisteredParameter(e,t)}),this}decrementRegisteredParameter(e,t={},n={}){if(f.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),f.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].decrementRegisteredParameter(e,t)}),this}sendNoteOff(e,t={},n={}){if(f.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),f.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].sendNoteOff(e,t)}),this}stopNote(e,t){return this.sendNoteOff(e,t)}playNote(e,t={},n={}){if(f.validation&&(t.rawVelocity&&console.warn("The 'rawVelocity' option is deprecated. Use 'rawAttack' instead."),t.velocity&&console.warn("The 'velocity' option is deprecated. Use 'velocity' instead."),Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),f.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].playNote(e,t)}),this}sendNoteOn(e,t={},n={}){if(f.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){let e=t;(t=n).channels=e}return null==t.channels&&(t.channels="all"),f.sanitizeChannels(t.channels).forEach(n=>{this.channels[n].sendNoteOn(e,t)}),this}get name(){return this._midiOutput.name}get id(){return this._midiOutput.id}get connection(){return this._midiOutput.connection}get manufacturer(){return this._midiOutput.manufacturer}get state(){return this._midiOutput.state}get type(){return this._midiOutput.type}}class d{constructor(e,t={}){Number.isInteger(e)?this.number=e:this.name=e,this.duration=null==t.duration?1/0:t.duration,this.attack=null==t.attack?.5:t.attack,this.release=null==t.release?.5:t.release,null!=t.rawAttack&&(this.rawAttack=t.rawAttack),null!=t.rawRelease&&(this.rawRelease=t.rawRelease)}get name(){return f.NOTES[this._number%12]+f.getOctave(this.number)}set name(e){if(f.validation&&!1===f.guessNoteNumber(e))throw new Error("Invalid note name.");this._number=f.guessNoteNumber(e)}get number(){return this._number}set number(e){if(f.validation&&!1===f.guessNoteNumber(e))throw new Error("Invalid note number.");this._number=f.guessNoteNumber(e)}get duration(){return this._duration}set duration(e){if(f.validation&&(e=parseFloat(e),isNaN(e)||null===e||e<0))throw new RangeError("Invalid duration.");this._duration=e}get attack(){return this._rawAttack/127}set attack(e){if(f.validation&&(e=parseFloat(e),isNaN(e)||null===e||!(e>=0&&e<=1)))throw new RangeError("Invalid attack value.");this._rawAttack=Math.round(127*e)}get rawAttack(){return this._rawAttack}set rawAttack(e){if(f.validation&&(e=parseFloat(e),isNaN(e)||null===e||!(e>=0&&e<=127)))throw new RangeError("Invalid rawAttack value.");this._rawAttack=e}get release(){return this._rawRelease/127}set release(e){if(f.validation&&(e=parseFloat(e),isNaN(e)||null===e||!(e>=0&&e<=1)))throw new RangeError("Invalid release value.");this._rawRelease=Math.round(127*e)}get rawRelease(){return this._rawRelease}set rawRelease(e){if(f.validation&&(e=parseFloat(e),isNaN(e)||null===e||!(e>=0&&e<=127)))throw new RangeError("Invalid rawRelease value.");this._rawRelease=e}get octave(){return Math.floor(Math.floor(this._number)/12-1)}}n.Note=d;class h extends o{constructor(){super(),this.interface=null,this.validation=!0,this._inputs=[],this._outputs=[],this._stateChangeQueue=[],this._octaveOffset=0,this.isNode&&(r.performance=e("perf_hooks").performance,r.navigator=e("jzz"))}async enable(e={},t=!1){if(this.enabled)return Promise.resolve();this.validation=!1!==e.validation,this.validation&&("function"==typeof e&&(e={callback:e,sysex:t}),t&&(e.sysex=!0)),this.supported||await new Promise((t,n)=>{const r=this.time,i=setInterval(()=>{if(this.supported)clearInterval(i),t();else if(this.time>r+1500){clearInterval(i);let t=new Error("Web MIDI API support is not available in your environment.");"function"==typeof e.callback&&e.callback(t),n(t)}},25)});try{this.interface=await navigator.requestMIDIAccess({sysex:e.sysex,software:e.software})}catch(t){return"function"==typeof e.callback&&e.callback(t),Promise.reject(t)}let n={timestamp:this.time,target:this,type:"enabled"};this.emit("enabled",n),"function"==typeof e.callback&&e.callback(),this.interface.onstatechange=this._onInterfaceStateChange.bind(this);try{let e=await this._updateInputsAndOutputs();return Promise.resolve({inputs:e[0],outputs:e[1]})}catch(e){return Promise.reject(e)}}async disable(){if(!this.supported)throw new Error("The Web MIDI API is not supported by your environment.");return this._destroyInputsAndOutputs().then(()=>{this.isNode&&navigator.close(),this.interface&&(this.interface.onstatechange=void 0),this.interface=null;let e={timestamp:this.time,target:this,type:"disabled"};this.emit("disabled",e),this.removeListener()})}getInputById(e){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return!1}for(let t=0;t<this.inputs.length;t++)if(this.inputs[t].id===e.toString())return this.inputs[t];return!1}getInputByName(e){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return!1;e=e.toString()}for(let t=0;t<this.inputs.length;t++)if(~this.inputs[t].name.indexOf(e))return this.inputs[t];return!1}getOutputByName(e){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return!1;e=e.toString()}for(let t=0;t<this.outputs.length;t++)if(~this.outputs[t].name.indexOf(e))return this.outputs[t];return!1}getOutputById(e){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return!1}for(let t=0;t<this.outputs.length;t++)if(this.outputs[t].id===e.toString())return this.outputs[t];return!1}getNoteNumberByName(e){this.validation&&"string"!=typeof e&&(e="");let t=e.match(/([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)/i);if(!t)return!1;let n={C:0,D:2,E:4,F:5,G:7,A:9,B:11}[t[1].toUpperCase()],r=12*(parseInt(t[3])+1-Math.floor(this.octaveOffset))+n;return t[2].toLowerCase().indexOf("b")>-1?r-=t[2].length:t[2].toLowerCase().indexOf("#")>-1&&(r+=t[2].length),!(r<0||r>127)&&r}noteNameToNumber(e){return console.warn("The noteNameToNumber() method has been deprecated. Use getNoteNumberByName() instead."),this.getNoteNumberByName(e)}getOctave(e){return this.validation&&(e=parseInt(e)),!isNaN(e)&&e>=0&&e<=127&&Math.floor(e/12-1)+this.octaveOffset}sanitizeChannels(e){let t;if(this.validation)if("all"===e)t=["all"];else if("none"===e)return[];return t=Array.isArray(e)?e:[e],t.indexOf("all")>-1&&(t=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),t.map((function(e){return parseInt(e)})).filter((function(e){return e>=1&&e<=16}))}toMIDIChannels(e){return this.validation&&console.warn("The toMIDIChannels() method has been deprecated. Use sanitizeChannels() instead."),this.sanitizeChannels(e)}guessNoteNumber(e){let t=!1;return Number.isInteger(e)&&e>=0&&e<=127||parseInt(e)>=0&&parseInt(e)<=127?t=parseInt(e):("string"==typeof e||e instanceof String)&&(t=this.getNoteNumberByName(e)),!1!==t&&t}getValidNoteArray(e,t={}){let n=[];return Array.isArray(e)||(e=[e]),e.forEach(e=>{n.push(this.getNoteObject(e,t))}),n}getNoteObject(e,t){if(e instanceof d)return e;{let n=this.guessNoteNumber(e);if(!1!==n)return new d(n,t);throw new TypeError(`The input could not be parsed as a note (${e})`)}}convertToTimestamp(e){let t=!1,n=parseFloat(e);return!isNaN(n)&&("string"==typeof e&&"+"===e.substring(0,1)?n>=0&&(t=this.time+n):n>=0&&(t=n),t)}async _destroyInputsAndOutputs(){let e=[];return this.inputs.forEach(t=>e.push(t.destroy())),this.outputs.forEach(t=>e.push(t.destroy())),Promise.all(e).then(()=>{this._inputs=[],this._outputs=[]})}_onInterfaceStateChange(e){this._updateInputsAndOutputs();let t={timestamp:e.timeStamp,type:e.port.state};this.interface&&"connected"===e.port.state?"output"===e.port.type?(t.port=this.getOutputById(e.port.id),t.target=t.port):"input"===e.port.type&&(t.port=this.getInputById(e.port.id),t.target=t.port):(t.port={connection:"closed",id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},t.target=t.port),this.emit(e.port.state,t)}async _updateInputsAndOutputs(){return Promise.all([this._updateInputs(),this._updateOutputs()])}async _updateInputs(){let e=[];for(let e=0;e<this._inputs.length;e++){let t=!0,n=this.interface.inputs.values();for(let r=n.next();r&&!r.done;r=n.next())if(this._inputs[e]._midiInput===r.value){t=!1;break}t&&this._inputs.splice(e,1)}return this.interface&&this.interface.inputs.forEach(t=>{let n=!0;for(let e=0;e<this._inputs.length;e++)this._inputs[e]._midiInput===t&&(n=!1);if(n){let n=new c(t);this._inputs.push(n),e.push(n.open())}}),Promise.all(e)}async _updateOutputs(){let e=[];for(let e=0;e<this._outputs.length;e++){let t=!0,n=this.interface.outputs.values();for(let r=n.next();r&&!r.done;r=n.next())if(this._outputs[e]._midiOutput===r.value){t=!1;break}t&&(this._outputs[e].close(),this._outputs.splice(e,1))}return this.interface&&this.interface.outputs.forEach(t=>{let n=!0;for(let e=0;e<this._outputs.length;e++)this._outputs[e]._midiOutput===t&&(n=!1);if(n){let n=new l(t);this._outputs.push(n),e.push(n.open())}}),Promise.all(e)}get enabled(){return null!==this.interface}get inputs(){return this._inputs}get isNode(){return"[object process]"===Object.prototype.toString.call(void 0!==i?i:0)}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be a valid number.");this._octaveOffset=e}get outputs(){return this._outputs}get supported(){return!(!navigator||!navigator.requestMIDIAccess)}get sysexEnabled(){return!(!this.interface||!this.interface.sysexEnabled)}get time(){return performance.now()}get MIDI_CHANNEL_VOICE_MESSAGES(){return{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,channelmode:11,nrpn:11,programchange:12,channelaftertouch:13,pitchbend:14}}get MIDI_CHANNEL_MESSAGES(){return console.warn("MIDI_CHANNEL_MESSAGES has been deprecated. Use MIDI_CHANNEL_VOICE_MESSAGES instead."),this.MIDI_CHANNEL_VOICE_MESSAGES}get MIDI_CHANNEL_MODE_MESSAGES(){return{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127}}get MIDI_CONTROL_CHANGE_MESSAGES(){return{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101}}get MIDI_INTERFACE_EVENTS(){return["connected","disconnected"]}get MIDI_NRPN_MESSAGES(){return{entrymsb:6,entrylsb:38,increment:96,decrement:97,paramlsb:98,parammsb:99,nullactiveparameter:127}}get MIDI_REGISTERED_PARAMETER(){return{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]}}get MIDI_SYSTEM_MESSAGES(){return{sysex:240,timecode:241,songposition:242,songselect:243,tunerequest:246,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1}}get NOTES(){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"]}}const f=new h;n.WebMidi=f,f.constructor=null},{process:"4de4a03e94e27ceb4ecf8a26d457f9e0",perf_hooks:"1a18f5bac23c457f272febc33a8beeba",jzz:"5056c4ac19c98d86048b6bfef303f636"}],"4de4a03e94e27ceb4ecf8a26d457f9e0":[function(e,t,n){var r,i,o=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function c(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(e){i=s}}();var u,l=[],d=!1,h=-1;function f(){d&&u&&(d=!1,u.length?l=u.concat(l):h=-1,l.length&&p())}function p(){if(!d){var e=c(f);d=!0;for(var t=l.length;t;){for(u=l,l=[];++h<t;)u&&u[h].run();h=-1,t=l.length}u=null,d=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function g(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new m(e,t)),1!==l.length||d||c(p)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],"1a18f5bac23c457f272febc33a8beeba":[function(e,t,n){},{}],"5056c4ac19c98d86048b6bfef303f636":[function(e,t,n){var r,i=arguments[3];!function(e,i){if("object"==typeof n&&void 0!==t)t.exports=i();else if("function"==typeof r&&r.amd)r("JZZ",[],i);else{if(e||(e=window),e.JZZ&&e.JZZ.MIDI)return;e.JZZ=i()}}(this,(function(){var n,r,o,a,s,c="undefined"==typeof window?i:window,u=Date.now||function(){return(new Date).getTime()},l=u(),d="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return u()-l},h=function(e){setTimeout(e,0)};function f(){this._orig=this,this._ready=!1,this._queue=[],this._log=[]}function p(e,t){this._bad?t instanceof Function&&t.apply(this,[new Error(this._err())]):e instanceof Function&&e.apply(this,[this])}function m(e,t){this._bad?e._crash(this._err()):setTimeout((function(){e._resume()}),t)}function g(e){this._bad&&e._break(this._err()),e._resume()}function y(e,t,n){e[n]=function(){var e=arguments,r=t._image();return this._push(g,[r]),r[n].apply(r,e)}}function b(e){this._bad||(e instanceof Function?e.apply(this):console.log(e))}function v(e){this._bad&&(e instanceof Function?e.apply(this):console.log(e))}function _(e){this._bad?e._crash(this._err()):(this._break("Closed"),e._resume())}function w(e){if(e.length){var t=e.shift();if(e.length){var n=this;this._slip(v,[function(){w.apply(n,[e])}])}try{this._repair(),t.apply(this)}catch(e){this._break(e.toString())}}else this._break()}function I(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return;e.push(t)}function S(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return void e.splice(n,1)}function E(){f.apply(this)}function C(e,t,n){if(void 0===t)return C(e,[],[]);if(e instanceof Object){for(var r=0;r<t.length;r++)if(t[r]===e)return n[r];var i;for(var o in i=e instanceof Array?[]:{},t.push(e),n.push(i),e)e.hasOwnProperty(o)&&(i[o]=C(e[o],t,n));return i}return e}f.prototype._exec=function(){for(;this._ready&&this._queue.length;){var e=this._queue.shift();e[0].apply(this,e[1])}},f.prototype._push=function(e,t){this._queue.push([e,t]),f.prototype._exec.apply(this)},f.prototype._slip=function(e,t){this._queue.unshift([e,t])},f.prototype._pause=function(){this._ready=!1},f.prototype._resume=function(){this._ready=!0,f.prototype._exec.apply(this)},f.prototype._break=function(e){this._orig._bad=!0,this._orig._log.push(e||"Unknown JZZ error")},f.prototype._repair=function(){this._orig._bad=!1},f.prototype._crash=function(e){this._break(e),this._resume()},f.prototype._err=function(){return this._log[this._log.length-1]},f.prototype.log=function(){return C(this._log)},f.prototype._image=function(){var e=function(){};e.prototype=this._orig;var t=new e;return t._ready=!1,t._queue=[],t},f.prototype._thenable=function(){var e=this,t=function(){};t.prototype=e;var n=new t;return n.then=function(t,n){return e._push(p,[t,n]),this},n},f.prototype.wait=function(e){if(!e)return this;var t=this._image();return this._push(m,[t,e]),t._thenable()},f.prototype.and=function(e){return this._push(b,[e]),this._thenable()},f.prototype.or=function(e){return this._push(v,[e]),this._thenable()},f.prototype._info={},f.prototype.info=function(){var e=C(this._orig._info);return void 0===e.engine&&(e.engine="none"),void 0===e.sysex&&(e.sysex=!0),e},f.prototype.name=function(){return this.info().name},f.prototype.close=function(){var e=new f;return this._close&&this._push(this._close,[]),this._push(_,[e]),e._thenable()},E.prototype=new f,E.prototype._info={name:"JZZ.js",ver:"1.1.7",version:"1.1.7",inputs:[],outputs:[]};var A,M=[],T=[],x=[],N=[];function O(){var e,t;for(A._info.engine=K._type,A._info.version=K._version,A._info.sysex=K._sysex,A._info.inputs=[],A._info.outputs=[],M=[],T=[],K._allOuts={},K._allIns={},e=0;e<K._outs.length;e++)(t=K._outs[e]).engine=K,K._allOuts[t.name]=t,A._info.outputs.push({id:t.name,name:t.name,manufacturer:t.manufacturer,version:t.version,engine:K._type}),M.push(t);for(e=0;e<ee._outs.length;e++)t=ee._outs[e],A._info.outputs.push({id:t.name,name:t.name,manufacturer:t.manufacturer,version:t.version,engine:t.type}),M.push(t);for(e=0;e<K._ins.length;e++)(t=K._ins[e]).engine=K,K._allIns[t.name]=t,A._info.inputs.push({id:t.name,name:t.name,manufacturer:t.manufacturer,version:t.version,engine:K._type}),T.push(t);for(e=0;e<ee._ins.length;e++)t=ee._ins[e],A._info.inputs.push({id:t.name,name:t.name,manufacturer:t.manufacturer,version:t.version,engine:t.type}),T.push(t);if(A._watcher&&A._watcher._handles.length){var n=function(e,t,n,r){if(!function(e,t,n,r){var i;if(e.length!=n.length||t.length!=r.length)return!0;for(i=0;i<e.length;i++)if(e[i].name!=n[i].name)return!0;for(i=0;i<t.length;i++)if(t[i].name!=r[i].name)return!0;return!1}(e,t,n,r))return;var i,o=[],a=[],s=[],c=[],u={};for(i=0;i<e.length;i++)u[e[i].name]=!0;for(i=0;i<n.length;i++)u[n[i].name]||o.push(n[i]);for(u={},i=0;i<n.length;i++)u[n[i].name]=!0;for(i=0;i<e.length;i++)u[e[i].name]||s.push(e[i]);for(u={},i=0;i<t.length;i++)u[t[i].name]=!0;for(i=0;i<r.length;i++)u[r[i].name]||a.push(r[i]);for(u={},i=0;i<r.length;i++)u[r[i].name]=!0;for(i=0;i<t.length;i++)u[t[i].name]||c.push(t[i]);return{inputs:{added:o,removed:s},outputs:{added:a,removed:c}}}(N,x,A._info.inputs,A._info.outputs);if(n){for(r=0;r<n.inputs.removed.length;r++)(t=K._inMap[n.inputs.removed[r].name])&&t._closeAll();for(r=0;r<n.outputs.removed.length;r++)(t=K._outMap[n.outputs.removed[r].name])&&t._closeAll();X(n)}}N=A._info.inputs,x=A._info.outputs}function B(){this._bad||K._refresh(this)}function k(e,t){var n,r;e instanceof Function&&(e=e(t)),e instanceof Array||(e=[e]);var i=[],o=[],a=t.slice(),s=i;for(n=0;n<e.length;n++)if(void 0===e[n])s=o;else if(e[n]instanceof RegExp)for(r=0;r<a.length;r++)e[n].test(a[r].name)&&(s.push(a[r]),a.splice(r,1),r--);else for(r=0;r<a.length;r++)(e[n]+""==r+""||e[n]===a[r].name||e[n]instanceof Object&&e[n].name===a[r].name)&&(s.push(a[r]),a.splice(r,1),r--);return s==i?i:i.concat(a).concat(o)}function D(e,t){var n;n=t instanceof RegExp?"Port matching "+t+" not found":t instanceof Object||void 0===t?"Port not found":'Port "'+t+'" not found',e._crash(n)}function R(e,t){if(this._bad)e._crash(this._err());else{var n=k(t,M);if(!n.length)return void D(e,t);for(var r=function(e){return function(){e.engine._openOut(this,e.name)}},i=0;i<n.length;i++)n[i]=r(n[i]);e._slip(w,[n]),e._resume()}}function P(e,t){if(this._bad)e._crash(this._err());else{var n=k(t,T);if(!n.length)return void D(e,t);for(var r=function(e){return function(){e.engine._openIn(this,e.name)}},i=0;i<n.length;i++)n[i]=r(n[i]);e._slip(w,[n]),e._resume()}}function L(e,t){this._bad?e._crash():(e._slip(Z,[t]),e._resume())}function F(){f.apply(this),this._handles=[],this._outs=[]}function V(e){this._bad||this._receive(e)}function U(e){this._emit(e)}function j(e){I(e instanceof Function?this._orig._handles:this._orig._outs,e)}function G(e){void 0===e?(this._orig._handles=[],this._orig._outs=[]):S(e instanceof Function?this._orig._handles:this._orig._outs,e)}function q(e,t){this._orig._mpe||(this._orig._mpe=new Je),this._orig._mpe.setup(e,t)}function Q(e){if(e!=parseInt(e)||e<0||e>15)throw RangeError("Bad channel value (must not be less than 0 or more than 15): "+e)}function z(e,t){F.apply(this),this._port=e._orig,this._chan=t,y(this,this._port,"ch"),y(this,this._port,"mpe"),y(this,this._port,"connect"),y(this,this._port,"disconnect"),y(this,this._port,"close")}function W(e,t,n){F.apply(this),this._port=e._orig,this._master=t,this._band=n,y(this,this._port,"ch"),y(this,this._port,"mpe"),y(this,this._port,"connect"),y(this,this._port,"disconnect"),y(this,this._port,"close")}function H(){f.apply(this),this._handles=[],y(this,A,"refresh"),y(this,A,"openMidiOut"),y(this,A,"openMidiIn"),y(this,A,"onChange"),y(this,A,"close")}function Z(e){e instanceof Function&&(this._orig._handles.length||K._watch(),I(this._orig._handles,e))}function Y(e){void 0===e?this._orig._handles=[]:S(this._orig._handles,e),this._orig._handles.length||K._unwatch()}function X(e){for(n=0;n<A._watcher._handles.length;n++)A._watcher._handles[n].apply(A,[e])}E.prototype.refresh=function(){return this._push(B,[]),this._thenable()},E.prototype.openMidiOut=function(e){var t=new F;return this._push(B,[]),this._push(R,[t,e]),t._thenable()},E.prototype._openMidiOutNR=function(e){var t=new F;return this._push(R,[t,e]),t._thenable()},E.prototype.openMidiIn=function(e){var t=new F;return this._push(B,[]),this._push(P,[t,e]),t._thenable()},E.prototype._openMidiInNR=function(e){var t=new F;return this._push(P,[t,e]),t._thenable()},E.prototype.onChange=function(e){this._orig._watcher||(this._orig._watcher=new H);var t=this._orig._watcher._image();return this._push(L,[t,e]),t._thenable()},E.prototype._close=function(){K._close()},F.prototype=new f,F.prototype._filter=function(e){if(this._orig._mpe){var t,n=0;this._handles&&this._handles.length&&(n=this._handles.length,t=this._handles[0]),this._outs&&this._outs.length&&(n=this._outs.length,t=this._outs[0]),1!=n||t._mpe||(e=this._orig._mpe.filter(e))}return e},F.prototype._receive=function(e){this._emit(this._filter(e))},F.prototype.send=function(){return this._push(V,[ve.apply(null,arguments)]),this._thenable()},F.prototype.note=function(e,t,n,r){return this.noteOn(e,t,n),r>0&&this.wait(r).noteOff(e,t),this._thenable()},F.prototype._emit=function(e){var t;for(t=0;t<this._handles.length;t++)this._handles[t].apply(this,[ve(e)._stamp(this)]);for(t=0;t<this._outs.length;t++){var n=ve(e);n._stamped(this._outs[t])||this._outs[t].send(n._stamp(this))}},F.prototype.emit=function(e){return this._push(U,[e]),this._thenable()},F.prototype.connect=function(e){return this._push(j,[e]),this._thenable()},F.prototype.disconnect=function(e){return this._push(G,[e]),this._thenable()},F.prototype.connected=function(){return this._orig._handles.length+this._orig._outs.length},F.prototype.ch=function(e){if(void 0===e)return this;Q(e);var t=new z(this,e);return this._push(g,[t]),t._thenable()},F.prototype.mpe=function(e,t){if(void 0===e&&void 0===t)return this;Je.validate(e,t);var n=t?new W(this,e,t):new z(this,e);return this._push(q,[e,t]),this._push(g,[n]),n._thenable()},z.prototype=new F,z.prototype.channel=function(){return this._chan},z.prototype._receive=function(e){this._port._receive(e)},z.prototype.note=function(e,t,n){return this.noteOn(e,t),n&&this.wait(n).noteOff(e),this._thenable()},W.prototype=new F,W.prototype.channel=function(){return this._master},W.prototype._receive=function(e){this._port._receive(e)},W.prototype.note=function(e,t,n){return this.noteOn(e,t),n&&this.wait(n).noteOff(e),this._thenable()},H.prototype=new f,H.prototype.connect=function(e){return this._push(Z,[e]),this._thenable()},H.prototype.disconnect=function(e){return this._push(Y,[e]),this._thenable()};var J,$,K={_outs:[],_ins:[]},ee={_outs:[],_ins:[]};function te(){if(void 0!==t&&t.exports)return n=e("jazz-midi"),K._type="node",K._main=n,K._pool=[],K._newPlugin=function(){return new n.MIDI},void ue();var n;this._break()}function ne(){var e=document.createElement("div");e.style.visibility="hidden",document.body.appendChild(e);var t=document.createElement("object");t.style.visibility="hidden",t.style.width="0px",t.style.height="0px",t.classid="CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90",t.type="audio/x-jazz",document.body.appendChild(t),t.isJazz?function(e){K._type="plugin",K._main=e,K._pool=[e],K._newPlugin=function(){var t=document.createElement("object");return t.style.visibility="hidden",t.style.width="0px",e.style.height="0px",t.classid="CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90",t.type="audio/x-jazz",document.body.appendChild(t),t.isJazz?t:void 0},ue()}(t):this._break()}if("undefined"!=typeof navigator&&navigator.requestMIDIAccess){J=navigator,$=navigator.requestMIDIAccess;try{-1!=$.toString().indexOf("JZZ(")&&($=void 0)}catch(e){}}function re(){if($){var e=this;return $.call(J,{}).then((function(t){le(t),e._resume()}),(function(t){e._crash(t)})),void this._pause()}this._break()}function ie(){if($){var e=this;return $.call(J,{sysex:!0}).then((function(t){le(t,!0),e._resume()}),(function(t){e._crash(t)})),void this._pause()}this._break()}function oe(){var e,t,n=this;this._pause(),document.addEventListener("jazz-midi-msg",(function r(){if(e=!0,t||(t=document.getElementById("jazz-midi-msg")),t){var i=[];try{i=JSON.parse(t.innerText)}catch(e){}t.innerText="",document.removeEventListener("jazz-midi-msg",r),"version"===i[0]?(!function(e,t){function n(){for(var e=0;e<this.clients.length;e++)this._close(this.clients[e])}var r;K._type="extension",K._version=t,K._sysex=!0,K._pool=[],K._outs=[],K._ins=[],K._inArr=[],K._outArr=[],K._inMap={},K._outMap={},K._outsW=[],K._insW=[],K.refreshClients=[],K._msg=e,K._newPlugin=function(){var e={id:K._pool.length};K._pool.push(e),e.id?document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["new"]})):e.ready=!0},K._newPlugin(),K._refresh=function(e){K.refreshClients.push(e),e._pause(),h((function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["refresh"]}))}))},K._openOut=function(e,t){var r=K._outMap[t];if(!r){K._pool.length<=K._outArr.length&&K._newPlugin();var i=K._pool[K._outArr.length];(r={name:t,clients:[],info:{name:t,manufacturer:K._allOuts[t].manufacturer,version:K._allOuts[t].version,type:"MIDI-out",sysex:K._sysex,engine:K._type},_start:function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["openout",i.id,t]}))},_close:function(e){K._closeOut(e)},_closeAll:n,_receive:function(e){if(e.length){var t=e.slice();t.splice(0,0,"play",i.id),document.dispatchEvent(new CustomEvent("jazz-midi",{detail:t}))}}}).plugin=i,i.output=r,K._outArr.push(r),K._outMap[t]=r}e._orig._impl=r,I(r.clients,e._orig),e._info=r.info,e._receive=function(e){r._receive(e)},e._close=function(){r._close(this)},r.open||(e._pause(),r.plugin.ready&&r._start())},K._openIn=function(e,t){var r=K._inMap[t];if(!r){K._pool.length<=K._inArr.length&&K._newPlugin();var i=K._pool[K._inArr.length];(r={name:t,clients:[],info:{name:t,manufacturer:K._allIns[t].manufacturer,version:K._allIns[t].version,type:"MIDI-in",sysex:K._sysex,engine:K._type},_start:function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["openin",i.id,t]}))},_close:function(e){K._closeIn(e)},_closeAll:n}).plugin=i,i.input=r,K._inArr.push(r),K._inMap[t]=r}e._orig._impl=r,I(r.clients,e._orig),e._info=r.info,e._close=function(){r._close(this)},r.open||(e._pause(),r.plugin.ready&&r._start())},K._closeOut=function(e){var t=e._impl;S(t.clients,e._orig),!t.clients.length&&t.open&&(t.open=!1,document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["closeout",t.plugin.id]})))},K._closeIn=function(e){var t=e._impl;S(t.clients,e._orig),!t.clients.length&&t.open&&(t.open=!1,document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["closein",t.plugin.id]})))},K._close=function(){K._unwatch()},K._watch=function(){K._insW=K._ins,K._outsW=K._outs,r=setInterval((function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["refresh"]}))}),250)},K._unwatch=function(){clearInterval(r),r=void 0},document.addEventListener("jazz-midi-msg",(function(){var e,t,n,r=K._msg.innerText.split("\n");for(K._msg.innerText="",t=0;t<r.length;t++){var i=[];try{i=JSON.parse(r[t])}catch(e){}if(i.length)if("refresh"===i[0]){if(i[1].ins){for(n=0;n<i[1].ins.length;n++)i[1].ins[n].type=K._type;K._ins=i[1].ins}if(i[1].outs){for(n=0;n<i[1].outs.length;n++)i[1].outs[n].type=K._type;K._outs=i[1].outs}for(O(),n=0;n<K.refreshClients.length;n++)K.refreshClients[n]._resume();K.refreshClients=[]}else if("version"===i[0]){var o=K._pool[i[1]];o&&(o.ready=!0,o.input&&o.input._start(),o.output&&o.output._start())}else if("openout"===i[0]){if(e=K._pool[i[1]].output)if(i[2]==e.name){if(e.open=!0,e.clients)for(n=0;n<e.clients.length;n++)e.clients[n]._resume()}else if(e.clients)for(n=0;n<e.clients.length;n++)e.clients[n]._crash()}else if("openin"===i[0]){if(e=K._pool[i[1]].input)if(i[2]==e.name){if(e.open=!0,e.clients)for(n=0;n<e.clients.length;n++)e.clients[n]._resume()}else if(e.clients)for(n=0;n<e.clients.length;n++)e.clients[n]._crash()}else if("midi"===i[0]&&(e=K._pool[i[1]].input)&&e.clients)for(n=0;n<e.clients.length;n++){var a=ve(i.slice(3));e.clients[n]._emit(a)}}}))}(t,i[2]),n._resume()):n._crash()}}));try{document.dispatchEvent(new Event("jazz-midi"))}catch(e){}h((function(){e||n._crash()}))}function ae(){this._pause();var e=this;h((function(){e._crash()}))}function se(e){for(var t=[],n=function(e){var t=["node","extension","plugin","webmidi"];if(!e||!e.engine)return t;var n,r,i,o=e.engine instanceof Array?e.engine:[e.engine],a={},s=[],c=[];for(i=0;i<o.length;i++){var u=o[i].toString().toLowerCase();a[u]||(a[u]=!0,"none"===u&&(n=!0),"etc"!==u&&void 0!==u||(r=!0),r?c.push(u):s.push(u),S(t,u))}(r||s.length||c.length)&&(n=!1);return n?[]:s.concat(r?t:c)}(e),r=0;r<n.length;r++)"webmidi"==n[r]?(e&&!0===e.sysex&&t.push(ie),e&&!0===e.sysex&&!0!==e.degrade||t.push(re)):"node"==n[r]?(t.push(te),t.push(ae)):"extension"==n[r]?t.push(oe):"plugin"==n[r]&&t.push(ne);return t.push(ce),t}function ce(){K._type="none",K._version="1.1.7",K._sysex=!0,K._outs=[],K._ins=[],K._refresh=function(){O()},K._watch=function(){},K._unwatch=function(){},K._close=function(){}}function ue(){var e;function t(){for(var e=0;e<this.clients.length;e++)this._close(this.clients[e])}K._inArr=[],K._outArr=[],K._inMap={},K._outMap={},K._outsW=[],K._insW=[],K._version=K._main.version,K._sysex=!0,K._refresh=function(){var e,t;for(K._outs=[],K._ins=[],e=0;(t=K._main.MidiOutInfo(e)).length;e++)K._outs.push({type:K._type,name:t[0],manufacturer:t[1],version:t[2]});for(e=0;(t=K._main.MidiInInfo(e)).length;e++)K._ins.push({type:K._type,name:t[0],manufacturer:t[1],version:t[2]});O()},K._openOut=function(e,n){var r=K._outMap[n];if(!r){K._pool.length<=K._outArr.length&&K._pool.push(K._newPlugin()),r={name:n,clients:[],info:{name:n,manufacturer:K._allOuts[n].manufacturer,version:K._allOuts[n].version,type:"MIDI-out",sysex:K._sysex,engine:K._type},_close:function(e){K._closeOut(e)},_closeAll:t,_receive:function(e){e.length&&this.plugin.MidiOutRaw(e.slice())}};var i=K._pool[K._outArr.length];r.plugin=i,K._outArr.push(r),K._outMap[n]=r}if(!r.open){var o=r.plugin.MidiOutOpen(n);if(o!==n)return o&&r.plugin.MidiOutClose(),void e._break();r.open=!0}e._orig._impl=r,I(r.clients,e._orig),e._info=r.info,e._receive=function(e){r._receive(e)},e._close=function(){r._close(this)}},K._openIn=function(e,n){var r,i=K._inMap[n];if(!i){K._pool.length<=K._inArr.length&&K._pool.push(K._newPlugin());(i={name:n,clients:[],info:{name:n,manufacturer:K._allIns[n].manufacturer,version:K._allIns[n].version,type:"MIDI-in",sysex:K._sysex,engine:K._type},_close:function(e){K._closeIn(e)},_closeAll:t,handle:function(e,t){for(var n=0;n<this.clients.length;n++){var r=ve(t);this.clients[n]._emit(r)}}}).onmidi=(r=i,function(e,t){r.handle(e,t)});var o=K._pool[K._inArr.length];i.plugin=o,K._inArr.push(i),K._inMap[n]=i}if(!i.open){var a=i.plugin.MidiInOpen(n,i.onmidi);if(a!==n)return a&&i.plugin.MidiInClose(),void e._break();i.open=!0}e._orig._impl=i,I(i.clients,e._orig),e._info=i.info,e._close=function(){i._close(this)}},K._closeOut=function(e){var t=e._impl;S(t.clients,e._orig),!t.clients.length&&t.open&&(t.open=!1,t.plugin.MidiOutClose())},K._closeIn=function(e){var t=e._impl;S(t.clients,e._orig),!t.clients.length&&t.open&&(t.open=!1,t.plugin.MidiInClose())},K._close=function(){for(var e=0;e<K._inArr.length;e++)K._inArr[e].open&&K._inArr[e].plugin.MidiInClose();K._unwatch()},K._watch=function(){e||(e=setInterval((function(){K._refresh()}),250))},K._unwatch=function(){e&&clearInterval(e),e=void 0}}function le(e,t){var n;function r(){for(var e=0;e<this.clients.length;e++)this._close(this.clients[e])}K._type="webmidi",K._version=43,K._sysex=!!t,K._access=e,K._inMap={},K._outMap={},K._outsW=[],K._insW=[],K._refresh=function(){K._outs=[],K._ins=[],K._access.outputs.forEach((function(e){K._outs.push({type:K._type,name:e.name,manufacturer:e.manufacturer,version:e.version})})),K._access.inputs.forEach((function(e){K._ins.push({type:K._type,name:e.name,manufacturer:e.manufacturer,version:e.version})})),O()},K._openOut=function(e,t){var n,i=K._outMap[t];i||(i={name:t,clients:[],info:{name:t,manufacturer:K._allOuts[t].manufacturer,version:K._allOuts[t].version,type:"MIDI-out",sysex:K._sysex,engine:K._type},_close:function(e){K._closeOut(e)},_closeAll:r,_receive:function(e){i.dev&&e.length&&this.dev.send(e.slice())}}),K._access.outputs.forEach((function(e){e.name===t&&(n=e)})),n?(i.dev=n,K._outMap[t]=i,e._orig._impl=i,I(i.clients,e._orig),e._info=i.info,e._receive=function(e){i._receive(e)},e._close=function(){i._close(this)},i.dev.open&&(e._pause(),i.dev.open().then((function(){e._resume()}),(function(){e._crash()})))):e._break()},K._openIn=function(e,t){var n,i,o=K._inMap[t];if(o||(o={name:t,clients:[],info:{name:t,manufacturer:K._allIns[t].manufacturer,version:K._allIns[t].version,type:"MIDI-in",sysex:K._sysex,engine:K._type},_close:function(e){K._closeIn(e)},_closeAll:r,handle:function(e){for(var t=0;t<this.clients.length;t++){var n=ve([].slice.call(e.data));this.clients[t]._emit(n)}}}),K._access.inputs.forEach((function(e){e.name===t&&(n=e)})),n){o.dev=n;o.dev.onmidimessage=(i=o,function(e){i.handle(e)}),K._inMap[t]=o,e._orig._impl=o,I(o.clients,e._orig),e._info=o.info,e._close=function(){o._close(this)},o.dev.open&&(e._pause(),o.dev.open().then((function(){e._resume()}),(function(){e._crash()})))}else e._break()},K._closeOut=function(e){var t=e._impl;S(t.clients,e._orig),t.clients.length||(t.dev&&t.dev.close&&t.dev.close(),t.dev=void 0)},K._closeIn=function(e){var t=e._impl;S(t.clients,e._orig),t.clients.length||(t.dev&&(t.dev.onmidimessage=null,t.dev.close&&t.dev.close()),t.dev=void 0)},K._close=function(){K._unwatch()},K._watch=function(){K._access.onstatechange=function(){n=!0,h((function(){n&&(K._refresh(),n=!1)}))}},K._unwatch=function(){K._access.onstatechange=void 0}}var de=function(e){return A||function(e){$e(),(A=new E)._options=e,A._push(w,[se(e)]),A.refresh(),A._resume()}(e),A._thenable()};function he(){var e=this instanceof he?this:e=new he;return he.prototype.reset.apply(e,arguments),e}function fe(){29.97==this.type&&!this.second&&this.frame<2&&this.minute%10&&(this.frame=2)}function pe(e){return[[24,25,29.97,30][e[7]>>1&3],(1&e[7])<<4|e[6],e[5]<<4|e[4],e[3]<<4|e[2],e[1]<<4|e[0]]}function me(e){var t;switch(!e.backwards&&e.quarter>=4?e.decrFrame():e.backwards&&e.quarter<4&&e.incrFrame(),e.quarter>>1){case 0:t=e.frame;break;case 1:t=e.second;break;case 2:t=e.minute;break;default:t=e.hour}return 1&e.quarter?t>>=4:t&=15,7==e.quarter&&(25==e.type?t|=2:29.97==e.type?t|=4:30==e.type&&(t|=6)),!e.backwards&&e.quarter>=4?e.incrFrame():e.backwards&&e.quarter<4&&e.decrFrame(),t|e.quarter<<4}function ge(e){return 25==e.type?32|e.hour:29.97==e.type?64|e.hour:30==e.type?96|e.hour:e.hour}function ye(e){return e<10?"0"+e:e}function be(e){for(var t=[],n=0;n<e.length;n++)t[n]=ye(e[n]);return t.join(":")}function ve(e){var t,n=this instanceof ve?this:n=new ve;if(e instanceof ve){for(t in n._from=e._from.slice(),e)e.hasOwnProperty(t)&&"_from"!=t&&(n[t]=e[t]);return n}if(n._from=[],void 0===e)return n;var r=e instanceof Array?e:arguments;for(t=0;t<r.length;t++)s=r[t],1==t&&(n[0]>=128&&n[0]<=175&&(s=ve.noteValue(s)),n[0]>=192&&n[0]<=207&&(s=ve.programValue(s))),(s!=parseInt(s)||s<0||s>255)&&Ie(r[t]),n.push(s);return n}de.JZZ=de,de.version="1.1.7",de.info=function(){return E.prototype.info()},de.Widget=function(e){var t=new F;if(e instanceof Object)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t._resume(),t},E.prototype.Widget=de.Widget,de.addMidiIn=function(e,t){var n=C(t._info||{});n.name=e,n.type=n.type||"javascript",n.manufacturer=n.manufacturer||"virtual",n.version=n.version||"0.0";var r={_info:function(){return n},_openIn:function(e){e._pause(),e._info=C(n),e._close=function(){t.disconnect(e)},t.connect(e),e._resume()}};return de.lib.registerMidiIn(e,r)},de.addMidiOut=function(e,t){var n=C(t._info||{});n.name=e,n.type=n.type||"javascript",n.manufacturer=n.manufacturer||"virtual",n.version=n.version||"0.0";var r={_info:function(){return n},_openOut:function(e){e._pause(),e._info=C(n),e._close=function(){e.disconnect()},j.apply(e,[t]),e._resume()}};return de.lib.registerMidiOut(e,r)},he.prototype.reset=function(e){if(e instanceof he)return this.setType(e.getType()),this.setHour(e.getHour()),this.setMinute(e.getMinute()),this.setSecond(e.getSecond()),this.setFrame(e.getFrame()),this.setQuarter(e.getQuarter()),this;var t=e instanceof Array?e:arguments;return this.setType(t[0]),this.setHour(t[1]),this.setMinute(t[2]),this.setSecond(t[3]),this.setFrame(t[4]),this.setQuarter(t[5]),this},he.prototype.isFullFrame=function(){return 0==this.quarter||4==this.quarter},he.prototype.getType=function(){return this.type},he.prototype.getHour=function(){return this.hour},he.prototype.getMinute=function(){return this.minute},he.prototype.getSecond=function(){return this.second},he.prototype.getFrame=function(){return this.frame},he.prototype.getQuarter=function(){return this.quarter},he.prototype.setType=function(e){if(void 0===e||24==e)this.type=24;else if(25==e)this.type=25;else if(29.97==e)this.type=29.97,fe.apply(this);else{if(30!=e)throw RangeError("Bad SMPTE frame rate: "+e);this.type=30}return this.frame>=this.type&&(this.frame=this.type-1),this},he.prototype.setHour=function(e){if(void 0===e&&(e=0),e!=parseInt(e)||e<0||e>=24)throw RangeError("Bad SMPTE hours value: "+e);return this.hour=e,this},he.prototype.setMinute=function(e){if(void 0===e&&(e=0),e!=parseInt(e)||e<0||e>=60)throw RangeError("Bad SMPTE minutes value: "+e);return this.minute=e,fe.apply(this),this},he.prototype.setSecond=function(e){if(void 0===e&&(e=0),e!=parseInt(e)||e<0||e>=60)throw RangeError("Bad SMPTE seconds value: "+e);return this.second=e,fe.apply(this),this},he.prototype.setFrame=function(e){if(void 0===e&&(e=0),e!=parseInt(e)||e<0||e>=this.type)throw RangeError("Bad SMPTE frame number: "+e);return this.frame=e,fe.apply(this),this},he.prototype.setQuarter=function(e){if(void 0===e&&(e=0),e!=parseInt(e)||e<0||e>=8)throw RangeError("Bad SMPTE quarter frame: "+e);return this.quarter=e,this},he.prototype.incrFrame=function(){return this.frame++,this.frame>=this.type&&(this.frame=0,this.second++,this.second>=60&&(this.second=0,this.minute++,this.minute>=60&&(this.minute=0,this.hour=this.hour>=23?0:this.hour+1))),fe.apply(this),this},he.prototype.decrFrame=function(){return!this.second&&2==this.frame&&29.97==this.type&&this.minute%10&&(this.frame=0),this.frame--,this.frame<0&&(this.frame=29.97==this.type?29:this.type-1,this.second--,this.second<0&&(this.second=59,this.minute--,this.minute<0&&(this.minute=59,this.hour=this.hour?this.hour-1:23))),this},he.prototype.incrQF=function(){return this.backwards=!1,this.quarter=this.quarter+1&7,0!=this.quarter&&4!=this.quarter||this.incrFrame(),this},he.prototype.decrQF=function(){return this.backwards=!0,this.quarter=this.quarter+7&7,3!=this.quarter&&7!=this.quarter||this.decrFrame(),this},he.prototype.read=function(e){if(e instanceof ve||(e=ve.apply(null,arguments)),240==e[0]&&127==e[1]&&1==e[3]&&1==e[4]&&247==e[9])return this.type=[24,25,29.97,30][e[5]>>5&3],this.hour=31&e[5],this.minute=e[6],this.second=e[7],this.frame=e[8],this.quarter=0,this._=void 0,this._b=void 0,this._f=void 0,!0;if(241==e[0]&&void 0!==e[1]){var t=e[1]>>4,n=15&e[1];return 0==t?7==this._&&(7==this._f&&(this.reset(pe(this._a)),this.incrFrame()),this.incrFrame()):3==t?4==this._&&this.decrFrame():4==t?3==this._&&this.incrFrame():7==t&&0===this._&&(0===this._b&&(this.reset(pe(this._a)),this.decrFrame()),this.decrFrame()),this._a||(this._a=[]),this._a[t]=n,this._f=this._f===t-1||0==t?t:void 0,this._b=this._b===t+1||7==t?t:void 0,this._=t,this.quarter=t,!0}return!1},he.prototype.toString=function(){return be([this.hour,this.minute,this.second,this.frame])},de.SMPTE=he,ve.prototype=[],ve.prototype.constructor=ve;var _e={};ve.noteValue=function(e){return void 0===e?void 0:_e[e.toString().toLowerCase()]},ve.programValue=function(e){return e},ve.freq=function(e,t){return void 0===t&&(t=440),t*Math.pow(2,(Ee(ve.noteValue(e),e)-69)/12)},ve.shift=function(e,t){return void 0===t&&(t=440),12*Math.log2(e/t)},ve.to14b=function(e){return e<=0?0:e>=1?16383:Math.floor(16384*e)};var we={c:0,d:2,e:4,f:5,g:7,a:9,b:11,h:11};for(o in we)if(we.hasOwnProperty(o))for(s=0;s<12&&!((a=we[o]+12*s)>127);s++)_e[o+s]=a,a>0&&(_e[o+"b"+s]=a-1,_e[o+"bb"+s]=a-2),a<127&&(_e[o+"#"+s]=a+1,_e[o+"##"+s]=a+2);for(s=0;s<128;s++)_e[s]=s;function Ie(e){throw RangeError("Bad MIDI value: "+e)}function Se(e){return Q(e),parseInt(e)}function Ee(e,t){return(e!=parseInt(e)||e<0||e>127)&&Ie(void 0===t?e:t),parseInt(e)}function Ce(e,t){return(e!=parseInt(e)||e<0||e>255)&&Ie(void 0===t?e:t),parseInt(e)}function Ae(e){return(e!=parseInt(e)||e<0||e>16383)&&Ie(e),127&parseInt(e)}function Me(e){return(e!=parseInt(e)||e<0||e>16383)&&Ie(e),parseInt(e)>>7}var Te={noteOff:function(e,t,n){return void 0===n&&(n=64),[128+Se(e),Ee(ve.noteValue(t),t),Ee(n)]},noteOn:function(e,t,n){return void 0===n&&(n=127),[144+Se(e),Ee(ve.noteValue(t),t),Ee(n)]},aftertouch:function(e,t,n){return[160+Se(e),Ee(ve.noteValue(t),t),Ee(n)]},control:function(e,t,n){return[176+Se(e),Ee(t),Ee(n)]},program:function(e,t){return[192+Se(e),Ee(ve.programValue(t),t)]},pressure:function(e,t){return[208+Se(e),Ee(t)]},pitchBend:function(e,t,n){return void 0===n?[224+Se(e),Ae(t),Me(t)]:[224+Se(e),Ee(n),Ee(t)]},pitchBendF:function(e,t){return Te.pitchBend(e,ve.to14b((t+1)/2))},bankMSB:function(e,t){return[176+Se(e),0,Ee(t)]},bankLSB:function(e,t){return[176+Se(e),32,Ee(t)]},modMSB:function(e,t){return[176+Se(e),1,Ee(t)]},modLSB:function(e,t){return[176+Se(e),33,Ee(t)]},breathMSB:function(e,t){return[176+Se(e),2,Ee(t)]},breathLSB:function(e,t){return[176+Se(e),34,Ee(t)]},footMSB:function(e,t){return[176+Se(e),4,Ee(t)]},footLSB:function(e,t){return[176+Se(e),36,Ee(t)]},portamentoMSB:function(e,t){return[176+Se(e),5,Ee(t)]},portamentoLSB:function(e,t){return[176+Se(e),37,Ee(t)]},dataMSB:function(e,t){return[176+Se(e),6,Ee(t)]},dataLSB:function(e,t){return[176+Se(e),38,Ee(t)]},volumeMSB:function(e,t){return[176+Se(e),7,Ee(t)]},volumeLSB:function(e,t){return[176+Se(e),39,Ee(t)]},balanceMSB:function(e,t){return[176+Se(e),8,Ee(t)]},balanceLSB:function(e,t){return[176+Se(e),40,Ee(t)]},panMSB:function(e,t){return[176+Se(e),10,Ee(t)]},panLSB:function(e,t){return[176+Se(e),42,Ee(t)]},expressionMSB:function(e,t){return[176+Se(e),11,Ee(t)]},expressionLSB:function(e,t){return[176+Se(e),43,Ee(t)]},damper:function(e,t){return[176+Se(e),64,t?127:0]},portamento:function(e,t){return[176+Se(e),65,t?127:0]},sostenuto:function(e,t){return[176+Se(e),66,t?127:0]},soft:function(e,t){return[176+Se(e),67,t?127:0]},dataIncr:function(e){return[176+Se(e),96,0]},dataDecr:function(e){return[176+Se(e),97,0]},nrpnLSB:function(e,t){return[176+Se(e),98,Ee(t)]},nrpnMSB:function(e,t){return[176+Se(e),99,Ee(t)]},rpnLSB:function(e,t){return[176+Se(e),100,Ee(t)]},rpnMSB:function(e,t){return[176+Se(e),101,Ee(t)]},allSoundOff:function(e){return[176+Se(e),120,0]},allNotesOff:function(e){return[176+Se(e),123,0]}},xe={mtc:function(e){return[241,me(e)]},songPosition:function(e,t){return void 0===t?[242,Ae(e),Me(e)]:[242,Ee(t),Ee(e)]},songSelect:function(e){return[243,Ee(e)]},tune:function(){return[246]},clock:function(){return[248]},start:function(){return[250]},continue:function(){return[251]},stop:function(){return[252]},active:function(){return[254]},sxIdRequest:function(){return[240,126,127,6,1,247]},sxFullFrame:function(e){return[240,127,127,1,1,ge(e),e.getMinute(),e.getSecond(),e.getFrame(),247]},sxMasterVolume:function(e){return[240,127,127,4,1,Ae(e=ve.to14b(e)),Me(e),247]},sxMasterFineTuning:function(e){return[240,127,127,4,3,Ae(e=ve.to14b((e%1+1)/2)),Me(e),247]},sxMasterCoarseTuning:function(e){return[240,127,127,4,4,0,64+e-e%1,247]},reset:function(){return[255]}},Ne={bank:function(e,t,n){return void 0===n?[Te.bankMSB(e,Me(t)),Te.bankLSB(e,Ae(t))]:[Te.bankMSB(e,t),Te.bankLSB(e,n)]},modF:function(e,t){return Ne.mod(e,ve.to14b(t))},mod:function(e,t,n){return void 0===n?[Te.modMSB(e,Me(t)),Te.modLSB(e,Ae(t))]:[Te.modMSB(e,t),Te.modLSB(e,n)]},breathF:function(e,t){return Ne.breath(e,ve.to14b(t))},breath:function(e,t,n){return void 0===n?[Te.breathMSB(e,Me(t)),Te.breathLSB(e,Ae(t))]:[Te.breathMSB(e,t),Te.breathLSB(e,n)]},footF:function(e,t){return Ne.foot(e,ve.to14b(t))},foot:function(e,t,n){return void 0===n?[Te.footMSB(e,Me(t)),Te.footLSB(e,Ae(t))]:[Te.footMSB(e,t),Te.footLSB(e,n)]},portamentoTimeF:function(e,t){return Ne.portamentoTime(e,ve.to14b(t))},portamentoTime:function(e,t,n){return void 0===n?[Te.portamentoMSB(e,Me(t)),Te.portamentoLSB(e,Ae(t))]:[Te.portamentoMSB(e,t),Te.portamentoLSB(e,n)]},dataF:function(e,t){return Ne.data(e,ve.to14b(t))},data:function(e,t,n){return void 0===n?[Te.dataMSB(e,Me(t)),Te.dataLSB(e,Ae(t))]:[Te.dataMSB(e,t),Te.dataLSB(e,n)]},volumeF:function(e,t){return Ne.volume(e,ve.to14b(t))},volume:function(e,t,n){return void 0===n?[Te.volumeMSB(e,Me(t)),Te.volumeLSB(e,Ae(t))]:[Te.volumeMSB(e,t),Te.volumeLSB(e,n)]},balanceF:function(e,t){return Ne.balance(e,ve.to14b((t+1)/2))},balance:function(e,t,n){return void 0===n?[Te.balanceMSB(e,Me(t)),Te.balanceLSB(e,Ae(t))]:[Te.balanceMSB(e,t),Te.balanceLSB(e,n)]},panF:function(e,t){return Ne.pan(e,ve.to14b((t+1)/2))},pan:function(e,t,n){return void 0===n?[Te.panMSB(e,Me(t)),Te.panLSB(e,Ae(t))]:[Te.panMSB(e,t),Te.panLSB(e,n)]},expressionF:function(e,t){return Ne.expression(e,ve.to14b(t))},expression:function(e,t,n){return void 0===n?[Te.expressionMSB(e,Me(t)),Te.expressionLSB(e,Ae(t))]:[Te.expressionMSB(e,t),Te.expressionLSB(e,n)]},nrpn:function(e,t,n){return void 0===n?[Te.nrpnMSB(e,Me(t)),Te.nrpnLSB(e,Ae(t))]:[Te.nrpnMSB(e,t),Te.nrpnLSB(e,n)]},rpn:function(e,t,n){return void 0===n?[Te.rpnMSB(e,Me(t)),Te.rpnLSB(e,Ae(t))]:[Te.rpnMSB(e,t),Te.rpnLSB(e,n)]},rpnPitchBendRange:function(e,t){return Ne.rpn(e,0,0).concat(Ne.data(e,Ee(t-t%1),Math.floor(t%1*128)))},rpnFineTuning:function(e,t){return Ne.rpn(e,0,1).concat(Ne.dataF(e,(t%1+1)/2))},rpnCoarseTuning:function(e,t){return Ne.rpn(e,0,2).concat([Te.dataMSB(e,64+t-t%1)])},rpnTuning:function(e,t){return Ne.rpnCoarseTuning(e,t).concat(Ne.rpnFineTuning(e,t))},rpnTuningA:function(e,t){return Ne.rpnTuning(e,ve.shift(t))}},Oe={sxMasterTuning:function(e){return[xe.sxMasterCoarseTuning(e),xe.sxMasterFineTuning(e)]},sxMasterTuningA:function(e){return Oe.sxMasterTuning(ve.shift(e))}};function Be(e,t){var n=new ve;return n.ff=Ce(e),n.dd=void 0===t?"":function(e){e=""+e;for(var t=0;t<e.length;t++)e.charCodeAt(t)>255&&Ie(e[t]);return e}(t),n}var ke={smf:function(e){if(e instanceof ve)return new ve(e);var t=e instanceof Array?e:arguments,n=Ce(t[0]),r="";return 2==t.length?r=We(t[1]):t.length>2&&(r=We(Array.prototype.slice.call(t,1))),Be(n,r)},smfSeqNumber:function(e){if(e==parseInt(e)){if(e<0||e>65535)throw RangeError("Sequence number out of range: "+e);e=String.fromCharCode(e>>8)+String.fromCharCode(255&e)}else if(0==(e=""+e).length)e="\0\0";else if(1==e.length)e="\0"+e;else if(e.length>2)throw RangeError("Sequence number out of range: "+Xe(e));return Be(0,e)},smfText:function(e){return Be(1,de.lib.toUTF8(e))},smfCopyright:function(e){return Be(2,de.lib.toUTF8(e))},smfSeqName:function(e){return Be(3,de.lib.toUTF8(e))},smfInstrName:function(e){return Be(4,de.lib.toUTF8(e))},smfLyric:function(e){return Be(5,de.lib.toUTF8(e))},smfMarker:function(e){return Be(6,de.lib.toUTF8(e))},smfCuePoint:function(e){return Be(7,de.lib.toUTF8(e))},smfProgName:function(e){return Be(8,de.lib.toUTF8(e))},smfDevName:function(e){return Be(9,de.lib.toUTF8(e))},smfChannelPrefix:function(e){if(e==parseInt(e))Q(e),e=String.fromCharCode(e);else if(0==(e=""+e).length)e="\0";else if(e.length>1||e.charCodeAt(0)>15)throw RangeError("Channel number out of range: "+Xe(e));return Be(32,e)},smfMidiPort:function(e){if(e==parseInt(e)){if(e<0||e>127)throw RangeError("Port number out of range: "+e);e=String.fromCharCode(e)}else if(0==(e=""+e).length)e="\0";else if(e.length>1||e.charCodeAt(0)>127)throw RangeError("Port number out of range: "+Xe(e));return Be(33,e)},smfEndOfTrack:function(e){if(""!=We(e))throw RangeError("Unexpected data: "+Xe(We(e)));return Be(47)},smfTempo:function(e){if(3==(""+e).length)return Be(81,e);if(e==parseInt(e)&&e>0&&e<=16777215)return Be(81,String.fromCharCode(e>>16)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e));throw RangeError("Out of range: "+Xe(We(e)))},smfBPM:function(e){return ke.smfTempo(Math.round(6e7/e))},smfSMPTE:function(e){if(e instanceof he)return Be(84,String.fromCharCode(e.hour)+String.fromCharCode(e.minute)+String.fromCharCode(e.second)+String.fromCharCode(e.frame)+String.fromCharCode(e.quarter%4*25));var t=""+e;if(5==t.length)return Be(84,e);var n=e instanceof Array?e:Array.prototype.slice.call(arguments);return n.splice(0,0,30),ke.smfSMPTE(new he(n))},smfTimeSignature:function(e,t,n,r){var i,o,a,s,c=(""+e).match(/^\s*(\d+)\s*\/\s*(\d+)\s*$/);if(c){if(i=parseInt(c[1]),o=parseInt(c[2]),i>0&&i<=255&&o&&!(o&o-1)){for(a=o,o=0,a>>=1;a;a>>=1)o++;return a=t==parseInt(t)?t:24,s=n==parseInt(n)?n:8,Be(88,String.fromCharCode(i)+String.fromCharCode(o)+String.fromCharCode(a)+String.fromCharCode(s))}if(4==(""+e).length)return Be(88,e)}else{if(e==parseInt(e)&&t==parseInt(t)&&t&&!(t&t-1)){for(i=e,o=0,a=t,a>>=1;a;a>>=1)o++;return a=n==parseInt(n)?n:24,s=r==parseInt(r)?r:8,Be(88,String.fromCharCode(i)+String.fromCharCode(o)+String.fromCharCode(a)+String.fromCharCode(s))}if(4==(""+e).length)return Be(88,e)}throw RangeError("Wrong time signature: "+Xe(We(e)))},smfKeySignature:function(e){var t=(e=""+e).match(/^\s*([A-H][b#]?)\s*(|maj|major|dur|m|min|minor|moll)\s*$/i);if(t){var n={CB:0,GB:1,DB:2,AB:3,EB:4,BB:5,F:6,C:7,G:8,D:9,A:10,E:11,B:12,H:12,"F#":13,"C#":14,"G#":15,"D#":16,"A#":17}[t[1].toUpperCase()],r={"":0,MAJ:0,MAJOR:0,DUR:0,M:1,MIN:1,MINOR:1,MOLL:1}[t[2].toUpperCase()];void 0!==n&&void 0!==r&&(r&&(n-=3),(n-=7)>=-7&&n<0?e=String.fromCharCode(256+n)+String.fromCharCode(r):n>=0&&n<=7&&(e=String.fromCharCode(n)+String.fromCharCode(r)))}if(2==e.length&&e.charCodeAt(1)<=1&&(e.charCodeAt(0)<=7||e.charCodeAt(0)<=255&&e.charCodeAt(0)>=249))return Be(89,e);throw RangeError("Incorrect key signature: "+Xe(e))},smfSequencer:function(e){return Be(127,We(e))}};function De(e,t,n){e.prototype[t]=function(){return this.send(n.apply(0,arguments))}}function Re(e,t,n){e.prototype[t]=function(){for(var e=n.apply(0,arguments),t=this,r=0;r<e.length;r++)t=t.send(e[r]);return t}}function Pe(e,t,n){e.prototype[t]=function(){return this.send(n.apply(0,[this._chan].concat(Array.prototype.slice.call(arguments))))}}function Le(e,t,n){e.prototype[t]=function(){for(var e=n.apply(0,[this._chan].concat(Array.prototype.slice.call(arguments))),t=this,r=0;r<e.length;r++)t=t.send(e[r]);return t}}function Fe(e,t){ve[e]=function(){return new ve(t.apply(0,arguments))}}function Ve(e,t){ve[e]=function(){return t.apply(0,arguments)}}function Ue(e,t){ve[e]=function(){var e,n=[],r=t.apply(0,arguments);for(e=0;e<r.length;e++)n.push(new ve(r[e]));return n}}function je(e,t){Fe(e,t),W.prototype[e]=function(){var e,n=Array.prototype.slice.call(arguments);n.length<t.length?n=[this._master].concat(n):(e=Ee(ve.noteValue(n[0],n[0])),n[0]=this._master);var r=t.apply(0,n);return r.mpe=e,this.send(r),this}}for(o in xe)xe.hasOwnProperty(o)&&Fe(o,xe[o]);for(o in ke)ke.hasOwnProperty(o)&&Ve(o,ke[o]);for(o in Te)Te.hasOwnProperty(o)&&je(o,Te[o]);for(o in Ne)Ne.hasOwnProperty(o)&&Ue(o,Ne[o]);for(o in Oe)Oe.hasOwnProperty(o)&&Ue(o,Oe[o]);function Ge(e,t){for(o in xe)xe.hasOwnProperty(o)&&De(e,o,xe[o]);for(o in ke)ke.hasOwnProperty(o)&&De(e,o,ke[o]);for(o in Te)Te.hasOwnProperty(o)&&De(e,o,Te[o]);for(o in Ne)Ne.hasOwnProperty(o)&&Re(e,o,Ne[o]);for(o in Oe)Oe.hasOwnProperty(o)&&Re(e,o,Oe[o]);if(t){for(o in Te)Te.hasOwnProperty(o)&&Pe(t,o,Te[o]);for(o in Ne)Ne.hasOwnProperty(o)&&Le(t,o,Ne[o])}}Ge(F,z),W.prototype.noteOn=function(e,t){var n=ve.noteOn(this._master,e,t);return n._mpe=n[1],this.send(n),this},W.prototype.noteOff=function(e,t){var n=ve.noteOff(this._master,e,t);return n._mpe=n[1],this.send(n),this},W.prototype.aftertouch=function(e,t){var n=ve.aftertouch(this._master,e,t);return n._mpe=n[1],this.send(n),this};var qe,Qe={a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15};for(o=0;o<16;o++)Qe[o]=o;function ze(e){for(var t=[],n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}function We(e){return e instanceof Array?function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}(e):void 0===e?"":""+e}function He(e){return(e<16?"0":"")+e.toString(16)}function Ze(e){for(var t=[],n=0;n<e.length;n++)t[n]=He(e[n]);return t.join(" ")}function Ye(e){return e.length?": "+Ze(ze(e)):""}function Xe(e){return e.length?": "+function(e){for(var t="",n=0;n<e.length;n++)"\n"==e[n]?t+="\\n":"\r"==e[n]?t+="\\r":"\t"==e[n]?t+="\\t":e.charCodeAt(n)<32?t+="\\x"+He(e.charCodeAt(n)):t+=e[n];return t}(de.lib.fromUTF8(e)):""}function Je(){var e=this instanceof Je?this:e=new Je;return e.reset(),arguments.length&&Je.prototype.setup.apply(e,arguments),e}function $e(){if(!qe&&"undefined"!=typeof window){var e=window.AudioContext||window.webkitAudioContext;if(e){(qe=new e)&&!qe.createGain&&(qe.createGain=qe.createGainNode);var t=function(){if("running"!=qe.state){qe.resume();var e=qe.createOscillator(),n=qe.createGain();try{n.gain.value=0}catch(e){}n.gain.setTargetAtTime(0,qe.currentTime,.01),e.connect(n),n.connect(qe.destination),e.start||(e.start=e.noteOn),e.stop||(e.stop=e.noteOff),e.start(.1),e.stop(.11)}else document.removeEventListener("touchstart",t),document.removeEventListener("touchend",t),document.removeEventListener("mousedown",t),document.removeEventListener("keydown",t)};document.addEventListener("touchstart",t),document.addEventListener("touchend",t),document.addEventListener("mousedown",t),document.addEventListener("keydown",t),t()}}}ve.prototype.getChannel=function(){if(32==this.ff&&1==this.dd.length&&this.dd.charCodeAt(0)<16)return this.dd.charCodeAt(0);var e=this[0];return void 0===e||e<128||e>239?void 0:15&e},ve.prototype.setChannel=function(e){if(void 0===(e=Qe[e]))return this;if(32==this.ff)this.dd=String.fromCharCode(e);else{var t=this[0];void 0!==t&&t>=128&&t<=239&&(this[0]=240&t|e)}return this},ve.prototype.getNote=function(){var e=this[0];if(!(void 0===e||e<128||e>175))return this[1]},ve.prototype.setNote=function(e){var t=this[0];return void 0===t||t<128||t>175||void 0!==(e=ve.noteValue(e))&&(this[1]=e),this},ve.prototype.getVelocity=function(){var e=this[0];if(!(void 0===e||e<128||e>159))return this[2]},ve.prototype.setVelocity=function(e){var t=this[0];return void 0===t||t<128||t>159||(e=parseInt(e))>=0&&e<128&&(this[2]=e),this},ve.prototype.getSysExChannel=function(){if(240==this[0])return this[2]},ve.prototype.setSysExChannel=function(e){return 240==this[0]&&this.length>2&&(e=parseInt(e))>=0&&e<128&&(this[2]=e),this},ve.prototype.getData=function(){if(void 0!==this.dd)return this.dd.toString()},ve.prototype.setData=function(e){return this.dd=We(e),this},ve.prototype.getText=function(){if(void 0!==this.dd)return de.lib.fromUTF8(this.dd)},ve.prototype.setText=function(e){return this.dd=de.lib.toUTF8(e),this},ve.prototype.getTempo=function(){if(81==this.ff&&void 0!==this.dd)return 65536*this.dd.charCodeAt(0)+256*this.dd.charCodeAt(1)+this.dd.charCodeAt(2)},ve.prototype.getBPM=function(){var e=this.getTempo();if(e)return 6e7/e},ve.prototype.getTimeSignature=function(){if(88==this.ff&&void 0!==this.dd)return[this.dd.charCodeAt(0),1<<this.dd.charCodeAt(1)]},ve.prototype.getKeySignature=function(){if(89==this.ff&&void 0!==this.dd){var e=this.dd.charCodeAt(0),t=this.dd.charCodeAt(1);if(128&e&&(e-=256),e>=-7&&e<=7&&t>=0&&t<=1)return[e,["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#","G#","D#","A#"][t?e+10:e+7],!!t]}},ve.prototype.isNoteOn=function(){var e=this[0];return!(void 0===e||e<144||e>159)&&this[2]>0},ve.prototype.isNoteOff=function(){var e=this[0];return!(void 0===e||e<128||e>159)&&(e<144||0==this[2])},ve.prototype.isSysEx=function(){return 240==this[0]},ve.prototype.isFullSysEx=function(){return 240==this[0]&&247==this[this.length-1]},ve.prototype.isSMF=function(){return this.ff>=0&&this.ff<=127},ve.prototype.isEOT=function(){return 47==this.ff},ve.prototype.isTempo=function(){return 81==this.ff},ve.prototype.isTimeSignature=function(){return 88==this.ff},ve.prototype.isKeySignature=function(){return 89==this.ff},ve.prototype.toString=function(){var e,t;if(!this.length){if(void 0!==this.ff){if(e="ff"+He(this.ff)+" -- ",0==this.ff)e+="Sequence Number: "+function(e){for(var t=0,n=0;n<e.length;n++)t=(t<<8)+e.charCodeAt(n);return t}(this.dd);else if(this.ff>0&&this.ff<10)e+=["","Text","Copyright","Sequence Name","Instrument Name","Lyric","Marker","Cue Point","Program Name","Device Name"][this.ff]+Xe(this.dd);else if(32==this.ff)e+="Channel Prefix"+Ye(this.dd);else if(33==this.ff)e+="MIDI Port"+Ye(this.dd);else if(47==this.ff)e+="End of Track"+Ye(this.dd);else if(81==this.ff){e+="Tempo: "+Math.round(100*this.getBPM())/100+" bpm"}else if(84==this.ff)e+="SMPTE Offset: "+be(ze(this.dd));else if(88==this.ff){var n=1<<this.dd.charCodeAt(1);e+="Time Signature: "+this.dd.charCodeAt(0)+"/"+n,e+=" "+this.dd.charCodeAt(2)+" "+this.dd.charCodeAt(3)}else if(89==this.ff){e+="Key Signature: ";var r=this.getKeySignature();r?(e+=r[1],r[2]&&(e+=" min")):e+="invalid"}else 127==this.ff?e+="Sequencer Specific"+Ye(this.dd):e+="SMF"+Ye(this.dd);return e}return"empty"}if(e=Ze(this),this[0]<128)return e;if(t={241:"MIDI Time Code",242:"Song Position",243:"Song Select",244:"Undefined",245:"Undefined",246:"Tune request",248:"Timing clock",249:"Undefined",250:"Start",251:"Continue",252:"Stop",253:"Undefined",254:"Active Sensing",255:"Reset"}[this[0]])return e+" -- "+t;var i=this[0]>>4;return(t={8:"Note Off",10:"Aftertouch",12:"Program Change",13:"Channel Aftertouch",14:"Pitch Wheel"}[i])?e+" -- "+t:9==i?e+" -- "+(this[2]?"Note On":"Note Off"):11!=i?e:((t={0:"Bank Select MSB",1:"Modulation Wheel MSB",2:"Breath Controller MSB",4:"Foot Controller MSB",5:"Portamento Time MSB",6:"Data Entry MSB",7:"Channel Volume MSB",8:"Balance MSB",10:"Pan MSB",11:"Expression Controller MSB",12:"Effect Control 1 MSB",13:"Effect Control 2 MSB",16:"General Purpose Controller 1 MSB",17:"General Purpose Controller 2 MSB",18:"General Purpose Controller 3 MSB",19:"General Purpose Controller 4 MSB",32:"Bank Select LSB",33:"Modulation Wheel LSB",34:"Breath Controller LSB",36:"Foot Controller LSB",37:"Portamento Time LSB",38:"Data Entry LSB",39:"Channel Volume LSB",40:"Balance LSB",42:"Pan LSB",43:"Expression Controller LSB",44:"Effect control 1 LSB",45:"Effect control 2 LSB",48:"General Purpose Controller 1 LSB",49:"General Purpose Controller 2 LSB",50:"General Purpose Controller 3 LSB",51:"General Purpose Controller 4 LSB",64:"Damper Pedal On/Off",65:"Portamento On/Off",66:"Sostenuto On/Off",67:"Soft Pedal On/Off",68:"Legato Footswitch",69:"Hold 2",70:"Sound Controller 1",71:"Sound Controller 2",72:"Sound Controller 3",73:"Sound Controller 4",74:"Sound Controller 5",75:"Sound Controller 6",76:"Sound Controller 7",77:"Sound Controller 8",78:"Sound Controller 9",79:"Sound Controller 10",80:"General Purpose Controller 5",81:"General Purpose Controller 6",82:"General Purpose Controller 7",83:"General Purpose Controller 8",84:"Portamento Control",88:"High Resolution Velocity Prefix",91:"Effects 1 Depth",92:"Effects 2 Depth",93:"Effects 3 Depth",94:"Effects 4 Depth",95:"Effects 5 Depth",96:"Data Increment",97:"Data Decrement",98:"Non-Registered Parameter Number LSB",99:"Non-Registered Parameter Number MSB",100:"Registered Parameter Number LSB",101:"Registered Parameter Number MSB",120:"All Sound Off",121:"Reset All Controllers",122:"Local Control On/Off",123:"All Notes Off",124:"Omni Mode Off",125:"Omni Mode On",126:"Mono Mode On",127:"Poly Mode On"}[this[1]])||(t="Undefined"),e+" -- "+t)},ve.prototype._stamp=function(e){return this._from.push(e._orig?e._orig:e),this},ve.prototype._unstamp=function(e){if(void 0===e)this._from=[];else{e._orig&&(e=e._orig);var t=this._from.indexOf(e);t>-1&&this._from.splice(t,1)}return this},ve.prototype._stamped=function(e){e._orig&&(e=e._orig);for(var t=0;t<this._from.length;t++)if(this._from[t]==e)return!0;return!1},de.MIDI=ve,Je.validate=function(e){var t=e instanceof Array?e:arguments;if(t[0]!=parseInt(t[0])||t[0]<0||t[0]>14)throw RangeError("Bad master channel value: "+t[0]);if(t[1]!=parseInt(t[1])||t[1]<0||t[0]+t[1]>15)throw RangeError("Bad zone size value: "+t[1])},Je.prototype.reset=function(){for(var e=0;e<16;e++)this[e]={band:0,master:e}},Je.prototype.setup=function(e,t){var n;Je.validate(e,t);var r=e+t;if((this[e].master!=e||this[e].band!=t)&&(t||this[e].band)){for(this[e].band?r<(n=e+this[e].band)&&(r=n):this[e].master==e-1?(n=e-1,r<(n+=this[n].band)&&(r=n),this[e-1]={band:0,master:e-1}):this[e].master!=e&&(n=this[e].master,r<(n+=this[n].band)&&(r=n),this[this[e].master].band=e-this[e].master-1),this[e].master=e,this[e].band=t,n=e+1;n<=e+t;n++)this[n].band&&r<n+this[n].band&&(r=n+this[n].band),this[n]={band:0,master:e};for(;n<=r;n++)this[n]={band:0,master:n}}},Je.prototype.filter=function(e){var t=e.getChannel();if(!this[t]||!this[this[t].master].band)return e;var n,r,i,o=this[t].master,a=this[o].band;if(void 0!==e._mpe){for(i=256,n=o+1;n<=o+a;n++)if(this[n].notes){for(i>this[n].notes.length&&(t=n,i=this[n].notes.length),r=0;r<this[n].notes.length;r++)if(this[n].notes[r]==e._mpe){t=n,i=-1;break}}else i>0&&(t=n,i=0);e.setChannel(t),e._mpe=void 0}return t==o||(e.isNoteOn()?(this[t].notes||(this[t].notes=[]),I(this[t].notes,e.getNote())):e.isNoteOff()&&this[t].notes&&S(this[t].notes,e.getNote())),e},de.MPE=Je,(de.lib={}).now=d,de.lib.schedule=h,de.lib.openMidiOut=function(e,t){var n=new F;return t._openOut(n),n._info=t._info(e),n},de.lib.openMidiIn=function(e,t){var n=new F;return t._openIn(n),n._info=t._info(e),n},de.lib.registerMidiOut=function(e,t){for(var n=t._info(e),r=0;r<ee._outs.length;r++)if(ee._outs[r].name==n.name)return!1;return n.engine=t,ee._outs.push(n),A&&(O(),A._bad&&(A._repair(),A._resume())),!0},de.lib.registerMidiIn=function(e,t){for(var n=t._info(e),r=0;r<ee._ins.length;r++)if(ee._ins[r].name==n.name)return!1;return n.engine=t,ee._ins.push(n),A&&(O(),A._bad&&(A._repair(),A._resume())),!0},de.lib.copyMidiHelpers=Ge,de.lib.getAudioContext=function(){return $e(),qe};var Ke="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";de.lib.fromBase64=function(e){var t,n,r,i,o,a,s="",c=0;for(e=e.replace(/[^A-Za-z0-9+/=]/g,"");c<e.length;)t=Ke.indexOf(e.charAt(c++))<<2|(i=Ke.indexOf(e.charAt(c++)))>>4,n=(15&i)<<4|(o=Ke.indexOf(e.charAt(c++)))>>2,r=(3&o)<<6|(a=Ke.indexOf(e.charAt(c++))),s+=String.fromCharCode(t),64!=o&&(s+=String.fromCharCode(n)),64!=a&&(s+=String.fromCharCode(r));return s},de.lib.toBase64=function(e){var t,n,r,i,o,a=0,s=0,c="",u=[];if(!e)return e;do{t=(o=e.charCodeAt(a++)<<16|e.charCodeAt(a++)<<8|e.charCodeAt(a++))>>18&63,n=o>>12&63,r=o>>6&63,i=63&o,u[s++]=Ke.charAt(t)+Ke.charAt(n)+Ke.charAt(r)+Ke.charAt(i)}while(a<e.length);c=u.join("");var l=e.length%3;return l?c.slice(0,l-3)+"===".slice(l):c},de.lib.fromUTF8=function(e){e=void 0===e?"":""+e;var t,n,r,i="";for(t=0;t<e.length;t++){if((n=e.charCodeAt(t))>255)return e;if(n<128)i+=e[t];else if(192==(224&n)){if(n=(31&n)<<6,++t>=e.length)return e;if(128!=(192&(r=e.charCodeAt(t))))return e;n+=63&r,i+=String.fromCharCode(n)}else if(224==(240&n)){if(n=(15&n)<<12,++t>=e.length)return e;if(128!=(192&(r=e.charCodeAt(t))))return e;if(n+=(63&r)<<6,++t>=e.length)return e;if(128!=(192&(r=e.charCodeAt(t))))return e;n+=63&r,i+=String.fromCharCode(n)}else if(240==(248&n)){if(n=(7&n)<<18,++t>=e.length)return e;if(128!=(192&(r=e.charCodeAt(t))))return e;if(n+=(63&r)<<12,++t>=e.length)return e;if(128!=(192&(r=e.charCodeAt(t))))return e;if(n+=(63&r)<<6,++t>=e.length)return e;if(128!=(192&(r=e.charCodeAt(t))))return e;if((n+=63&r)>1114111)return e;n-=65536,i+=String.fromCharCode(55296+(n>>10)),i+=String.fromCharCode(56320+(1023&n))}}return i},de.lib.toUTF8=function(e){e=void 0===e?"":""+e;var t,n,r="";for(t=0;t<e.length;t++)(n=e.charCodeAt(t))<128?r+=e[t]:n<2048?(r+=String.fromCharCode(192+(n>>6)),r+=String.fromCharCode(128+(63&n))):n<65536?(r+=String.fromCharCode(224+(n>>12)),r+=String.fromCharCode(128+(n>>6&63)),r+=String.fromCharCode(128+(63&n))):(r+=String.fromCharCode(240+(n>>18)),r+=String.fromCharCode(128+(n>>12&63)),r+=String.fromCharCode(128+(n>>6&63)),r+=String.fromCharCode(128+(63&n)));return r};var et=[],tt={},nt={},rt=c.Promise;function it(e,t,n){this.name=e,this.message=t,this.code=n}function ot(e,t){this.bubbles=!1,this.cancelBubble=!1,this.cancelable=!1,this.currentTarget=t,this.defaultPrevented=!1,this.eventPhase=0,this.path=[],this.port=e,this.returnValue=!0,this.srcElement=t,this.target=t,this.timeStamp=d(),this.type="statechange"}function at(e,t){this.bubbles=!1,this.cancelBubble=!1,this.cancelable=!1,this.currentTarget=e,this.data=t,this.defaultPrevented=!1,this.eventPhase=0,this.path=[],this.receivedTime=d(),this.returnValue=!0,this.srcElement=e,this.target=e,this.timeStamp=this.receivedTime,this.type="midimessage"}function st(e,t){e&&(e.onstatechange&&e.onstatechange(new ot(e,e)),t.onstatechange&&t.onstatechange(new ot(e,t)))}function ct(e,t){var n=this,r=!1,i=null,o=null;this.type="input",this.id=t.id,this.name=t.name,this.manufacturer=t.man,this.version=t.ver,Object.defineProperty(this,"state",{get:function(){return t.connected?"connected":"disconnected"},enumerable:!0}),Object.defineProperty(this,"connection",{get:function(){return r?t.proxy?"open":"pending":"closed"},enumerable:!0}),Object.defineProperty(this,"onmidimessage",{get:function(){return o},set:function(e){if(e instanceof Function){if(o=e,!r)try{n.open()}catch(e){}}else o=null},enumerable:!0}),Object.defineProperty(this,"onstatechange",{get:function(){return i},set:function(e){i=e instanceof Function?e:null},enumerable:!0}),this.open=function(){return new rt((function(i,o){r?i(n):t.open().then((function(){r||(r=!0,st(n,e)),i(n)}),(function(){o(new it("InvalidAccessError","Port is not available",15))}))}))},this.close=function(){return new rt((function(i){r&&(r=!1,t.close(),st(n,e)),i(n)}))},Object.freeze(this)}function ut(e){for(var t,n;e.length;){for(t=0;t<e.length&&!(e[t]==parseInt(e[t])&&e[t]>=128&&e[t]<=255&&247!=e[t]);t++);if(e.splice(0,t),!e.length)return;if(240==e[0]){for(t=1;t<e.length&&247!=e[t];t++);if(t==e.length)return;return e.splice(0,t+1)}if((n=dt(e[0])+1)>e.length)return;for(t=1;t<n&&!(e[t]!=parseInt(e[t])||e[t]<0||e[t]>=128);t++);if(t==n)return e.splice(0,t);e.splice(0,t)}}function lt(e,t,r,i){var o=this;this.id=e,this.name=t,this.man=r,this.ver=i,this.connected=!0,this.ports=[],this.pending=[],this.proxy=void 0,this.queue=[],this.onmidi=function(e){var t;for(o.queue=o.queue.concat(e.slice()),t=ut(o.queue);t;t=ut(o.queue))for(n=0;n<o.ports.length;n++)o.ports[n][0].onmidimessage&&(240!=t[0]||o.ports[n][1])&&o.ports[n][0].onmidimessage(new at(o,new Uint8Array(t)))}}function dt(e){return e>=128&&e<=191||e>=224&&e<=239||242==e?2:e>=192&&e<=223||241==e||243==e?1:0}"function"!=typeof rt&&((rt=function(e){this.executor=e}).prototype.then=function(e,t){"function"!=typeof e&&(e=function(){}),"function"!=typeof t&&(t=function(){}),this.executor(e,t)}),lt.prototype.open=function(){var e=this;return new rt((function(t,n){var r;e.proxy||!e.connected?t():(e.pending.push([t,n]),1==e.pending.length&&de().openMidiIn(e.name).or((function(){for(r=0;r<e.pending.length;r++)e.pending[r][1]();e.pending=[]})).and((function(){for(e.proxy=this,e.proxy.connect(e.onmidi),r=0;r<e.pending.length;r++)e.pending[r][0]();e.pending=[]})))}))},lt.prototype.close=function(){var e;if(this.proxy){for(e=0;e<this.ports.length;e++)if("open"==this.ports[e].connection)return;this.proxy.close(),this.proxy=void 0}},lt.prototype.disconnect=function(){this.connected=!1,this.proxy&&(this.proxy.close(),this.proxy=void 0)},lt.prototype.reconnect=function(){var e,t,n=this,r=[];for(this.connected=!0,e=0;e<et.length;e++)"closed"==(t=et[e].inputs.get(this.id)).connection?st(t,et[e]):r.push([t,et[e]]);r.length&&de()._openMidiInNR(n.name).or((function(){for(e=0;e<r.length;e++)r[e][0].close()})).and((function(){for(n.proxy=this,n.proxy.connect(n.onmidi),e=0;e<r.length;e++)st(r[e][0],r[e][1])}))};var ht="Failed to execute 'send' on 'MIDIOutput': ";function ft(e,t){var n=this,r=!1,i=null;this.type="output",this.id=t.id,this.name=t.name,this.manufacturer=t.man,this.version=t.ver,Object.defineProperty(this,"state",{get:function(){return t.connected?"connected":"disconnected"},enumerable:!0}),Object.defineProperty(this,"connection",{get:function(){return r?t.proxy?"open":"pending":"closed"},enumerable:!0}),Object.defineProperty(this,"onstatechange",{get:function(){return i},set:function(e){i=e instanceof Function?e:null},enumerable:!0}),this.open=function(){return new rt((function(i,o){r?i(n):t.open().then((function(){r||(r=!0,st(n,e)),i(n)}),(function(){o(new it("InvalidAccessError","Port is not available",15))}))}))},this.close=function(){return new rt((function(i){r&&(r=!1,n.clear(),t.close(),st(n,e)),i(n)}))},this.clear=function(){},this.send=function(i,o){if(function(e,t){var n,r,i,o=[];for(n=0;n<e.length;n++)if(e[n]!=parseInt(e[n])||e[n]<0||e[n]>255)throw TypeError(ht+e[n]+" is not a UInt8 value.");for(r=0,n=0;n<e.length;n++)if(r){if(e[n]>127)throw TypeError(ht+"Unexpected status byte at index "+n+" ("+e[n]+").");i.push(e[n]),r--}else{if(e[n]<128)throw TypeError(ht+"Running status is not allowed at index "+n+" ("+e[n]+").");if(247==e[n])throw TypeError(ht+"Unexpected end of system exclusive message at index "+n+" ("+e[n]+").");if(i=[e[n]],o.push(i),240==e[n]){if(!t)throw new it("InvalidAccessError",ht+"System exclusive messag is not allowed at index "+n+" ("+e[n]+").",15);for(r=-1;n<e.length;n++)if(i.push(e[n]),247==e[n]){r=0;break}}else r=dt(e[n])}if(r)throw TypeError(ht+"Message is incomplete")}(i,e.sysexEnabled),!t.connected)throw new it("InvalidStateError","Port is not connected",11);if(r){var a=d();o>a?setTimeout((function(){t.proxy.send(i)}),o-a):t.proxy.send(i)}else this.open().then((function(){n.send(i,o)}))},Object.freeze(this)}function pt(e,t,n,r){this.id=e,this.name=t,this.man=n,this.ver=r,this.connected=!0,this.ports=[],this.pending=[],this.proxy=void 0}function mt(e){this.has=function(t){return e.hasOwnProperty(t)&&e[t].connected},this.keys=function(){try{var t=new Map;for(var n in e)this.has(n)&&t.set(n,this.get(n));return t.keys()}catch(e){}},this.values=function(){try{var t=new Map;for(var n in e)this.has(n)&&t.set(n,this.get(n));return t.values()}catch(e){}},this.entries=function(){try{var t=new Map;for(var n in e)this.has(n)&&t.set(n,this.get(n));return t.entries()}catch(e){}},this.forEach=function(t,n){for(var r in void 0===n&&(n=this),e)this.has(r)&&t.call(n,this.get(r),r,this)},Object.defineProperty(this,"size",{get:function(){var t=0;for(var n in e)this.has(n)&&t++;return t},enumerable:!0})}function gt(e,t){this.get=function(n){if(nt.hasOwnProperty(n)&&nt[n].connected)return t[n]||(t[n]=new ct(e,nt[n]),nt[n].ports.push([t[n],e.sysexEnabled])),t[n]},Object.freeze(this)}function yt(e,t){this.get=function(n){if(tt.hasOwnProperty(n)&&tt[n].connected)return t[n]||(t[n]=new ft(e,tt[n]),tt[n].ports.push([t[n],e.sysexEnabled])),t[n]},Object.freeze(this)}function bt(e){var t,n,r,i;for(t=0;t<e.inputs.added.length;t++)r=e.inputs.added[t],nt.hasOwnProperty(r.id)||(nt[r.id]=new lt(r.id,r.name,r.manufacturer,r.version)),nt[r.id].reconnect();for(t=0;t<e.outputs.added.length;t++)r=e.outputs.added[t],tt.hasOwnProperty(r.id)||(tt[r.id]=new pt(r.id,r.name,r.manufacturer,r.version)),tt[r.id].reconnect();for(t=0;t<e.inputs.removed.length;t++)if(r=e.inputs.removed[t],nt.hasOwnProperty(r.id)){for(i=[],n=0;n<et.length;n++)i.push([et[n].inputs.get(r.id),et[n]]);for(nt[r.id].disconnect(),n=0;n<i.length;n++)st(i[n][0],i[n][1])}for(t=0;t<e.outputs.removed.length;t++)if(r=e.outputs.removed[t],tt.hasOwnProperty(r.id)){for(i=[],n=0;n<et.length;n++)i.push([et[n].outputs.get(r.id),et[n]]);for(tt[r.id].disconnect(),n=0;n<i.length;n++)st(i[n][0],i[n][1])}}function vt(e){var t,n,r=null;this.sysexEnabled=e,this.inputs=new gt(this,{}),this.outputs=new yt(this,{}),Object.defineProperty(this,"onstatechange",{get:function(){return r},set:function(e){r=e instanceof Function?e:null},enumerable:!0}),Object.freeze(this);var i=A._info;for(t=0;t<i.inputs.length;t++)n=i.inputs[t],nt.hasOwnProperty(n.id)||(nt[n.id]=new lt(n.id,n.name,n.manufacturer,n.version));for(t=0;t<i.outputs.length;t++)n=i.outputs[t],tt.hasOwnProperty(n.id)||(tt[n.id]=new pt(n.id,n.name,n.manufacturer,n.version));et.length||de().onChange(bt),et.push(this)}return pt.prototype.open=function(){var e=this;return new rt((function(t,n){var r;e.proxy||!e.connected?t():(e.pending.push([t,n]),1==e.pending.length&&de().openMidiOut(e.name).or((function(){for(r=0;r<e.pending.length;r++)e.pending[r][1]();e.pending=[]})).and((function(){for(e.proxy=this,r=0;r<e.pending.length;r++)e.pending[r][0]();e.pending=[]})))}))},pt.prototype.close=function(){var e;if(this.proxy){for(e=0;e<this.ports.length;e++)if("open"==this.ports[e].connection)return;this.proxy.close(),this.proxy=void 0}},pt.prototype.disconnect=function(){this.connected=!1,this.proxy&&(this.proxy.close(),this.proxy=void 0)},pt.prototype.reconnect=function(){var e,t,n=this,r=[];for(this.connected=!0,e=0;e<et.length;e++)"closed"==(t=et[e].outputs.get(this.id)).connection?st(t,et[e]):r.push([t,et[e]]);r.length&&de()._openMidiOutNR(n.name).or((function(){for(e=0;e<r.length;e++)r[e][0].close()})).and((function(){for(n.proxy=this,e=0;e<r.length;e++)st(r[e][0],r[e][1])}))},gt.prototype=new mt(nt),gt.prototype.constructor=gt,yt.prototype=new mt(tt),yt.prototype.constructor=yt,de.requestMIDIAccess=function(e){return new rt((function(t,n){de.JZZ(e).or((function(){})).and((function(){var r=!(!e||!e.sysex);if(r&&!this.info().sysex)n(new it("SecurityError","Sysex is not allowed",18));else{var i=new vt(r);t(i)}}))}))},"undefined"==typeof navigator||navigator.requestMIDIAccess||(navigator.requestMIDIAccess=de.requestMIDIAccess),de.close=function(){K._close&&K._close()},de}))},{"jazz-midi":"cf7d18c8c250809700499130a927d7cd"}],cf7d18c8c250809700499130a927d7cd:[function(e,t,n){var r=e("process"),i="./bin/",o=r.versions.node.split(".");o[0]<=10?i+="10_15/":o[0]<=11&&(i+="11_15/"),"win32"==r.platform&&"ia32"==r.arch?i+="win32/jazz":"win32"==r.platform&&"x64"==r.arch?i+="win64/jazz":"darwin"==r.platform&&"x64"==r.arch?i+="macos64/jazz":"linux"==r.platform&&"x64"==r.arch?i+="linux64/jazz":"linux"==r.platform&&"arm"==r.arch&&(i+="linuxa7/jazz"),t.exports=e(i),t.exports.package=e("S:\\Synch\\Work\\Code\\musicalface\\MusicalFace\\node_modules\\jazz-midi/package.json")},{process:"4de4a03e94e27ceb4ecf8a26d457f9e0"}],ce693141997b2d2648718d5ab03d6662:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.setupCamera=n.detectCameras=n.filterVideoCameras=void 0;n.filterVideoCameras=e=>e.filter(e=>"videoinput"===e.kind);n.detectCameras=async()=>navigator.mediaDevices.enumerateDevices();n.setupCamera=async(e,t)=>new Promise(async(n,r)=>{let i;(e=e||document.createElement("video")).onloadedmetadata=t=>{e.play(),e.width=e.videoWidth,e.height=e.videoHeight,n(i)},e.onerror=e=>r(i);const o={};t?o.deviceId={exact:t}:o.facingMode="user";const a={video:o,audio:!1};try{i=await navigator.mediaDevices.getUserMedia(a),e.srcObject=i}catch(e){r(e)}})},{}],"65170211c1067042fc9b847ea066e7ce":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.drawBars=n.takePhotograph=n.drawWaves=n.drawQuantise=n.drawFace=n.drawPoints=n.setNodeCount=n.drawBoundingBox=n.drawInstrument=n.drawParagraph=n.drawText=n.drawMouth=n.drawNode=n.drawEye=n.drawPart=n.overdraw=n.clear=n.drawElement=n.updateCanvasSize=n.getCanvasDimensions=n.canvasContext=n.canvas=n.setupImage=void 0;var r=e("./maths"),i=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=o();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var a=r?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(n,i,a):n[i]=e[i]}n.default=e,t&&t.set(e,n);return n}(e("./palette"));function o(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return o=function(){return e},e}n.setupImage=async e=>async function(e){return new Promise(async(t,n)=>{const r=()=>{e.width=e.naturalWidth,e.height=e.naturalHeight};e.naturalWidth>0?(r(),t(e)):(e.onloaded=()=>{r(),t(e)},e.onerror=e=>n(e))})}(e);const a=document.querySelector("canvas");n.canvas=a;const s=a.getContext("2d");n.canvasContext=s;let c=a.width,u=a.height;n.getCanvasDimensions=()=>({width:c,height:u});n.updateCanvasSize=(e,t)=>{c=e||a.width,u=t||a.height};n.drawElement=e=>{s.save(),s.translate(c,0),s.scale(-1,1),s.drawImage(e,0,0),s.restore()};n.clear=()=>{s.clearRect(0,0,c,u)};n.overdraw=(e=0,t=-1)=>{s.save(),s.drawImage(a,e,t),s.restore()};n.drawPart=(e,t=4,n="red",i=!0)=>{s.fillStyle=n,s.strokeStyle=n,s.moveTo(e[0][0],e[0][1]),s.beginPath();for(let n=0,o=e.length;n<o;n++){const o=e[n][0],a=e[n][1];s.arc(o,a,t,0,r.TAU),i&&s.lineTo(o,a)}s.fill(),i&&s.stroke()};const l=(e,t="blue")=>{s.fillStyle=t;const n=e[0],i=e[1],o=e[2],a=e[3],c=e[4];s.strokeWidth=0;s.beginPath(),s.fillStyle="blue",s.arcTo(o[0],o[1],i[0],i[1],6),s.arcTo(i[0],i[1],c[0],c[1],6),s.arcTo(c[0],c[1],a[0],a[1],6),s.arcTo(a[0],a[1],o[0],o[1],6),s.fill();s.beginPath(),s.fillStyle="black",s.arc(n[0],n[1],2,0,r.TAU),s.fill()};n.drawEye=l;const d=(e,t,n=5,o="blue",a=!1)=>{s.fillStyle=o,s.beginPath(),s.arc(t[0],t[1],n,0,r.TAU),s.fill(),s.beginPath(),s.arc(e[0],e[1],n,0,r.TAU),s.fill(),s.beginPath(),s.moveTo(e[0],e[1]),s.strokeStyle="orange",s.fillStyle="orange",s.lineTo(t[0],t[1]),a&&(s.stroke(),s.fillStyle=i.default.blue,s.font="12px Oxanium",s.textAlign="center",s.fillText(Math.floor(mouthRange)+"px",e[0],e[1]-20))};n.drawNode=d;const h=(e,t="yellow",n=!0)=>{const{annotations:r,mouthRange:o,mouthWidth:a,mouthOpen:c}=e,{lipsUpperInner:u,lipsLowerInner:l}=r,h=[u,l],f=u[5],p=l[5],m=s.createLinearGradient(0,0,a,o);m.addColorStop(0,t),m.addColorStop(.5,i.default.dark),m.addColorStop(1,t),s.beginPath(),s.moveTo(u[0][0],u[0][1]),s.fillStyle=m;for(let e=0,t=h.length;e<t;e++){const t=h[e];for(let e=0,n=t.length;e<n;e++){const n=t[e][0],r=t[e][1];s.lineTo(n,r)}}return s.fill(),n&&d(p,f,5),{lipUpperMiddle:f,lipLowerMiddle:p}};n.drawMouth=h;const f=(e,t,n="",r="10px",o="center")=>{s.font=`900 ${r} Oxanium`,s.textAlign=o,s.fillStyle=i.default.white,s.strokeStyle=i.default.dark,s.strokeText(""+n,e,t),s.fillText(""+n,e,t)};n.drawText=f;n.drawParagraph=(e,t,n=[],r="10px",i=20)=>{let o=t;for(const t of n)f(e,o,t,r,"left"),o+=i};n.drawInstrument=(e,t,n="")=>{const{bottomRight:r,topLeft:i}=e,o=`${t.toUpperCase()} - ${n}`;f(i[0],i[1],o,"24px")};n.drawBoundingBox=(e,t="red")=>{const{bottomRight:n,topLeft:r}=e;s.beginPath(),s.fillStyle=t,s.strokeRect(r[0],r[1],n[0],n[1]),s.fill()};const p=r.easeInQuad;let m=0;n.setNodeCount=e=>m+=e;let g=0;n.drawPoints=(e,t=60,n=3,o=!1,a=!0)=>{const{scaledMesh:c}=e,u=c.length;for(let e=0;e<u;e++){const l=c[e][0],d=c[e][1],h=1-(c[e][2]+45)/45,f=(0,r.clamp)(n*p(h),1,n),y=(0,r.clamp)(h,.5,1);if(s.beginPath(),a&&e===m%u)s.stroke(),s.font="22px Oxanium",s.textAlign="center",s.fillStyle=i.default.dark,s.fillText("#"+e,l+f+1,d),s.fillStyle="hsla(0,90%,70%,1)",s.arc(l,d,3*f,0,r.TAU);else{const n=o?(g+++t+360*e/u)%360:t;s.fillStyle=`hsla(${n},70%,50%,${y})`,s.arc(l,d,f,0,r.TAU)}s.fill()}};n.drawFace=(e,t=i.DEFAULT_COLOURS,n=!1,r=!1,o=!1)=>{const{scaledMesh:a,annotations:s}=e,{lipsUpperInner:c,lipsLowerInner:u}=s;h(e,r&&n?t.mouth:t.mouthClosed,o);const{leftEyeIris:d,rightEyeIris:f}=s;l(d,t.leftEyeIris),l(f,t.rightEyeIris)};n.drawQuantise=(e,t=-1,n="")=>{for(let e=0,n=t+1;e<n;++e)s.fillStyle=e===t?i.default.cream:i.default.orange,s.strokeStyle=e===t?i.default.orange:i.default.brown,s.lineWidth=4,s.beginPath(),s.arc(20*e+20,20,4,0,r.TAU),s.fill(),s.stroke()};n.drawWaves=(e,t)=>{s.lineWidth=2,s.strokeStyle="rgb(0, 0, 0)",s.beginPath();const n=1*c/t;let r=0;for(let i=0;i<t;i++){const t=e[i]/128*u/2;0===i?s.moveTo(r,t):s.lineTo(r,t),r+=n}s.lineTo(c,u/2),s.stroke()};n.takePhotograph=(e="image/png")=>a.toDataURL(e);n.drawBars=(e,t)=>{const n=c/t*2;let r,i=0;for(let o=0;o<t;o++)r=e[o],s.fillStyle="hsla("+r/u*360+",50%,50%,0.3)",s.fillRect(i,0,n,r),i+=n+1}},{"./maths":"30c371813e434b101ca68a9e5aac6342","./palette":"8c184ea81a7f9f2a10a21f3b44355276"}],e53dbd1dccb6fc721c56439b24350bb3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.playNextPart=n.combinePatternWithInstrument=n.kitSequence=n.hatSequence=n.snareSequence=n.kickSequence=n.pattern=n.factory=void 0;n.factory=(e=16)=>{const t=4*e,n=[];for(let e=0;e<t;++e){const e=!1;n.push(e)}return n};const r=(e,t=0)=>{let n=t;const r=e.length-1;return{reset:()=>(n=0,e[n]),previous:()=>{const t=n-1;return n=t<0?r:t,e[n]},next:()=>{const t=n+1;return n=t>r?0:t,e[n]},position:t=>e[t],length:e.length,current:()=>e[n],set:t=>e=t}};n.pattern=r;const i=[[255,0,0,0,255,0,0,0,255,0,0,0,255,0,0,0]],o=[[0,0,255,0,0,0,255,0,0,0,255,0,0,0,255,0]],a=[[255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0]],s=r(i[0]);n.kickSequence=s;const c=r(o[0]);n.snareSequence=c;const u=r(a[0]);n.hatSequence=u;n.kitSequence=()=>({kick:r(i[0]),hat:r(a[0]),snare:r(o[0])});n.combinePatternWithInstrument=(e,t)=>{};n.playNextPart=(e,t,...n)=>{const r=e.next();return r>0&&(t(r,...n),!0)}},{}],"0bce1aa157a4a7e3c7c4cb99f9006f31":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getNextInstruction=n.getInstruction=n.getHelp=n.INSTRUCTIONS=n.QUICK_START=void 0;const r=["No faces found!","Look at me and open your mouth","Move your face close to the screen","Try and put it in the centre","Make sure you allowed the camera!"];n.QUICK_START=r;const i=["Welcome to the <strong>interFACE</strong>","Smile at the screen to begin...","Tilt your head forwards and backwards to change octave","Roll your head left and right to change pitch","Then open you mouth to make it louder!","Change instruments by tapping your face on screen","or hold your finger down to see all instruments","Facing left plays the black keys","Facing right plays the white keys","Connect a MIDI instrument and click the MIDI button","Use your eyes to shape the sound","To play the MIDI instrument with your head","Change tempo and quantize using the secret keys","","","","","","","","","","","Arrow Up - add more bars","Arrow Down - remove a bar","Arrow Left - previous instrument","Arrow Right - next instrument","A - 808","S - Snare","D - Closed Hat","Q - Clack","W - Cowbell","","","","","","","","","","","","","","","","","","","","","OMG I can't believe you are still here!","Secret Keys are as follows","B - Play percussive accompanyment (alpha)","TAB - show more info on screen"];n.INSTRUCTIONS=i;n.getHelp=e=>r[e%(r.length-1)];n.getInstruction=e=>i[e%(i.length-1)];n.getNextInstruction=()=>i[1%(i.length-1)]},{}],dd6a1e56851684b1b1584ee092f2589f:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.DEFAULT_OPTIONS=n.NAMES=void 0;var r=e("./palette"),i=e("./audio"),o=e("./visual"),a=e("./maths"),s=e("./instruments"),c=e("./ui");const u=["a","b","c"].map(e=>"person-"+e);n.NAMES=u;const l={...r.DEFAULT_COLOURS,delayTime:.14,delayLength:10,mouseHoldDuration:.6,feedback:.1,mouthCutOff:.2,mouthSilence:.05,volumeRate:.7,precision:3,ease:a.linear};n.DEFAULT_OPTIONS=l;n.default=class{constructor(e,t,n,r={}){this.options=Object.assign({},l,r),this.name=e,this.counter=0,this.instrumentLoading=!1,this.data=null,this.audioContext=t,this.active=!1,this.tracks=0,this.octave=4,this.midiActive=!1,this.midiChannel="all",this.hue=r.hue||360*Math.random(),this.saturation=40,this.precision=Math.pow(10,parseInt(this.options.precision)),this.yaw=0,this.pitch=0,this.roll=0,this.singing=!1,this.isMouthOpen=!1,this.mouseDownAt=-1,this.lastNoteName="A0",this.debug=r.debug||!1,this.mouthScale=(0,a.rescale)(this.options.mouthCutOff),this.stereoNode=t.createStereoPanner();const o=t.createDelay(this.options.delayLength),s=t.createGain();o.delayTime.value=this.options.delayTime,s.gain.value=this.options.feedback,this.gainNode=t.createGain(),this.gainNode.gain.value=0,this.stereoNode.connect(this.gainNode),this.gainNode.connect(n),this.button=document.getElementById(e),this.button.addEventListener("mousedown",e=>{this.mouseDownAt=t.currentTime;const n=()=>{this.mouseDownFor<this.options.mouseHoldDuration?requestAnimationFrame(n):this.isMouseDown&&(this.mouseDownAt=-1,this.showForm())};n(),e.preventDefault()}),this.button.addEventListener("mouseup",e=>{this.mouseDownFor;this.instrumentLoading||this.loadInstrument((0,i.randomInstrument)()),this.mouseDownAt=-1,e.preventDefault()}),this.button.addEventListener("mouseover",e=>{this.isMouseOver=!0}),this.button.addEventListener("mouseout",e=>{this.isMouseOver=!1})}get mouseDownFor(){return this.audioContext.currentTime-this.mouseDownAt}get isMouseDown(){return this.mouseDownAt>-1}get isMouseHeld(){return this.options.mouseHoldDuration<this.mouseDownFor}get controlsID(){return this.name+"-controls"}get controls(){return document.getElementById(this.controlsID)}get instrumentName(){return this.instrument?this.instrument.name:"loading"}get instrumentTitle(){return this.instrument?this.instrument.title:"loading"}get instrumentIndex(){return s.INSTRUMENT_FOLDERS.indexOf(this.instrumentName)}get hasMIDI(){return this.midi&&this.midiChannel}update(e){this.counter++,this.data=e}draw(e,t=!0){if(!e&&!this.prediction)return;e||(e=this.prediction);let n=this.hue;this.instrumentLoading&&(n+=120);let r=this.saturation;const i=this.options;i.dots=n,i.mouth=`hsla(${(n+30)%360},${r}%,40%,0.8)`,i.mouthClosed=`hsla(${(n+30)%360},${r}%,10%,0.99)`,i.lipsUpperInner=`hsla(${(n+50)%360},${r}%,50%,1)`,i.lipsLowerInner=`hsla(${(n+50)%360},${r}%,50%,1)`,i.midwayBetweenEyes=`hsla(${(n+270)%360},${r}%,50%,1)`,i.leftEyeLower0=`hsla(${(n+300)%360},${r}%,50%,0.8)`,i.rightEyeLower0=`hsla(${(n+300)%360},${r}%,50%,0.8)`,i.leftEyeIris=`hsla(${(n+90)%360},${r}%,50%,1)`,i.rightEyeIris=`hsla(${(n+90)%360},${r}%,50%,1)`,(0,o.drawPoints)(e,i.dots,3,this.instrumentLoading,this.debug),(0,o.drawFace)(e,i,this.singing,this.isMouthOpen,this.debug);const{bottomRight:a,topLeft:c}=e.boundingBox,u=Math.abs(a[0]-c[0]),l=Math.abs(a[1]-c[1]);if(this.counter%12==0&&(this.button.style.setProperty("--person-a-x",""+a[0]),this.button.style.setProperty("--person-a-y",c[1]),this.button.style.setProperty("--person-a-w",u),this.button.style.setProperty("--person-a-h",l)),!t)return;const{silhouette:d}=e.annotations;if(this.isMouseOver||this.instrumentLoading)if(this.isMouseDown&&!this.instrumentLoading){const t=1-this.mouseDownFor/this.options.mouseHoldDuration,r=100-Math.ceil(100*t);this.isMouseHeld?((0,o.drawInstrument)(e.boundingBox,this.instrumentTitle,"Select"),(0,o.drawPart)(d,4,`hsla(${n},50%,${r}%,0.3)`,!0),(0,o.drawParagraph)(e.boundingBox.topLeft[0],e.boundingBox.topLeft[1]+40,["Press me"],"14px")):((0,o.drawInstrument)(e.boundingBox,this.instrumentTitle,""+(100-r)),(0,o.drawPart)(d,4,`hsla(${n},50%,${r}%,0.5)`,!0),(0,o.drawParagraph)(e.boundingBox.topLeft[0],e.boundingBox.topLeft[1]+40,["Hold me to see all instruments"],"14px"))}else(0,o.drawInstrument)(e.boundingBox,this.instrumentTitle,""),(0,o.drawPart)(d,4,"hsla("+n+",50%,50%,0.3)",!0);else if(this.instrumentLoading)(0,o.drawInstrument)(e.boundingBox,this.instrumentTitle,"loading...");else{const t=(this.debug," "+this.lastNoteName);if((0,o.drawInstrument)(e.boundingBox,this.instrumentTitle,t+(this.singing?s.MUSICAL_NOTES[this.counter%(s.MUSICAL_NOTES.length-1)]:this.isMouthOpen?"~":"")),this.debug){const t=["gain:"+this.gainNode.gain.value.toFixed(2),"pitch:"+e.pitch.toFixed(3),"roll:"+e.roll.toFixed(3),"yaw:"+e.yaw.toFixed(3),"eyes:"+e.eyeDirection.toFixed(3),"mouth:"+e.mouthOpen.toFixed(3),`dims:${e.mouthWidth.toFixed(2)}x${e.mouthRange.toFixed(2)}`,(e.lookingRight,"left")];(0,o.drawParagraph)(e.boundingBox.topLeft[0],e.boundingBox.topLeft[1]+40,t,"14px")}}}sing(){if(!this.data||this.tracks>18)return{yaw:0,pitch:0,lipPercentage:0,eyeDirection:0};i.active;const e=this.data,t=this.options,n=e.mouthOpen,r=e.yaw,o=(0,a.clamp)(.5*(e.pitch+1),0,1),s=(0,a.clamp)(e.roll+.5,0,1),c=(0,a.clamp)(e.eyeDirection,-1,1),u=(0,a.clamp)(n,0,1),l=(t.ease(u),Math.round(7*o));this.octave=l;const d=e.lookingRight,h=(0,i.getNoteName)(s,this.octave,d);let f;if(this.lastNoteName=h,this.hue=360*s,this.saturation=100*n,this.stereoNode.pan.value=c,this.instrument&&u>=t.mouthCutOff){const e=this.instrument[h];e||console.log("note not found!",{noteName:h,roll:s,octave:this.octave,isMinor:d}),this.tracks++;(0,i.playTrack)(e,0,this.stereoNode).then(()=>{this.active=!1,this.tracks--});if(f=this.mouthScale(u),f=t.ease(f),f=Math.round(f*this.precision)/this.precision,this.hasMIDI){const e={channels:this.midiChannel,attack:u};this.midi.playNote(h,e),this.midiActive=!0}this.singing=!0,this.isMouthOpen=!0,this.active=!0}else u>t.mouthSilence&&u<t.mouthCutOff?(f=0,this.singing=!1,this.isMouthOpen=!0):(f=0,this.singing=!1,this.isMouthOpen=!1,this.hasMIDI&&(this.midi.stopNote(h),this.midiActive=!1));return this.hasMIDI&&0!==c&&this.midi.setPitchBend(c),this.gainNode.gain.value=this.gainNode.gain.value+(f-this.gainNode.gain.value)*t.volumeRate,this.yaw=r,this.pitch=o,this.roll=s,{yaw:r,pitch:o,roll:s,lipPercentage:n,eyeDirection:c}}async loadRandomInstrument(e){return await this.loadInstrument((0,i.randomInstrument)(),e)}async loadPreviousInstrument(e){const t=this.index,n=t-1<0?0:t-1;return await this.loadInstrument(s.INSTRUMENT_FOLDERS[n],e)}async loadNextInstrument(e){const t=this.index,n=t+1>=s.INSTRUMENT_FOLDERS.length?0:t+1;return await this.loadInstrument(s.INSTRUMENT_FOLDERS[n],e)}async loadInstrument(e,t){return this.instrumentLoading=!0,this.instrument=await(0,i.loadInstrument)(e),this.instrumentLoading=!1,t&&t(e),this.button.dispatchEvent(new CustomEvent("instrumentchange",{detail:{instrument:this.instrument,instrumentName:e}})),e}setMIDI(e,t="all"){this.midiChannel=t,this.midi=e,console.log("MIDI set for person",this,"Channel:"+this.midiChannel,{midi:e,channel:t,hasMIDI:this.hasMIDI})}onInstrumentInput(e){const t=e.target.id;this.hideForm(),this.loadInstrument(t),e.preventDefault()}showForm(){this.controls.innerHTML=(0,c.setupInstrumentForm)(()=>{});this.controls.querySelectorAll("input").forEach(e=>e.addEventListener("change",e=>this.onInstrumentInput(e)),!1);const e=document.getElementById(this.instrumentName);e?e.focus():this.controls.focus()}hideForm(){this.controls.innerHTML=""}}},{"./palette":"8c184ea81a7f9f2a10a21f3b44355276","./audio":"dd70e9d1edf82ea11611411db307fbf3","./visual":"65170211c1067042fc9b847ea066e7ce","./maths":"30c371813e434b101ca68a9e5aac6342","./instruments":"65cd0bc3434dcf662af5a85fae344dc3","./ui":"cc509f6dc4e34d6bd3c8d4b98935925a"}],dad49c631de14c19376524e29b658dc1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.trackError=n.trackExit=n.track=n.setupReporting=void 0;var r=o(e("analytics")),i=o(e("@analytics/google-analytics"));function o(e){return e&&e.__esModule?e:{default:e}}let a;n.setupReporting=(e="Interface",t="G-1XT0GV0L6J")=>(a=(0,r.default)({app:e,plugins:[(0,i.default)({trackingId:t})]}),a.page(),a);n.track=(e,t)=>{a&&a.track(e,t)};n.trackExit=()=>{};n.trackError=(e,t=42,n="Fails")=>{a&&a.track("Error",{category:n,label:e,value:t})}},{analytics:"6ede170d3b2f6ce2d1c0867860501ac8","@analytics/google-analytics":"99a9dbfd305f7b247a121eef61122bfc"}],"6ede170d3b2f6ce2d1c0867860501ac8":[function(e,t,n){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(n,"__esModule",{value:!0});var i=e("@analytics/core"),o=r(i),a=r(e("@analytics/storage-utils"));var s=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e};function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var u=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(n,!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e};function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={storage:a};return o(u(u({},t),e))}n.EVENTS=i.EVENTS,n.CONSTANTS=i.CONSTANTS,n.default=l,n.init=l,n.Analytics=l},{"@analytics/core":"5e853abf05614232b0e1f56d8867d168","@analytics/storage-utils":"1f5dec9c67bee8663c570503eda07baf"}],"5e853abf05614232b0e1f56d8867d168":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("analytics-utils");var i=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}};var o=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)};var a=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")};var s=function(e){return i(e)||o(e)||a()};function c(e,t){return e(t={exports:{}},t.exports),t.exports}var u=c((function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(r){return"function"==typeof Symbol&&"symbol"===t(Symbol.iterator)?e.exports=n=function(e){return t(e)}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":t(e)},n(r)}e.exports=n}));var l=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e};function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var h=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(n,!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e},f="function",p="undefined",m="@@redux/"+Math.random().toString(36),g=function(){return("undefined"==typeof Symbol?"undefined":u(Symbol))===f&&Symbol.observable||"@@observable"}(),y=" != "+f;function b(e,t,n){if(u(t)===f&&u(n)===p&&(n=t,t=void 0),u(n)!==p){if(u(n)!==f)throw new Error("enhancer"+y);return n(b)(e,t)}if(u(e)!==f)throw new Error("reducer"+y);var i=e,o=t,a=[],s=a,c=!1;function d(){s===a&&(s=a.slice())}function h(){return o}function m(e){if(u(e)!==f)throw new Error("Listener"+y);var t=!0;return d(),s.push(e),function(){if(t){t=!1,d();var n=s.indexOf(e);s.splice(n,1)}}}function v(e){if(!r.isObject(e))throw new Error("Act != obj");if(u(e.type)===p)throw new Error("ActType "+p);if(c)throw new Error("Dispatch in reducer");try{c=!0,o=i(o,e)}finally{c=!1}for(var t=a=s,n=0;n<t.length;n++){(0,t[n])()}return e}return v({type:"@@redux/INIT"}),l({dispatch:v,subscribe:m,getState:h,replaceReducer:function(e){if(u(e)!==f)throw new Error("next reducer"+y);i=e,v({type:"@@redux/INIT"})}},g,(function(){var e=m;return l({subscribe:function(t){if("object"!==u(t))throw new TypeError("Observer != obj");function n(){t.next&&t.next(h())}return n(),{unsubscribe:e(n)}}},g,(function(){return this}))}))}function v(e,t){var n=t&&t.type;return"action "+(n&&n.toString()||"?")+"reducer "+e+" returns "+p}function _(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++){var i=t[r];u(e[i])===f&&(n[i]=e[i])}var o,a=Object.keys(n);try{!function(e){Object.keys(e).forEach((function(t){var n=e[t],r=n(void 0,{type:"@@redux/INIT"});if(u(r)===p||u(n(void 0,{type:m}))===p)throw new Error("reducer "+t+" "+p)}))}(n)}catch(e){o=e}return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(o)throw o;for(var r=!1,i={},s=0;s<a.length;s++){var c=a[s],l=n[c],d=e[c],h=l(d,t);if(u(h)===p){var f=v(c,t);throw new Error(f)}i[c]=h,r=r||h!==d}return r?i:e}}function w(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function I(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return function(n,r,i){var o,a=e(n,r,i),c=a.dispatch,u={getState:a.getState,dispatch:function(e){return c(e)}};return o=t.map((function(e){return e(u)})),c=w.apply(void 0,s(o))(a.dispatch),h(h({},a),{},{dispatch:c})}}}var S=["bootstrap","params","campaign","initializeStart","initialize","initializeEnd","ready","resetStart","reset","resetEnd","pageStart","page","pageEnd","pageAborted","trackStart","track","trackEnd","trackAborted","identifyStart","identify","identifyEnd","identifyAborted","userIdChanged","registerPlugins","enablePlugin","disablePlugin","online","offline","setItemStart","setItem","setItemEnd","setItemAborted","removeItemStart","removeItem","removeItemEnd","removeItemAborted"],E=["name","EVENTS","config","loaded"],C=S.reduce((function(e,t){return e[t]=t,e}),{registerPluginType:function(e){return"registerPlugin:".concat(e)},pluginReadyType:function(e){return"ready:".concat(e)}});function A(e){return S.includes(e)}var M="__anon_id",T="__user_id",x="__user_traits",N=Object.freeze({ANON_ID:M,USER_ID:T,USER_TRAITS:x}),O=/^utm_/,B=/^an_prop_/,k=/^an_trait_/;function D(e){var t=e.storage,n=t.setItem,r=t.getItem;return function(t){return function(i){return function(o){if(o.type===C.bootstrap){var a=o.params,s=o.user;r(M)||n(M,s.anonymousId);var c=Object.keys(o.params);if(c.length){var u=a.an_uid,l=a.an_event,d=c.reduce((function(e,t){if(t.match(O)||t.match(/^(d|g)clid/)){var n=t.replace(O,""),r="campaign"===n?"name":n;e.campaign[r]=a[t]}return t.match(B)&&(e.props[t.replace(B,"")]=a[t]),t.match(k)&&(e.traits[t.replace(k,"")]=a[t]),e}),{campaign:{},props:{},traits:{}});t.dispatch(h(h({type:C.params,raw:a},d),u?{userId:u}:{})),u&&setTimeout((function(){return e.identify(u,d.traits)}),0),l&&setTimeout((function(){return e.track(l,d.props)}),0),Object.keys(d.campaign).length&&t.dispatch({type:C.campaign,campaign:d.campaign})}}return i(o)}}}}var R="userId",P="anonymousId";function L(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n.type===C.setItemEnd){if(n.key===M)return h(h({},t),{anonymousId:n.value});if(n.key===T)return h(h({},t),{userId:n.value})}switch(n.type){case C.identify:return Object.assign({},t,{userId:n.userId,traits:h(h({},t.traits),n.traits)});case C.reset:return[R,P,"traits"].forEach((function(e){r.globalContext[V(e)]=null})),[T,M,x].forEach((function(t){e.removeItem(t)})),Object.assign({},t,{userId:null,anonymousId:null,traits:{}});default:return t}}}function F(e,t){return{userId:t.getItem(T)||e.an_uid,anonymousId:t.getItem(M)||e.an_aid||r.uuid(),traits:t.getItem(x)||{}}}var V=function(e){return"__TEMP__"+e};function U(e){return function(t,n,i){var o=n.getState("user")[t];if(o)return o;if(i&&r.isObject(i)&&i[t])return i[t];var a=F({},e)[t];return a||(r.globalContext[V(t)]?r.globalContext[V(t)]:null)}}function j(e){var t=e.storage,n=t.setItem,i=t.removeItem,o=t.getItem;return function(e){return function(t){return function(a){var s=a.userId,c=a.traits,u=a.options,l=a.callback;if(a.type===C.reset&&([T,x,M].forEach((function(e){return i(e)})),[R,P,"traits"].forEach((function(e){r.globalContext[V(e)]=void 0})),r.isFunction(l)&&l()),a.type===C.identify){o(M)||n(M,r.uuid());var d=o(T),f=o(x)||{};d&&d!==s&&e.dispatch({type:C.userIdChanged,old:{userId:d,traits:f},new:{userId:s,traits:c},options:u}),s&&n(T,s),c&&n(x,h(h({},f),c))}return t(a)}}}}var G=c((function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var i=t&&t.prototype instanceof d?t:d,o=Object.create(i.prototype),a=new S(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return C()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=_(a,n);if(s){if(s===l)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=u(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,a),o}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l={};function d(){}function h(){}function f(){}var p={};p[i]=function(){return this};var m=Object.getPrototypeOf,g=m&&m(m(E([])));g&&g!==t&&n.call(g,i)&&(p=g);var y=f.prototype=d.prototype=Object.create(p);function b(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){var r;this._invoke=function(i,o){function a(){return new t((function(r,a){!function r(i,o,a,s){var c=u(e[i],e,o);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(d).then((function(e){l.value=e,a(l)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}(i,o,r,a)}))}return r=r?r.then(a,a):a()}}function _(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,_(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=u(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function E(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:C}}function C(){return{value:void 0,done:!0}}return h.prototype=y.constructor=f,f.constructor=h,h.displayName=s(f,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(v.prototype),v.prototype[o]=function(){return this},e.AsyncIterator=v,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new v(c(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(y),s(y,a,"Generator"),y[i]=function(){return this},y.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=E,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;I(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}));function q(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}var Q=function(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){q(o,r,i,a,s,"next",e)}function s(e){q(o,r,i,a,s,"throw",e)}a(void 0)}))}},z={};function W(e,t){z[e]&&r.isFunction(z[e])&&(z[e](t),delete z[e])}function H(e,t,n){return new Promise((function(r,i){return t()?r(e):n<1?i(h(h({},e),{},{queue:!0})):(o=10,new Promise((function(e){return setTimeout(e,o)}))).then((function(o){return H(e,t,n-10).then(r,i)}));var o}))}function Z(e,t,n){var i=t(),o=e.getState(),a=o.plugins,s=o.context,c=o.queue,u=o.user;if(!s.offline&&c&&c.actions&&c.actions.length){var l=c.actions.reduce((function(e,t,n){return a[t.plugin].loaded?(e.process.push(t),e.processIndex.push(n)):(e.requeue.push(t),e.requeueIndex.push(n)),e}),{processIndex:[],process:[],requeue:[],requeueIndex:[]});if(l.processIndex&&l.processIndex.length){l.processIndex.forEach((function(t){var o=c.actions[t],s=o.plugin,l=o.payload.type,d=i[s][l];if(d&&r.isFunction(d)){var f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return[R,P].reduce((function(e,n){return X(e,t,n)}),e)}(o.payload,u);d({payload:f,config:a[s].config,instance:n});var p="".concat(l,":").concat(s);e.dispatch(h(h({},f),{},{type:p,_:{called:p,from:"queueDrain"}}))}}));var d=c.actions.filter((function(e,t){return!~l.processIndex.indexOf(t)}));c.actions=d}}}function Y(e,t,n){return setInterval((function(){return Z(e,t,n)}),3e3)}function X(e,t,n){return e.hasOwnProperty(n)&&!e[n]&&t[n]?Object.assign({},e,l({},"".concat(n),t[n])):e}var J=function(e){if(Array.isArray(e))return e};var $=function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n};var K=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")};var ee=function(e,t){return J(e)||$(e,t)||K()};function te(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Object.keys(e).filter((function(e){var i=n.plugins||{};return r.isBoolean(i[e])?i[e]:!1!==i.all&&(!t[e]||!1!==t[e].enabled)})).map((function(t){return e[t]}))}var ne=/Start$/,re=/^bootstrap/,ie=/^ready/;function oe(e,t,n,r,i){return ae.apply(this,arguments)}function ae(){return(ae=Q(G.mark((function e(t,n,i,o,a){var s,c,u,l,d,f,p,m,g,y,b,v;return G.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=r.isFunction(n)?n():n,c=t.type,u=c.replace(ne,""),!t._||!t._.called){e.next=5;break}return e.abrupt("return",t);case 5:return l=i.getState(),d=te(s,l.plugins,t.options),c===C.initializeStart&&t.fromEnable&&(d=Object.keys(l.plugins).filter((function(e){var n=l.plugins[e];return t.plugins.includes(e)&&!n.initialized})).map((function(e){return s[e]}))),f=d.map((function(e){return e.name})),p=pe(c,d,s),e.next=12,ce({action:t,data:{exact:p.before,namespaced:p.beforeNS},state:l,allPlugins:s,allMatches:p,instance:i,store:o,EVENTS:a});case 12:if(!ge(m=e.sent,f.length)){e.next=15;break}return e.abrupt("return",m);case 15:if(c!==u){e.next=19;break}g=m,e.next=22;break;case 19:return e.next=21,ce({action:h(h({},m),{},{type:u}),data:{exact:p.during,namespaced:p.duringNS},state:l,allPlugins:s,allMatches:p,instance:i,store:o,EVENTS:a});case 21:g=e.sent;case 22:if(!c.match(ne)){e.next=29;break}return y="".concat(u,"End"),e.next=26,ce({action:h(h({},g),{},{type:y}),data:{exact:p.after,namespaced:p.afterNS},state:l,allPlugins:s,allMatches:p,instance:i,store:o,EVENTS:a});case 26:b=e.sent,(v=se(b))&&v({payload:b});case 29:return e.abrupt("return",m);case 30:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function se(e){return!!e.meta&&Object.keys(e.meta).reduce((function(t,n){var i=e.meta[n];return r.isFunction(i)?i:t}),!1)}function ce(e){return ue.apply(this,arguments)}function ue(){return(ue=Q(G.mark((function e(t){var n,i,o,a,s,c,u,l,d,f,p,m,g,y,b,v,_,w;return G.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.data,i=t.action,o=t.instance,a=t.state,s=t.allPlugins,c=t.allMatches,u=t.store,l=t.EVENTS,d=a.plugins,f=a.context,p=i.type,m=p.match(ne),g=n.exact.map((function(e){return e.pluginName})),m&&(g=c.during.map((function(e){return e.pluginName}))),y=ve(o,g),b=n.exact.reduce((function(e,t){var n=t.pluginName,r=t.methodName,i=!1;return r.match(/^initialize/)||r.match(/^reset/)||(i=!d[n].loaded),f.offline&&r.match(/^(page|track|identify)/)&&(i=!0),e["".concat(n)]=i,e}),{}),e.next=10,n.exact.reduce(function(){var e=Q(G.mark((function e(t,a,c){var u,l,f;return G.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=a.pluginName,e.next=3,t;case 3:if(l=e.sent,!n.namespaced||!n.namespaced[u]){e.next=11;break}return e.next=7,n.namespaced[u].reduce(function(){var e=Q(G.mark((function e(t,n,i){var a,c,l,f;return G.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=function(e,t,n){return function(r,i){var o=n||t;return h(h({},e),{},{abort:{reason:r,plugins:i||[t],caller:p,from:o}})}},e.next=3,t;case 3:if(a=e.sent,n.method&&r.isFunction(n.method)){e.next=6;break}return e.abrupt("return",a);case 6:return _e(n.methodName,n.pluginName),e.next=9,n.method({payload:a,instance:o,abort:c(a,u,n.pluginName),config:de(n.pluginName,d,s),plugins:d});case 9:return l=e.sent,f=r.isObject(l)?l:{},e.abrupt("return",Promise.resolve(h(h({},a),f)));case 12:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Promise.resolve(i));case 7:f=e.sent,l[u]=f,e.next=12;break;case 11:l[u]=i;case 12:return e.abrupt("return",Promise.resolve(l));case 13:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Promise.resolve({}));case 10:return v=e.sent,e.next=13,n.exact.reduce(function(){var e=Q(G.mark((function e(t,i,a){var c,l,f,g,_,w,I,S,E,C,A,M;return G.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=n.exact.length===a+1,l=i.pluginName,f=s[l],e.next=5,t;case 5:if(g=e.sent,_=v[l]?v[l]:{},m&&(_=g),!me(_,l)){e.next=11;break}return le({data:_,method:p,instance:o,pluginName:l,store:u}),e.abrupt("return",Promise.resolve(g));case 11:if(!me(g,l)){e.next=14;break}return c&&le({data:g,method:p,instance:o,store:u}),e.abrupt("return",Promise.resolve(g));case 14:if(!b.hasOwnProperty(l)||!0!==b[l]){e.next=17;break}return u.dispatch({type:"queue",plugin:l,payload:_,_:{called:"queue",from:"queueMechanism"}}),e.abrupt("return",Promise.resolve(g));case 17:return w=y(v[l],s[l]),e.next=20,f[p]({abort:w.abort,payload:_,instance:o,config:de(l,d,s),plugins:d});case 20:return I=e.sent,S=r.isObject(I)?I:{},E=h(h({},g),S),me(C=v[l],l)?le({data:C,method:p,instance:o,pluginName:l,store:u}):(A="".concat(p,":").concat(l),(A.match(/:/g)||[]).length<2&&!p.match(re)&&!p.match(ie)&&(M=m?E:_,o.dispatch(h(h({},M),{},{type:A,_:{called:A,from:"submethod"}})))),e.abrupt("return",Promise.resolve(E));case 26:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Promise.resolve(i));case 13:if(_=e.sent,p.match(ne)||p.match(/^registerPlugin/)||p.match(ie)||p.match(re)||p.match(/^params/)||p.match(/^userIdChanged/)){e.next=21;break}if(l.plugins.includes(p),!_._||_._.originalAction!==p){e.next=18;break}return e.abrupt("return",_);case 18:w=h(h({},_),{_:{originalAction:_.type,called:_.type,from:"engineEnd"}}),ge(_,n.exact.length)&&!p.match(/End$/)&&(w=h(h({},w),{type:_.type+"Aborted"})),u.dispatch(w);case 21:return e.abrupt("return",_);case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function le(e){var t=e.data,n=e.method,r=(e.instance,e.pluginName),i=n+"Aborted"+(r?":"+r:"");e.store.dispatch(h(h({},t),{},{type:i,_:{called:i,from:"abort"}}))}function de(e,t,n){var r=t[e]||n[e];return r&&r.config?r.config:{}}function he(e,t){return t.reduce((function(t,n){return n[e]?t.concat({methodName:e,pluginName:n.name,method:n[e]}):t}),[])}function fe(e,t){var n=function(e){return e.replace(ne,"")}(e),r=t?":".concat(t):"";return["".concat(e).concat(r),"".concat(n).concat(r),"".concat(n,"End").concat(r)]}function pe(e,t,n){var r=fe(e).map((function(e){return he(e,t)}));return t.reduce((function(n,r){var i=r.name,o=fe(e,i).map((function(e){return he(e,t)})),a=ee(o,3),s=a[0],c=a[1],u=a[2];return s.length&&(n.beforeNS[i]=s),c.length&&(n.duringNS[i]=c),u.length&&(n.afterNS[i]=u),n}),{before:r[0],beforeNS:{},during:r[1],duringNS:{},after:r[2],afterNS:{}})}function me(e,t){var n=e.abort;return!!n&&(!0===n||(be(n,t)||n&&be(n.plugins,t)))}function ge(e,t){var n=e.abort;if(!n)return!1;if(!0===n||r.isString(n))return!0;var i=n.plugins;return ye(n)&&n.length===t||ye(i)&&i.length===t}function ye(e){return Array.isArray(e)}function be(e,t){return!(!e||!ye(e))&&e.includes(t)}function ve(e,t){return function(n,r,i){var o=r.config,a=r.name,s="".concat(a,".").concat(n.type);i&&(s=i.event);var c=n.type.match(ne)?function(e,t,n,r,i){return function(o,a){var s=r?r.name:e,c=a&&ye(a)?a:n;if(r&&(!(c=a&&ye(a)?a:[e]).includes(e)||1!==c.length))throw new Error("Method ".concat(t," can only abort ").concat(e," plugin. ").concat(JSON.stringify(c)," input valid"));return h(h({},i),{},{abort:{reason:o,plugins:c,caller:t,_:s}})}}(a,s,t,i,n):function(e,t){return function(){throw new Error(e.type+" action not cancellable. Remove abort in "+t)}}(n,s);return{payload:Ie(n),instance:e,config:o||{},abort:c}}}function _e(e,t){var n=we(e);if(n&&n.name===t){var r=we(n.method),i=r?"or "+r.method:"";throw new Error([t+" plugin is calling method "+e,"Plugins cant call self","Use ".concat(n.method," ").concat(i," in ").concat(t," plugin insteadof ").concat(e)].join("\n"))}}function we(e){var t=e.match(/(.*):(.*)/);return!!t&&{method:t[1],name:t[2]}}function Ie(e){return Object.keys(e).reduce((function(t,n){return"type"===n||(r.isObject(e[n])?t[n]=Object.assign({},e[n]):t[n]=e[n]),t}),{})}function Se(e,t,n){var r={};return function(i){return function(o){return function(){var a=Q(G.mark((function a(s){var c,u,l,d,f,p,m,g,y,b,v,_;return G.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(c=s.type,u=s.abort,l=s.plugins,d=s,!u){a.next=4;break}return a.abrupt("return",o(s));case 4:if(c===C.enablePlugin&&i.dispatch({type:C.initializeStart,plugins:l,disabled:[],fromEnable:!0,ts:s.ts}),c===C.disablePlugin&&setTimeout((function(){W(s.ts)}),0),c===C.initializeEnd&&(f=t(),p=Object.keys(f),m=p.filter((function(e){return l.includes(e)})).map((function(e){return f[e]})),g=[],y=[],b=s.disabled,v=m.map((function(e){var t=e.loaded,n=e.name;return H(e,t,1e4).then((function(t){return r[n]||(i.dispatch({type:C.pluginReadyType(n),name:n,events:Object.keys(e).filter((function(e){return!E.includes(e)}))}),r[n]=!0),g=g.concat(n),e})).catch((function(e){if(e instanceof Error)throw new Error(e);return y=y.concat(e.name),e}))})),Promise.all(v).then((function(e){var t={plugins:g,failed:y,disabled:b};setTimeout((function(){p.length===v.length+b.length&&i.dispatch(h(h({},{type:C.ready}),t)),W(s.ts,t)}),0)}))),c===C.bootstrap){a.next=13;break}return/^ready:([^:]*)$/.test(c)&&setTimeout((function(){return Z(i,t,e)}),0),a.next=11,oe(s,t,e,i,n);case 11:return _=a.sent,a.abrupt("return",o(_));case 13:return a.abrupt("return",o(d));case 14:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()}}}function Ee(){return(new Date).getTime()}function Ce(e){return function(t){return function(t){return function(n){var r=n.type,i=n.key,o=n.value,a=n.options;if(r===C.setItem||r===C.removeItem){if(n.abort)return t(n);r===C.setItem?e.setItem(i,o,a):e.removeItem(i,a)}return t(n)}}}}var Ae,Me,Te,xe,Ne=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Oe=function e(){var t=this;Ne(this,e),l(this,"before",[]),l(this,"after",[]),l(this,"addMiddleware",(function(e,n){t[n]=t[n].concat(e)})),l(this,"removeMiddleware",(function(e,n){var r=t[n].findIndex((function(t){return t===e}));-1!==r&&(t[n]=[].concat(s(t[n].slice(0,r)),s(t[n].slice(r+1))))})),l(this,"dynamicMiddlewares",(function(e){return function(n){return function(r){return function(i){var o={getState:n.getState,dispatch:function(e){return n.dispatch(e)}},a=t[e].map((function(e){return e(o)}));return w.apply(void 0,s(a))(r)(i)}}}}))};function Be(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,r={};if("initialize:aborted"===n.type)return t;if(/^registerPlugin:([^:]*)$/.test(n.type)){var i=ke(n.type,"registerPlugin"),o=e()[i];if(!o||!i)return t;var a=n.enabled;return r[i]={enabled:a,initialized:!!a&&Boolean(!o.initialize),loaded:!!a&&Boolean(o.loaded()),config:o.config||{}},h(h({},t),r)}if(/^initialize:([^:]*)$/.test(n.type)){var s=ke(n.type,C.initialize),c=e()[s];return c&&s?(r[s]=h(h({},t[s]),{initialized:!0,loaded:Boolean(c.loaded())}),h(h({},t),r)):t}if(/^ready:([^:]*)$/.test(n.type))return r[n.name]=h(h({},t[n.name]),{loaded:!0}),h(h({},t),r);switch(n.type){case C.disablePlugin:return h(h({},t),De(n.plugins,!1,t));case C.enablePlugin:return h(h({},t),De(n.plugins,!0,t));default:return t}}}function ke(e,t){return e.substring(t.length+1,e.length)}function De(e,t,n){return e.reduce((function(e,r){return e[r]=h(h({},n[r]),{enabled:t}),e}),n)}Ae=function(){if(!r.inBrowser)return!1;var e=navigator.appVersion;return~e.indexOf("Win")?"Windows":~e.indexOf("Mac")?"MacOS":~e.indexOf("X11")?"UNIX":~e.indexOf("Linux")?"Linux":"Unknown OS"}(),Me=r.inBrowser?document.referrer:null,Te=r.getBrowserLocale(),xe=r.getTimeZone();var Re={initialized:!1,sessionId:r.uuid(),app:null,version:null,debug:!1,offline:!!r.inBrowser&&!navigator.onLine,os:{name:Ae},userAgent:r.inBrowser?navigator.userAgent:"node",library:{name:"analytics",version:"0.9.2"},timezone:xe,locale:Te,campaign:{},referrer:Me};function Pe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Re,t=arguments.length>1?arguments[1]:void 0,n=e.initialized,r=t.type,i=t.campaign;switch(r){case C.campaign:return h(h({},e),{campaign:i});case C.offline:return h(h({},e),{offline:!0});case C.online:return h(h({},e),{offline:!1});default:return n?e:h(h(h({},Re),e),{initialized:!0})}}var Le=["plugins","reducers","storage"];function Fe(e){return Object.keys(e).reduce((function(t,n){return Le.includes(n)||(t[n]=e[n]),t}),{})}function Ve(e){var t=e;try{t=JSON.parse(JSON.stringify(e))}catch(e){}return t}var Ue=/#.*$/;function je(e){var t=/(http[s]?:\/\/)?([^\/\s]+\/)(.*)/g.exec(e);return"/"+(t&&t[3]?t[3].split("?")[0].replace(Ue,""):"")}function Ge(e){var t=function(){if(r.inBrowser)for(var e,t=document.getElementsByTagName("link"),n=0;e=t[n];n++)if("canonical"===e.getAttribute("rel"))return e.getAttribute("href")}();return t?t.match(/\?/)?t:t+e:window.location.href.replace(Ue,"")}var qe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!r.inBrowser)return e;var t=document,n=t.title,i=t.referrer,o=window,a=o.location,s=o.innerWidth,c=o.innerHeight,u=a.hash,l=a.search,d=Ge(l),f={title:n,url:d,path:je(d),hash:u,search:l,width:s,height:c};return i&&""!==i&&(f.referrer=i),h(h({},f),e)},Qe={last:{},history:[]};function ze(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Qe,t=arguments.length>1?arguments[1]:void 0,n=t.properties,r=t.options,i=t.meta;switch(t.type){case C.page:var o=Ve(h({properties:n,meta:i},Object.keys(r).length&&{options:r}));return h(h({},e),{last:o,history:e.history.concat(o)});default:return e}}var We={last:{},history:[]};function He(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:We,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.meta,i=t.options,o=t.event,a=t.properties;switch(n){case C.track:var s=Ve(h(h({event:o,properties:a},Object.keys(i).length&&{options:i}),{},{meta:r}));return h(h({},e),{last:s,history:e.history.concat(s)});default:return e}}var Ze={actions:[]};function Ye(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ze,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case"queue":var i;return i=r&&r.type&&r.type===C.identify?[t].concat(e.actions):e.actions.concat(t),h(h({},e),{},{actions:i});case"dequeue":return[];default:return e}}function Xe(e,t,n){if(!r.inBrowser)return!1;var i=window[(n?"add":"remove")+"EventListener"];e.split(" ").forEach((function(e){i(e,t)}))}function Je(e){var t=Xe.bind(null,"online offline",(function(t){return Promise.resolve(!navigator.onLine).then(e)}));return t(!0),function(e){return t(!1)}}function $e(){return Array.prototype.slice.call(arguments).reduce((function(e,t){return e||(r.isFunction(t)?t:e)}),!1)}function Ke(){return r.globalContext.__analytics__=[],function(e){return function(t,n,i){var o=e(t,n,i),a=o.dispatch;return Object.assign(o,{dispatch:function(e){var t=e.action||e;return r.globalContext.__analytics__.push(t),a(e)}})}}}function et(e){return function(){return w(w.apply(null,arguments),Ke())}}function tt(e){return e?r.isString(e)?[e]:e:[]}var nt=function(e,t,n){return{type:C.setItemStart,timestamp:Ee(),key:e,value:t,options:n}},rt=function(e,t){return{type:C.removeItemStart,timestamp:Ee(),key:e,options:t}};function it(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.reducers||{},n=(e.plugins||[]).reduce((function(e,t){if(r.isFunction(t))return e.middlewares=e.middlewares.concat(t),e;if(t.NAMESPACE&&(t.name=t.NAMESPACE),!t.name)throw new Error("https://lytics.dev/errors/1");var n=t.EVENTS?Object.keys(t.EVENTS).map((function(e){return t.EVENTS[e]})):[],i=!(!1===t.enabled),o=!(t.config&&!1===t.config.enabled);e.pluginEnabled[t.name]=i&&o,delete t.enabled,t.methods&&(e.methods[t.name]=Object.keys(t.methods).reduce((function(e,n){return e[n]=ne(t.methods[n]),e}),{}),delete t.methods);var a=Object.keys(t).concat(n),s=new Set(e.events.concat(a));if(e.events=Array.from(s),e.pluginsArray=e.pluginsArray.concat(t),e.plugins[t.name])throw new Error(t.name+" already loaded");return e.plugins[t.name]=t,e.plugins[t.name].loaded||(e.plugins[t.name].loaded=function(){return!0}),e}),{plugins:{},pluginEnabled:{},methods:{},pluginsArray:[],middlewares:[],events:[]}),i=e.storage?e.storage:{getItem:function(e){return r.globalContext[e]},setItem:function(e,t){return r.globalContext[e]=t},removeItem:function(e){return r.globalContext[e]=void 0}},o=U(i),a=n.plugins,c=n.events.filter((function(e){return!E.includes(e)})),l=new Set(c.concat(S).filter((function(e){return!E.includes(e)}))),d=Array.from(l).sort(),f=c.sort(),p=function(){return a},m=new Oe,g=m.addMiddleware,y=m.removeMiddleware,v=m.dynamicMiddlewares,T=function(){throw new Error("Abort disabled in listener")},x=function(e,t){return function(n){t&&t(n),e(n)}},N=r.paramsParse(),O=F(N,i),B=h({enable:function(e,t){var n=r.uuid();return new Promise((function(r){z[n]=x(r,t),$.dispatch({type:C.enablePlugin,plugins:tt(e),ts:n,_:{originalAction:C.enablePlugin}})}))},disable:function(e,t){var n=r.uuid();return new Promise((function(r){z[n]=x(r,t),$.dispatch({type:C.disablePlugin,plugins:tt(e),ts:n,_:{originalAction:C.disablePlugin}})}))}},n.methods),k={identify:function(e,t,n,i){var a=r.isString(e)?e:null,s=r.isObject(e)?e:t,c=n||{},u=k.user();r.globalContext[V(R)]=a;var l=a||s.userId||o(R,k,s);return new Promise((function(e,r){$.dispatch(h(h({type:C.identifyStart,userId:l,traits:s||{},options:c,anonymousId:u.anonymousId},u.id&&u.id!==a&&{previousId:u.id}),{},{meta:{timestamp:Ee(),callback:x(e,$e(t,n,i))}}))}))},track:function(e,t,n,i){var a=r.isObject(e)?e.event:e;if(!a||!r.isString(a))throw new Error("Event missing");var s=r.isObject(e)?e:t||{},c=r.isObject(n)?n:{};return new Promise((function(e,r){$.dispatch({type:C.trackStart,event:a,properties:s,options:c,userId:o(R,k,t),anonymousId:o(P,k,t),meta:{timestamp:Ee(),callback:x(e,$e(t,n,i))}})}))},page:function(e,t,n){var i=r.isObject(e)?e:{},a=r.isObject(t)?t:{};return new Promise((function(r,s){$.dispatch({type:C.pageStart,properties:qe(i),options:a,userId:o(R,k,i),anonymousId:o(P,k,i),meta:{timestamp:Ee(),callback:x(r,$e(e,t,n))}})}))},user:function(e){if(e===R||"id"===e)return o(R,k);var t=k.getState("user");return e?r.dotProp(t,e):t},reset:function(e){return new Promise((function(t,n){$.dispatch({type:C.resetStart,timestamp:Ee(),callback:x(t,e)})}))},ready:function(e){return k.on(C.ready,e)},on:function(e,t){if(!e||!r.isFunction(t))return!1;if(e===C.bootstrap)throw new Error(".on disabled for "+e);var n=/Start$|Start:/;if("*"===e){var i=function(e){return function(e){return function(r){return r.type.match(n)&&t({payload:r,instance:k,plugins:a}),e(r)}}},o=function(e){return function(e){return function(r){return r.type.match(n)||t({payload:r,instance:k,plugins:a}),e(r)}}};return g(i,ot),g(o,at),function(){y(i,ot),y(o,at)}}var s=e.match(n)?ot:at,c=function(n){return function(n){return function(r){return r.type===e&&t({payload:r,instance:k,plugins:a,abort:T}),n(r)}}};return g(c,s),function(){return y(c,s)}},once:function(e,t){if(!e||!r.isFunction(t))return!1;if(e===C.bootstrap)throw new Error(".once disabled for "+e);var n=k.on(e,(function(e){var r=e.payload;t({payload:r,instance:k,plugins:a,abort:T}),n()}));return n},getState:function(e){var t=$.getState();return e?r.dotProp(t,e):Object.assign({},t)},dispatch:function(e){var t=r.isString(e)?{type:e}:e;if(A(t.type))throw new Error("reserved action "+t.type);var n=t.meta||{},i=e._||{},o=h(h({},t),{},{meta:h({timestamp:Ee()},n),_:h({originalAction:t.type},i)});$.dispatch(o)},enablePlugin:B.enable,disablePlugin:B.disable,plugins:B,storage:{getItem:i.getItem,setItem:function(e,t,n){$.dispatch(nt(e,t,n))},removeItem:function(e,t){$.dispatch(rt(e,t))}},setAnonymousId:function(e,t){k.storage.setItem(M,e,t)},events:{all:d,core:S,plugins:f}},G=n.middlewares.concat([v(ot),Se(k,p,{all:d,plugins:f}),Ce(i),D(k),j(k),v(at)]),q={context:Pe,user:L(i),page:ze,track:He,plugins:Be(p),queue:Ye},Q=w,W=w;if(r.inBrowser&&e.debug){var H=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__;H&&(Q=H({trace:!0,traceLimit:25})),W=function(){return 0===arguments.length?Ke():r.isObject(u(arguments[0]))?et():et().apply(null,arguments)}}var Z=Fe(e),X=n.pluginsArray.reduce((function(e,t){var r=t.name,i=t.config,o=t.loaded,a=n.pluginEnabled[r];return e[r]={enabled:a,initialized:!!a&&Boolean(!t.initialize),loaded:Boolean(o()),config:i||{}},e}),{}),J={context:Z,user:O,plugins:X},$=b(_(h(h({},q),t)),J,W(Q(I.apply(void 0,s(G))))),K=Object.keys(a);$.dispatch({type:C.bootstrap,plugins:K,config:Z,params:N,user:O});var ee=K.filter((function(e){return n.pluginEnabled[e]})),te=K.filter((function(e){return!n.pluginEnabled[e]}));function ne(e){return function(){var t=Array.prototype.slice.call(arguments),n=Array.apply(null,Array(e.length)).map((function(){})).map((function(e,n){if(t[n]||!1===t[n]||null===t[n])return t[n]})).concat(k);return e.apply({instance:k},n)}}return $.dispatch({type:C.registerPlugins,plugins:K,enabled:n.pluginEnabled}),n.pluginsArray.map((function(e,t){var i=e.bootstrap,o=e.config,a=e.name;i&&r.isFunction(i)&&i({instance:k,config:o,payload:e}),$.dispatch({type:C.registerPluginType(a),name:a,enabled:n.pluginEnabled[a],plugin:e}),n.pluginsArray.length===t+1&&$.dispatch({type:C.initializeStart,plugins:ee,disabled:te})})),Je((function(e){$.dispatch({type:e?C.offline:C.online})})),Y($,p,k),k}var ot="before",at="after";n.default=it,n.init=it,n.Analytics=it,n.EVENTS=C,n.CONSTANTS=N},{"analytics-utils":"d5519d74f55f17443c57b69f6260897f"}],d5519d74f55f17443c57b69f6260897f:[function(e,t,n){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(n,"__esModule",{value:!0});var i=r(e("dlv")),o=e("@analytics/storage-utils"),a=r(o);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}var u="undefined"!=typeof document;function l(e){if(!u)return!1;var t=e||document.referrer;if(t){var n=window.document.location.port,r=t.split("/")[2];return n&&(r=r.replace(":".concat(n),"")),r!==window.location.hostname}return!1}function d(e,t){var n=(e.split("?")||[,])[1];if(!n||-1===n.indexOf(t))return e;var r=new RegExp("(\\&|\\?)".concat(t,'([_A-Za-z0-9"+=.\\/\\-@%]+)'),"g"),i="?".concat(n).replace(r,"").replace(/^&/,"?");return e.replace("?".concat(n),i)}function h(e){return function(e){var t,n={},r=/([^&=]+)=?([^&]*)/g;for(;t=r.exec(e);){var i=c(t[1]),o=c(t[2]);"[]"===i.substring(i.length-2)?(i=i.substring(0,i.length-2),(n[i]||(n[i]=[])).push(o)):n[i]=""===o||o}for(var a in n){var s=a.split("[");s.length>1&&(f(n,s.map((function(e){return e.replace(/[?[\]\\ ]/g,"")})),n[a]),delete n[a])}return n}(function(e){if(e){var t=e.match(/\?(.*)/);return t&&t[1]?t[1].split("#")[0]:""}return u&&window.location.search.substring(1)}(e))}function f(e,t,n){for(var r=t.length-1,i=0;i<r;++i){var o=t[i];o in e||(e[o]={}),e=e[o]}e[t[r]]=n}function p(e){if(!u)return null;var t=document.createElement("a");return t.setAttribute("href",e),t.hostname}function m(e){return(p(e)||"").split(".").slice(-2).join(".")}function g(e){var t=e.split(".");return t.length>1?t.slice(0,-1).join("."):e}var y={trimTld:g,getDomainBase:m,getDomainHost:p};var b="q",v={"daum.net":b,"eniro.se":"search_word","naver.com":"query","yahoo.com":"p","msn.com":b,"aol.com":b,"ask.com":b,"baidu.com":"wd","yandex.com":"text","rambler.ru":"words",google:b,"bing.com":{p:b,n:"live"}};n.dotProp=i,n.storage=a,n.getCookie=o.getCookie,n.setCookie=o.setCookie,n.globalContext=o.globalContext,n.removeCookie=o.removeCookie,n.isFunction=function(e){return"function"==typeof e},n.isString=function(e){return"string"==typeof e},n.isArray=function(e){return Array.isArray(e)},n.isObject=function(e){if("object"!==s(e)||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t},n.isUndefined=function(e){return void 0===e},n.isBoolean=function(e){return"boolean"==typeof e},n.decodeUri=c,n.getBrowserLocale=function(){if(u){var e=navigator,t=e.language,n=e.languages,r=e.userLanguage;return r||(n&&n.length?n[0]:t)}},n.getTimeZone=function(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}},n.inBrowser=u,n.isExternalReferrer=l,n.isScriptLoaded=function(e){if(!u)return!0;var t=document.getElementsByTagName("script");return!!Object.keys(t).filter((function(n){var r=t[n].src;return"string"==typeof e?-1!==r.indexOf(e):e instanceof RegExp&&r.match(e)})).length},n.noOp=function(){},n.paramsClean=d,n.paramsGet=function(e,t){return c((RegExp("".concat(e,"=(.+?)(&|$)")).exec(t)||[,""])[1])},n.paramsParse=h,n.paramsRemove=function(e,t){return u?new Promise((function(n,r){if(window.history&&window.history.replaceState){var i=window.location.href,o=d(i,e);i!==o&&history.replaceState({},"",o)}return t&&t(),n()})):Promise.resolve()},n.parseReferrer=function(e,t){if(!u)return!1;var n={source:"(direct)",medium:"(none)",campaign:"(not set)"};e&&l(e)&&(n.referrer=e);var r=function(e){if(!e||!u)return!1;var t=m(e),n=document.createElement("a");n.href=e,n.hostname.indexOf("google")>-1&&(t="google");if(v[t]){var r=v[t],i="string"==typeof r?r:r.p,o=new RegExp(i+"=.*?([^&#]*|$)","gi"),a=n.search.match(o);return{source:r.n||g(t),medium:"organic",term:(a?a[0].split("=")[1]:"")||"(not provided)"}}var s=l(e)?"referral":"internal";return{source:n.hostname,medium:s}}(e);r&&Object.keys(r).length&&(n=Object.assign({},n,r));var i=h(t),o=Object.keys(i);if(!o.length)return n;var a=o.reduce((function(e,t){return t.match(/^utm_/)&&(e["".concat(t.replace(/^utm_/,""))]=i[t]),t.match(/^(d|g)clid/)&&(e.source="google",e.medium=i.gclid?"cpc":"cpm",e[t]=i[t]),e}),{});return Object.assign({},n,a)},n.url=y,n.uuid=function(){for(var e="",t=0,n=4294967295*Math.random()|0;t++<36;){var r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx"[t-1],i=15&n;e+="-"==r||"4"==r?r:("x"==r?i:3&i|8).toString(16),n=t%8==0?4294967295*Math.random()|0:n>>4}return e},n.throttle=function(e,t){var n,r,i,o=null,a=0,s=function(){a=new Date,o=null,i=e.apply(n,r)};return function(){var c=new Date;a||(a=c);var u=t-(c-a);return n=this,r=arguments,u<=0?(clearTimeout(o),o=null,a=c,i=e.apply(n,r)):o||(o=setTimeout(s,u)),i}}},{dlv:"83a8bb07f637160c26ce43710946daa3","@analytics/storage-utils":"1f5dec9c67bee8663c570503eda07baf"}],"83a8bb07f637160c26ce43710946daa3":[function(e,t,n){var r;r=this,"object"==typeof n&&void 0!==t?t.exports=function(e,t,n,r,i){for(t=t.split?t.split("."):t,r=0;r<t.length;r++)e=e?e[t[r]]:i;return e===i?n:e}:r.dlv=function(e,t,n,r,i){for(t=t.split?t.split("."):t,r=0;r<t.length;r++)e=e?e[t[r]]:i;return e===i?n:e}},{}],"1f5dec9c67bee8663c570503eda07baf":[function(e,t,n){"use strict";var r=arguments[3];Object.defineProperty(n,"__esModule",{value:!0});var i=e("@analytics/cookie-utils");function o(){try{if("undefined"==typeof localStorage||"undefined"==typeof JSON)return!1;localStorage.setItem("_t_","1"),localStorage.removeItem("_t_")}catch(e){return!1}return!0}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e){var t;try{void 0===(t=JSON.parse(e))&&(t=e),"true"===t&&(t=!0),"false"===t&&(t=!1),parseFloat(t)===t&&"object"!==a(t)&&(t=parseFloat(t))}catch(n){t=e}return t}var c="object"===("undefined"==typeof self?"undefined":a(self))&&self.self===self&&self||"object"===(void 0===r?"undefined":a(r))&&r.global===r&&r||void 0,u="localStorage",l="cookie",d="global",h=o(),f=i.hasCookieSupport();function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return null;var n=b(t);if("all"===n)return m(e);if(v(n)){var r=localStorage.getItem(e);if(r||n===u)return s(r)}if(_(n)){var o=i.getCookie(e);if(o||n===l)return s(o)}return c[e]||null}function m(e){return{cookie:s(i.getCookie(e)),localStorage:s(localStorage.getItem(e)),global:c[e]||null}}function g(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e||!t)return!1;var r=b(n),o=JSON.stringify(t);if(v(r)){var a=s(localStorage.getItem(e));return localStorage.setItem(e,o),{value:t,oldValue:a,location:u}}if(_(r)){var h=s(i.getCookie(e));return i.setCookie(e,o),{value:t,oldValue:h,location:l}}var f=c[e];return c[e]=t,{value:t,oldValue:f,location:d}}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return!1;var n=b(t);return v(n)?(localStorage.removeItem(e),u):_(n)?(i.removeCookie(e),l):(c[e]=void 0,d)}function b(e){return"string"==typeof e?e:e.storage}function v(e){return h&&(!e||e===u)}function _(e){return f&&(!e||e===l)}var w={getItem:p,setItem:g,removeItem:y};n.getCookie=i.getCookie,n.setCookie=i.setCookie,n.removeCookie=i.removeCookie,n.hasCookieSupport=i.hasCookieSupport,n.getItem=p,n.setItem=g,n.removeItem=y,n.globalContext=c,n.hasLocalStorageSupport=o,n.default=w},{"@analytics/cookie-utils":"8c2a8a98fdb2a5da9738f81db8ec3099"}],"8c2a8a98fdb2a5da9738f81db8ec3099":[function(e,t,n){"use strict";function r(e,t,n,r,i,o){if("undefined"!=typeof window)return arguments.length>1?document.cookie=e+"="+encodeURIComponent(t)+(n?"; expires="+new Date(+new Date+1e3*n).toUTCString()+(r?"; path="+r:"")+(i?"; domain="+i:"")+(o?"; secure":""):""):decodeURIComponent((("; "+document.cookie).split("; "+e+"=")[1]||"").split(";")[0])}Object.defineProperty(n,"__esModule",{value:!0});var i=r,o=r;n.hasCookieSupport=function(){try{r("_c_","1");var e=-1!==document.cookie.indexOf("_c_");return r("_c_","",-1),e}catch(e){return!1}},n.setCookie=o,n.getCookie=i,n.removeCookie=function(e){return r(e,"",-1)}},{}],"99a9dbfd305f7b247a121eef61122bfc":[function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){r(e,t,n[t])}))}return e}Object.defineProperty(n,"__esModule",{value:!0});var o={trackingId:null,debug:!1,anonymizeIp:!1,customDimensions:{},resetCustomDimensionsOnPage:[],setCustomDimensionsToPage:!0},a={};function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!1,n=u(e),r=n.instanceName,s=n.instancePrefix;return{name:"google-analytics",config:i({},o,e),initialize:function(e){var t=e.config,n=e.instance;if(!t.trackingId)throw new Error("No GA trackingId defined");var o,u,l,d,f,p,m,g=t.customScriptSrc||"https://www.google-analytics.com/analytics.js";if(c(g)&&(o=window,u=document,l="script",d=g,f="ga",o.GoogleAnalyticsObject=f,o.ga=o.ga||function(){(o.ga.q=o.ga.q||[]).push(arguments)},o.ga.l=1*new Date,p=u.createElement(l),m=u.getElementsByTagName(l)[0],p.async=1,p.src=d,m.parentNode.insertBefore(p,m)),!a[r]){var y=i({cookieDomain:t.domain||"auto",siteSpeedSampleRate:t.siteSpeedSampleRate||1,sampleRate:t.sampleRate||100,allowLinker:!0},t.cookieConfig);if(r&&(y.name=r),ga("create",t.trackingId,y),t.debug&&(ga("".concat(s,"set"),"sendHitTask",null),window.ga_debug={trace:!0}),t.anonymizeIp&&ga("".concat(s,"set"),"anonymizeIp",!0),t.tasks){["customTask","previewTask","checkProtocolTask","validationTask","checkStorageTask","historyImportTask","samplerTask","buildHitTask","sendHitTask","timingTask","displayFeaturesTask"].forEach((function(e){if(t.tasks.hasOwnProperty(e)){var n=t.tasks[e];"function"==typeof n?ga(t.tasks[e]):null===n&&ga("".concat(s,"set"),e,n)}}))}var b=(n.user()||{}).traits||{};if(Object.keys(b).length){var v=h(b,t);ga("".concat(s,"set"),v)}a[r]=!0}},page:function(e){var n=e.payload,r=e.config,o=e.instance,a=n.properties,u=r.resetCustomDimensionsOnPage,l=r.customDimensions,h=o.getState("context.campaign");if(!c()){if(u&&u.length){var f=u.reduce((function(e,t){return l[t]&&(e[l[t]]=null),e}),{});Object.keys(f).length&&ga("".concat(s,"set"),f)}var m=a.path||document.location.pathname,g={page:m,title:a.title,location:a.url},y={page:m,title:a.title};a.referrer!==document.referrer&&(y.referrer=a.referrer);var b=i({},g,d(h),p(a,r,s));ga("".concat(s,"set"),y),t&&delete b.location,ga("".concat(s,"send"),"pageview",b),t=!0}},track:function(e){var t=e.payload,n=e.config,r=e.instance,i=t.properties,o=t.event,a=i.label,s=i.value;l({hitType:"event",event:o,label:a,category:i.category||"All",value:s,nonInteraction:i.nonInteraction,campaign:r.getState("context.campaign")},n,t)},identify:function(e){var t=e.payload,n=e.config;m(t.userId,t.traits,n)},loaded:function(){return!!window.gaplugins}}}function c(e){return e?!function(e){var t=document.querySelectorAll("script[src]");return!!Object.keys(t).filter((function(n){return(t[n].src||"")===e})).length}(e):"undefined"==typeof ga}function u(e){var t=e.instanceName;return{instancePrefix:t?"".concat(t,"."):"",instanceName:t}}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;if(!c()){var r=u(t),o=r.instancePrefix,a={hitType:e.hitType||"event",eventAction:e.event,eventLabel:e.label,eventCategory:e.category||"All",nonInteraction:void 0!==e.nonInteraction&&!!e.nonInteraction};e.value&&(a.eventValue=g(e.value));var s=d(e),l=p(n.properties,t,o),h=i({},a,s,l);return ga("".concat(o,"send"),"event",h),h}}function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={},n=e.name,r=e.source,i=e.medium,o=e.content,a=e.keyword;return n&&(t.campaignName=n),r&&(t.campaignSource=r),i&&(t.campaignMedium=i),o&&(t.campaignContent=o),a&&(t.campaignKeyword=a),t}function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.customDimensions;return Object.keys(n).reduce((function(t,r){var i=n[r],o=f(e,r)||e[r];return"boolean"==typeof o&&(o=o.toString()),o||0===o?(t[i]=o,t):t}),{})}function f(e,t,n,r,i){for(t=t.split?t.split("."):t,r=0;r<t.length;r++)e=e?e[t[r]]:i;return e===i?n:e}function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=h(e,t);return Object.keys(r).length?t.setCustomDimensionsToPage?(ga("".concat(n,"set"),r),{}):r:{}}function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!c()){var r=u(n),i=r.instancePrefix;if(e&&ga("".concat(i,"set"),"userId",e),Object.keys(t).length){var o=h(t,n);ga("".concat(i,"set"),o)}}}function g(e){return!e||e<0?0:Math.round(e)}var y=s,b=s,v=l,_=m;n.default=y,n.init=b,n.identify=_,n.track=v,n.page=void 0,n.initialize=void 0},{}],"871cd3022c83973e381d7bf4518a0be5":[function(e,t,n){t.exports=e("./loaders/browser/js-loader")(e("./bundle-url").getBundleURL()+e("./relative-path")("f56c669d1026d19f","d54097c20170a850")).then(()=>parcelRequire("99c69f85e2e0ab520ebcabc424fac7a2"))},{"./loaders/browser/js-loader":"a9c840d63b072ad73ba68ab5bad5cba1","./bundle-url":"a079551cb6dc35425204fc0bb93fe7bb","./relative-path":"3d690079c6611245df705566cbbc1942"}],f86476b6dfe525fe3e35c3b4270bbe11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.installer=n.isSupportingBrowser=void 0;var r,i=e("./ui"),o=e("./version"),a=(r=e("url:./manifest.webmanifest"))&&r.__esModule?r:{default:r};const s=document.documentElement,c=window.hasOwnProperty("BeforeInstallPromptEvent");let u;n.isSupportingBrowser=c;let l=!1,d=!1;n.installer=async(e=!1)=>{let t,n=[];const r=navigator.userAgent.includes("iPhone")||navigator.userAgent.includes("iPad")||navigator.userAgent.includes("Macintosh")&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2,h=()=>new Promise((e,t)=>{openModal=!1,e()});document.addEventListener("keyup",e=>{"Escape"===e.key&&h()});const f=async()=>{try{const n=await fetch(a.default),r=await n.json();if(t=r,r)return(e=r).icons&&e.icons[0]?e.name?e.description||console.error("Your web manifest must have a description listed"):console.error("Your web manifest must have a name listed"):console.error("Your web manifest must have atleast one icon listed"),r}catch(e){return console.error("Manifest could not be loaded",e),null}var e},p=async e=>{const p=c&&n.length<1&&(d||r);if(d&&"standalone"in navigator&&!1===navigator.standalone||p&&!1===l){await(async()=>{if(a.default)try{await f()}catch(e){console.error("Error getting manifest, check that you have a valid web manifest")}"getInstalledRelatedApps"in navigator&&(n=await navigator.getInstalledRelatedApps())})();s.classList.add((navigator.standalone?navigator.standalone:matchMedia("(display-mode: standalone)").matches)?"installed":"not-installed");const r=document.createElement("button");return r.classList.add("install-app"),r.setAttribute("aria-label",`Click to install ${t.short_name} V:${o.VERSION.replaceAll(".","-")} Date:${o.DATE}`),r.style.setProperty("--logo",`url(${t.icons[0].src})`),r.innerHTML="Install App",(0,i.addTooltip)(r),(0,i.setToast)("This App can be installed!<br> Click the orange button on the left"),r.addEventListener("click",async()=>{(0,i.setFeedback)("Installing",0);try{const e=await(async()=>new Promise(async(e,t)=>{if(u){u.prompt(),await h();"accepted"===(await u.userChoice).outcome?(console.log("Your PWA has been installed"),l=!0,e(!0)):(console.log("User chose to not install"),l=!1,e(!1))}else t("no prompt cached")}))();(0,i.setToast)(e?"The App was installed":"Maybe some other time"),e?document.querySelector(".install-app").style.display="none":r.classList.add("later")}catch(e){(0,i.setToast)("The App was not installed")}}),(e=e||s).appendChild(r),!0}return s.classList.add(l?"installed":"not-installed"),!1};return u||d||window.addEventListener("beforeinstallprompt",t=>{u=t,d=!0,t.preventDefault(),e||r||p()},{once:!0}),!e&&r&&window.addEventListener("load",async e=>{p()},{once:!0}),p},window.addEventListener("beforeinstallprompt",e=>{u=e,d=!0,e.preventDefault()},{once:!0})},{"./ui":"cc509f6dc4e34d6bd3c8d4b98935925a","./version":"25488683cc04bb43faf629e105172bc8","url:./manifest.webmanifest":"470e926bb1dc358c9c61323bc924e310"}],"470e926bb1dc358c9c61323bc924e310":[function(e,t,n){t.exports=e("./bundle-url").getBundleURL()+e("./relative-path")("f56c669d1026d19f","de0c4bbb21341183")},{"./bundle-url":"a079551cb6dc35425204fc0bb93fe7bb","./relative-path":"3d690079c6611245df705566cbbc1942"}],e59f0caf2dbfcd7176158aec09f980e0:[function(e,t,n){t.exports=e("./loaders/browser/js-loader")(e("./bundle-url").getBundleURL()+e("./relative-path")("f56c669d1026d19f","7a8ce0e9b4e134c6")).then(()=>parcelRequire("574e7470f109f5dcbd28638599bb738e"))},{"./loaders/browser/js-loader":"a9c840d63b072ad73ba68ab5bad5cba1","./bundle-url":"a079551cb6dc35425204fc0bb93fe7bb","./relative-path":"3d690079c6611245df705566cbbc1942"}],"590e4d478b3e99d42b27ee990cd750b8":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isVoiceActive=n.stopSpeaking=n.say=n.hasSpeech=void 0;const r=()=>"speechSynthesis"in window;n.hasSpeech=r;const i=async()=>new Promise((e,t)=>{let n;const r=Date.now(),i=()=>{if(n=window.speechSynthesis.getVoices(),n.length>0)e(n);else{Date.now()-r<1e4?setTimeout(i,0):t("No voices found")}};i()});n.say=async(e,t=!0,n=1,o=1,a=1,s,c)=>new Promise((u,l)=>{if(r){(async()=>{try{const r=(s&&c?await(async(e="en-US",t="Zira")=>{const n=i(),r=n.filter(n=>n.lang===e&&n.name.indexOf(t)>-1);return r.length<1?n:r})(s,c):await i())[0],d=new SpeechSynthesisUtterance;d.lang="en-US",d.voice=r,d.voiceURI="native",d.onend=e=>{d.onend=null,u(e)},d.onerror=e=>{l()},d.volume=n,d.rate=o,d.pitch=a,d.text=e,t&&window.speechSynthesis.cancel(),window.speechSynthesis.speak(d)}catch(e){l(e)}})()}else l("Speech tech not available")});n.stopSpeaking=()=>window.speechSynthesis.cancel();n.isVoiceActive=()=>window.speechSynthesis.pending},{}]},{},["5314fba19ae42fb7cd92712bb7180d1d","098cc988061dd902c257e1316c740bdd"]);
//# sourceMappingURL=source.2ce4a500.js.map
