!function(e,t,n,o,a){var s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r="function"==typeof s.parcelRequireaaed&&s.parcelRequireaaed,i=r.cache||{},l="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function c(t,n){if(!i[t]){if(!e[t]){var o="function"==typeof s.parcelRequireaaed&&s.parcelRequireaaed;if(!n&&o)return o(t,!0);if(r)return r(t,!0);if(l&&"string"==typeof t)return l(t);var a=new Error("Cannot find module '"+t+"'");throw a.code="MODULE_NOT_FOUND",a}u.resolve=function(n){var o=e[t][1][n];return null!=o?o:n},u.cache={};var d=i[t]=new c.Module(t);e[t][0].call(d.exports,u,d,d.exports,this)}return i[t].exports;function u(e){var t=u.resolve(e);return!1===t?{}:c(t)}}c.isParcelRequire=!0,c.Module=function(e){this.id=e,this.bundle=c,this.exports={}},c.modules=e,c.cache=i,c.parent=r,c.register=function(t,n){e[t]=[function(e,t){t.exports=n},{}]},Object.defineProperty(c,"root",{get:function(){return s.parcelRequireaaed}}),s.parcelRequireaaed=c;for(var d=0;d<t.length;d++)c(t[d])}({"3mTtx":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"createInterface",(()=>F));var a=e("./state"),s=e("./audio/speech"),r=e("./audio/recorder"),i=e("./audio/audio"),l=e("./audio/synthesizers"),c=e("./audio/midi-out"),d=e("./timing/timing.js"),u=e("./timing/patterns"),h=e("./dom/ui"),m=e("./inactivity"),p=o.interopDefault(m),g=e("./dom/dialog"),f=o.interopDefault(g),v=e("./dom/select"),b=e("./dom/toggle"),y=e("./dom/button"),x=e("./dom/text"),w=e("./dom/errors"),E=e("./dom/photographs"),T=e("./visual/canvas"),k=e("./visual/2d"),C=e("./visual/spectrograms"),I=e("./visual/quantise"),L=e("./visual/2d.stave"),S=(o.interopDefault(L),e("./location-handler")),D=e("./hardware/camera"),M=e("./maths/maths"),N=e("./person"),R=o.interopDefault(N),A=e("./settings"),j=e("./utils");let P=null;class B{constructor(){}toggleMute(){}pause(){}resume(){}}const F=(t,n,o,m="en-GB",g)=>new Promise(((L,F)=>{if(P)return L(P);const O=document.documentElement,$=document.querySelector("main");document.querySelector("img");let _,q,V,H,U,G;const W={},z={},Y=Object.assign({lastTime:-1,count:0},n.getItem("info"));f.default();let K=a.loadState(t,$);const{isRecording:Q,startRecording:J,stopRecording:X}=r.record(),Z=[];let ee,te,ne,oe,ae,se,re,ie,le,ce,de=h.video,ue=!0,he=!1,me=!1,pe=!1,ge=!0,fe=!1,ve=!1,be=0;const ye={lag:0,drift:0},xe={x:1,y:1},we=e=>{K.speak&&s.hasSpeech()&&s.say(e,!0)},Ee=e=>(e=>{d.setTimeBetween(e);const t=d.getBPM();return x.setToast(`Tempo : Period set at ${Math.ceil(e)} ms between bars / ${Math.ceil(t)}BPM`),n.setItem("tempo",{period:e,bpm:t}),e})(6e4/e),Te=async(e,t)=>Z.map((async n=>{const o=await n[e](t);return x.setToast(`${n.name} has ${n.instrumentTitle} loaded`),o})),ke=async e=>await Te("loadRandomInstrument",e),Ce=e=>{if(null==Z[e]){const t=((e,t)=>{K.duet;const o={dots:t,leftEyeIris:t,rightEyeIris:t,hue:360*Math.random(),debug:K.debug,photoSensitive:K.photoSensitive,instrumentPack:K.instrumentPack,stereoPan:K.stereo,drawMask:K.masks,drawEyes:K.eyes},a=n.has(e)?n.getItem(e):{},s=Object.assign({},o,a),r=new R.default(e,i.audioContext,ne,s),l=a.instrument||i.randomInstrument();return r.button.addEventListener(N.EVENT_INSTRUMENT_CHANGED,(({detail:t})=>{n.setItem(e,{instrument:t.instrumentName}),x.setToast(`${t.instrument.title} Loaded`)})),r.loadInstrument(l,(e=>{})),r})(A.NAMES[e],N.EYE_COLOURS[e]);return Z.push(t),t}return Z[e]},Ie=(e,t)=>{Z.forEach((n=>{n.options[e]=t}))},Le=e=>{const t=Array.isArray(e);Z.forEach(((n,o)=>{const a=t?e[o]:e;n.options={...n.options,...a}}))},Se=(e=0,t=[],n=0)=>{const o=Ce(e),a=t[e<t.length?e:0];return a?(o.setMIDI(a,n),console.info(K.midiChannel,o.hasMIDI?"Replacing":"Enabling",`MIDI #${n} for ${o.name}`,{ui:K,port:a,midiDevices:t,personIndex:e,midiChannel:n},oe.outputs[n])):console.error("No matching MIDI Instrument",K.midiChannel,o.hasMIDI?"Enabling":"Disabling",`MIDI #${n} for ${o.name}`,{ui:K,port:a,portIndex:n},oe.outputs[n]),a},De=e=>{const t=e.length;if(t>0){let n=`MIDI : <br>${e.map((e=>e.name||"MIDI Instrument")).join("<br>")}`;Z.forEach(((t,n)=>Se(n,e,K.midiChannel))),$.classList.toggle("midi-no-devices",!1),$.classList.toggle("midi-connected",!0),$.classList.toggle(`midi-devices-${t}`,!0),$.classList.remove("midi-unavailable"),x.setToast(n),ae.setText("<span class='hide-text'>Click to </span>Disable"),ae.setLabel(n)}else x.setFeedback(pe?"Lost MIDI Device connection":"MIDI Available but no instruments detected",0),x.setToast("No MIDI Devices connected"),$.classList.toggle("midi-no-devices",!0),$.classList.toggle("midi-connected",!1)},Me=async()=>(ae=y.setupMIDIButton(document.getElementById("button-midi"),(async e=>(await(async()=>{try{oe=await c.setupMIDI(),oe.addListener("connected",(e=>De(oe.outputs))),oe.addListener("disconnected",(e=>De(oe.outputs))),De(oe.outputs),pe=oe&&oe.outputs,$.classList.add("midi-available")}catch(e){return console.error("Total MIDI failure",e),x.setFeedback("MIDI NOT Available<br>"+e,0),$.classList.add("midi-unavailable"),!1}return!0})(),x.setFeedback("MIDI available<br>Connecting to instruments...",0),$.classList.add("midi-activated"),!1))),!0),Ne=()=>{let e="";window.addEventListener("keydown",(async t=>{const n=!isNaN(parseInt(t.key));switch(t.key){case"CapsLock":a.setState("debug",!K.debug),Z.forEach((e=>e.debug=K.debug)),x.setToast(`DEBUG : ${K.debug}`),we(K.debug?"secret mode unlocked":"disabling developer mode");break;case"Space":ke();break;case"QuestionMark":case"?":we(document.getElementById("toast").innerText);break;case"A":case"J":(async e=>{await Te("loadPreviousInstrument",e)})();break;case"D":case"L":(async e=>{await Te("loadNextInstrument",e)})();break;case"ArrowLeft":Ee(d.getBPM()-10);break;case"ArrowRight":Ee(d.getBPM()+10);break;case"ArrowUp":let e=d.getBars()+1,t=d.setBars(e);d.setTimeBetween(d.timePerBar()),x.setToast(`Bars : ${t} / BPM : ${d.getBPM()}`);break;case"ArrowDown":let n=d.getBars()-1,o=d.setBars(n);d.setTimeBetween(d.timePerBar()),x.setToast(`Bars ${o} / BPM : ${d.getBPM()}`);break;case",":k.setNodeCount(-1);break;case".":k.setNodeCount(1);break;case"a":ie.kick();break;case"b":a.setState("backingTrack",!K.backingTrack,W),x.setToast(K.backingTrack?"Backing track starting":"Ending Backing Track");break;case"c":a.setState("clear",!K.clear,W);break;case"d":ie.hat();break;case"e":ie.clack();break;case"f":h.toggleVisibility(h.controlPanel);break;case"g":const s=h.toggleVisibility(document.getElementById("feedback"));h.toggleVisibility(document.getElementById("toast")),K.text=s;break;case"h":h.toggleVisibility(T.canvas);break;case"i":const r=await i.setReverb();x.setToast(`Reverb : '${r}' loaded`);break;case"j":case"v":h.toggleVisibility(h.video);break;case"k":case"Tab":break;case"l":a.setState("speak",!K.speak,W),x.setToast(K.speak?"Reading out instructions":"Staying quiet");break;case"m":a.setState("metronome",!K.metronome,W),x.setToast(K.metronome?"Quantised enabled":"Quantise disabled");break;case"q":a.setState("muted",!K.muted,W);break;case"r":Q()?(console.error("Recording END",ce),x.setToast("Recording Ended - now encoding"),X().then((e=>{const t=encodeRecording(e,"audio/mp3;"),n=window.URL.createObjectURL(t);console.error("Recording END",{recording:e,audioSrc:n,mp3:t})}))):(x.setToast("Recording START"),console.error("Recording START",ne),ce=await J(ne),console.error("Recording...",ce));break;case"s":ie.snare();break;case"t":a.setState("text",!K.text,W);break;case"w":ie.cowbell();break;case"x":const l=d.tapTempo();l>1&&Ee(l);break;case"z":be=0}if(n){if(e+=t.key,3===e.length){const t=parseFloat(e);Ee(t),e=""}}else e="";S.addToHistory(K,t.key)}))},Re=async(e,t,s)=>{let r=0;O.classList.toggle("initialising",!0);try{if(x.setFeedback("Setting things up...<br>This can take a while!"),s(r++/7,"Setting things up..."),document.querySelector("img")&&(x.setFeedback("Image downloaded...<br> Please wait"),te=await k.setupImage(document.querySelector("img"))),s(r++/7,"Looking for cameras"),h.video){x.setFeedback("Attempting to locate a camera...<br>Please click accept if you are prompted"),s(r/7,"Looking for cameras...");const e=await D.findBestCamera(n,h.video),{videoCameraDevices:t}=e;ee=e.camera,ge=!1;s(r/7,e.saved?"Found saved camera":t.length>1?"Located a Camera but you can change it in Settings > Camera":"Located front facing camera"),t.length>1&&(h.setupCameraForm(t,(async e=>{ge=!0,ee=await D.loadCamera(h.video,e.value,e.label),ge=!1,n.setItem("camera",{deviceId:e.value}),x.setToast(`Camera ${e.label} changed`,0)})),$.classList.toggle("multiple-cameras",!0)),s(r++/7,"Camera connected")}$.style.setProperty("--width",h.video.width),$.style.setProperty("--height",h.video.height),$.classList.toggle("landscape",h.video.width>h.video.height),$.classList.toggle("portrait",h.video.width<h.video.height),$.classList.toggle("square",h.video.width===h.video.height),T.updateCanvasSize(h.video.width,h.video.height),s(r++/7)}catch(e){const t=String(e).replace("NotAllowedError: ","");return x.setFeedback(`Camera could not be accessed<br><strong>${t}</strong>`,0),x.setToast(t),s(r++/7,t),ue=!1,me=!0,U("Camera Rejected or Not allowed"),F(t)}try{const e=n.getItem("audio"),t=e?e.volume:1;ne=await i.setupAudio(),(e=>{const t=i.setVolume(e);n.setItem("audio",{volume:t}),x.setToast(`Volume ${Math.ceil(100*t)}%`,0)})(t),s(r++/7),ie=l.createDrumkit(),le=u.kitSequence(),s(r++/7,"Audio available...<br>Instrument Sounds ready")}catch(e){return me=!0,void x.setFeedback("Something went wrong with the Audio<br>"+e,0)}if(o.webMIDIAvailable){try{await Me()?$.classList.add("midi"):($.classList.add("midi","no-instrument"),x.setFeedback("MIDI available<br>Connect a MIDI instrument <strong>and click the button</strong>",0))}catch(e){console.log("no MIDI!",e),$.classList.add("no-midi"),$.classList.add("midi-unavailable"),x.setFeedback("MIDI unavailable, or no instrument connected<br>"+e,0)}s(r++/7,"MIDI Located")}else s(r++/7),$.classList.add("midi-unavailable"),x.setFeedback("MIDI is not available in this browser,<br>It'll work better in Brave, Edge or Chrome",0);T.canvas.width=de.width,T.canvas.height=de.height,x.addToolTips(h.controlPanel);const c=n.getItem("audio")?parseFloat(n.getItem("audio").volume):1;i.setVolume(c>0?c:1),s(r++/7),$.classList.add(de.nodeName.toLowerCase()),O.classList.toggle("initialising",!1);e(de===h.video,(e=>{if(be++,ue&&(ue=!1),ge)return;let t="";if(K.clear)T.clear(),K.transparent||T.drawElement(de);else{const e=.01*be%M.TAU;T.overdraw(-7*xe.x+Math.sin(e),-4*xe.y+Math.cos(e))}K.quantise&&I.drawQuantise(he,d.getBar(),d.getBars()),K.spectrogram&&(i.updateByteFrequencyData(),C.drawBars(i.dataArray,i.bufferLength));let n=!1;if(e){for(let o=0,a=e.length;o<a;++o){const a=e[o],s=Ce(o);if(!(a&&a.faceInViewConfidence>.9))return void(fe||($.classList.toggle(`${s.name}-active`,!1),$.classList.toggle("no-faces",!0),fe=!0));if(fe&&(fe=!1,$.classList.toggle(`${s.name}-active`,!0),$.classList.toggle("no-faces",!1)),ve=!0,n=!0,s.update(a),s.draw(a,K.text,!1,he),!K.quantise&&!K.muted){const e=s.sing();s.singing,0===o&&(xe.x=e.eyeDirection,xe.y=e.pitch)}t+=`<br>PITCH:${a.pitch} ROLL:${a.roll} YAW:${a.yaw} MOUTH:${Math.ceil(100*a.mouthRange)}%`}n||x.setFeedback(q(Math.floor(be/100)))}e?x.setFeedback(_(Math.floor(be/100))):x.setFeedback(q(Math.floor(be/100))),he&&(he=!1)}),(()=>!ge)),se=d.startTimer((e=>{const{bar:t,bars:n,barsElapsed:o,timePassed:a,elapsed:s,expected:r,drift:i,level:l,intervals:c,lag:d}=e;if(ye.lag=d,ye.drift=i,!K.muted){if(K.metronome&&n){const e=.1;ie.clack(e,n%4==0?.2:.1)}if(K.quantise)for(let e=0,t=Z.length;e<t;++e){const t=Ce(e).sing();0===e&&(xe.x=t.eyeDirection,xe.y=t.pitch)}if(K.backingTrack&&t%2==0){u.playNextPart(le.kick,ie.kick),u.playNextPart(le.snare,ie.snare),u.playNextPart(le.hat,ie.hat)}he=!0}}),d.convertBPMToPeriod(a.getState("bpm")))};g&&g(0,"Loading... Please wait");let Ae=!1;const je=async()=>{if(!Ae){Ae=!0;try{await e("291d845354e64b3")}catch(e){O.classList.add("sharing-disabled")}}},Pe=e=>{const t=new B;return t.data={...e},P=t,P},Be=async()=>{ue?requestAnimationFrame(Be):me?(O.classList.add("failure"),y.showReloadButton()):(async()=>{const e=()=>{if(ve)return we("Hello! Open your mouth to begin!"),O.classList.toggle("searching-for-user",!1),Ce(0);requestAnimationFrame(e)};O.classList.toggle("loading",!1),O.classList.toggle("loaded",!0),Ne(),O.classList.toggle("searching-for-user",!0),we("I am looking for your face"),await e(),g&&g(1,"complete"),L(Pe({language:m,...K,...Y}))})()},Fe=Object.assign({},A.DEFAULT_TENSORFLOW_OPTIONS,{maxFaces:K.duet?2:1});(async(n,o)=>{let s,r,l=0;if(o(l++/5,"Loading Brains"),"body"===n.model){const{loadBodyModel:t}=await e("c52ef74ae666eaee");s=t,o(l++/5,"Loaded Body Brain")}else{const{loadFaceModel:t}=await e("b838839343e27799");s=t,o(l++/5,"Loaded Face Brain")}h.setupInterface(K),o(l++/5,"Connecting wires"),W.quantise=b.setToggle("button-quantise",(e=>{a.setState("quantise",e),x.setToast("Quantise "+(K.quantise?"enabled":"disabled"))}),K.quantise),W.settings=b.setToggle("button-settings",(e=>{a.setState("showSettings",e),x.setToast("Settings "+(e?"enabled":"disabled"))}),K.showSettings),W.metronome=b.setToggle("button-metronome",(e=>{a.setState("metronome",e),x.setToast("Metronome "+(K.metronome?"enabled":"disabled"))}),K.metronome),W.backingTrack=b.setToggle("button-percussion",(e=>{a.setState("backingTrack",e),x.setToast(K.backingTrack?"Backing track starting":"Ending Backing Track")}),K.backingTrack),W.spectrogram=b.setToggle("button-spectrogram",(e=>{a.setState("spectrogram",e),x.setToast("Spectrogram "+(K.spectrogram?"enabled":"disabled"))}),K.spectrogram),W.speak=b.setToggle("button-speak",(e=>{a.setState("speak",e),x.setToast("Speaking "+(K.speak?"enabled":"disabled"))}),K.speak),W.transparent=b.setToggle("button-transparent",(e=>{a.setState("transparent",!e),x.setToast("Video Synch "+(K.spectrogram?"enabled":"disabled"))}),K.transparent),W.clear=b.setToggle("button-clear",(e=>{a.setState("clear",e)}),K.clear),W.muted=b.setToggle("button-mute",(e=>{a.setState("muted",!K.muted),x.setToast(K.muted?"Volume Muted":"Unmuted")}),K.muted),W.disco=b.setToggle("button-disco",(e=>{var t;a.setState("masks",e),e?(K.clear=!1,t=["drawMask","drawNodes","drawMesh","meshOnSing"],r=Z.map((e=>t.reduce(((t,n,o,a)=>(t[n]=e.options[n],t)),{}))),Le({drawMask:!0,drawNodes:!1,drawMesh:!1,meshOnSing:!0}),x.setToast("Disco mode enabled!")):(K.clear=!0,Le(r),r=null,x.setToast("Disco mode disabled!"))}),K.masks),W.masks=b.setToggle("button-meshes",(e=>{a.setState("masks",!K.masks),Ie("drawMask",K.masks)}),K.masks),W.eyes=b.setToggle("button-eyes",(e=>{a.setState("eyes",!K.eyes),Ie("drawEyes",K.eyes)}),K.eyes),W.overlay=b.setToggle("button-overlay",(e=>{h.toggleVideoVisiblity(!h.isVideoVisible())})),W.text=b.setToggle("button-subtitles",(e=>{a.setState("text",!K.text)})),y.setButton("button-photograph",(e=>{E.appendPhotographElement(),x.setToast("Photograph taken!")})),y.setButton("button-video",(e=>ke())),y.setButton("button-reset",(e=>{K={...t},a.refreshState()})),z.tempo=v.connectSelect("select-tempo",(e=>{const t=parseInt(e.innerHTML);h.updateTempo(t),Ee(t)})),z.eyes=v.connectSelect("select-eyes",(e=>{const t=e.value.split(","),n=j.convertOptionToObject(t);Le({scleraRadius:n.s,irisRadius:n.i,pupilRadius:n.p,eyeRatio:n.a||1})})),z.samples=v.connectSelect("select-samples",(async e=>{const t=e.value;Le({instrumentPack:t});await(async e=>await Te("reloadInstrument",e))();a.setState("instrumentPack",t)})),z.palette=v.connectSelect("select-palette",(e=>{const t=e.value.split(","),n=j.convertOptionToObject(t);Le({saturation:n.s,luminosity:n.l})})),z.reverbs=v.connectReverbControls((async e=>{if(e&&e.value){const t=e.value;await i.setReverb(t)}else console.error(e,e.previousSibling)}));const c=document.getElementById("link-about");j.addMouseTapAndHoldEvents(c),c.addEventListener(j.MOUSE_TAP,(e=>{})),c.addEventListener(j.MOUSE_HELD,(e=>{}));try{const t=await e("51b3d1b8e3dd2c6d");_=t.getInstruction,q=t.getHelp,o(l++/5,"Instructions Found")}catch(e){_=q=e=>"",o(l++/5,"Instructions failed to load")}try{const t=await e("d8218bc35811cd48");V=t.setupReporting,H=t.track,U=t.trackError,G=t.trackExit,re=V("InterFACE"),o(l++/5,"Reporter assigned")}catch(e){o(l++/5,"Reporting blocked")}return a.refreshState(),o(l++/5,"Assembled!"),s(de,n)})(Fe,((e,t)=>{g&&g(e,t)})).then((async e=>{x.setFeedback(""),x.setToast(""),O.classList.toggle("loading",!1),requestAnimationFrame(je);let t=setTimeout((()=>{x.setToast("Please select how many players you want to play"),t=setTimeout((()=>x.setToast("by clicking either button")),15e3)}),6e4);try{const{players:e,advancedMode:t}=await h.showPlayerSelector(Fe);a.setState("duet",e>1),a.setState("advancedMode",t)}catch(e){console.error("player selection failed",e)}return clearInterval(t),O.classList.toggle("loading",!0),x.setToast(""),Re(e,0,((e,t)=>{g&&g(e,t)}))})).then((e=>{h.focusApp()})).catch((e=>{w.showError(e,"Try hard refresh")})),Be(),o.mouse&&p.default(document.getElementById("button-video"),(function(){O.classList.toggle("user-active",!0),O.classList.toggle("user-inactive",!1)}),(function(){O.classList.toggle("user-active",!1),O.classList.toggle("user-inactive",!0)})),window.onbeforeunload=()=>{const e=Object.assign({},Y,{lastTime:Date.now(),count:Y.count++});n.setItem("info",e),G(),x.setToast("bye bye!"),x.setFeedback("<strong>I hope you had fun!</strong>")},window.oncontextmenu=()=>{be=0},window.addEventListener("popstate",(e=>{}))}))},{"./state":"8OFN5","./audio/speech":"8DrPb","./audio/recorder":"hVk2E","./audio/audio":"kGLQw","./audio/synthesizers":"aonYx","./audio/midi-out":"ce9G1","./timing/timing.js":"adRuD","./timing/patterns":"4s9sC","./dom/ui":"dAURW","./inactivity":"i5you","./dom/dialog":"l66Iq","./dom/select":"cBFxP","./dom/toggle":"f71P0","./dom/button":"6WDhH","./dom/text":"cwBIr","./dom/errors":"9dSnZ","./dom/photographs":"h5wXQ","./visual/canvas":"2h2QK","./visual/2d":"2Ac2W","./visual/spectrograms":"ZL00j","./visual/quantise":"2HWvY","./visual/2d.stave":"3T44M","./location-handler":"6ch5Y","./hardware/camera":"6WcRe","./maths/maths":"iDBHd","./person":"iikaL","./settings":"h7RGC","./utils":"9g7cm",c52ef74ae666eaee:"cy5zR",b838839343e27799:"bqoAJ","51b3d1b8e3dd2c6d":"hZVlD",d8218bc35811cd48:"lXYFz","291d845354e64b3":"lzm9X","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"8OFN5":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"getState",(()=>l)),o.export(n,"createState",(()=>c)),o.export(n,"loadState",(()=>d)),o.export(n,"refreshState",(()=>u)),o.export(n,"setState",(()=>h));var a=e("./location-handler");let s,r=null;const i=(e,t)=>{s.classList.toggle(`flag-${e}`,t)},l=e=>e?r[e]:r,c=(e,t)=>(r=Object.assign({},e),s=t||document.documentElement,r),d=(e,t)=>c(a.getLocationSettings(e),t),u=()=>(Object.entries(r).forEach((([e,t])=>{i(e,t)})),r),h=(e,t,n=null,o=!0)=>(r[e]=t,o&&a.addToHistory(r,e),i(e,t),n&&n[e]&&(n[e].setAttribute("checked",t),"LABEL"===n[e].parentNode.nodeName&&n[e].parentNode.classList.toggle("checked",t)),r)},{"./location-handler":"6ch5Y","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"8DrPb":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"hasSpeech",(()=>a)),o.export(n,"say",(()=>r)),o.export(n,"stopSpeaking",(()=>i)),o.export(n,"isVoiceActive",(()=>l));const a=()=>"speechSynthesis"in window,s=async()=>new Promise(((e,t)=>{let n;const o=Date.now(),a=()=>{if(n=window.speechSynthesis.getVoices(),n.length>0)e(n);else{Date.now()-o<1e4?setTimeout(a,0):t("No voices found")}};a()})),r=async(e,t=!0,n=1,o=1,r=1,i,l)=>new Promise(((c,d)=>{if(a){const a=async()=>{try{const a=i&&l?await(async(e="en-US",t="Zira")=>{const n=s(),o=n.filter((n=>n.lang===e&&n.name.indexOf(t)>-1));return o.length<1?n:o})(i,l):await s(),u=a[0],h=new SpeechSynthesisUtterance;h.lang="en-US",h.voice=u,h.voiceURI="native",h.onend=e=>{h.onend=null,c(e)},h.onerror=e=>{d()},h.volume=n,h.rate=o,h.pitch=r,h.text=e,t&&window.speechSynthesis.cancel(),window.speechSynthesis.speak(h)}catch(e){d(e)}};a()}else d("Speech tech not available")})),i=()=>window.speechSynthesis.cancel(),l=()=>window.speechSynthesis.pending},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],hVk2E:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"record",(()=>a));const a=e=>{let t,n=!1;return{isAvailable:()=>!!(window&&window.MediaRecorder&&"function"==typeof window.MediaRecorder.isTypeSupported&&window.Blob),downloadRecording:()=>{var e=new Blob(recordedChunks,{type:"video/webm"}),t=URL.createObjectURL(e),n=document.createElement("a");document.body.appendChild(n),n.style="display: none",n.href=t,n.download="test.webm",n.click(),window.URL.revokeObjectURL(t)},encodeRecording:(e,t="audio/mp3;")=>new Blob(e,{type:t}),startRecording:e=>new Promise(((o,a)=>{if(n)return a("already recording");t=[],mediaRecorder=new MediaRecorder(e),mediaRecorder.ondataavailable=n=>{t.push(n.data),o({mediaRecorder:mediaRecorder,dataArray:t,stream:e})},mediaRecorder.onwarning=function(e){console.log("onwarning fired")},mediaRecorder.onerror=e=>{switch(console.log("onerror fired"),e.name){case"InvalidState":case"OutOfMemory":case"IllegalStreamModification":case"OtherRecordingError":case"GenericError":break;default:console.error("MediaRecorder Error",e)}},mediaRecorder.start(),n=!0})),stopRecording:()=>new Promise(((e,o)=>{if(!n)return o("Not recording");mediaRecorder.onstop=o=>{n=!1,e(t)},mediaRecorder.stop()})),isRecording:()=>n}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],kGLQw:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"audioContext",(()=>u)),o.export(n,"bufferLength",(()=>h)),o.export(n,"dataArray",(()=>m)),o.export(n,"playing",(()=>b)),o.export(n,"active",(()=>y)),o.export(n,"randomInstrument",(()=>x)),o.export(n,"chooseFilters",(()=>w)),o.export(n,"setReverb",(()=>T)),o.export(n,"setupAudio",(()=>k)),o.export(n,"updateByteFrequencyData",(()=>C)),o.export(n,"updateByteTimeDomainData",(()=>I)),o.export(n,"stopAudio",(()=>S)),o.export(n,"playAudio",(()=>D)),o.export(n,"createOscillator",(()=>M)),o.export(n,"setShape",(()=>N)),o.export(n,"setFrequency",(()=>R)),o.export(n,"getVolume",(()=>A)),o.export(n,"setVolume",(()=>j)),o.export(n,"loadAudio",(()=>P)),o.export(n,"playTrack",(()=>B)),o.export(n,"loadInstrumentParts",(()=>F)),o.export(n,"loadInstrumentPack",(()=>O));e("../maths/maths");var a=e("./instruments"),s=e("./rack"),r=e("./effects/reverb"),i=(e("./effects/delay"),e("./effects/dub"),e("./effects/compressor")),l=e("./effects/distortion"),c=e("./effects/amplitude"),d=e("./notes");let u,h,m,p,g,f,v,b=!1,y=!1;const x=()=>a.INSTRUMENT_FOLDERS[Math.floor(Math.random()*a.INSTRUMENT_FOLDERS.length)],w=async e=>s.chain([v,await i.createCompressor(u),await l.createDistortion(u)],u),E={reverb:.1,normalise:!0,smoothingTimeConstant:.45},T=async e=>{const t=e||await r.randomReverb();return f.impulseFilter(t)},k=async e=>{const t=Object.assign({},E,e);return u=new(window.AudioContext||window.webkitAudioContext),v=await c.createAmplitude(u,1),f=await r.createReverb(u,t.reverb,t.normalise),g=u.createAnalyser(),g.minDecibels=-90,g.maxDecibels=-10,g.smoothingTimeConstant=t.smoothingTimeConstant,h=g.frequencyBinCount,m=new Uint8Array(h),s.chain([v,f,g],u)},C=()=>{g.fftSize=2048,g.getByteFrequencyData(m),h=g.frequencyBinCount},I=()=>{g.fftSize=256,g.getByteTimeDomainData(m),h=g.frequencyBinCount},L=()=>{const e=requestAnimationFrame(L);return g.getByteFrequencyData(m),e},S=()=>!!b&&(b=!1,!0),D=()=>!b&&("suspended"===u.state&&u.resume(),b=!0,L(),!0),M=()=>{},N=e=>{p.type=e},R=e=>{p.frequency.value=e},A=()=>v.volume(),j=e=>v.volume(e),P=async e=>{const t=await fetch(e),n=await t.arrayBuffer();return await u.decodeAudioData(n)},B=(e,t=0,n=delayNode,o={loop:!1})=>new Promise(((a,s)=>{const r=u.createBufferSource();r.buffer=e,r.loop=o.loop,r.connect(n),r.onended=()=>{r.disconnect(),y=!1,a()},r.onerror=e=>{r.disconnect(),y=!1,s(e)},"suspended"===u.state&&u.resume(),0==t?r.start():r.start(0,u.currentTime-t),y=!0}));const F=(e="alto_sax-mp3",t="FluidR3_GM")=>{const n=`${t}/${e}`;return d.createInstrumentBanks().map((e=>P(`./assets/audio/${n}/${e}`)))},O=async(e="alto_sax-mp3",t="FluidR3_GM",n)=>{const o={title:a.cleanTitle(e),name:e},s=await Promise.all(F(e,t));return d.NOTE_NAMES.forEach(((e,t)=>{o[e.split(".")[0]]=s[t]})),o}},{"../maths/maths":"iDBHd","./instruments":"ftlvJ","./rack":"bgac0","./effects/reverb":"7szM4","./effects/delay":"dwS9E","./effects/dub":"d9jC2","./effects/compressor":"2ANWD","./effects/distortion":"fknul","./effects/amplitude":"drp0R","./notes":"5HewV","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],iDBHd:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"TAU",(()=>a)),o.export(n,"HALF_PI",(()=>s)),o.export(n,"rescale",(()=>d)),o.export(n,"determineAngle",(()=>u)),o.export(n,"distanceBetween2Points",(()=>h)),o.export(n,"distanceBetween3Points",(()=>m)),o.export(n,"distance3D",(()=>p)),o.export(n,"distance2D",(()=>g)),o.export(n,"lerp",(()=>f)),o.export(n,"clamp",(()=>v)),o.export(n,"twist",(()=>b));const a=2*Math.PI,s=.5*Math.PI,{PI:r,sqrt:i,atan2:l,tan:c}=Math,d=(e,t=1)=>{const n=1/(t-e);return t=>n*(t-e)},u=(e,t)=>{const n=e[1]-t[1],o=t[0]-e[0];return l(n,o)},h=(e,t)=>i((e[0]-t[0])**2+(e[1]-t[1])**2),m=(e,t)=>i((e[0]-t[0])**2+(e[1]-t[1])**2+(e[2]-t[2])**2),p=(e,t,n,o,a,s)=>i((e-t)**2+(n-o)**2+(a-s)**2),g=(e,t,n,o)=>i((e-t)**2+(n-o)**2),f=(e,t,n)=>(1-n)*e+n*t,v=(e,t,n)=>e>n?n:e<t?t:e,b=(e,t=0)=>v((e=e<0?-1*(e+1):1-e)+t,-1,1)},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],bgac0:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"inputNode",(()=>l)),o.export(n,"inputDryNode",(()=>c)),o.export(n,"resolveRoute",(()=>d)),o.export(n,"chain",(()=>u)),o.export(n,"removeLink",(()=>h)),o.export(n,"unchain",(()=>m));let a=null,s=null,r=null,i=null;const l=()=>a.name?a.node:a,c=()=>s,d=e=>e.name?e.node:e,u=(e,t=null)=>{m();const n=e.length;if(n>1)for(let t=1;t<n;++t){const o=d(e[t-1]),r=d(e[t]);o.connect(r),1===t&&(a=o),t===n-1&&(s=r)}else a=s=d(e[0]);return t&&s.connect(t.destination),r=e,i=t,a},h=e=>{},m=()=>{if(r&&i){const e=r.length;if(e>1)for(let t=1;t<e;++t){const e=d(routes[t-1]),n=d(routes[t]);e.disconnect(n)}s.disconnect(audioContext.destination)}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"7szM4":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"DIRS",(()=>s)),o.export(n,"REVERB_PATHS",(()=>c)),o.export(n,"loadImpulseJSON",(()=>u)),o.export(n,"loadImpulseList",(()=>h)),o.export(n,"getImpulseList",(()=>m)),o.export(n,"randomReverb",(()=>p)),o.export(n,"createReverb",(()=>g));var a=e("./effect");const s=["EMT140-Plate","Voxengo"],r="sampled.instrument.json";let i;const l="./assets/audio/acoustics/",c=s.map((e=>`${l}${e}/${r}`)),d={},u=async e=>{if(d[e])return d[e];const t=await fetch(`${l}${e}/${r}`),n=await t.json();return d[e]=n.files.map((t=>`${l}${e}/${t}`)),d[e]},h=async(e=s)=>{const t=e.map((async e=>{const t=await u(e,e);return console.error(t,e),t})),n=[].concat(...t);return console.error(e,t,n),n},m=async()=>{if(i)return i;try{return i=await h(),i}catch(e){console.error({impulses:i})}},p=async()=>{try{const e=await m();return e[Math.ceil((e.length-1)*Math.random())]}catch(e){throw Error("Random reverb failed to fetch list"+e)}},g=async(e,t=.4,n=!0,o="./assets/audio/acoustics/ir-hall.mp3")=>{const s=async t=>{const n=await fetch(t),o=await n.arrayBuffer();return await e.decodeAudioData(o)},r=new DynamicsCompressorNode(e),i=new GainNode(e,{gain:t}),l=e.createConvolver();return l.buffer=await s(o),l.normalize=n,r.connect(e.destination),r.connect(l),l.connect(i).connect(e.destination),{name:"reverb",node:l,impulseFilter:async e=>(l.buffer=await s(e),l.normalize=n,e),gain:e=>a.changeParameter(i,"gain",e)}}},{"./effect":"h3z6p","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],h3z6p:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"changeParameter",(()=>a));const a=(e,t,n)=>(n&&(e[t]=n),n??e[t])},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],dwS9E:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"createDelay",(()=>s));var a=e("./effect");const s=async(e,t=.05,n=.4)=>{const o=e.createDelay(t),s=e.createGain(n);return s.gain.value=n,s.connect(o),o.connect(e.destination),{name:"delay",node:s,feedback:e=>a.changeParameter(s,"gain",e),delayTime:e=>a.changeParameter(o,"delayTime",e)}}},{"./effect":"h3z6p","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],d9jC2:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"createDub",(()=>s));var a=e("./effect");const s=async(e,t=.5,n=.4,o=1e3,s=2.5)=>{const r=e.createDelay(s);r.delayTime.value=t;const i=e.createGain();i.gain.value=n;const l=e.createBiquadFilter();return l.frequency.value=o,r.connect(i),i.connect(l),l.connect(r),{name:"dub",node:r,delayTime:e=>a.changeParameter(r,"delayTime",e),feedback:e=>a.changeParameter(i,"gain",e),filter:e=>a.changeParameter(l,"frequency",e)}}},{"./effect":"h3z6p","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"2ANWD":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"createCompressor",(()=>s));var a=e("./effect");const s=async(e,t=-70,n=40,o=5,s=0,r=.5,i=0)=>{const l=e.createDynamicsCompressor();return l.threshold.value=t,l.knee.value=n,l.ratio.value=o,l.attack.value=s,l.release.value=r,{name:"compressor",node:l,knee:e=>a.changeParameter(l,"knee",e),threshold:e=>a.changeParameter(l,"threshold",e),ratio:e=>a.changeParameter(l,"ratio",e),attack:e=>a.changeParameter(l,"attack",e),release:e=>a.changeParameter(l,"release",e)}}},{"./effect":"h3z6p","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],fknul:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"createDistortion",(()=>s));e("./effect");function a(e){for(var t,n="number"==typeof e?e:50,o=44100,a=new Float32Array(o),s=Math.PI/180,r=0;r<o;++r)t=2*r/o-1,a[r]=(3+n)*t*20*s/(Math.PI+n*Math.abs(t));return a}const s=async(e,t=1,n="4x")=>{const o=e.createWaveShaper();return o.oversample=n,o.curve=a(t),{name:"distortion",node:o,curve:e=>o.curve=a(e),oversample:e=>o.oversample=e}}},{"./effect":"h3z6p","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],drp0R:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"createAmplitude",(()=>s));var a=e("../../maths/maths");const s=async(e,t=1,n=!1)=>{const o=e.createGain(),s=t=>{const n=o.gain.value,a=n+.1*(t-n);return o.gain.value.setValueAtTime(t,e.currentTime),n===t||requestAnimationFrame(s),a},r=e=>{n?s():o.gain.value=a.clamp(t,0,1)};return r(),{name:"amplitude",node:o,volume:e=>e?(r(),e):o.gain.value}}},{"../../maths/maths":"iDBHd","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"5HewV":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"BANKS",(()=>s)),o.export(n,"NOTES_BLACK",(()=>r)),o.export(n,"NOTES_WHITE",(()=>i)),o.export(n,"NOTES_BLACK_INDEXES",(()=>l)),o.export(n,"NOTES_WHITE_INDEXES",(()=>c)),o.export(n,"SOLFEGE_SCALE",(()=>d)),o.export(n,"createInstrumentBanks",(()=>u)),o.export(n,"NOTE_NAMES",(()=>h)),o.export(n,"NOTE_NAMES_FRIENDLY",(()=>m)),o.export(n,"getNoteSound",(()=>p)),o.export(n,"getNoteText",(()=>g)),o.export(n,"getNoteName",(()=>f));var a=e("../maths/maths");const s=["A","Ab","B","Bb","C","D","Db","E","Eb","F","G","Gb"],r=["Ab","Bb","Db","Eb","Gb"],i=["A","B","C","D","E","F","G"],l=r.length-1,c=i.length-1,d=["Doe","Ray","Me","Far","Sew","La","Tea"],u=(e="mp3",t=".")=>{const n=[];for(let o=0;o<s.length;++o){const a=s[o];"A"===a&&n.push(`A0${t}${e}`);for(let o=1;o<8;++o)n.push(`${a}${o}${t}${e}`);"C"===a&&n.push(`C8${t}${e}`)}return n},h=u("",""),m={};h.forEach((e=>{m[e]=e}));const p=(e,t=!1)=>d[Math.floor(e*(d.length-1))],g=e=>{const t=e.charAt(0);let n;return 3===e.length?(n=parseInt(e.charAt(2))+1,`${t}#${n}`):(n=parseInt(e.charAt(1))+1,`${t}${n}`)},f=(e,t=3,n=!1)=>{let o,s;return n?(o=Math.floor(e*l),s=r[o]):(o=Math.floor(e*c),s=i[o]),`${s}${a.clamp(t,1,7)}`}},{"../maths/maths":"iDBHd","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],aonYx:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"createQueue",(()=>i)),o.export(n,"createKick",(()=>l)),o.export(n,"createSnare",(()=>c)),o.export(n,"createHihat",(()=>d)),o.export(n,"createClack",(()=>u)),o.export(n,"createCowbell",(()=>h)),o.export(n,"createKicks",(()=>m)),o.export(n,"createSnares",(()=>p)),o.export(n,"createHihats",(()=>g)),o.export(n,"createCowbells",(()=>f)),o.export(n,"createClacks",(()=>v)),o.export(n,"createDrumkit",(()=>b));var a=e("./audio"),s=e("./rack");const r=1e-7,i=(e,t=5)=>{const n=[];for(let o=0;o<t;++o){const t=e();n.push(t)}let o=0;return(...e)=>{o=o+1<t?o+1:0;(0,n[o])(...e)}},l=()=>{const e=a.audioContext.createOscillator(),t=a.audioContext.createOscillator(),n=a.audioContext.createGain(),o=a.audioContext.createGain();e.type="triangle",t.type="sine";return e.connect(n),t.connect(o),n.connect(s.inputDryNode()),o.connect(s.inputDryNode()),(s=1,i=.05,l=.01,c=.5)=>{const d=a.audioContext.currentTime;n.gain.cancelScheduledValues(d),o.gain.cancelScheduledValues(d),e.frequency.cancelScheduledValues(d),t.frequency.cancelScheduledValues(d),n.gain.setValueAtTime(1,d),n.gain.exponentialRampToValueAtTime(r,d+i),o.gain.setValueAtTime(1,a.audioContext.currentTime),o.gain.exponentialRampToValueAtTime(r,d+i),e.frequency.setValueAtTime(90,a.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(l,d+i),t.frequency.setValueAtTime(50,a.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(l,d+i);try{e.start(d),t.start(d)}catch(e){}}},c=()=>{const e=a.audioContext.createOscillator(),t=a.audioContext.createGain(),n=a.audioContext.createGain(),o=a.audioContext.createBufferSource(),i=a.audioContext.createBuffer(1,4096,a.audioContext.sampleRate),l=a.audioContext.createBiquadFilter();l.type="highpass",e.type="triangle",e.frequency.value=100;const c=i.getChannelData(0);for(var d=0;d<4096;d++)c[d]=Math.random();o.buffer=i,o.loop=!0,e.connect(t),t.connect(s.inputDryNode()),o.connect(l),l.connect(n),n.connect(s.inputDryNode());return(s=1,i=.2)=>{const c=a.audioContext.currentTime;n.gain.cancelScheduledValues(c),n.gain.setValueAtTime(1,c),n.gain.exponentialRampToValueAtTime(r,c+i),t.gain.cancelScheduledValues(c),t.gain.setValueAtTime(r,c),t.gain.exponentialRampToValueAtTime(r,c+i/2),l.frequency.cancelScheduledValues(c),l.frequency.setValueAtTime(100,c),l.frequency.linearRampToValueAtTime(1e3,c+i);try{e.start(c),o.start(c)}catch(e){}}},d=()=>{const e=a.audioContext.createGain(),t=a.audioContext.createBiquadFilter();t.type="bandpass",t.frequency.value=1e4;const n=a.audioContext.createBiquadFilter();n.type="highpass",n.frequency.value=7e3;const o=[2,3,4.16,5.43,6.79,8.21].map((e=>{const n=a.audioContext.createOscillator();return n.type="square",n.frequency.value=40*e,n.connect(t),n}));t.connect(n),n.connect(e),e.connect(s.inputDryNode());return(t=1,n=.05)=>{const s=a.audioContext.currentTime;e.gain.cancelScheduledValues(s),o.forEach((e=>e.frequency.cancelScheduledValues(s))),e.gain.setValueAtTime(1,s),e.gain.exponentialRampToValueAtTime(r,s+n);try{o.forEach((e=>e.start(s)))}catch(e){}}},u=()=>{const e=a.audioContext.createGain(),t=a.audioContext.createBiquadFilter();t.type="bandpass",t.frequency.value=2640,t.Q.value=3.5;const n=a.audioContext.createBiquadFilter();n.type="highpass",n.frequency.value=7e3;const o=[587,845],i=o.map((e=>{const n=a.audioContext.createOscillator();return n.type="triangle",n.frequency.value=1*e,n.connect(t),n}));t.connect(n),n.connect(e),e.connect(s.inputDryNode());return(t=1,n=.05,s=1)=>{const l=a.audioContext.currentTime;e.gain.cancelScheduledValues(l),i.forEach(((e,t)=>{e.frequency.cancelScheduledValues(l),e.frequency.value=s*o[t]})),e.gain.setValueAtTime(1,l),e.gain.exponentialRampToValueAtTime(r,l+n);try{i.forEach((e=>e.start(l)))}catch(e){}}},h=()=>{const e=a.audioContext.createGain(),t=a.audioContext.createBiquadFilter();t.type="bandpass",t.frequency.value=2640,t.Q.value=3.5;const n=[587,845].map((e=>{const n=a.audioContext.createOscillator();return n.type="triangle",n.frequency.value=1*e,n.connect(t),n}));t.connect(e),e.connect(s.inputDryNode());return(t=1,o=.05)=>{const s=a.audioContext.currentTime;e.gain.cancelScheduledValues(s),n.forEach((e=>e.frequency.cancelScheduledValues(s))),e.gain.setValueAtTime(1,s),e.gain.exponentialRampToValueAtTime(r,s+o);try{n.forEach((e=>e.start(s)))}catch(e){}}},m=(e=2)=>i(l,e),p=(e=3)=>i(c,e),g=(e=3)=>i(d,e),f=(e=2)=>i(h,e),v=(e=2)=>i(u,e),b=()=>{const e=m(),t=g();return{kick:e,snare:p(),hat:t,cowbell:h(),clack:u()}}},{"./audio":"kGLQw","./rack":"bgac0","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],adRuD:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"CMD_START",(()=>a)),o.export(n,"CMD_STOP",(()=>s)),o.export(n,"CMD_UPDATE",(()=>r)),o.export(n,"EVENT_READY",(()=>i)),o.export(n,"EVENT_STARTING",(()=>l)),o.export(n,"EVENT_STOPPING",(()=>c)),o.export(n,"EVENT_TICK",(()=>d)),o.export(n,"MAX_BARS_ALLOWED",(()=>u)),o.export(n,"isAvailable",(()=>E)),o.export(n,"now",(()=>T)),o.export(n,"elapsed",(()=>k)),o.export(n,"convertBPMToPeriod",(()=>C)),o.export(n,"getTimePerBar",(()=>I)),o.export(n,"getTotalTime",(()=>L)),o.export(n,"getBar",(()=>S)),o.export(n,"getBars",(()=>D)),o.export(n,"getBarProgress",(()=>M)),o.export(n,"setBars",(()=>N)),o.export(n,"getMicroTempo",(()=>R)),o.export(n,"getMicrosPerMIDIClock",(()=>A)),o.export(n,"getBPM",(()=>j)),o.export(n,"setBPM",(()=>P)),o.export(n,"setTimeBetween",(()=>B)),o.export(n,"startTimer",(()=>F)),o.export(n,"stopTimer",(()=>O)),o.export(n,"tapTempo",(()=>_));const a="start",s="stop",r="update",i="ready",l="starting",c="stopping",d="tick",u=32,h=window.AudioContext||window.webkitAudioContext;let m,p=-1,g=100,f=null,v=!1,b=!0,y=0,x=16,w=0;try{m=new Worker(e("eef8a62b03b21459"))}catch(e){b=!1}const E=()=>b,T=()=>f.currentTime,k=()=>.001*(T()-p),C=e=>6e4/e,I=()=>g,L=()=>g*x,S=()=>y,D=()=>x,M=()=>y/x,N=e=>(x=e<1?1:e>u?u:e,x),R=()=>.001*I(),A=()=>R()/24,j=()=>6e4/I(),P=e=>B(C(e)),B=e=>(g=e,m.postMessage({command:r,interval:g,time:T()}),g),F=(e,t=200,n={})=>(w=0,null===f&&(f=new h,"suspended"===f.state&&f.resume()),g=t,m.onmessage=n=>{const o=T(),a=n.data;switch(a.event){case l:p=o,v=!0;break;case d:const s=a.intervals,r=s*t*.001,i=o-p,c=a.time,u=c%t*.001,h=c-i,m=Math.floor(c/t);y=++w%x,e&&e({bar:y,bars:x,barsElapsed:w,timePassed:c,elapsed:i,expected:r,drift:h,level:m,intervals:s,lag:u});break;default:console.log("message: ",n)}},m.onerror=e=>{console.error("error...",{error:e}),m.postMessage({error:e,time:f.currentTime})},m.postMessage({command:a,time:f.currentTime,interval:t,accurateTiming:!1}),{currentTime:T(),timingWorker:m}),O=()=>{const e=T();return m.onmessage=e=>{if(e.event===c)v=!1,f=null},m.postMessage({command:s,time:e}),{currentTime:e,timingWorker:m}};let $=[];const _=(e=!0,t=1e4,n=2)=>{const o=T();e&&$.length>0&&o-$[$.length-1]>t&&($=[]),$.push(o);const a=$.length,s=a-1,r=$[s]-$[0];if(a>=n){return r/s}return-1}},{eef8a62b03b21459:"gO7gY","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],gO7gY:[function(e,t,n){let o=e("./helpers/get-worker-url"),a=e("./helpers/bundle-url"),s=a.getBundleURL("dQYJg")+e("./helpers/bundle-manifest").resolve("1XLIV");t.exports=o(s,a.getOrigin(s),!1)},{"./helpers/get-worker-url":"5Byxz","./helpers/bundle-url":"bGZ1f","./helpers/bundle-manifest":"6jNRu"}],"5Byxz":[function(e,t,n){"use strict";t.exports=function(e,t,n){if(t===self.location.origin)return e;var o=n?"import "+JSON.stringify(e)+";":"importScripts("+JSON.stringify(e)+");";return URL.createObjectURL(new Blob([o],{type:"application/javascript"}))}},{}],"4s9sC":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"createPattern",(()=>a)),o.export(n,"factory",(()=>s)),o.export(n,"pattern",(()=>r)),o.export(n,"kickSequence",(()=>u)),o.export(n,"snareSequence",(()=>h)),o.export(n,"hatSequence",(()=>m)),o.export(n,"kitSequence",(()=>p)),o.export(n,"combinePatternWithInstrument",(()=>g)),o.export(n,"playNextPart",(()=>f));const a=(e,t=16)=>{new Array},s=(e=16)=>new Array(4*e).fill(0),r=(e,t=0)=>{let n=t;const o=e.length-1;return{reset:()=>(n=0,e[n]),previous:()=>{const t=n-1;return n=t<0?o:t,e[n]},next:()=>{const t=n+1;return n=t>o?0:t,e[n]},position:t=>e[t],length:e.length,current:()=>e[n],set:t=>e=t}},i=[[255,0,0,0,255,0,0,0,255,0,0,0,255,0,0,0]],l=[[0,0,255,0,0,0,255,0,0,0,255,0,0,0,255,0]],c=new Array(16).map((e=>255*e/16)),d=[[255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0]],u=r(i[0]),h=r(l[0]),m=r(d[0]),p=()=>({kick:r(i[0]),hat:r(d[0]),snare:r(l[0]),roll:r(c)}),g=(e,t)=>{},f=(e,t,...n)=>{const o=e.next();return o>0&&(t(o,...n),!0)}},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],dAURW:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"buttonQuantise",(()=>m)),o.export(n,"buttonVideo",(()=>p)),o.export(n,"controlPanel",(()=>g)),o.export(n,"video",(()=>v)),o.export(n,"isVisible",(()=>b)),o.export(n,"setVisibility",(()=>y)),o.export(n,"toggleVisibility",(()=>x)),o.export(n,"isVideoVisible",(()=>w)),o.export(n,"toggleVideoVisiblity",(()=>E)),o.export(n,"setControls",(()=>T)),o.export(n,"setupCameraForm",(()=>k)),o.export(n,"setupInstrumentForm",(()=>C)),o.export(n,"updateTempo",(()=>I)),o.export(n,"showPlayerSelector",(()=>L)),o.export(n,"setupInterface",(()=>S)),o.export(n,"focusApp",(()=>D));var a=e("../audio/instruments"),s=e("./full-screen"),r=e("../location-handler"),i=e("../models/info"),l=e("./toggle"),c=e("./select");const d=document;let u,h,m,p,g;const f=d.querySelector("main"),v=d.querySelector("video"),b=e=>"hidden"!==e.style.visibility,y=(e,t)=>(e.style.visibility=t?"hidden":"visible",b(e)),x=e=>{const t=b(e);return y(e,!t),b(e)},w=()=>b(v),E=e=>{const t=y(v,e||!w());console.error("toggling video vis",{value:e,currentlyVisible:t})},T=(e,t="person-a-controls")=>{d.getElementById(t).appendChild(e)},k=(e,t)=>{const n=d.getElementById("camera").querySelector("#camera select"),o=e.map(((e,t)=>`<option value="${e.deviceId}">${e.label}</option>`));n.innerHTML=`<optgroup label="Detected Cameras">${o.join("")}</optgroup>`,c.connectSelect(n,t)},C=e=>{const t=a.INSTRUMENT_FOLDERS.map(((e,t)=>`<label for="${e}">${a.INSTRUMENT_NAMES[t]}<input id="${e}" name="instrument-selector" type="radio" value="${e}"></input></label>`));return t.unshift("<legend>Select an instrument</legend>"),`${t.join("")}`},I=e=>{const t=d.getElementById("input-tempo");t&&t.setAttribute("value",e),console.log("Setting tempo",e)},L=e=>new Promise(((t,n)=>{const o="player-selection",a=d.getElementById("onboard"),s=d.getElementById("player-selector"),r=s.querySelector("#button-solo"),i=s.querySelector("#button-duet"),l=s.querySelector("#button-trio"),c=(d.getElementById("button-start"),s.querySelector("#toggle-advanced-mode"));let u=e.advancedMode||!1,h=e.duet?2:1;c.setAttribute("checked",!u),d.documentElement.classList.toggle(o,!0);const m=e=>{h=e,d.documentElement.classList.remove("solo","duet"),d.documentElement.classList.add(1===h?"solo":"duet")};r.addEventListener("click",(e=>m(1))),i.addEventListener("click",(e=>m(2))),l.addEventListener("click",(e=>m(3))),c.addEventListener("change",(e=>{u=!u,f.classList.toggle("beginner",!u)})),a.addEventListener("submit",(e=>{var n;return e.preventDefault(),(n=h)<2?(r.classList.toggle("hide",!0),i.classList.toggle("hide",!1),f.classList.add("solo")):(i.classList.toggle("hide",!0),r.classList.toggle("hide",!1),f.classList.add("duet")),s.classList.add("completed"),d.documentElement.classList.toggle(o,!0),setTimeout((()=>{d.documentElement.classList.toggle("advanced",u),d.documentElement.classList.toggle(o,!1),s.classList.remove("completed")}),45),t({players:n,advancedMode:u}),!1}),!0),f.classList.toggle("beginner",!u),m(h),s.focus()})),S=e=>{d.querySelector("h1");const t=d.getElementById("share"),n=d.querySelector("share-menu");if(n.url=r.getShareLink(e),t.addEventListener("mousedown",(t=>{n.setAttribute("url",r.getShareLink(e)),console.error("SHARING",{shareElement:n,url:n.url})}),!1),g=d.getElementById("control-panel"),u=d.getElementById("button-instrument"),p=d.getElementById("button-video"),h=d.getElementById("button-record"),m=d.getElementById("button-quantise"),s.canFullscreen()){const t=l.setToggle("button-fullscreen",(n=>{e.fullscreen=s.toggleFullScreen(),t.classList.toggle("fs",e.fullscreen)}),!1)}else d.getElementById("button-fullscreen").classList.toggle("hide",!0);const o=d.getElementById("version"),a=o.innerHTML;o.innerHTML=`${a} <span id="release">${i.formattedDate}</span>`,g.addEventListener("submit",(e=>{e.preventDefault()}),!0)},D=()=>{}},{"../audio/instruments":"ftlvJ","./full-screen":"ebc87","../location-handler":"6ch5Y","../models/info":"dytk0","./toggle":"f71P0","./select":"cBFxP","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],ebc87:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"canFullscreen",(()=>a)),o.export(n,"exitFullscreen",(()=>s)),o.export(n,"goFullscreen",(()=>r)),o.export(n,"toggleFullScreen",(()=>i));const a=()=>document.fullscreenEnabled||document.mozFullScreenEnabled||document.documentElement.webkitRequestFullScreen,s=()=>{document.exitFullscreen()},r=e=>{a()&&document.documentElement.requestFullscreen()},i=()=>document.fullscreenElement?(document.exitFullscreen&&s(),!1):(r(),!0)},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],dytk0:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"formattedDate",(()=>r));var a=e("../version");const s=new Date(a.DATE),r=`${s.getDate()}/${s.getMonth()+1}/${s.getFullYear()} ${s.toLocaleTimeString("en-GB",{hour12:!0,hour:"numeric",minute:"numeric"})}`},{"../version":"98oCg","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],f71P0:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"setToggle",(()=>s));var a=e("./button");const s=(e,t,n)=>{const o=a.setButton(e,(()=>{n=!n,"LABEL"===o.parentNode.nodeName&&o.parentNode.classList.toggle("checked",n),t(n)}));return n&&(o.setAttribute("checked",n),o.parentNode.classList.toggle("checked",n)),o}},{"./button":"6WDhH","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"6WDhH":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"setButton",(()=>i)),o.export(n,"showReloadButton",(()=>l)),o.export(n,"createInstallButton",(()=>c)),o.export(n,"showUpdateButton",(()=>d)),o.export(n,"setupMIDIButton",(()=>u));var a=e("./text"),s=e("../version"),r=e("../models/info");const i=(e,t)=>{const n=document.getElementById(e);return!!n&&(n.addEventListener("click",(e=>{t&&t({element:n})})),n)},l=()=>{},c=e=>{const t=`Click to install ${e.short_name} V-${s.VERSION.replaceAll(".","-")}<br>Date:${r.formattedDate}`,n=document.createElement("button");return n.id="button-install",n.classList.add("install-app"),n.setAttribute("aria-label",t),n.style.setProperty("--logo",`url(${e.icons[0].src})`),n.innerHTML="Install",a.addTooltip(n),n},d=(e,t)=>{const n=doc.createElement("button");n.id="button-update",n.setAttribute("aria-label","Update to new version"),n.classList.add("update-available"),n.innerHTML="Update",n.addEventListener("click",(()=>t())),e.appendChild(n)},u=(e,t)=>{let n=!1;return e.addEventListener("mousedown",(async e=>(e.preventDefault(),t&&t(),n=!0,!1)),{once:!0}),{setText:t=>e.innerHTML=t,setLabel:t=>e.setAttribute("aria-label",t)}}},{"./text":"cwBIr","../version":"98oCg","../models/info":"dytk0","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],cwBIr:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"bindTextElement",(()=>s)),o.export(n,"setFeedback",(()=>r)),o.export(n,"setToast",(()=>l)),o.export(n,"addTooltip",(()=>d)),o.export(n,"addToolTips",(()=>u));var a=e("../utils");const s=(e,t=700,n=0,o=!1)=>{let s=null,r=-1,i=-1,l=null;const c=a.debounce((t=>{e.innerHTML=t}),t);return e?(a,d=t)=>{o&&(a=a.split(/!|\./i).join("<br>")),l=a,""!==e.innerHTML&&s==a||(clearTimeout(i),s=a,0===d?(clearTimeout(r),e.innerHTML=a):r=c(a),n>0&&(i=(t=>{const o=n*t;return i=setTimeout((()=>{e.innerHTML=""}),o),o})(a.length)))}:null},r=s(document.getElementById("feedback"),20),i=document.getElementById("toast"),l=((e,t=6,n=550)=>{let o="",a=null,s=!1,r=!1;return e?(i,l=t)=>{if(r=!1,i===o)return;clearInterval(a),o=i;const c=(t=0,o=1)=>{const l=i.slice(0,t);if(s=!0,e.innerHTML=l,t<i.length)requestAnimationFrame((()=>c(t+o,o)));else{s=!1;const t=n*i.length;a=setTimeout((()=>{e.innerHTML="",r=!0}),t)}};l<1?c(i.length,10):c(s?o.length:0,l)}:null})(i),c=e=>{i.setAttribute("style",`--left: ${e.offsetLeft}; \n\t\t --top: ${e.offsetTop};`)},d=e=>e.addEventListener("mouseover",(e=>{const t=e.target.getAttribute("aria-label")||e.target.innerHTML;"BUTTON"===e.target.nodeName?c(e.target):c(e.target.parentElement),l(t)})),u=(e,t="button, select, input")=>{e.querySelectorAll(t).forEach((e=>d(e)))}},{"../utils":"9g7cm","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],cBFxP:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"connectSelect",(()=>r)),o.export(n,"connectPaletteSelector",(()=>i)),o.export(n,"connectReverbSelector",(()=>l)),o.export(n,"connectTempoControls",(()=>c)),o.export(n,"connectReverbControls",(()=>d));var a=e("./ui"),s=e("../audio/effects/reverb");const r=async(e,t)=>{const n="string"==typeof e?document.getElementById(e):e;if(!n)throw Error("No element found with that spec");return n.addEventListener("change",(e=>{const o=n.options[n.selectedIndex||n.options.selectedIndex];t&&t(o),e.preventDefault()})),n},i=e=>r("select-palette",e),l=e=>r("select-impulse",e),c=e=>{r("select-tempo",(t=>{const n=parseInt(t.innerHTML);a.updateTempo(n),e&&e(n)}))},d=e=>{const t="select-impulse",n=s.DIRS,o=document.getElementById(t);if(o){const e=(e,t)=>e.map((e=>{const t=e=e.trim(),n=e.substring(e.lastIndexOf("/")+1);return`<option value="${t}">${n.substring(0,n.lastIndexOf("."))}</option>`})).join("\n"),t=n.map((async t=>{const n=await s.loadImpulseJSON(t);return`<optgroup>${t}</optgroup>${e(n,t)}`}));Promise.all(t).then((e=>{o.innerHTML=e.join("")}))}else console.error("Injecting impulse FAILED to ",{options:o,impulseList:impulseList});return r(t,(t=>e&&e(t)))}},{"./ui":"dAURW","../audio/effects/reverb":"7szM4","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],i5you:[function(e,t,n){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);n.default=(e,t,n,o=4e3)=>{let a,s=!0,r=!0;e.addEventListener("mousemove",(e=>{if(clearInterval(a),!r)return r=!0,void(t&&t());a=setTimeout((()=>{r=!1,n&&n()}),o)}),!1),e.addEventListener("mouseout",(e=>{clearInterval(a)}),!1),document.addEventListener("mouseenter",(e=>{clearInterval(a),s||(s=!0,t&&t())}),!1),document.addEventListener("mouseleave",(e=>{clearInterval(a),s&&(e.clientY<=0||e.clientX<=0||e.clientX>=window.innerWidth||e.clientY>=window.innerHeight)&&(s=!1,n&&n())}),!1),document.addEventListener("visibilitychange",(e=>{clearInterval(a),document.documentElement.classList.toggle("tab-hidden",document.hidden),document.hidden?(s=!1,n&&n()):t&&t()}),!1),t&&t()}},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],l66Iq:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n);var a=e("dialog-polyfill"),s=o.interopDefault(a);const r=new Event("closing"),i=new Event("closed"),l=new Event("opening"),c=new Event("opened"),d=new Event("removed"),u=new MutationObserver(((e,t)=>{e.forEach((async e=>{if("open"===e.attributeName){const t=e.target;if(!t.hasAttribute("open"))return;t.removeAttribute("inert");const n=t.querySelector("[autofocus]");n?n.focus():t.querySelector("button").focus(),t.dispatchEvent(l),await m(t),t.dispatchEvent(c)}}))})),h=new MutationObserver(((e,t)=>{e.forEach((e=>{e.removedNodes.forEach((e=>{"DIALOG"===e.nodeName&&(dialog.removeEventListener("click",p),dialog.removeEventListener("close",g),e.dispatchEvent(d))}))}))})),m=e=>Promise.allSettled(e.getAnimations().map((e=>e.finished))),p=({target:e})=>{"DIALOG"===e.nodeName&&e.close("dismiss")},g=async({target:e})=>{e.setAttribute("inert",""),e.dispatchEvent(r),await m(e),e.dispatchEvent(i)},f=({target:e})=>{console.log("Dialog closing",e)},v=({target:e})=>{console.log("Dialog closed",e),console.info("Dialog user action:",e.returnValue),e.returnValue},b=({target:e})=>{console.log("Dialog open",e)},y=({target:e})=>{console.log("Dialog opening",e)},x=({target:e})=>{e.removeEventListener("closing",f),e.removeEventListener("closed",v),e.removeEventListener("opening",y),e.removeEventListener("opened",b),e.removeEventListener("removed",x)};n.default=()=>{document.querySelectorAll("dialog").forEach((e=>{s.default.registerDialog(e),(async e=>{e.addEventListener("click",p),e.addEventListener("close",g),u.observe(e,{attributes:!0}),h.observe(document.body,{attributes:!1,subtree:!1,childList:!0}),await m(e),e.removeAttribute("loading")})(e),e.addEventListener("closing",f),e.addEventListener("closed",v),e.addEventListener("opening",y),e.addEventListener("opened",b),e.addEventListener("removed",x)}))}},{"dialog-polyfill":"8cLAB","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"8cLAB":[function(e,t,n){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var o=window.CustomEvent;function a(e,t){var n="on"+t.type.toLowerCase();return"function"==typeof e[n]&&e[n](t),e.dispatchEvent(t)}function s(e){for(;e;){if("dialog"===e.localName)return e;e=e.parentElement?e.parentElement:e.parentNode?e.parentNode.host:null}return null}function r(e){for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;e&&e.blur&&e!==document.body&&e.blur()}function i(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1}function l(e){return!(!e||!e.hasAttribute("method"))&&"dialog"===e.getAttribute("method").toLowerCase()}function c(e){var t=["button","input","keygen","select","textarea"].map((function(e){return e+":not([disabled])"}));t.push('[tabindex]:not([disabled]):not([tabindex=""])');var n=e.querySelector(t.join(", "));if(!n&&"attachShadow"in Element.prototype)for(var o=e.querySelectorAll("*"),a=0;a<o.length&&!(o[a].tagName&&o[a].shadowRoot&&(n=c(o[a].shadowRoot)));a++);return n}function d(e){return e.isConnected||document.body.contains(e)}function u(e){if(e.submitter)return e.submitter;var t=e.target;if(!(t instanceof HTMLFormElement))return null;var n=p.formSubmitter;if(!n){var o=e.target;n=("getRootNode"in o&&o.getRootNode()||document).activeElement}return n&&n.form===t?n:null}function h(e){if(!e.defaultPrevented){var t=e.target,n=p.imagemapUseValue,o=u(e);null===n&&o&&(n=o.value);var a=s(t);if(a)"dialog"===(o&&o.getAttribute("formmethod")||t.getAttribute("method"))&&(e.preventDefault(),null!=n?a.close(n):a.close())}}function m(e){if(this.dialog_=e,this.replacedStyleTop_=!1,this.openAsModal_=!1,e.hasAttribute("role")||e.setAttribute("role","dialog"),e.show=this.show.bind(this),e.showModal=this.showModal.bind(this),e.close=this.close.bind(this),e.addEventListener("submit",h,!1),"returnValue"in e||(e.returnValue=""),"MutationObserver"in window){new MutationObserver(this.maybeHideModal.bind(this)).observe(e,{attributes:!0,attributeFilter:["open"]})}else{var t,n=!1,o=function(){n?this.downgradeModal():this.maybeHideModal(),n=!1}.bind(this),a=function(a){if(a.target===e){var s="DOMNodeRemoved";n|=a.type.substr(0,s.length)===s,window.clearTimeout(t),t=window.setTimeout(o,0)}};["DOMAttrModified","DOMNodeRemoved","DOMNodeRemovedFromDocument"].forEach((function(t){e.addEventListener(t,a)}))}Object.defineProperty(e,"open",{set:this.setOpen.bind(this),get:e.hasAttribute.bind(e,"open")}),this.backdrop_=document.createElement("div"),this.backdrop_.className="backdrop",this.backdrop_.addEventListener("mouseup",this.backdropMouseEvent_.bind(this)),this.backdrop_.addEventListener("mousedown",this.backdropMouseEvent_.bind(this)),this.backdrop_.addEventListener("click",this.backdropMouseEvent_.bind(this))}o&&"object"!=typeof o||((o=function(e,t){t=t||{};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!!t.bubbles,!!t.cancelable,t.detail||null),n}).prototype=window.Event.prototype),m.prototype={get dialog(){return this.dialog_},maybeHideModal:function(){this.dialog_.hasAttribute("open")&&d(this.dialog_)||this.downgradeModal()},downgradeModal:function(){this.openAsModal_&&(this.openAsModal_=!1,this.dialog_.style.zIndex="",this.replacedStyleTop_&&(this.dialog_.style.top="",this.replacedStyleTop_=!1),this.backdrop_.parentNode&&this.backdrop_.parentNode.removeChild(this.backdrop_),p.dm.removeDialog(this))},setOpen:function(e){e?this.dialog_.hasAttribute("open")||this.dialog_.setAttribute("open",""):(this.dialog_.removeAttribute("open"),this.maybeHideModal())},backdropMouseEvent_:function(e){if(this.dialog_.hasAttribute("tabindex"))this.dialog_.focus();else{var t=document.createElement("div");this.dialog_.insertBefore(t,this.dialog_.firstChild),t.tabIndex=-1,t.focus(),this.dialog_.removeChild(t)}var n=document.createEvent("MouseEvents");n.initMouseEvent(e.type,e.bubbles,e.cancelable,window,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget),this.dialog_.dispatchEvent(n),e.stopPropagation()},focus_:function(){var e=this.dialog_.querySelector("[autofocus]:not([disabled])");!e&&this.dialog_.tabIndex>=0&&(e=this.dialog_),e||(e=c(this.dialog_)),r(document.activeElement),e&&e.focus()},updateZIndex:function(e,t){if(e<t)throw new Error("dialogZ should never be < backdropZ");this.dialog_.style.zIndex=e,this.backdrop_.style.zIndex=t},show:function(){this.dialog_.open||(this.setOpen(!0),this.focus_())},showModal:function(){if(this.dialog_.hasAttribute("open"))throw new Error("Failed to execute 'showModal' on dialog: The element is already open, and therefore cannot be opened modally.");if(!d(this.dialog_))throw new Error("Failed to execute 'showModal' on dialog: The element is not in a Document.");if(!p.dm.pushDialog(this))throw new Error("Failed to execute 'showModal' on dialog: There are too many open modal dialogs.");(function(e){for(;e&&e!==document.body;){var t=window.getComputedStyle(e),n=function(e,n){return!(void 0===t[e]||t[e]===n)};if(t.opacity<1||n("zIndex","auto")||n("transform","none")||n("mixBlendMode","normal")||n("filter","none")||n("perspective","none")||"isolate"===t.isolation||"fixed"===t.position||"touch"===t.webkitOverflowScrolling)return!0;e=e.parentElement}return!1})(this.dialog_.parentElement)&&console.warn("A dialog is being shown inside a stacking context. This may cause it to be unusable. For more information, see this link: https://github.com/GoogleChrome/dialog-polyfill/#stacking-context"),this.setOpen(!0),this.openAsModal_=!0,p.needsCentering(this.dialog_)?(p.reposition(this.dialog_),this.replacedStyleTop_=!0):this.replacedStyleTop_=!1,this.dialog_.parentNode.insertBefore(this.backdrop_,this.dialog_.nextSibling),this.focus_()},close:function(e){if(!this.dialog_.hasAttribute("open"))throw new Error("Failed to execute 'close' on dialog: The element does not have an 'open' attribute, and therefore cannot be closed.");this.setOpen(!1),void 0!==e&&(this.dialog_.returnValue=e);var t=new o("close",{bubbles:!1,cancelable:!1});a(this.dialog_,t)}};var p={reposition:function(e){var t=document.body.scrollTop||document.documentElement.scrollTop,n=t+(window.innerHeight-e.offsetHeight)/2;e.style.top=Math.max(t,n)+"px"},isInlinePositionSetByStylesheet:function(e){for(var t=0;t<document.styleSheets.length;++t){var n=document.styleSheets[t],o=null;try{o=n.cssRules}catch(e){}if(o)for(var a=0;a<o.length;++a){var s=o[a],r=null;try{r=document.querySelectorAll(s.selectorText)}catch(e){}if(r&&i(r,e)){var l=s.style.getPropertyValue("top"),c=s.style.getPropertyValue("bottom");if(l&&"auto"!==l||c&&"auto"!==c)return!0}}}return!1},needsCentering:function(e){return"absolute"===window.getComputedStyle(e).position&&(!("auto"!==e.style.top&&""!==e.style.top||"auto"!==e.style.bottom&&""!==e.style.bottom)&&!p.isInlinePositionSetByStylesheet(e))},forceRegisterDialog:function(e){if((window.HTMLDialogElement||e.showModal)&&console.warn("This browser already supports <dialog>, the polyfill may not work correctly",e),"dialog"!==e.localName)throw new Error("Failed to register dialog: The element is not a dialog.");new m(e)},registerDialog:function(e){e.showModal||p.forceRegisterDialog(e)},DialogManager:function(){this.pendingDialogStack=[];var e=this.checkDOM_.bind(this);this.overlay=document.createElement("div"),this.overlay.className="_dialog_overlay",this.overlay.addEventListener("click",function(t){this.forwardTab_=void 0,t.stopPropagation(),e([])}.bind(this)),this.handleKey_=this.handleKey_.bind(this),this.handleFocus_=this.handleFocus_.bind(this),this.zIndexLow_=1e5,this.zIndexHigh_=100150,this.forwardTab_=void 0,"MutationObserver"in window&&(this.mo_=new MutationObserver((function(t){var n=[];t.forEach((function(e){for(var t,o=0;t=e.removedNodes[o];++o)t instanceof Element&&("dialog"===t.localName&&n.push(t),n=n.concat(t.querySelectorAll("dialog")))})),n.length&&e(n)})))}};if(p.DialogManager.prototype.blockDocument=function(){document.documentElement.addEventListener("focus",this.handleFocus_,!0),document.addEventListener("keydown",this.handleKey_),this.mo_&&this.mo_.observe(document,{childList:!0,subtree:!0})},p.DialogManager.prototype.unblockDocument=function(){document.documentElement.removeEventListener("focus",this.handleFocus_,!0),document.removeEventListener("keydown",this.handleKey_),this.mo_&&this.mo_.disconnect()},p.DialogManager.prototype.updateStacking=function(){for(var e,t=this.zIndexHigh_,n=0;e=this.pendingDialogStack[n];++n)e.updateZIndex(--t,--t),0===n&&(this.overlay.style.zIndex=--t);var o=this.pendingDialogStack[0];o?(o.dialog.parentNode||document.body).appendChild(this.overlay):this.overlay.parentNode&&this.overlay.parentNode.removeChild(this.overlay)},p.DialogManager.prototype.containedByTopDialog_=function(e){for(;e=s(e);){for(var t,n=0;t=this.pendingDialogStack[n];++n)if(t.dialog===e)return 0===n;e=e.parentElement}return!1},p.DialogManager.prototype.handleFocus_=function(e){var t=e.composedPath?e.composedPath()[0]:e.target;if(!this.containedByTopDialog_(t)&&document.activeElement!==document.documentElement&&(e.preventDefault(),e.stopPropagation(),r(t),void 0!==this.forwardTab_)){var n=this.pendingDialogStack[0];return n.dialog.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_PRECEDING&&(this.forwardTab_?n.focus_():t!==document.documentElement&&document.documentElement.focus()),!1}},p.DialogManager.prototype.handleKey_=function(e){if(this.forwardTab_=void 0,27===e.keyCode){e.preventDefault(),e.stopPropagation();var t=new o("cancel",{bubbles:!1,cancelable:!0}),n=this.pendingDialogStack[0];n&&a(n.dialog,t)&&n.dialog.close()}else 9===e.keyCode&&(this.forwardTab_=!e.shiftKey)},p.DialogManager.prototype.checkDOM_=function(e){this.pendingDialogStack.slice().forEach((function(t){-1!==e.indexOf(t.dialog)?t.downgradeModal():t.maybeHideModal()}))},p.DialogManager.prototype.pushDialog=function(e){var t=(this.zIndexHigh_-this.zIndexLow_)/2-1;return!(this.pendingDialogStack.length>=t)&&(1===this.pendingDialogStack.unshift(e)&&this.blockDocument(),this.updateStacking(),!0)},p.DialogManager.prototype.removeDialog=function(e){var t=this.pendingDialogStack.indexOf(e);-1!==t&&(this.pendingDialogStack.splice(t,1),0===this.pendingDialogStack.length&&this.unblockDocument(),this.updateStacking())},p.dm=new p.DialogManager,p.formSubmitter=null,p.imagemapUseValue=null,void 0===window.HTMLDialogElement){var g=document.createElement("form");if(g.setAttribute("method","dialog"),"dialog"!==g.method){var f=Object.getOwnPropertyDescriptor(HTMLFormElement.prototype,"method");if(f){var v=f.get;f.get=function(){return l(this)?"dialog":v.call(this)};var b=f.set;f.set=function(e){return"string"==typeof e&&"dialog"===e.toLowerCase()?this.setAttribute("method",e):b.call(this,e)},Object.defineProperty(HTMLFormElement.prototype,"method",f)}}document.addEventListener("click",(function(e){if(p.formSubmitter=null,p.imagemapUseValue=null,!e.defaultPrevented){var t=e.target;if("composedPath"in e)t=e.composedPath().shift()||t;if(t&&l(t.form)){if(!("submit"===t.type&&["button","input"].indexOf(t.localName)>-1)){if("input"!==t.localName||"image"!==t.type)return;p.imagemapUseValue=e.offsetX+","+e.offsetY}s(t)&&(p.formSubmitter=t)}}}),!1),document.addEventListener("submit",(function(e){var t=e.target;if(!s(t)){var n=u(e);"dialog"===(n&&n.getAttribute("formmethod")||t.getAttribute("method"))&&e.preventDefault()}}));var y=HTMLFormElement.prototype.submit;HTMLFormElement.prototype.submit=function(){if(!l(this))return y.call(this);var e=s(this);e&&e.close()}}n.default=p},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"9dSnZ":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"showError",(()=>a));const a=(e,t,n=!1)=>{console.error("Could not load",e),console.warn("Consider:",t)}},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],h5wXQ:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"createPhotographElement",(()=>i)),o.export(n,"appendPhotographElement",(()=>l));var a=e("../timing/timing.js"),s=e("../visual/canvas"),r=e("../visual/2d");const i=()=>{const e=Math.ceil(1e7*a.now()),t=`photograph-${e}`,n=s.getCanvasDimensions(),o=new Image;o.src=r.takePhotograph(),o.alt="Photograph taken "+Date.now().toString(),o.width=n.width,o.height=n.height;const i=document.createElement("a");return i.href=o.src,i.innerHTML="Click to download this photograph",i.id=t,i.download=`snapshot-${e}.png`,i.appendChild(o),i},l=()=>{const e=i();document.getElementById("photographs").appendChild(e),requestAnimationFrame((()=>document.getElementById(e.id).scrollIntoView()))}},{"../timing/timing.js":"adRuD","../visual/canvas":"2h2QK","../visual/2d":"2Ac2W","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"2h2QK":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"canvas",(()=>a)),o.export(n,"canvasContext",(()=>s)),o.export(n,"updateCanvasSize",(()=>l)),o.export(n,"getCanvasDimensions",(()=>c)),o.export(n,"clear",(()=>d)),o.export(n,"overdraw",(()=>u)),o.export(n,"copyCanvasToClipboard",(()=>h)),o.export(n,"drawElement",(()=>m));const a=document.querySelector("canvas"),s=a.getContext("2d");let r=a.width,i=a.height;const l=(e,t)=>{r=e??a.width,i=t??a.height},c=()=>({width:r,height:i}),d=()=>{s.clearRect(0,0,r,i)},u=(e=0,t=-1)=>{s.save(),s.drawImage(a,e,t),s.restore()},h=async()=>a.toBlob((async e=>{await navigator.clipboard.write([new ClipboardItem({[e.type]:e})])})),m=e=>{s.save(),s.translate(r,0),s.scale(-1,1),s.drawImage(e,0,0),s.restore()}},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"2Ac2W":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"takePhotograph",(()=>d)),o.export(n,"drawShapeByIndexes",(()=>u)),o.export(n,"drawPart",(()=>h)),o.export(n,"drawTriangle",(()=>m)),o.export(n,"drawNode",(()=>p)),o.export(n,"drawText",(()=>g)),o.export(n,"drawParagraph",(()=>f)),o.export(n,"drawInstrument",(()=>v)),o.export(n,"drawBoundingBox",(()=>b)),o.export(n,"setNodeCount",(()=>x)),o.export(n,"drawPoints",(()=>T)),o.export(n,"drawFaceMesh",(()=>k)),o.export(n,"drawFace",(()=>C));var a=e("../maths/maths"),s=e("../palette"),r=o.interopDefault(s),i=e("./canvas"),l=e("../maths/easing"),c=e("../models/face-mesh-model");const d=(e="image/png")=>i.canvas.toDataURL(e),u=(e,t,n=2,o="red",a=!0,s=!0)=>{i.canvasContext.fillStyle=o,i.canvasContext.strokeStyle=o,i.canvasContext.moveTo(e[t[0]][0],e[t[0]][1]),i.canvasContext.beginPath();for(let n=1,o=t.length;n<o;n++)i.canvasContext.lineTo(e[t[n]][0],e[t[n]][1]);i.canvasContext.closePath(),s&&i.canvasContext.fill(),a&&i.canvasContext.stroke()},h=(e,t=2,n="red",o=!0,s=!0,l=!1)=>{i.canvasContext.fillStyle=n,i.canvasContext.strokeStyle=n,i.canvasContext.moveTo(e[0][0],e[0][1]),i.canvasContext.beginPath();for(let n=0,s=e.length;n<s;n++){const s=e[n][0],r=e[n][1];i.canvasContext.arc(s,r,t,0,a.TAU),o&&i.canvasContext.lineTo(s,r)}if(s&&i.canvasContext.fill(),o&&i.canvasContext.stroke(),l)for(let t=0,n=e.length;t<n;t+=2){const n=e[t][0],o=e[t][1];i.canvasContext.stroke(),i.canvasContext.font="18px Oxanium",i.canvasContext.textAlign="center",i.canvasContext.fillStyle=r.default.dark,i.canvasContext.fillText(`#${t}`,n,o)}},m=(e,t,n,o,a,s,r,l=1)=>{i.canvasContext.beginPath(),i.canvasContext.lineWidth=l,i.canvasContext.strokeStyle=r,i.canvasContext.moveTo(e,t),i.canvasContext.lineTo(n,o),i.canvasContext.lineTo(a,s),i.canvasContext.closePath(),i.canvasContext.stroke()},p=(e,t,n=5,o="blue")=>{i.canvasContext.fillStyle=o,i.canvasContext.beginPath(),i.canvasContext.arc(t[0],t[1],n,0,a.TAU),i.canvasContext.fill(),i.canvasContext.beginPath(),i.canvasContext.arc(e[0],e[1],n,0,a.TAU),i.canvasContext.fill(),i.canvasContext.beginPath(),i.canvasContext.moveTo(e[0],e[1]),i.canvasContext.strokeStyle=r.default.orange,i.canvasContext.fillStyle=r.default.orange,i.canvasContext.lineTo(t[0],t[1])},g=(e,t,n="",o="10px",a="center")=>{i.canvasContext.font=`900 ${o} Oxanium`,i.canvasContext.textAlign=a,i.canvasContext.fillStyle=r.default.white,i.canvasContext.strokeStyle=r.default.dark,i.canvasContext.strokeText(`${n}`,e,t),i.canvasContext.fillText(`${n}`,e,t)},f=(e,t,n=[],o="8px",a=20)=>{let s=t;for(const t of n)g(e,s,t,o,"left"),s+=a},v=(e,t,n="")=>{const o=`${t.toUpperCase()} - ${n}`;g(e.topLeft[0],e.topLeft[1],o,"24px")},b=(e,t="red")=>{const{bottomRight:n,topLeft:o}=e;i.canvasContext.beginPath(),i.canvasContext.fillStyle=t,i.canvasContext.strokeRect(o[0],o[1],n[0],n[1]),i.canvasContext.fill()};let y=0;const x=e=>y+=e;let w=0;const E=l.easeInQuad,T=(e,t={h:0,s:100,l:100},n=3,o=!1,s=!0)=>{const{scaledMesh:l}=e,c=l.length;for(let e=0;e<c;e++){const d=l[e][0],u=l[e][1],h=1-(l[e][2]+45)/45,m=a.clamp(n*E(h),1,n),p=a.clamp(h,.5,1);if(i.canvasContext.beginPath(),s&&e===y%c)i.canvasContext.stroke(),i.canvasContext.font="22px Oxanium",i.canvasContext.textAlign="center",i.canvasContext.fillStyle=r.default.dark,i.canvasContext.fillText(`#${e}`,d+m+1,u),i.canvasContext.fillStyle="hsla(0,90%,70%,1)",i.canvasContext.arc(d,u,3*m,0,a.TAU);else{const n=t.h,s=o?(w+++n+360*e/c)%360:n;i.canvasContext.fillStyle=`hsla(${s},${t.s}%,${t.l}%,${p})`,i.canvasContext.arc(d,u,m,0,a.TAU)}i.canvasContext.fill()}},k=(e,t={h:0,s:100,l:100},n=.5,o=!1,a=.2)=>{const{scaledMesh:s}=e,r=t.h;for(let e=0,a=c.TRIANGLE_MATRIX.length-2;e<a;e+=3){const i=s[c.TRIANGLE_MATRIX[e]],l=s[c.TRIANGLE_MATRIX[e+1]],d=s[c.TRIANGLE_MATRIX[e+2]],u=t.a||1,h=`hsla(${o?(r+360*e/a)%360:r},${t.s}%,${t.l}%,${u})`;m(i[0],i[1],l[0],l[1],d[0],d[1],h,n)}},C=(e,t=s.DEFAULT_COLOURS,n=!1,o=!1,a=!1)=>{const{annotations:r}=e;o&&n?drawMouth(e,t.mouth,a):drawMouth(e,t.mouthClosed,a)}},{"../maths/maths":"iDBHd","../palette":"bNJmu","./canvas":"2h2QK","../maths/easing":"8aGct","../models/face-mesh-model":"4YeaK","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"4YeaK":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"TRIANGLE_MATRIX",(()=>a));const a=[127,34,139,11,0,37,232,231,120,72,37,39,128,121,47,232,121,128,104,69,67,175,171,148,157,154,155,118,50,101,73,39,40,9,151,108,48,115,131,194,204,211,74,40,185,80,42,183,40,92,186,230,229,118,202,212,214,83,18,17,76,61,146,160,29,30,56,157,173,106,204,194,135,214,192,203,165,98,21,71,68,51,45,4,144,24,23,77,146,91,205,50,187,201,200,18,91,106,182,90,91,181,85,84,17,206,203,36,148,171,140,92,40,39,193,189,244,159,158,28,247,246,161,236,3,196,54,68,104,193,168,8,117,228,31,189,193,55,98,97,99,126,47,100,166,79,218,155,154,26,209,49,131,135,136,150,47,126,217,223,52,53,45,51,134,211,170,140,67,69,108,43,106,91,230,119,120,226,130,247,63,53,52,238,20,242,46,70,156,78,62,96,46,53,63,143,34,227,173,155,133,123,117,111,44,125,19,236,134,51,216,206,205,154,153,22,39,37,167,200,201,208,36,142,100,57,212,202,20,60,99,28,158,157,35,226,113,160,159,27,204,202,210,113,225,46,43,202,204,62,76,77,137,123,116,41,38,72,203,129,142,64,98,240,49,102,64,41,73,74,212,216,207,42,74,184,169,170,211,170,149,176,105,66,69,122,6,168,123,147,187,96,77,90,65,55,107,89,90,180,101,100,120,63,105,104,93,137,227,15,86,85,129,102,49,14,87,86,55,8,9,100,47,121,145,23,22,88,89,179,6,122,196,88,95,96,138,172,136,215,58,172,115,48,219,42,80,81,195,3,51,43,146,61,171,175,199,81,82,38,53,46,225,144,163,110,246,33,7,52,65,66,229,228,117,34,127,234,107,108,69,109,108,151,48,64,235,62,78,191,129,209,126,111,35,143,163,161,246,117,123,50,222,65,52,19,125,141,221,55,65,3,195,197,25,7,33,220,237,44,70,71,139,122,193,245,247,130,33,71,21,162,153,158,159,170,169,150,188,174,196,216,186,92,144,160,161,2,97,167,141,125,241,164,167,37,72,38,12,145,159,160,38,82,13,63,68,71,226,35,111,158,153,154,101,50,205,206,92,165,209,198,217,165,167,97,220,115,218,133,112,243,239,238,241,214,135,169,190,173,133,171,208,32,125,44,237,86,87,178,85,86,179,84,85,180,83,84,181,201,83,182,137,93,132,76,62,183,61,76,184,57,61,185,212,57,186,214,207,187,34,143,156,79,239,237,123,137,177,44,1,4,201,194,32,64,102,129,213,215,138,59,166,219,242,99,97,2,94,141,75,59,235,24,110,228,25,130,226,23,24,229,22,23,230,26,22,231,112,26,232,189,190,243,221,56,190,28,56,221,27,28,222,29,27,223,30,29,224,247,30,225,238,79,20,166,59,75,60,75,240,147,177,215,20,79,166,187,147,213,112,233,244,233,128,245,128,114,188,114,217,174,131,115,220,217,198,236,198,131,134,177,132,58,143,35,124,110,163,7,228,110,25,356,389,368,11,302,267,452,350,349,302,303,269,357,343,277,452,453,357,333,332,297,175,152,377,384,398,382,347,348,330,303,304,270,9,336,337,278,279,360,418,262,431,304,408,409,310,415,407,270,409,410,450,348,347,422,430,434,313,314,17,306,307,375,387,388,260,286,414,398,335,406,418,364,367,416,423,358,327,251,284,298,281,5,4,373,374,253,307,320,321,425,427,411,421,313,18,321,405,406,320,404,405,315,16,17,426,425,266,377,400,369,322,391,269,417,465,464,386,257,258,466,260,388,456,399,419,284,332,333,417,285,8,346,340,261,413,441,285,327,460,328,355,371,329,392,439,438,382,341,256,429,420,360,364,394,379,277,343,437,443,444,283,275,440,363,431,262,369,297,338,337,273,375,321,450,451,349,446,342,467,293,334,282,458,461,462,276,353,383,308,324,325,276,300,293,372,345,447,382,398,362,352,345,340,274,1,19,456,248,281,436,427,425,381,256,252,269,391,393,200,199,428,266,330,329,287,273,422,250,462,328,258,286,384,265,353,342,387,259,257,424,431,430,342,353,276,273,335,424,292,325,307,366,447,345,271,303,302,423,266,371,294,455,460,279,278,294,271,272,304,432,434,427,272,407,408,394,430,431,395,369,400,334,333,299,351,417,168,352,280,411,325,319,320,295,296,336,319,403,404,330,348,349,293,298,333,323,454,447,15,16,315,358,429,279,14,15,316,285,336,9,329,349,350,374,380,252,318,402,403,6,197,419,318,319,325,367,364,365,435,367,397,344,438,439,272,271,311,195,5,281,273,287,291,396,428,199,311,271,268,283,444,445,373,254,339,263,466,249,282,334,296,449,347,346,264,447,454,336,296,299,338,10,151,278,439,455,292,407,415,358,371,355,340,345,372,390,249,466,346,347,280,442,443,282,19,94,370,441,442,295,248,419,197,263,255,359,440,275,274,300,383,368,351,412,465,263,467,466,301,368,389,380,374,386,395,378,379,412,351,419,436,426,322,373,390,388,2,164,393,370,462,461,164,0,267,302,11,12,374,373,387,268,12,13,293,300,301,446,261,340,385,384,381,330,266,425,426,423,391,429,355,437,391,327,326,440,457,438,341,382,362,459,457,461,434,430,394,414,463,362,396,369,262,354,461,457,316,403,402,315,404,403,314,405,404,313,406,405,421,418,406,366,401,361,306,408,407,291,409,408,287,410,409,432,436,410,434,416,411,264,368,383,309,438,457,352,376,401,274,275,4,421,428,262,294,327,358,433,416,367,289,455,439,462,370,326,2,326,370,305,460,455,254,449,448,255,261,446,253,450,449,252,451,450,256,452,451,341,453,452,413,464,463,441,413,414,258,442,441,257,443,442,259,444,443,260,445,444,467,342,445,459,458,250,289,392,290,290,328,460,376,433,435,250,290,392,411,416,433,341,463,464,453,464,465,357,465,412,343,412,399,360,363,440,437,399,456,420,456,363,401,435,288,372,383,353,339,255,249,448,261,255,133,243,190,133,155,112,33,246,247,33,130,25,398,384,286,362,398,414,362,463,341,263,359,467,263,249,255,466,467,260,75,60,166,238,239,79,162,127,139,72,11,37,121,232,120,73,72,39,114,128,47,233,232,128,103,104,67,152,175,148,173,157,155,119,118,101,74,73,40,107,9,108,49,48,131,32,194,211,184,74,185,191,80,183,185,40,186,119,230,118,210,202,214,84,83,17,77,76,146,161,160,30,190,56,173,182,106,194,138,135,192,129,203,98,54,21,68,5,51,4,145,144,23,90,77,91,207,205,187,83,201,18,181,91,182,180,90,181,16,85,17,205,206,36,176,148,140,165,92,39,245,193,244,27,159,28,30,247,161,174,236,196,103,54,104,55,193,8,111,117,31,221,189,55,240,98,99,142,126,100,219,166,218,112,155,26,198,209,131,169,135,150,114,47,217,224,223,53,220,45,134,32,211,140,109,67,108,146,43,91,231,230,120,113,226,247,105,63,52,241,238,242,124,46,156,95,78,96,70,46,63,116,143,227,116,123,111,1,44,19,3,236,51,207,216,205,26,154,22,165,39,167,199,200,208,101,36,100,43,57,202,242,20,99,56,28,157,124,35,113,29,160,27,211,204,210,124,113,46,106,43,204,96,62,77,227,137,116,73,41,72,36,203,142,235,64,240,48,49,64,42,41,74,214,212,207,183,42,184,210,169,211,140,170,176,104,105,69,193,122,168,50,123,187,89,96,90,66,65,107,179,89,180,119,101,120,68,63,104,234,93,227,16,15,85,209,129,49,15,14,86,107,55,9,120,100,121,153,145,22,178,88,179,197,6,196,89,88,96,135,138,136,138,215,172,218,115,219,41,42,81,5,195,51,57,43,61,208,171,199,41,81,38,224,53,225,24,144,110,105,52,66,118,229,117,227,34,234,66,107,69,10,109,151,219,48,235,183,62,191,142,129,126,116,111,143,7,163,246,118,117,50,223,222,52,94,19,141,222,221,65,196,3,197,45,220,44,156,70,139,188,122,245,139,71,162,145,153,159,149,170,150,122,188,196,206,216,92,163,144,161,164,2,167,242,141,241,0,164,37,11,72,12,144,145,160,12,38,13,70,63,71,31,226,111,157,158,154,36,101,205,203,206,165,126,209,217,98,165,97,237,220,218,237,239,241,210,214,169,140,171,32,241,125,237,179,86,178,180,85,179,181,84,180,182,83,181,194,201,182,177,137,132,184,76,183,185,61,184,186,57,185,216,212,186,192,214,187,139,34,156,218,79,237,147,123,177,45,44,4,208,201,32,98,64,129,192,213,138,235,59,219,141,242,97,97,2,141,240,75,235,229,24,228,31,25,226,230,23,229,231,22,230,232,26,231,233,112,232,244,189,243,189,221,190,222,28,221,223,27,222,224,29,223,225,30,224,113,247,225,99,60,240,213,147,215,60,20,166,192,187,213,243,112,244,244,233,245,245,128,188,188,114,174,134,131,220,174,217,236,236,198,134,215,177,58,156,143,124,25,110,7,31,228,25,264,356,368,0,11,267,451,452,349,267,302,269,350,357,277,350,452,357,299,333,297,396,175,377,381,384,382,280,347,330,269,303,270,151,9,337,344,278,360,424,418,431,270,304,409,272,310,407,322,270,410,449,450,347,432,422,434,18,313,17,291,306,375,259,387,260,424,335,418,434,364,416,391,423,327,301,251,298,275,281,4,254,373,253,375,307,321,280,425,411,200,421,18,335,321,406,321,320,405,314,315,17,423,426,266,396,377,369,270,322,269,413,417,464,385,386,258,248,456,419,298,284,333,168,417,8,448,346,261,417,413,285,326,327,328,277,355,329,309,392,438,381,382,256,279,429,360,365,364,379,355,277,437,282,443,283,281,275,363,395,431,369,299,297,337,335,273,321,348,450,349,359,446,467,283,293,282,250,458,462,300,276,383,292,308,325,283,276,293,264,372,447,346,352,340,354,274,19,363,456,281,426,436,425,380,381,252,267,269,393,421,200,428,371,266,329,432,287,422,290,250,328,385,258,384,446,265,342,386,387,257,422,424,430,445,342,276,422,273,424,306,292,307,352,366,345,268,271,302,358,423,371,327,294,460,331,279,294,303,271,304,436,432,427,304,272,408,395,394,431,378,395,400,296,334,299,6,351,168,376,352,411,307,325,320,285,295,336,320,319,404,329,330,349,334,293,333,366,323,447,316,15,315,331,358,279,317,14,316,8,285,9,277,329,350,253,374,252,319,318,403,351,6,419,324,318,325,397,367,365,288,435,397,278,344,439,310,272,311,248,195,281,375,273,291,175,396,199,312,311,268,276,283,445,390,373,339,295,282,296,448,449,346,356,264,454,337,336,299,337,338,151,294,278,455,308,292,415,429,358,355,265,340,372,388,390,466,352,346,280,295,442,282,354,19,370,285,441,295,195,248,197,457,440,274,301,300,368,417,351,465,251,301,389,385,380,386,394,395,379,399,412,419,410,436,322,387,373,388,326,2,393,354,370,461,393,164,267,268,302,12,386,374,387,312,268,13,298,293,301,265,446,340,380,385,381,280,330,425,322,426,391,420,429,437,393,391,326,344,440,438,458,459,461,364,434,394,428,396,262,274,354,457,317,316,402,316,315,403,315,314,404,314,313,405,313,421,406,323,366,361,292,306,407,306,291,408,291,287,409,287,432,410,427,434,411,372,264,383,459,309,457,366,352,401,1,274,4,418,421,262,331,294,358,435,433,367,392,289,439,328,462,326,94,2,370,289,305,455,339,254,448,359,255,446,254,253,449,253,252,450,252,256,451,256,341,452,414,413,463,286,441,414,286,258,441,258,257,442,257,259,443,259,260,444,260,467,445,309,459,250,305,289,290,305,290,460,401,376,435,309,250,392,376,411,433,453,341,464,357,453,465,343,357,412,437,343,399,344,360,440,420,437,456,360,420,363,361,401,288,265,372,353,390,339,249,339,448,255]},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],ZL00j:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"drawWaves",(()=>c)),o.export(n,"drawBars",(()=>d));var a=e("./canvas"),s=e("../palette");o.interopDefault(s);let r=0;const{width:i,height:l}=a.getCanvasDimensions(),c=(e,t)=>{a.canvasContext.lineWidth=2,a.canvasContext.strokeStyle=`hsla(${r}, 100, 150, 0.5)`,a.canvasContext.beginPath(),r=r++%360;const n=1*i/t;let o=0;for(let s=0;s<t;s++){const t=e[s]/128*l/2;0===s?a.canvasContext.moveTo(o,t):a.canvasContext.lineTo(o,t),o+=n}a.canvasContext.lineTo(i,l/2),a.canvasContext.stroke()},d=(e,t)=>{const n=i/t*2;let o,s=0;for(let r=0;r<t;r++)o=e[r],a.canvasContext.fillStyle="hsla("+o/l*360+",50%,50%,0.3)",a.canvasContext.fillRect(s,0,n,o),s+=n+1}},{"./canvas":"2h2QK","../palette":"bNJmu","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"2HWvY":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"drawQuantise",(()=>d));var a=e("../maths/maths"),s=e("../palette"),r=o.interopDefault(s),i=e("./canvas");const{width:l,height:c}=i.getCanvasDimensions(),d=(e,t=-1,n=1,o=30,s=4)=>{const l=c/(n+1);for(let n=0,c=t+1;n<c;++n){let c=0,d=n*l+l;i.canvasContext.fillStyle=n===t?r.default.cream:r.default.orange,i.canvasContext.strokeStyle=n===t?r.default.orange:r.default.brown,i.canvasContext.strokeWidth=o,i.canvasContext.lineWidth=e&&n===t?8:4,i.canvasContext.beginPath(),i.canvasContext.arc(c,d,s,0,a.TAU),i.canvasContext.fill(),i.canvasContext.stroke(),i.canvasContext.closePath()}i.canvasContext.lineWidth=1}},{"../maths/maths":"iDBHd","../palette":"bNJmu","./canvas":"2h2QK","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"3T44M":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n);var a=e("../maths/maths"),s=e("../palette");o.interopDefault(s);n.default=class{constructor(e,t,n,o=!0,a={w:200,h:100}){console.log(typeof e),this.canvas=e,this.context=e.get2dContext("2d"),this.notes=new Map,this.isHorizontal=o,this.createPalette(),this.redrawNecessary=!0}createPalette(e=50,t=50,n=.8,o=256){this.palette=new Array(o).map(((e,t)=>{}))}draw(e){console.log(e);const t=this.context;this.notes.size>0&&this.notes,t.beginPath(),t.arc(0,0,12,0,a.TAU),t.fillStyle="red",t.fill(),t.closePath()}noteOn(e,t="a"){this.notes.get(t)!==e&&(this.notes.set(t,e),this.redrawNecessary=!0)}noteOff(e="a"){this.notes.set(e,-1),this.redrawNecessary=!0}allNotesOff(){this.notes.clear(),this.redrawNecessary=!0}update(e){this.redrawNecessary&&draw()}}},{"../maths/maths":"iDBHd","../palette":"bNJmu","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"6WcRe":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"detectCameras",(()=>s)),o.export(n,"filterVideoCameras",(()=>r)),o.export(n,"fetchVideoCameras",(()=>i)),o.export(n,"setupCamera",(()=>l)),o.export(n,"loadCamera",(()=>c)),o.export(n,"findBestCamera",(()=>d));let a=!1;const s=async()=>navigator.mediaDevices.enumerateDevices(),r=e=>e.filter((e=>"videoinput"===e.kind)),i=async()=>{const e=await s();return r(e)},l=async(e,t)=>new Promise((async(n,o)=>{let a;e=e??document.createElement("video");let s=2;const r=()=>{if(--s<=0)try{e.play(),e.width=e.videoWidth,e.height=e.videoHeight,n(a)}catch(e){o(a)}};e.onloadedmetadata=e=>r(),e.onloadeddata=e=>r(),e.onerror=e=>{console.error("VIDEO:Connection Error",e),o(a)};const i={};t?i.deviceId={exact:t}:i.facingMode="user";const l={video:i,audio:!1};try{a=await navigator.mediaDevices.getUserMedia(l),e.srcObject=a}catch(e){o(e)}})),c=async(e,t,n="Default")=>{let o;a=!0;try{if(!(t&&t.length>0))throw console.log(t,"Camera unfound",{video:e,deviceId:t}),Error("Camera Device not specified "+t);o=await l(e,t)}catch(e){throw e}return a=!1,o},d=async(e,t)=>{let n,o=!1;const a=e.has("camera")?e.getItem("camera").deviceId:void 0,s=await i();if(s.length<1)throw Error("No Cameras found on this device");if(console.log("videoCameraDevices",s),!a)try{return n=await l(t),{camera:n,videoCameraDevices:s,saved:o}}catch(e){}try{n=await c(t,a,"Saved"),o=!0}catch(a){e.removeItem("camera"),o=!1,n=await l(t)}return{camera:n,videoCameraDevices:s,saved:o}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],iikaL:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"EYE_COLOURS",(()=>p));var a=e("./maths/maths"),s=(e("./maths/easing"),e("./timing/timing.js"),e("./audio/audio")),r=e("./audio/notes"),i=e("./audio/instruments"),l=e("./dom/ui"),c=e("./parameter-recorder"),d=e("./visual/2d"),u=e("./visual/2d.eyes"),h=e("./visual/2d.mouth"),m=e("./settings");const p=["blue","green","brown","orange"];n.default=class{constructor(e,t,n,o={}){if(this.options=Object.assign({},m.DEFAULT_PERSON_OPTIONS,o),this.name=e,this.counter=0,this.instrumentPointer=0,this.instrumentLoading=!1,this.data=null,this.active=!1,this.audioContext=t,this.tracks=0,this.octave=4,this.midi=null,this.midiActive=!1,this.midiChannel="all",this.isLooping=!1,this.isPlayingBack=!1,this.setPalette(this.options),this.precision=Math.pow(10,parseInt(this.options.precision)),this.parameterRecorder=new c.ParamaterRecorder(t),this.yaw=0,this.pitch=0,this.roll=0,this.singing=!1,this.isMouthOpen=!1,this.isLeftEyeOpen=!0,this.isRightEyeOpen=!0,this.isRecordingParameters=!1,this.mouseDownAt=-1,this.leftEyeClosedAt=-1,this.rightEyeClosedAt=-1,this.lastNoteName="A0",this.lastNoteSound="-",this.debug=this.options.debug,this.mouthScale=a.rescale(this.options.mouthCutOff),this.gainNode=t.createGain(),this.gainNode.gain.value=0,this.options.stereoPan?(this.stereoNode=t.createStereoPanner(),this.stereoNode.connect(this.gainNode),this.outputNode=this.stereoNode):this.outputNode=this.gainNode,this.options.useDelay){const e=t.createDelay(this.options.delayLength),o=t.createGain();e.delayTime.value=this.options.delayTime,o.gain.value=this.options.feedback,this.gainNode.connect(e),e.connect(n)}else this.gainNode.connect(n);this.button=document.getElementById(e),this.button.addEventListener("mousedown",(e=>{this.mouseDownAt=t.currentTime;const n=()=>{this.mouseDownFor<this.options.mouseHoldDuration?requestAnimationFrame(n):this.isMouseDown&&(this.mouseDownAt=-1,this.showForm())};n(),e.preventDefault()})),this.button.addEventListener("mouseup",(e=>{this.mouseDownFor;this.instrumentLoading||this.loadInstrument(s.randomInstrument()),this.mouseDownAt=-1,e.preventDefault()})),this.button.addEventListener("mouseover",(e=>{this.isMouseOver=!0})),this.button.addEventListener("mouseout",(e=>{this.isMouseOver=!1}))}get areEyesOpen(){return this.isLeftEyeOpen&&this.isRightEyeOpen}get mouseDownFor(){return this.audioContext.currentTime-this.mouseDownAt}get isMouseDown(){return this.mouseDownAt>-1}get isMouseHeld(){return this.options.mouseHoldDuration<this.mouseDownFor}get controlsID(){return`${this.name}-controls`}get controls(){return document.getElementById(this.controlsID)}get instrumentName(){return this.instrument?this.instrument.name:"loading"}get instrumentTitle(){return this.instrument?this.instrument.title:"loading"}get instrumentIndex(){return i.INSTRUMENT_FOLDERS.indexOf(this.instrumentName)}get hasMIDI(){return null!==this.midi&&this.midiChannel&&this.midiChannel.length>0}get MIDIDeviceName(){return this.midi?this.midi.name:"unknown"}get history(){return this.parameterRecorder.recording}setPalette(e){this.saturation=e.saturation,this.luminosity=e.luminosity,this.hueRange=e.hueRange,this.hue=e.hue??Math.random()*this.hueRange}update(e){this.counter++,this.data=e,this.isRecordingParameters&&this.parameterRecorder.save(e),this.isLeftEyeOpen!==!e.leftEyeClosed&&(e.leftEyeClosed?this.onLeftEyeClose(e.time):this.onLeftEyeOpen(e.time-this.leftEyeClosedAt),this.isLeftEyeOpen=!e.leftEyeClosed),this.isRightEyeOpen!==!e.rightEyeClosed&&(e.rightEyeClosed?this.onRightEyeClose(e.time):this.onRightEyeOpen(e.time-this.rightEyeClosedAt),this.isRightEyeOpen=!e.rightEyeClosed)}draw(e,t=!0,n=!1,o=!1){if(!(n||e||this.prediction||this.isPlayingBack))return;e&&!n||(e=this.prediction),this.isPlayingBack;let s=this.hue;this.instrumentLoading&&(s+=120);const i=this.options,l=this.isRightEyeOpen?-1:e.time-this.rightEyeClosedAt,c=this.isLeftEyeOpen?-1:e.time-this.leftEyeClosedAt,m=`${i.saturation}%, ${i.luminosity+(o?10:0)}%`;i.mouth=`hsla(${(s+30)%360},${m},0.8)`,i.mouthClosed=`hsla(${(s+30)%360},${m},0.9)`,i.lipsUpperInner=`hsla(${(s+50)%360},${m},1)`,i.lipsLowerInner=`hsla(${(s+50)%360},${m},1)`,i.midwayBetweenEyes=`hsla(${(s+270)%360},${m},1)`,i.leftEyeLower0=`hsla(${(s+300)%360},${m},0.8)`,i.rightEyeLower0=`hsla(${(s+300)%360},${m},0.8)`,i.leftEyeIris=`hsla(${(this.isLeftEyeOpen?s+90:s-90)%360},${i.saturation}%,${i.luminosity}%, 1)`,i.rightEyeIris=`hsla(${(this.isRightEyeOpen?s+90:s-90)%360},${i.saturation}%, ${i.luminosity}%, 1)`;const p={h:s,s:i.saturation,l:i.luminosity,a:1};if(i.drawMask&&(i.drawNodes||i.drawMesh||!i.meshOnSing?i.drawNodes?d.drawPoints(e,p,3,this.instrumentLoading,this.debug):i.drawMesh&&d.drawFaceMesh(e,p,.5,this.instrumentLoading,this.isMouthOpen,this.debug):this.singing?d.drawFaceMesh(e,p,.5,this.instrumentLoading,this.isMouthOpen,this.debug):d.drawPoints(e,p,3,this.instrumentLoading,this.debug)),i.drawMouth){const t={h:s,s:i.saturation,l:i.luminosity,a:1},n={h:s,s:i.saturation,l:20,a:1};this.isMouthOpen&&this.singing?h.drawMouth(e,t,this.debug):h.drawMouth(e,n,this.debug)}const{bottomRight:g,topLeft:f}=e.boundingBox,v=Math.abs(g[0]-f[0]),b=Math.abs(g[1]-f[1]);this.counter%22==0&&this.button.setAttribute("style",`--${this.name}-x:${g[0]};--${this.name}-y:${f[1]};--${this.name}-w:${v};--${this.name}-h:${b};`);const{annotations:y}=e,{silhouette:x}=y;if((this.instrumentLoading||this.isRightEyeOpen||this.isLeftEyeOpen?-1:Math.max(c,l))>i.eyeShutHolddDuration)this.leftEyeClosedAt=e.time,this.rightEyeClosedAt=e.time,this.loadNextInstrument((e=>console.log("instrumnetName",e)));else if(i.drawEyes){const t={iris:i.leftEyeIris,irisRadius:i.irisRadius,pupil:"rgba(0,0,0,0.8)",pupilRadius:i.pupilRadius,sclera:"white",scleraRadius:i.scleraRadius,ratio:i.eyeRatio},n=a.clamp(e.eyeDirection,-1,1);u.drawEye(y,!0,this.isLeftEyeOpen,n,t),t.iris=i.rightEyeIris,u.drawEye(y,!1,this.isRightEyeOpen,n,t)}if(t)if(this.isMouseOver||this.instrumentLoading)if(this.isMouseDown&&!this.instrumentLoading){const t=1-this.mouseDownFor/this.options.mouseHoldDuration,n=100-Math.ceil(100*t);this.isMouseHeld?(d.drawInstrument(e.boundingBox,this.instrumentTitle,"Select"),d.drawPart(x,4,`hsla(${s},50%,${n}%,0.3)`,!0,!1,!1),d.drawParagraph(e.boundingBox.topLeft[0],e.boundingBox.topLeft[1]+40,["Press me"],"14px")):(d.drawInstrument(e.boundingBox,this.instrumentTitle,""+(100-n)),d.drawPart(x,4,`hsla(${s},50%,${n}%,${t})`,!0),d.drawParagraph(e.boundingBox.topLeft[0],e.boundingBox.topLeft[1]+40,["Hold me to see all instruments"],"14px"))}else d.drawInstrument(e.boundingBox,this.instrumentTitle,"Hold to choose instrument"),d.drawPart(x,4,"hsla("+s+",50%,50%,0.3)",!0);else if(this.instrumentLoading)d.drawInstrument(e.boundingBox,this.instrumentTitle,"loading...");else{const t=(this.debug,` ${r.getNoteText(this.lastNoteName)}`),n=this.singing?`| ♫ ${this.lastNoteSound}`:this.isMouthOpen?"<":"-";if(d.drawInstrument(e.boundingBox,this.instrumentTitle,`${t} ${n}`),this.debug){const t=[`Gain:${this.gainNode.gain.value.toFixed(2)}`,`Happiness:${e.happiness.toFixed(3)}`,`Smirks left:${e.leftSmirk.toFixed(3)} / right:${e.rightSmirk.toFixed(3)}`,`mouthRange:${e.mouthRange.toFixed(3)}`,`mouthRatio:${e.mouthRatio.toFixed(3)}`,`mouthWidth:${e.mouthWidth.toFixed(3)}`,`mouthOpen:${e.mouthOpen.toFixed(3)}`,`pitch:${e.pitch.toFixed(3)} roll:${e.roll.toFixed(3)} yaw:${e.yaw.toFixed(3)}`,`eyes direction:${e.eyeDirection.toFixed(3)} left:${e.leftEye.toFixed(3)} right:${e.rightEye.toFixed(3)}`,`eyes open :${this.areEyesOpen} left:${!e.leftEyeClosed} right:${!e.rightEyeClosed}`,`eye closed left:${e.leftEyeClosed} right:${e.rightEyeClosed}`,`dims:${e.mouthWidth.toFixed(2)}x${e.mouthRange.toFixed(2)}`,(e.lookingRight,"left")];d.drawParagraph(e.boundingBox.topLeft[0],e.boundingBox.topLeft[1]+40,t,"14px")}}}sing(){if(!this.data||this.tracks>18)return{yaw:0,pitch:0,roll:0,lipPercentage:0,eyeDirection:0};const e=[],t=this.data,n=this.options,o=t.mouthOpen,i=t.yaw,l=a.clamp(.5*(t.pitch+1)*this.options.pitchSensitivity,0,1),c=a.clamp((t.roll+.5)*this.options.rollSensitivity,0,1),d=this.options.swapControls?c:l,u=this.options.swapControls?l:c,h=a.clamp(t.eyeDirection,-1,1),m=a.clamp(1.6*o,0,1),p=Math.round(7*d);this.octave=a.clamp(p,1,7);const g=t.lookingRight,f=r.getNoteName(u,this.octave,g),v=r.getNoteSound(u,g);let b;if(this.lastNoteName=f,this.lastNoteSound=v,this.hue=u*this.hueRange,this.saturation=100*o,this.options.stereoPan&&(this.stereoNode.pan.value=h),this.instrument&&m>=n.mouthCutOff){const t=this.instrument[f];t||console.log("note not found!",{noteName:f,roll:u,octave:this.octave,isMinor:g}),this.tracks++;s.playTrack(t,0,this.outputNode).then((()=>{this.active=!1,this.tracks--}));if(e.push(t),b=this.mouthScale(m),b=n.ease(b),b=Math.round(b*this.precision)/this.precision,this.options.sendMIDI&&this.hasMIDI){const e={};"all"!==this.midiChannel&&(e.channel=this.midiChannel),this.midi.playNote(f,e),console.log(this.midi,"MIDI noteOn",f,"Channel:"+this.midiChannel,{newVolume:b,midiOptions:e,channel:this.midiChannel,hasMIDI:this.hasMIDI}),this.midiActive||(this.midiActive=!0),0!==h&&this.midi.sendKeyAftertouch(f,.5*(h+1))}this.singing=!0,this.isMouthOpen=!0,this.active=!0}else m>n.mouthSilence&&m<n.mouthCutOff?(b=0,this.singing=!1,this.isMouthOpen=!0):(b=0,this.singing=!1,this.isMouthOpen=!1);return this.options.sendMIDI&&this.hasMIDI&&(this.midi.sendClock(),this.singing||(this.midi.stopNote(f,{release:.2}),this.midiActive=!1)),this.gainNode.gain.value=b,this.yaw=i,this.pitch=d,this.roll=u,{played:e,yaw:i,pitch:d,roll:u,lipPercentage:o,eyeDirection:h}}async loadRandomInstrument(e){return await this.loadInstrument(s.randomInstrument(),e)}async loadPreviousInstrument(e){const t=this.instrumentPointer,n=t-1<0?0:t-1;return await this.loadInstrument(i.INSTRUMENT_FOLDERS[n],e)}async loadNextInstrument(e){const t=this.instrumentPointer,n=t+1>=i.INSTRUMENT_FOLDERS.length?0:t+1;return await this.loadInstrument(i.INSTRUMENT_FOLDERS[n],e)}async reloadInstrument(e){return await this.loadInstrument(i.INSTRUMENT_FOLDERS[this.instrumentPointer],e)}async loadInstrument(e,t){return this.instrumentLoading=!0,this.instrument=await s.loadInstrumentPack(e,this.options.instrumentPack),this.instrumentPointer=i.INSTRUMENT_FOLDERS.indexOf(e),this.instrumentLoading=!1,t&&t(e),this.button.dispatchEvent(new CustomEvent("instrumentchange",{detail:{instrument:this.instrument,instrumentName:e}})),e}setMIDI(e,t="all"){this.midiChannel=t,this.midi=e,console.log("MIDI set for person",this,"Channel:"+this.midiChannel,{midi:e,channel:t,hasMIDI:this.hasMIDI})}onInstrumentInput(e){const t=e.target.id;this.hideForm(),this.loadInstrument(t),e.preventDefault()}onLeftEyeOpen(e){this.leftEyeClosedAt=-1}onLeftEyeClose(e){this.leftEyeClosedAt=e}onRightEyeOpen(e){this.rightEyeClosedAt=-1}onRightEyeClose(e){this.rightEyeClosedAt=e}showForm(){this.controls.innerHTML=l.setupInstrumentForm((()=>{}));this.controls.querySelectorAll("input").forEach((e=>e.addEventListener("change",(e=>this.onInstrumentInput(e)))),!1);const e=document.getElementById(this.instrumentName);e?e.focus():this.controls.focus(),this.controls.classList.toggle("showing",!0)}hideForm(){this.controls.innerHTML="",setTimeout((()=>this.controls.classList.toggle("showing",!1)),303)}}},{"./maths/maths":"iDBHd","./maths/easing":"8aGct","./timing/timing.js":"adRuD","./audio/audio":"kGLQw","./audio/notes":"5HewV","./audio/instruments":"ftlvJ","./dom/ui":"dAURW","./parameter-recorder":"gRdVk","./visual/2d":"2Ac2W","./visual/2d.eyes":"fpOBR","./visual/2d.mouth":"kijht","./settings":"h7RGC","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],gRdVk:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"ParamaterRecorder",(()=>a));class a{constructor(e,t={}){this.isRecording=!1,this.context=e,this.parameters,this.startTime}get recording(){return this.parameters}get isActive(){return this.isRecording}reset(){this.parameters={}}save(e){let t=this.context.currentTime;this.isRecording||(this.startTime=t,this.isRecording=!0);const n=this.startTime-t;this.parameters[n]=parameters}getValuesAtTime(e){return this.parameters[e]}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],fpOBR:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"drawEye",(()=>l));var a=e("./canvas"),s=e("../maths/maths"),r=e("../palette");o.interopDefault(r);const i={iris:"rgba(100,255,100,0.8)",irisRadius:1,pupil:"rgba(0,0,0,0.8)",pupilRadius:.3,sclera:"white",scleraRadius:4},l=(e,t=!0,n=!0,o=0,r=i)=>{const l=t?e.leftEyeIris:e.rightEyeIris,c=l[0],d=l[1],u=l[2],h=l[3],m=l[4],p=Math.abs(h[0]-d[0]),g=m[1]-u[1],f=r.ratio||.8,v=.5*Math.max(p,g);if(a.canvasContext.strokeWidth=0,n){const e=v*r.scleraRadius,t=v*r.irisRadius,n=v*r.pupilRadius,i=(e-t)*-o;a.canvasContext.beginPath(),a.canvasContext.arc(c[0]+i,c[1],e,0,s.TAU),a.canvasContext.fillStyle=r.sclera,a.canvasContext.fill(),a.canvasContext.closePath(),a.canvasContext.beginPath(),a.canvasContext.fillStyle=r.iris,a.canvasContext.arc(c[0],c[1],t,0,s.TAU*f),a.canvasContext.lineTo(c[0],c[1]),a.canvasContext.fill(),a.canvasContext.closePath(),a.canvasContext.beginPath(),a.canvasContext.fillStyle=r.pupil,a.canvasContext.arc(c[0],c[1],n,0,s.TAU*f),a.canvasContext.fill()}else{const n=t?e.leftEyeLower0:e.rightEyeLower0;a.canvasContext.beginPath(),a.canvasContext.lineStyle=r.iris,a.canvasContext.fillStyle=r.pupil,a.canvasContext.moveTo(n[0][0],n[0][1]),a.canvasContext.lineTo(n[4][0],n[4][1]),a.canvasContext.lineTo(n[6][0],n[6][1]),a.canvasContext.closePath(),a.canvasContext.stroke(),a.canvasContext.fill()}}},{"./canvas":"2h2QK","../maths/maths":"iDBHd","../palette":"bNJmu","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],kijht:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"drawMouth",(()=>l));var a=e("../palette"),s=o.interopDefault(a),r=e("./canvas"),i=e("./2d");const l=(e,t={h:90,s:50,l:50,a:.6},n=!0)=>{const{annotations:o,mouthRange:a,mouthWidth:l,mouthOpen:c}=e,{lipsUpperInner:d,lipsLowerInner:u}=o,h=[d,u],m=`hsla(${t.h},${t.s}%,${t.l}%, ${t.a})`,p=`hsla(${t.h},${t.s}%,10%, ${t.a})`,g=d[5],f=u[5],v=r.canvasContext.createLinearGradient(0,0,l,a);v.addColorStop(0,m),v.addColorStop(.5,p),v.addColorStop(1,m),r.canvasContext.lineWidth=2,r.canvasContext.strokeStyle=p,r.canvasContext.beginPath(),r.canvasContext.moveTo(d[0][0],d[0][1]),r.canvasContext.fillStyle=v;for(let e=0,t=h.length;e<t;e++){const t=h[e];for(let e=0,n=t.length;e<n;e++){const n=t[e][0],o=t[e][1];r.canvasContext.lineTo(n,o)}}return r.canvasContext.closePath(),r.canvasContext.fill(),r.canvasContext.stroke(),n&&(i.drawNode(f,g,5),r.canvasContext.fillStyle=s.default.blue,r.canvasContext.font="12px Oxanium",r.canvasContext.textAlign="center",r.canvasContext.fillText(`${Math.floor(a)}px`,f[0],f[1]-20)),r.canvasContext.stroke(),r.canvasContext.lineWidth=1,{lipUpperMiddle:g,lipLowerMiddle:f}}},{"../palette":"bNJmu","./canvas":"2h2QK","./2d":"2Ac2W","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],cy5zR:[function(e,t,n){t.exports=Promise.all([e("./helpers/browser/js-loader")(e("./helpers/bundle-url").getBundleURL("dQYJg")+e("./helpers/bundle-manifest").resolve("5AKhY")),e("./helpers/browser/js-loader")(e("./helpers/bundle-url").getBundleURL("dQYJg")+e("./helpers/bundle-manifest").resolve("257vJ"))]).then((()=>t.bundle.root("4Cz1G")))},{"./helpers/browser/js-loader":"7mk4K","./helpers/bundle-url":"bGZ1f","./helpers/bundle-manifest":"6jNRu"}],bqoAJ:[function(e,t,n){t.exports=Promise.all([e("./helpers/browser/js-loader")(e("./helpers/bundle-url").getBundleURL("dQYJg")+e("./helpers/bundle-manifest").resolve("5AKhY")),e("./helpers/browser/js-loader")(e("./helpers/bundle-url").getBundleURL("dQYJg")+e("./helpers/bundle-manifest").resolve("d5l0U"))]).then((()=>t.bundle.root("gi7kh")))},{"./helpers/browser/js-loader":"7mk4K","./helpers/bundle-url":"bGZ1f","./helpers/bundle-manifest":"6jNRu"}],hZVlD:[function(e,t,n){t.exports=e("./helpers/browser/js-loader")(e("./helpers/bundle-url").getBundleURL("dQYJg")+e("./helpers/bundle-manifest").resolve("ht3Pg")).then((()=>t.bundle.root("kq8Be")))},{"./helpers/browser/js-loader":"7mk4K","./helpers/bundle-url":"bGZ1f","./helpers/bundle-manifest":"6jNRu"}],lXYFz:[function(e,t,n){t.exports=e("./helpers/browser/js-loader")(e("./helpers/bundle-url").getBundleURL("dQYJg")+e("./helpers/bundle-manifest").resolve("gm5sg")).then((()=>t.bundle.root("2GQJM")))},{"./helpers/browser/js-loader":"7mk4K","./helpers/bundle-url":"bGZ1f","./helpers/bundle-manifest":"6jNRu"}],lzm9X:[function(e,t,n){t.exports=e("./helpers/browser/js-loader")(e("./helpers/bundle-url").getBundleURL("dQYJg")+e("./helpers/bundle-manifest").resolve("blv9t")).then((()=>t.bundle.root("kuYJW")))},{"./helpers/browser/js-loader":"7mk4K","./helpers/bundle-url":"bGZ1f","./helpers/bundle-manifest":"6jNRu"}]},[]);