- var URL = "https://interface.place"

mixin title( page="", section="", seperator="-" )
	- page = page.length ? `${page} ${seperator} ` : page
	- section = section.length ? `${section} ${seperator}` : ``
	title #{page}InterFACE V
			include version.txt
			|  #{seperator} #{section}designerzen

doctype html
html(lang="en-GB" dir="ltr")
	head
		meta(charset="utf-8")
		block title 
			+title()

		//- meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"> 
		meta(name="viewport", content="viewport-fit=cover,width=device-width,initial-scale=1")
		meta(name="description", content="Face synth")
		//- Imports the manifest to represent the web application. A web app must have a manifest to be a PWA. 
		link(rel="manifest", href="manifest.webmanifest")
		link(rel="stylesheet", href="index.scss", type="text/css")
		//-
			- 1. Preemptively warm up the fonts’ origin.
			-
			- 2. Initiate a high-priority, asynchronous fetch for the CSS file. Works in
			-    most modern browsers.
			-
			- 3. Initiate a low-priority, asynchronous fetch that gets applied to the page
			-    only after it’s arrived. Works in all browsers with JavaScript enabled.
			-
			- 4. In the unlikely event that a visitor has intentionally disabled
			-    JavaScript, fall back to the original method. The good news is that,
			-    although this is a render-blocking request, it can still make use of the
			-    preconnect which makes it marginally faster than the default.
			
		//-  https://csswizardry.com/2020/05/the-fastest-google-fonts/ 
		//-  https://fonts.gstatic.com is the font file origin 
		//-  It may not have the same origin as the CSS file (https://fonts.googleapis.com) 
		link(rel="preconnect", href="https://fonts.gstatic.com", crossorigin)
		//-  We use the full link to the CSS file in the rest of the tags 
		link(rel="preload", as="style", href="https://fonts.googleapis.com/css2?family=Oxanium:wght@774&display=swap")
		link(rel="stylesheet", href="https://fonts.googleapis.com/css2?family=Oxanium:wght@774&display=swap", media="print", onload="this.media=\'all\'")
		noscript
			link(rel="stylesheet", href="https://fonts.googleapis.com/family=Oxanium:wght@774&display=swap")
		
		//- ENTRY POINT
		block scripts
			script.
				document.documentElement.classList.add("loading")
			
			script(type="module", src="index.js", rel="preload")
		
		//-  These meta tags are Apple-specific, and set the web application to run in full-screen mode with a black status bar. Learn more at https://developer.apple.com/library/archive/documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html
		meta(name="apple-mobile-web-app-capable", content="yes")
		meta(name="apple-mobile-web-app-title", content="Face synth")
		meta(name="apple-mobile-web-app-status-bar-style", content="black")
		//-  Imports an icon to represent the document. 
		link(rel="icon", href="assets/icons/android-chrome-24x24.png", type="image/x-icon")
		link(rel="icon", type="image/png", sizes="32x32", href="assets/icons/favicon-32x32.png")
		link(rel="icon", type="image/png", sizes="16x16", href="assets/icons/favicon-16x16.png")
		link(rel="apple-touch-icon", sizes="180x180", href="assets/icons/apple-touch-icon.png")
		link(rel="mask-icon", href="assets/icons/safari-pinned-tab.svg", color="#5bbad5")
		meta(name="msapplication-TileColor", content="#e4dede")
		meta(name="theme-color", content="#e4dede")
		meta(property="og:image", content="assets/icons/og-image.jpg")
		meta(property="og:image:height", content="268")
		meta(property="og:image:width", content="512")
		meta(property="og:description", content="A face controlled musical instrument that uses a video camera.")
		meta(property="og:title", content="InterFACE")
		meta(property="og:url", content=URL)

	body
		header#intro

			a.logo(href="#app") Jump directly to the app
				svg(viewBox="0 250 1024 525", xmlns="http://www.w3.org/2000/svg", fill-rule="evenodd", clip-rule="evenodd", stroke-linejoin="round", stroke-miterlimit="2")
					path(d="M964.328 297.987c0-13.422-10.881-24.303-24.303-24.303H83.975c-13.422 0-24.303 10.881-24.303 24.303 0 249.647 202.681 452.329 452.328 452.329 249.647 0 452.328-202.682 452.328-452.329zM547.554 408.558c-3.13-5.733-6.425-24.402-6.477-27.806a69.885 69.885 0 01-.007-1.021c0-29.1 17.832-54.611 42.519-54.611.219 0 .437.002.657.006 51.771 1.091 127.112 98.276 127.112 180.321 0 106.759-89.329 193.433-199.358 193.433-110.029 0-199.358-86.674-199.358-193.433 0-82.045 60.46-178.916 127.112-180.321.22-.004.438-.006.657-.006 24.687 0 42.519 25.511 42.519 54.611 0 .339-.002.678-.008 1.021-.052 3.414-3.337 22.076-6.463 27.799-7.286 13.337-16.034 24.491-19.108 28.25-.229.208-.441.414-.632.618-11.709 12.468-24.732 24.319-34.919 37.629-13.209 17.259-22.108 36.721-22.108 60.911 0 63.484 50.321 115.025 112.304 115.025 61.982 0 112.303-51.541 112.303-115.025 0-24.539-8.769-43.17-22.039-60.106-9.833-12.549-22.591-24.032-34.534-37.73-.769-.906-11.506-13.689-20.172-29.565zm-84.094 24.073c2.257-1.292 4.121-2.192 4.121-2.192s-1.818.678-2.673 1.084l-1.448 1.108z")
				
			h1
				| Inter
				strong FACE
			h2
				em Smile
				|  Powered Synthesizer

			p(aria-label="Summary").
				An experiment in computer control by <a href="https://designerzen.com">designerzen</a>. 
				By allowing your webcamera access, every movement of your face and mouth will control aspects of music. 
				Pressing the screen or holding your eyes closed will change instruments.
			
			p.warning 
				strong Warning:
				| Please be careful if you are photosensitive
			
			label#progress-bar(for="progress") Please wait, loading takes some time...
				progress(min=0 max=1)#progress

		block nav
			nav 
				ul 
					li: a(href="#fund") Fund
					li: a(href="#help" onclick="window.help.showModal();") Help
		
		block main
			main#app
				h3#title Please have patience
				p#feedback Loading takes a long time
				p#toast
				
				#app-frame
					//- img#face(src="assets/will.png", width="640", height="480")
					video#webcam(autoplay, playsinline, width="640", height="480")
						p No Video available!

					canvas(width="640", height="480")
					
					form#onboard(action="/") 
						
						fieldset#player-selector
							legend How many people are going to participate?
							//- button#button-solo( aria-label="Single player mode" ) <strong>Solo</strong> : 1 Player
							//- button#button-duet( aria-label="<strong>DUET</strong> mode!<br>Invite a friend and play together" ) <strong>Duet</strong> : 2 Players
							//- button#button-trio( aria-label="Swap to <strong>multiplayer</strong> mode!<br>Invite all your friend and play together" ) <strong>Trio</strong> : 3 People
							

							//- https://adrianroselli.com/2020/01/my-priority-of-methods-for-labeling-a-control.html
							label(for="button-solo") <strong>Solo</strong> : 1 Player
								input#button-solo(name="players" type="radio" aria-label="Single player mode" checked)
							label(for="button-duet") <strong>Duet</strong> : 2 Players
								input#button-duet(name="players" type="radio" aria-label="<strong>DUET</strong> mode!<br>Invite a friend and play together" )
							label(for="button-trio") <strong>Trio</strong> : 3 People
								input#button-trio(name="players" type="radio" aria-label="Swap to <strong>multiplayer</strong> mode!<br>Invite all your friend and play together" )
							
							//- Simple / Advanced mode
							label(for="toggle-advanced-mode" aria-label="Show advanced mode and features" ) Simple Mode
								input(type="checkbox" checked)#toggle-advanced-mode
				
						//- Start buttons
						//- button#button-start()
						label(for="button-start" ) Start the fun
							input#button-start( type="submit" value="Start")
					
					form#controls(action="/") 

						//- Button is the face of the user
						button.person#person-a Change instrument for the person on the left
						//- Fieldset that fills with instruments 
						// FIXME: ADD ARIA
						fieldset.person-controls#person-a-controls
						
						//- Same for Player 2
						button.person#person-b Change instrument for the person on the right 
						// FIXME: ADD ARIA
						fieldset.person-controls#person-b-controls

						//- fieldset#shared-settings
							
						//- 	//- Equipment Settings 
						//- 	//- TODO: Put into a dialog?
						//- 	label#camera(for="select-camera") <span class="hide-text">Select </span>Camera
						//- 		select(aria-label="Select a different camera")#select-camera
							
						//- 	button#button-midi(aria-label="Connect a MIDI instrument and click here") MIDI<span id="midi-device">Connected</span>
						//- 	//- button#load-midi( aria-label="Load in a MIDI file" ) Load MIDI File
						

						//- Controls for all players
						fieldset#shared-controls

							legend Shared controls that apply to all players

							button#button-help( aria-label="Show help screen" onclick="window.help.showModal();" ) Help!<span class="hide-text"> me</span>
													
							//- Equipment Settings 
							//- TODO: Put into a dialog?
							label#camera(for="select-camera") <span class="hide-text">Select </span>Camera
								select(aria-label="Select a different camera")#select-camera
							
							button#button-midi(aria-label="Connect a MIDI instrument and click here") MIDI<span id="midi-device">Connected</span>
							//- button#load-midi( aria-label="Load in a MIDI file" ) Load MIDI File
							
							label(for="button-metronome") <span class="hide-text">Toggle </span>Metronome
								input(type="checkbox" aria-label="Play a metronome to help you keep time")#button-metronome
						
							label(for="button-quantise") Quantise
								input(type="checkbox" aria-label="Ensure that the notes are played at regular intervals")#button-quantise

							button#button-record.hide(aria-label="Record a loop or two" ) Record Loop
		
							
							label(for="button-clear") Clear
								input(type="checkbox" aria-label="Clear visuals")#button-clear
							
							label(for="button-transparent") Synch<span class="hide-text">ronise</span>
									input(type="checkbox" aria-label="Synch video to movements")#button-transparent
								
							button#button-photograph( aria-label="Take a photograph" ) <span class="hide-text">Take </span>Photo<span class="hide-text">graph</span>
							
							label(for="button-spectrogram") U.V.<span class="hide-text"> Spectrogram</span>
								input(type="checkbox" aria-label="Show a funky bar chart of frequencies")#button-spectrogram
							
							
							label(for="button-overlay" ) Overlay<span class="hide-text"> virtual reality</span>
								input(type="checkbox" aria-label="Toggle augmented reality mode")#button-overlay
							
							//button#button-percussion( aria-label="Toggle the backing track" ) Backing track
							//button#button-donk( aria-label="Put a donk on it" ) Add Donk
							//button#button-cowbell( aria-label="More cowbell!" ) Add Cowbell
							
							//- button#toggle-synth( aria-label="Swap between synth and samples" ) Swap Engines
							
							label.hide-text(for="button-fullscreen") Toggle Fullscreen
								input(type="checkbox"  aria-label="Toggle full screen mode")#button-fullscreen
							
							button#share.hide-text( aria-label="Share this with your friends" onclick="document.getElementById('share-menu').share()" ) Share
						
							//- label(for="input-tempo" aria-label="Set the tempo" ) Tempo
							//- 	input(type="number" value="1")#input-tempo
							//- 	input(type="button")#input-tempo-increase
							//- 	input(type="button")#input-tempo-decrease
							
							//- Drop up / down list of tempos with typeable option too
							//- label(for="set-tempo") <span class="hide-text">Set </span>Tempo
							//- 	input(list="tempos")
							//- 	datalist#tempos
							//- 		option( value="45 BPM")
							//- 		option( value="60 BPM")
							//- 		option( value="75 BPM")
							//- 		option( value="85 BPM")
							//- 		option( value="90 BPM")
							//- 		option( value="95 BPM")
							//- 		option( value="100 BPM")
							//- 		option( value="110 BPM")
							//- 		option( value="120 BPM")
							//- 		option( value="130 BPM")
							//- 		option( value="140 BPM")
							//- 		option( value="150 BPM")
							//- 		option( value="170 BPM")
							//- 		option( value="200 BPM")
							//- 		option( value="300 BPM")
							//- 		option( value="400 BPM")
							//- 		option( value="500 BPM")
									
							label(for="select-tempo") <span class="hide-text">Set </span>Tempo
								select#select-tempo(aria-label="Choose a tempo from the list")
									//- optgroup Select Tempo
									option 45 BPM
									option 60 BPM
									option 75 BPM
									option 85 BPM
									option 90 BPM
									option 100 BPM
									option 110 BPM
									option 120 BPM
									option 130 BPM
									option 140 BPM
									option 150 BPM
									option 200 BPM
									option 300 BPM
									option 400 BPM
									option 500 BPM
							
						

						button#button-video Swap instruments for all people
						
						//- Once the user has taken some photos they appear here
						result#photographs
				
				//- Help Overlay
				dialog#help 
					h5 Don't Panic!
					p Breath in!
					p Version 
						include version.txt

					a(href="help.pug" target="_blank") Open Documentation

					form(method="dialog")
						button Close Help

				//- TODO:
				section#fund
				
					a(href="https://www.designerzen.com/" rel="noopener noreferrer" target="_blank") Contact
						include ./assets/logos/designerzen_current-color.svg
					
					a(href="https://www.tensorflow.com/" rel="noopener noreferrer" target="_blank") TensorFlow
						include ./assets/logos/tensorflow-tf.svg
					
					a(href="roadmap.pug" target="_blank") Future Plans & Roadmap
					a(href="https://designerzen.com/patreon" rel="noopener noreferrer" target="_blank") Fund this project on Patreon
						include ./assets/logos/patreon.svg
				
		block footer
			//- Always visible on screen and overlaid on top	
			footer#foot

				ul#associates
					li: a(href="https://www.drakemusic.org/technology/dmlab-community/" rel="noopener noreferrer" target="_blank") Drake Music
						include ./assets/logos/drakemusic.svg
					li: a(href="https://audienceofthefuture.live/interface/" rel="noopener noreferrer" target="_blank") Audience of the Future
						include ./assets/logos/aotf.svg
					li: a(href="https://www.sxsw.com/" rel="noopener noreferrer" target="_blank") SXSW
						include ./assets/logos/sxsw2021.svg
						//- include ./assets/logos/sxsw.svg
					li: a(href="https://www.makermusicfestival.com/" rel="noopener noreferrer" target="_blank") Maker Music Festival
						include ./assets/logos/mmf.svg

				small(class="copyright") Copyright 
					span#year 2020-#{year||2021}
					
					a.brand(href="https://designerzen.com/" rel="noopener noreferrer" target="_blank") 
						include ./assets/logos/designerzen_current-color.svg
						| designerzen 
					
					a.licenses(href="licenses.pug" target="_blank") Licenses

					//- Dynamically created date get's prepended
					a#version(href="https://github.com/designerzen/interface" rel="noopener noreferrer" target="_blank") V
						include version.txt
							

			//- Generally hidden aspects
			share-menu#share-menu( 
				title="Give the interFACE to your friends and family" 
				text="By clicking the buttons below you can easily share the InterFACE with your friends and family" 
				url=URL
			)

		//-  For users with javascript disabled 
		noscript
			p This application requires javascript to work unfortunately and doesn't do much without it

		//- Global site tag (gtag.js) - Google Analytics
		script( async src="https://www.googletagmanager.com/gtag/js?id=G-1XT0GV0L6J")
		script.
			window.dataLayer = window.dataLayer || [];  
			function gtag(){dataLayer.push(arguments);}  
			gtag('js', new Date());  
			gtag('config', 'G-1XT0GV0L6J');
		