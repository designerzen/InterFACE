var re=(i,m)=>()=>(m||i((m={exports:{}}).exports,m),m.exports);var ae=re((Q,S)=>{(function(i,m,c,n,l){var f=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{},T=typeof f[n]=="function"&&f[n],h=T.cache||{},L=typeof S!="undefined"&&typeof S.require=="function"&&S.require.bind(S);function t(o,_){if(!h[o]){if(!i[o]){var d=typeof f[n]=="function"&&f[n];if(!_&&d)return d(o,!0);if(T)return T(o,!0);if(L&&typeof o=="string")return L(o);var y=new Error("Cannot find module '"+o+"'");throw y.code="MODULE_NOT_FOUND",y}r.resolve=a,r.cache={};var s=h[o]=new t.Module(o);i[o][0].call(s.exports,r,s,s.exports,this)}return h[o].exports;function r(e){var u=r.resolve(e);return u===!1?{}:t(u)}function a(e){var u=i[o][1][e];return u??e}}function O(o){this.id=o,this.bundle=t,this.exports={}}t.isParcelRequire=!0,t.Module=O,t.modules=i,t.cache=h,t.parent=T,t.register=function(o,_){i[o]=[function(d,y){y.exports=_},{}]},Object.defineProperty(t,"root",{get:function(){return f[n]}}),f[n]=t;for(var k=0;k<m.length;k++)t(m[k]);if(c){var E=t(c);typeof Q=="object"&&typeof S!="undefined"?S.exports=E:typeof define=="function"&&define.amd?define(function(){return E}):l&&(this[l]=E)}})({"6D0cH":[function(i,m,c){var n=i("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(c),n.export(c,"loadFaceLandmarksModel",()=>_);var l=i("@mediapipe/tasks-vision"),f=i("./face-landmarks-calculations");const T="https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.0/wasm",h=!1;let L,t,O=0;const k=async d=>{h?t.postMessage({command:"setOptions",options:d}):await L.setOptions(d)};let E=[];const o=async(d,y,s=!0)=>{if(O!==d.currentTime){O=d.currentTime,results=y.detectForVideo(d,Date.now());const r=[];if(results.faceLandmarks){const a=results.faceLandmarks.length;for(let e=0;e<a;++e){const u=results.faceLandmarks[e],H=results.faceBlendshapes[e],U=results.facialTransformationMatrixes[e];h||(r[e]=(0,f.enhanceFaceLandmarksModelPrediction)(u,H,U,O,s))}return E=r,r}}return E},_=async(d,y,s,r=!0)=>{const a=.5,e=.3,u=h?3:2;let H=0,U;const C={baseOptions:{modelAssetPath:"/face_landmarker.task",delegate:"GPU"},...y};if(s&&s(a+e*(H++/u),"Loading Brains"),h){const v=async()=>{function p(M){return t.removeEventListener("error",p),t.removeEventListener("message",p),console.warn("Worker connected to App"),!0}t.addEventListener("error",p),t.addEventListener("message",p),t.postMessage({command:"load",faceLandmarkerOptions:C})};t=new Worker(new URL("./face-landmarks-worker.js")),s&&s(a+e*(H++/u),"Loading Brains"),await v(),s&&s(a+e*(H++/u),"Loading Brains");const g=async(p,M,F=null)=>{t.addEventListener("message",A=>{M(A.data),p&&requestAnimationFrame(()=>g(p,M,F))},{once:!0}),t.postMessage({command:"predict",callback:M},r,[d])};return g}else{const v=await l.FilesetResolver.forVisionTasks(T);s&&s(a+e*(H++/u),"Loading Eyes");const g=await l.FaceLandmarker.createFromOptions(v,C);s&&s(a+e*(H++/u),"Loading Brains");const p=async(M,F,A=null)=>{if(A?A():!0){const R=await o(d,g,r);F(R)}M&&requestAnimationFrame(()=>p(M,F,A))};return p}}},{"@mediapipe/tasks-vision":"fKA8n","./face-landmarks-calculations":"gg2UE","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],gg2UE:[function(i,m,c){var n=i("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(c),n.export(c,"enhanceFaceLandmarksModelPrediction",()=>E);var l=i("../maths/maths"),f=i("./face-model-constants"),T=i("@mediapipe/tasks-vision");const{PI:h,abs:L,sqrt:t,atan2:O,tan:k}=Math,E=(o,_,d,y,s=!0)=>{const r=o,a=_.categories;s&&o.forEach(K=>{K.x=1-K.x});const e={flipped:s,keypoints:r,faceBlendshapes:_,faceLandmarks:o,facialTransformationMatrixes:d};let u=0,H=Number.POSITIVE_INFINITY,U,C,v=r[152],g=r[10],p=r[234],M=r[447];const F={},A=r[4],b=r[9],R=r[0],q=(0,l.hypoteneuse2D)(v,g);e.headHeight=q,F.headVertical=[v,A,g];const w=r[362],G=r[263],P=r[133],X=r[33],I=(0,l.hypoteneuse2D)(w,G),j=(0,l.hypoteneuse2D)(P,X);e.rightEyeDirection=a[16].score-a[14].score,e.leftEyeDirection=a[13].score-a[15].score,e.eyeDirection=.5*(e.rightEyeDirection+e.leftEyeDirection),e.isLookingRight=e.eyeDirection>.5,e.eyeSquintLeft=a[19].score,e.eyeSquintRight=a[20].score;const B=a[9].score,W=a[10].score;e.leftEyeClosedBy=B,e.rightEyeClosedBy=W,e.leftEyeClosed=B>.6,e.rightEyeClosed=W>.6,e.eyesClosed=e.leftEyeClosed&&e.rightEyeClosed;const D=a[25].score,ce=a[27].score,ie=a[32].score,J=a[38].score,Y=D>.2,de=D>.5;e.mouthRatio=D,e.mouthOpen=Y,e.mouthShape=Y?!J>.3?f.MOUTH_SHAPE_O:f.MOUTH_SHAPE_E:f.MOUTH_SHAPE_CLOSED,e.box={xMin:s?1-M.x:p.x,xMax:s?1-p.x:M.x,yMin:g.y,yMax:v.y};const x=((s?I/j:j/I)-1)*2,N=(0,l.clamp)(x<0?x*2:x,-1,1),Z=s?P.x-w.x:w.x-P.x,$=w.y-P.y,V=O(Z,$),z=((s?-V:V)+Math.PI*.5)*1.3,ee=(0,l.clamp)(z,-1,1),te=v.z-g.z,ne=v.y-g.y,oe=O(te,ne)*1.5,se=(0,l.clamp)(oe,-1,1);return e.rightSmirk=a[44].score,e.leftSmirk=a[45].score,e.isFacingRight=N>0,e.pitch=se,e.roll=ee,e.yaw=N,e.time=y,e}},{"../maths/maths":"iDBHd","./face-model-constants":"53QHr","@mediapipe/tasks-vision":"fKA8n","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"53QHr":[function(i,m,c){var n=i("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(c),n.export(c,"FACE_CONTOURS",()=>f),n.export(c,"MOUTH_SHAPE_CLOSED",()=>T),n.export(c,"MOUTH_SHAPE_O",()=>h),n.export(c,"MOUTH_SHAPE_E",()=>L),n.export(c,"MOUTH_SHAPE_I",()=>t),n.export(c,"MOUTH_SHAPE_U",()=>O),n.export(c,"RATIO_OF_MOUTH_TO_FACE",()=>k),n.export(c,"EYE_CLOSED_AT",()=>E),n.export(c,"PITCH_SCALE",()=>o),n.export(c,"createDefaultFaceModel",()=>_);var l=i("./face-landmark-constants");const f=l.MEDIAPIPE_FACE_MESH_KEYPOINTS_BY_CONTOUR,T="-",h="o",L="e",t="i",O="u",k=.25,E=20.2,o=8,_=()=>({})},{"./face-landmark-constants":"518W7","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}]},[],null,"parcelRequireaaed")});export default ae();
