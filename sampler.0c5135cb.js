var pe=(N,k)=>()=>(k||N((k={exports:{}}).exports,k),k.exports);var me=pe((de,Z)=>{(function(N,k,A,E,x){var O=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{},C=typeof O[E]=="function"&&O[E],W=C.cache||{},z=typeof Z!="undefined"&&typeof Z.require=="function"&&Z.require.bind(Z);function b(B,Q){if(!W[B]){if(!N[B]){var F=typeof O[E]=="function"&&O[E];if(!Q&&F)return F(B,!0);if(C)return C(B,!0);if(z&&typeof B=="string")return z(B);var L=new Error("Cannot find module '"+B+"'");throw L.code="MODULE_NOT_FOUND",L}q.resolve=Y,q.cache={};var j=W[B]=new b.Module(B);N[B][0].call(j.exports,q,j,j.exports,this)}return W[B].exports;function q(J){var H=q.resolve(J);return H===!1?{}:b(H)}function Y(J){var H=N[B][1][J];return H??J}}function S(B){this.id=B,this.bundle=b,this.exports={}}b.isParcelRequire=!0,b.Module=S,b.modules=N,b.cache=W,b.parent=C,b.register=function(B,Q){N[B]=[function(F,L){L.exports=Q},{}]},Object.defineProperty(b,"root",{get:function(){return O[E]}}),O[E]=b;for(var R=0;R<k.length;R++)b(k[R]);if(A){var U=b(A);typeof de=="object"&&typeof Z!="undefined"?Z.exports=U:typeof define=="function"&&define.amd?define(function(){return U}):x&&(this[x]=U)}})({"3org3":[function(N,k,A){var E=N("@parcel/transformer-js/src/esmodule-helpers.js");E.defineInteropFlag(A);var x=N("@webaudiomodules/sdk"),O=N("@webaudiomodules/sdk-parammgr"),C=N("./sampler.wam.js"),W=E.interopDefault(C),z=N("url:./descriptor.json"),b=E.interopDefault(z),S=N("./descriptor.json"),R=E.interopDefault(S);const U="sampler",B=F=>F.substring(0,F.lastIndexOf("/"));class Q extends x.WebAudioModule{_baseUrl=B(b.default);_descriptorUrl=b.default;_descriptor=R.default;async initialize(L){return super.initialize(L)}async createAudioNode(L){const j=new W.default(this.audioContext,L),q={gain:1},Y=await O.ParamMgrFactory.create(this,{internalParamsConfig:q});return j.setup(Y),j}async createGui(){}}A.default=Q},{"@webaudiomodules/sdk":"hWxzW","@webaudiomodules/sdk-parammgr":"iUHts","./sampler.wam.js":"3NQx6","url:./descriptor.json":"gtP1k","./descriptor.json":"cyOqT","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],hWxzW:[function(N,k,A){var E=N("@parcel/transformer-js/src/esmodule-helpers.js");E.defineInteropFlag(A),E.export(A,"WamNode",()=>i),E.export(A,"WebAudioModule",()=>O),E.export(A,"addFunctionModule",()=>j),E.export(A,"apiVersion",()=>h),E.export(A,"getRingBuffer",()=>W),E.export(A,"getWamArrayRingBuffer",()=>b),E.export(A,"getWamEventRingBuffer",()=>F),E.export(A,"getWamParameter",()=>Y),E.export(A,"getWamParameterInfo",()=>H),E.export(A,"getWamParameterInterpolator",()=>se),E.export(A,"getWamProcessor",()=>re),E.export(A,"initializeWamEnv",()=>R),E.export(A,"initializeWamGroup",()=>B),E.export(A,"initializeWamHost",()=>w);var x=class{static get isWebAudioModuleConstructor(){return!0}static createInstance(d,c,l){return new this(d,c).initialize(l)}constructor(d,c){this._groupId=d,this._audioContext=c,this._initialized=!1,this._audioNode=void 0,this._timestamp=performance.now(),this._guiModuleUrl=void 0,this._descriptorUrl="./descriptor.json",this._descriptor={identifier:"com.webaudiomodule.default",name:`WebAudioModule_${this.constructor.name}`,vendor:"WebAudioModuleVendor",description:"",version:"0.0.0",apiVersion:"2.0.0",thumbnail:"",keywords:[],isInstrument:!1,website:"",hasAudioInput:!0,hasAudioOutput:!0,hasAutomationInput:!0,hasAutomationOutput:!0,hasMidiInput:!0,hasMidiOutput:!0,hasMpeInput:!0,hasMpeOutput:!0,hasOscInput:!0,hasOscOutput:!0,hasSysexInput:!0,hasSysexOutput:!0}}get isWebAudioModule(){return!0}get groupId(){return this._groupId}get moduleId(){return this.descriptor.identifier}get instanceId(){return this.moduleId+this._timestamp}get descriptor(){return this._descriptor}get identifier(){return this.descriptor.identifier}get name(){return this.descriptor.name}get vendor(){return this.descriptor.vendor}get audioContext(){return this._audioContext}get audioNode(){return this.initialized||console.warn("WAM should be initialized before getting the audioNode"),this._audioNode}set audioNode(d){this._audioNode=d}get initialized(){return this._initialized}set initialized(d){this._initialized=d}async createAudioNode(d){throw new TypeError("createAudioNode() not provided")}async initialize(d){return this._audioNode||(this.audioNode=await this.createAudioNode()),this.initialized=!0,this}async _loadGui(){const d=this._guiModuleUrl;if(!d)throw new TypeError("Gui module not found");return N(d)}async _loadDescriptor(){const d=this._descriptorUrl;if(!d)throw new TypeError("Descriptor not found");const l=await(await fetch(d)).json();return Object.assign(this._descriptor,l),this._descriptor}async createGui(){if(this.initialized||console.warn("Plugin should be initialized before getting the gui"),!this._guiModuleUrl)return;const{createElement:d}=await this._loadGui();return d(this)}destroyGui(){}},O=x,C=d=>{const c=globalThis;class l{static getStorageForCapacity(s,r){if(!r.BYTES_PER_ELEMENT)throw new Error("Pass in a ArrayBuffer subclass");const t=8+(s+1)*r.BYTES_PER_ELEMENT;return new SharedArrayBuffer(t)}constructor(s,r){if(!r.BYTES_PER_ELEMENT)throw new Error("Pass a concrete typed array class as second argument");this._Type=r,this._capacity=(s.byteLength-8)/r.BYTES_PER_ELEMENT,this.buf=s,this.write_ptr=new Uint32Array(this.buf,0,1),this.read_ptr=new Uint32Array(this.buf,4,1),this.storage=new r(this.buf,8,this._capacity)}get type(){return this._Type.name}push(s){const r=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);if((t+1)%this._storageCapacity()===r)return 0;const n=Math.min(this._availableWrite(r,t),s.length),o=Math.min(this._storageCapacity()-t,n),u=n-o;return this._copy(s,0,this.storage,t,o),this._copy(s,o,this.storage,0,u),Atomics.store(this.write_ptr,0,(t+n)%this._storageCapacity()),n}pop(s){const r=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);if(t===r)return 0;const n=!Number.isInteger(s),o=Math.min(this._availableRead(r,t),n?s.length:s);if(n){const u=Math.min(this._storageCapacity()-r,o),f=o-u;this._copy(this.storage,r,s,0,u),this._copy(this.storage,0,s,u,f)}return Atomics.store(this.read_ptr,0,(r+o)%this._storageCapacity()),o}get empty(){const s=Atomics.load(this.read_ptr,0);return Atomics.load(this.write_ptr,0)===s}get full(){const s=Atomics.load(this.read_ptr,0);return(Atomics.load(this.write_ptr,0)+1)%this._capacity!==s}get capacity(){return this._capacity-1}get availableRead(){const s=Atomics.load(this.read_ptr,0),r=Atomics.load(this.write_ptr,0);return this._availableRead(s,r)}get availableWrite(){const s=Atomics.load(this.read_ptr,0),r=Atomics.load(this.write_ptr,0);return this._availableWrite(s,r)}_availableRead(s,r){return r>s?r-s:r+this._storageCapacity()-s}_availableWrite(s,r){let t=s-r-1;return r>=s&&(t+=this._storageCapacity()),t}_storageCapacity(){return this._capacity}_copy(s,r,t,n,o){for(let u=0;u<o;u++)t[n+u]=s[r+u]}}if(c.AudioWorkletProcessor){const p=c.webAudioModules.getModuleScope(d);p.RingBuffer||(p.RingBuffer=l)}return l},W=C,z=d=>{const c=globalThis;class l{static DefaultArrayCapacity=2;static getStorageForEventCapacity(s,r,t,n){if(n===void 0?n=l.DefaultArrayCapacity:n=Math.max(n,l.DefaultArrayCapacity),!t.BYTES_PER_ELEMENT)throw new Error("Pass in a ArrayBuffer subclass");const o=r*n;return s.getStorageForCapacity(o,t)}constructor(s,r,t,n,o){if(!n.BYTES_PER_ELEMENT)throw new Error("Pass in a ArrayBuffer subclass");this._arrayLength=t,this._arrayType=n,this._arrayElementSizeBytes=n.BYTES_PER_ELEMENT,this._arraySizeBytes=this._arrayLength*this._arrayElementSizeBytes,this._sab=r,o===void 0?o=l.DefaultArrayCapacity:o=Math.max(o,l.DefaultArrayCapacity),this._arrayArray=new n(this._arrayLength),this._rb=new s(this._sab,n)}write(s){if(s.length!==this._arrayLength||this._rb.availableWrite<this._arrayLength)return!1;let t=!0;return this._rb.push(s)!=this._arrayLength&&(t=!1),t}read(s,r){if(s.length!==this._arrayLength)return!1;const t=this._rb.availableRead;if(t<this._arrayLength)return!1;r&&t>this._arrayLength&&this._rb.pop(t-this._arrayLength);let n=!1;return this._rb.pop(s)===this._arrayLength&&(n=!0),n}}if(c.AudioWorkletProcessor){const p=c.webAudioModules.getModuleScope(d);p.WamArrayRingBuffer||(p.WamArrayRingBuffer=l)}return l},b=z,S=d=>{const c=globalThis;if(c.AudioWorkletProcessor&&c.webAudioModules)return;const l=new Map,p=new Map;class s{constructor(){}get apiVersion(){return d}getModuleScope(t){return l.has(t)||l.set(t,{}),l.get(t)}getGroup(t,n){const o=p.get(t);if(o.validate(n))return o;throw"Invalid key"}addGroup(t){p.has(t.groupId)||p.set(t.groupId,t)}removeGroup(t){p.delete(t.groupId)}addWam(t){p.get(t.groupId).addWam(t)}removeWam(t){p.get(t.groupId).removeWam(t)}connectEvents(t,n,o,u=0){p.get(t).connectEvents(n,o,u)}disconnectEvents(t,n,o,u){p.get(t).disconnectEvents(n,o,u)}emitEvents(t,...n){p.get(t.groupId).emitEvents(t,...n)}}c.AudioWorkletProcessor&&(c.webAudioModules||(c.webAudioModules=new s))},R=S,U=(d,c)=>{const l=globalThis;class p{constructor(r,t){this._groupId=r,this._validate=n=>n==t,this._processors=new Map,this._eventGraph=new Map}get groupId(){return this._groupId}get processors(){return this._processors}get eventGraph(){return this._eventGraph}validate(r){return this._validate(r)}addWam(r){this._processors.set(r.instanceId,r)}removeWam(r){this._eventGraph.has(r)&&this._eventGraph.delete(r),this._eventGraph.forEach(t=>{t.forEach(n=>{n&&n.has(r)&&n.delete(r)})}),this._processors.delete(r.instanceId)}connectEvents(r,t,n){const o=this._processors.get(r),u=this._processors.get(t);let f;if(this._eventGraph.has(o)?f=this._eventGraph.get(o):(f=[],this._eventGraph.set(o,f)),f[n])f[n].add(u);else{const a=new Set;a.add(u),f[n]=a}}disconnectEvents(r,t,n){const o=this._processors.get(r);if(!this._eventGraph.has(o))return;const u=this._eventGraph.get(o);if(typeof t=="undefined"){u.forEach(a=>{a&&a.clear()});return}const f=this._processors.get(t);if(typeof n=="undefined"){u.forEach(a=>{a&&a.delete(f)});return}!u[n]||u[n].delete(f)}emitEvents(r,...t){if(!this._eventGraph.has(r))return;this._eventGraph.get(r).forEach(o=>{o&&o.forEach(u=>u.scheduleEvents(...t))})}}l.AudioWorkletProcessor&&l.webAudioModules.addGroup(new p(d,c))},B=U,Q=d=>{const c=globalThis;class l{static DefaultExtraBytesPerEvent=64;static WamEventBaseBytes=13;static WamAutomationEventBytes=l.WamEventBaseBytes+2+8+1;static WamTransportEventBytes=l.WamEventBaseBytes+4+8+8+1+1+1;static WamMidiEventBytes=l.WamEventBaseBytes+1+1+1;static WamBinaryEventBytes=l.WamEventBaseBytes+4;static getStorageForEventCapacity(s,r,t){t===void 0?t=l.DefaultExtraBytesPerEvent:t=Math.max(t,l.DefaultExtraBytesPerEvent);const n=(Math.max(l.WamAutomationEventBytes,l.WamTransportEventBytes,l.WamMidiEventBytes,l.WamBinaryEventBytes)+t)*r;return s.getStorageForCapacity(n,Uint8Array)}constructor(s,r,t,n){this._eventSizeBytes={},this._encodeEventType={},this._decodeEventType={},["wam-automation","wam-transport","wam-midi","wam-sysex","wam-mpe","wam-osc","wam-info"].forEach((u,f)=>{let a=0;switch(u){case"wam-automation":a=l.WamAutomationEventBytes;break;case"wam-transport":a=l.WamTransportEventBytes;break;case"wam-mpe":case"wam-midi":a=l.WamMidiEventBytes;break;case"wam-osc":case"wam-sysex":case"wam-info":a=l.WamBinaryEventBytes;break;default:break}this._eventSizeBytes[u]=a,this._encodeEventType[u]=f,this._decodeEventType[f]=u}),this._parameterCode=0,this._parameterCodes={},this._encodeParameterId={},this._decodeParameterId={},this.setParameterIds(t),this._sab=r,n===void 0?n=l.DefaultExtraBytesPerEvent:n=Math.max(n,l.DefaultExtraBytesPerEvent),this._eventBytesAvailable=Math.max(l.WamAutomationEventBytes,l.WamTransportEventBytes,l.WamMidiEventBytes,l.WamBinaryEventBytes)+n,this._eventBytes=new ArrayBuffer(this._eventBytesAvailable),this._eventBytesView=new DataView(this._eventBytes),this._rb=new s(this._sab,Uint8Array),this._eventSizeArray=new Uint8Array(this._eventBytes,0,4),this._eventSizeView=new DataView(this._eventBytes,0,4)}_writeHeader(s,r,t){let n=0;return this._eventBytesView.setUint32(n,s),n+=4,this._eventBytesView.setUint8(n,this._encodeEventType[r]),n+=1,this._eventBytesView.setFloat64(n,Number.isFinite(t)?t:-1),n+=8,n}_encode(s){let r=0;const{type:t,time:n}=s;switch(s.type){case"wam-automation":{if(!(s.data.id in this._encodeParameterId))break;const o=this._eventSizeBytes[t];r=this._writeHeader(o,t,n);const{data:u}=s,f=this._encodeParameterId[u.id],{value:a,normalized:m}=u;this._eventBytesView.setUint16(r,f),r+=2,this._eventBytesView.setFloat64(r,a),r+=8,this._eventBytesView.setUint8(r,m?1:0),r+=1}break;case"wam-transport":{const o=this._eventSizeBytes[t];r=this._writeHeader(o,t,n);const{data:u}=s,{currentBar:f,currentBarStarted:a,tempo:m,timeSigNumerator:v,timeSigDenominator:g,playing:y}=u;this._eventBytesView.setUint32(r,f),r+=4,this._eventBytesView.setFloat64(r,a),r+=8,this._eventBytesView.setFloat64(r,m),r+=8,this._eventBytesView.setUint8(r,v),r+=1,this._eventBytesView.setUint8(r,g),r+=1,this._eventBytesView.setUint8(r,y?1:0),r+=1}break;case"wam-mpe":case"wam-midi":{const o=this._eventSizeBytes[t];r=this._writeHeader(o,t,n);const{data:u}=s,{bytes:f}=u;let a=0;for(;a<3;)this._eventBytesView.setUint8(r,f[a]),r+=1,a++}break;case"wam-osc":case"wam-sysex":case"wam-info":{let o=null;if(s.type==="wam-info"){const{data:v}=s;o=new TextEncoder().encode(v.instanceId)}else{const{data:v}=s;o=v.bytes}const u=o.length,f=this._eventSizeBytes[t];r=this._writeHeader(f+u,t,n),this._eventBytesView.setUint32(r,u),r+=4;const a=r+u;a>this._eventBytesAvailable&&console.error(`Event requires ${a} bytes but only ${this._eventBytesAvailable} have been allocated!`),new Uint8Array(this._eventBytes,r,u).set(o),r+=u}break;default:break}return new Uint8Array(this._eventBytes,0,r)}_decode(){let s=0;const r=this._decodeEventType[this._eventBytesView.getUint8(s)];s+=1;let t=this._eventBytesView.getFloat64(s);switch(t===-1&&(t=void 0),s+=8,r){case"wam-automation":{const n=this._eventBytesView.getUint16(s);s+=2;const o=this._eventBytesView.getFloat64(s);s+=8;const u=!!this._eventBytesView.getUint8(s);if(s+=1,!(n in this._decodeParameterId))break;const f=this._decodeParameterId[n];return{type:r,time:t,data:{id:f,value:o,normalized:u}}}case"wam-transport":{const n=this._eventBytesView.getUint32(s);s+=4;const o=this._eventBytesView.getFloat64(s);s+=8;const u=this._eventBytesView.getFloat64(s);s+=8;const f=this._eventBytesView.getUint8(s);s+=1;const a=this._eventBytesView.getUint8(s);s+=1;const m=this._eventBytesView.getUint8(s)==1;return s+=1,{type:r,time:t,data:{currentBar:n,currentBarStarted:o,tempo:u,timeSigNumerator:f,timeSigDenominator:a,playing:m}}}case"wam-mpe":case"wam-midi":{const n=[0,0,0];let o=0;for(;o<3;)n[o]=this._eventBytesView.getUint8(s),s+=1,o++;return{type:r,time:t,data:{bytes:n}}}case"wam-osc":case"wam-sysex":case"wam-info":{const n=this._eventBytesView.getUint32(s);s+=4;const o=new Uint8Array(n);if(o.set(new Uint8Array(this._eventBytes,s,n)),s+=n,r==="wam-info"){const f={instanceId:new TextDecoder().decode(o)};return{type:r,time:t,data:f}}else return{type:r,time:t,data:{bytes:o}}}default:break}return!1}write(...s){const r=s.length;let t=this._rb.availableWrite,n=0,o=0;for(;o<r;){const u=s[o],f=this._encode(u),a=f.byteLength;let m=0;if(t>=a)a===0?n++:m=this._rb.push(f);else break;t-=m,o++}return o-n}read(){if(this._rb.empty)return[];const s=[];let r=this._rb.availableRead,t=0;for(;r>0;){t=this._rb.pop(this._eventSizeArray),r-=t;const n=this._eventSizeView.getUint32(0),o=new Uint8Array(this._eventBytes,0,n-4);t=this._rb.pop(o),r-=t;const u=this._decode();u&&s.push(u)}return s}setParameterIds(s){this._encodeParameterId={},this._decodeParameterId={},s.forEach(r=>{let t=-1;r in this._parameterCodes?t=this._parameterCodes[r]:(t=this._generateParameterCode(),this._parameterCodes[r]=t),this._encodeParameterId[r]=t,this._decodeParameterId[t]=r})}_generateParameterCode(){if(this._parameterCode>65535)throw Error("Too many parameters have been registered!");return this._parameterCode++}}if(c.AudioWorkletProcessor){const p=c.webAudioModules.getModuleScope(d);p.WamEventRingBuffer||(p.WamEventRingBuffer=l)}return l},F=Q,L=(d,c,...l)=>{const p=`(${c.toString()})(${l.map(r=>JSON.stringify(r)).join(", ")});`,s=URL.createObjectURL(new Blob([p],{type:"text/javascript"}));return d.addModule(s)},j=L,q=d=>{const c=globalThis;class l{constructor(s){this.info=s,this._value=s.defaultValue}set value(s){this._value=s}get value(){return this._value}set normalizedValue(s){this.value=this.info.denormalize(s)}get normalizedValue(){return this.info.normalize(this.value)}}if(c.AudioWorkletProcessor){const p=c.webAudioModules.getModuleScope(d);p.WamParameter||(p.WamParameter=l)}return l},Y=q,J=d=>{const c=globalThis,l=(o,u)=>u===0?o:o**1.5**-u,p=(o,u)=>u===0?o:o**1.5**u,s=(o,u,f,a=0)=>l(u===0&&f===1?o:(o-u)/(f-u)||0,a),r=(o,u,f,a=0)=>u===0&&f===1?p(o,a):p(o,a)*(f-u)+u,t=(o,u,f)=>o>=u&&o<=f;class n{constructor(u,f={}){let{type:a,label:m,defaultValue:v,minValue:g,maxValue:y,discreteStep:T,exponent:V,choices:I,units:P}=f;a===void 0&&(a="float"),m===void 0&&(m=""),v===void 0&&(v=0),I===void 0&&(I=[]),a==="boolean"||a==="choice"?(T=1,g=0,I.length?y=I.length-1:y=1):(g===void 0&&(g=0),y===void 0&&(y=1),T===void 0&&(T=0),V===void 0&&(V=0),P===void 0&&(P=""));const M=`Param config error | ${u}: `;if(g>=y)throw Error(M.concat("minValue must be less than maxValue"));if(!t(v,g,y))throw Error(M.concat("defaultValue out of range"));if(T%1||T<0)throw Error(M.concat("discreteStep must be a non-negative integer"));if(T>0&&(g%1||y%1||v%1))throw Error(M.concat("non-zero discreteStep requires integer minValue, maxValue, and defaultValue"));if(a==="choice"&&!I.length)throw Error(M.concat("choice type parameter requires list of strings in choices"));this.id=u,this.label=m,this.type=a,this.defaultValue=v,this.minValue=g,this.maxValue=y,this.discreteStep=T,this.exponent=V,this.choices=I,this.units=P}normalize(u){return s(u,this.minValue,this.maxValue,this.exponent)}denormalize(u){return r(u,this.minValue,this.maxValue,this.exponent)}valueString(u){return this.choices?this.choices[u]:this.units!==""?`${u} ${this.units}`:`${u}`}}if(c.AudioWorkletProcessor){const o=c.webAudioModules.getModuleScope(d);o.WamParameterInfo||(o.WamParameterInfo=n)}return n},H=J,ne=d=>{const c=globalThis,l=128,p="0_0";class s{static _tables;static _tableReferences;constructor(t,n,o=0){s._tables||(s._tables={nullTableKey:new Float32Array(0)},s._tableReferences={nullTableKey:[]}),this.info=t,this.values=new Float32Array(l),this._tableKey=p,this._table=s._tables[this._tableKey],this._skew=2;const{discreteStep:u}=t;this._discrete=!!u,this._N=this._discrete?0:n,this._n=0,this._startValue=t.defaultValue,this._endValue=t.defaultValue,this._currentValue=t.defaultValue,this._deltaValue=0,this._inverted=!1,this._changed=!0,this._filled=0,this._discrete?this._skew=0:this.setSkew(o),this.setStartValue(this._startValue)}_removeTableReference(t){if(t===p)return;const{id:n}=this.info,o=s._tableReferences[t];if(o){const u=o.indexOf(n);u!==-1&&o.splice(u,1),o.length===0&&(delete s._tables[t],delete s._tableReferences[t])}}setSkew(t){if(this._skew===t||this._discrete)return;if(t<-1||t>1)throw Error("skew must be in range [-1.0, 1.0]");const n=[this._N,t].join("_"),o=this._tableKey,{id:u}=this.info;if(n!==o){if(s._tables[n]){const f=s._tableReferences[n];f?f.push(u):s._tableReferences[n]=[u]}else{let f=Math.abs(t);f=Math.pow(3-f,f*(f+2));const a=f===1,m=this._N,v=new Float32Array(m+1);if(a)for(let g=0;g<=m;++g)v[g]=g/m;else for(let g=0;g<=m;++g)v[g]=(g/m)**f;s._tables[n]=v,s._tableReferences[n]=[u]}this._removeTableReference(o),this._skew=t,this._tableKey=n,this._table=s._tables[this._tableKey]}}setStartValue(t,n=!0){this._n=this._N,this._startValue=t,this._endValue=t,this._currentValue=t,this._deltaValue=0,this._inverted=!1,n?(this.values.fill(t),this._changed=!0,this._filled=this.values.length):(this._changed=!1,this._filled=0)}setEndValue(t){t!==this._endValue&&(this._n=0,this._startValue=this._currentValue,this._endValue=t,this._deltaValue=this._endValue-this._startValue,this._inverted=this._deltaValue>0&&this._skew>=0||this._deltaValue<=0&&this._skew<0,this._changed=!1,this._filled=0)}process(t,n){if(this.done)return;const o=n-t;let u=0;const f=this._N-this._n;if(this._discrete||!f)u=o;else{if(f<o&&(u=Math.min(o-f,l),n-=u),n>t)if(this._inverted)for(let a=t;a<n;++a){const m=1-this._table[this._N-++this._n];this.values[a]=this._startValue+m*this._deltaValue}else for(let a=t;a<n;++a){const m=this._table[++this._n];this.values[a]=this._startValue+m*this._deltaValue}u>0&&(t=n,n+=u)}u>0&&(this.values.fill(this._endValue,t,n),this._filled+=u),this._currentValue=this.values[n-1],this._n===this._N&&(this._changed?this._filled>=this.values.length&&(this.setStartValue(this._endValue,!1),this._changed=!0,this._filled=this.values.length):this._changed=!0)}get done(){return this._changed&&this._filled===this.values.length}is(t){return this._endValue===t&&this.done}destroy(){this._removeTableReference(this._tableKey)}}if(c.AudioWorkletProcessor){const r=c.webAudioModules.getModuleScope(d);r.WamParameterInterpolator||(r.WamParameterInterpolator=s)}return s},se=ne,oe=d=>{const c=globalThis,{AudioWorkletProcessor:l,webAudioModules:p}=c,s=c.webAudioModules.getModuleScope(d),{RingBuffer:r,WamEventRingBuffer:t,WamParameter:n,WamParameterInterpolator:o}=s;class u extends l{constructor(a){super();const{groupId:m,moduleId:v,instanceId:g,useSab:y}=a.processorOptions;if(!v)throw Error("must provide moduleId argument in processorOptions!");if(!g)throw Error("must provide instanceId argument in processorOptions!");this.groupId=m,this.moduleId=v,this.instanceId=g,this._samplesPerQuantum=128,this._compensationDelay=0,this._parameterInfo={},this._parameterState={},this._parameterInterpolators={},this._eventQueue=[],this._pendingResponses={},this._useSab=!!y&&!!globalThis.SharedArrayBuffer,this._eventSabReady=!1,this._audioToMainEventSab=null,this._mainToAudioEventSab=null,this._eventWriter=null,this._eventReader=null,this._initialized=!1,this._destroyed=!1,p.addWam(this),this.port.onmessage=this._onMessage.bind(this),this._useSab&&this._configureSab()}getCompensationDelay(){return this._compensationDelay}scheduleEvents(...a){let m=0;for(;m<a.length;)this._eventQueue.push({id:0,event:a[m]}),m++}emitEvents(...a){p.emitEvents(this,...a)}clearEvents(){this._eventQueue=[]}process(a,m,v){if(!this._initialized)return!0;if(this._destroyed)return!1;this._eventSabReady&&this.scheduleEvents(...this._eventReader.read());const g=this._getProcessingSlices();let y=0;for(;y<g.length;){const{range:T,events:V}=g[y],[I,P]=T;let M=0;for(;M<V.length;)this._processEvent(V[M]),M++;this._interpolateParameterValues(I,P),this._process(I,P,a,m,v),y++}return!0}destroy(){this._destroyed=!0,this.port.close(),p.removeWam(this)}_generateWamParameterInfo(){return{}}_initialize(){this._parameterState={},this._parameterInterpolators={},this._parameterInfo=this._generateWamParameterInfo(),Object.keys(this._parameterInfo).forEach(a=>{const m=this._parameterInfo[a];this._parameterState[a]=new n(this._parameterInfo[a]),this._parameterInterpolators[a]=new o(m,256)})}_configureSab(){const a=1024,m=Object.keys(this._parameterInfo);this._eventSabReady&&(this._eventWriter.setParameterIds(m),this._eventReader.setParameterIds(m)),this.port.postMessage({eventSab:{eventCapacity:a,parameterIds:m}})}async _onMessage(a){if(a.data.request){const{id:m,request:v,content:g}=a.data,y={id:m,response:v},T=v.split("/"),V=T[0],I=T[1];if(y.content="error",V==="get")if(I==="parameterInfo"){let{parameterIds:P}=g;P.length||(P=Object.keys(this._parameterInfo));const M={};let G=0;for(;G<P.length;){const D=P[G];M[D]=this._parameterInfo[D],G++}y.content=M}else if(I==="parameterValues"){let{normalized:P,parameterIds:M}=g;y.content=this._getParameterValues(P,M)}else I==="state"?y.content=this._getState():I==="compensationDelay"&&(y.content=this.getCompensationDelay());else if(V==="set"){if(I==="parameterValues"){const{parameterValues:P}=g;this._setParameterValues(P,!0),delete y.content}else if(I==="state"){const{state:P}=g;this._setState(P),delete y.content}}else if(V==="add"){if(I==="event"){const{event:P}=g;this._eventQueue.push({id:m,event:P});return}}else if(V==="remove"){if(I==="events"){const P=this._eventQueue.map(M=>M.id);this.clearEvents(),y.content=P}}else if(V==="connect"){if(I==="events"){const{wamInstanceId:P,output:M}=g;this._connectEvents(P,M),delete y.content}}else if(V==="disconnect"){if(I==="events"){const{wamInstanceId:P,output:M}=g;this._disconnectEvents(P,M),delete y.content}}else if(V==="initialize"){if(I==="processor")this._initialize(),this._initialized=!0,delete y.content;else if(I==="eventSab"){const{mainToAudioEventSab:P,audioToMainEventSab:M}=g;this._audioToMainEventSab=M,this._mainToAudioEventSab=P;const G=Object.keys(this._parameterInfo);this._eventWriter=new t(r,this._audioToMainEventSab,G),this._eventReader=new t(r,this._mainToAudioEventSab,G),this._eventSabReady=!0,delete y.content}}this.port.postMessage(y)}else a.data.destroy&&this.destroy()}_onTransport(a){console.error("_onTransport not implemented!")}_onMidi(a){console.error("_onMidi not implemented!")}_onSysex(a){console.error("_onMidi not implemented!")}_onMpe(a){console.error("_onMpe not implemented!")}_onOsc(a){console.error("_onOsc not implemented!")}_setState(a){a.parameterValues&&this._setParameterValues(a.parameterValues,!1)}_getState(){return{parameterValues:this._getParameterValues(!1)}}_getParameterValues(a,m){const v={};(!m||!m.length)&&(m=Object.keys(this._parameterState));let g=0;for(;g<m.length;){const y=m[g],T=this._parameterState[y];v[y]={id:y,value:a?T.normalizedValue:T.value,normalized:a},g++}return v}_setParameterValues(a,m){const v=Object.keys(a);let g=0;for(;g<v.length;)this._setParameterValue(a[v[g]],m),g++}_setParameterValue(a,m){const{id:v,value:g,normalized:y}=a,T=this._parameterState[v];if(!T)return;y?T.normalizedValue=g:T.value=g;const V=this._parameterInterpolators[v];m?V.setEndValue(T.value):V.setStartValue(T.value)}_interpolateParameterValues(a,m){const v=Object.keys(this._parameterInterpolators);let g=0;for(;g<v.length;)this._parameterInterpolators[v[g]].process(a,m),g++}_connectEvents(a,m){p.connectEvents(this.groupId,this.instanceId,a,m)}_disconnectEvents(a,m){if(typeof a=="undefined"){p.disconnectEvents(this.groupId,this.instanceId);return}p.disconnectEvents(this.groupId,this.instanceId,a,m)}_getProcessingSlices(){const a="add/event",{currentTime:m,sampleRate:v}=c,g={};let y=0;for(;y<this._eventQueue.length;){const{id:P,event:M}=this._eventQueue[y],G=M.time-m,D=G>0?Math.round(G*v):0;if(D<this._samplesPerQuantum)g[D]?g[D].push(M):g[D]=[M],P?this.port.postMessage({id:P,response:a}):this._eventSabReady?this._eventWriter.write(M):this.port.postMessage({event:M}),this._eventQueue.shift(),y=-1;else break;y++}const T=[],V=Object.keys(g);V[0]!=="0"&&(V.unshift("0"),g["0"]=[]);const I=V.length-1;for(y=0;y<V.length;){const P=V[y],M=parseInt(P),G=y<I?parseInt(V[y+1]):this._samplesPerQuantum;T.push({range:[M,G],events:g[P]}),y++}return T}_processEvent(a){switch(a.type){case"wam-automation":this._setParameterValue(a.data,!0);break;case"wam-transport":this._onTransport(a.data);break;case"wam-midi":this._onMidi(a.data);break;case"wam-sysex":this._onSysex(a.data);break;case"wam-mpe":this._onMpe(a.data);break;case"wam-osc":this._onOsc(a.data);break;default:break}}_process(a,m,v,g,y){console.error("_process not implemented!")}}return c.AudioWorkletProcessor&&(s.WamProcessor||(s.WamProcessor=u)),u},re=oe,X=W(),e=F(),i=class extends AudioWorkletNode{static async addModules(d,c){const{audioWorklet:l}=d;await j(l,W,c),await j(l,F,c),await j(l,b,c),await j(l,Y,c),await j(l,H,c),await j(l,se,c),await j(l,re,c)}constructor(d,c){const{audioContext:l,groupId:p,moduleId:s,instanceId:r}=d;c.processorOptions={groupId:p,moduleId:s,instanceId:r,...c.processorOptions};super(l,s,c);this.module=d,this._supportedEventTypes=new Set(["wam-automation","wam-transport","wam-midi","wam-sysex","wam-mpe","wam-osc"]),this._messageId=1,this._pendingResponses={},this._pendingEvents={},this._useSab=!1,this._eventSabReady=!1,this._destroyed=!1,this.port.onmessage=this._onMessage.bind(this)}get groupId(){return this.module.groupId}get moduleId(){return this.module.moduleId}get instanceId(){return this.module.instanceId}async getParameterInfo(...d){const c="get/parameterInfo",l=this._generateMessageId();return new Promise(p=>{this._pendingResponses[l]=p,this.port.postMessage({id:l,request:c,content:{parameterIds:d}})})}async getParameterValues(d,...c){const l="get/parameterValues",p=this._generateMessageId();return new Promise(s=>{this._pendingResponses[p]=s,this.port.postMessage({id:p,request:l,content:{normalized:d,parameterIds:c}})})}async setParameterValues(d){const c="set/parameterValues",l=this._generateMessageId();return new Promise(p=>{this._pendingResponses[l]=p,this.port.postMessage({id:l,request:c,content:{parameterValues:d}})})}async getState(){const d="get/state",c=this._generateMessageId();return new Promise(l=>{this._pendingResponses[c]=l,this.port.postMessage({id:c,request:d})})}async setState(d){const c="set/state",l=this._generateMessageId();return new Promise(p=>{this._pendingResponses[l]=p,this.port.postMessage({id:l,request:c,content:{state:d}})})}async getCompensationDelay(){const d="get/compensationDelay",c=this._generateMessageId();return new Promise(l=>{this._pendingResponses[c]=l,this.port.postMessage({id:c,request:d})})}addEventListener(d,c,l){this._supportedEventTypes.has(d)&&super.addEventListener(d,c,l)}removeEventListener(d,c,l){this._supportedEventTypes.has(d)&&super.removeEventListener(d,c,l)}scheduleEvents(...d){let c=0;const l=d.length;for(this._eventSabReady&&(c=this._eventWriter.write(...d));c<l;){const p=d[c],s="add/event",r=this._generateMessageId();let t=!1;new Promise((n,o)=>{this._pendingResponses[r]=n,this._pendingEvents[r]=()=>{t||o()},this.port.postMessage({id:r,request:s,content:{event:p}})}).then(n=>{t=!0,delete this._pendingEvents[r],this._onEvent(p)}).catch(n=>{delete this._pendingResponses[r]}),c++}}async clearEvents(){const d="remove/events",c=this._generateMessageId();if(Object.keys(this._pendingEvents).length)return new Promise(p=>{this._pendingResponses[c]=p,this.port.postMessage({id:c,request:d})}).then(p=>{p.forEach(s=>{this._pendingEvents[s](),delete this._pendingEvents[s]})})}connectEvents(d,c){const l="connect/events",p=this._generateMessageId();new Promise((s,r)=>{this._pendingResponses[p]=s,this.port.postMessage({id:p,request:l,content:{wamInstanceId:d,output:c}})})}disconnectEvents(d,c){const l="disconnect/events",p=this._generateMessageId();new Promise((s,r)=>{this._pendingResponses[p]=s,this.port.postMessage({id:p,request:l,content:{wamInstanceId:d,output:c}})})}destroy(){this._audioToMainInterval&&clearInterval(this._audioToMainInterval),this.port.postMessage({destroy:!0}),this.port.close(),this.disconnect(),this._destroyed=!0}_generateMessageId(){return this._messageId++}async _initialize(){const d="initialize/processor",c=this._generateMessageId();return new Promise(l=>{this._pendingResponses[c]=l,this.port.postMessage({id:c,request:d})})}_onMessage(d){const{data:c}=d,{response:l,event:p,eventSab:s}=c;if(l){const{id:r,content:t}=c,n=this._pendingResponses[r];n&&(delete this._pendingResponses[r],n(t))}else if(s){this._useSab=!0;const{eventCapacity:r,parameterIds:t}=s;if(this._eventSabReady){this._eventWriter.setParameterIds(t),this._eventReader.setParameterIds(t);return}this._mainToAudioEventSab=e.getStorageForEventCapacity(X,r),this._audioToMainEventSab=e.getStorageForEventCapacity(X,r),this._eventWriter=new e(X,this._mainToAudioEventSab,t),this._eventReader=new e(X,this._audioToMainEventSab,t);const n="initialize/eventSab",o=this._generateMessageId();new Promise((u,f)=>{this._pendingResponses[o]=u,this.port.postMessage({id:o,request:n,content:{mainToAudioEventSab:this._mainToAudioEventSab,audioToMainEventSab:this._audioToMainEventSab}})}).then(u=>{this._eventSabReady=!0,this._audioToMainInterval=setInterval(()=>{this._eventReader.read().forEach(a=>{this._onEvent(a)})},100)})}else p&&this._onEvent(p)}_onEvent(d){const{type:c}=d;this.dispatchEvent(new CustomEvent(c,{bubbles:!0,detail:d}))}},h="2.0.0-alpha.6",_=async(d,c=`wam-host-${performance.now().toString()}`,l=performance.now().toString())=>(await j(d.audioWorklet,R,h),await j(d.audioWorklet,B,c,l),[c,l]),w=_},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"14tkN":[function(N,k,A){A.interopDefault=function(E){return E&&E.__esModule?E:{default:E}},A.defineInteropFlag=function(E){Object.defineProperty(E,"__esModule",{value:!0})},A.exportAll=function(E,x){return Object.keys(E).forEach(function(O){O==="default"||O==="__esModule"||x.hasOwnProperty(O)||Object.defineProperty(x,O,{enumerable:!0,get:function(){return E[O]}})}),x},A.export=function(E,x,O){Object.defineProperty(E,x,{enumerable:!0,get:O})}},{}],iUHts:[function(N,k,A){var E=N("@parcel/transformer-js/src/esmodule-helpers.js");E.defineInteropFlag(A),E.export(A,"CompositeAudioNode",()=>Q),E.export(A,"ParamMgrFactory",()=>X);var x=Object.defineProperty,O=Object.defineProperties,C=Object.getOwnPropertyDescriptors,W=Object.getOwnPropertySymbols,z=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable,S=(e,i,h)=>i in e?x(e,i,{enumerable:!0,configurable:!0,writable:!0,value:h}):e[i]=h,R=(e,i)=>{for(var h in i||(i={}))z.call(i,h)&&S(e,h,i[h]);if(W)for(var h of W(i))b.call(i,h)&&S(e,h,i[h]);return e},U=(e,i)=>O(e,C(i)),B=(e,i,h)=>(S(e,typeof i!="symbol"?i+"":i,h),h),Q=class extends GainNode{constructor(){super(...arguments);B(this,"_output"),B(this,"_wamNode")}get groupId(){return this.module.groupId}get moduleId(){return this.module.moduleId}get instanceId(){return this.module.instanceId}get module(){return this._wamNode.module}addEventListener(...e){return this._wamNode.addEventListener(...e)}removeEventListener(...e){return this._wamNode.removeEventListener(...e)}dispatchEvent(...e){return this._wamNode.dispatchEvent(...e)}getParameterInfo(...e){return this._wamNode.getParameterInfo(...e)}getParameterValues(...e){return this._wamNode.getParameterValues(...e)}setParameterValues(...e){return this._wamNode.setParameterValues(...e)}getState(){return this._wamNode.getState()}setState(...e){return this._wamNode.setState(...e)}getCompensationDelay(){return this._wamNode.getCompensationDelay()}scheduleEvents(...e){return this._wamNode.scheduleEvents(...e)}clearEvents(){return this._wamNode.clearEvents()}connectEvents(...e){return this._wamNode.connectEvents(...e)}disconnectEvents(...e){return this._wamNode.disconnectEvents(...e)}destroy(){return this._wamNode.destroy()}set channelCount(e){this._output?this._output.channelCount=e:super.channelCount=e}get channelCount(){return this._output?this._output.channelCount:super.channelCount}set channelCountMode(e){this._output?this._output.channelCountMode=e:super.channelCountMode=e}get channelCountMode(){return this._output?this._output.channelCountMode:super.channelCountMode}set channelInterpretation(e){this._output?this._output.channelInterpretation=e:super.channelInterpretation=e}get channelInterpretation(){return this._output?this._output.channelInterpretation:super.channelInterpretation}get numberOfInputs(){return super.numberOfInputs}get numberOfOutputs(){return this._output?this._output.numberOfOutputs:super.numberOfOutputs}get gain(){}connect(...e){return this._output&&this._output!==this?this._output.connect(...e):super.connect(...e)}disconnect(...e){return this._output&&this._output!==this?this._output.disconnect(...e):super.disconnect(...e)}},F=(e,i,...h)=>{const _=`(${i.toString()})(${h.map(d=>JSON.stringify(d)).join(", ")});`,w=URL.createObjectURL(new Blob([_],{type:"text/javascript"}));return e.addModule(w)},L=F,j=(e,i)=>{const h=globalThis,{AudioWorkletProcessor:_,registerProcessor:w,webAudioModules:d}=h,c=h.webAudioModules.getModuleScope(e),l=!!globalThis.SharedArrayBuffer,p=globalThis.SharedArrayBuffer||globalThis.ArrayBuffer,s=(f,a)=>a===0?f:f**1.5**-a,r=(f,a,m,v=0)=>s(a===0&&m===1?f:(f-a)/(m-a)||0,v),t=(f,a,m)=>a===0&&m===1?f:(f-a)/(m-a)||0,n=(f,a,m)=>a===0&&m===1?f:f*(m-a)+a,o=(f,a,m,v,g,y,T)=>n(t(t(Math.min(g,Math.max(v,f)),a,m),t(v,a,m),t(g,a,m)),y,T);class u extends _{static get parameterDescriptors(){return Object.entries(i).map(([a,{defaultValue:m,minValue:v,maxValue:g}])=>({name:a,defaultValue:m,minValue:v,maxValue:g}))}constructor(a){super();this.destroyed=!1,this.supportSharedArrayBuffer=l;const{paramsMapping:m,internalParamsMinValues:v,internalParams:g,groupId:y,instanceId:T}=a.processorOptions;this.groupId=y,this.moduleId=e,this.instanceId=T,this.internalParamsMinValues=v,this.paramsConfig=i,this.paramsMapping=m,this.paramsValues={},Object.entries(i).forEach(([P,{defaultValue:M}])=>{this.paramsValues[P]=M}),this.internalParams=g,this.internalParamsCount=this.internalParams.length,this.buffer=new p((this.internalParamsCount+1)*Float32Array.BYTES_PER_ELEMENT),this.$lock=new Int32Array(this.buffer,0,1),this.$internalParamsBuffer=new Float32Array(this.buffer,4,this.internalParamsCount),this.eventQueue=[],this.handleEvent=null,h.webAudioModules.addWam(this),c.paramMgrProcessors||(c.paramMgrProcessors={}),c.paramMgrProcessors[this.instanceId]=this,this.messagePortRequestId=-1;const V={},I={};this.call=(P,...M)=>new Promise((G,D)=>{const $=this.messagePortRequestId--;V[$]=G,I[$]=D,this.port.postMessage({id:$,call:P,args:M})}),this.handleMessage=({data:P})=>{var M,G;const{id:D,call:$,args:te,value:le,error:ae}=P;if($){const ee={id:D};try{ee.value=this[$](...te)}catch(ie){ee.error=ie}this.port.postMessage(ee)}else ae?(M=I[D])==null||M.call(I,ae):(G=V[D])==null||G.call(V,le),delete V[D],delete I[D]},this.port.start(),this.port.addEventListener("message",this.handleMessage)}setParamsMapping(a){this.paramsMapping=a}getBuffer(){return{lock:this.$lock,paramsBuffer:this.$internalParamsBuffer}}getCompensationDelay(){return 128}getParameterInfo(...a){a.length===0&&(a=Object.keys(this.paramsConfig));const m={};return a.forEach(v=>{m[v]=this.paramsConfig[v]}),m}getParameterValues(a,...m){m.length===0&&(m=Object.keys(this.paramsConfig));const v={};return m.forEach(g=>{if(!(g in this.paramsValues))return;const{minValue:y,maxValue:T,exponent:V}=this.paramsConfig[g],I=this.paramsValues[g];v[g]={id:g,value:a?r(I,y,T,V):I,normalized:a}}),v}scheduleEvents(...a){this.eventQueue.push(...a);const{currentTime:m}=h;this.eventQueue.sort((v,g)=>(v.time||m)-(g.time||m))}emitEvents(...a){d.emitEvents(this,...a)}clearEvents(){this.eventQueue=[]}lock(){globalThis.Atomics&&Atomics.store(this.$lock,0,1)}unlock(){globalThis.Atomics&&Atomics.store(this.$lock,0,0)}process(a,m,v){if(this.destroyed)return!1;const g=1;this.lock(),Object.entries(this.paramsConfig).forEach(([V,{minValue:I,maxValue:P}])=>{const M=v[V];V in this.paramsValues&&(this.paramsValues[V]=M[M.length-1]),!!this.paramsMapping[V]&&Object.entries(this.paramsMapping[V]).forEach(([G,D])=>{const $=this.internalParams.indexOf(G);if($===-1)return;const te=this.internalParamsMinValues[$],{sourceRange:le,targetRange:ae}=D,[ee,ie]=le,[ce,he]=ae;let K;I!==ce||P!==he||I!==ee||P!==ie?K=M.map(ue=>o(ue,I,P,ee,ie,ce,he)-te):te?K=M.map(ue=>ue-te):K=M,K.length===1?m[$+g][0].fill(K[0]):m[$+g][0].set(K),this.$internalParamsBuffer[$]=K[0]})}),this.unlock(),this.supportSharedArrayBuffer||this.call("setBuffer",{lock:this.$lock,paramsBuffer:this.$internalParamsBuffer});const{currentTime:y}=h;let T;for(T=0;T<this.eventQueue.length;T++){const V=this.eventQueue[T];if(V.time&&V.time>y)break;typeof this.handleEvent=="function"&&this.handleEvent(V),this.call("dispatchWamEvent",V)}return T&&this.eventQueue.splice(0,T),!0}connectEvents(a,m){d.connectEvents(this.groupId,this.instanceId,a,m)}disconnectEvents(a,m){if(typeof a=="undefined"){d.disconnectEvents(this.groupId,this.instanceId);return}d.disconnectEvents(this.groupId,this.instanceId,a,m)}destroy(){h.webAudioModules.removeWam(this),c.paramMgrProcessors&&delete c.paramMgrProcessors[this.instanceId],this.destroyed=!0,this.port.close()}}try{w(e,u)}catch(f){console.warn(f)}},q=j,Y=e=>{const i=globalThis,h=(p,s)=>s===0?p:p**1.5**-s,_=(p,s)=>s===0?p:p**1.5**s,w=(p,s,r,t=0)=>h(s===0&&r===1?p:(p-s)/(r-s)||0,t),d=(p,s,r,t=0)=>s===0&&r===1?_(p,t):_(p,t)*(r-s)+s,c=(p,s,r)=>p>=s&&p<=r;class l{constructor(s,r={}){let{type:t,label:n,defaultValue:o,minValue:u,maxValue:f,discreteStep:a,exponent:m,choices:v,units:g}=r;t===void 0&&(t="float"),n===void 0&&(n=""),o===void 0&&(o=0),v===void 0&&(v=[]),t==="boolean"||t==="choice"?(a=1,u=0,v.length?f=v.length-1:f=1):(u===void 0&&(u=0),f===void 0&&(f=1),a===void 0&&(a=0),m===void 0&&(m=0),g===void 0&&(g=""));const y=`Param config error | ${s}: `;if(u>=f)throw Error(y.concat("minValue must be less than maxValue"));if(!c(o,u,f))throw Error(y.concat("defaultValue out of range"));if(a%1||a<0)throw Error(y.concat("discreteStep must be a non-negative integer"));if(a>0&&(u%1||f%1||o%1))throw Error(y.concat("non-zero discreteStep requires integer minValue, maxValue, and defaultValue"));if(t==="choice"&&!v.length)throw Error(y.concat("choice type parameter requires list of strings in choices"));this.id=s,this.label=n,this.type=t,this.defaultValue=o,this.minValue=u,this.maxValue=f,this.discreteStep=a,this.exponent=m,this.choices=v,this.units=g}normalize(s){return w(s,this.minValue,this.maxValue,this.exponent)}denormalize(s){return d(s,this.minValue,this.maxValue,this.exponent)}valueString(s){return this.choices?this.choices[s]:this.units!==""?`${s} ${this.units}`:`${s}`}}if(i.AudioWorkletProcessor){const p=i.webAudioModules.getModuleScope(e);p.WamParameterInfo||(p.WamParameterInfo=l)}return l},J=Y,H=J(),ne=class{constructor(e={}){B(this,"_paramsConfig"),B(this,"_internalParamsConfig"),B(this,"_paramsMapping",{});const{paramsConfig:i,paramsMapping:h,internalParamsConfig:_}=e;this._paramsConfig=i,this._paramsMapping=h,this._internalParamsConfig=_}get paramsConfig(){const{internalParamsConfig:e}=this;return Object.entries(this._paramsConfig||e).reduce((i,[h,_])=>{var w,d,c,l;const p=e[h];return i[h]=new H(h,U(R({},_),{label:(w=_.label)!=null?w:h,defaultValue:(d=_.defaultValue)!=null?d:p==null?void 0:p.defaultValue,minValue:(c=_.minValue)!=null?c:p==null?void 0:p.minValue,maxValue:(l=_.maxValue)!=null?l:p==null?void 0:p.maxValue})),i},{})}get internalParamsConfig(){return Object.entries(this._internalParamsConfig||{}).reduce((e,[i,h])=>{if(h instanceof AudioParam)e[i]=h;else{const _={minValue:0,maxValue:1,defaultValue:0,automationRate:30};e[i]=R(R({},_),h)}return e},{})}get paramsMapping(){const e=this._paramsMapping||{},i=this.paramsConfig,h=this.internalParamsConfig;return Object.entries(i).reduce((_,[w,{minValue:d,maxValue:c}])=>{const l=[d,c],p={sourceRange:l,targetRange:[...l]};if(e[w]){const s=Object.entries(e[w]).reduce((r,[t,n])=>(h[t]&&(r[t]=R(R({},p),n)),r),{});_[w]=s}else h[w]&&(_[w]={[w]:R({},p)});return _},{})}},se=class extends AudioParam{constructor(){super(...arguments);B(this,"_info")}get exponent(){return this.info.exponent}get info(){return this._info}set info(e){this._info=e}set normalizedValue(e){this.value=this.info.denormalize(e)}get normalizedValue(){return this.info.normalize(this.value)}setValueAtTime(e,i){return super.setValueAtTime(e,i)}setNormalizedValueAtTime(e,i){const h=this.info.denormalize(e);return this.setValueAtTime(h,i)}linearRampToValueAtTime(e,i){return super.linearRampToValueAtTime(e,i)}linearRampToNormalizedValueAtTime(e,i){const h=this.info.denormalize(e);return this.linearRampToValueAtTime(h,i)}exponentialRampToValueAtTime(e,i){return super.exponentialRampToValueAtTime(e,i)}exponentialRampToNormalizedValueAtTime(e,i){const h=this.info.denormalize(e);return this.exponentialRampToValueAtTime(h,i)}setTargetAtTime(e,i,h){return super.setTargetAtTime(e,i,h)}setNormalizedTargetAtTime(e,i,h){const _=this.info.denormalize(e);return this.setTargetAtTime(_,i,h)}setValueCurveAtTime(e,i,h){return super.setValueCurveAtTime(e,i,h)}setNormalizedValueCurveAtTime(e,i,h){const _=Array.from(e).map(w=>this.info.denormalize(w));return this.setValueCurveAtTime(_,i,h)}cancelScheduledParamValues(e){return super.cancelScheduledValues(e)}cancelAndHoldParamAtTime(e){return super.cancelAndHoldAtTime(e)}},oe=globalThis.AudioWorkletNode,re=class extends oe{constructor(e,i){super(e.audioContext,e.moduleId,{numberOfInputs:0,numberOfOutputs:1+i.processorOptions.internalParams.length,parameterData:i.parameterData,processorOptions:i.processorOptions});B(this,"requestDispatchIParamChange",c=>{const l=this.internalParamsConfig[c];if(!("onChange"in l))return;const{automationRate:p,onChange:s}=l;if(typeof p!="number"||!p)return;const r=1e3/p,t=this.internalParams.indexOf(c);t!==-1&&(t>=this.internalParams.length||(typeof this.paramsUpdateCheckFnRef[t]=="number"&&window.clearTimeout(this.paramsUpdateCheckFnRef[t]),this.paramsUpdateCheckFn[t]=()=>{const n=this.$prevParamsBuffer[t],o=this.$paramsBuffer[t];o!==n&&(s(o,n),this.$prevParamsBuffer[t]=o),this.paramsUpdateCheckFnRef[t]=window.setTimeout(this.paramsUpdateCheckFn[t],r)},this.paramsUpdateCheckFn[t]()))});const{processorOptions:h,internalParamsConfig:_}=i;this.initialized=!1,this.module=e,this.instanceId=i.processorOptions.instanceId,this.groupId=i.processorOptions.groupId,this.paramsConfig=h.paramsConfig,this.internalParams=h.internalParams,this.internalParamsConfig=_,this.$prevParamsBuffer=new Float32Array(this.internalParams.length),this.paramsUpdateCheckFn=[],this.paramsUpdateCheckFnRef=[],this.messageRequestId=0,Object.entries(this.getParams()).forEach(([c,l])=>{Object.setPrototypeOf(l,se.prototype),l._info=this.paramsConfig[c]});const w={},d={};this.call=(c,...l)=>{const p=this.messageRequestId;return this.messageRequestId+=1,new Promise((s,r)=>{w[p]=s,d[p]=r,this.port.postMessage({id:p,call:c,args:l})})},this.handleMessage=({data:c})=>{var l,p;const{id:s,call:r,args:t,value:n,error:o}=c;if(r){const u={id:s};try{u.value=this[r](...t)}catch(f){u.error=f}this.port.postMessage(u)}else o?(l=d[s])==null||l.call(d,o):(p=w[s])==null||p.call(w,n),delete w[s],delete d[s]},this.port.start(),this.port.addEventListener("message",this.handleMessage)}get parameters(){return super.parameters}get moduleId(){return this.module.moduleId}async initialize(){const e=await this.call("getBuffer"),{lock:i,paramsBuffer:h}=e;this.$lock=i,this.$paramsBuffer=h;const _=1;return Object.entries(this.internalParamsConfig).forEach(([w,d],c)=>{if(this.context.state==="suspended"&&(this.$paramsBuffer[c]=d.defaultValue),d instanceof AudioParam)try{d.automationRate="a-rate"}catch{}finally{d.value=Math.max(0,d.minValue),this.connect(d,_+c)}else d instanceof AudioNode?this.connect(d,_+c):this.requestDispatchIParamChange(w)}),this.connect(this.module.audioContext.destination,0,0),this.initialized=!0,this}setBuffer({lock:e,paramsBuffer:i}){this.$lock=e,this.$paramsBuffer=i}setParamsMapping(e){return this.call("setParamsMapping",e)}getCompensationDelay(){return this.call("getCompensationDelay")}getParameterInfo(...e){return this.call("getParameterInfo",...e)}getParameterValues(e,...i){return this.call("getParameterValues",e,...i)}scheduleAutomation(e){const i=e.time||this.context.currentTime,{id:h,normalized:_,value:w}=e.data,d=this.getParam(h);!d||(d.info.type==="float"?_?d.linearRampToNormalizedValueAtTime(w,i):d.linearRampToValueAtTime(w,i):_?d.setNormalizedValueAtTime(w,i):d.setValueAtTime(w,i))}scheduleEvents(...e){e.forEach(i=>{i.type==="wam-automation"&&this.scheduleAutomation(i)}),this.call("scheduleEvents",...e)}emitEvents(...e){this.call("emitEvents",...e)}clearEvents(){this.call("clearEvents")}dispatchWamEvent(e){e.type==="wam-automation"?this.scheduleAutomation(e):this.dispatchEvent(new CustomEvent(e.type,{detail:e}))}async setParameterValues(e){Object.keys(e).forEach(i=>{const h=e[i],_=this.parameters.get(i);!_||(h.normalized?_.normalizedValue=h.value:_.value=h.value)})}async getState(){return this.getParamsValues()}async setState(e){this.setParamsValues(e)}convertTimeToFrame(e){return Math.round(e*this.context.sampleRate)}convertFrameToTime(e){return e/this.context.sampleRate}getIParamIndex(e){const i=this.internalParams.indexOf(e);return i===-1?null:i}connectIParam(e,i,h){const _=1,w=this.getIParamIndex(e);w!==null&&(i instanceof AudioNode?typeof h=="number"?this.connect(i,_+w,h):this.connect(i,_+w):this.connect(i,_+w))}disconnectIParam(e,i,h){const _=1,w=this.getIParamIndex(e);w!==null&&(i instanceof AudioNode?typeof h=="number"?this.disconnect(i,_+w,h):this.disconnect(i,_+w):this.disconnect(i,_+w))}getIParamValue(e){const i=this.getIParamIndex(e);return i!==null?this.$paramsBuffer[i]:null}getIParamsValues(){const e={};return this.internalParams.forEach((i,h)=>{e[i]=this.$paramsBuffer[h]}),e}getParam(e){return this.parameters.get(e)||null}getParams(){return Object.fromEntries(this.parameters)}getParamValue(e){const i=this.parameters.get(e);return i?i.value:null}setParamValue(e,i){const h=this.parameters.get(e);!h||(h.value=i)}getParamsValues(){const e={};return this.parameters.forEach((i,h)=>{e[h]=i.value}),e}setParamsValues(e){!e||Object.entries(e).forEach(([i,h])=>{this.setParamValue(i,h)})}getNormalizedParamValue(e){const i=this.parameters.get(e);return i?i.normalizedValue:null}setNormalizedParamValue(e,i){const h=this.parameters.get(e);!h||(h.normalizedValue=i)}getNormalizedParamsValues(){const e={};return this.parameters.forEach((i,h)=>{e[h]=this.getNormalizedParamValue(h)}),e}setNormalizedParamsValues(e){!e||Object.entries(e).forEach(([i,h])=>{this.setNormalizedParamValue(i,h)})}setParamValueAtTime(e,i,h){const _=this.parameters.get(e);return _?_.setValueAtTime(i,h):null}setNormalizedParamValueAtTime(e,i,h){const _=this.parameters.get(e);return _?_.setNormalizedValueAtTime(i,h):null}linearRampToParamValueAtTime(e,i,h){const _=this.parameters.get(e);return _?_.linearRampToValueAtTime(i,h):null}linearRampToNormalizedParamValueAtTime(e,i,h){const _=this.parameters.get(e);return _?_.linearRampToNormalizedValueAtTime(i,h):null}exponentialRampToParamValueAtTime(e,i,h){const _=this.parameters.get(e);return _?_.exponentialRampToValueAtTime(i,h):null}exponentialRampToNormalizedParamValueAtTime(e,i,h){const _=this.parameters.get(e);return _?_.exponentialRampToNormalizedValueAtTime(i,h):null}setParamTargetAtTime(e,i,h,_){const w=this.parameters.get(e);return w?w.setTargetAtTime(i,h,_):null}setNormalizedParamTargetAtTime(e,i,h,_){const w=this.parameters.get(e);return w?w.setNormalizedTargetAtTime(i,h,_):null}setParamValueCurveAtTime(e,i,h,_){const w=this.parameters.get(e);return w?w.setValueCurveAtTime(i,h,_):null}setNormalizedParamValueCurveAtTime(e,i,h,_){const w=this.parameters.get(e);return w?w.setNormalizedValueCurveAtTime(i,h,_):null}cancelScheduledParamValues(e,i){const h=this.parameters.get(e);return h?h.cancelScheduledValues(i):null}cancelAndHoldParamAtTime(e,i){const h=this.parameters.get(e);return h?h.cancelAndHoldAtTime(i):null}connectEvents(e,i){this.call("connectEvents",e,i)}disconnectEvents(e,i){this.call("disconnectEvents",e,i)}async destroy(){this.disconnect(),this.paramsUpdateCheckFnRef.forEach(e=>{typeof e=="number"&&window.clearTimeout(e)}),await this.call("destroy"),this.port.close()}},X=class{static async create(e,i={}){const{audioContext:h,moduleId:_}=e,w=i.instanceId||e.instanceId,d=i.groupId||e.groupId,{paramsConfig:c,paramsMapping:l,internalParamsConfig:p}=new ne(i),s=Object.entries(c).reduce((o,[u,{defaultValue:f}])=>(o[u]=f,o),{}),r=Object.entries(c).reduce((o,[u,{id:f,label:a,type:m,defaultValue:v,minValue:g,maxValue:y,discreteStep:T,exponent:V,choices:I,units:P}])=>(o[u]={id:f,label:a,type:m,defaultValue:v,minValue:g,maxValue:y,discreteStep:T,exponent:V,choices:I,units:P},o),{});await L(h.audioWorklet,q,_,r);const t={internalParamsConfig:p,parameterData:s,processorOptions:{paramsConfig:c,paramsMapping:l,internalParamsMinValues:Object.values(p).map(o=>Math.max(0,(o==null?void 0:o.minValue)||0)),internalParams:Object.keys(p),groupId:d,instanceId:w,moduleId:_}},n=new re(e,t);return await n.initialize(),n}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"3NQx6":[function(N,k,A){var E=N("@parcel/transformer-js/src/esmodule-helpers.js");E.defineInteropFlag(A),E.export(A,"MIDI",()=>O),E.export(A,"createSamplerEngine",()=>W);var x=N("@webaudiomodules/sdk-parammgr");class O{static NOTE_ON=144;static NOTE_OFF=128;static CC=176}class C extends x.CompositeAudioNode{_wamNode=void 0;isEnabled=!0;pack=void 0;audioBuffers=new Map;samples=new Map;get paramMgr(){return this._wamNode}set status(b){this.isEnabled!==b&&(this.isEnabled=b,this.isEnabled?(console.log("BYPASS MODE OFF FX RUNNING"),this.wetGainNode.gain.linearRampToValueAtTime(1,this.context.currentTime+.5),this.dryGainNode.gain.linearRampToValueAtTime(0,this.context.currentTime+.5)):(console.log("BYPASS MODE ON"),this.wetGainNode.gain.linearRampToValueAtTime(0,this.context.currentTime+.5),this.dryGainNode.gain.linearRampToValueAtTime(1,this.context.currentTime+.5)))}constructor(b,S){super(b,S);this.createNodes()}setup(b){b.addEventListener("wam-midi",S=>this.processMIDIEvents([{event:S.detail.data.bytes,time:0}])),this._wamNode=b,this.connectNodes(),this._output=this.outputNode,console.log("sampler.wam CONSTRUCTOR SETUP",{thiswamNode:this._wamNode})}processMIDIEvents(b){b.forEach(S=>{if(S.event[0]==O.NOTE_ON){const R=S.event[1];S.event[2]?this.noteOn(R,S.time):this.noteOff(R,S.time)}else if(S.event[0]==O.NOTE_OFF){const R=S.event[1];this.noteOff(R,S.time)}})}async noteOn(b,S=1){console.log("SAMPLER : NOTE ON",{noteNumber:b,velocity:S},this)}async noteOff(b,S=0){console.log("note off",{noteNumber:b,velocity:S},this)}createNodes(){this.outputNode=this.context.createGain(),this.dryGainNode=this.context.createGain(),this.wetGainNode=this.context.createGain(),this.delayNode=this.context.createDelay(.05),this.feedbackGainNode=this.context.createGain()}connectNodes(){super.connect(this.wetGainNode),super.connect(this.dryGainNode),this.wetGainNode.gain.value=.5,this.wetGainNode.connect(this.delayNode),this.delayNode.delayTime.value=.05,this.delayNode.connect(this.feedbackGainNode),this.feedbackGainNode.gain.value=.6,this.feedbackGainNode.connect(this.wetGainNode),this.wetGainNode.connect(this.outputNode),this.dryGainNode.connect(this.outputNode)}async loadAudioArrayBuffer(b){return await(await fetch(b)).arrayBuffer()}async loadAudio(b,S=!1){const R=this.audioBuffers.get(b);if(!S&&R!==void 0)return R;const U=await this.loadAudioArrayBuffer(b),B=await this.context.decodeAudioData(U);return this.audioBuffers.set(b,B),B}fetchAudioBuffer(b,S=!0){const R=this.samples.get(b);if(!S&&R!==void 0)return R.stop(),R;const U=this.context.createBufferSource();return U.connect(this.wetGainNode),U.buffer=b,this.samples.set(b,U),U}async play(b,S=0,R=128,U={loop:!1}){let B=this.fetchAudioBuffer(b);B.loop=U.loop||!1,this.context.state==="suspended"&&await this.context.resume(),S==0?B.start(0):B.start(0,this.context.currentTime-S)}}A.default=C;const W=(z,b,S)=>new C(z,S)},{"@webaudiomodules/sdk-parammgr":"iUHts","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],gtP1k:[function(N,k,A){k.exports=N("b5193d6d39239015").getBundleURL("15zug")+N("ebbfd4dd82204d6b").resolve("3cLeh")},{b5193d6d39239015:"bGZ1f",ebbfd4dd82204d6b:"6jNRu"}],bGZ1f:[function(N,k,A){"use strict";var E={};function x(z){var b=E[z];return b||(b=O(),E[z]=b),b}function O(){try{throw new Error}catch(b){var z=(""+b.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^)\n]+/g);if(z)return C(z[2])}return"/"}function C(z){return(""+z).replace(/^((?:https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/.+)\/[^/]+$/,"$1")+"/"}function W(z){var b=(""+z).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^/]+/);if(!b)throw new Error("Origin not found");return b[0]}A.getBundleURL=x,A.getBaseURL=C,A.getOrigin=W},{}],"6jNRu":[function(N,k,A){"use strict";var E={};function x(C){for(var W=Object.keys(C),z=0;z<W.length;z++)E[W[z]]=C[W[z]]}function O(C){var W=E[C];if(W==null)throw new Error("Could not resolve bundle with id "+C);return W}k.exports.register=x,k.exports.resolve=O},{}],cyOqT:[function(N,k,A){k.exports=JSON.parse('{"name":"Sampler","identifier":"com.designerzen.sampler","vendor":"designerzen","description":"Simple Sample Player","version":"1.0.0","apiVersion":"2.0.0","thumbnail":"screenshot.png","keywords":["sampler"],"website":"https://interface.place","isInstrument":true,"hasMidiInput":true,"hasAudioInput":false,"hasAudioOutput":true}')},{}]},["3org3"],"3org3","parcelRequireaaed")});export default me();
