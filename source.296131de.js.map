{"mappings":"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,EAAe5N,UAAa,GAAE6N,wBAAqCC,WAK9DxT,EAAQ1B,MAUZmU,EAAG/M,WAAa,QAChBkN,EAAWjV,UAAUC,OAAQ,QAAQ,GACrC+U,EAAWhV,UAAUC,OAAQ,QAAQ,GACrC/B,EAAK8B,UAAUyE,IAAI,QACnBwQ,EAAW7R,iBAAkB,QAASC,GAAS+S,EAAAA,cAAc,KAZ7DpB,EAAWhV,UAAUC,OAAQ,QAAQ,GACrCgV,EAAWjV,UAAUC,OAAQ,QAAQ,GACrC/B,EAAK8B,UAAUyE,IAAI,QACnBuQ,EAAW5R,iBAAkB,QAASC,GAASgT,EAAAA,cAAc,IAc9D7D,EAASpP,iBAAiB,SAAWC,IACpCA,EAAMyO,mBAGJ,GAEHoD,EAAMnN,UAAY,+iBC9SU,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,MAGzD,MAAMiM,EAAqB,CACjC,gBACA,oBACA,2BACA,4BACA,4BACA,YACA,eACA,eACA,cACA,YACA,mBACA,cACA,iBACA,mBACA,oBACA,mBACA,4BACA,cACA,YACA,iBACA,mBACA,eACA,eACA,iBACA,wBACA,oBACA,eACA,2BACA,yBACA,2BACA,4BACA,2BACA,4BACA,uBACA,uBACA,mBACA,aACA,YACA,kBACA,oBACA,gBACA,sBACA,mBACA,sBACA,sBACA,mBACA,kBACA,iBACA,mBACA,wBACA,uBACA,cACA,gBACA,kBACA,iBACA,sBACA,cACA,WACA,oBACA,sBACA,sBACA,mBACA,qBACA,mBACA,oBACA,wBACA,cACA,kBACA,gBACA,oBACA,WACA,cACA,oBACA,sBACA,wBACA,oBACA,iBACA,sBACA,kBACA,kBACA,qBACA,iBACA,kBACA,gBACA,uBACA,cACA,wBACA,eACA,iBACA,qBACA,iBACA,eACA,iBACA,eACA,aACA,YACA,kBACA,kBACA,kBACA,kBACA,wBACA,wBACA,mBACA,mBACA,oBACA,oBACA,kBACA,iBACA,sBACA,sBACA,iBACA,sBACA,qBACA,gBACA,cACA,kBACA,sBACA,eACA,cACA,WACA,oBACA,iBACA,YACA,aACA,iBACA,cACA,gBAC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","sources":["./node_modules/@parcel/runtime-js/lib/JSRuntime.js","./node_modules/@parcel/runtime-js/lib/bundle-manifest.js","./source/index.js","./source/install.js","./source/ui.js","./source/instruments.js","./source/version.js","./source/utils.js","./source/full-screen.js","./source/location-handler.js","./source/palette.js","./node_modules/@parcel/runtime-js/lib/bundle-url.js","./node_modules/@parcel/runtime-js/lib/relative-path.js","./source/store.js","./source/speech.js","./source/audio.js","./source/maths.js","./source/timing.js","./node_modules/@parcel/runtime-js/lib/bundles/a5d6bd3da0a1d7f5f6fb9fa05f1fa458.js","./source/synthesizers.js","./source/midi.js","./node_modules/webmidi/dist/webmidi.esm.js","./node_modules/process/browser.js","./node_modules/jzz/javascript/JZZ.js","./node_modules/jazz-midi/index.js","./source/camera.js","./source/visual.js","./source/patterns.js","./source/instructions.js","./source/person.js","./source/reporting.js","./node_modules/analytics/lib/analytics.browser.cjs.js","./node_modules/@analytics/core/lib/analytics.browser.cjs.js","./node_modules/analytics-utils/lib/analytics-utils.browser.cjs.js","./node_modules/dlv/dist/dlv.umd.js","./node_modules/@analytics/storage-utils/lib/analytics-util-storage.browser.cjs.js","./node_modules/@analytics/cookie-utils/lib/analytics-util-cookie.browser.cjs.js","./node_modules/@analytics/google-analytics/lib/analytics-plugin-ga.browser.cjs.js","./node_modules/@parcel/runtime-js/lib/loaders/browser/js-loader.js","./node_modules/@parcel/runtime-js/lib/cacheLoader.js"],"sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _plugin = require(\"@parcel/plugin\");\n\nvar _utils = require(\"@parcel/utils\");\n\nvar _path = _interopRequireDefault(require(\"path\"));\n\nvar _nullthrows = _interopRequireDefault(require(\"nullthrows\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// List of browsers that support dynamic import natively\n// https://caniuse.com/#feat=es6-module-dynamic-import\nconst DYNAMIC_IMPORT_BROWSERS = {\n  edge: '76',\n  firefox: '67',\n  chrome: '63',\n  safari: '11.1',\n  opera: '50'\n};\nconst LOADERS = {\n  browser: {\n    css: './loaders/browser/css-loader',\n    html: './loaders/browser/html-loader',\n    js: './loaders/browser/js-loader',\n    wasm: './loaders/browser/wasm-loader',\n    IMPORT_POLYFILL: './loaders/browser/import-polyfill'\n  },\n  worker: {\n    js: './loaders/worker/js-loader',\n    wasm: './loaders/worker/wasm-loader',\n    IMPORT_POLYFILL: false\n  },\n  node: {\n    css: './loaders/node/css-loader',\n    html: './loaders/node/html-loader',\n    js: './loaders/node/js-loader',\n    wasm: './loaders/node/wasm-loader',\n    IMPORT_POLYFILL: null\n  }\n};\n\nfunction getLoaders(ctx) {\n  if (ctx.isWorker()) return LOADERS.worker;\n  if (ctx.isBrowser()) return LOADERS.browser;\n  if (ctx.isNode()) return LOADERS.node;\n  return null;\n}\n\nvar _default = new _plugin.Runtime({\n  apply({\n    bundle,\n    bundleGraph,\n    options\n  }) {\n    // Dependency ids in code replaced with referenced bundle names\n    // Loader runtime added for bundle groups that don't have a native loader (e.g. HTML/CSS/Worker - isURL?),\n    // and which are not loaded by a parent bundle.\n    // Loaders also added for modules that were moved to a separate bundle because they are a different type\n    // (e.g. WASM, HTML). These should be preloaded prior to the bundle being executed. Replace the entry asset(s)\n    // with the preload module.\n    if (bundle.type !== 'js') {\n      return;\n    }\n\n    let asyncDependencies = [];\n    let otherDependencies = [];\n    bundle.traverse(node => {\n      if (node.type !== 'dependency') {\n        return;\n      }\n\n      let dependency = node.value;\n\n      if (dependency.isAsync && !dependency.isURL) {\n        asyncDependencies.push(dependency);\n      } else {\n        otherDependencies.push(dependency);\n      }\n    });\n    let assets = [];\n\n    for (let dependency of asyncDependencies) {\n      let resolved = bundleGraph.resolveExternalDependency(dependency, bundle);\n\n      if (resolved == null) {\n        continue;\n      }\n\n      if (resolved.type === 'asset') {\n        // If this bundle already has the asset this dependency references,\n        // return a simple runtime of `Promise.resolve(require(\"path/to/asset\"))`.\n        assets.push({\n          filePath: _path.default.join(options.projectRoot, 'JSRuntime.js'),\n          // Using Promise['resolve'] to prevent Parcel from inferring this is an async dependency.\n          // TODO: Find a better way of doing this.\n          code: `module.exports = Promise['resolve'](require(${JSON.stringify('./' + _path.default.relative(options.projectRoot, resolved.value.filePath))}))`,\n          dependency\n        });\n      } else {\n        assets.push(...getLoaderRuntimes({\n          bundle,\n          dependency,\n          bundleGraph,\n          bundleGroup: resolved.value\n        }));\n      }\n    }\n\n    for (let dependency of otherDependencies) {\n      let resolved = bundleGraph.resolveExternalDependency(dependency, bundle);\n\n      if (dependency.isURL && resolved == null) {\n        // If a URL dependency was not able to be resolved, add a runtime that\n        // exports the original moduleSpecifier.\n        assets.push({\n          filePath: __filename,\n          code: `module.exports = ${JSON.stringify(dependency.moduleSpecifier)}`,\n          dependency\n        });\n        continue;\n      }\n\n      if (resolved == null || resolved.type !== 'bundle_group') {\n        continue;\n      }\n\n      let bundleGroup = resolved.value;\n      let mainBundle = (0, _nullthrows.default)(bundleGraph.getBundlesInBundleGroup(bundleGroup).find(b => {\n        let main = b.getMainEntry();\n        return main && bundleGroup.entryAssetId === main.id;\n      }));\n\n      if (mainBundle.isInline) {\n        assets.push({\n          filePath: _path.default.join(__dirname, `/bundles/${mainBundle.id}.js`),\n          code: `module.exports = ${JSON.stringify(dependency.id)};`,\n          dependency\n        });\n        continue;\n      } // URL dependency or not, fall back to including a runtime that exports the url\n\n\n      assets.push(getURLRuntime(dependency, bundle, mainBundle));\n    }\n\n    if (shouldUseRuntimeManifest(bundle) && bundleGraph.getChildBundles(bundle).length > 0 && isNewContext(bundle, bundleGraph)) {\n      assets.push({\n        filePath: __filename,\n        code: getRegisterCode(bundle, bundleGraph),\n        isEntry: true\n      });\n    }\n\n    return assets;\n  }\n\n});\n\nexports.default = _default;\n\nfunction getLoaderRuntimes({\n  bundle,\n  dependency,\n  bundleGroup,\n  bundleGraph\n}) {\n  let assets = []; // Sort so the bundles containing the entry asset appear last\n\n  let externalBundles = bundleGraph.getBundlesInBundleGroup(bundleGroup).filter(bundle => !bundle.isInline).sort(bundle => bundle.getEntryAssets().map(asset => asset.id).includes(bundleGroup.entryAssetId) ? 1 : -1); // CommonJS is a synchronous module system, so there is no need to load bundles in parallel.\n  // Importing of the other bundles will be handled by the bundle group entry.\n  // Do the same thing in library mode for ES modules, as we are building for another bundler\n  // and the imports for sibling bundles will be in the target bundle.\n\n  if (bundle.env.outputFormat === 'commonjs' || bundle.env.isLibrary) {\n    externalBundles = externalBundles.slice(-1);\n  }\n\n  let loaders = getLoaders(bundle.env); // Determine if we need to add a dynamic import() polyfill, or if all target browsers support it natively.\n\n  let needsDynamicImportPolyfill = false;\n\n  if (bundle.env.isBrowser() && bundle.env.outputFormat === 'esmodule') {\n    needsDynamicImportPolyfill = !bundle.env.matchesEngines(DYNAMIC_IMPORT_BROWSERS);\n  }\n\n  let loaderModules = loaders ? externalBundles.map(to => {\n    let loader = loaders[to.type];\n\n    if (!loader) {\n      return;\n    }\n\n    let relativePathExpr = getRelativePathExpr(bundle, to); // Use esmodule loader if possible\n\n    if (to.type === 'js' && to.env.outputFormat === 'esmodule') {\n      if (!needsDynamicImportPolyfill) {\n        return `import(\"./\" + ${relativePathExpr})`;\n      }\n\n      loader = (0, _nullthrows.default)(loaders.IMPORT_POLYFILL, `No import() polyfill available for context '${bundle.env.context}'`);\n    } else if (to.type === 'js' && to.env.outputFormat === 'commonjs') {\n      return `Promise.resolve(require(\"./\" + ${relativePathExpr}))`;\n    }\n\n    return `require(${JSON.stringify(loader)})(require('./bundle-url').getBundleURL() + ${relativePathExpr})`;\n  }).filter(Boolean) : [];\n\n  if (loaderModules.length > 0) {\n    let loaders = loaderModules.join(', ');\n\n    if (loaderModules.length > 1 && (bundle.env.outputFormat === 'global' || !externalBundles.every(b => b.type === 'js'))) {\n      loaders = `Promise.all([${loaders}])`;\n\n      if (bundle.env.outputFormat !== 'global') {\n        loaders += `.then(r => r[r.length - 1])`;\n      }\n    } else {\n      loaders = `(${loaders})`;\n    }\n\n    if (bundle.env.outputFormat === 'global') {\n      loaders += `.then(() => parcelRequire('${bundleGroup.entryAssetId}')${// In global output with scope hoisting, functions return exports are\n      // always returned. Otherwise, the exports are returned.\n      bundle.env.scopeHoist ? '()' : ''})`;\n    }\n\n    assets.push({\n      filePath: __filename,\n      code: `module.exports = ${loaders};`,\n      dependency\n    });\n  }\n\n  return assets;\n}\n\nfunction isNewContext(bundle, bundleGraph) {\n  return bundle.isEntry || bundleGraph.getParentBundles(bundle).some(parent => parent.env.context !== bundle.env.context || parent.type !== 'js');\n}\n\nfunction getURLRuntime(dependency, from, to) {\n  let relativePathExpr = getRelativePathExpr(from, to);\n\n  if (dependency.meta.webworker === true) {\n    return {\n      filePath: __filename,\n      code: `module.exports = require('./get-worker-url')(${relativePathExpr});`,\n      dependency\n    };\n  }\n\n  return {\n    filePath: __filename,\n    code: `module.exports = require('./bundle-url').getBundleURL() + ${relativePathExpr}`,\n    dependency\n  };\n}\n\nfunction getRegisterCode(entryBundle, bundleGraph) {\n  let idToName = {};\n  bundleGraph.traverseBundles((bundle, _, actions) => {\n    if (bundle.isInline) {\n      return;\n    }\n\n    idToName[getPublicBundleId(bundle)] = (0, _nullthrows.default)(bundle.name);\n\n    if (bundle !== entryBundle && isNewContext(bundle, bundleGraph)) {\n      // New contexts have their own manifests, so there's no need to continue.\n      actions.skipChildren();\n    }\n  }, entryBundle);\n  return \"require('./bundle-manifest').register(JSON.parse(\" + JSON.stringify(JSON.stringify(idToName)) + '));';\n}\n\nfunction getRelativePathExpr(from, to) {\n  if (shouldUseRuntimeManifest(from)) {\n    return `require('./relative-path')(${JSON.stringify(getPublicBundleId(from))}, ${JSON.stringify(getPublicBundleId(to))})`;\n  }\n\n  return JSON.stringify((0, _utils.relativeBundlePath)(from, to, {\n    leadingDotSlash: false\n  }));\n}\n\nfunction shouldUseRuntimeManifest(bundle) {\n  let env = bundle.env;\n  return !env.isLibrary && env.outputFormat === 'global' && env.isBrowser();\n}\n\nfunction getPublicBundleId(bundle) {\n  return bundle.id.slice(-16);\n}","\"use strict\";\n\nvar mapping = {};\n\nfunction register(pairs) {\n  var keys = Object.keys(pairs);\n\n  for (var i = 0; i < keys.length; i++) {\n    mapping[keys[i]] = pairs[keys[i]];\n  }\n}\n\nfunction resolve(id) {\n  var resolved = mapping[id];\n\n  if (resolved == null) {\n    throw new Error('Could not resolve bundle with id ' + id);\n  }\n\n  return resolved;\n}\n\nmodule.exports.register = register;\nmodule.exports.resolve = resolve;","// Just a simple face detection script with visual overlaid feedback and audio\r\n// https://github.com/tensorflow/tfjs-models/tree/master/face-landmarks-detection\r\n// Best used with the Looking Glass Portrait\r\nimport {installer} from './install.js'\r\n\r\nimport {createStore} from './store'\r\n\r\nimport {say, hasSpeech} from './speech'\r\n\r\n// You need to require the backend explicitly because facemesh itself does not\r\nimport { \r\n\taudioContext,\r\n\tactive, playing, \r\n\trandomInstrument, \r\n\tplayAudio, stopAudio, \r\n\tupdateByteFrequencyData,\r\n\tbufferLength,dataArray, \r\n\tsetupAudio,\r\n\tgetVolume, setVolume, setAmplitude, \r\n\trecord } from './audio'\r\n\r\nimport { \r\n\tgetBars, setBars, getBar, \r\n\tstart, stop,\r\n\tnow, \r\n\tsetTimeBetween, timePerBar, \r\n\tgetBPM } from './timing.js'\r\n\t\r\nimport {\r\n\tprogressBar, \r\n\tvideo,isVideoVisible,toggleVideoVisiblity,\r\n\tsetToggle, setButton, \r\n\tsetupMIDIButton, \r\n\tshowUpdateButton, showReloadButton,\r\n\tsetupCameraForm, \r\n\tsetupInterface, addToolTips,\r\n\tsetFeedback, setToast } from './ui'\r\nimport { getLocationSettings, getShareLink, addToHistory } from './location-handler'\r\nimport { createDrumkit } from './synthesizers'\r\nimport { setupMIDI } from './midi'\r\nimport { detectCameras, setupCamera, filterVideoCameras } from './camera'\r\nimport { setupImage, getCanvasDimensions } from './visual'\r\nimport { takePhotograph, overdraw, setNodeCount, updateCanvasSize, clear, canvas, drawWaves, drawBars, drawQuantise, drawElement } from './visual'\r\nimport { playNextPart, kitSequence } from './patterns'\r\nimport { getInstruction, getHelp } from './instructions'\r\nimport Person, {DEFAULT_OPTIONS, NAMES} from './person'\r\nimport { setupReporting, track, trackError, trackExit } from './reporting'\r\nimport { VERSION } from './version'\r\n\r\n// DOM Elements\r\nconst body = document.documentElement\r\nconst main = document.querySelector(\"main\")\r\nconst image = document.querySelector(\"img\")\r\n\r\n// Record stuff\r\nconst {isRecording, startRecording, stopRecording} = record()\r\n\r\nconst store = createStore()\r\n\r\n// coletion of persons\r\nconst people = []\r\nlet inputElement = video // image\r\n\t\t\r\nlet instrument\r\n\r\nlet camera\r\nlet photo\r\nlet audio \r\nlet midi\r\nlet midiButton\r\n\r\nlet reporter\r\n\r\n// samples and synths\r\nlet kit\r\nlet patterns\r\nlet recorder\r\n\r\n// As each sample is 2403 ms long, we should try and do it \r\n// as a factor of that, so perhaps bars would be better than BPM?\r\n\r\nlet isLoading = true\r\nlet ultimateFailure = false\r\nlet midiAvailable = false\r\nlet cameraLoading = false\r\nlet noFacesFound = false\r\nlet counter = 0\r\n\r\n// for disco mode!\r\nconst cameraPan = {x:1,y:1}\r\n\r\n// should be set on the html but jic\r\nbody.classList.toggle(\"loading\", true)\r\n\r\n// realtime UI options\r\nconst ui = getLocationSettings({\r\n\t// play a constant beat\r\n\tmetronome:false,\r\n\t// play music at same time\r\n\tbackingTrack:false,\r\n\t// clear canvas every frame (if transparent will be ignored)\r\n\tclear:true,\r\n\t// draw video onto canvas\r\n\ttransparent:true,\r\n\t// same thing?\r\n\tsynch:true,\r\n\t// show debug texts\r\n\tdebug:process.env.NODE_ENV === \"development\",\r\n\t// cancel audio playback (not midi)\r\n\tmuted:false,\r\n\t// dual person mode (required reload)\r\n\tduet:false,\r\n\t// synchronise the beats with metronome\r\n\tquantise:true,\r\n\t// show the person's texts above them\r\n\ttext:true,\r\n\t// audio visualiser is actually helpful to play\r\n\tspectrogram:true,\r\n\t// read out important instructions\r\n\tspeak:true\r\n})\r\n\r\nconst SETTINGS = {\r\n\r\n\t// maxFaces - The maximum number of faces detected in the input. Should be set to the minimum number for performance. Defaults to 10.\r\n\tmaxFaces:ui.duet ? 2 : 1,\r\n\t\r\n   \t// Whether to load the MediaPipe iris detection model (an additional 2.6 MB of weights). The MediaPipe iris detection model provides (1) an additional 10 keypoints outlining the irises and (2) improved eye region keypoints enabling blink detection. Defaults to true.\r\n\tshouldLoadIrisModel:true,\r\n\t\r\n\t// maxContinuousChecks - How many frames to go without running the bounding box detector. Only relevant if maxFaces > 1. Defaults to 5.\r\n    // detectionConfidence - Threshold for discarding a prediction. Defaults to 0.9.\r\n    // iouThreshold - A float representing the threshold for deciding whether boxes overlap too much in non-maximum suppression. Must be between [0, 1]. Defaults to 0.3. A score of 0 means no overlapping faces will be detected, whereas a score closer to 1 means the model will attempt to detect completely overlapping faces.\r\n    // scoreThreshold - A threshold for deciding when to remove boxes based on score in non-maximum suppression. Defaults to 0.75. Increase this score in order to reduce false positives (detects fewer faces).\r\n    // modelUrl - Optional param for specifying a custom facemesh model url or a tf.io.IOHandler object.\r\n    // irisModelUrl - Optional param for specifying a custom iris model url or a tf.io.IOHandler object.\r\n}\r\n\r\n// TODO: a version of the instructor that also reads out the messages\r\nconst setToaster = (message, time=0) => {\r\n\tif (ui.speak)\r\n\t{\r\n\t\tspeak( message,true)\r\n\t}\r\n\tsetToast(message,time)\r\n\t\r\n}\r\n\r\n// This sets the master volume below the compressor\r\nconst setMasterVolume = volume => {\r\n\tconst r = setVolume(volume)\r\n\tstore.setItem('audio', { volume:r })\r\n\tsetToast(`Volume ${Math.ceil(r * 100)}%`,0)\r\n\treturn r\r\n}\r\n\r\nconst speak = toSay => {\r\n\tif ( ui.speak && hasSpeech() ) \r\n\t{\r\n\t\tsay(toSay,true)\r\n\t}\r\n}\r\n\r\n// For all people!\r\nconst loadInstruments = async (method, callback) => people.map( async (person) => { \r\n\tconst instrument = await person[method](callback)\r\n\tsetToast(`${person.name} has ${instrument} loaded`)\r\n\tconsole.log(`${person.name} has ${instrument} loaded` )\r\n\treturn instrument\r\n})\r\n\r\nconst loadRandomInstrument = async (callback) => await loadInstruments('loadRandomInstrument', callback)\r\nconst previousInstrument = async (callback) => await loadInstruments('loadPreviousInstrument', callback)\r\nconst nextInstrument = async (callback) => await loadInstruments('loadNextInstrument', callback)\r\n\r\n// We cache every new user!\r\nconst getPerson = (index) => {\r\n\t\r\n\tconst duetAvailable = ui.duet\r\n\r\n\tif (people[index] == undefined)\r\n\t{\r\n\t\tconst options = { \r\n\t\t\tdots:'green', \r\n\t\t\tleftEyeIris:'blue', \r\n\t\t\trightEyeIris:'blue',\r\n\t\t\thue:Math.random() * 360,\r\n\t\t\tdebug:ui.debug\r\n\t\t}\r\n\t\tconst name = NAMES[index]\r\n\t\tconst savedOptions = store.has(name) ? store.getItem(name) : {}\r\n\t\tconst person = new Person(name, audioContext, audio, options ) \r\n\t\t// see if there is a stored name for the instrument...\r\n\t\tconst instrument = savedOptions.instrument || randomInstrument()\r\n\t\r\n\t\t// the instrument has changed / loaded!\r\n\t\tperson.button.addEventListener( 'instrumentchange', event => {\r\n\t\t\t// save it for next time\r\n\t\t\tconst {detail} = event\r\n\t\t\tconst cache = store.setItem(name, {instrument:detail.instrumentName })\r\n\t\t\tconsole.log(\"External event for \",{ person, detail , cache})\r\n\t\t})\r\n\t\tperson.loadInstrument( instrument, instrumentName => {} )\r\n\t\t\r\n\t\t//console.error(name, {instrument, person, savedOptions})\r\n\t\t\r\n\t\tif (midi && midi.outputs && midi.outputs.length > 0) \r\n\t\t{\r\n\t\t\tperson.setMIDI( midi.outputs[0] )\r\n\t\t}\r\n\t\tpeople.push( person )\r\n\t\treturn person\r\n\t} else{\r\n\t\treturn people[index]\r\n\t}\r\n}\r\n\r\n// BEGIN ---------------------------------------\r\n\r\n// start on click as things require gesture for permission\r\nconst enableMIDIForPerson = (personIndex=0, portIndex=0) => {\r\n\tconst person = getPerson(personIndex)\r\n\tperson.setMIDI(midi.outputs[portIndex])\r\n\tconsole.log(\"Enabling MIDI for\", person)\r\n}\r\n\r\n// this needs a user interaction to trigger\r\nconst enableMIDI = async () => {\r\n\r\n\ttry{\r\n\t\tmidi = await setupMIDI()\r\n\t\t// console.log(midi.inputs)\r\n\t\tif (midi.outputs.length>0)\r\n\t\t{\r\n\t\t\t// w00t\r\n\t\t\tconsole.log(\"MIDI devices\", midi.outputs, midi)\r\n\t\t\tsetFeedback(\"MIDI Available<br>Stand By\", 0)\r\n\t\t\t// use this to fill the peoples\r\n\t\t\tenableMIDIForPerson(0,0)\r\n\t\t\t\r\n\t\t}else{\r\n\t\t\t// bugger\r\n\t\t\tconsole.log(\"No MIDI devices detected\", midi)\r\n\t\t\tsetFeedback(\"MIDI Available but no instruments detected\", 0)\r\n\t\t\tsetToast(\"No MIDI Device connected\")\r\n\t\t\tmain.classList.toggle('midi-no-devices', true)\r\n\t\t}\r\n\t\t\r\n\t\t// midi device connected! huzzah!\r\n\t\tmidi.addListener(\"connected\", (e) => {\r\n\t\t\tconsole.log(e)\r\n\t\t\tsetFeedback(\"MIDI Device connected!\")\r\n\t\t\t// check outputs\r\n\t\t\tif (midi.outputs.length > 0)\r\n\t\t\t{\r\n\t\t\t\tmain.classList.toggle('midi-no-devices', false)\r\n\t\t\t\tpeople.forEach( (person,i) => enableMIDIForPerson(i,0) )\r\n\t\t\t}\r\n\t\t\tmidiButton.setText(\"Click to disable\")\r\n\t\t})\r\n\t\t\r\n\t\t// Reacting when a device becomes unavailable\r\n\t\tmidi.addListener(\"disconnected\", (e) => {\r\n\t\t\tconsole.log(e)\r\n\t\t\tsetFeedback(\"Lost MIDI Device connection\")\r\n\t\t\tif (midi.outputs.length > 0)\r\n\t\t\t{\r\n\r\n\t\t\t}else{\r\n\t\t\t\tmain.classList.toggle('midi-no-devices', true)\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\tmidiAvailable = midi // && midi.outputs && midi.outputs.length > 0\r\n\t\tmain.classList.add('midi-available')\r\n\r\n\t\tsetToast(midi.outputs.length > 0 ? \"MIDI Connected\" : \"Connect a MIDI Device to continue\")\r\n\r\n\t}catch(error){\t\r\n\r\n\t\t// failed\r\n\t\tconsole.error(\"Total failure\", error)\r\n\t\t// this needs a user interaction to trigger\r\n\t\tsetFeedback(\"MIDI NOT Available<br>\"+error, 0)\r\n\t\treturn false\r\n\t}\r\n\t// suvvess\r\n\treturn true\t\r\n}\r\n\r\nconst disableMIDI = () => {\r\n\t// midiButton.setText()\r\n}\r\n\r\n// MIDI will require a user interaction\r\nconst showMIDI = async () => {\r\n\r\n\t// to skip clicking but results in a warning\r\n\tmidiButton = setupMIDIButton( async (b) => {\r\n\t\tawait enableMIDI()\r\n\t\tsetFeedback(\"MIDI available<br>Connecting to instruments...\", 0)\r\n\t\tconsole.log(\"User input detected so enabling MIDI!\")\r\n\t\tmain.classList.add('midi-activated')\r\n\t\treturn false\r\n\t})\r\n\t\r\n\treturn true\r\n}\r\n\r\nconst loadCamera = async (deviceId, name=\"Default\") => {\r\n\tlet newCamera\r\n\t// prevent screen re-draw\r\n\tcameraLoading = true\r\n\ttry{\r\n\t\t\r\n\t\tnewCamera = await setupCamera( video, deviceId )\r\n\t\tif (deviceId && deviceId.length > 0)\r\n\t\t{\r\n\t\t\tstore.setItem( 'camera', {deviceId} )\r\n\t\t\t\r\n\t\t\tconsole.log( deviceId, \"Camera id saved\")\r\n\t\t}\r\n\t\t \r\n\t\ttrack('Action', {category:'Camera', label:name, value:deviceId})\r\n\t\t\t\t\t\t\r\n\t}catch(error){\r\n\t\tconsole.error( deviceId, \"Camera errored\", error)\r\n\t\ttrackError( `${name} camera could not be accessed`, deviceId, \"Camera\" )\r\n\t\tthrow error\r\n\t}\r\n\t\r\n\tcameraLoading = false\r\n\treturn newCamera\r\n}\r\n\r\n// selected\r\nconst setup = async (settings, progressCallback) => {\r\n\r\n\tconst loadTotal = 10\r\n\tlet loadIndex = 0\r\n\r\n\tprogressCallback(loadIndex++/loadTotal)\r\n\r\n\t// test of loading external scripts sequentially...\r\n\tconst {loadModel} = await import('./predictor')\r\n\r\n\tprogressCallback(loadIndex++/loadTotal)\r\n\r\n\t// set up the instrument selctor etc\r\n\tsetupInterface( ui )\r\n\tprogressCallback(loadIndex++/loadTotal)\r\n\r\n\t// Connect up sone buttons?\r\n\tsetToggle( \"button-quantise\", status =>{\r\n\t\tui.quantise = status\r\n\t\taddToHistory(ui,'quantise')\r\n\t\tmain.classList.toggle('flag-quantise', status )\r\n\t\tsetToast(\"Quantise \" + (ui.quantise ? 'enabled' : 'disabled')  )\r\n\t}, ui.quantise)\r\n\r\n\t// Connect up sone buttons?\r\n\tsetToggle( \"button-metronome\", status =>{\r\n\t\tui.metronome = status\r\n\t\taddToHistory(ui,'metronome')\r\n\t\tmain.classList.toggle('flag-metronome', status )\r\n\t\tsetToast(\"Metronome \" + (ui.metronome ? 'enabled' : 'disabled')  )\r\n\t}, ui.metronome )\r\n\r\n\tsetToggle( \"button-spectrogram\", status =>{\r\n\t\tui.spectrogram = status\r\n\t\taddToHistory(ui,'spectrogram')\r\n\t\tmain.classList.toggle('flag-spectrogram', status )\r\n\t\tsetToast(\"Spectrogram \" + (ui.spectrogram ? 'enabled' : 'disabled')  )\r\n\t}, ui.spectrogram )\r\n\r\n\tsetToggle( \"button-transparent\", status =>{\r\n\t\tui.transparent = status\r\n\t\taddToHistory(ui,'transparent')\r\n\t\tmain.classList.toggle('flag-transparent', status )\r\n\t\tsetToast(\"Video Synch \" + (ui.spectrogram ? 'enabled' : 'disabled')  )\r\n\t}, ui.transparent )\r\n\r\n\tsetToggle( \"button-clear\", status =>{ \r\n\t\tui.clear = status\r\n\t\taddToHistory(ui,'clear')\r\n\t\tmain.classList.toggle('flag-clear', status )\r\n\t}, ui.clear )\r\n\r\n\tsetToggle( \"button-overlay\", status => toggleVideoVisiblity(), !isVideoVisible() )\r\n\r\n\t// Button video loads random instruments for all\r\n\tsetButton( \"button-video\", status => loadRandomInstrument() )\r\n\t\r\n\tsetButton( \"button-photograph\", event => {\r\n\t\tconst unique = Math.ceil( now() * 10000000 )\r\n\t\tconst id = `photograph-${unique}`\r\n\t\tconst dimensions = getCanvasDimensions()\r\n\t\tconst img = new Image()\r\n\t\timg.src = takePhotograph()\r\n\t\timg.alt = \"Photograph taken \" + Date.now().toString()\r\n\t\timg.width = dimensions.width\r\n\t\timg.height = dimensions.height\r\n\r\n\t\tconst anchor = document.createElement(\"a\")\r\n\t\tanchor.href = img.src\r\n\t\tanchor.innerHTML = `Click to download this photograph`\r\n\t\tanchor.id = id\r\n\t\tanchor.download = `snapshot-${unique}.png`\r\n\t\tanchor.appendChild(img)\r\n\r\n\t\tdocument.getElementById(\"photographs\").appendChild(anchor)\r\n\r\n\t\trequestAnimationFrame( ()=>document.getElementById(id).scrollIntoView() )\r\n\t} )\r\n\r\n\tprogressCallback(loadIndex++/loadTotal)\r\n\t\r\n\t// create our reporter for analytics\r\n\t// reporter.track()\r\n\treporter = setupReporting(\"InterFACE\")\r\n\r\n\t// Load tf model and wait\r\n\tloadModel(inputElement, settings).then( async update =>{ \r\n\r\n\t\ttry{\r\n\t\t\t\r\n\t\t\tsetFeedback(\"Setting things up\")\r\n\t\t\tprogressCallback(loadIndex++/loadTotal)\r\n\r\n\t\t\tif (image)\r\n\t\t\t{\r\n\t\t\t\tsetFeedback( \"Image downloaded...<br> Please wait\")\r\n\t\t\t\tphoto = await setupImage(image)\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tprogressCallback(loadIndex++/loadTotal)\r\n\r\n\t\t\t// wait for video or image to be loaded!\r\n\t\t\tif (video)\r\n\t\t\t{\r\n\t\t\t\tconst deviceId = store.has('camera') ? store.getItem('camera').deviceId : undefined\r\n\t\t\t\tsetFeedback( deviceId ? \"Found saved camera\" : \"Attempting to locate a camera...<br>Please click accept if you are prompted\")\r\n\t\t\t\r\n\t\t\t\ttry{\r\n\t\t\t\t\tcamera = await loadCamera(deviceId, \"Saved\")\r\n\r\n\t\t\t\t}catch( error ) {\r\n\r\n\t\t\t\t\tsetFeedback( \"Could not open saved camera, looking for another...\")\r\n\t\t\t\t\t// bummer! try and use fallback?\r\n\t\t\t\t\tcamera = await loadCamera()\r\n\t\t\t\t\t// delete saved key\r\n\t\t\t\t\tstore.removeItem('cameraId')\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// check to see if we want a selector\r\n\t\t\t\tconst videoCameraDevices = filterVideoCameras( await detectCameras() )\r\n\t\t\t\tif (videoCameraDevices.length > 1)\r\n\t\t\t\t{\r\n\t\t\t\t\tsetupCameraForm(videoCameraDevices, async (selected) => {\r\n\t\t\t\t\t\tcamera = loadCamera( selected.deviceId, selected.label )\r\n\t\t\t\t\t\t//console.log( selected.deviceId, \"Camera selected\",selected, camera)\r\n\t\t\t\t\t\tsetToast( `Camera ${selected.label} changed`, 0 )\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\r\n\t\t\t\t\t// show / hide camera button\r\n\t\t\t\t\tmain.classList.toggle(\"multiple-cameras\", true)\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tsetFeedback( \"Camera located!\", 0 )\r\n\t\t\t\tprogressCallback(loadIndex++/loadTotal)\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// at this point the video dimensions are accurate\r\n\t\t\t// so we add the main style vars\r\n\t\t\tmain.style.setProperty('--width', video.width )\r\n\t\t\tmain.style.setProperty('--height', video.height )\r\n\t\t\tmain.classList.toggle('landscape', video.width > video.height )\r\n\t\t\tmain.classList.toggle('portrait', video.width < video.height )\r\n\t\t\tmain.classList.toggle('square', video.width === video.height )\r\n\t\t\t\r\n\t\t\tupdateCanvasSize(video.width, video.height)\r\n\t\t\tprogressCallback(loadIndex++/loadTotal)\r\n\r\n\t\t}catch(error){\r\n\r\n\t\t\tconst errorMessage = String(error).replace(\"NotAllowedError: \",'')\r\n\t\t\t// NotAllowedError: Permission denied\r\n\t\t\tsetFeedback(\"Camera could not be accessed<br>\"+errorMessage, 0)\r\n\t\t\tsetToast( errorMessage )\r\n\t\t\tisLoading = false\r\n\t\t\tultimateFailure = true\r\n\t\t\ttrackError('Camera Rejected or Not allowed')\r\n\t\t\t// FATAL ERROR\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\ttry{\r\n\t\t\taudio = setupAudio()\r\n\t\t\tsetFeedback( \"Audio Available...<br>Instrument \"+instrument+\" Sounds downloaded\", 0 )\r\n\t\t\tprogressCallback(loadIndex++/loadTotal)\r\n\r\n\t\t\t// not neccessary if using Person\r\n\t\t\t// instrument = await loadInstrument( randomInstrument() )\r\n\t\t\t// const instrumentName = await loadRandomInstrument()\r\n\t\t\t// // now you can play any of the objects keys with\r\n\t\t\t// // playTrack(instrument[ INSTRUMENT_NAMES[0] ], 0)\r\n\t\t\t// //playTrack(instrument.A0, 0)\r\n\t\t\t// setFeedback( instrumentName.name + \" Samples available...<br>Instrument Sounds downloaded\")\r\n\t\t\t\r\n\t\t\tkit = createDrumkit()\r\n\t\t\tpatterns = kitSequence()\r\n\r\n\t\t\t// console.log(\"Streamin\", {video, photo, camera} )\r\n\t\t\tsetFeedback( \"Audio available...<br>Instrument Sounds ready\")\r\n\t\t\tprogressCallback(loadIndex++/loadTotal)\r\n\r\n\t\t}catch(error){\r\n\r\n\t\t\tultimateFailure = true\r\n\t\t\tsetFeedback(\"Something went wrong with the Audio<br>\"+error, 0)\r\n\t\t\treturn \r\n\t\t}\r\n\r\n\t\t// MIDI ------\r\n\t\ttry{\r\n\t\t\t// rather than enabling midi directly we show a button to enable it\r\n\t\t\tconst hasMIDI = await showMIDI()\r\n\t\t\tif (hasMIDI)\r\n\t\t\t{\r\n\t\t\t\tmain.classList.add('midi')\r\n\t\t\t\tsetFeedback(\"MIDI available<br>Click the button to connect\", 0)\r\n\t\t\t}else{\r\n\t\t\t\tmain.classList.add('midi','no-instrument')\r\n\t\t\t\tsetFeedback(\"MIDI available<br>Connect an instrument <small>and click the button</small>\", 0)\r\n\t\t\t}\r\n\t\t\tprogressCallback(loadIndex++/loadTotal)\r\n\r\n\t\t}catch(error){\r\n\t\t\t// no midi - don't show midi button\r\n\t\t\tconsole.log(\"no MIDI!\", error)\r\n\t\t\tmain.classList.add('no-midi')\r\n\t\t\tsetFeedback(\"MIDI unavailable, or no instrument connected<br>\"+error, 0)\r\n\t\t}\r\n\t\t\r\n\t\t// const {startRecording, stopRecording} = record(stream)\r\n\t\t\r\n\t\t// set the input element to either the image or the video\r\n\t\t// hide the other or just set the class?\r\n\r\n\t\t// set the canvas to the size of the video / image\r\n\t\tcanvas.width = inputElement.width\r\n\t\tcanvas.height = inputElement.height\r\n\r\n\t\t// console.error(\"Tensorflow\", tf)\r\n\t\tmain.classList.add( inputElement.nodeName.toLowerCase() )\r\n\t\t\r\n\t\taddToolTips()\r\n\r\n\t\t// turn up the amp\r\n\t\tconst volume = store.getItem('audio') ? parseFloat(store.getItem('audio').volume) : 1\r\n\t\tsetVolume( volume > 0 ? volume : 1 )\r\n\r\n\t\t// load scripts once eveything has completed...\r\n\t\t// setTimeout( ()=>{\r\n\t\t// }, 0 )\r\n\r\n\t\t// ----------------------------------------------------------------------------------\r\n\t\r\n\r\n\t\t// after a period of inactivity...\r\n\t\t//setFeedback(\"Everything is ready to \"+ (inputElement === video? \"record\" : \"read\"))\r\n\t\r\n\t\t// remove loading flag as we now have all of our assets!\r\n\t\r\n\t\tprogressCallback(loadIndex++/loadTotal)\r\n\t\t\r\n\r\n\t\t// update( inputElement === video, (predictions)=>{\r\n\r\n\t\t// \t//console.log(inputElement === video, \"Predictions found \",predictions)\r\n\t\t// })\r\n\t\t// console.log(inputElement === video, \"Waiting on predicions\")\r\n\t\t// return\r\n\t\t// LOOP ---------------------------------------\r\n\r\n\t\tconst shouldUpdate = () => !cameraLoading\r\n\r\n\t\t// FaceMesh.getUVCoords \r\n\t\t// this then runs the loop if set to true\r\n\t\tupdate( inputElement === video, (predictions)=>{\r\n\r\n\t\t\tif(isLoading)\r\n\t\t\t{\r\n\t\t\t\tisLoading = false\r\n\t\t\t}\r\n\r\n\t\t\t// return if camera is still connecting...\r\n\t\t\tif (cameraLoading)\r\n\t\t\t{\r\n\t\t\t\t//console.log(\"update:progress loading\")\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tlet tickerTape = ''\r\n\t\t\tcounter++\r\n\t\r\n\t\t\tif (ui.clear)\r\n\t\t\t{\r\n\t\t\t\t// clear for invisible canvas but \r\n\t\t\t\t// NB. this may cause visual disconnect\r\n\t\t\t\tclear()\r\n\t\t\t\t\r\n\t\t\t\tif (!ui.transparent)\r\n\t\t\t\t{\r\n\t\t\t\t\t// paste video frame\r\n\t\t\t\t\tdrawElement( inputElement )\r\n\t\t\t\t}\r\n\r\n\t\t\t}else{\r\n\t\t\t\t// switch effect type?\r\n\t\t\t\tconst t = counter * 0.01\r\n\t\t\t\t\r\n\t\t\t\toverdraw( -7 * cameraPan.x + Math.sin(t), -4 * cameraPan.y + Math.cos(t))\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (ui.quantise)\r\n\t\t\t{\r\n\t\t\t\t// Start on BAR\r\n\t\t\t\t// show quantise\r\n\t\t\t\tdrawQuantise(true, getBar())\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (ui.spectrogram)\r\n\t\t\t{\r\n\t\t\t\t//drawWaves( dataArray, bufferLength )\r\n\t\t\t\t\r\n\t\t\t\tupdateByteFrequencyData()\r\n\t\t\t\tdrawBars( dataArray, bufferLength )\r\n\t\t\t}\r\n\t\t\t\t\r\n\t\t\tif (predictions)\r\n\t\t\t{\r\n\t\t\t\t// loop through all predictions...\r\n\t\t\t\tfor (let i=0, l=predictions.length; i < l; ++i)\r\n\t\t\t\t{\r\n\t\t\t\t\tconst prediction = predictions[i]\r\n\t\t\t\t\t// create as many people as we need\r\n\t\t\t\t\tconst person = getPerson(i)\r\n\t\t\t\t\r\n\t\t\t\t\t// face available!\r\n\t\t\t\t\tif (prediction && prediction.faceInViewConfidence > 0.9)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t//if (!act)\r\n\t\t\t\t\t\t//main.classList.toggle(\"active\", true)\r\n\t\t\t\t\t\t// playAudio()\r\n\t\t\t\t\t\tif (noFacesFound)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tnoFacesFound = false\r\n\t\t\t\t\t\t\tmain.classList.toggle( `${person.name}-active`, true)\r\n\t\t\t\t\t\t\tmain.classList.toggle( `no-faces`, false)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}else{\r\n\r\n\t\t\t\t\t\t// stopAudio()\r\n\t\t\t\t\t\tif (!noFacesFound)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t// face found!??\r\n\t\t\t\t\t\t\tmain.classList.toggle( `${person.name}-active`, false)\r\n\t\t\t\t\t\t\tmain.classList.toggle( `no-faces`, true)\r\n\t\t\t\t\t\t\tnoFacesFound = true\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tsetFeedback( getHelp( Math.floor(counter/100) ) )\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// first update the person\r\n\t\t\t\t\tperson.update(prediction)\r\n\r\n\t\t\t\t\t// then redraw them\r\n\t\t\t\t\t// const { yaw, pitch, lipPercentage } = \r\n\t\t\t\t\tperson.draw(prediction, ui.text)\r\n\t\t\t\t\t\r\n\t\t\t\t\t// then whenever you fancy it,\r\n\t\t\t\t\tif (!ui.quantise && !ui.muted)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// unless quantize is turned off\r\n\t\t\t\t\t\tconst stuff = person.sing()\r\n\t\t\t\t\t\t// stuff.eyeDirection\r\n\t\t\t\t\t\tif (i===0)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t// stuff.eyeDirection\r\n\t\t\t\t\t\t\t// use person 1's eyes to control other stuff too?\r\n\t\t\t\t\t\t\t// in this case the direction of the pan in disco mode\r\n\t\t\t\t\t\t\tcameraPan.x = stuff.eyeDirection\r\n\t\t\t\t\t\t\tcameraPan.y = stuff.pitch\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t// we only want it on the beat\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// you want a tight curve\r\n\t\t\t\t\t//setFrequency( 1/4 * 261.63 + 261.63 * lipPercentage)\r\n\t\t\t\t\ttickerTape += `<br>PITCH:${prediction.pitch} ROLL:${prediction.roll} YAW:${prediction.yaw} MOUTH:${Math.ceil(100*prediction.mouthRange/DEFAULT_OPTIONS.LIPS_RANGE)}%`\r\n\t\t\t\t\t// tickerTape += `<br>PITCH:${Math.ceil(100*prediction.pitch)} ROLL:${Math.ceil(100*prediction.roll)} YAW:${180*prediction.yaw} MOUTH:${Math.ceil(100*prediction.mouthRange/DEFAULT_OPTIONS.LIPS_RANGE)}%`\r\n\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t}else{\r\n\t\t\t\t// tickerTape += `No prediction`\r\n\t\t\t}\r\n\r\n\t\t\t// Feedback text changes depending on time\r\n\t\t\tif (!predictions)\r\n\t\t\t{\r\n\t\t\t\t// Need to show instructions to the user...\r\n\t\t\t\t// as no face can be detected\r\n\t\t\t\tsetFeedback( getHelp( Math.floor(counter/100)  ))\r\n\t\t\t// }else if (tickerTape.length){\r\n\t\t\t// \tsetFeedback(tickerTape)\r\n\t\t\t// \t// setFeedback(`PITCH:${Math.ceil(360*prediction.pitch)} ROLL:${Math.ceil(360*prediction.roll)} YAW:${Math.ceil(360 * prediction.yaw)} MOUTH:${Math.ceil(100*lipPercentage)}% - ${person.instrumentName}`)\r\n\t\t\t}else{\r\n\t\t\t\tsetFeedback( getInstruction( Math.floor(counter/100) ))\r\n\t\t\t\t// setFeedback(`Look at me and open your mouth`)\r\n\t\t\t}\r\n\r\n\t\t\t//console.warn(\"update\",predictions, tickerTape )\r\n\t\t}, shouldUpdate )\r\n\r\n\r\n\t\t// Metronome\r\n\t\tconst timer = start( ({bar, bars, barsElapsed, timePassed, elapsed, expected, drift, level, intervals, lag} )=>{\r\n\t\t\r\n\t\t\tif (ui.muted)\r\n\t\t\t{\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tif (ui.metronome && bars % 2 === 0 )\r\n\t\t\t{\r\n\t\t\t\t// TODO: change timbre for first & last stroke\r\n\t\t\t\tconst metronomeLength = 0.1\r\n\t\t\t\tkit.clack( metronomeLength, bars % 4 === 0 ? 0.2 : 0.1 )\r\n\t\t\t}\r\n\r\n\t\t\t// console.log(barsElapsed, \"timer\", timer)\r\n\t\t\t// Play metronome!\r\n\t\t\tif(ui.quantise)\r\n\t\t\t{\r\n\t\t\t\tfor (let i=0, l=people.length; i<l; ++i )\r\n\t\t\t\t{\r\n\t\t\t\t\tconst person = getPerson(i)\r\n\t\t\t\t\t// yaw, pitch, lipPercentage, eyeDirection\r\n\t\t\t\t\tconst stuff = person.sing()\r\n\t\t\t\t\tif (i===0)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// stuff.eyeDirection\r\n\t\t\t\t\t\t// use person 1's eyes to control other stuff too?\r\n\t\t\t\t\t\t// in this case the direction of the pan in disco mode\r\n\t\t\t\t\t\tcameraPan.x = stuff.eyeDirection\r\n\t\t\t\t\t\tcameraPan.y = stuff.pitch\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\r\n\t\t\t// play some accompanyment music!\r\n\t\t\tif (ui.backingTrack && bar%2 === 0 )\r\n\t\t\t{\r\n\t\t\t\tconst kick = playNextPart( patterns.kick, kit.kick )\r\n\t\t\t\tconst snare = playNextPart( patterns.snare, kit.snare )\r\n\t\t\t\tconst hat = playNextPart( patterns.hat, kit.hat )\r\n\r\n\t\t\t\tconsole.error(\"backing|\", {kick, snare, hat })\r\n\t\t\t\t// todo: also MIDI beats on channel 16?\r\n\t\t\t}\r\n\r\n\t\t\tif (playing)\r\n\t\t\t{\r\n\t\t\t\t// timePassed\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}, timePerBar() )\r\n\r\n\t} )\r\n\t// camera loading just pauses the update mechanism\r\n}\r\n\r\n// \r\nsetFeedback(\"Initialising...<br> Please wait\")\r\n\r\n\r\n// Progressive Web Application ---------------------------------\r\nlet installation = null\r\nlet loadMeter = 0\r\n\r\n// allow for debug via css\r\nbody.classList.toggle(\"debug\", ui.debug )\r\n\r\nconst onLoaded = async () => {\r\n\r\n\tbody.classList.toggle(\"loaded\", true)\r\n\tbody.classList.remove(\"loading\")\r\n\t\t\r\n\t// at any point we can now trigger the installation\r\n\tif (installation)\r\n\t{\r\n\t\ttry{\r\n\t\t\tconst destination = document.getElementById(\"shared-controls\")\r\n\t\t\tconst needsInstall = await installation( destination )\t\t\r\n\t\t\tsetToast( needsInstall ? \"You can install this as an app! Click install below\" : \"\" )\r\n\t\t\r\n\t\t}catch(error){\r\n\t\t\tconsole.error(\"Install/Update issue\", error)\r\n\t\t}\r\n\t\t\r\n\t}else{\r\n\t\tconsole.log(\"Loaded Webpage\", VERSION)\r\n\t}\r\n\r\n\ttry{\r\n\t\t// load the share menu :)\r\n\t\tconst sharer = await import('share-menu')\r\n\t}catch(error){\r\n\t\t// disable the share menu...\r\n\t\tdocument.getElementById(\"share\").style.display = \"none\"\r\n\t}\r\n\t\r\n\t// change this depending on whether a face is detected\r\n\tspeak(\"Open your mouth to begin!\")\r\n\r\n\t// Show hackers message\r\n\tif (ui.debug)\r\n\t{\r\n\t\t// console.log(\"Loaded App\", {VERSION, needsInstall, needsUpdate })\r\n\t\tconsole.log(`Loaded App ${VERSION} ${needsInstall ? \"Installable\" : needsUpdate ? \"Update Available\" : \"\"}` )\t\r\n\t}\r\n}\r\n\r\n\r\n// loop until loaded...\r\nconst loadingLoop = async () => {\r\n\r\n\tif (isLoading)\r\n\t{ \r\n\t\t// console.log(\"loading\",loadMeter*100)\r\n\t\trequestAnimationFrame( loadingLoop ) \r\n\t}else{\r\n\r\n\t\tif (ultimateFailure)\r\n\t\t{\r\n\t\t\tbody.classList.add(\"failure\")\r\n\t\t\tshowReloadButton()\r\n\r\n\t\t}else{\r\n\t\t\tonLoaded()\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// import {installer} from './install'\r\n// import {update}  from './update.js'\r\n// const test = async ()=>{\r\n// \tconst {installer} = await import('./install.js')\r\n// \tconst {update} = await import('./update.js')\r\n// \tconst destination = document.getElementById(\"shared-controls\")\r\n// \tconst install = await installer(true)\r\n// \tconst needsInstall = await install( destination )\t\t\r\n// \tconst needsUpdate = await update()\r\n// }\r\n// test()\r\n\r\n// progressive web app variant\r\nconst pwa = async() => {\r\n\ttry{\r\n\t\t// const {installer} = await import('./install.js')\r\n\t\tinstallation = await installer(true)\r\n\t\r\n\t\tconst {updateApp} = await import('./update.js')\r\n\t\t\r\n\t\t// may as well disrupt the load if an update is available!\r\n\t\t// as we reload the thing anyways!\r\n\t\tconst {updater, updateAvailable} = await updateApp()\r\n\r\n\t\tif (updateAvailable)\r\n\t\t{\r\n\t\t\tshowUpdateButton(updater)\r\n\t\t\tsetToast(\"An Update is available! Press update to install it\" )\r\n\t\t}\r\n\r\n\t\tconsole.log(\"installer\", { installer, installation})\r\n\t\r\n\t}catch(error){\r\n\t\tconsole.error(\"PWA\", error)\r\n\t}\r\n}\r\n\r\n// ---------------------------------------------------------\r\n\r\n// load settings from store here too?\r\n// set up some extra options from query strings\r\n// any custom overrides (shouldn't be needed : use query strings)\r\nsetup( Object.assign( {}, SETTINGS, {} ), progress => {\r\n\t\r\n\t//console.log(\"Loading\", progress, progressBar )\r\n\tprogressBar.setAttribute(\"value\",progress)\r\n\t// ease this?\r\n\tloadMeter = progress\r\n})\r\n\r\nsetFeedback(\"Loading... Please wait<br>This can take <strong>some</strong> time!\")\r\npwa()\r\n\r\nloadingLoop()\r\n\r\n\r\n// Exit\r\nwindow.onbeforeunload = ()=>{\r\n\t// save ui settings in cookie too?\r\n\ttrackExit()\r\n\t//store.setItem(person.name, {instrument})\r\n\tsetToast(\"bye bye!\")\r\n}\r\n\r\n// document.addEventListener( \"contextmenu\", (e) => {\r\n//     console.log(e)\r\n// })\r\n\r\n// if this is a desktop?\r\nwindow.oncontextmenu = () => {\r\n\t// reset instructions\r\n\tcounter = 0\r\n\t// restart counter?\r\n    //return false     // cancel default menu\r\n}\r\n// ---- Other forms of input -----\r\n\r\n// now wire up the bits...\r\n// canvas.addEventListener('mousedown',loadRandomInstrument )\r\n// video.addEventListener('mousedown', loadRandomInstrument )\r\n\r\nwindow.addEventListener('keydown', async (event)=>{\r\n\r\n\tswitch(event.key)\r\n\t{\r\n\t\tcase 'CapsLock':\r\n\t\t\tui.debug = !ui.debug\r\n\t\t\tpeople.forEach( person => person.debug = ui.debug )\r\n\t\t\tsetToast(`DEBUG : ${ui.debug}`)\r\n\t\t\tspeak( ui.debug ? \"secret mode unlocked\" : \"disabling developer mode\", true)\r\n\t\t\tbreak\r\n\r\n\t\tcase 'Space':\r\n\t\t\t// read out last bit of help?\r\n\t\t\tspeak(document.getElementById('toast').innerText, true)\r\n\t\t\tloadRandomInstrument() \r\n\t\t\tbreak\r\n\r\n\t\tcase 'ArrowLeft':\r\n\t\t\tpreviousInstrument()\r\n\t\t\tbreak\r\n\r\n\t\tcase 'ArrowRight':\r\n\t\t\tnextInstrument() \r\n\t\t\tbreak\r\n\r\n\t\t// change amount of bars\r\n\t\tcase 'ArrowUp':\r\n\t\t\tlet b = getBars() + 1\r\n\t\t\tlet bars = setBars( b )\r\n\t\t\tlet t = setTimeBetween( timePerBar() )\r\n\t\r\n\t\t\tconsole.error(\"bars---\",bars,  b, t )\r\n\t\t\tsetToast(`Bars : ${bars} / BPM : ${getBPM()}`)\r\n\t\t\tbreak\r\n\r\n\t\tcase 'ArrowDown':\r\n\t\t\tlet ub = getBars() - 1\r\n\t\t\tlet ubars = setBars( ub )\r\n\t\t\tlet ut = setTimeBetween( timePerBar() )\r\n\t\r\n\t\t\tconsole.error(\"bars---\", ubars, ub, ut )\r\n\t\t\tsetToast( `Bars ${ubars} / BPM : ${getBPM()}` )\r\n\t\t\tbreak\r\n\r\n\t\tcase ',':\r\n\t\t\tsetNodeCount(-1)\r\n\t\t\tbreak\r\n\r\n\t\tcase '.':\r\n\t\t\tsetNodeCount(1)\r\n\t\t\tbreak\r\n\r\n\t\tcase 'w':\r\n\t\t\tkit.cowbell()\r\n\t\t\tbreak\r\n\r\n\t\tcase 'a':\r\n\t\t\tkit.kick()\r\n\t\t\tbreak\r\n\r\n\t\tcase 's':\r\n\t\t\tkit.snare()\r\n\t\t\tbreak\r\n\r\n\t\tcase 'd':\r\n\t\t\tkit.hat()\r\n\t\t\tbreak\r\n\r\n\t\tcase 'q':\r\n\t\t\tkit.clack()\r\n\t\t\tbreak\r\n\t\r\n\t\tcase 'b':\r\n\t\t\tui.backingTrack = !ui.backingTrack\r\n\t\t\tsetToast( ui.backingTrack ? \"Backing track starting\" : \"Ending Backing Track\" )\r\n\t\t\tbreak\r\n\r\n\t\tcase 'c':\r\n\t\t\tui.clear = !ui.clear\r\n\t\t\tbreak\r\n\r\n\t\tcase 't':\r\n\t\t\tui.text = !ui.text\r\n\t\t\tbreak\r\n\r\n\t\tcase 'r':\r\n\t\t\tif (!isRecording())\r\n\t\t\t{\r\n\t\t\t\tsetToast(\"Recording START\")\r\n\t\t\t\tconsole.error(\"Recording START\", audio)\r\n\t\t\t\trecorder = await startRecording(audio)\r\n\t\t\t\tconsole.error(\"Recording...\", recorder)\r\n\t\t\t\r\n\t\t\t}else{\r\n\t\t\t\tconsole.error(\"Recording END\", recorder)\r\n\t\t\t\tsetToast( `Recording Ended - now encoding` )\r\n\t\t\t\tstopRecording().then(recording=>{\r\n\r\n\t\t\t\t\tconst mp3 = encodeRecording(recording, 'audio/mp3;')\r\n\t\t\t\t\t// Creating audio url with reference  \r\n\t\t\t\t\t// of created blob named 'audioData' \r\n\t\t\t\t\tconst audioSrc = window.URL.createObjectURL(mp3)\r\n\t\t\t\t\tconsole.error(\"Recording END\", {recording, audioSrc, mp3})\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tbreak\r\n\r\n\t\t// Hide video\r\n\t\tcase 'v':\r\n\t\t\t// FIXME: Alsoenable sync?\r\n\t\t\tvideo.style.visibility = video.style.visibility === \"hidden\" ? \"visible\" : \"hidden\"\r\n\t\t\tbreak\r\n\r\n\t\tcase 'm':\r\n\t\t\tui.metronome = !ui.metronome\r\n\t\t\tsetToast( ui.metronome ? `Quantised enabled` : `Quantise disabled` )\r\n\t\t\tbreak\r\n\r\n\t\tcase '?':\r\n\t\t\t// toggle speech\r\n\t\t\tui.speak = !ui.speak\r\n\t\t\tsetToast( ui.speak ? `Reading out instructions` : `Staying quiet` )\r\n\t\t\tbreak\r\n\r\n\t\t// don't hijack tab you numpty!\r\n\t\t// FILTER\r\n\t\tcase 'Tab':\r\n\t\t\tbreak\r\n\r\n\t\tdefault:\r\n\t\t\tloadRandomInstrument()\r\n\t\t\tspeak(\"Loading random instruments\",true)\r\n\t}\r\n\r\n\t// we run this when we want to \r\n\taddToHistory(ui, event.key)\r\n\tconsole.log(\"key\", ui, event)\r\n})\r\n\r\n// URL has been updated internally\r\nwindow.addEventListener('popstate', (event) => {\r\n\t//console.log(\"location: \" + document.location + \", state: \" + JSON.stringify(event.state))\r\n})\r\n\r\n// window.addEventListener('wheel' , event => {\r\n\t\r\n// \treturn\r\n\r\n// \tlet d = event.detail\r\n// \tconst w =  event.deltaY || event.wheelDelta\r\n// \tlet n = 225\r\n// \tlet n1 = n-1\r\n// \tlet f\r\n\r\n// \t// Normalize delta\r\n// \td = d ? w && (f = w/d) ? d/f : -d/1.35 : w/120\r\n// \t// Quadratic scale if |d| > 1\r\n// \td = d < 1 ? d < -1 ? (-Math.pow(d, 2) - n1) / n : d : (Math.pow(d, 2) + n1) / n\r\n// \t// Delta *should* not be greater than 2...\r\n// \tconst wheel = Math.min(Math.max(d / 2, -1), 1) * 0.1\r\n// \tconst volume = getVolume()\r\n// \t//const result = setMasterVolume(volume + wheel)\r\n\r\n// \tconsole.log(\"mouse wheel\",{ wheel, volume, result}, event)\t\r\n// })\r\n\r\n// window.addEventListener('deviceorientation' , event => {\r\n// \t//console.log(\"device orientation\", event)\r\n// })","\r\nimport { setFeedback, setToast, addTooltip } from './ui'\r\n\r\nimport { VERSION, DATE } from './version'\r\n\r\nimport manifestPath from \"url:./manifest.webmanifest\"\r\n// let manifestPath = \"./manifest.webmanifest\"\r\n\t\r\nconst body = document.documentElement\r\n\r\n// const shareMenu = document.getElementById('share-menu')\r\n// check for beforeinstallprompt support\r\nexport const isSupportingBrowser = window.hasOwnProperty(\"BeforeInstallPromptEvent\")\r\n\r\nlet deferredPrompt\r\n\r\n\t\t   \r\nlet installed = false\r\nlet hasPrompt = false\r\nlet openModal = false\r\n\r\nexport const installer = async (defer=false) => {\r\n\r\n\tlet manifestData\r\n\tlet relatedApps = []\r\n\r\n    // handle iOS specifically\r\n    // this includes the regular iPad\r\n    // and the iPad pro\r\n    // but not macOS\r\n    const isIOS =\r\n      navigator.userAgent.includes(\"iPhone\") || navigator.userAgent.includes(\"iPad\") ||\r\n      (navigator.userAgent.includes(\"Macintosh\") && navigator.maxTouchPoints && navigator.maxTouchPoints > 2)\r\n\r\n\tconst cancelInstall = () => new Promise((resolve, reject) => {\r\n\t\t// close the modal\r\n\t\topenModal = false\r\n\r\n\t//   if (this.hasAttribute(\"openmodal\")) {\r\n\t// \tthis.removeAttribute(\"openmodal\")\r\n\t//   }\r\n\r\n\t//   let event = new CustomEvent(\"hide\")\r\n\t//   this.dispatchEvent(event)\r\n\r\n\t\tresolve()\r\n\t})\r\n\t\r\n\r\n    document.addEventListener(\"keyup\", (event) => {\r\n      if (event.key === \"Escape\") {\r\n        cancelInstall()\r\n      }\r\n\t})\r\n\t\r\n\tconst getInstalledStatus = () => {\r\n\t\tif (navigator.standalone) {\r\n\t\t  return navigator.standalone\r\n\t\t} else if (matchMedia(\"(display-mode: standalone)\").matches) {\r\n\t\t  return true\r\n\t\t} else {\r\n\t\t  return false\r\n\t\t}\r\n\t}\r\n\r\n\tconst shouldShowInstall = () => {\r\n\t\tconst eligibleUser = isSupportingBrowser &&\r\n\t\trelatedApps.length < 1 &&\r\n\t\t(hasPrompt || isIOS)\r\n\t\r\n\t\treturn eligibleUser\r\n\t}\r\n\r\n\t// Check that the manifest has our 3 required properties\r\n\t// If not console an error to the user and return\r\n\tconst checkManifest = (manifestToCheck) => {\r\n\t  if (!manifestToCheck.icons || !manifestToCheck.icons[0]) {\r\n\t\tconsole.error(\"Your web manifest must have atleast one icon listed\");\r\n\t\treturn\r\n\t  }\r\n  \r\n\t  if (!manifestToCheck.name) {\r\n\t\tconsole.error(\"Your web manifest must have a name listed\");\r\n\t\treturn\r\n\t  }\r\n  \r\n\t  if (!manifestToCheck.description) {\r\n\t\tconsole.error(\"Your web manifest must have a description listed\");\r\n\t\treturn\r\n\t  }\r\n\t}\r\n\r\n\tconst getManifestData = async () => {\r\n\t\ttry {\r\n\t\t  const response = await fetch(manifestPath)\r\n\t\t  const data = await response.json()\r\n\t\r\n\t\t  manifestData = data\r\n\t\r\n\t\t  if (data) \r\n\t\t  {\r\n\t\t\t// any point if it only logs and still continues?\r\n\t\t\tcheckManifest(data)\r\n\t\t\treturn data\r\n\t\t  }\r\n\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(\"Manifest could not be loaded\",err)\r\n\t\t  \treturn null\r\n\t\t}\r\n\t  }\r\n\t\r\n\t  \r\n\tconst firstUpdated = async () => {\r\n\t\tif (manifestPath) \r\n\t\t{\r\n\t\t  try {\r\n\t\t\tawait getManifestData()\r\n\t\t  } catch (err) {\r\n\t\t\tconsole.error(\"Error getting manifest, check that you have a valid web manifest\")\r\n\t\t  }\r\n\t\t}\r\n\t\r\n\t\tif (\"getInstalledRelatedApps\" in navigator) {\r\n\t\t\trelatedApps = await navigator.getInstalledRelatedApps()\r\n\t\t}\r\n\t}\r\n\r\n\t// This is created from the manifest\r\n\tconst createOverlayMarkup = () =>\r\n\t`<dialog open>\r\n\t\t<!-- background needs to cancel install too? -->\r\n\t\t<header id=\"logoContainer\">\r\n\t\t\t<img src=\"${ manifestData.icons[0].src }\" alt=\"App Logo\"/>\r\n\r\n\t\t\t<div id=\"installTitle\">\r\n\t\t\t\t<h1>${ manifestData.short_name || manifestData.name}</h1>\r\n\t\t\t\t<p id=\"desc\">${explainer}</p>\r\n\t\t\t</div>\r\n\t\t</header>\r\n\r\n\t\t<button id=\"closeButton\" click=\"\" aria-label=\"Close\">\r\n\t\t\t<svg width=\"23\" height=\"22\" viewBox=\"0 0 23 22\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n\t\t\t\t<path opacity=\"0.33\" fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M1.11932 0.357981C1.59693 -0.119327 2.37129 -0.119327 2.8489 0.357981L11.7681 9.27152L20.6873 0.357981C21.165 -0.119327 21.9393 -0.119327 22.4169 0.357981C22.8945 0.835288 22.8945 1.60916 22.4169 2.08646L13.4977 11L22.4169 19.9135C22.8945 20.3908 22.8945 21.1647 22.4169 21.642C21.9393 22.1193 21.165 22.1193 20.6873 21.642L11.7681 12.7285L2.8489 21.642C2.37129 22.1193 1.59693 22.1193 1.11932 21.642C0.641705 21.1647 0.641705 20.3908 1.11932 19.9135L10.0385 11L1.11932 2.08646C0.641705 1.60916 0.641705 0.835288 1.11932 0.357981Z\" fill=\"#60656D\"/>\r\n\t\t\t</svg>\r\n\t\t</button>\r\n\r\n\r\n\t\t<div id=\"contentContainer\">\r\n\r\n\t\t\t<div id=\"featuresScreenDiv\">\r\n\r\n\t\t\t${ manifestData.features ? \r\n\t\t\t\t`<div id=\"keyFeatures\">\r\n\t\t\t\t<h3>Features</h3>\r\n\t\t\t\t<ul>\r\n\t\t\t\t${\r\n\t\t\t\t\tmanifestData.features\r\n\t\t\t\t\t? manifestDatafeatures.map((feature) => ` <li>${feature}</li> ` )\r\n\t\t\t\t\t: null\r\n\t\t\t\t}\r\n\t\t\t\t</ul>\r\n\t\t\t</div>\r\n\t\t\t</div>`\r\n\t\t\t\t: null\r\n\t\t\t}\r\n\r\n\t\t\t${manifestData.screenshots\r\n\t\t\t\t? html`\r\n\t\t\t\t\t<div id=\"screenshotsContainer\">\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\taria-label=\"previous image\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\tviewBox=\"0 0 512 512\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\td=\"M401.4 224h-214l83-79.4c11.9-12.5 11.9-32.7 0-45.2s-31.2-12.5-43.2 0L89 233.4c-6 5.8-9 13.7-9 22.4v.4c0 8.7 3 16.6 9 22.4l138.1 134c12 12.5 31.3 12.5 43.2 0 11.9-12.5 11.9-32.7 0-45.2l-83-79.4h214c16.9 0 30.6-14.3 30.6-32 .1-18-13.6-32-30.5-32z\"\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t</button>\r\n\r\n\t\t\t\t\t\t<section id=\"screenshots\">\r\n\t\t\t\t\t\t${manifestData.screenshots.map((screen) => {\r\n\t\t\t\t\t\t\treturn html`\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<img alt=\"App Screenshot\" src=\"${screen.src}\" />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t`;\r\n\t\t\t\t\t\t})}\r\n\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\taria-label=\"next image\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\tviewBox=\"0 0 512 512\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\td=\"M284.9 412.6l138.1-134c6-5.8 9-13.7 9-22.4v-.4c0-8.7-3-16.6-9-22.4l-138.1-134c-12-12.5-31.3-12.5-43.2 0-11.9 12.5-11.9 32.7 0 45.2l83 79.4h-214c-17 0-30.7 14.3-30.7 32 0 18 13.7 32 30.6 32h214l-83 79.4c-11.9 12.5-11.9 32.7 0 45.2 12 12.5 31.3 12.5 43.3 0z\"\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t`\r\n\t\t\t\t: null\r\n\t\t\t}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div id=\"descriptionWrapper\">\r\n\t\t\t\t<h3>${manifestData.descriptionheader}</h3>\r\n\t\t\t\t<p id=\"manifest-description\">${manifestData.description}</p>\r\n\t\t\t</div>\r\n\t\t\t\r\n\t\t\t</div>\r\n\t\t\r\n\t\t<button id=\"openButton\" class=\"install-app\">Install InterFACE Version ${VERSION}</button>\r\n\t\t<button class=\"cancel-install\">Cancel</button>\r\n\r\n\t\t<p id=\"iosText\">${iosinstallinfotext}</p> \r\n\r\n\t</dialog>\r\n\t`\r\n\r\n\t\r\n\tconst install = async () => new Promise( async (resolve,reject)=>{\r\n\r\n\t\tif (deferredPrompt) \r\n\t\t{\r\n\t\t\tdeferredPrompt.prompt()\r\n\t\t\r\n\t\t\t//   let event = new CustomEvent(\"show\")\r\n\t\t\t//   this.dispatchEvent(event)\r\n\t\t\tawait cancelInstall()\r\n\r\n\t\t\t// brute force hide the button?\r\n\t\t\t// set installed to true because we dont\r\n\t\t\t// want to show the install button to\r\n\t\t\t// a user who chose not to install?\r\n\t\t\t\t\r\n\t\t \tconst choiceResult = await deferredPrompt.userChoice\r\n\t\r\n\t\t\tif (choiceResult.outcome === \"accepted\") \r\n\t\t\t{\r\n\t\t\t\tconsole.log(\"Your PWA has been installed\")\r\n\t\t\r\n\t\t\t\tinstalled = true\r\n\t\r\n\t\t\t\tresolve(true)\r\n\r\n\t\t  \t} else {\r\n\r\n\t\t\t\tconsole.log(\"User chose to not install\")\r\n\t\t\r\n\t\t\t\tinstalled = false\r\n\t\t\t\t\r\n\t\t\t\tresolve(false);\r\n\t\t  \t}\r\n\r\n\t\t} else {\r\n\t\t\t  // handle else case\r\n\t\t\t  reject(\"no prompt cached\")\r\n\t\t}\r\n\t})\r\n\r\n\tconst begin = async (destination) => {\r\n\r\n\t\tconst showInstaller = shouldShowInstall()\r\n\t\tif (hasPrompt && (\"standalone\" in navigator && navigator.standalone === false) || (showInstaller && installed === false))\r\n\t\t{\r\n\t\t\t// we need to show the installer!\t// const test = await getManifestData()\r\n\t\t\tconst test = await firstUpdated()\r\n\t\t\t\r\n\t\t\tbody.classList.add(getInstalledStatus() ? \"installed\" : \"not-installed\")\r\n\r\n\t\t\t// show install button or update button???\r\n\t\t\t// reveal update button?\r\n\t\t\tconst button = document.createElement('button')\r\n\t\t\tbutton.classList.add(\"install-app\")\r\n\t\t\tbutton.setAttribute(\"aria-label\",`Click to install ${manifestData.short_name} V-${VERSION.replaceAll(\".\",\"-\")}<br>Date:${(new Date(DATE)).getDate()}`  )\r\n\t\t\tbutton.style.setProperty(\"--logo\",`url(${ manifestData.icons[0].src })`)\r\n\r\n\t\t\tbutton.innerHTML = \"Install App\"\r\n\t\t\t\r\n\t\t\taddTooltip(button)\r\n\r\n\t\t\tsetToast(\"This App can be installed!<br> Click the orange button on the left\")\r\n\r\n\t\t\t// on button press...\r\n\t\t\tbutton.addEventListener('click', async ()=>{\r\n\t\t\t\r\n\t\t\t\t// show overlay with install button or just install directly?\r\n\t\t\t\tsetFeedback(\"Installing\",0)\r\n\t\t\t\ttry{\r\n\t\t\t\t\t// installed\r\n\t\t\t\t\tconst success = await install()\r\n\t\t\t\t\tsetToast( success ? \"The App was installed\" : \"Maybe some other time\" )\r\n\t\t\t\t\tif (!success)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// show buton?\r\n\t\t\t\t\t\t//document.querySelector(\".install-app\").style.display = \"none\"\r\n\t\t\t\t\t\tbutton.classList.add(\"later\")\r\n\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t// hide button\r\n\t\t\t\t\t\tdocument.querySelector(\".install-app\").style.display = \"none\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}catch(error){\r\n\t\t\t\t\tsetToast(\"The App was not installed\")\r\n\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t} )\r\n\r\n\t\t\tdestination = destination || body\r\n    \r\n\t\t\tdestination.appendChild(button)\r\n\r\n\t\t\t// console.log(\"Application is currently \", getInstalledStatus() ? \"installed\" : \"not installed\" )\r\n\t\t\t// console.log({manifestdata: manifestData})\r\n\t\t\r\n\t\t\treturn true\r\n\r\n\t\t}else{\r\n\r\n\t\t\tbody.classList.add( installed ? \"installed\" : \"not-installed\" )\r\n\r\n\t\t\t// we are already showing?\r\n\t\t\t// console.log(\"Application not installable\", {showInstaller, installed} , getInstalledStatus() ? \"installed\" : \"not-installed\" )\r\n\t\t\t// console.error( { isSupportingBrowser, relatedApps, hasPrompt, isIOS} )\r\n\t\t\treturn false\r\n\t\t}\r\n\t}\r\n\t  \r\n\t// hijack an install event\r\n\tif (!deferredPrompt && !hasPrompt)\r\n\t{\r\n\t\twindow.addEventListener(\"beforeinstallprompt\", event => {\r\n\t\t\t\r\n\t\t\tdeferredPrompt = event\r\n\t\t\thasPrompt = true\r\n\t\t\tevent.preventDefault() \r\n\r\n\t\t\tif (!defer && !isIOS)\r\n\t\t\t{\r\n\t\t\t\tbegin()\r\n\t\t\t}\r\n\r\n\t\t}, {once:true})\t\r\n\t}\r\n  \r\n\r\n\tif (!defer && isIOS)\r\n\t{\r\n\t\twindow.addEventListener(\"load\", async (event) => {\r\n\t\t\t\r\n\t\t\tbegin()\r\n\r\n\t\t}, {once:true})\t\t\r\n\t}\r\n\r\n\treturn begin\r\n}\r\n\r\n\r\nwindow.addEventListener(\"beforeinstallprompt\", event => {\r\n\t\t\r\n\tdeferredPrompt = event\r\n\thasPrompt = true\r\n\tevent.preventDefault() \r\n\r\n}, {once:true})\r\n /*\r\n\r\n*/\r\n//   render() {\r\n//     return html`\r\n//       ${(\"standalone\" in navigator &&\r\n//         (navigator as any).standalone === false) ||\r\n//       (this.usecustom !== true &&\r\n//         this.shouldShowInstall() &&\r\n//         this.installed === false)\r\n//         ? html`<button\r\n//             part=\"openButton\"\r\n//             id=\"openButton\"\r\n//             @click=\"${() => this.openPrompt()}\"\r\n//           >\r\n//             <slot>\r\n//               ${this.installbuttontext}\r\n//             </slot>\r\n//           </button>`\r\n//         : null}\r\n//       ${this.openmodal === true\r\n//         ? html`\r\n//           <div id=\"installModalWrapper\">\r\n//           ${\r\n//             this.openmodal\r\n//               ? html`<div\r\n//                   id=\"background\"\r\n//                   @click=\"${() => this.cancel()}\"\r\n//                 ></div>`\r\n//               : null\r\n//           }\r\n//           <div id=\"installModal\" part=\"installModal\">\r\n//           <div id=\"headerContainer\">\r\n//           <div id=\"logoContainer\">\r\n//             <img src=\"${\r\n//               this.iconpath ? this.iconpath : this.manifestdata.icons[0].src\r\n//             }\" alt=\"App Logo\"/>\r\n\r\n//             <div id=\"installTitle\">\r\n//               <h1>${this.manifestdata.short_name || this.manifestdata.name}</h1>\r\n\r\n//               <p id=\"desc\">\r\n//                 ${this.explainer}\r\n//               </p>\r\n//             </div>\r\n//           </div>\r\n\r\n//           <button id=\"closeButton\" @click=\"${() =>\r\n//             this.cancel()}\" aria-label=\"Close\">\r\n//             <svg width=\"23\" height=\"22\" viewBox=\"0 0 23 22\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n//               <path opacity=\"0.33\" fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M1.11932 0.357981C1.59693 -0.119327 2.37129 -0.119327 2.8489 0.357981L11.7681 9.27152L20.6873 0.357981C21.165 -0.119327 21.9393 -0.119327 22.4169 0.357981C22.8945 0.835288 22.8945 1.60916 22.4169 2.08646L13.4977 11L22.4169 19.9135C22.8945 20.3908 22.8945 21.1647 22.4169 21.642C21.9393 22.1193 21.165 22.1193 20.6873 21.642L11.7681 12.7285L2.8489 21.642C2.37129 22.1193 1.59693 22.1193 1.11932 21.642C0.641705 21.1647 0.641705 20.3908 1.11932 19.9135L10.0385 11L1.11932 2.08646C0.641705 1.60916 0.641705 0.835288 1.11932 0.357981Z\" fill=\"#60656D\"/>\r\n//             </svg>\r\n//           </button>\r\n//         </div>\r\n\r\n//         <div id=\"contentContainer\">\r\n\r\n//         <div id=\"featuresScreenDiv\">\r\n\r\n//           ${\r\n//             this.manifestdata.features\r\n//               ? html`<div id=\"keyFeatures\">\r\n//             <h3>${this.featuresheader}</h3>\r\n//             <ul>\r\n//               ${\r\n//                 this.manifestdata.features\r\n//                   ? this.manifestdata.features.map((feature) => {\r\n//                       return html` <li>${feature}</li> `;\r\n//                     })\r\n//                   : null\r\n//               }\r\n//             </ul>\r\n//           </div>\r\n//           </div>`\r\n//               : null\r\n//           }\r\n\r\n//           ${\r\n//             this.manifestdata.screenshots\r\n//               ? html`\r\n//                   <div id=\"screenshotsContainer\">\r\n//                     <button\r\n//                       @click=\"${() => this.scrollToLeft()}\"\r\n//                       aria-label=\"previous image\"\r\n//                     >\r\n//                       <svg\r\n//                         xmlns=\"http://www.w3.org/2000/svg\"\r\n//                         viewBox=\"0 0 512 512\"\r\n//                       >\r\n//                         <path\r\n//                           d=\"M401.4 224h-214l83-79.4c11.9-12.5 11.9-32.7 0-45.2s-31.2-12.5-43.2 0L89 233.4c-6 5.8-9 13.7-9 22.4v.4c0 8.7 3 16.6 9 22.4l138.1 134c12 12.5 31.3 12.5 43.2 0 11.9-12.5 11.9-32.7 0-45.2l-83-79.4h214c16.9 0 30.6-14.3 30.6-32 .1-18-13.6-32-30.5-32z\"\r\n//                         />\r\n//                       </svg>\r\n//                     </button>\r\n//                     <section id=\"screenshots\">\r\n//                       ${this.manifestdata.screenshots.map((screen) => {\r\n//                         return html`\r\n//                           <div>\r\n//                             <img alt=\"App Screenshot\" src=\"${screen.src}\" />\r\n//                           </div>\r\n//                         `;\r\n//                       })}\r\n//                     </section>\r\n//                     <button\r\n//                       @click=\"${() => this.scrollToRight()}\"\r\n//                       aria-label=\"next image\"\r\n//                     >\r\n//                       <svg\r\n//                         xmlns=\"http://www.w3.org/2000/svg\"\r\n//                         viewBox=\"0 0 512 512\"\r\n//                       >\r\n//                         <path\r\n//                           d=\"M284.9 412.6l138.1-134c6-5.8 9-13.7 9-22.4v-.4c0-8.7-3-16.6-9-22.4l-138.1-134c-12-12.5-31.3-12.5-43.2 0-11.9 12.5-11.9 32.7 0 45.2l83 79.4h-214c-17 0-30.7 14.3-30.7 32 0 18 13.7 32 30.6 32h214l-83 79.4c-11.9 12.5-11.9 32.7 0 45.2 12 12.5 31.3 12.5 43.3 0z\"\r\n//                         />\r\n//                       </svg>\r\n//                     </button>\r\n//                   </div>\r\n//                 `\r\n//               : null\r\n//           }\r\n//           </div>\r\n\r\n//           <div id=\"descriptionWrapper\">\r\n//             <h3>${this.descriptionheader}</h3>\r\n//             <p id=\"manifest-description\">${this.manifestdata.description}</p>\r\n//           </div>\r\n//         </div>\r\n\r\n//         ${\r\n//           !this.isIOS\r\n//             ? html`<div id=\"buttonsContainer\">\r\n//           ${\r\n//             this.deferredprompt\r\n//               ? html`<button\r\n//                   id=\"installButton\"\r\n//                   @click=\"${() => this.install()}\"\r\n//                 >\r\n//                   ${this.installbuttontext} ${this.manifestdata.short_name}\r\n//                 </button>`\r\n//               : html`<button\r\n//                   @click=\"${() => this.cancel()}\"\r\n//                   id=\"installCancelButton\"\r\n//                 >\r\n//                   ${this.cancelbuttontext}\r\n//                 </button>`\r\n//           }\r\n//         </div>\r\n//           </div>`\r\n//             : html`<p id=\"iosText\">${this.iosinstallinfotext}</p>`\r\n//         }\r\n//         `\r\n//         : null}\r\n//     `;\r\n//   }\r\n// }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// Allow app to be installed\r\n// FIXME: Lazy load this whilst camera searching...\r\n\r\n// @customElement(\"pwa-install\")\r\n// export class pwainstall extends LitElement {\r\n//   @property({ type: String }) manifestpath: string = \"manifest.json\";\r\n//   @property({ type: String }) iconpath: string;\r\n//   @property({ type: Object }) manifestdata: ManifestData;\r\n\r\n//   @property({ type: Boolean }) openmodal: boolean = false;\r\n//   @property({ type: Boolean }) showopen: boolean;\r\n//   @property({ type: Boolean }) isSupportingBrowser: boolean;\r\n//   @property({ type: Boolean }) isIOS: boolean;\r\n//   @property({ type: Boolean }) installed: boolean;\r\n//   @property({ type: Boolean }) hasprompt: boolean = false;\r\n//   @property({ type: Boolean }) usecustom: boolean;\r\n//   @property({ type: Array }) relatedApps: any[] = [];\r\n\r\n//   @property({ type: String }) explainer: string =\r\n//     \"This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. \";\r\n//   @property({ type: String }) featuresheader: string = \"Key Features\";\r\n//   @property({ type: String }) descriptionheader: string = \"Description\";\r\n//   @property({ type: String }) installbuttontext: string = \"Install\";\r\n//   @property({ type: String }) cancelbuttontext: string = \"Cancel\";\r\n//   @property({ type: String }) iosinstallinfotext: string =\r\n//     \"Tap the share button and then 'Add to Homescreen'\";\r\n\r\n//   @property() deferredprompt: any;\r\n\r\n//   static get styles() {\r\n//     return css`\r\n//       :host {\r\n//         --install-focus-color: #919c9c;\r\n//         --install-button-color: #0078d4;\r\n//         --modal-z-index: 9999;\r\n//         --background-z-index: 9998;\r\n//         --modal-background-color: white;\r\n//       }\r\n\r\n//       button {\r\n//         outline: none;\r\n//       }\r\n\r\n//       #installModalWrapper {\r\n//         height: 100vh;\r\n//         width: 100vw;\r\n//         overflow: auto;\r\n//         position: fixed;\r\n//         bottom: 0;\r\n//         top: 0;\r\n//         left: 0;\r\n//         right: 0;\r\n//         z-index: var(--modal-z-index);\r\n\r\n//         display: flex;\r\n//         justify-content: center;\r\n//         align-items: center;\r\n//       }\r\n\r\n//       #descriptionWrapper {\r\n//         margin-bottom: 3em;\r\n//       }\r\n\r\n//       #installModal {\r\n//         position: absolute;\r\n//         background: var(--modal-background-color);\r\n//         font-family: sans-serif;\r\n//         box-shadow: 0px 25px 26px rgba(32, 36, 50, 0.25),\r\n//           0px 5px 9px rgba(51, 58, 83, 0.53);\r\n//         border-radius: 10px;\r\n//         display: flex;\r\n//         flex-direction: column;\r\n//         padding: 0;\r\n\r\n//         animation-name: opened;\r\n//         animation-duration: 150ms;\r\n\r\n//         z-index: var(--modal-z-index);\r\n\r\n//         max-width: 56em;\r\n//       }\r\n\r\n//       @keyframes opened {\r\n//         from {\r\n//           transform: scale(0.8, 0.8);\r\n//           opacity: 0.4;\r\n//         }\r\n//         to {\r\n//           transform: scale(1, 1);\r\n//           opacity: 1;\r\n//         }\r\n//       }\r\n\r\n//       @keyframes mobile {\r\n//         from {\r\n//           opacity: 0.6;\r\n//         }\r\n//         to {\r\n//           opacity: 1;\r\n//         }\r\n//       }\r\n\r\n//       @keyframes fadein {\r\n//         from {\r\n//           opacity: 0.2;\r\n//         }\r\n//         to {\r\n//           opacity: 1;\r\n//         }\r\n//       }\r\n\r\n//       #background {\r\n//         position: fixed;\r\n//         top: 0;\r\n//         bottom: 0;\r\n//         left: 0;\r\n//         right: 0;\r\n//         background: #e3e3e3b0;\r\n//         backdrop-filter: blur(5px);\r\n//         z-index: var(--background-z-index);\r\n\r\n//         animation-name: fadein;\r\n//         animation-duration: 250ms;\r\n//       }\r\n\r\n//       #headerContainer {\r\n//         display: flex;\r\n//         justify-content: space-between;\r\n//         margin: 40px;\r\n//         margin-bottom: 32px;\r\n//       }\r\n\r\n//       #headerContainer h1 {\r\n//         font-size: 34px;\r\n//         color: #3c3c3c;\r\n//         margin-top: 20px;\r\n//         margin-bottom: 7px;\r\n//       }\r\n\r\n//       #headerContainer img {\r\n//         height: 122px;\r\n//         width: 122px;\r\n//         background: lightgrey;\r\n//         border-radius: 10px;\r\n//         padding: 12px;\r\n//         border-radius: 24px;\r\n//         margin-right: 24px;\r\n//       }\r\n\r\n//       #buttonsContainer {\r\n//         display: flex;\r\n//         justify-content: flex-end;\r\n//         position: relative;\r\n//         height: 100px;\r\n\r\n//         background: #dedede75;\r\n//         width: 100%;\r\n//         right: 0em;\r\n//         border-radius: 0px 0px 12px 12px;\r\n//       }\r\n\r\n//       #openButton,\r\n//       #installButton,\r\n//       #installCancelButton {\r\n//         text-align: center;\r\n//         align-content: center;\r\n//         align-self: center;\r\n//         vertical-align: middle;\r\n//         justify-self: flex-end;\r\n//         line-height: 200%;\r\n//         flex: 0 0 auto;\r\n//         display: inline-block;\r\n//         background: #0078d4;\r\n//         color: #ffffff;\r\n//         cursor: pointer;\r\n//         border: solid 1px rgba(0, 0, 0, 0);\r\n//         outline: none;\r\n//       }\r\n\r\n//       #openButton {\r\n//         background: var(--install-button-color);\r\n//       }\r\n\r\n//       #openButton:focus {\r\n//         outline: auto;\r\n//         outline: -webkit-focus-ring-color auto 1px;\r\n//       }\r\n\r\n//       #installButton,\r\n//       #installCancelButton {\r\n//         min-width: 130px;\r\n//         margin-right: 30px;\r\n//         background: var(--install-button-color);\r\n//         border-radius: 20px;\r\n//         font-weight: 600;\r\n//         font-size: 14px;\r\n//         line-height: 21px;\r\n//         padding-top: 10px;\r\n//         padding-bottom: 9px;\r\n//         padding-left: 20px;\r\n//         padding-right: 20px;\r\n//         outline: none;\r\n//         color: white;\r\n//       }\r\n\r\n//       #closeButton {\r\n//         background: transparent;\r\n//         border: none;\r\n//         color: black;\r\n//         padding-left: 12px;\r\n//         padding-right: 12px;\r\n//         padding-top: 4px;\r\n//         padding-bottom: 4px;\r\n//         border-radius: 20px;\r\n//         font-weight: 600;\r\n//         outline: none;\r\n//         cursor: pointer;\r\n//         align-self: self-end;\r\n//       }\r\n\r\n//       #closeButton:focus,\r\n//       #installButton:focus,\r\n//       #installCancelButton:focus {\r\n//         box-shadow: 0 0 0 3px var(--install-focus-color);\r\n//       }\r\n\r\n//       #contentContainer {\r\n//         margin-left: 40px;\r\n//         margin-right: 40px;\r\n//         flex: 1;\r\n//       }\r\n\r\n//       #contentContainer h3 {\r\n//         font-size: 22px;\r\n//         color: #3c3c3c;\r\n//         margin-bottom: 12px;\r\n//       }\r\n\r\n//       #contentContainer p {\r\n//         font-size: 14px;\r\n//         color: #3c3c3c;\r\n//       }\r\n\r\n//       #featuresScreenDiv {\r\n//         display: flex;\r\n//         justify-content: space-around;\r\n//         align-items: center;\r\n//         margin-right: 20px;\r\n//       }\r\n\r\n//       #featuresScreenDiv h3 {\r\n//         font-style: normal;\r\n//         font-weight: 600;\r\n//         font-size: 22px;\r\n//         line-height: 225%;\r\n//         margin-top: 0px;\r\n//       }\r\n\r\n//       #keyFeatures {\r\n//         overflow: hidden;\r\n//         padding-right: 2em;\r\n//       }\r\n\r\n//       #keyFeatures ul {\r\n//         padding-inline-start: 22px;\r\n//         margin-block-start: 12px;\r\n//       }\r\n\r\n//       #featuresScreenDiv #keyFeatures li {\r\n//         font-style: normal;\r\n//         font-weight: 600;\r\n//         font-size: 16px;\r\n//         line-height: 29px;\r\n//         color: rgba(51, 51, 51, 0.72);\r\n//       }\r\n\r\n//       #screenshotsContainer {\r\n//         max-height: 220px;\r\n//         display: flex;\r\n//         max-width: 30em;\r\n//       }\r\n\r\n//       #screenshotsContainer button {\r\n//         border: none;\r\n//         width: 4em;\r\n\r\n//         transition: background-color 0.2s;\r\n//       }\r\n\r\n//       #screenshotsContainer button:focus,\r\n//       #screenshotsContainer button:hover {\r\n//         background-color: #bbbbbb;\r\n//       }\r\n\r\n//       #screenshotsContainer button svg {\r\n//         width: 28px;\r\n//         fill: #6b6969;\r\n//       }\r\n\r\n//       #screenshots {\r\n//         display: flex;\r\n//         scroll-snap-type: x mandatory;\r\n//         flex-wrap: wrap;\r\n//         flex-direction: column;\r\n//         overflow-x: scroll;\r\n\r\n//         width: 22em;\r\n//         max-height: 220px;\r\n\r\n//         -webkit-overflow-scrolling: touch;\r\n//       }\r\n\r\n//       #screenshots div {\r\n//         display: flex;\r\n//         align-items: center;\r\n//         justify-content: center;\r\n//         scroll-snap-align: start;\r\n\r\n//         height: 14em;\r\n//         width: 100%;\r\n\r\n//         background: #efefef;\r\n//       }\r\n\r\n//       #screenshots img {\r\n//         height: 100%;\r\n//         object-fit: contain;\r\n//       }\r\n\r\n//       #screenshots::-webkit-scrollbar {\r\n//         display: none;\r\n//       }\r\n\r\n//       #tagsDiv {\r\n//         margin-top: 1em;\r\n//         margin-bottom: 1em;\r\n//       }\r\n\r\n//       #desc {\r\n//         width: 100%;\r\n//         max-width: 40em;\r\n//         font-size: 14px;\r\n//         color: #7e7e7e;\r\n//         text-overflow: ellipsis;\r\n//         overflow: hidden;\r\n//       }\r\n\r\n//       #logoContainer {\r\n//         display: flex;\r\n//       }\r\n\r\n//       #tagsDiv span {\r\n//         background: grey;\r\n//         color: white;\r\n//         padding-left: 12px;\r\n//         padding-right: 12px;\r\n//         padding-bottom: 4px;\r\n//         font-weight: bold;\r\n//         border-radius: 24px;\r\n//         margin-right: 12px;\r\n//         padding-top: 1px;\r\n//       }\r\n\r\n//       #iosText {\r\n//         color: var(--install-button-color);\r\n//         text-align: center;\r\n//         font-weight: bold;\r\n\r\n//         position: fixed;\r\n//         bottom: 0;\r\n//         left: 0;\r\n//         right: 0;\r\n//         backdrop-filter: blur(10px);\r\n//         background: rgba(239, 239, 239, 0.17);\r\n//         margin: 0;\r\n//         padding: 2em;\r\n//       }\r\n\r\n//       #manifest-description {\r\n//         white-space: pre-wrap;\r\n//       }\r\n\r\n//       @media (max-height: 780px) {\r\n//         #buttonsContainer {\r\n//           height: 70px;\r\n//           background: transparent;\r\n//         }\r\n//       }\r\n\r\n//       @media (max-width: 1220px) {\r\n//         #installModal {\r\n//           margin: 0;\r\n//           border-radius: 0px;\r\n//           min-height: 100%;\r\n//           width: 100%;\r\n\r\n//           animation-name: mobile;\r\n//           animation-duration: 250ms;\r\n//         }\r\n\r\n//         #screenshots {\r\n//           justify-content: center;\r\n//         }\r\n//       }\r\n\r\n//       @media (max-width: 962px) {\r\n//         #headerContainer h1 {\r\n//           margin-top: 0;\r\n//           margin-bottom: 0;\r\n//         }\r\n\r\n//         #logoContainer {\r\n//           align-items: center;\r\n//         }\r\n\r\n//         #desc {\r\n//           display: none;\r\n//         }\r\n\r\n//         #headerContainer {\r\n//           margin-bottom: 24px;\r\n//         }\r\n\r\n//         #headerContainer img {\r\n//           height: 42px;\r\n//           width: 42px;\r\n//         }\r\n//       }\r\n\r\n//       @media (max-width: 800px) {\r\n//         #background {\r\n//           display: none;\r\n//         }\r\n\r\n//         #installModal {\r\n//           overflow: scroll;\r\n//           box-shadow: none;\r\n//           max-width: 100%;\r\n//           height: 100%;\r\n//         }\r\n\r\n//         #screenshotsContainer {\r\n//           width: 100%;\r\n//         }\r\n\r\n//         #screenshots img {\r\n//           height: 180px;\r\n//         }\r\n\r\n//         #buttonsContainer {\r\n//           display: flex;\r\n//           justify-content: center;\r\n//           bottom: 0;\r\n//           margin-bottom: 0;\r\n//           border-radius: 0;\r\n\r\n//           padding-top: 1em;\r\n//           padding-bottom: 1em;\r\n//         }\r\n\r\n//         #buttonsContainer #installButton {\r\n//           margin-right: 0px;\r\n//         }\r\n\r\n//         #featuresScreenDiv {\r\n//           flex-direction: column;\r\n//           align-items: flex-start;\r\n//           margin-right: 0px;\r\n//         }\r\n\r\n//         #headerContainer {\r\n//           margin: 20px;\r\n//         }\r\n\r\n//         #desc {\r\n//           display: none;\r\n//         }\r\n\r\n//         #contentContainer {\r\n//           margin-left: 20px;\r\n//           margin-right: 20px;\r\n//           margin-bottom: 5em;\r\n//         }\r\n\r\n//         #headerContainer img {\r\n//           height: 60px;\r\n//           width: 60px;\r\n//           margin-right: 12px;\r\n//         }\r\n\r\n//         #buttonsContainer {\r\n//           position: fixed;\r\n//           bottom: 0;\r\n//           background: #efefef2b;\r\n//           backdrop-filter: blur(10px);\r\n//         }\r\n//       }\r\n\r\n//       @media (max-width: 400px) {\r\n//         #headerContainer h1 {\r\n//           font-size: 26px;\r\n//         }\r\n\r\n//         #headerContainer img {\r\n//           height: 40px;\r\n//           width: 40px;\r\n//         }\r\n\r\n//         #featuresScreenDiv h3 {\r\n//           font-size: 18px;\r\n//           margin-bottom: 0px;\r\n//         }\r\n\r\n//         #keyFeatures ul {\r\n//           margin-top: 0px;\r\n//         }\r\n//       }\r\n\r\n//       @media all and (display-mode: standalone) {\r\n//         button {\r\n//           display: none;\r\n//         }\r\n//       }\r\n\r\n//       @media (prefers-color-scheme: dark) {\r\n//         :host {\r\n//           --modal-background-color: black;\r\n//         }\r\n\r\n//         #installModal h1,\r\n//         #installModal h2,\r\n//         #installModal h3,\r\n//         #installModal p,\r\n//         #featuresScreenDiv #keyFeatures li {\r\n//           color: #ffffff;\r\n//         }\r\n\r\n//         #closeButton svg path {\r\n//           fill: #ffffff;\r\n//           opacity: 1;\r\n//         }\r\n\r\n//         #buttonsContainer {\r\n//           background: rgb(36 36 36);\r\n//         }\r\n//       }\r\n\r\n//       /* 08-26-2020: supported by only safari desktop */\r\n//       @media (inverted-colors: inverted) {\r\n//         :host {\r\n//           --install-focus-color: #6e6363;\r\n//           --install-button-color: #ff872b;\r\n//           --modal-background-color: black;\r\n//         }\r\n\r\n//         #installModal h1,\r\n//         #installModal h2,\r\n//         #installModal h3,\r\n//         #installModal p,\r\n//         #featuresScreenDiv #keyFeatures li {\r\n//           color: #ffffff;\r\n//         }\r\n\r\n//         #closeButton svg path {\r\n//           fill: #ffffff;\r\n//           opacity: 1;\r\n//         }\r\n\r\n//         #buttonsContainer {\r\n//           background: rgb(36 36 36);\r\n//         }\r\n//       }\r\n//     `;\r\n//   }\r\n","import {INSTRUMENT_NAMES, INSTRUMENT_FOLDERS} from './instruments'\r\nimport {VERSION, DATE} from './version'\r\nimport {debounce} from './utils'\r\nimport {canFullscreen, exitFullscreen,goFullscreen,toggleFullScreen} from './full-screen'\r\nimport {getShareLink,loadSoloMode,loadDuetMode} from './location-handler'\r\n\r\nexport const progressBar = document.querySelector('progress')\r\n\r\nlet buttonInstrument\r\nlet buttonRecord\r\n\r\nexport let buttonQuantise\r\nexport let buttonMIDI\r\nexport let buttonVideo\r\nexport let controls\r\n\r\nimport PALETTE from \"./palette\"\r\n\r\n// updates the text on screen\r\n// here we take an element and return a method to set it\r\nexport const bindTextElement = (element, rate=700, clearAfter=0, split=false) => {\r\n\t\r\n\tlet cachedMessage = null\r\n\tlet interval = -1\r\n\tlet clearInterval = -1\r\n\tlet currentMessage = null\r\n\t\r\n\tconst db = debounce((message)=>{\r\n\t\telement.innerHTML = message\r\n\t}, rate)\r\n\r\n\tconst clear = (rate) => {\r\n\t\tconst after = clearAfter * rate\r\n\t\tclearInterval = setTimeout(()=>{\r\n\t\t\telement.innerHTML = ''\r\n\t\t}, after)\r\n\t\treturn after\r\n\t}\r\n\t\r\n\treturn element ? (message, responseRate=rate ) => {\r\n\r\n\t\tif (split)\r\n\t\t{\r\n\t\t\tmessage = message.split(/!|\\./i).join(\"<br>\")\r\n\t\t}\r\n\r\n\t\tcurrentMessage = message\r\n\t\t// debounce and only change if var has\r\n\t\tif (element.innerHTML === '' || cachedMessage != message)\r\n\t\t{\r\n\t\t\t// prevent it blanking from previous request\r\n\t\t\tclearTimeout(clearInterval)\r\n\r\n\t\t\tcachedMessage = message\r\n\t\t\tif (responseRate === 0)\r\n\t\t\t{\r\n\t\t\t\t// instant overwrite\r\n\t\t\t\tclearTimeout(interval)\r\n\t\t\t\telement.innerHTML = message\r\n\t\t\t}else{\r\n\t\t\t\t// change it after debounce timeout to prevent flooding\r\n\t\t\t\tinterval = db(message)\t\t\t\t\r\n\t\t\t}\r\n\t\t\t// clear after wards unless intercepted...\r\n\t\t\tif (clearAfter > 0)\r\n\t\t\t{\r\n\t\t\t\tclearInterval = clear(message.length)\r\n\t\t\t}\r\n\t\t}\r\n\t} : null\r\n}\r\n\r\n\r\nexport const video = document.querySelector(\"video\")\r\nexport const isVideoVisible = () => video.style.visibility === \"hidden\" \r\nexport const toggleVideoVisiblity = value => {\r\n\tvideo.style.visibility = isVideoVisible() ? \"visible\" : \"hidden\", !isVideoVisible() \r\n}\r\n\r\n// Feedback ui\r\nexport const setFeedback = bindTextElement( document.getElementById(\"feedback\"), 20 )\r\nexport const setToast = bindTextElement( document.getElementById(\"toast\"), 20, 900, true )\r\n\r\nexport const setControls = fragment => {\r\n\t\r\n\tconst personControl = document.getElementById('person-a-controls')\r\n\r\n\t// add to dom or replace existing????\r\n\tpersonControl.appendChild( fragment )\r\n\r\n\t// bind mouse events here???\r\n}\r\n\r\nexport const setupCameraForm = (cameras, callback) => {\r\n\t\r\n\tconst cameraForm = document.getElementById(\"camera\")\r\n\tconst select = cameraForm.querySelector('select')\r\n\r\n\t// loop through cameras and add to list\r\n\tconst optionElements = cameras.map( (camera, index) => {\r\n\t\t// now add this to the fragment\r\n\t\treturn `<option value=\"${camera.deviceId}\">${camera.label}</option>`\r\n\t})\r\n\t\t\t\r\n\t// we only inject into the select field\r\n\tselect.innerHTML = `<optgroup label=\"Detected Cameras\">${optionElements.join('')}</optgroup>`\r\n\r\n\t// now add the interaction\r\n\tselect.addEventListener( 'change', event=>{\r\n\t\t\r\n\t\tconst selection = select.options.selectedIndex\r\n\t\t// send out the device change to the callback...\r\n\t\tcallback & callback( cameras[selection] )\r\n\t\t//console.error( \"cameraForm input\", {event, select, selection} ) \r\n\t})\r\n}\r\n\r\n// Setup the instrument list - connect to callback?\r\nexport const setupInstrumentForm = callback => {\r\n\t\r\n\t// populate ui\t\r\n\tconst uiOptions = INSTRUMENT_FOLDERS.map( (folder, index) => `<label for=\"${folder}\">${INSTRUMENT_NAMES[index]}<input id=\"${folder}\" name=\"instrument-selector\" type=\"radio\" value=\"${folder}\"></input></label>` ) \r\n\t\r\n\t// bind mouse events too???\r\n\r\n\t// const uiOptions = INSTRUMENT_FOLDERS.map( folder => `<option value=\"${folder}\">${folder}</option>` ) \r\n\treturn `${uiOptions.join('')}`\r\n}\r\n\r\n// a simple midi buttnon with states\r\n// just set the state with the return\r\nexport const setupMIDIButton = (callback) => {\r\n\tlet midiEnabled = false\r\n\tconst onStartRequested = async (event) => {\r\n\t\tevent.preventDefault()\r\n\t\tcallback && callback()\r\n\t\tmidiEnabled = true\r\n\t\t//buttonMIDI.removeEventListener('mousedown', onStartRequested)\r\n\t\treturn false\r\n\t}\r\n\tbuttonMIDI.addEventListener('mousedown', onStartRequested, { once: true })\r\n\treturn {\r\n\t\tsetText:text=>buttonMIDI.innerHTML = test\r\n\t}\r\n}\r\n\r\nexport const addTooltip = button =>  button.addEventListener(\"mouseover\", event => {\r\n\tconst toolTip = event.target.getAttribute(\"aria-label\") || event.target.innerHTML\r\n\tsetToast(toolTip)\r\n})\r\n\r\nexport const setButton = (buttonName, callback ) => {\r\n\tconst element = document.getElementById(buttonName)\r\n\telement.addEventListener(\"click\", (event) => {\r\n\t\tcallback && callback({element})\r\n\t})\r\n\r\n\treturn element\r\n}\r\n\r\n// this allows checkbox use where the variable is changed\r\nexport const setToggle = (toggleName, callback, value ) => {\r\n\t\r\n\tconst element = setButton( toggleName, ()=>{\r\n\t\tvalue = !value\r\n\t\t// add classes to any associated wrapped label\r\n\t\tif (element.parentNode.nodeName === \"LABEL\")\r\n\t\t{\r\n\t\t\telement.parentNode.classList.toggle(\"checked\", value )\r\n\t\t}\r\n\t\tcallback(value)\r\n\t})\r\n\t// preset the button\r\n\tif (value)\r\n\t{\r\n\t\t// goto parent and add checked classes?\r\n\t\telement.setAttribute('checked', value)\r\n\t\telement.parentNode.classList.toggle(\"checked\", value )\r\n\t}\r\n\treturn element\r\n}\r\n\r\nexport const showReloadButton = () => {\r\n\r\n}\r\n\r\n\r\nexport const showUpdateButton = (action) => {\r\n\t// reveal update button?\r\n\tconst button = document.createElement('button')\r\n\tbutton.id = \"button-update\"\r\n\tbutton.setAttribute(\"aria-label\", `Update to new version` )\r\n\tbutton.classList.add(\"update-available\")\r\n\tbutton.innerHTML = \"Update\"\r\n\r\n\t// on button press...\r\n\tbutton.addEventListener('click', ()=>action() )\r\n\tcontrols.appendChild(button)\r\n}\r\n\r\nexport const addToolTips = (query=\"button, label\") => {\r\n\t\r\n\t// do a query here to catch all buttons?\r\n\tconst buttons = controls.querySelectorAll(query)\r\n\t\r\n\t// const fragment = document.createDocumentFragment() \r\n\t// fragment.appendChild(document.createElement('fieldset'))\r\n\t// const fragment = document.createElement('fieldset')\r\n\t// fragment.innerHTML = setupInstrumentForm()\r\n\t// add to dom\r\n\t// controls.appendChild( fragment )\r\n\r\n\t// intercept any hover events...\r\n\tbuttons.forEach( button => addTooltip(button) )\r\n}\r\n\r\n// DOM elements\r\nexport const setupInterface = ( options ) => {\r\n\r\n\tconst main = document.querySelector(\"main\")\r\n\tconst h1 = document.querySelector(\"h1\")\r\n\t\r\n\tconst buttonShare = document.getElementById(\"share\")\r\n\tconst buttonSolo = document.getElementById(\"button-solo\")\r\n\tconst buttonDuet = document.getElementById(\"button-duet\")\r\n\tconst title = document.getElementById(\"title\")\r\n\t\r\n\tconst shareElement = document.querySelector(\"share-menu\")\r\n\tshareElement.url = getShareLink( options )\r\n\tbuttonShare.addEventListener('mousedown', e => {\r\n\t\t\r\n\t\tshareElement.setAttribute( \"url\", getShareLink( options ) )\r\n\t\tconsole.error(\"SHARING\", {shareElement, url:shareElement.url  } )\r\n\t}, false)\r\n\t\r\n\tcontrols = document.getElementById(\"controls\")\r\n\r\n\tbuttonInstrument = document.getElementById(\"button-instrument\")\r\n\tbuttonVideo = document.getElementById(\"button-video\")\r\n\tbuttonRecord = document.getElementById(\"button-record\")\r\n\tbuttonMIDI = document.getElementById(\"button-midi\")\r\n\tbuttonQuantise = document.getElementById(\"button-quantise\")\r\n\t//buttonPhotograph = document.getElementById(\"button-photograph\")\r\n\t\r\n\r\n\tif ( canFullscreen() )\r\n\t{\r\n\t\t//also pass this inott a flip flopper\r\n\t\tconst buttonFullscreen = setToggle( \"button-fullscreen\", status =>{\r\n\t\t\toptions.fullscreen = toggleFullScreen()\r\n\t\t\tbuttonFullscreen.classList.toggle(\"fs\", options.fullscreen)\r\n\t\t\t//console.log(\"fullscreen\", options.fullscreen)\r\n\t\t\t//setToast(\"Metronome \" + (ui.metronome ? 'enabled' : 'disabled')  )\r\n\t\t}, false )\r\n\t\r\n\t}else{\r\n\t\t// no full screen mode available so hide the full screen button\r\n\t\tdocument.getElementById( \"button-fullscreen\").classList.toggle(\"hide\", true)\r\n\t}\r\n\t\r\n\t// Show the release date on the UI somewhere...\r\n\t\r\n\tconst releaseDate = new Date(DATE)\r\n\tconst dateOptions = {\r\n\t\thour12 : true,\r\n\t\thour:  \"numeric\",\r\n\t\tminute:  \"numeric\",\r\n\t }\r\n \r\n\tconst versionElement = document.getElementById(\"version\")\r\n\tconst currentVersion = versionElement.innerHTML\r\n\tconst formattedDate = `${releaseDate.getDate()}/${releaseDate.getMonth()+1}/${releaseDate.getFullYear()} ${ releaseDate.toLocaleTimeString(\"en-GB\",dateOptions) }`\r\n\tversionElement.innerHTML = `${currentVersion} <span id=\"release\">${formattedDate}</span>`\r\n\t\r\n\t// console.log(`InterFACE ${currentVersion} build date : ${formattedDate} `, {DATE, releaseDate})\r\n\r\n\t// if we are in solo mode\r\n\tif (!options.duet)\r\n\t{\r\n\t\tbuttonSolo.classList.toggle( \"hide\", true)\r\n\t\tbuttonDuet.classList.toggle( \"hide\", false)\r\n\t\tmain.classList.add(\"solo\")\r\n\t\tbuttonSolo.addEventListener( \"click\", event => loadDuetMode, false)\r\n\r\n\t}else{\r\n\t\t\r\n\t\t// append duet mode styles\r\n\t\th1.innerHTML += ' duet' \r\n\t\tbuttonDuet.classList.toggle( \"hide\", true)\r\n\t\tbuttonSolo.classList.toggle( \"hide\", false)\r\n\t\tmain.classList.add(\"duet\")\r\n\t\tbuttonDuet.addEventListener( \"click\", event => loadSoloMode, false)\r\n\t}\r\n\t\r\n\t\r\n\t// prevent the form from changing the url\t\r\n\tcontrols.addEventListener(\"submit\", (event) => {\r\n\t\tevent.preventDefault()\r\n\t\t// removes the ?\r\n        //window.history.back()\r\n\t}, true)\r\n\r\n\ttitle.innerHTML = \"The InterFACE is ready, open your mouth to begin\"\r\n}","export const MUSICAL_NOTES = ['♫','𝅗𝅥','𝅘𝅥','𝅘𝅥𝅮','𝅘𝅥𝅯','𝅘𝅥𝅰','𝅘𝅥𝅱','𝅘𝅥𝅲']\r\n// '𝄞',\r\n\r\nexport const INSTRUMENT_FOLDERS = [\r\n\t\"accordion-mp3\",\r\n\t\"acoustic_bass-mp3\",\r\n\t\"acoustic_grand_piano-mp3\",\r\n\t\"acoustic_guitar_nylon-mp3\",\r\n\t\"acoustic_guitar_steel-mp3\",\r\n\t\"agogo-mp3\",\r\n\t\"alto_sax-mp3\",\r\n\t\"applause-mp3\",\r\n\t\"bagpipe-mp3\",\r\n\t\"banjo-mp3\",\r\n\t\"baritone_sax-mp3\",\r\n\t\"bassoon-mp3\",\r\n\t\"bird_tweet-mp3\",\r\n\t\"blown_bottle-mp3\",\r\n\t\"brass_section-mp3\",\r\n\t\"breath_noise-mp3\",\r\n\t\"bright_acoustic_piano-mp3\",\r\n\t\"celesta-mp3\",\r\n\t\"cello-mp3\",\r\n\t\"choir_aahs-mp3\",\r\n\t\"church_organ-mp3\",\r\n\t\"clarinet-mp3\",\r\n\t\"clavinet-mp3\",\r\n\t\"contrabass-mp3\",\r\n\t\"distortion_guitar-mp3\",\r\n\t\"drawbar_organ-mp3\",\r\n\t\"dulcimer-mp3\",\r\n\t\"electric_bass_finger-mp3\",\r\n\t\"electric_bass_pick-mp3\",\r\n\t\"electric_grand_piano-mp3\",\r\n\t\"electric_guitar_clean-mp3\",\r\n\t\"electric_guitar_jazz-mp3\",\r\n\t\"electric_guitar_muted-mp3\",\r\n\t\"electric_piano_1-mp3\",\r\n\t\"electric_piano_2-mp3\",\r\n\t\"english_horn-mp3\",\r\n\t\"fiddle-mp3\",\r\n\t\"flute-mp3\",\r\n\t\"french_horn-mp3\",\r\n\t\"fretless_bass-mp3\",\r\n\t\"fx_1_rain-mp3\",\r\n\t\"fx_2_soundtrack-mp3\",\r\n\t\"fx_3_crystal-mp3\",\r\n\t\"fx_4_atmosphere-mp3\",\r\n\t\"fx_5_brightness-mp3\",\r\n\t\"fx_6_goblins-mp3\",\r\n\t\"fx_7_echoes-mp3\",\r\n\t\"fx_8_scifi-mp3\",\r\n\t\"glockenspiel-mp3\",\r\n\t\"guitar_fret_noise-mp3\",\r\n\t\"guitar_harmonics-mp3\",\r\n\t\"gunshot-mp3\",\r\n\t\"harmonica-mp3\",\r\n\t\"harpsichord-mp3\",\r\n\t\"helicopter-mp3\",\r\n\t\"honkytonk_piano-mp3\",\r\n\t\"kalimba-mp3\",\r\n\t\"koto-mp3\",\r\n\t\"lead_1_square-mp3\",\r\n\t\"lead_2_sawtooth-mp3\",\r\n\t\"lead_3_calliope-mp3\",\r\n\t\"lead_4_chiff-mp3\",\r\n\t\"lead_5_charang-mp3\",\r\n\t\"lead_6_voice-mp3\",\r\n\t\"lead_7_fifths-mp3\",\r\n\t\"lead_8_bass__lead-mp3\",\r\n\t\"marimba-mp3\",\r\n\t\"melodic_tom-mp3\",\r\n\t\"music_box-mp3\",\r\n\t\"muted_trumpet-mp3\",\r\n\t\"oboe-mp3\",\r\n\t\"ocarina-mp3\",\r\n\t\"orchestra_hit-mp3\",\r\n\t\"orchestral_harp-mp3\",\r\n\t\"overdriven_guitar-mp3\",\r\n\t\"pad_1_new_age-mp3\",\r\n\t\"pad_2_warm-mp3\",\r\n\t\"pad_3_polysynth-mp3\",\r\n\t\"pad_4_choir-mp3\",\r\n\t\"pad_5_bowed-mp3\",\r\n\t\"pad_6_metallic-mp3\",\r\n\t\"pad_7_halo-mp3\",\r\n\t\"pad_8_sweep-mp3\",\r\n\t\"pan_flute-mp3\",\r\n\t\"percussive_organ-mp3\",\r\n\t\"piccolo-mp3\",\r\n\t\"pizzicato_strings-mp3\",\r\n\t\"recorder-mp3\",\r\n\t\"reed_organ-mp3\",\r\n\t\"reverse_cymbal-mp3\",\r\n\t\"rock_organ-mp3\",\r\n\t\"seashore-mp3\",\r\n\t\"shakuhachi-mp3\",\r\n\t\"shamisen-mp3\",\r\n\t\"shanai-mp3\",\r\n\t\"sitar-mp3\",\r\n\t\"slap_bass_1-mp3\",\r\n\t\"slap_bass_2-mp3\",\r\n\t\"soprano_sax-mp3\",\r\n\t\"steel_drums-mp3\",\r\n\t\"string_ensemble_1-mp3\",\r\n\t\"string_ensemble_2-mp3\",\r\n\t\"synth_bass_1-mp3\",\r\n\t\"synth_bass_2-mp3\",\r\n\t\"synth_brass_1-mp3\",\r\n\t\"synth_brass_2-mp3\",\r\n\t\"synth_choir-mp3\",\r\n\t\"synth_drum-mp3\",\r\n\t\"synth_strings_1-mp3\",\r\n\t\"synth_strings_2-mp3\",\r\n\t\"taiko_drum-mp3\",\r\n\t\"tango_accordion-mp3\",\r\n\t\"telephone_ring-mp3\",\r\n\t\"tenor_sax-mp3\",\r\n\t\"timpani-mp3\",\r\n\t\"tinkle_bell-mp3\",\r\n\t\"tremolo_strings-mp3\",\r\n\t\"trombone-mp3\",\r\n\t\"trumpet-mp3\",\r\n\t\"tuba-mp3\",\r\n\t\"tubular_bells-mp3\",\r\n\t\"vibraphone-mp3\",\r\n\t\"viola-mp3\",\r\n\t\"violin-mp3\",\r\n\t\"voice_oohs-mp3\",\r\n\t\"whistle-mp3\",\r\n\t\"woodblock-mp3\",\r\n\t\"xylophone-mp3\"\r\n]\r\n\r\n// TODO: Which of these are loops?\r\n// export const LOOPS = []\r\n// export const SINGLE_SHOTS = []\r\n\r\nexport const cleanTitle = name => name && name.length > 1 ? name.replaceAll(\"_\", \" \").replace(\"-mp3\", \"\") : ''\r\n\r\nexport const INSTRUMENT_NAMES = INSTRUMENT_FOLDERS.map( instrument => cleanTitle(instrument) )","export const VERSION=\"0.39.1\";\rexport const DATE=1613510754820;","\r\nexport const debounce = (callback, wait) => {\r\n\tlet timerId\r\n\t\r\n\treturn (...args) => {\r\n\t\t//console.error(args, \"debounce\", arguments)\r\n\t  clearTimeout(timerId)\r\n\t  timerId = setTimeout(() => callback(...args), wait)\r\n\t  return timerId\r\n\t}\r\n}","\r\nexport const canFullscreen = () => document.fullscreenEnabled || document.mozFullScreenEnabled || document.documentElement.webkitRequestFullScreen\r\n\r\nexport const exitFullscreen = () => {\r\n\tdocument.exitFullscreen()\r\n}\r\n\r\nexport const goFullscreen = (callback) => {\r\n\r\n\tif ( canFullscreen() ) \r\n\t{\r\n\t\tdocument.documentElement.requestFullscreen()\r\n\t}\r\n\t// leave full screen... \r\n}\r\n\r\nexport const toggleFullScreen = () => {\r\n\tif (!document.fullscreenElement) \r\n\t{\r\n\t\tgoFullscreen()\r\n\t\treturn true\r\n\r\n\t} else {\r\n\r\n\t  if (document.exitFullscreen) \r\n\t  {\r\n\t\texitFullscreen()\r\n\t  }\r\n\r\n\t  return false\r\n\t}\r\n}","const guessType = value => {\r\n\r\n\tif (typeof value === \"string\")\r\n\t{\r\n\t\tconst lower = value.toLowerCase()\r\n\t\t// check for bool and such\r\n\t\tif (lower === \"true\" || lower === \"1\") {\r\n\t\t\treturn true\r\n\t\t} else if (lower === \"false\"|| lower === \"0\") {\r\n\t\t\treturn false\r\n\t\t}\r\n\r\n\t\treturn value\r\n\r\n\t}else if (Array.isArray(value)){\r\n\t\t// Array convert the array to a string?\r\n\t\t// convert booleans from 1 / 0 ?\r\n\t\treturn value.toString()\r\n\r\n    } else {\r\n\r\n\t\treturn data\r\n\t}\r\n\r\n}\r\n\r\n\r\n// convert string to rudimentary types\r\nexport const parseType = value => {\r\n\r\n\t// check to see if the string is also an array...\r\n\tif (typeof value === \"string\")\r\n\t{\r\n\t\tif (value.toLowerCase() === \"true\") {\r\n\t\t\treturn true\r\n\t\t} else if (value === \"false\") {\r\n\t\t\treturn false\r\n\t\t}else if (value.indexOf(',') >= 0){\r\n\t\t\t// this is a comma seperated list array...\r\n\t\t\t\r\n\t\t\treturn convertIntegerArrayToBooleans( value.split(\",\") )\r\n\r\n\t\t} else if (!isNaN(parseFloat(value))) {\r\n\t\t\t// Number / Int\r\n\t\t\treturn parseFloat(value)\r\n\t\t} else{\r\n\t\t\treturn value\r\n\t\t}\r\n\r\n\t}else if (Array.isArray(value)){\r\n\t\t// Array convert the array to a string?\r\n\t\t// convert booleans from 1 / 0 ?\r\n\t\treturn value.toString()\r\n    } else {\r\n\t\t// God only knows\r\n        return value\r\n    }\r\n}\r\n\r\n// this takes a snapshot of the url and takes and queries\r\n// then it will take apart and create an object\r\n// and return a merged subset\r\nexport const getLocationSettings = (defaultOptions) => {{\r\n\tconst locationOptions = Object.assign( {}, defaultOptions )\r\n\tconst urlParams = new URLSearchParams(window.location.search)\r\n\tfor (const [key, value] of urlParams) \r\n\t{\r\n\t//\tconsole.log(`${key}:${value}`)\r\n\t\t// ensure we data type these\r\n\t\tlocationOptions[key] = guessType(value)\r\n\t}\r\n\r\n\t//console.log(`query:${locationOptions}`)\r\n\treturn locationOptions\r\n}}\r\n\r\n// reload the exact same URL but wih duet=true enabled\r\nexport const loadDuetMode = ()=> {\r\n\t// grab existing...\r\n\tconst urlParams = new URLSearchParams(window.location.search)\r\n\turlParams.duet = true\r\n\t//window.location = url\r\n}\r\n\r\nexport const loadSoloMode = ()=> {\r\n\tconst urlParams = new URLSearchParams(window.location.search)\r\n\turlParams.duet = false\r\n\t//window.location = url\r\n}\r\n\r\nexport const refresh = options => {\r\n\t// save to url?\r\n\twindow.location.reload()\r\n}\r\n\r\nexport const toQuery = options =>  (new URLSearchParams(options).toString())\r\n\r\nexport const addToHistory = (options, title=\"\") => {\r\n\tconst url = new URL(window.location)\r\n\tfor (let i in options){\r\n\t\tconst option = options[i]\r\n\t\turl.searchParams.set(i, option)\r\n\t\t//console.log(\"History\", {out, options, title, url} )\r\n\t}\r\n\t//\r\n\tconst out = window.history.pushState(options, title, url)\r\n\t//console.log(\"History\", {out, options, title, url} )\r\n}\r\nexport const getShareLink = (options) => {\r\n\t\r\n\treturn window.location + toQuery(options)\r\n}","const PALETTE = {\r\n\twhite:\"hsl(22, 28%, 87%)\",\r\n\tdark:\"hsl(30, 6%, 14%)\",\r\n\tgrey:\"hsl(11, 6%, 50%)\",\r\n\tcream:\"hsl(27, 30%, 45%)\",\r\n\tbrown:\"hsl(23, 22%, 30%)\",\r\n\tblue:\"hsl(196, 18%, 33%)\",\r\n\tgreen:\"hsl(56, 18%, 33%)\",\r\n\tyellow:\"hsl(56, 18%, 33%)\",\r\n\torange:\"hsl(28, 69%, 38%)\",\r\n\tred:\"hsl(9, 58%, 35%)\"\r\n}\r\n\r\nexport const DEFAULT_COLOURS = {\r\n\tdots:'red',\r\n\tmouth:'rgba(255,0,0,0.5)',\r\n\tmouthClosed:'rgba(255,0,0,0.2)',\r\n\tlipsUpperInner:'pink',\r\n\tlipsLowerInner:'pink',\r\n\tmidwayBetweenEyes:'blue',\r\n\tleftEyeLower0:'red',\r\n\trightEyeLower0:'red',\r\n\tleftEyeIris:'yellow',\r\n\trightEyeIris:'yellow',\r\n}\r\n\r\nexport default PALETTE","\"use strict\";\n\n/* globals document:readonly */\nvar bundleURL = null;\n\nfunction getBundleURLCached() {\n  if (!bundleURL) {\n    bundleURL = getBundleURL();\n  }\n\n  return bundleURL;\n}\n\nfunction getBundleURL() {\n  try {\n    throw new Error();\n  } catch (err) {\n    var matches = ('' + err.stack).match(/(https?|file|ftp):\\/\\/[^)\\n]+/g);\n\n    if (matches) {\n      return getBaseURL(matches[0]);\n    }\n  }\n\n  return '/';\n}\n\nfunction getBaseURL(url) {\n  return ('' + url).replace(/^((?:https?|file|ftp):\\/\\/.+)\\/[^/]+$/, '$1') + '/';\n} // TODO: Replace uses with `new URL(url).origin` when ie11 is no longer supported.\n\n\nfunction getOrigin(url) {\n  let matches = ('' + url).match(/(https?|file|ftp):\\/\\/[^/]+/);\n\n  if (!matches) {\n    throw new Error('Origin not found');\n  }\n\n  return matches[0];\n}\n\nexports.getBundleURL = getBundleURLCached;\nexports.getBaseURL = getBaseURL;\nexports.getOrigin = getOrigin;","\"use strict\";\n\nvar resolve = require('./bundle-manifest').resolve;\n\nmodule.exports = function (fromId, toId) {\n  return relative(dirname(resolve(fromId)), resolve(toId));\n};\n\nfunction dirname(_filePath) {\n  if (_filePath === '') {\n    return '.';\n  }\n\n  var filePath = _filePath[_filePath.length - 1] === '/' ? _filePath.slice(0, _filePath.length - 1) : _filePath;\n  var slashIndex = filePath.lastIndexOf('/');\n  return slashIndex === -1 ? '.' : filePath.slice(0, slashIndex);\n}\n\nfunction relative(from, to) {\n  if (from === to) {\n    return '';\n  }\n\n  var fromParts = from.split('/');\n\n  if (fromParts[0] === '.') {\n    fromParts.shift();\n  }\n\n  var toParts = to.split('/');\n\n  if (toParts[0] === '.') {\n    toParts.shift();\n  } // Find where path segments diverge.\n\n\n  var i;\n  var divergeIndex;\n\n  for (i = 0; (i < toParts.length || i < fromParts.length) && divergeIndex == null; i++) {\n    if (fromParts[i] !== toParts[i]) {\n      divergeIndex = i;\n    }\n  } // If there are segments from \"from\" beyond the point of divergence,\n  // return back up the path to that point using \"..\".\n\n\n  var parts = [];\n\n  for (i = 0; i < fromParts.length - divergeIndex; i++) {\n    parts.push('..');\n  } // If there are segments from \"to\" beyond the point of divergence,\n  // continue using the remaining segments.\n\n\n  if (toParts.length > divergeIndex) {\n    parts.push.apply(parts, toParts.slice(divergeIndex));\n  }\n\n  return parts.join('/');\n}\n\nmodule.exports._dirname = dirname;\nmodule.exports._relative = relative;","import {debounce} from './utils'\r\n\r\n// little local storage wrapper for storing cached objects\r\nexport const createStore = (name=\"Plops\") => {\r\n\tconst storage = localStorage.getItem(name)\r\n\tconst data = Object.assign({}, JSON.parse(storage) )\r\n\tconst save = debounce( updates => {\r\n\t\tconst encoded = JSON.stringify(updates)\r\n\t\tlocalStorage.setItem(name, encoded )\r\n\t\t\r\n\t}, 20 )\r\n\t\r\n// console.error(\"store\",name,\"created\", {data, storage})\r\n\r\n\treturn {\r\n\t\tsave,\r\n\t\thas:key =>{\r\n\t\t\treturn data[key] ? true : false\r\n\t\t},\r\n\t\tremoveItem:key =>{\r\n\t\t\tdelete data[key] \r\n\t\t},\r\n\t\tgetItem:key =>{\r\n\t\t\treturn data[key] \r\n\t\t},\r\n\t\tsetItem:(key,value)=>{\r\n\t\t\tdata[key] = Object.assign( {}, data[key], value )\r\n\t\t\t// save to local\r\n\t\t\tsave(data)\r\n\t\t\t\r\n\t\t\treturn data\r\n\t\t},\r\n\t}\r\n}\r\n\r\n","// https://www.chromestatus.com/features/5687444770914304\r\nconst TIME_OUT = 10000\r\n\r\nexport const hasSpeech = () =>{\r\n  return \"speechSynthesis\" in window\r\n}\r\n\r\n// we have to loop this with a settimout until voices are available...\r\nconst getVoices = async () => new Promise( (resolve,reject) => {\r\n\r\n  let voices \r\n  const startTime = Date.now()\r\n\r\n  const waitForVoices = () => {\r\n\r\n    voices = window.speechSynthesis.getVoices()\r\n\r\n    if (voices.length > 0)\r\n    {\r\n      resolve( voices )\r\n\r\n    }else{\r\n\r\n      // check to see we aren't wasting too much time\r\n      const elapsed = Date.now() - startTime\r\n\r\n      if (elapsed < TIME_OUT)\r\n      {\r\n        // in some ways this is a fudge factor as the voices\r\n        // aren't always known about on DOM available : LOOP\r\n        setTimeout(waitForVoices,0)\r\n\r\n      }else{\r\n        reject(\"No voices found\")\r\n      }\r\n    \r\n    }\r\n  }\r\n\r\n  waitForVoices()\r\n})\r\n\r\nconst getSpecificVoice = async (lang = \"en-US\", name =\"Zira\") =>{\r\n  const voices = getVoices()\r\n  const filtered = voices.filter( voice => {\r\n    // first we check to see if the language is the same...\r\n    return (voice.lang === lang && voice.name.indexOf(name) > -1 )\r\n  })\r\n  return filtered.length < 1 ? voices : filtered\r\n}\r\n\r\n////////////////////////////////////////////////////////////\r\n// Speak this out loud\r\n// rate     0.1 to 10\r\n// pitch    0 to 2\r\n////////////////////////////////////////////////////////////\r\nexport const say = async (text, interupt=true, volume=1, rate=1, pitch=1, lang, name ) =>{\r\n\r\n  return new Promise(  (resolve,reject)=>{\r\n\r\n    if (!hasSpeech)\r\n    {\r\n      reject(\"Speech tech not available\")\r\n\r\n    }else{\r\n\r\n      // now pause whilst we attempt to list...\r\n      const talk = async () => {\r\n\r\n        try{\r\n\r\n          const voices = (lang && name) ? await getSpecificVoice(lang, name) : await getVoices()\r\n          const person = voices[0]\r\n          const speech = new SpeechSynthesisUtterance()\r\n\r\n          speech.lang = 'en-US'\r\n          // set voice if specified\r\n          // Note: some voices don't support altering params\r\n          speech.voice = person\r\n          speech.voiceURI = 'native'\r\n\r\n          // watch for ending...\r\n          speech.onend = (event) => {\r\n            //console.log('Finished in ' + event.elapsedTime + ' seconds.')\r\n            speech.onend = null\r\n            resolve(event)\r\n          }\r\n\r\n          speech.onerror = (event) =>{\r\n            reject()\r\n          }\r\n\r\n          // 0 to 1\r\n          speech.volume = volume\r\n          // 0.1 to 10\r\n          speech.rate = rate\r\n          //0 to 2\r\n          speech.pitch = pitch\r\n          speech.text = text\r\n            // console.error(\"specific voices\", {\r\n            //   speech, lang,\r\n            //   name,\r\n            //   voices\r\n            // });\r\n\r\n          // kill any pending!\r\n          if (interupt)\r\n          {\r\n            window.speechSynthesis.cancel()\r\n          }\r\n          window.speechSynthesis.speak(speech)\r\n\r\n        }catch (error){\r\n\r\n          reject(error) \r\n        }\r\n      }\r\n      talk()\r\n    }\r\n  })\r\n}\r\n\r\n\r\nexport const stopSpeaking = ()=>{\r\n\r\n  return window.speechSynthesis.cancel()\r\n}\r\n\r\n\r\nexport const isVoiceActive = ()=>{\r\n\r\n  return window.speechSynthesis.pending\r\n}","import {clamp, lerp, TAU} from \"./maths\"\r\nimport {cleanTitle} from './instruments'\r\n\r\nimport {INSTRUMENT_FOLDERS} from \"./instruments\"\r\n\r\nconst BANKS = [\"A\",\"Ab\",\"B\",\"Bb\",\"C\",\"D\", \"Db\",\"E\", \"Eb\", \"F\", \"G\",\"Gb\"]\r\n\r\nconst NOTES_BLACK = [\"Ab\", \"Bb\", \"Db\", \"Eb\", \"Gb\"]\r\nconst NOTES_WHITE = [\"A\",\"B\",\"C\",\"D\",\"E\",\"F\", \"G\" ]\r\n\t\r\nexport const randomInstrument = () => INSTRUMENT_FOLDERS[ Math.floor( Math.random() * INSTRUMENT_FOLDERS.length ) ]\r\n\r\nexport let audioContext\r\nlet mediaRecorder\r\n\r\nexport let bufferLength\r\nexport let dataArray\r\n\r\nlet oscillator\r\nlet gainNode\r\nlet delayNode\r\nlet feedbackNode\r\nlet analyser\r\nlet compressor\r\nlet reverb\r\nlet recorder\r\nlet destinationVolume = 0\r\n\r\nexport let playing = false\r\nexport let active = false\r\n\r\nexport const inputNode = () => delayNode\r\nexport const inputDryNode = () => gainNode\r\n\r\nexport const setupAudio = (\r\n\tBUFFER_SIZE = 2048, // the buffer size in units of sample-frames.\r\n\tINPUT_CHANNELS = 1, // the number of channels for this node's input, defaults to 2\r\n\tOUTPUT_CHANNELS = 1 // the number of channels for this node's output, defaults to 2\r\n) => {\r\n\r\n\t// set up forked web audio context, for multiple browsers\r\n  \t// window. is needed otherwise Safari explodes\r\n\taudioContext = new (window.AudioContext || window.webkitAudioContext)()\r\n\r\n\tgainNode = audioContext.createGain()\r\n\tgainNode.gain.value = 0\r\n\r\n\t// oscillator = audioContext.createOscillator()\r\n\t// oscillator.type = \"sine\" // \"sawtooth\"\r\n\t// oscillator.frequency.value = 261.63\r\n\t// oscillator.connect(delayNode)\r\n\t// oscillator.start()\r\n\r\n\t// this should hopefully balance the outputs\r\n\tcompressor = audioContext.createDynamicsCompressor()\r\n\t// \tthreshold: [-100, 0],\r\n\t// \tknee: [0, 40],\r\n\t// \tratio: [1, 20],\r\n\t// \tattack: [0, 1],\r\n\t// \trelease: [0, 1]\r\n\tcompressor.threshold.value = -70\r\n\tcompressor.knee.value = 40\r\n\tcompressor.ratio.value = 15\r\n\tcompressor.attack.value = 0.2\r\n\tcompressor.release.value = 0.5\r\n\r\n\treverb = audioContext.createConvolver()\r\n\t// reverb = audioContext.createConvolver(null, true)\r\n\tdelayNode = audioContext.createDelay(0.01)\r\n\tfeedbackNode = audioContext.createGain()\r\n\r\n\t//delayNode.delayTime.value = 0\r\n\tfeedbackNode.gain.value = 0.2\r\n\r\n\tanalyser = audioContext.createAnalyser()\r\n\tanalyser.minDecibels = -90\r\n\tanalyser.maxDecibels = -10\r\n\tanalyser.smoothingTimeConstant = 0.85\r\n\r\n\t// for waves\r\n\t// analyser.fftSize = 2048\r\n\t// bufferLength = analyser.fftSize\r\n\r\n\t// for bars\r\n\tanalyser.fftSize = 256\r\n\tbufferLength = analyser.frequencyBinCount\r\n\t\r\n    dataArray = new Uint8Array(bufferLength)\r\n\t\r\n\t//console.error(\"instrument\",{oscillator, compressor, dataArray} )\r\n\t\r\n\t// To recreate feedback...\r\n\tdelayNode.connect(feedbackNode)\r\n\tfeedbackNode.connect(delayNode)\r\n\tdelayNode.connect(gainNode)\r\n\r\n\t// delayNode.connect(reverb)\r\n\t// reverb.connect(gainNode)\r\n\r\n\tgainNode.connect(compressor)\r\n\tcompressor.connect(analyser)\r\n\r\n\trecorder = audioContext.createScriptProcessor(BUFFER_SIZE, INPUT_CHANNELS, OUTPUT_CHANNELS)\r\n\r\n\tanalyser.connect(audioContext.destination)\r\n\t\r\n\treturn delayNode\r\n}\r\n\r\n\r\nexport const updateByteFrequencyData = ()=> analyser.getByteFrequencyData(dataArray)\r\nexport const updateByteTimeDomainData = ()=> analyser.getByteTimeDomainData(dataArray)\r\n\r\nconst monitor = () => {\r\n\r\n\tconst result = requestAnimationFrame(monitor)\r\n\r\n\t// waves\r\n\t//analyser.getByteTimeDomainData(dataArray)\r\n\t\r\n\t// bsrs\r\n\tanalyser.getByteFrequencyData(dataArray)\r\n\r\n\treturn result\r\n}\r\n\r\nexport const stopAudio = () => {\r\n\tif (playing)\r\n\t{\r\n\t\tplaying = false\r\n\t\t// you cannot restart an oscillator!\r\n\t\t//oscillator.stop()\r\n\t\t//oscillator.disconnect()\r\n\t\t// analyser.disconnect()\r\n\t\treturn true\r\n\t}else{\r\n\t\treturn false\r\n\t}\r\n\t//console.error(\"stop audio\",{playing})\r\n}\r\nexport const playAudio = () => {\r\n\tif (playing)\r\n\t{\r\n\t\treturn false\r\n\t}else{\r\n\t\tif (audioContext.state === 'suspended') \r\n\t\t{\r\n\t\t\taudioContext.resume()\r\n\t\t}\r\n\t\t// analyser.connect(audioContext.destination)\r\n\t\t//oscillator.connect(delayNode)\r\n\t\t\r\n\t\tplaying = true\r\n\t\tmonitor()\r\n\t\treturn true\r\n\t}\r\n\t//console.error(\"start audio\",{playing})\r\n\treturn oscillator\r\n}\r\n\r\nexport const setShape = shape => {\r\n\toscillator.type = shape\r\n}\r\n\r\nexport const setFrequency = frequency => {\r\n\toscillator.frequency.value = frequency\r\n}\r\n\r\nexport const getVolume = () => destinationVolume // gainNode.gain.value\r\n\r\n// smaller means slower\r\nexport const setVolume = (destinationVolume) => {\r\n\r\n\tdestinationVolume = clamp(destinationVolume, 0, 1)\r\n\t//gainNode.gain.setValueAtTime(newVolume, audioContext.currentTime)\r\n\tgainNode.gain.value = destinationVolume\r\n\r\n\treturn destinationVolume\r\n}\r\n\r\nconst rate = 0.1\r\nconst fadeVolume = (destinationVolume) => {\r\n\r\n\t//gainNode.gain.value = lerp( gain.gain.value, destinationVolume, 0.1 )\r\n\tconst newVolume = gainNode.gain.value + (destinationVolume - gainNode.gain.value) * rate\r\n\tgainNode.gain.setValueAtTime(destinationVolume, audioContext.currentTime)\r\n\t\r\n\tif (gainNode.gain.value === destinationVolume)\r\n\t{\r\n\r\n\t}else{\r\n\t\trequestAnimationFrame( fadeVolume )\r\n\t}\r\n\treturn newVolume\r\n}\r\n\r\n\r\nexport const setAmplitude = amplitude => {\r\n\t// lerp towards\r\n\t destinationVolume = amplitude\r\n\t fadeVolume()\r\n\t//gainNode.gain.clearValues()\r\n\t//gainNode.gain.setValueAtTime(amplitude, audioContext.currentTime)\r\n}\r\n\r\nasync function loadAudio(path) {\r\n\tconst response = await fetch(path)\r\n\tconst arrayBuffer = await response.arrayBuffer()\r\n\tconst audioBuffer = await audioContext.decodeAudioData(arrayBuffer)\r\n\treturn audioBuffer\r\n  }\r\n\r\n  // create a buffer, plop in data, connect and play -> modify graph here if required\r\n  // detune:0,,  playbackRate:1\r\nexport const playTrack = (audioBuffer, offset=0, destination=delayNode, options={ loop:false } ) => {\r\n\t\r\n\treturn new Promise((resolve, reject)=>{\r\n\r\n\t\tconst trackSource = audioContext.createBufferSource()\r\n\t\ttrackSource.buffer = audioBuffer\r\n\t\t\r\n\t\t// loop through options nad add\r\n\t\t// options\r\n\t\ttrackSource.loop = options.loop\r\n\t\t// trackSource.detune = options.detune\r\n\t\t//trackSource.playbackRate = options.playbackRate\r\n\r\n\t\ttrackSource.connect(destination)\r\n\t\t// trackSource.connect(audioContext.destination)\r\n\t\t// console.error(\"Playing track\", {audioBuffer,trackSource} )\r\n\r\n\t\t// https://developer.mozilla.org/en-US/docs/Web/API/AudioScheduledSourceNode\r\n\t\t// FIXME: when it has finished playing remove it...\r\n\t\t// trackSource.addEventListener()\r\n\t\ttrackSource.onended = () => {\r\n\t\t\ttrackSource.disconnect()\r\n\t\t\tactive = false\r\n\t\t\tresolve()\r\n\t\t}\r\n\t\ttrackSource.onerror = (error) => {\r\n\t\t\ttrackSource.disconnect()\r\n\t\t\tactive = false\r\n\t\t\treject(error)\r\n\t\t}\r\n\r\n\t\tif (audioContext.state === 'suspended') \r\n\t\t{\r\n\t\t\taudioContext.resume()\r\n\t\t}\r\n\t\t\r\n\t\tif (offset == 0) \r\n\t\t{\r\n\t\t\ttrackSource.start()\r\n\t\t//offset = audioContext.currentTime\r\n\t\t} else {\r\n\t\t\ttrackSource.start(0, audioContext.currentTime - offset)\r\n\t\t}\r\n\t\tactive = true\r\n\t})\r\n}\r\n\r\n// const track = await loadAudio()\r\n// const r = playTrack(track)\r\n\r\nasync function loadInstrumentPart (instrumentName, part) {\r\n\treturn new Promise((resolve,reject)=>{\r\n\t\tconst path = `${instrumentName}/${part}`\r\n\t\tconst audio = new Audio()\r\n\r\n\t\tconst resolution = event => {\r\n\t\t\tdisconnect()\r\n\t\t\tresolve( audio )\r\n\t\t}\r\n\t\tconst failure = event =>{\r\n\t\t\tdisconnect()\r\n\t\t\treject(event.error)\r\n\t\t} \r\n\r\n\t\tconst connect = ()=>{\r\n\t\t\taudio.addEventListener('canplaythrough',resolution)\r\n\t\t\taudio.addEventListener('error', failure)\r\n\t\t}\r\n\t\tconst disconnect = ()=>{\r\n\t\t\taudio.removeEventListener('error',failure)\r\n\t\t\taudio.removeEventListener('canplaythrough',resolution)\r\n\t\t}\r\n\r\n\t\tconnect()\r\n\t\taudio.src = path\r\n\t})\r\n}\r\n\r\nconst createInstrumentBanks = (fileTye=\"mp3\", dot=\".\")=>{\r\n\r\n\tconst bank = []\r\n\tfor (let b=0; b<BANKS.length;++b)\r\n\t{\r\n\t\tconst key = BANKS[b]\r\n\t\t// insert a 0 for A\r\n\t\tif (key===\"A\")\r\n\t\t{\r\n\t\t\tbank.push( `A0${dot}${fileTye}` )\r\n\t\t}\r\n\t\tfor (let i=1; i<8; ++i)\r\n\t\t{\r\n\t\t\tbank.push( `${key}${i}${dot}${fileTye}` )\r\n\t\t}\r\n\t\t// add an extra one for C\r\n\t\tif (key===\"C\")\r\n\t\t{\r\n\t\t\tbank.push( `C8${dot}${fileTye}` )\r\n\t\t}\r\n\t}\r\n\treturn bank\r\n\t\r\n\t// A0-7\r\n\t// Ab1-7\r\n\t// B0-7\r\n\t// Bb1-Bb7\r\n\t// C1-C8\r\n\t// D1-7\r\n\t// Db1-7\r\n\t// E1-7\r\n\t// Eb1-7\r\n\t// F1-7\r\n\t// G1-7\r\n\t// Gb1-7\r\n}\r\n\r\nexport const NOTE_NAMES = createInstrumentBanks('','')\r\n\r\n// this is an object with the keys being the NOTE_NAMES\r\nconst NOTE_NAMES_FRIENDLY = {}\r\n\r\nNOTE_NAMES.forEach( note => {\r\n\t// for each name we do a clever thing innit...\r\n\tNOTE_NAMES_FRIENDLY[note] = note\r\n} )\r\n\r\n// console.error({BANKS, NOTE_NAMES, NOTE_NAMES_FRIENDLY})\r\n\r\n \r\n// octaves 1-7\r\nexport const getNoteName = (percent, octave=3, isMinor=false) => {\r\n\r\n\t// restrict to 1-7 even though 0 is available for many\r\n\t// octave = clamp(octave, 1, 7)\r\n\tlet noteNumber\r\n\tlet noteName\r\n\t\r\n\tif (isMinor)\r\n\t{\r\n\t\tnoteNumber = Math.floor( percent * (NOTES_BLACK.length-1) )\r\n\t\tnoteName = NOTES_BLACK[noteNumber]\r\n\t}else{\r\n\t\tnoteNumber = Math.floor( percent * (NOTES_WHITE.length-1) )\r\n\t\tnoteName = NOTES_WHITE[noteNumber]\r\n\t}\r\n\r\n\t// here is where we need to do our majic\r\n\t// const BANKS = [\"A\",\"Ab\",\"B\",\"Bb\",\"C\",\"D\", \"Db\",\"E\", \"Eb\", \"F\", \"G\",\"Gb\"]\r\n\t// play a note from bank (this is the same for every octave?)\r\n\t// const noteNumber = Math.floor( percent * (BANKS.length-1) )\r\n\t\r\n\t// console.log(\"Creating note\", {percent, octave, isMinor, noteNumber, noteName} )\r\n\t// const noteNumber = Math.floor( percent * (NOTE_NAMES.length-1) )\r\n\t// const noteNumber = Math.floor( percent * (NOTE_NAMES.length-1) )\r\n\t// const noteNumber = Math.floor( lipPercentage * (INSTRUMENT_NAMES.length-1) )\r\n\t// const noteName = NOTE_NAMES[noteNumber]\r\n\r\n\t// just in case the note name is not found?\r\n\treturn `${noteName}${clamp(octave, 1, 7)}`\r\n\t// return noteName ? `${noteName}${clamp(octave, 1, 7)}` : `A0`\r\n}\r\n\r\n\r\nexport const loadInstrumentParts = (instrumentName=\"alto_sax-mp3\", path=\"./FluidR3_GM\") => {\r\n\r\n\tconst instrumentPath = `${path}/${instrumentName}`\r\n\tconst parts = createInstrumentBanks()\r\n\t// console.error(\"parts\",parts)\r\n\t// array of buffers to pass to playTrack\r\n\tconst instruments = parts.map( part => loadAudio( `${instrumentPath}/${part}` ) )\r\n\t//const instruments = parts.map( part => loadInstrumentPart(instrumentPath, part) )\r\n\t// eg FluidR3_GM\r\n\t// array of promises\r\n\treturn instruments\r\n}\r\n\r\n\r\nexport const loadInstrument = async (instrumentName=\"alto_sax-mp3\", path=\"./FluidR3_GM\", progressCallback ) => {\r\n\t\r\n\tconst output = {\r\n\t\ttitle:cleanTitle(instrumentName),\r\n\t\tname:instrumentName,\r\n\t}\r\n\t// progressCallback?\r\n\tconst parts = await Promise.all( loadInstrumentParts(instrumentName, path) )\r\n\tNOTE_NAMES.forEach( (instrument, index) => {\r\n\t\toutput[ instrument.split('.')[0] ] = parts[index]\r\n\t})\r\n\treturn output\r\n}\r\n\r\n\r\n// If audio data available then push  it to the chunk array \r\nexport const record = (stream)=>{\r\n\tlet recording = false\r\n\tlet dataArray\r\n\r\n\tconst startRecording = stream => {\r\n\r\n\t\treturn new Promise((resolve,reject)=>{\r\n\t\t\t\r\n\t\t\tif (recording)\r\n\t\t\t{\r\n\t\t\t\treturn reject(\"already recording\")\r\n\t\t\t}\r\n\r\n\t\t\tdataArray = []\r\n\t\t\t\r\n\t\t\tmediaRecorder = new MediaRecorder(stream)\r\n\t\t\tmediaRecorder.ondataavailable = (ev) =>{ \r\n\t\t\t\tdataArray.push(ev.data)\r\n\t\t\t\tresolve({mediaRecorder,dataArray,stream})\r\n\t\t\t}\r\n\r\n\t\t\tmediaRecorder.onwarning = function(e) {\r\n\t\t\t\tconsole.log('onwarning fired')\r\n\t\t\t  }\r\n\t\t\t\r\n\t\t\t  mediaRecorder.onerror = (error) => {\r\n\t\t\t\tconsole.log('onerror fired')\r\n\t\t\t\tswitch(error.name) {\r\n\t\t\t\t\tcase 'InvalidState':\r\n\t\t\t\t\t\tbreak;\r\n\t\t\r\n\t\t\t\t\tcase 'OutOfMemory':\r\n\t\t\t\t\t\tbreak;\r\n\t\t\r\n\t\t\t\t\tcase 'IllegalStreamModification':\r\n\t\t\t\t\t\tbreak;\r\n\t\t\r\n\t\t\t\t\tcase 'OtherRecordingError':\r\n\t\t\t\t\t\tbreak;\r\n\t\t\r\n\t\t\t\t\tcase 'GenericError':\r\n\t\t\t\t\t\tbreak;\r\n\t\t\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tconsole.error('MediaRecorder Error', error);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t  }\r\n\t\t\t// Convert the audio data in to blob  \r\n\t\t\t// after stopping the recording \r\n\t\t\tmediaRecorder.start()\r\n\t\t\trecording = true\t\r\n\t\t})\r\n\t}\r\n\r\n\tconst stopRecording = ( ) => {\r\n\t\treturn new Promise((resolve,reject)=>{\r\n\t\t\tif (!recording)\r\n\t\t\t{\r\n\t\t\t\treturn reject(\"Not recording\")\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tmediaRecorder.onstop = event => { \r\n\t\r\n\t\t\t\t// After fill up the chunk  \r\n\t\t\t\t// array make it empty \r\n\t\t\t\trecording = false\r\n\r\n\t\t\t\t// Pass the audio url to the 2nd video tag \r\n\t\t\t\tresolve( dataArray )\r\n\t\t\t}\r\n\t\t\tmediaRecorder.stop()\r\n\t\t})\r\n\t}\r\n\r\n\tconst encodeRecording = (recording, type='audio/mp3;') => {\r\n\r\n\t\t// 'audio': [\r\n\t\t// \t'audio/webm;codecs=opus',\r\n\t\t// \t'audio/webm',\r\n\t\t// \t'audio/ogg',\r\n\t\t// \t'audio/mp3',\r\n\t\t// \t'audio/wav'\r\n\t\t// ],\r\n\t\t// 'video': [\r\n\t\t// \t'video/webm;codecs=vp9',\r\n\t\t// \t'video/webm;codecs=vp8',\r\n\t\t// \t'video/webm;codecs=h264',\r\n\t\t// \t'video/webm;codecs=opus',\r\n\t\t// \t'video/webm',\r\n\t\t// \t'video/mp4',\r\n\t\t// \t'video/mpeg'\r\n\t\t// ]\r\n\t\tconst audioData = new Blob(recording, { 'type': type })\r\n\t\treturn audioData\r\n\t}\r\n\tconst looper = (blob) => {\r\n\t\tconst audioURL = window.URL.createObjectURL(blob)\r\n \t\tconst audio = document.createElement('audio')\r\n\t\taudio.setAttribute('controls', '')\r\n\t\taudio.src = audioURL;\r\n\t}\r\n\r\n\tconst downloadRecording = () => {\r\n\t\tvar blob = new Blob(recordedChunks, {\r\n\t\t  type: \"video/webm\"\r\n\t\t});\r\n\t\tvar url = URL.createObjectURL(blob);\r\n\t\tvar a = document.createElement(\"a\");\r\n\t\tdocument.body.appendChild(a);\r\n\t\ta.style = \"display: none\";\r\n\t\ta.href = url;\r\n\t\ta.download = \"test.webm\";\r\n\t\ta.click();\r\n\t\twindow.URL.revokeObjectURL(url);\r\n\t  }\r\n\r\n\tconst isAvailable = () => !!(window && window.MediaRecorder && typeof window.MediaRecorder.isTypeSupported === 'function' && window.Blob)\r\n\tconst isRecording = () => recording\r\n\r\n\treturn {isAvailable, downloadRecording, encodeRecording, startRecording,stopRecording, isRecording}\r\n} ","export const TAU = 2 * Math.PI\r\n\r\n// provide the value and a smallest and largest original then new sizes\r\nexport const rescale = (smallest, largest=1) => {\r\n    // find the scale and create a method that allows \r\n    // you to simply rescale at will\r\n    const range = 1 / ( largest - smallest )\r\n\r\n    return value => range * ( value - smallest )\r\n}\r\n\r\nexport const lerp = (start, end, amt) => (1-amt) * start + amt * end\r\n\r\nexport const clamp = (val, min, max) => val > max ? max : val < min ? min : val\r\n// Based on https://gist.github.com/gre/1650294\r\n\r\n// No easing, no acceleration\r\nexport const linear = t => t\r\n\r\n// Slight acceleration from zero to full speed\r\nexport const easeInSine = t  => -1 * Math.cos( t * ( Math.PI / 2 ) ) + 1\r\n\r\n// Slight deceleration at the end\r\nexport function easeOutSine( t ) {\r\n    return Math.sin( t * ( Math.PI / 2 ) )\r\n}\r\n\r\n// Slight acceleration at beginning and slight deceleration at end\r\nexport function easeInOutSine( t ) {\r\n    return -0.5 * ( Math.cos( Math.PI * t ) - 1 )\r\n}\r\n\r\n// Accelerating from zero velocity\r\nexport function easeInQuad( t ) {\r\n    return t * t\r\n}\r\n\r\n// Decelerating to zero velocity\r\nexport function easeOutQuad( t ) {\r\n    return t * ( 2 - t )\r\n}\r\n\r\n// Acceleration until halfway, then deceleration\r\nexport function easeInOutQuad( t ) {\r\n    return t < 0.5 ? 2 * t * t : - 1 + ( 4 - 2 * t ) * t\r\n}\r\n\r\n// Accelerating from zero velocity\r\nexport function easeInCubic( t ) {\r\n    return t * t * t\r\n}\r\n\r\n// Decelerating to zero velocity\r\nexport function easeOutCubic( t ) {\r\n    const t1 = t - 1\r\n    return t1 * t1 * t1 + 1\r\n}\r\n\r\n// Acceleration until halfway, then deceleration\r\nexport function easeInOutCubic( t ) {\r\n    return t < 0.5 ? 4 * t * t * t : ( t - 1 ) * ( 2 * t - 2 ) * ( 2 * t - 2 ) + 1\r\n}\r\n\r\n// Accelerating from zero velocity\r\nexport function easeInQuart( t ) {\r\n    return t * t * t * t\r\n}\r\n\r\n// Decelerating to zero velocity\r\nexport function easeOutQuart( t ) {\r\n    const t1 = t - 1\r\n    return 1 - t1 * t1 * t1 * t1\r\n}\r\n\r\n// Acceleration until halfway, then deceleration\r\nexport function easeInOutQuart( t ) {\r\n    const t1 = t - 1\r\n    return t < 0.5 ? 8 * t * t * t * t : 1 - 8 * t1 * t1 * t1 * t1\r\n}\r\n\r\n// Accelerating from zero velocity\r\nexport function easeInQuint( t ) {\r\n    return t * t * t * t * t\r\n}\r\n\r\n// Decelerating to zero velocity\r\nexport function easeOutQuint( t ) {\r\n    const t1 = t - 1\r\n    return 1 + t1 * t1 * t1 * t1 * t1\r\n}\r\n\r\n// Acceleration until halfway, then deceleration\r\nexport function easeInOutQuint( t ) {\r\n    const t1 = t - 1\r\n    return t < 0.5 ? 16 * t * t * t * t * t : 1 + 16 * t1 * t1 * t1 * t1 * t1\r\n}\r\n\r\n// Accelerate exponentially until finish\r\nexport function easeInExpo( t ) {\r\n\r\n    if( t === 0 ) {\r\n        return 0\r\n    }\r\n\r\n    return Math.pow( 2, 10 * ( t - 1 ) )\r\n\r\n}\r\n\r\n// Initial exponential acceleration slowing to stop\r\nexport function easeOutExpo( t ) {\r\n\r\n    if( t === 1 ) {\r\n        return 1\r\n    }\r\n\r\n    return ( -Math.pow( 2, -10 * t ) + 1 )\r\n\r\n}\r\n\r\n// Exponential acceleration and deceleration\r\nexport function easeInOutExpo( t ) {\r\n    \r\n    if( t === 0 || t === 1 ) {\r\n        return t\r\n    }\r\n\r\n    const scaledTime = t * 2\r\n    const scaledTime1 = scaledTime - 1\r\n\r\n    if( scaledTime < 1 ) {\r\n        return 0.5 * Math.pow( 2, 10 * ( scaledTime1 ) )\r\n    }\r\n\r\n    return 0.5 * ( -Math.pow( 2, -10 * scaledTime1 ) + 2 )\r\n\r\n}\r\n\r\n// Increasing velocity until stop\r\nexport function easeInCirc( t ) {\r\n\r\n    const scaledTime = t / 1\r\n    return -1 * ( Math.sqrt( 1 - scaledTime * t ) - 1 )\r\n\r\n}\r\n\r\n// Start fast, decreasing velocity until stop\r\nexport function easeOutCirc( t ) {\r\n\r\n    const t1 = t - 1\r\n    return Math.sqrt( 1 - t1 * t1 )\r\n\r\n}\r\n\r\n// Fast increase in velocity, fast decrease in velocity\r\nexport function easeInOutCirc( t ) {\r\n\r\n    const scaledTime = t * 2\r\n    const scaledTime1 = scaledTime - 2\r\n\r\n    if( scaledTime < 1 ) {\r\n        return -0.5 * ( Math.sqrt( 1 - scaledTime * scaledTime ) - 1 )\r\n    }\r\n\r\n    return 0.5 * ( Math.sqrt( 1 - scaledTime1 * scaledTime1 ) + 1 )\r\n\r\n}\r\n\r\n// Slow movement backwards then fast snap to finish\r\nexport function easeInBack( t, magnitude = 1.70158 ) {\r\n\r\n    return t * t * ( ( magnitude + 1 ) * t - magnitude )\r\n\r\n}\r\n\r\n// Fast snap to backwards point then slow resolve to finish\r\nexport function easeOutBack( t, magnitude = 1.70158 ) {\r\n\r\n    const scaledTime = ( t / 1 ) - 1\r\n    \r\n    return (\r\n        scaledTime * scaledTime * ( ( magnitude + 1 ) * scaledTime + magnitude )\r\n    ) + 1\r\n\r\n}\r\n\r\n// Slow movement backwards, fast snap to past finish, slow resolve to finish\r\nexport function easeInOutBack( t, magnitude = 1.70158 ) {\r\n\r\n    const scaledTime = t * 2\r\n    const scaledTime2 = scaledTime - 2\r\n\r\n    const s = magnitude * 1.525\r\n\r\n    if( scaledTime < 1) {\r\n\r\n        return 0.5 * scaledTime * scaledTime * (\r\n            ( ( s + 1 ) * scaledTime ) - s\r\n        )\r\n\r\n    }\r\n\r\n    return 0.5 * (\r\n        scaledTime2 * scaledTime2 * ( ( s + 1 ) * scaledTime2 + s ) + 2\r\n    )\r\n\r\n}\r\n// Bounces slowly then quickly to finish\r\nexport function easeInElastic( t, magnitude = 0.7 ) {\r\n\r\n    if( t === 0 || t === 1 ) {\r\n        return t\r\n    }\r\n\r\n    const scaledTime = t / 1\r\n    const scaledTime1 = scaledTime - 1\r\n\r\n    const p = 1 - magnitude\r\n    const s = p / ( 2 * Math.PI ) * Math.asin( 1 )\r\n\r\n    return -(\r\n        Math.pow( 2, 10 * scaledTime1 ) *\r\n        Math.sin( ( scaledTime1 - s ) * ( 2 * Math.PI ) / p )\r\n    )\r\n\r\n}\r\n\r\n// Fast acceleration, bounces to zero\r\nexport function easeOutElastic( t, magnitude = 0.7 ) {\r\n\r\n    const p = 1 - magnitude\r\n    const scaledTime = t * 2\r\n\r\n    if( t === 0 || t === 1 ) {\r\n        return t\r\n    }\r\n\r\n    const s = p / ( 2 * Math.PI ) * Math.asin( 1 )\r\n    return (\r\n        Math.pow( 2, -10 * scaledTime ) *\r\n        Math.sin( ( scaledTime - s ) * ( 2 * Math.PI ) / p )\r\n    ) + 1\r\n\r\n}\r\n\r\n// Slow start and end, two bounces sandwich a fast motion\r\nexport function easeInOutElastic( t, magnitude = 0.65 ) {\r\n\r\n    const p = 1 - magnitude\r\n\r\n    if( t === 0 || t === 1 ) {\r\n        return t\r\n    }\r\n\r\n    const scaledTime = t * 2\r\n    const scaledTime1 = scaledTime - 1\r\n    \r\n    const s = p / ( 2 * Math.PI ) * Math.asin( 1 )\r\n\r\n    if( scaledTime < 1 ) {\r\n        return -0.5 * (\r\n            Math.pow( 2, 10 * scaledTime1 ) *\r\n            Math.sin( ( scaledTime1 - s ) * ( 2 * Math.PI ) / p )\r\n        )\r\n    }\r\n\r\n    return (\r\n        Math.pow( 2, -10 * scaledTime1 ) *\r\n        Math.sin( ( scaledTime1 - s ) * ( 2 * Math.PI ) / p ) * 0.5\r\n    ) + 1\r\n\r\n}\r\n\r\n// Bounce to completion\r\nexport function easeOutBounce( t ) {\r\n\r\n    const scaledTime = t / 1\r\n\r\n    if( scaledTime < ( 1 / 2.75 ) ) {\r\n\r\n        return 7.5625 * scaledTime * scaledTime\r\n\r\n    } else if( scaledTime < ( 2 / 2.75 ) ) {\r\n\r\n        const scaledTime2 = scaledTime - ( 1.5 / 2.75 )\r\n        return ( 7.5625 * scaledTime2 * scaledTime2 ) + 0.75\r\n\r\n    } else if( scaledTime < ( 2.5 / 2.75 ) ) {\r\n\r\n        const scaledTime2 = scaledTime - ( 2.25 / 2.75 )\r\n        return ( 7.5625 * scaledTime2 * scaledTime2 ) + 0.9375\r\n\r\n    } else {\r\n\r\n        const scaledTime2 = scaledTime - ( 2.625 / 2.75 )\r\n        return ( 7.5625 * scaledTime2 * scaledTime2 ) + 0.984375\r\n\r\n    }\r\n\r\n}\r\n\r\n// Bounce increasing in velocity until completion\r\nexport function easeInBounce( t ) {\r\n    return 1 - easeOutBounce( 1 - t )\r\n}\r\n\r\n// Bounce in and bounce out\r\nexport function easeInOutBounce( t ) {\r\n\r\n    if( t < 0.5 ) {\r\n\r\n        return easeInBounce( t * 2 ) * 0.5\r\n        \r\n    }\r\n\r\n    return ( easeOutBounce( ( t * 2 ) - 1 ) * 0.5 ) + 0.5\r\n\r\n}","export const CMD_START = \"start\"\r\nexport const CMD_STOP  = \"stop\"\r\nexport const CMD_UPDATE  = \"update\"\r\n\r\nexport const EVENT_READY = \"ready\"\r\nexport const EVENT_STARTING = \"starting\"\r\nexport const EVENT_STOPPING = \"stopping\"\r\nexport const EVENT_TICK = \"tick\"\r\n\r\nexport const MAX_BARS_ALLOWED = 32\r\n\r\nconst AudioContext = window.AudioContext || window.webkitAudioContext\r\n\r\n// Load in the correct worker...timing.requestframe.worker.js\r\n// const timingWorker = new Worker(\"data-url:./timing.setinterval.worker.js\") \r\n// const timingWorker = new Worker(\"data-url:./timing.settimeout.worker.js\") \r\nconst timingWorker = new Worker(\"data-url:./timing.requestframe.worker.js\")\r\n\r\nlet startTime = -1\r\nlet currentInterval = 1\r\nlet audioContext = null\r\nlet isRunning = false\r\n\r\n// for time formatting...\r\nlet bar = 0\r\nlet bars = 16\r\nlet barsElapsed = 0\r\n\r\n// time sig\r\nexport const timePerBar = () => 2403 / bars\r\nexport const getBar = () => bar\r\n\r\nexport const getBPM = () => 60000 / timePerBar()\r\nexport const getBars = () => bars \r\nexport const setBars = value => {\r\n    bars = value < 1 ? 1 : value > MAX_BARS_ALLOWED ? MAX_BARS_ALLOWED : value\r\n    return bars\r\n}\r\n\r\nexport const now = () => audioContext.currentTime\r\n\r\nconst elapsed = () => (now() - startTime) * 0.001\r\n\r\n// export const setMode = newMode => {\r\n//     // check to see if in array of acceptable types\r\n//     mode = newMode\r\n//     timingWorker = new Worker(`${prefix}/timing.${mode}.worker.js`)\r\n//     // TODO: restart if running\r\n//    // console.error(\"Changing mode\",mode, timingWorker)\r\n//     if (isRunning)\r\n//     {\r\n//         // \r\n//     }\r\n// }\r\n\r\nexport const setTimeBetween = time => {\r\n    currentInterval = time\r\n    // if it is running, stop and restart it?\r\n     //interval = newInterval\r\n    // TODO\r\n    // FIXME\r\n    timingWorker.postMessage({command:CMD_UPDATE, interval:currentInterval, time:now() })\r\n    return currentInterval\r\n}\r\n\r\nexport const start = (callback, timeBetween=200, options={} ) => {\r\n\r\n    barsElapsed = 0\r\n\r\n    // lazily initialise a context\r\n    if (audioContext === null)\r\n    {\r\n        audioContext = new AudioContext()\r\n        // on Safari macOS/iOS, the audioContext is suspended if it's not created\r\n        // in the event handler of a user action: we attempt to resume it.\r\n        if (audioContext.state === 'suspended') {\r\n            audioContext.resume()\r\n        }\r\n    }\r\n\r\n    currentInterval = timeBetween\r\n\r\n    if (!isRunning)\r\n    {\r\n        // \r\n    }\r\n   \r\n    // now hook into our worker bee and watch for timing changes\r\n    timingWorker.onmessage = (e) => {\r\n\r\n        const currentTime = now()\r\n        const data = e.data\r\n        switch(data.event)\r\n        {\r\n            case EVENT_STARTING:\r\n                const time = data.time\r\n                // save start time\r\n                startTime = currentTime\r\n                isRunning = true\r\n                //console.log(\"EVENT_STARTING\", {time, startTime})\r\n                break\r\n\r\n            case EVENT_TICK:\r\n                // How many ticks have occured yet\r\n                const intervals = data.intervals\r\n                // Expected time stamp\r\n                const expected = intervals * timeBetween * 0.001\r\n                // How long has elapsed according to audio context\r\n                const elapsed = currentTime - startTime\r\n                // How long has elapsed according to our worker\r\n                const timePassed = data.time\r\n                // how much spill over the expected timestamp is there\r\n                const lag = timePassed % timeBetween * 0.001\r\n                // should be 0 if the timer is working...\r\n                const drift = timePassed - elapsed\r\n                // deterministic intervals not neccessary\r\n                const level = Math.floor(timePassed / timeBetween)\r\n                \r\n                bar = ++barsElapsed % bars\r\n\t\t\t\t\r\n                // elapsed should === time\r\n                //console.log(\"EVENT_TICK\", {timePassed, elapsed, drift, art})\r\n                callback && callback({bar, bars, barsElapsed, timePassed, elapsed, expected, drift, level, intervals, lag})\r\n                // timingWorker.postMessage({command:CMD_UPDATE, time:currentTime, interval})\r\n                break\r\n\r\n            default:\r\n                console.log(\"message: \" , e)\r\n        }\r\n    }\r\n\r\n    // Error!\r\n    timingWorker.onerror = error =>{\r\n        console.error(\"error...\", {error} )\r\n        timingWorker.postMessage({error, time:audioContext.currentTime })\r\n    }\r\n\r\n    // send command to worker... options\r\n    timingWorker.postMessage({\r\n        command:CMD_START, \r\n        time:audioContext.currentTime, \r\n        interval:timeBetween,\r\n        // FIXME:\r\n        accurateTiming:false\r\n    })\r\n    //console.log(\"Starting...\", {audioContext, interval:timeBetween, timingWorker} )\r\n\r\n    // methods that can be chained?\r\n    return {\r\n        currentTime:now(),\r\n        timingWorker\r\n    }\r\n}\r\n\r\n\r\nexport const stop = () => {\r\n    const currentTime = now()\r\n    // cancel the thing thrugh the workers first\r\n    // cancel any scheduled quie noises\r\n    timingWorker.onmessage = (e) => {\r\n        switch(e.event)\r\n        {\r\n            // Clean up\r\n            case EVENT_STOPPING:\r\n                // destroy contexts and unsubscribe from events\r\n                isRunning = false\r\n                audioContext = null\r\n                break\r\n        }\r\n    }\r\n\r\n    timingWorker.postMessage({command:CMD_STOP, time:currentTime})\r\n\r\n    return {\r\n        currentTime:now(),\r\n        timingWorker\r\n    }\r\n}",null,"\r\nimport {audioContext, inputDryNode} from './audio'\r\n\r\nconst ZERO = 0.0000001\r\n\r\n// this is just an array of kicks\r\nexport const createQueue = (factorymethod, quantity=5) => {\r\n\r\n\tconst instruments = []\r\n\tfor (let i=0; i < quantity; ++i)\r\n\t{\r\n\t\tconst instrument = factorymethod()\r\n\t\tinstruments.push( instrument )\r\n\t}\r\n\r\n\t// interface to play\r\n\tlet index = 0\r\n\tconst fetchNextInstrument = (...args) => {\r\n\t\tindex = index + 1 < quantity ? index + 1 : 0\r\n\t\tconst instrument = instruments[index]\r\n\t\tinstrument(...args)\r\n\t\t//instrument.apply(null, arguments)\r\n\t}\r\n\treturn fetchNextInstrument\r\n}\r\n\r\n// Kick me\r\nexport const createKick = () => {\r\n\r\n    const osc = audioContext.createOscillator()\r\n    const osc2 = audioContext.createOscillator()\r\n    const gainOsc = audioContext.createGain()\r\n    const gainOsc2 = audioContext.createGain()\r\n\r\n    osc.type = \"triangle\"\r\n    osc2.type = \"sine\"\r\n\r\n\tconst kick = (velocity=1, length=0.05, attack=0.01, duration=0.5) => {\r\n\r\n\t\tconst time = audioContext.currentTime\r\n\t\t\r\n\t\t// clear anything from previous plays\r\n\t\tgainOsc.gain.cancelScheduledValues(time)\r\n\t\tgainOsc2.gain.cancelScheduledValues(time)\r\n\t\tosc.frequency.cancelScheduledValues(time)\r\n\t\tosc2.frequency.cancelScheduledValues(time)\r\n\r\n\t\tgainOsc.gain.setValueAtTime(1, time)\r\n\t\tgainOsc.gain.exponentialRampToValueAtTime(ZERO, time + length)\r\n\t\r\n\t\tgainOsc2.gain.setValueAtTime(1, audioContext.currentTime)\r\n\t\tgainOsc2.gain.exponentialRampToValueAtTime(ZERO, time + length)\r\n\t\r\n\t\tosc.frequency.setValueAtTime(120, audioContext.currentTime)\r\n\t\tosc.frequency.exponentialRampToValueAtTime(attack, time + length)\r\n\t\r\n\t\tosc2.frequency.setValueAtTime(50, audioContext.currentTime)\r\n\t\tosc2.frequency.exponentialRampToValueAtTime(attack, time + length)\r\n\t\t \r\n\t\t try{\r\n\r\n\t\t\tosc.start(time)\r\n\t\t\tosc2.start(time)\r\n\r\n\t\t }catch(error)\r\n\t\t {\r\n\r\n\t\t }\r\n\t \r\n\t\t//  osc.stop(audioContext.currentTime + duration)\r\n\t\t//  osc2.stop(audioContext.currentTime + duration)\r\n\t}\r\n \r\n    osc.connect(gainOsc)\r\n    osc2.connect(gainOsc2)\r\n    gainOsc.connect(inputDryNode())\r\n    gainOsc2.connect(inputDryNode())\r\n\r\n\treturn kick\r\n}\r\n\r\n// export const createKicks = (quantity=5) => {\r\n\r\n// \tconst kicks = []\r\n// \tfor (let i=0; i < quantity; ++i)\r\n// \t{\r\n// \t\tconst kick = createKick()\r\n// \t\tkicks.push( kick )\r\n// \t}\r\n\r\n// \t// interface to play\r\n// \tlet index = 0\r\n// \tconst fetchNextKick = (attack=0.01,duration=0.5) => {\r\n// \t\tindex = index + 1 < quantity ? index + 1 : 0\r\n// \t\tconst kick = kicks[index]\r\n// \t\tkick(attack, duration)\r\n// \t}\r\n// \treturn fetchNextKick\r\n// }\r\n\r\nexport const createSnare = () => {\r\n\r\n    const osc3 = audioContext.createOscillator()\r\n    const gainOsc3 = audioContext.createGain()\r\n    const filterGain = audioContext.createGain()\r\n\tconst noise = audioContext.createBufferSource()\r\n\tconst buffer = audioContext.createBuffer(1, 4096, audioContext.sampleRate)\r\n\r\n\tconst filter = audioContext.createBiquadFilter()\r\n\tfilter.type = \"highpass\"\r\n\r\n\tosc3.type = \"triangle\"\r\n\tosc3.frequency.value = 100\r\n\r\n\t// TODO Cache the noise\r\n\tconst data = buffer.getChannelData(0)\r\n\tfor (var i = 0; i < 4096; i++) \r\n\t{\r\n\t\tdata[i] = Math.random()\r\n\t}\r\n\r\n\tnoise.buffer = buffer\r\n\tnoise.loop = true\r\n\t\r\n\tosc3.connect(gainOsc3)\r\n\tgainOsc3.connect(inputDryNode() )\t\r\n\r\n\tnoise.connect(filter)\r\n\tfilter.connect(filterGain)\r\n\tfilterGain.connect(inputDryNode() )\r\n\r\n\tconst snare = (velocity=1, length = 0.2) => {\r\n\r\n\t\tconst time = audioContext.currentTime\r\n\t\t\r\n\t\tfilterGain.gain.cancelScheduledValues(time)\r\n\t\tfilterGain.gain.setValueAtTime(1, time)\r\n\t\tfilterGain.gain.exponentialRampToValueAtTime(ZERO, time + length)\r\n\t\r\n\t\tgainOsc3.gain.cancelScheduledValues(time)\r\n\t\tgainOsc3.gain.setValueAtTime(ZERO, time)\r\n\t\tgainOsc3.gain.exponentialRampToValueAtTime(ZERO, time + (length / 2 ) )\t\r\n\t\t//gainOsc3.gain.value = 0\r\n\r\n\t\t// modulate and filter freqs\r\n\t\tfilter.frequency.cancelScheduledValues(time)\r\n\t\tfilter.frequency.setValueAtTime(100, time)\r\n\t\tfilter.frequency.linearRampToValueAtTime(1000,time + length)\t\t\r\n\t\r\n\t\t//gainNode.gain.value = 1\t\t\t\r\n\t\ttry{\r\n\t\t\tosc3.start(time)\r\n\t\t\t//osc3.stop(audioContext.currentTime + 0.2)\r\n\t\t\r\n\t\t\tnoise.start(time)\r\n\r\n\t\t\t//node.stop(audioContext.currentTime + 0.2)\t\r\n\t\t}catch(error){\r\n\r\n\t\t}\r\n\t}\r\n\r\n\treturn snare\r\n}\r\n\r\nexport const createHihat = () => {\r\n\r\n    const gainOsc4 = audioContext.createGain()\r\n    const fundamental = 40\r\n    const ratios = [2, 3, 4.16, 5.43, 6.79, 8.21]\r\n\r\n    const bandpass = audioContext.createBiquadFilter()\r\n    bandpass.type = \"bandpass\"\r\n    bandpass.frequency.value = 10000\r\n\r\n    const highpass = audioContext.createBiquadFilter()\r\n    highpass.type = \"highpass\"\r\n    highpass.frequency.value = 7000\r\n\r\n    const oscillators = ratios.map((ratio) => {\r\n\r\n        const osc4 = audioContext.createOscillator()\r\n        osc4.type = \"square\"\r\n\t\tosc4.frequency.value = fundamental * ratio\r\n\t\tosc4.connect(bandpass)\r\n\t\treturn osc4\r\n    })\r\n\r\n\tbandpass.connect(highpass)\r\n    highpass.connect(gainOsc4)\r\n\tgainOsc4.connect(inputDryNode())\r\n\t\r\n\tconst hihat = (velocity=1, length=0.05 )=>{\r\n\t\tconst time = audioContext.currentTime\r\n\t\t\r\n\t\t// clear anything from previous plays\r\n\t\tgainOsc4.gain.cancelScheduledValues(time)\r\n\t\toscillators.forEach( oscillator => oscillator.frequency.cancelScheduledValues(time) )\r\n\t\t\r\n\t\t// set neew envelopes\r\n\t\tgainOsc4.gain.setValueAtTime(1, time)\r\n\t\tgainOsc4.gain.exponentialRampToValueAtTime(ZERO, time + length)\r\n\t\t\r\n\t\ttry{\r\n\t\t\toscillators.forEach( oscillator => oscillator.start(time) )\r\n\t\t\r\n\t\t\t//osc4.stop(time + 0.05)  \t\t\t\r\n\t\t}catch(error){\r\n\r\n\t\t}\r\n\t}\r\n\treturn hihat\r\n}\r\n\r\nexport const createClack = () => {\r\n\t\r\n\tconst cowbellGainNode = audioContext.createGain()\r\n \r\n    const bandpass = audioContext.createBiquadFilter()\r\n    bandpass.type = \"bandpass\"\r\n    bandpass.frequency.value = 2640\r\n    bandpass.Q.value = 3.5\r\n\r\n    const highpass = audioContext.createBiquadFilter()\r\n    highpass.type = \"highpass\"\r\n    highpass.frequency.value = 7000\r\n\r\n\tconst fundamental = 1\r\n    const ratios = [587,845]\r\n\r\n    const oscillators = ratios.map((ratio) => {\r\n\r\n        const oscillator = audioContext.createOscillator()\r\n        oscillator.type = \"triangle\"\r\n\t\toscillator.frequency.value = fundamental * ratio\r\n\t\toscillator.connect(bandpass)\r\n\t\treturn oscillator\r\n    })\r\n\r\n\tbandpass.connect(highpass)\r\n    highpass.connect(cowbellGainNode)\r\n\tcowbellGainNode.connect(inputDryNode())\r\n\t\r\n\tconst clack = (velocity=1, length=0.05, ocatave=fundamental )=>{\r\n\t\tconst time = audioContext.currentTime\r\n\t\t\r\n\t\t// clear anything from previous plays\r\n\t\tcowbellGainNode.gain.cancelScheduledValues(time)\r\n\t\toscillators.forEach( (oscillator,i) =>{ \r\n\t\t\toscillator.frequency.cancelScheduledValues(time) \r\n\t\t\toscillator.frequency.value = ocatave * ratios[i]\r\n\t\t})\r\n\t\t\r\n\t\t// set neew envelopes\r\n\t\tcowbellGainNode.gain.setValueAtTime(1, time)\r\n\t\tcowbellGainNode.gain.exponentialRampToValueAtTime(ZERO, time + length)\r\n\t\t\r\n\t\ttry{\r\n\t\t\toscillators.forEach( oscillator => oscillator.start(time) )\r\n\t\t\r\n\t\t\t//osc4.stop(time + 0.05)  \t\t\t\r\n\t\t}catch(error){\r\n\r\n\t\t}\r\n\t}\r\n\treturn clack\r\n}\r\n\r\nexport const createCowbell = () => {\r\n\t\r\n\tconst cowbellGainNode = audioContext.createGain()\r\n \r\n    const bandpass = audioContext.createBiquadFilter()\r\n    bandpass.type = \"bandpass\"\r\n    bandpass.frequency.value = 2640\r\n    bandpass.Q.value = 3.5\r\n\r\n\tconst fundamental = 1\r\n    const ratios = [587,845]\r\n\r\n    const oscillators = ratios.map((ratio) => {\r\n\r\n        const oscillator = audioContext.createOscillator()\r\n        oscillator.type = \"triangle\"\r\n\t\toscillator.frequency.value = fundamental * ratio\r\n\t\toscillator.connect(bandpass)\r\n\t\treturn oscillator\r\n    })\r\n\r\n\tbandpass.connect(cowbellGainNode)\r\n\tcowbellGainNode.connect(inputDryNode())\r\n\t\r\n\tconst cowbell = (velocity=1, length=0.05 )=>{\r\n\t\tconst time = audioContext.currentTime\r\n\t\t\r\n\t\t// clear anything from previous plays\r\n\t\tcowbellGainNode.gain.cancelScheduledValues(time)\r\n\t\toscillators.forEach( oscillator => oscillator.frequency.cancelScheduledValues(time) )\r\n\t\t\r\n\t\t// set neew envelopes\r\n\t\tcowbellGainNode.gain.setValueAtTime(1, time)\r\n\t\tcowbellGainNode.gain.exponentialRampToValueAtTime(ZERO, time + length)\r\n\t\t\r\n\t\ttry{\r\n\t\t\toscillators.forEach( oscillator => oscillator.start(time) )\r\n\t\t\r\n\t\t\t//osc4.stop(time + 0.05)  \t\t\t\r\n\t\t}catch(error){\r\n\r\n\t\t}\r\n\t}\r\n\treturn cowbell\r\n}\r\n\r\n// this is just an array of kicks\r\nexport const createKicks = (quantity=2) => createQueue(createKick, quantity)\r\nexport const createSnares = (quantity=3) => createQueue(createSnare, quantity)\r\nexport const createHihats = (quantity=3) => createQueue(createHihat, quantity)\r\nexport const createCowbells = (quantity=2) => createQueue(createCowbell, quantity)\r\nexport const createClacks = (quantity=2) => createQueue(createClack, quantity)\r\n\r\n// Just a drum kit you can play that has one of each of the\r\n// drum sounds set up in cascades. simply createDrumkit().kick() etc\r\nexport const createDrumkit = () => {\r\n\r\n\tconst kick = createKicks()\r\n\tconst hat = createHihats()\r\n\tconst snare = createSnares()\r\n\tconst cowbell = createCowbell()\r\n\tconst clack = createClack()\r\n\r\n\treturn {\r\n\t\tkick,\r\n\t\tsnare,\r\n\t\that,\r\n\t\tcowbell,\r\n\t\tclack\r\n\t}\r\n}\r\n\r\n// tODO : Bind pattern to kit?","\r\n// import WebMidi, { InputEventNoteon, InputEventNoteoff } from \"webmidi\"\r\nimport {WebMidi} from \"../node_modules/webmidi/dist/webmidi.esm.js\"\r\n\r\nexport const setupMIDI = () => new Promise ( (resolve,reject) => {\r\n\t\r\n\tWebMidi.enable().then( ports => {\r\n\r\n\r\n\t\t//console.log(\"WebMidi enabled!\", ports, ports.outputs[0] , WebMidi.outputs[0], WebMidi.outputs[0] === ports.outputs[0] )\r\n\t\t// I / O change\r\n\t\t// console.log(WebMidi.inputs)\r\n\t\t// console.log(WebMidi.outputs)\r\n\r\n\t\tresolve(WebMidi)\r\n\t\t\r\n\t\t// Display the current time\r\n\t\t//   console.log(WebMidi.time)\r\n\t\t\r\n\t\t// Retrieving an output port/device using its id, name or index\r\n\t\t// midiChannel = WebMidi.getOutputById(\"123456789\")\r\n\t\t// midiChannel = WebMidi.getOutputByName(\"Axiom Pro 25 Ext Out\")\r\n\t\t// midiChannel = WebMidi.outputs[0]\r\n\r\n\t\t// if (midiChannel)\r\n\t\t// {\r\n\t\t// \t// Play a note on all channels of the selected output\r\n\t\t// \tmidiChannel.playNote(\"C3\");\r\n\r\n\t\t// \t// Play a note on channel 3\r\n\t\t// \tmidiChannel.playNote(\"Gb4\", 3);\r\n\r\n\t\t// \t// Play a chord on all available channels\r\n\t\t// \tmidiChannel.playNote([\"C3\", \"D#3\", \"G3\"]);\r\n\r\n\t\t// \t// Play a chord on channel 7\r\n\t\t// \tmidiChannel.playNote([\"C3\", \"D#3\", \"G3\"], 7);\r\n\r\n\t\t// \t// Play a note at full velocity on all channels)\r\n\t\t// \tmidiChannel.playNote(\"F#-1\", \"all\", {velocity: 1});\r\n\r\n\t\t// \t// Play a note on channel 16 in 2 seconds (relative time)\r\n\t\t// \tmidiChannel.playNote(\"F5\", 16, {time: \"+2000\"});\r\n\r\n\t\t// \t// Play a note on channel 1 at an absolute time in the future\r\n\t\t// \tmidiChannel.playNote(\"F5\", 16, {time: WebMidi.time + 3000});\r\n\r\n\t\t// \t// Play a note for a duration of 2 seconds (will send a note off message in 2 seconds). Also use\r\n\t\t// \t// a low attack velocity\r\n\t\t// \tmidiChannel.playNote(\"Gb2\", 10, {duration: 2000, velocity: 0.25});\r\n\r\n\t\t// \t// Stop a playing note on all channels\r\n\t\t// \tmidiChannel.stopNote(\"C-1\");\r\n\r\n\t\t// \t// Stopping a playing note on channel 11\r\n\t\t// \tmidiChannel.stopNote(\"F3\", 11);\r\n\r\n\t\t// \t// Stop a playing note on channel 11 and use a high release velocity\r\n\t\t// \tmidiChannel.stopNote(\"G8\", 11, {velocity: 0.9});\r\n\r\n\t\t// \t// Stopping a playing note in 2.5 seconds\r\n\t\t// \tmidiChannel.stopNote(\"Bb2\", 11, {time: \"+2500\"});\r\n\r\n\t\t// \t// Send polyphonic aftertouch message to channel 8\r\n\t\t// \tmidiChannel.sendKeyAftertouch(\"C#3\", 8, 0.25);\r\n\r\n\t\t// \t// Send pitch bend (between -1 and 1) to channel 12\r\n\t\t// \tmidiChannel.sendPitchBend(-1, 12);\r\n\r\n\t\t// \t// You can chain most method calls\r\n\t\t// \tmidiChannel.playNote(\"G5\", 12)\r\n\t\t// \t\t.sendPitchBend(-0.5, 12, {time: 400}) // After 400 ms.\r\n\t\t// \t\t.sendPitchBend(0.5, 12, {time: 800})  // After 800 ms.\r\n\t\t// \t\t.stopNote(\"G5\", 12, {time: 1200});    // After 1.2 s.\r\n\r\n\t\t// }\r\n\t}).catch(error=> reject(error))\r\n\r\n})","/**\n * WebMidi.js v3.0.0-alpha.2\n * A JavaScript library to kickstart your MIDI projects\n * https://webmidijs.org\n *\n * This build was generated on June 17th 2020.\n *\n *\n *\n * The MIT License (MIT)\n *\n * Copyright (c) 2015-2020, Jean-Philippe Côté\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of this software\n * and associated documentation files (the \"Software\"), to deal in the Software without restriction,\n * including without limitation the rights to use, copy, modify, merge, publish, distribute,\n * sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all copies or\n * substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT\n * NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\nclass e{constructor(e=!1){this.eventMap={},this.eventsSuspended=1==e;}addListener(n,r,i={}){if(\"string\"==typeof n&&n.length<1||n instanceof String&&n.length<1||\"string\"!=typeof n&&!(n instanceof String)&&n!==e.ANY_EVENT)throw new TypeError(\"The 'event' parameter must be a string or EventEmitter.ANY_EVENT.\");if(\"function\"!=typeof r)throw new TypeError(\"The callback must be a function.\");const s=new t(n,this,r,i);return this.eventMap[n]||(this.eventMap[n]=[]),i.prepend?this.eventMap[n].unshift(s):this.eventMap[n].push(s),s}addOneTimeListener(e,t,n={}){n.remaining=1,this.addListener(e,t,n);}static get ANY_EVENT(){return Symbol.for(\"Any event\")}hasListener(n,r){if(void 0===n)return !!(this.eventMap[e.ANY_EVENT]&&this.eventMap[e.ANY_EVENT].length>0)||Object.entries(this.eventMap).some(([,e])=>e.length>0);if(this.eventMap[n]&&this.eventMap[n].length>0){if(r instanceof t){return this.eventMap[n].filter(e=>e===r).length>0}if(\"function\"==typeof r){return this.eventMap[n].filter(e=>e.callback===r).length>0}return null==r}return !1}get eventNames(){return Object.keys(this.eventMap)}getListeners(e){return this.eventMap[e]||[]}suspendEvent(e){this.getListeners(e).forEach(e=>{e.suspended=!0;});}unsuspendEvent(e){this.getListeners(e).forEach(e=>{e.suspended=!1;});}getListenerCount(e){return this.getListeners(e).length}emit(t,...n){if(\"string\"!=typeof t&&!(t instanceof String))throw new TypeError(\"The 'event' parameter must be a string.\");if(this.eventsSuspended)return;let r=[],i=this.eventMap[e.ANY_EVENT]||[];return this.eventMap[t]&&(i=i.concat(this.eventMap[t])),i.forEach(e=>{if(e.suspended)return;let t=[...n];Array.isArray(e.arguments)&&(t=t.concat(e.arguments)),e.remaining>0&&(r.push(e.callback.apply(e.context,t)),e.count++),--e.remaining<1&&e.remove();}),r}removeListener(e,t,n={}){if(void 0===e)return void(this.eventMap={});if(!this.eventMap[e])return;let r=this.eventMap[e].filter(e=>t&&e.callback!==t||n.remaining&&n.remaining!==e.remaining||n.context&&n.context!==e.context);r.length?this.eventMap[e]=r:delete this.eventMap[e];}async waitFor(e,t={}){return t.duration=parseInt(t.duration),(isNaN(t.duration)||t.duration<=0)&&(t.duration=1/0),new Promise((n,r)=>{let i,s=this.addListener(e,()=>{clearTimeout(i),n();},{remaining:1});t.duration!==1/0&&(i=setTimeout(()=>{s.remove(),r(\"The duration expired before the event was emitted.\");},t.duration));})}get eventCount(){return Object.keys(this.eventMap).length}}class t{constructor(t,n,r,i={}){if(\"string\"!=typeof t&&!(t instanceof String)&&t!==e.ANY_EVENT)throw new TypeError(\"The 'event' parameter must be a string or EventEmitter.ANY_EVENT.\");if(!n)throw new ReferenceError(\"The 'target' parameter is mandatory.\");if(\"function\"!=typeof r)throw new TypeError(\"The 'callback' must be a function.\");void 0===i.arguments||Array.isArray(i.arguments)||(i.arguments=[i.arguments]),(i=Object.assign({context:n,remaining:1/0,arguments:void 0,duration:1/0},i)).duration!==1/0&&setTimeout(()=>this.remove(),i.duration),this.event=t,this.target=n,this.callback=r,this.context=i.context,this.remaining=parseInt(i.remaining)>=1?parseInt(i.remaining):1/0,this.count=0,this.arguments=i.arguments,this.suspended=!1;}remove(){this.target.removeListener(this.event,this.callback,{context:this.context,remaining:this.remaining});}}\n\n/**\n * The `InputChannel` class represents a single input MIDI channel (1-16) from a single input\n * device. This object is derived from the host's MIDI subsystem and cannot be instantiated\n * directly.\n *\n * All 16 `InputChannel` objects can be found inside the input's [channels]{@link Input#channels}\n * property.\n *\n * The `InputChannel` class extends the\n * [EventEmitter](https://djipco.github.io/djipevents/EventEmitter.html) class from the\n * [djipevents]{@link https://djipco.github.io/djipevents/index.html} module. This means\n * it also includes methods such as\n * [addListener()](https://djipco.github.io/djipevents/EventEmitter.html#addListener),\n * [removeListener()](https://djipco.github.io/djipevents/EventEmitter.html#removeListener),\n * [hasListener()](https://djipco.github.io/djipevents/EventEmitter.html#hasListener) and several\n * others. Check out the\n * [documentation for EventEmitter](https://djipco.github.io/djipevents/EventEmitter.html) for more\n * details.\n *\n * @param {Input} input The `Input` this channel belongs to\n * @param {number} number The MIDI channel's number (1-16)\n *\n * @fires InputChannel#midimessage\n *\n * @fires InputChannel#noteoff\n * @fires InputChannel#noteon\n * @fires InputChannel#keyaftertouch\n * @fires InputChannel#controlchange\n * @fires InputChannel#channelmode\n * @fires InputChannel#programchange\n * @fires InputChannel#channelaftertouch\n * @fires InputChannel#pitchbend\n *\n * @fires InputChannel#allnotesoff\n * @fires InputChannel#allsoundoff\n * @fires InputChannel#localcontrol\n * @fires InputChannel#monomode\n * @fires InputChannel#omnimode\n * @fires InputChannel#resetallcontrollers\n *\n * @since 3.0.0\n */\nclass InputChannel extends e {\n\n  constructor(input, number) {\n\n    super();\n\n    /**\n     * The {@link Input} this channel belongs to\n     * @type {Input}\n     */\n    this.input = input;\n\n    /**\n     * This channel's number (1-16)\n     * @type {number}\n     */\n    this.number = number;\n\n    // /**\n    //  * An array of the current NRPNs being constructed for this channel\n    //  *\n    //  * @private\n    //  *\n    //  * @type {string[]}\n    //  */\n    // this._nrpnBuffer = [];\n    //\n    // // Enable NRPN events by default\n    // this.nrpnEventsEnabled = true;\n\n  }\n\n  destroy() {\n    this.input = null;\n    this.number = null;\n    // this._nrpnBuffer = null;\n    // this._nrpnEventsEnabled = false;\n    this.removeListener();\n  }\n\n  /**\n   * @param e Event\n   * @protected\n   */\n  _parseEvent(e) {\n\n    // Extract data bytes (unless it's a sysex message)\n    let dataBytes = null;\n    if (e.data[0] !== wm.MIDI_SYSTEM_MESSAGES.sysex) dataBytes = e.data.slice(1);\n\n    /**\n     * Event emitted when a MIDI message of any kind is received by the `InputChannel`.\n     *\n     * @event InputChannel#midimessage\n     * @type {Object}\n     * @property {InputChannel} target The `InputChannel` that triggered the event.\n     * @property {Array} event.data The MIDI message as an array of 8 bit values.\n     * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n     * @property {number} event.statusByte The message's status byte.\n     * @property {?number[]} event.dataBytes The message's data bytes as an array of 0, 1 or 2\n     * integers. This will be null for `sysex` messages.\n     * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n     * milliseconds since the navigation start of the document).\n     * @property {string} type `\"midimessage\"`\n     */\n    let midiMessageEvent = {\n      target: this,\n      data: Array.from(e.data),\n      rawData: e.data,\n      statusByte: e.data[0],\n      dataBytes: dataBytes,\n      timestamp: e.timeStamp,\n      type: \"midimessage\"\n    };\n\n    this.emit(\"midimessage\", midiMessageEvent);\n\n    // Parse the event to see if its part of an NRPN sequence\n    // this._parseEventForNrpnMessage(e);\n\n    // Parse the inbound event for regular messages\n    this._parseEventForStandardMessages(e);\n\n  }\n\n  getStructuredMidiMessage(data) {\n\n    return {\n      command: data[0] >> 4,\n      data1: data.length > 1 ? data[1] : undefined,\n      data2: data.length > 2 ? data[2] : undefined\n    };\n\n  }\n\n  /**\n   * Parses channel events for standard (non-NRPN) events.\n   * @param e Event\n   * @private\n   */\n  _parseEventForStandardMessages(e) {\n\n    let {command, data1, data2} = this.getStructuredMidiMessage(e.data);\n\n    // Returned event\n    let event = {\n      target: this,\n      data: Array.from(e.data),\n      rawData: e.data,\n      timestamp: e.timeStamp\n    };\n\n    if (\n      command === wm.MIDI_CHANNEL_VOICE_MESSAGES.noteoff ||\n      (command === wm.MIDI_CHANNEL_VOICE_MESSAGES.noteon && data2 === 0)\n    ) {\n\n      /**\n       * Event emitted when a **note off** MIDI message has been received.\n       *\n       * @event InputChannel#noteoff\n       * @type {Object}\n       * @property {InputChannel} target The `InputChannel` that triggered the event.\n       * @property {Array} event.data The MIDI message as an array of 8 bit values.\n       * @property {Uint8Array} event.rawData The raw MIDI message as a `Uint8Array`.\n       * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"noteoff\"`\n       * @property {Object} note A {@link Note} object containing information such as note number,\n       * note name and octave.\n       * @property {number} release The release velocity expressed as a float between 0 and 1.\n       * @property {number} rawRelease The release velocity expressed as an integer (between 0 and\n       * 127).\n       */\n      event.type = \"noteoff\";\n      event.note = new Note(data1, {rawRelease: data2});\n      event.release = event.note.release;\n      event.rawRelease = event.note.rawRelease;\n\n    } else if (command === wm.MIDI_CHANNEL_VOICE_MESSAGES.noteon) {\n\n      /**\n       * Event emitted when a **note on** MIDI message has been received.\n       *\n       * @event InputChannel#noteon\n       * @type {Object}\n       * @property {InputChannel} target The `InputChannel` that triggered the event.\n       * @property {Array} event.data The MIDI message as an array of 8 bit values.\n       * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n       * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"noteon\"`\n       * @property {Object} note A {@link Note} object containing information such as note number,\n       * note name and octave.\n       * @property {number} attack The attack velocity expressed as a float between 0 and 1.\n       * @property {number} rawAttack The attack velocity expressed as an integer (between 0 and\n       * 127).\n       */\n      event.type = \"noteon\";\n      event.note = new Note(data1, {rawAttack: data2});\n      event.attack = event.note.attack;\n      event.rawAttack = event.note.rawAttack;\n\n    } else if (command === wm.MIDI_CHANNEL_VOICE_MESSAGES.keyaftertouch) {\n\n      /**\n       * Event emitted when a **key-specific aftertouch** MIDI message has been received.\n       *\n       * @event InputChannel#keyaftertouch\n       * @type {Object}\n       * @property {InputChannel} target The `InputChannel` that triggered the event.\n       * @property {Array} event.data The MIDI message as an array of 8 bit values.\n       * @property {Uint8Array} event.rawData The raw MIDI message as a `Uint8Array`.\n       * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"keyaftertouch\"`\n       * @property {Object} note A {@link Note} object containing information such as note number,\n       * note name and octave.\n       * @property {number} value The aftertouch amount expressed as a float between 0 and 1.\n       * @property {number} rawValue The aftertouch amount expressed as an integer (between 0 and\n       * 127).\n       */\n      event.type = \"keyaftertouch\";\n      event.note = new Note(data1);\n      event.value = data2 / 127;\n      event.rawValue = data2;\n\n    } else if (\n      command === wm.MIDI_CHANNEL_VOICE_MESSAGES.controlchange &&\n      data1 >= 0 && data1 <= 119\n    ) {\n\n      /**\n       * Event emitted when a **control change** MIDI message has been received.\n       *\n       * @event InputChannel#controlchange\n       * @type {Object}\n       * @property {InputChannel} target The `InputChannel` that triggered the event.\n       * @property {Array} event.data The MIDI message as an array of 8 bit values.\n       * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n       * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"controlchange\"`\n       * @property {Object} controller\n       * @property {Object} controller.number The number of the controller.\n       * @property {Object} controller.name The usual name or function of the controller.\n       * @property {number} value The value expressed as a float between 0 and 1.\n       * @property {number} rawValue The value expressed as an integer (between 0 and 127).\n       */\n      event.type = \"controlchange\";\n      event.controller = {\n        number: data1,\n        name: this.getCcNameByNumber(data1)\n      };\n      event.value = data2 / 127;\n      event.rawValue = data2;\n\n    } else if (\n      command === wm.MIDI_CHANNEL_VOICE_MESSAGES.channelmode &&\n      data1 >= 120 && data1 <= 127\n    ) {\n\n      /**\n       * Event emitted when a **channel mode** MIDI message has been received.\n       *\n       * @event InputChannel#channelmode\n       * @type {Object}\n       * @property {InputChannel} target The `InputChannel` that triggered the event.\n       * @property {Array} event.data The MIDI message as an array of 8 bit values.\n       * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n       * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"channelmode\"`\n       * @property {Object} controller\n       * @property {Object} controller.number The number of the controller.\n       * @property {Object} controller.name The usual name or function of the controller.\n       * @property {number} value The value expressed as a float between 0 and 1.\n       * @property {number} rawValue The value expressed as an integer (between 0 and 127).\n       */\n      event.type = \"channelmode\";\n      event.controller = {\n        number: data1,\n        name: this.getChannelModeByNumber(data1)\n      };\n      event.value = data2;\n\n      // Also dispatch specific channel mode events\n      this._parseChannelModeMessage(e);\n\n    } else if (command === wm.MIDI_CHANNEL_VOICE_MESSAGES.programchange) {\n\n      /**\n       * Event emitted when a **program change** MIDI message has been received.\n       *\n       * @event InputChannel#programchange\n       * @type {Object}\n       * @property {InputChannel} target The `InputChannel` that triggered the event.\n       * @property {Array} event.data The MIDI message as an array of 8 bit values.\n       * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n       * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"programchange\"`\n       * @property {number} value The value expressed as an integer between 1 and 128.\n       * @property {number} rawValue The value expressed as an integer between 0 and 127.\n       */\n      event.type = \"programchange\";\n      event.value = data1 + 1;\n      event.rawValue = data1;\n\n    } else if (command === wm.MIDI_CHANNEL_VOICE_MESSAGES.channelaftertouch) {\n\n      /**\n       * Event emitted when a control change MIDI message has been received.\n       *\n       * @event InputChannel#channelaftertouch\n       * @type {Object}\n       * @property {InputChannel} target The `InputChannel` that triggered the event.\n       * @property {Array} event.data The MIDI message as an array of 8 bit values.\n       * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n       * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"channelaftertouch\"`\n       * @property {number} value The value expressed as a float between 0 and 1.\n       * @property {number} rawValue The value expressed as an integer (between 0 and 127).\n       */\n      event.type = \"channelaftertouch\";\n      event.value = data1 / 127;\n      event.rawValue = data1;\n\n    } else if (command === wm.MIDI_CHANNEL_VOICE_MESSAGES.pitchbend) {\n\n      /**\n       * Event emitted when a pitch bend MIDI message has been received.\n       *\n       * @event InputChannel#pitchbend\n       * @type {Object}\n       * @property {InputChannel} target The `InputChannel` that triggered the event.\n       * @property {Array} event.data The MIDI message as an array of 8 bit values.\n       * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n       * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"pitchbend\"`\n       * @property {number} value The value expressed as a float between 0 and 1.\n       * @property {number} rawValue The value expressed as an integer (between 0 and 16383).\n       */\n      event.type = \"pitchbend\";\n      event.value = ((data2 << 7) + data1 - 8192) / 8192;\n      event.rawValue = (data2 << 7) + data1;\n\n    } else {\n      event.type = \"unknownmessage\";\n    }\n\n    this.emit(event.type, event);\n\n  }\n\n  /**\n   * Returns the channel mode name matching the specified number. If no match is found, the function\n   * returns `false`.\n   *\n   * @param {number} number An integer representing the channel mode message.\n   * @returns {string|false} The name of the matching channel mode or `false` if not match could be\n   * found.\n   *\n   * @since 2.0.0\n   */\n  getChannelModeByNumber(number) {\n\n    if (wm.validation) {\n      number = Math.floor(number);\n    }\n\n    if ( !(number >= 120 && number <= 127) ) return false;\n\n    for (let cm in wm.MIDI_CHANNEL_MODE_MESSAGES) {\n\n      if (\n        wm.MIDI_CHANNEL_MODE_MESSAGES.hasOwnProperty(cm) &&\n        number === wm.MIDI_CHANNEL_MODE_MESSAGES[cm]\n      ) {\n        return cm;\n      }\n\n    }\n\n  }\n\n  _parseChannelModeMessage(e) {\n\n    let data1, data2;\n\n    if (e.data.length > 1) {\n      data1 = e.data[1];\n      data2 = e.data.length > 2 ? e.data[2] : undefined;\n    }\n\n    // Basis for the returned event\n    let event = {\n      target: this,\n      data: Array.from(e.data),\n      rawData: e.data,\n      timestamp: e.timeStamp,\n      type: this.getChannelModeByNumber(data1)\n    };\n\n    /**\n     * Event emitted when an \"all sound off\" channel-mode MIDI message has been received.\n     *\n     * @event InputChannel#allsoundoff\n     * @type {Object}\n     * @property {InputChannel} target The `InputChannel` that triggered the event.\n     * @property {Array} event.data The MIDI message as an array of 8 bit values.\n     * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n     * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n     * milliseconds since the navigation start of the document).\n     * @property {string} type `\"allsoundoff\"`\n     */\n\n    /**\n     * Event emitted when a \"reset all controllers\" channel-mode MIDI message has been received.\n     *\n     * @event InputChannel#resetallcontrollers\n     * @type {Object}\n     * @property {InputChannel} target The `InputChannel` that triggered the event.\n     * @property {Array} event.data The MIDI message as an array of 8 bit values.\n     * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n     * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n     * milliseconds since the navigation start of the document).\n     * @property {string} type `\"resetallcontrollers\"`\n     */\n\n    /**\n     * Event emitted when a \"local control\" channel-mode MIDI message has been received. The value\n     * property of the event is set to either `true` (local control on) of `false` (local control\n     * off).\n     *\n     * @event InputChannel#localcontrol\n     * @type {Object}\n     * @property {InputChannel} target The `InputChannel` that triggered the event.\n     * @property {Array} event.data The MIDI message as an array of 8 bit values.\n     * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n     * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n     * milliseconds since the navigation start of the document).\n     * @property {string} type `\"localcontrol\"`\n     * @property {boolean} value For local control on, the value is `true`. For local control off,\n     * the value is `false`.\n     */\n    if (event.type === \"localcontrol\") {\n      event.value = data2 === 127 ? true : false;\n    }\n\n    /**\n     * Event emitted when an \"all notes off\" channel-mode MIDI message has been received.\n     *\n     * @event InputChannel#allnotesoff\n     * @type {Object}\n     * @property {InputChannel} target The `InputChannel` that triggered the event.\n     * @property {Array} event.data The MIDI message as an array of 8 bit values.\n     * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n     * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n     * milliseconds since the navigation start of the document).\n     * @property {string} type `\"allnotesoff\"`\n     */\n\n    /**\n     * Event emitted when an \"omni mode\" channel-mode MIDI message has been received. The value\n     * property of the event is set to either `true` (omni mode on) of `false` (omni mode off).\n     *\n     * @event InputChannel#omnimode\n     * @type {Object}\n     * @property {InputChannel} target The `InputChannel` that triggered the event.\n     * @property {Array} event.data The MIDI message as an array of 8 bit values.\n     * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n     * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n     * milliseconds since the navigation start of the document).\n     * @property {string} type `\"omnimode\"`\n     * @property {boolean} value The value is `true` for omni mode on and false for omni mode off.\n     */\n    if (event.type === \"omnimodeon\") {\n      event.type = \"omnimode\";\n      event.value = true;\n    } else if (event.type === \"omnimodeoff\") {\n      event.type = \"omnimode\";\n      event.value = false;\n    }\n\n    /**\n     * Event emitted when a \"mono/poly mode\" MIDI message has been received. The value property of\n     * the event is set to either `true` (mono mode on / poly mode off) or `false` (mono mode off /\n     * poly mode on).\n     *\n     * @event InputChannel#monomode\n     * @type {Object}\n     * @property {InputChannel} target The `InputChannel` that triggered the event.\n     * @property {Array} event.data The MIDI message as an array of 8 bit values.\n     * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n     * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n     * milliseconds since the navigation start of the document).\n     * @property {string} type `\"monomode\"`\n     * @property {boolean} value The value is `true` for omni mode on and false for omni mode off.\n     */\n    if (event.type === \"monomodeon\") {\n      event.type = \"monomode\";\n      event.value = true;\n    } else if (event.type === \"polymodeon\") {\n      event.type = \"monomode\";\n      event.value = false;\n    }\n\n    this.emit(event.type, event);\n\n  }\n\n  // /**\n  //  * Parses channel events and constructs NRPN message parts in valid sequences.\n  //  * Keeps a separate NRPN buffer for each channel.\n  //  * Emits an event after it receives the final CC parts msb 127 lsb 127.\n  //  * If a message is incomplete and other messages are received before\n  //  * the final 127 bytes, the incomplete message is cleared.\n  //  * @param e Event\n  //  * @private\n  //  *\n  //  *\n  //  * Uint8Array [ 176, 99, 12 ]\n  //  * Uint8Array [ 176, 98, 34 ]\n  //  * Uint8Array [ 176, 6, 56 ]\n  //  * Uint8Array [ 176, 38, 78 ]\n  //  * Uint8Array [ 176, 101, 127 ]\n  //  * Uint8Array [ 176, 100, 127 ]\n  //  */\n  // _parseEventForNrpnMessage(e) {\n  //\n  //   if (!this.nrpnEventsEnabled) return;\n  //\n  //   // Extract basic data\n  //   let command = e.data[0] >> 4;\n  //   let channel = (e.data[0] & 0xf) + 1;\n  //   let data1;\n  //   let data2;\n  //\n  //   if (e.data.length > 1) {\n  //     data1 = e.data[1];\n  //     data2 = e.data.length > 2 ? e.data[2] : undefined;\n  //   }\n  //\n  //   // Message not valid for NRPN\n  //   if (\n  //     !(\n  //       command === WebMidi.MIDI_CHANNEL_VOICE_MESSAGES.controlchange &&\n  //       (\n  //         (\n  //           data1 >= WebMidi.MIDI_NRPN_MESSAGES.increment &&\n  //           data1 <= WebMidi.MIDI_NRPN_MESSAGES.parammsb\n  //         ) ||\n  //         data1 === WebMidi.MIDI_NRPN_MESSAGES.entrymsb ||\n  //         data1 === WebMidi.MIDI_NRPN_MESSAGES.entrylsb\n  //       )\n  //     )\n  //   ) {\n  //     return;\n  //   }\n  //\n  //   // set up a CC event to parse as NRPN part\n  //   let ccEvent = {\n  //     target: this,\n  //     type: \"controlchange\",\n  //     data: Array.from(e.data),\n  //     rawData: e.data,\n  //     timestamp: e.timeStamp,\n  //     channel: channel,\n  //     controller: {\n  //       number: data1,\n  //       name: this.getCcNameByNumber(data1)\n  //     },\n  //     value: data2\n  //   };\n  //\n  //   if (\n  //     // if we get a starting MSB (CC99 - 0-126) vs an end MSB (CC99 - 127), destroy incomplete\n  //     // NRPN and begin building again\n  //     ccEvent.controller.number === WebMidi.MIDI_NRPN_MESSAGES.parammsb &&\n  //     ccEvent.value != WebMidi.MIDI_NRPN_MESSAGES.nullactiveparameter\n  //   ) {\n  //     this._nrpnBuffer = [];\n  //     this._nrpnBuffer[0] = ccEvent;\n  //   } else if(\n  //     // add the param LSB\n  //     this._nrpnBuffer.length === 1 &&\n  //     ccEvent.controller.number === WebMidi.MIDI_NRPN_MESSAGES.paramlsb\n  //   ) {\n  //     this._nrpnBuffer.push(ccEvent);\n  //\n  //   } else if(\n  //     // add data inc/dec or value MSB for 14bit\n  //     this._nrpnBuffer.length === 2 &&\n  //     (ccEvent.controller.number === WebMidi.MIDI_NRPN_MESSAGES.increment ||\n  //       ccEvent.controller.number === WebMidi.MIDI_NRPN_MESSAGES.decrement ||\n  //       ccEvent.controller.number === WebMidi.MIDI_NRPN_MESSAGES.entrymsb)\n  //   ) {\n  //     this._nrpnBuffer.push(ccEvent);\n  //   } else if(\n  //     // if we have a value MSB, only add an LSB to pair with that\n  //     this._nrpnBuffer.length === 3 &&\n  //     this._nrpnBuffer[2].number === WebMidi.MIDI_NRPN_MESSAGES.entrymsb &&\n  //     ccEvent.controller.number === WebMidi.MIDI_NRPN_MESSAGES.entrylsb\n  //   ) {\n  //     this._nrpnBuffer.push(ccEvent);\n  //\n  //   } else if(\n  //     // add an end MSB (CC99 - 127)\n  //     this._nrpnBuffer.length >= 3 &&\n  //     this._nrpnBuffer.length <= 4 &&\n  //     ccEvent.controller.number === WebMidi.MIDI_NRPN_MESSAGES.parammsb &&\n  //     ccEvent.value === WebMidi.MIDI_NRPN_MESSAGES.nullactiveparameter\n  //   ) {\n  //     this._nrpnBuffer.push(ccEvent);\n  //   } else if(\n  //     // add an end LSB (CC99 - 127)\n  //     this._nrpnBuffer.length >= 4 &&\n  //     this._nrpnBuffer.length <= 5 &&\n  //     ccEvent.controller.number === WebMidi.MIDI_NRPN_MESSAGES.paramlsb &&\n  //     ccEvent.value === WebMidi.MIDI_NRPN_MESSAGES.nullactiveparameter\n  //   ) {\n  //     this._nrpnBuffer.push(ccEvent);\n  //     // now we have a full inc or dec NRPN message, lets create that event!\n  //\n  //     let rawData = [];\n  //\n  //     this._nrpnBuffer.forEach(ev => rawData.push(ev.data));\n  //\n  //     let nrpnNumber = (this._nrpnBuffer[0].value<<7) | (this._nrpnBuffer[1].value);\n  //     let nrpnValue = this._nrpnBuffer[2].value;\n  //     if (this._nrpnBuffer.length === 6) {\n  //       nrpnValue = (this._nrpnBuffer[2].value<<7) | (this._nrpnBuffer[3].value);\n  //     }\n  //\n  //     let nrpnControllerType = \"\";\n  //\n  //     switch (this._nrpnBuffer[2].controller.number) {\n  //     case WebMidi.MIDI_NRPN_MESSAGES.entrymsb:\n  //       nrpnControllerType = InputChannel.NRPN_TYPES[0];\n  //       break;\n  //     case WebMidi.MIDI_NRPN_MESSAGES.increment:\n  //       nrpnControllerType = InputChannel.NRPN_TYPES[1];\n  //       break;\n  //     case WebMidi.MIDI_NRPN_MESSAGES.decrement:\n  //       nrpnControllerType = InputChannel.NRPN_TYPES[2];\n  //       break;\n  //     default:\n  //       throw new Error(\"The NPRN type was unidentifiable.\");\n  //     }\n  //\n  //     // now we are done building an NRPN, so clear the NRPN buffer\n  //     this._nrpnBuffer = [];\n  //\n  //     /**\n  //      * Event emitted when a valid NRPN message sequence has been received.\n  //      *\n  //      * @event InputChannel#nrpn\n  //      * @type {Object}\n  //      * @property {InputChannel} target The `InputChannel` that triggered the event.\n  //      * @property {Array} event.data The MIDI message as an array of 8 bit values.\n  //      * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n  //      * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred\n  //      * (in milliseconds since the navigation start of the document).\n  //      * @property {string} type `\"nrpn\"`\n  //      * @property {Object} controller\n  //      * @property {Object} controller.number The number of the NRPN.\n  //      * @property {Object} controller.name The usual name or function of the controller.\n  //      * @property {number} value The aftertouch amount expressed as a float between 0 and 1.\n  //      * @property {number} rawValue The aftertouch amount expressed as an integer (between 0 and\n  //      * 65535).\n  //      */\n  //     let nrpnEvent = {\n  //       timestamp: ccEvent.timestamp,\n  //       channel: ccEvent.channel,\n  //       type: \"nrpn\",\n  //       data: Array.from(rawData),\n  //       rawData: rawData,\n  //       controller: {\n  //         number: nrpnNumber,\n  //         type: nrpnControllerType,\n  //         name: \"Non-Registered Parameter \" + nrpnNumber\n  //       },\n  //       value: nrpnValue / 65535,\n  //       rawValue: nrpnValue\n  //     };\n  //\n  //     this.emit(nrpnEvent.type, nrpnEvent);\n  //\n  //   } else {\n  //     // something didn't match, clear the incomplete NRPN message buffer\n  //     this._nrpnBuffer = [];\n  //   }\n  // }\n\n  /**\n   * Returns the name of a control change message matching the specified number. Some valid control\n   * change numbers do not have a specific name or purpose assigned in the MIDI\n   * [spec](https://midi.org/specifications-old/item/table-3-control-change-messages-data-bytes-2).\n   * In this case, the method returns `false`.\n   *\n   * @param {number} number An integer representing the control change message\n   * @returns {string|false} The matching control change name or `false` if not match was found\n   *\n   * @throws {RangeError} Invalid control change number.\n   *\n   * @since 2.0.0\n   */\n  getCcNameByNumber(number) {\n\n    if (wm.validation) {\n      number = parseInt(number);\n      if ( !(number >= 0 && number <= 119) ) {\n        throw new RangeError(\"Invalid control change number.\");\n      }\n    }\n\n    for (let cc in wm.MIDI_CONTROL_CHANGE_MESSAGES) {\n\n      if (\n        wm.MIDI_CONTROL_CHANGE_MESSAGES.hasOwnProperty(cc) &&\n        number === wm.MIDI_CONTROL_CHANGE_MESSAGES[cc]\n      ) {\n        return cc;\n      }\n\n    }\n\n    return false;\n\n  }\n\n\n  // /**\n  //  * Indicates whether events for **Non-Registered Parameter Number** should be dispatched. NRPNs\n  //  * are composed of a sequence of specific **control change** messages. When a valid sequence of\n  //  * such control change messages is received, an `nrpn` event will fire. If an invalid or out of\n  //  * order control change message is received, it will fall through the collector logic and all\n  //  * buffered control change messages will be discarded as incomplete.\n  //  *\n  //  * @type Boolean\n  //  */\n  // get nrpnEventsEnabled() {\n  //   return this._nrpnEventsEnabled;\n  // }\n  // set nrpnEventsEnabled(enabled) {\n  //   this._nrpnEventsEnabled = !!enabled;\n  // }\n\n  // /**\n  //  * Array of valid **non-registered parameter number** (NRPNs) types.\n  //  *\n  //  * @type {string[]}\n  //  * @readonly\n  //  */\n  // static get NRPN_TYPES() {\n  //   return [\"entry\", \"increment\", \"decrement\"];\n  // }\n\n}\n\n/**\n * The `Input` class represents a single MIDI input port. This object is derived from the host's\n * MIDI subsystem and cannot be instantiated directly.\n *\n * You can find a list of all currently available `Input` objects in the {@link WebMidi#inputs}\n * array.\n *\n * The `Input` class extends the\n * [EventEmitter](https://djipco.github.io/djipevents/EventEmitter.html) class from the\n * [djipevents]{@link https://djipco.github.io/djipevents/index.html} module. This means\n * it also includes methods such as\n * [getListeners()](https://djipco.github.io/djipevents/EventEmitter.html#getListeners),\n * [emit()](https://djipco.github.io/djipevents/EventEmitter.html#emit),\n * [suspendEvent()](https://djipco.github.io/djipevents/EventEmitter.html#suspendEvent) and several\n * others.\n *\n * @param {MIDIInput} midiInput `MIDIInput` object as provided by the MIDI subsystem (Web MIDI API).\n *\n * @fires Input#opened\n * @fires Input#disconnected\n * @fires Input#closed\n * @fires Input#midimessage\n * @fires Input#sysex\n * @fires Input#timecode\n * @fires Input#songposition\n * @fires Input#songselect\n * @fires Input#tunerequest\n * @fires Input#clock\n * @fires Input#start\n * @fires Input#continue\n * @fires Input#stop\n * @fires Input#activesensing\n * @fires Input#reset\n * @fires Input#midimessage\n * @fires Input#unknownmidimessage\n */\nclass Input extends e {\n\n  constructor(midiInput) {\n\n    super();\n\n    /**\n     * Reference to the actual MIDIInput object\n     * @private\n     */\n    this._midiInput = midiInput;\n\n    /**\n     * Array containing the 16 {@link InputChannel} objects available for this `Input`. The\n     * channels are numbered 1 through 16.\n     *\n     * @type {InputChannel[]}\n     */\n    this.channels = [];\n    for (let i = 1; i <= 16; i++) this.channels[i] = new InputChannel(this, i);\n\n    // Setup listeners\n    this._midiInput.onstatechange = this._onStateChange.bind(this);\n    this._midiInput.onmidimessage = this._onMidiMessage.bind(this);\n\n  }\n\n  /**\n   * Destroys the `Input` by remove all listeners, emptying the `channels` array and unlinking the\n   * MIDI subsystem.\n   *\n   * @returns {Promise<void>}\n   */\n  async destroy() {\n    this.removeListener();\n    this.channels.forEach(ch => ch.destroy());\n    this.channels = [];\n    this._midiInput.onstatechange = null;\n    this._midiInput.onmidimessage = null;\n    await this.close();\n    this._midiInput = null;\n  }\n\n  /**\n   * Executed when a `\"statechange\"` event occurs.\n   *\n   * @param e\n   * @private\n   */\n  _onStateChange(e) {\n\n    let event = {\n      timestamp: wm.time,\n      target: this\n    };\n\n    if (e.port.connection === \"open\") {\n\n      /**\n       * Event emitted when the {@link Input} has been opened by calling the {@link Input#open}\n       * method.\n       *\n       * @event Input#opened\n       * @type {Object}\n       * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"opened\"`\n       * @property {Input} target The object that triggered the event\n       */\n      event.type = \"opened\";\n      this.emit(\"opened\", event);\n\n    } else if (e.port.connection === \"closed\" && e.port.state === \"connected\") {\n\n      /**\n       * Event emitted when the {@link Input} has been closed by calling the {@link Input#close}\n       * method.\n       *\n       * @event Input#closed\n       * @type {Object}\n       * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"closed\"`\n       * @property {Input} target The object that triggered the event\n       */\n      event.type = \"closed\";\n      this.emit(\"closed\", event);\n\n    } else if (e.port.connection === \"closed\" && e.port.state === \"disconnected\") {\n\n      /**\n       * Event emitted when the {@link Input} becomes unavailable. This event is typically fired\n       * when the MIDI device is unplugged.\n       *\n       * @event Input#disconnected\n       * @type {Object}\n       * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"disconnected\"`\n       * @property {Object} target Object with properties describing the {@link Input} that\n       * triggered the event. This is not the actual `Input` as it is no longer available.\n       * @property {string} target.connection `\"closed\"`\n       * @property {string} target.id ID of the input\n       * @property {string} target.manufacturer Manufacturer of the device that provided the input\n       * @property {string} target.name Name of the device that provided the input\n       * @property {string} target.state `\"disconnected\"`\n       * @property {string} target.type `\"input\"`\n       */\n      event.type = \"disconnected\";\n      event.target = {\n        connection: e.port.connection,\n        id: e.port.id,\n        manufacturer: e.port.manufacturer,\n        name: e.port.name,\n        state: e.port.state,\n        type: e.port.type\n      };\n      this.emit(\"disconnected\", event);\n\n    } else if (e.port.connection === \"pending\" && e.port.state === \"disconnected\") ; else {\n      console.warn(\"This statechange event was not caught: \", e.port.connection, e.port.state);\n    }\n\n  }\n\n  /**\n   * Executed when a `\"midimessage\"` event is received\n   * @param e\n   * @private\n   */\n  _onMidiMessage(e) {\n\n    // Extract data bytes (unless it's a sysex message)\n    let dataBytes = null;\n    if (e.data[0] !== wm.MIDI_SYSTEM_MESSAGES.sysex) dataBytes = e.data.slice(1);\n\n    /**\n     * Event emitted when a MIDI message is received on the `Input`\n     *\n     * @event Input#midimessage\n     * @type {Object}\n     * @property {Input} target The `Input` that triggered the event.\n     * @property {Array} event.data The MIDI message as an array of 8 bit values.\n     * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n     * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n     * milliseconds since the navigation start of the document).\n     * @property {string} type `\"midimessage\"`\n     * @property {number} event.statusByte The message's status byte.\n     * @property {?number[]} event.dataBytes The message's data bytes as an array of 0, 1 or 2\n     * integers. This will be null for `sysex` messages.\n     *\n     * @since 2.1\n     */\n    let event = {\n      target: this,\n      data: Array.from(e.data),\n      rawData: e.data,\n      statusByte: e.data[0],\n      dataBytes: dataBytes,\n      timestamp: e.timeStamp,\n      type: \"midimessage\"\n    };\n\n    this.emit(\"midimessage\", event);\n\n    // Messages are forwarded to InputChannel if they are targeted at a channel or parsed locally\n    // for system messages.\n    if (e.data[0] < 240) {          // channel-specific message\n      let channel = (e.data[0] & 0xf) + 1;\n      this.channels[channel]._parseEvent(e);\n    } else if (e.data[0] <= 255) {  // system message\n      this._parseEvent(e);\n    }\n\n  }\n\n  /**\n   * @private\n   */\n  _parseEvent(e) {\n\n    let command = e.data[0];\n\n    // Returned event\n    var event = {\n      target: this,\n      data: Array.from(e.data),\n      rawData: e.data,\n      timestamp: e.timeStamp\n    };\n\n    if (command === wm.MIDI_SYSTEM_MESSAGES.sysex) {\n\n      /**\n       * Input-wide (system) event emitted when a **system exclusive** message has been received.\n       * You should note that, to receive `sysex` events, you must call the `WebMidi.enable()`\n       * method with the `sysex` option set to `true`:\n       *\n       * ```js\n       * WebMidi.enable({sysex: true})\n       *  .then(() => console.log(\"WebMidi has been enabled with sysex support.\"))\n       *  .catch(err => console.log(\"WebMidi could not be enabled.\"))\n       * ```\n       *\n       * @event Input#sysex\n       * @type {Object}\n       * @property {InputChannel} target The `Input` that triggered the event.\n       * @property {Array} event.data The MIDI message as an array of 8 bit values.\n       * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n       * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"sysex\"`\n       */\n      event.type = \"sysex\";\n\n    } else if (command === wm.MIDI_SYSTEM_MESSAGES.timecode) {\n\n      /**\n       * Input-wide (system) event emitted when a **time code quarter frame** message has been\n       * received.\n       *\n       * @event Input#timecode\n       * @type {Object}\n       * @property {InputChannel} target The `Input` that triggered the event.\n       * @property {Array} event.data The MIDI message as an array of 8 bit values.\n       * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n       * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"sysextimecode\"`\n       */\n      event.type = \"timecode\";\n\n    } else if (command === wm.MIDI_SYSTEM_MESSAGES.songposition) {\n\n      /**\n       * Input-wide (system) event emitted when a **song position** message has been received.\n       *\n       * @event Input#songposition\n       * @type {Object}\n       * @property {InputChannel} target The `Input` that triggered the event.\n       * @property {Array} event.data The MIDI message as an array of 8 bit values.\n       * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n       * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"songposition\"`\n       */\n      event.type = \"songposition\";\n\n    } else if (command === wm.MIDI_SYSTEM_MESSAGES.songselect) {\n\n      /**\n       * Input-wide (system) event emitted when a **song select** message has been received.\n       *\n       * @event Input#songselect\n       * @type {Object}\n       * @property {InputChannel} target The `Input` that triggered the event.\n       * @property {Array} event.data The MIDI message as an array of 8 bit values.\n       * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n       * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"songselect\"`\n       * @property {string} song Song (or sequence) number to select (1-128)\n       */\n      event.type = \"songselect\";\n      event.song = e.data[1] + 1;\n\n    } else if (command === wm.MIDI_SYSTEM_MESSAGES.tunerequest) {\n\n      /**\n       * Input-wide (system) event emitted when a **tune request** message has been received.\n       *\n       * @event Input#tunerequest\n       * @type {Object}\n       * @property {InputChannel} target The `Input` that triggered the event.\n       * @property {Array} event.data The MIDI message as an array of 8 bit values.\n       * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n       * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"tunerequest\"`\n       */\n      event.type = \"tunerequest\";\n\n    } else if (command === wm.MIDI_SYSTEM_MESSAGES.clock) {\n\n      /**\n       * Input-wide (system) event emitted when a **timing clock** message has been received.\n       *\n       * @event Input#clock\n       * @type {Object}\n       * @property {InputChannel} target The `Input` that triggered the event.\n       * @property {Array} event.data The MIDI message as an array of 8 bit values.\n       * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n       * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"clock\"`\n       */\n      event.type = \"clock\";\n\n    } else if (command === wm.MIDI_SYSTEM_MESSAGES.start) {\n\n      /**\n       * Input-wide (system) event emitted when a **start** message has been received.\n       *\n       * @event Input#start\n       * @type {Object}\n       * @property {InputChannel} target The `Input` that triggered the event.\n       * @property {Array} event.data The MIDI message as an array of 8 bit values.\n       * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n       * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"start\"`\n       */\n      event.type = \"start\";\n\n    } else if (command === wm.MIDI_SYSTEM_MESSAGES.continue) {\n\n      /**\n       * Input-wide (system) event emitted when a **continue** message has been received.\n       *\n       * @event Input#continue\n       * @type {Object}\n       * @property {InputChannel} target The `Input` that triggered the event.\n       * @property {Array} event.data The MIDI message as an array of 8 bit values.\n       * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n       * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"continue\"`\n       */\n      event.type = \"continue\";\n\n    } else if (command === wm.MIDI_SYSTEM_MESSAGES.stop) {\n\n      /**\n       * Input-wide (system) event emitted when a **stop** message has been received.\n       *\n       * @event Input#stop\n       * @type {Object}\n       * @property {InputChannel} target The `Input` that triggered the event.\n       * @property {Array} event.data The MIDI message as an array of 8 bit values.\n       * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n       * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"stop\"`\n       */\n      event.type = \"stop\";\n\n    } else if (command === wm.MIDI_SYSTEM_MESSAGES.activesensing) {\n\n      /**\n       * Input-wide (system) event emitted when an **active sensing** message has been received.\n       *\n       * @event Input#activesensing\n       * @type {Object}\n       * @property {InputChannel} target The `Input` that triggered the event.\n       * @property {Array} event.data The MIDI message as an array of 8 bit values.\n       * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n       * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"activesensing\"`\n       */\n      event.type = \"activesensing\";\n\n    } else if (command === wm.MIDI_SYSTEM_MESSAGES.reset) {\n\n      /**\n       * Input-wide (system) event emitted when a **reset** message has been received.\n       *\n       * @event Input#reset\n       * @type {Object}\n       * @property {InputChannel} target The `Input` that triggered the event.\n       * @property {Array} event.data The MIDI message as an array of 8 bit values.\n       * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n       * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"reset\"`\n       */\n      event.type = \"reset\";\n\n    } else {\n\n      /**\n       * Input-wide (system) event emitted when an unknown MIDI message has been received. It could\n       * be, for example, one of the undefined/reserved messages.\n       *\n       * @event Input#unknownmidimessage\n       * @type {Object}\n       * @property {InputChannel} target The `Input` that triggered the event.\n       * @property {Array} event.data The MIDI message as an array of 8 bit values.\n       * @property {Uint8Array} event.rawData The raw MIDI message as a Uint8Array.\n       * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"unknownmidimessage\"`\n       */\n      event.type = \"unknownmidimessage\";\n\n    }\n\n    this.emit(event.type, event);\n\n  }\n\n  /**\n   * Opens the input for usage.\n   *\n   * @returns {Promise<Input>} The promise is fulfilled with the `Input`\n   */\n  async open() {\n\n    // Explicitly opens the port for usage. This is not mandatory. When the port is not explicitly\n    // opened, it is implicitly opened (asynchronously) when assigning a listener to the\n    // `onmidimessage` property of the `MIDIInput`. We do it explicitly so that 'connected' events\n    // are dispatched immediately and that we are ready to listen.\n    try {\n      await this._midiInput.open();\n      return Promise.resolve(this);\n    } catch (err) {\n      return Promise.reject(err);\n    }\n\n  }\n\n  /**\n   * Closes the input. When an input is closed, it cannot be used to listen to MIDI messages until\n   * the input is opened again by calling [Input.open()]{@link Input#open}.\n   *\n   * @returns {Promise<void|*>}\n   */\n  async close() {\n\n    // We close the port. This triggers a statechange event which, in turn, will emit the 'closed'\n    // event.\n    if (this._midiInput) {\n      return this._midiInput.close();\n    } else {\n      return Promise.resolve();\n    }\n\n  }\n\n  /**\n   * @private\n   * @deprecated since v3.0.0 (moved to 'InputChannel' class)\n   */\n  getChannelModeByNumber() {\n    if (wm.validation) {\n      console.warn(\n        \"The 'getChannelModeByNumber()' method has been moved to the 'InputChannel' class.\"\n      );\n    }\n  }\n\n  /**\n   * Adds an event listener that will trigger a function callback when the specified event happens.\n   * The event can be **channel-bound** or **input-wide**. Channel-bound events are dispatched by\n   * {@link InputChannel} objects and are tied to a specific MIDI channel while input-wide events\n   * are dispatched by the {@link Input} object itself and are not tied to a specific channel.\n   *\n   * When listening for an input-wide event, you must specify the event to listen for and the\n   * callback function to trigger when the event happens:\n   *\n   * ```\n   * WebMidi.inputs[0].addListener(\"midimessage\", someFunction);\n   * ```\n   *\n   * To listen for a channel-bound event, you must also specify the event to listen for and the\n   * function to trigger but you have to add the channels you wish to listen on in the `options`\n   * parameter:\n   *\n   * ```\n   * WebMidi.inputs[0].addListener(\"noteon\", someFunction, {channels: [1, 2, 3]});\n   * ```\n   *\n   * The code above will add a listener for the `\"noteon\"` event and call `someFunction` when the\n   * event is triggered on MIDI channels `1`, `2` or `3`.\n   *\n   * Note that, when adding events to channels, it is the {@link InputChannel} instance that\n   * actually gets a listener added and not the `{@link Input} instance.\n   *\n   * Note: if you want to add a listener to a single MIDI channel you should probably do so directly\n   * on the {@link InputChannel} object itself.\n   *\n   * There are 6 families of events you can listen to:\n   *\n   * 1. **MIDI System Common** Events (input-wide)\n   *\n   *    * [songposition]{@link Input#event:songposition}\n   *    * [songselect]{@link Input#event:songselect}\n   *    * [sysex]{@link Input#event:sysex}\n   *    * [timecode]{@link Input#event:timecode}\n   *    * [tunerequest]{@link Input#event:tunerequest}\n   *\n   * 2. **MIDI System Real-Time** Events (input-wide)\n   *\n   *    * [clock]{@link Input#event:clock}\n   *    * [start]{@link Input#event:start}\n   *    * [continue]{@link Input#event:continue}\n   *    * [stop]{@link Input#event:stop}\n   *    * [activesensing]{@link Input#event:activesensing}\n   *    * [reset]{@link Input#event:reset}\n   *\n   * 3. **State Change** Events (input-wide)\n   *\n   *    * [opened]{@link Input#event:opened}\n   *    * [closed]{@link Input#event:closed}\n   *    * [disconnected]{@link Input#event:disconnected}\n   *\n   * 4. **Catch-All** Events (input-wide)\n   *\n   *    * [midimessage]{@link Input#event:midimessage}\n   *    * [unknownmidimessage]{@link Input#event:unknownmidimessage}\n   *\n   * 5. **Channel Voice** Events (channel-specific)\n   *\n   *    * [channelaftertouch]{@link InputChannel#event:channelaftertouch}\n   *    * [controlchange]{@link InputChannel#event:controlchange}\n   *    * [keyaftertouch]{@link InputChannel#event:keyaftertouch}\n   *    * [noteoff]{@link InputChannel#event:noteoff}\n   *    * [noteon]{@link InputChannel#event:noteon}\n   *    * [nrpn]{@link InputChannel#event:nrpn}\n   *    * [pitchbend]{@link InputChannel#event:pitchbend}\n   *    * [programchange]{@link InputChannel#event:programchange}\n   *\n   * 6. **Channel Mode** Events (channel-specific)\n   *\n   *    * [channelmode]{@link InputChannel#event:channelmode}\n   *    * To be completed...\n   *\n   * @param event {string} The type of the event.\n   *\n   * @param listener {function} A callback function to execute when the specified event is detected.\n   * This function will receive an event parameter object. For details on this object's properties,\n   * check out the documentation for the various events (links above).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {array} [options.arguments] An array of arguments which will be passed separately to the\n   * callback function. This array is stored in the `arguments` property of the `Listener` object\n   * and can be retrieved or modified as desired.\n   *\n   * @param {number|number[]} [options.channels]  An integer between 1 and 16 or an array of\n   * such integers representing the MIDI channel(s) to listen on. This parameter is ignored for\n   * input-wide events.\n   *\n   * @param {Object} [options.context=this] The value of `this` in the callback function.\n   *\n   * @param {number} [options.duration=Infinity] The number of milliseconds before the listener\n   * automatically expires.\n   *\n   * @param {boolean} [options.prepend=false] Whether the listener should be added at the beginning\n   * of the listeners array.\n   *\n   * @param {boolean} [options.remaining=Infinity] The number of times after which the callback\n   * should automatically be removed.\n   *\n   * @throws {Error} For channel-specific events, 'options.channels' must be defined.\n   *\n   * @returns {Listener[]} An array of all `Listener` objects that were created.\n   */\n  addListener(event, listener, options) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (typeof options === \"function\") {\n        let channels = (listener != undefined) ? [].concat(listener) : undefined; // clone\n        listener = options;\n        options = {channels: channels};\n      }\n\n      // Validation\n      if (\n        wm.MIDI_CHANNEL_VOICE_MESSAGES[event] !== undefined &&\n        options.channels === undefined\n      ) {\n        throw new Error(\"For channel-specific events, 'options.channels' must be defined.\");\n      }\n\n    }\n\n    let listeners = [];\n\n    // Check if the event is channel-specific or input-wide\n    if (wm.MIDI_CHANNEL_VOICE_MESSAGES[event] === undefined) {\n      listeners.push(super.addListener(event, listener, options));\n    } else {\n      wm.sanitizeChannels(options.channels).forEach(ch => {\n        listeners.push(this.channels[ch].addListener(event, listener, options));\n      });\n    }\n\n    return listeners;\n\n  }\n\n  /**\n   * Adds a one-time event listener that will trigger a function callback when the specified event\n   * happens. The event can be **channel-bound** or **input-wide**. Channel-bound events are\n   * dispatched by {@link InputChannel} objects and are tied to a specific MIDI channel while\n   * input-wide events are dispatched by the {@link Input} object itself and are not tied to a\n   * specific channel.\n   *\n   * When listening for an input-wide event, you must specify the event to listen for and the\n   * callback function to trigger when the event happens:\n   *\n   * ```\n   * WebMidi.inputs[0].addListener(\"midimessage\", someFunction);\n   * ```\n   *\n   * To listen for a channel-bound event, you must also specify the event to listen for and the\n   * function to trigger but you have to add the channels you wish to listen on in the `options`\n   * parameter:\n   *\n   * ```\n   * WebMidi.inputs[0].addListener(\"noteon\", someFunction, {channels: [1, 2, 3]});\n   * ```\n   *\n   * The code above will add a listener for the `\"noteon\"` event and call `someFunction` when the\n   * event is triggered on MIDI channels `1`, `2` or `3`.\n   *\n   * Note that, when adding events to channels, it is the {@link InputChannel} instance that\n   * actually gets a listener added and not the `{@link Input} instance.\n   *\n   * Note: if you want to add a listener to a single MIDI channel you should probably do so directly\n   * on the {@link InputChannel} object itself.\n   *\n   * There are 6 families of events you can listen to:\n   *\n   * 1. **MIDI System Common** Events (input-wide)\n   *\n   *    * [songposition]{@link Input#event:songposition}\n   *    * [songselect]{@link Input#event:songselect}\n   *    * [sysex]{@link Input#event:sysex}\n   *    * [timecode]{@link Input#event:timecode}\n   *    * [tunerequest]{@link Input#event:tunerequest}\n   *\n   * 2. **MIDI System Real-Time** Events (input-wide)\n   *\n   *    * [clock]{@link Input#event:clock}\n   *    * [start]{@link Input#event:start}\n   *    * [continue]{@link Input#event:continue}\n   *    * [stop]{@link Input#event:stop}\n   *    * [activesensing]{@link Input#event:activesensing}\n   *    * [reset]{@link Input#event:reset}\n   *\n   * 3. **State Change** Events (input-wide)\n   *\n   *    * [opened]{@link Input#event:opened}\n   *    * [closed]{@link Input#event:closed}\n   *    * [disconnected]{@link Input#event:disconnected}\n   *\n   * 4. **Catch-All** Events (input-wide)\n   *\n   *    * [midimessage]{@link Input#event:midimessage}\n   *    * [unknownmidimessage]{@link Input#event:unknownmidimessage}\n   *\n   * 5. **Channel Voice** Events (channel-specific)\n   *\n   *    * [channelaftertouch]{@link InputChannel#event:channelaftertouch}\n   *    * [controlchange]{@link InputChannel#event:controlchange}\n   *    * [keyaftertouch]{@link InputChannel#event:keyaftertouch}\n   *    * [noteoff]{@link InputChannel#event:noteoff}\n   *    * [noteon]{@link InputChannel#event:noteon}\n   *    * [nrpn]{@link InputChannel#event:nrpn}\n   *    * [pitchbend]{@link InputChannel#event:pitchbend}\n   *    * [programchange]{@link InputChannel#event:programchange}\n   *\n   * 6. **Channel Mode** Events (channel-specific)\n   *\n   *    * [channelmode]{@link InputChannel#event:channelmode}\n   *    * To be completed...\n   *\n   * @param event {string} The type of the event.\n   *\n   * @param listener {function} A callback function to execute when the specified event is detected.\n   * This function will receive an event parameter object. For details on this object's properties,\n   * check out the documentation for the various events (links above).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {array} [options.arguments] An array of arguments which will be passed separately to the\n   * callback function. This array is stored in the `arguments` property of the `Listener` object\n   * and can be retrieved or modified as desired.\n   *\n   * @param {number|number[]} [options.channels]  An integer between 1 and 16 or an array of\n   * such integers representing the MIDI channel(s) to listen on. This parameter is ignored for\n   * input-wide events.\n   *\n   * @param {Object} [options.context=this] The value of `this` in the callback function.\n   *\n   * @param {number} [options.duration=Infinity] The number of milliseconds before the listener\n   * automatically expires.\n   *\n   * @param {boolean} [options.prepend=false] Whether the listener should be added at the beginning\n   * of the listeners array.\n   *\n   * @throws {Error} For channel-specific events, 'options.channels' must be defined.\n   *\n   * @returns {Listener[]} An array of all `Listener` objects that were created.\n   */\n  addOneTimeListener(event, listener, options = {}) {\n    options.remaining = 1;\n    return this.addListener(event, listener, options);\n  }\n\n  /**\n   * This is an alias to the [Input.addListener()]{@link Input#addListener} method.\n   * @since 2.0.0\n   * @deprecated since v3.0\n   * @private\n   */\n  on(event, channel, listener, options) {\n    return this.addListener(event, channel, listener, options);\n  }\n\n  /**\n   * Checks if the specified event type is already defined to trigger the listener function. For\n   * channel-specific events, the function will return `true` only if all channels have the listener\n   * defined.\n   *\n   * @param event {string} The type of the event.\n   *\n   * @param listener {function} The callback function to check for.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]} [options.channels]  An integer between 1 and 16 or an array of\n   * such integers representing the MIDI channel(s) to check. This parameter is ignored for\n   * input-wide events.\n   *\n   * @returns {Boolean} Boolean value indicating whether or not the channel(s) already have this\n   * listener defined.\n   *\n   * @throws Error For channel-specific events, 'options.channels' must be defined.\n   */\n  hasListener(event, listener, options = {}) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (typeof options === \"function\") {\n        let channels = [].concat(listener); // clone\n        listener = options;\n        options = {channels: channels};\n      }\n\n      // Validation\n      if (\n        wm.MIDI_CHANNEL_VOICE_MESSAGES[event] !== undefined &&\n        options.channels === undefined\n      ) {\n        throw new Error(\"For channel-specific events, 'options.channels' must be defined.\");\n      }\n\n    }\n\n    if (wm.MIDI_CHANNEL_VOICE_MESSAGES[event] !== undefined) {\n\n      return wm.sanitizeChannels(options.channels).every(ch => {\n        return this.channels[ch].hasListener(event, listener);\n      });\n\n    } else {\n      return super.hasListener(event, listener);\n    }\n\n  }\n\n  /**\n   * Removes the specified listener for the specified event. If no listener is specified, all\n   * listeners for the specified event will be removed. If no event is specified, all listeners for\n   * the `Input` as well as all listeners for all `InputChannels` will be removed.\n   *\n   * By default, channel-specific listeners will be removed from all channels unless the\n   * `options.channel` narrows it down.\n   *\n   * @param [type] {String} The type of the event.\n   *\n   * @param [listener] {Function} The callback function to check for.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]} [options.channels]  An integer between 1 and 16 or an array of\n   * such integers representing the MIDI channel(s) to match. This parameter is ignored for\n   * input-wide events.\n   *\n   * @param {*} [options.context] Only remove the listeners that have this exact context.\n   *\n   * @param {number} [options.remaining] Only remove the listener if it has exactly that many\n   * remaining times to be executed.\n   */\n  removeListener(event, listener, options = {}) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (typeof options === \"function\") {\n        let channels = [].concat(listener); // clone\n        listener = options;\n        options = {channels: channels};\n      }\n\n    }\n\n    if (options.channels === undefined) {\n      options.channels = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16];\n    }\n\n    // If the event is not specified, remove everything (channel-specific and input-wide)!\n    if (event == undefined) {\n      wm.sanitizeChannels(options.channels).forEach(ch => this.channels[ch].removeListener());\n      return super.removeListener();\n    }\n\n    // If the event is specified, check if it's channel-specific or input-wide.\n    if (wm.MIDI_CHANNEL_VOICE_MESSAGES[event] !== undefined) {\n\n      wm.sanitizeChannels(options.channels).forEach(ch => {\n        this.channels[ch].removeListener(event, listener, options);\n      });\n\n    } else {\n\n      super.removeListener(event, listener, options);\n\n    }\n\n  }\n\n  /**\n   * Name of the MIDI input\n   *\n   * @type {string}\n   * @readonly\n   */\n  get name() {\n    return this._midiInput.name;\n  }\n\n  /**\n   * ID string of the MIDI port. The ID is host-specific. Do not expect the same ID on different\n   * platforms. For example, Google Chrome and the Jazz-Plugin report completely different IDs for\n   * the same port.\n   *\n   * @type {string}\n   * @readonly\n   */\n  get id() {\n    return this._midiInput.id;\n  }\n\n  /**\n   * Input port's connection state: `\"pending\"`, `\"open\"` or `\"closed\"`.\n   *\n   * @type {string}\n   * @readonly\n   */\n  get connection() {\n    return this._midiInput.connection;\n  }\n\n  /**\n   * Name of the manufacturer of the device that makes this input port available.\n   *\n   * @type {string}\n   * @readonly\n   */\n  get manufacturer() {\n    return this._midiInput.manufacturer;\n  }\n\n  /**\n   * State of the input port: `\"connected\"` or `\"disconnected\"`.\n   *\n   * @type {string}\n   * @readonly\n   */\n  get state() {\n    return this._midiInput.state;\n  }\n\n  /**\n   * Port type. In the case of `Input`, this is always: `\"input\"`.\n   *\n   * @type {string}\n   * @readonly\n   */\n  get type() {\n    return this._midiInput.type;\n  }\n\n  /**\n   * @type {boolean}\n   * @private\n   * @deprecated since v3.0.0 (moved to 'InputChannel' class)\n   */\n  get nrpnEventsEnabled() {\n    if (wm.validation) {\n      console.warn(\"The 'nrpnEventsEnabled' property has been moved to the 'InputChannel' class.\");\n    }\n    return false;\n  }\n\n}\n\n/**\n * The `OutputChannel` class represents a single output channel (1-16) from an output device. This\n * object is derived from the host's MIDI subsystem and cannot be instantiated directly.\n *\n * All 16 `OutputChannel` objects can be found inside the output's [channels]{@link Output#channels}\n * property.\n *\n * The `OutputChannel` class extends the\n * [EventEmitter](https://djipco.github.io/djipevents/EventEmitter.html) class from the\n * [djipevents]{@link https://djipco.github.io/djipevents/index.html} module. This means\n * it also includes methods such as\n * [addListener()](https://djipco.github.io/djipevents/EventEmitter.html#addListener),\n * [removeListener()](https://djipco.github.io/djipevents/EventEmitter.html#removeListener),\n * [hasListener()](https://djipco.github.io/djipevents/EventEmitter.html#hasListener) and several\n * others.\n *\n * @param {Output} output The output this channel belongs to\n * @param {number} number The channel's number (1-16)\n *\n * @since 3.0.0\n */\nclass OutputChannel extends e {\n\n  constructor(output, number) {\n\n    super();\n\n    /**\n     * The {@link Output} this channel belongs to\n     * @type {Output}\n     */\n    this.output = output;\n\n    /**\n     * The channel's number (1-16)\n     * @type {number}\n     */\n    this.number = number;\n\n  }\n\n  /**\n   * Unlinks the MIDI subsystem, removes all listeners attached to the channel and nulls the channel\n   * number. This method is mostly for internal use. It has not been prefixed with an underscore\n   * since it is called by other objects such as the `Output` object.\n   *\n   * @private\n   */\n  destroy() {\n    this.output = null;\n    this.number = null;\n    this.removeListener();\n  }\n\n  /**\n   * Sends a MIDI message at the scheduled timestamp. It is usually not necessary to use this method\n   * directly as you can use one of the simpler helper methods such as `playNote()`, `stopNote()`,\n   * `sendControlChange()`, etc.\n   *\n   * Details on the format of MIDI messages are available in the summary of\n   * [MIDI messages]{@link https://www.midi.org/specifications/item/table-1-summary-of-midi-message}\n   * from the MIDI Manufacturers Association.\n   *\n   * @param status {Number} The MIDI status byte of the message (128-255). This is a combination of\n   * the command and the channel.\n   *\n   * @param {number[]} [data] An array of unsigned integers for the message. The number of data\n   * bytes varies depending on the status byte. It is perfectly legal to send no data for some\n   * message types (use `undefined` or an empty array in this case). Each byte must be between 0 and\n   * 255.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @throws {TypeError} Failed to execute 'send' on 'MIDIOutput': The value at index 0 is greater\n   * than 0xFF.\n   *\n   * @throws {TypeError} Failed to execute 'send' on 'MIDIOutput': The value at index 2 is greater\n   * than 0xFF.\n   *\n   * @throws {TypeError} Failed to execute 'send' on 'MIDIOutput': Running status is not allowed at\n   * index 0.\n   *\n   * @throws {TypeError} Failed to execute 'send' on 'MIDIOutput': Message is incomplete.\n   *\n   * @throws {TypeError} Failed to execute 'send' on 'MIDIOutput': Reserved status is not allowed at\n   * index 0.\n   *\n   * @throws {TypeError} Failed to execute 'send' on 'MIDIOutput': System exclusive message is not\n   * allowed at index 0.\n   *\n   * @throws {TypeError} Failed to execute 'send' on 'MIDIOutput': Unexpected end of system\n   * exclusive message at index 0.\n   *\n   * @throws {TypeError} Failed to execute 'send' on 'MIDIOutput': Unexpected status byte at index\n   * 1.\n   *\n   * @throws {TypeError} Failed to execute 'send' on 'MIDIOutput': Unexpected status byte at index\n   * 2.\n   *\n   * @throw {TypeError} Failed to execute 'send' on 'MIDIOutput': ? is not a UInt8 value.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  send(status, data = [], options = {}) {\n    this.output.send(status, data, options);\n    return this;\n  }\n\n  /**\n   * Sends a MIDI **key aftertouch** message at the scheduled time. This is a key-specific\n   * aftertouch. For a channel-wide aftertouch message, use\n   * [setChannelAftertouch()]{@link Output#setChannelAftertouch}.\n   *\n   * The note can be a single value or an array of the following valid values:\n   *\n   *  - A MIDI note number (integer between `0` and `127`)\n   *  - A note name, followed by the octave (e.g. `\"C3\"`, `\"G#4\"`, `\"F-1\"`, `\"Db7\"`)\n   *  - A {@link Note} object\n   *\n   * @param note {number|string|Note|number[]|string[]|Note[]} The note(s) for which you are sending\n   * an aftertouch value. The notes can be specified by using a MIDI note number (0-127), a note\n   * name (e.g. C3, G#4, F-1, Db7), a {@link Note} object or an array of the previous types. When\n   * using a note name, octave range must be between -1 and 9. The lowest note is C-1 (MIDI note\n   * number 0) and the highest note is G9 (MIDI note number 127).\n   *\n   * @param [pressure=0.5] {number} The pressure level (between 0 and 1). An invalid pressure value\n   * will silently trigger the default behaviour. If the `rawValue` option is set to `true`, the\n   * pressure is defined by using an integer between 0 and 127.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {boolean} [options.useRawValue=false] A boolean indicating whether the value should be\n   * considered a float between 0 and 1.0 (default) or a raw integer between 0 and 127.\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @return {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   *\n   * @throws RangeError Invalid key aftertouch value.\n   */\n  setKeyAftertouch(note, pressure, options = {}) {\n\n    if (wm.validation) {\n\n      // Legacy support\n      if (options.useRawValue) options.rawValue = options.useRawValue;\n\n      if (isNaN(parseFloat(pressure))) {\n        throw new RangeError(\"Invalid key aftertouch value.\");\n      }\n      if (options.rawValue) {\n        if (!(pressure >= 0 && pressure <= 127 && Number.isInteger(pressure))) {\n          throw new RangeError(\"Key aftertouch raw value must be an integer between 0 and 127.\");\n        }\n      } else {\n        if (!(pressure >= 0 && pressure <= 1)) {\n          throw new RangeError(\"Key aftertouch value must be a float between 0 and 1.\");\n        }\n      }\n\n    }\n\n    // Normalize to integer\n    if (!options.rawValue) pressure = Math.round(pressure * 127);\n\n    wm.getValidNoteArray(note, options).forEach(n => {\n      this.send(\n        (wm.MIDI_CHANNEL_VOICE_MESSAGES.keyaftertouch << 4) + (this.number - 1),\n        [n.number, pressure],\n        wm.convertToTimestamp(options.time)\n      );\n    });\n\n    return this;\n\n  }\n\n  /**\n   * Sends a MIDI **control change** message to the channel at the scheduled time. The control\n   * change message to send can be specified numerically or by using one of the following common\n   * names:\n   *\n   *  * `bankselectcoarse` (#0)\n   *  * `modulationwheelcoarse` (#1)\n   *  * `breathcontrollercoarse` (#2)\n   *  * `footcontrollercoarse` (#4)\n   *  * `portamentotimecoarse` (#5)\n   *  * `dataentrycoarse` (#6)\n   *  * `volumecoarse` (#7)\n   *  * `balancecoarse` (#8)\n   *  * `pancoarse` (#10)\n   *  * `expressioncoarse` (#11)\n   *  * `effectcontrol1coarse` (#12)\n   *  * `effectcontrol2coarse` (#13)\n   *  * `generalpurposeslider1` (#16)\n   *  * `generalpurposeslider2` (#17)\n   *  * `generalpurposeslider3` (#18)\n   *  * `generalpurposeslider4` (#19)\n   *  * `bankselectfine` (#32)\n   *  * `modulationwheelfine` (#33)\n   *  * `breathcontrollerfine` (#34)\n   *  * `footcontrollerfine` (#36)\n   *  * `portamentotimefine` (#37)\n   *  * `dataentryfine` (#38)\n   *  * `volumefine` (#39)\n   *  * `balancefine` (#40)\n   *  * `panfine` (#42)\n   *  * `expressionfine` (#43)\n   *  * `effectcontrol1fine` (#44)\n   *  * `effectcontrol2fine` (#45)\n   *  * `holdpedal` (#64)\n   *  * `portamento` (#65)\n   *  * `sustenutopedal` (#66)\n   *  * `softpedal` (#67)\n   *  * `legatopedal` (#68)\n   *  * `hold2pedal` (#69)\n   *  * `soundvariation` (#70)\n   *  * `resonance` (#71)\n   *  * `soundreleasetime` (#72)\n   *  * `soundattacktime` (#73)\n   *  * `brightness` (#74)\n   *  * `soundcontrol6` (#75)\n   *  * `soundcontrol7` (#76)\n   *  * `soundcontrol8` (#77)\n   *  * `soundcontrol9` (#78)\n   *  * `soundcontrol10` (#79)\n   *  * `generalpurposebutton1` (#80)\n   *  * `generalpurposebutton2` (#81)\n   *  * `generalpurposebutton3` (#82)\n   *  * `generalpurposebutton4` (#83)\n   *  * `reverblevel` (#91)\n   *  * `tremololevel` (#92)\n   *  * `choruslevel` (#93)\n   *  * `celestelevel` (#94)\n   *  * `phaserlevel` (#95)\n   *  * `databuttonincrement` (#96)\n   *  * `databuttondecrement` (#97)\n   *  * `nonregisteredparametercoarse` (#98)\n   *  * `nonregisteredparameterfine` (#99)\n   *  * `registeredparametercoarse` (#100)\n   *  * `registeredparameterfine` (#101)\n   *\n   * Note: as you can see above, not all control change message have a matching common name. This\n   * does not mean you cannot use the others. It simply means you will need to use their number\n   * instead of their name.\n   *\n   * To view a detailed list of all available **control change** messages, please consult \"Table 3 -\n   * Control Change Messages\" from the [MIDI Messages](\n   * https://www.midi.org/specifications/item/table-3-control-change-messages-data-bytes-2)\n   * specification.\n   *\n   * @param {number|string} controller The MIDI controller name or number (0-119).\n   *\n   * @param {number} value The value to send (0-127).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @throws {RangeError} Controller numbers must be between 0 and 119.\n   * @throws {RangeError} Invalid controller name.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  sendControlChange(controller, value, options = {}) {\n\n    if (typeof controller === \"string\") {\n      controller = wm.MIDI_CONTROL_CHANGE_MESSAGES[controller];\n    }\n\n    if (wm.validation) {\n      if (controller === undefined) {\n        throw new TypeError(\n          \"Control change must be identified with a valid name or an integer between 0 and 119.\"\n        );\n      }\n\n      if (!Number.isInteger(controller) || !(controller >= 0 && controller <= 119)) {\n        throw new TypeError(\"Control change number must be an integer between 0 and 119.\");\n      }\n\n      if (!Number.isInteger(value) || !(value >= 0 && value <= 127)) {\n        throw new TypeError(\"Control change value must be an integer between 0 and 127\");\n      }\n    }\n\n    this.send(\n      (wm.MIDI_CHANNEL_VOICE_MESSAGES.controlchange << 4) + (this.number - 1),\n      [controller, value],\n      wm.convertToTimestamp(options.time)\n    );\n\n    return this;\n\n  }\n\n  /**\n   * Selects a MIDI non-registered parameter so it is affected by upcoming data entry, data\n   * increment and data decrement messages.\n   *\n   * @param parameter {number[]} A two-position array specifying the two control bytes that identify\n   * the registered parameter. The NRPN MSB (99 or 0x63) is a position 0. The NRPN LSB (98 or 0x62)\n   * is at position 1.\n   *\n   * @private\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  _selectNonRegisteredParameter(parameter, options = {}) {\n\n    // parameter[0] = Math.floor(parameter[0]);\n    // if (!(parameter[0] >= 0 && parameter[0] <= 127)) {\n    //   throw new RangeError(\"The control63 value must be between 0 and 127.\");\n    // }\n    //\n    // parameter[1] = Math.floor(parameter[1]);\n    // if (!(parameter[1] >= 0 && parameter[1] <= 127)) {\n    //   throw new RangeError(\"The control62 value must be between 0 and 127.\");\n    // }\n\n    this.sendControlChange(0x63, parameter[0], options);\n    this.sendControlChange(0x62, parameter[1], options);\n\n    return this;\n\n  }\n\n  /**\n   * Deselects the currently active MIDI registered parameter so it is no longer affected by data\n   * entry, data increment and data decrement messages.\n   *\n   * Current best practice recommends doing that after each call to\n   * [_setCurrentParameter()]{@link OutputChannel#_setCurrentParameter}.\n   *\n   * @private\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  _deselectRegisteredParameter(options = {}) {\n    this.sendControlChange(0x65, 0x7F, options);\n    this.sendControlChange(0x64, 0x7F, options);\n    return this;\n  }\n\n  /**\n   * Deselects the currently active MIDI non-registered parameter so it is no longer affected by\n   * data entry, data increment and data decrement messages.\n   *\n   * @private\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  _deselectNonRegisteredParameter(options = {}) {\n    this.sendControlChange(0x65, 0x7F, options);\n    this.sendControlChange(0x64, 0x7F, options);\n    return this;\n  }\n\n  /**\n   * Selects a MIDI registered parameter so it is affected by upcoming data entry, data increment\n   * and data decrement messages.\n   *\n   * @private\n   *\n   * @param parameter {number[]} A two-position array of integers specifying the two control bytes\n   * (0x65, 0x64) that identify the registered parameter. The integers must be between 0 and 127.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  _selectRegisteredParameter(parameter, options = {}) {\n    this.sendControlChange(0x65, parameter[0], options);\n    this.sendControlChange(0x64, parameter[1], options);\n    return this;\n  }\n\n  /**\n   * Sets the value of the currently selected MIDI registered parameter.\n   *\n   * @private\n   *\n   * @param data {number|number[]}\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  _setCurrentParameter(data, options = {}) {\n\n    data = [].concat(data);\n\n    // MSB\n    // data[0] = parseInt(data[0]);\n    // if (!isNaN(data[0]) && data[0] >= 0 && data[0] <= 127) {\n    this.sendControlChange(0x06, data[0], options);\n    // } else {\n    //   throw new RangeError(\"The msb value must be between 0 and 127.\");\n    // }\n\n    if (data.length < 2) return this;\n\n    // LSB\n    // data[1] = parseInt(data[1]);\n\n    // if (!isNaN(data[1]) && data[1] >= 0 && data[1] <= 127) {\n    this.sendControlChange(0x26, data[1], options);\n    // } else {\n    //   throw new RangeError(\"The lsb value must be between 0 and 127.\");\n    // }\n\n    return this;\n\n  }\n\n  /**\n   * Decrements the specified MIDI registered parameter by 1. Here is the full list of parameter\n   * names that can be used with this function:\n   *\n   *  * Pitchbend Range (0x00, 0x00): `\"pitchbendrange\"`\n   *  * Channel Fine Tuning (0x00, 0x01): `\"channelfinetuning\"`\n   *  * Channel Coarse Tuning (0x00, 0x02): `\"channelcoarsetuning\"`\n   *  * Tuning Program (0x00, 0x03): `\"tuningprogram\"`\n   *  * Tuning Bank (0x00, 0x04): `\"tuningbank\"`\n   *  * Modulation Range (0x00, 0x05): `\"modulationrange\"`\n   *  * Azimuth Angle (0x3D, 0x00): `\"azimuthangle\"`\n   *  * Elevation Angle (0x3D, 0x01): `\"elevationangle\"`\n   *  * Gain (0x3D, 0x02): `\"gain\"`\n   *  * Distance Ratio (0x3D, 0x03): `\"distanceratio\"`\n   *  * Maximum Distance (0x3D, 0x04): `\"maximumdistance\"`\n   *  * Maximum Distance Gain (0x3D, 0x05): `\"maximumdistancegain\"`\n   *  * Reference Distance Ratio (0x3D, 0x06): `\"referencedistanceratio\"`\n   *  * Pan Spread Angle (0x3D, 0x07): `\"panspreadangle\"`\n   *  * Roll Angle (0x3D, 0x08): `\"rollangle\"`\n   *\n   * @param parameter {String|number[]} A string identifying the parameter's name (see above) or a\n   * two-position array specifying the two control bytes (0x65, 0x64) that identify the registered\n   * parameter.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @throws TypeError The specified registered parameter is invalid.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  decrementRegisteredParameter(parameter, options = {}) {\n\n    if (!Array.isArray(parameter)) parameter = wm.MIDI_REGISTERED_PARAMETER[parameter];\n\n    if (wm.validation) {\n      if (parameter === undefined) {\n        throw new TypeError(\"The specified registered parameter is invalid.\");\n      }\n\n      let valid = false;\n\n      Object.getOwnPropertyNames(wm.MIDI_REGISTERED_PARAMETER).forEach(p => {\n        if (\n          wm.MIDI_REGISTERED_PARAMETER[p][0] === parameter[0] &&\n          wm.MIDI_REGISTERED_PARAMETER[p][1] === parameter[1]\n        ) {\n          valid = true;\n        }\n      });\n\n      if (!valid) throw new TypeError(\"The specified registered parameter is invalid.\");\n    }\n\n    this._selectRegisteredParameter(parameter, options);\n    this.sendControlChange(0x61, 0, options);\n    this._deselectRegisteredParameter(options);\n\n    return this;\n\n  }\n\n  /**\n   * Increments the specified MIDI registered parameter by 1. Here is the full list of parameter\n   * names that can be used with this function:\n   *\n   *  * Pitchbend Range (0x00, 0x00): `\"pitchbendrange\"`\n   *  * Channel Fine Tuning (0x00, 0x01): `\"channelfinetuning\"`\n   *  * Channel Coarse Tuning (0x00, 0x02): `\"channelcoarsetuning\"`\n   *  * Tuning Program (0x00, 0x03): `\"tuningprogram\"`\n   *  * Tuning Bank (0x00, 0x04): `\"tuningbank\"`\n   *  * Modulation Range (0x00, 0x05): `\"modulationrange\"`\n   *  * Azimuth Angle (0x3D, 0x00): `\"azimuthangle\"`\n   *  * Elevation Angle (0x3D, 0x01): `\"elevationangle\"`\n   *  * Gain (0x3D, 0x02): `\"gain\"`\n   *  * Distance Ratio (0x3D, 0x03): `\"distanceratio\"`\n   *  * Maximum Distance (0x3D, 0x04): `\"maximumdistance\"`\n   *  * Maximum Distance Gain (0x3D, 0x05): `\"maximumdistancegain\"`\n   *  * Reference Distance Ratio (0x3D, 0x06): `\"referencedistanceratio\"`\n   *  * Pan Spread Angle (0x3D, 0x07): `\"panspreadangle\"`\n   *  * Roll Angle (0x3D, 0x08): `\"rollangle\"`\n   *\n   * @param parameter {String|number[]} A string identifying the parameter's name (see above) or a\n   * two-position array specifying the two control bytes (0x65, 0x64) that identify the registered\n   * parameter.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @throws TypeError The specified registered parameter is invalid.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  incrementRegisteredParameter(parameter, options = {}) {\n\n    if (!Array.isArray(parameter)) parameter = wm.MIDI_REGISTERED_PARAMETER[parameter];\n\n    if (wm.validation) {\n      if (parameter === undefined) {\n        throw new TypeError(\"The specified registered parameter is invalid.\");\n      }\n\n      let valid = false;\n\n      Object.getOwnPropertyNames(wm.MIDI_REGISTERED_PARAMETER).forEach(p => {\n        if (\n          wm.MIDI_REGISTERED_PARAMETER[p][0] === parameter[0] &&\n          wm.MIDI_REGISTERED_PARAMETER[p][1] === parameter[1]\n        ) {\n          valid = true;\n        }\n      });\n\n      if (!valid) throw new TypeError(\"The specified registered parameter is invalid.\");\n    }\n\n    this._selectRegisteredParameter(parameter, options);\n    this.sendControlChange(0x60, 0, options);\n    this._deselectRegisteredParameter(options);\n\n    return this;\n\n  }\n\n  /**\n   * Plays a note or an array of notes on the channel. The first parameter is the note to play. It\n   * can be a single value or an array of the following valid values:\n   *\n   *  - A MIDI note number (integer between `0` and `127`)\n   *  - A note name, followed by the octave (e.g. `\"C3\"`, `\"G#4\"`, `\"F-1\"`, `\"Db7\"`)\n   *  - A {@link Note} object\n   *\n   * The `playNote()` method sends a **note on** MIDI message for all specified notes on all\n   * specified channels. If a `duration` is set in the `options` parameter or in the {@link Note}\n   * object's [duration]{@link Note#duration} property, it will also schedule a **note off** message\n   * to end the note after said duration. If no `duration` is set, the note will simply play until\n   * a matching **note off** message is sent with [stopNote()]{@link OutputChannel#stopNote} or\n   * [sendNoteOff()]{@link OutputChannel#sendNoteOff}.\n   *\n   *  The execution of the **note on** command can be delayed by using the `time` property of the\n   * `options` parameter.\n   *\n   * When using {@link Note} objects, the durations and velocities defined in the {@link Note}\n   * objects have precedence over the ones specified via the method's `options` parameter.\n   *\n   * **Note**: As per the MIDI standard, a **note on** message with an attack velocity of `0` is\n   * functionally equivalent to a **note off** message.\n   *\n   * @param note {number|string|Note|number[]|string[]|Note[]} The note(s) to play. The notes can be\n   * specified by using a MIDI note number (0-127), a note name (e.g. C3, G#4, F-1, Db7), a\n   * {@link Note} object or an array of the previous types. When using a note name, octave range\n   * must be between -1 and 9. The lowest note is C-1 (MIDI note number 0) and the highest\n   * note is G9 (MIDI note number 127).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number} [options.duration] A positive number larger than 0 representing the number of\n   * milliseconds to wait before sending a **note off** message. If invalid or left undefined, only\n   * a **note on** message will be sent.\n   *\n   * @param {number} [options.attack=0.5] The velocity at which to play the note (between `0` and\n   * `1`). If the `rawAttack` option is also defined, it will have priority. An invalid velocity\n   * value will silently trigger the default of `0.5`.\n   *\n   * @param {number} [options.rawAttack=0.5] The attack velocity at which to play the note (between\n   * `0` and `127`). This has priority over the `attack` property. An invalid velocity value will\n   * silently trigger the default of `0.5`.\n   *\n   * @param {number} [options.release=0.5] The velocity at which to release the note (between `0`\n   * and `1`). If the `rawRelease` option is also defined, it will have priority. An invalid\n   * velocity value will silently trigger the default of `0.5`. This is only used with the\n   * **note off** event triggered when `options.duration` is set.\n   *\n   * @param {number} [options.rawRelease=0.5] The velocity at which to release the note (between `0`\n   * and `127`). This has priority over the `release` property. An invalid velocity value will\n   * silently trigger the default of `0.5`. This is only used with the **note off** event triggered\n   * when `options.duration` is set.\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  playNote(note, options = {}) {\n\n    // Send note on and, optionally, note off message (if duration is a positive number)\n    this.sendNoteOn(note, options);\n\n    // https://stackoverflow.com/questions/600763#answer-601877\n    if (options.duration > 0 && isFinite(String(options.duration).trim() || NaN)) {\n\n      let noteOffOptions = {\n        time: wm.convertToTimestamp(options.time) + options.duration,\n        release: options.release,\n        rawRelease: options.rawRelease,\n      };\n\n      this.sendNoteOff(note, noteOffOptions);\n\n    }\n\n    return this;\n\n  }\n\n  /**\n   * Sends a **note off** message for the specified notes on the channel. The first parameter is the\n   * note. It can be a single value or an array of the following valid values:\n   *\n   *  - A MIDI note number (integer between `0` and `127`)\n   *  - A note name, followed by the octave (e.g. `\"C3\"`, `\"G#4\"`, `\"F-1\"`, `\"Db7\"`)\n   *  - A {@link Note} object\n   *\n   *  The execution of the **note off** command can be delayed by using the `time` property of the\n   * `options` parameter.\n   *\n   * When using {@link Note} objects, the release velocity defined in the {@link Note} objects has\n   * precedence over the one specified via the method's `options` parameter.\n   *\n   * @param note {number|string|Note|number[]|string[]|Note[]} The note(s) to stop. The notes can be\n   * specified by using a MIDI note number (0-127), a note name (e.g. C3, G#4, F-1, Db7), a\n   * {@link Note} object or an array of the previous types. When using a note name, octave range\n   * must be between -1 and 9. The lowest note is C-1 (MIDI note number 0) and the highest\n   * note is G9 (MIDI note number 127).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @param {number} [options.release=0.5] The velocity at which to release the note\n   * (between `0` and `1`).  If the `rawRelease` option is also defined, `rawRelease` will have\n   * priority. An invalid velocity value will silently trigger the default of `0.5`.\n   *\n   * @param {number} [options.rawRelease=64] The velocity at which to release the note\n   * (between `0` and `127`). If the `release` option is also defined, `rawRelease` will have\n   * priority. An invalid velocity value will silently trigger the default of `64`.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  sendNoteOff(note, options = {}) {\n\n    if (wm.validation) {\n\n      if (\n        options.rawRelease != undefined &&\n        !(options.rawRelease >= 0 && options.rawRelease <= 127)\n      ) {\n        throw new RangeError(\"The 'rawRelease' option must be an integer between 0 and 127\");\n      }\n\n      if (options.release != undefined && !(options.release >= 0 && options.release <= 1)) {\n        throw new RangeError(\"The 'release' option must be an number between 0 and 1\");\n      }\n\n      // Legacy compatibility warnings\n      if (options.rawVelocity) {\n        options.rawRelease = options.velocity;\n        console.warn(\"The 'rawVelocity' option is deprecated. Use 'rawRelease' instead.\");\n      }\n      if (options.velocity) {\n        options.release = options.velocity;\n        console.warn(\"The 'velocity' option is deprecated. Use 'attack' instead.\");\n      }\n\n    }\n\n\n\n    let nVelocity = 64;\n\n    if (options.rawRelease != undefined) {\n      nVelocity = options.rawRelease;\n    } else {\n      if (!isNaN(options.release)) nVelocity = Math.round(options.release * 127);\n    }\n\n    // Send note off messages\n    let o = {rawRelease: parseInt(nVelocity)};\n\n    wm.getValidNoteArray(note, o).forEach(n => {\n      this.send(\n        (wm.MIDI_CHANNEL_VOICE_MESSAGES.noteoff << 4) + (this.number - 1),\n        [n.number, n.rawRelease],\n        wm.convertToTimestamp(options.time)\n      );\n    });\n\n    return this;\n\n  }\n\n  /**\n   * This is an alias to the [sendNoteOff()]{@link OutputChannel#sendNoteOff} method.\n   *\n   * @see {@link OutputChannel#sendNoteOff}\n   *\n   * @param note\n   * @param options\n   * @returns {Output}\n   */\n  stopNote(note, options = {}) {\n    return this.sendNoteOff(note, options);\n  }\n\n  /**\n   * Sends a **note on** message for the specified notes on the channel. The first parameter is the\n   * note. It can be a single value or an array of the following valid values:\n   *\n   *  - A MIDI note number (integer between `0` and `127`)\n   *  - A note name, followed by the octave (e.g. `\"C3\"`, `\"G#4\"`, `\"F-1\"`, `\"Db7\"`)\n   *  - A {@link Note} object\n   *\n   *  The execution of the **note on** command can be delayed by using the `time` property of the\n   * `options` parameter.\n   *\n   * When using {@link Note} objects, the attack velocity defined in the {@link Note} objects has\n   * precedence over the one specified via the method's `options` parameter. Also, the `duration` is\n   * ignored. If you want to also send a **note off** message, use the\n   * [playNote()]{@link Output#playNote} method instead.\n   *\n   * **Note**: As per the MIDI standard, a **note on** message with an attack velocity of `0` is\n   * functionally equivalent to a **note off** message.\n   *\n   * @param note {number|string|Note|number[]|string[]|Note[]} The note(s) to play. The notes can be\n   * specified by using a MIDI note number (0-127), a note name (e.g. C3, G#4, F-1, Db7), a\n   * {@link Note} object or an array of the previous types. When using a note name, octave range\n   * must be between -1 and 9. The lowest note is C-1 (MIDI note number 0) and the highest\n   * note is G9 (MIDI note number 127).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @param {number} [options.attack=0.5] The velocity at which to play the note (between `0` and\n   * `1`).  If the `rawAttack` option is also defined, `rawAttack` will have priority. An invalid\n   * velocity value will silently trigger the default of `0.5`.\n   *\n   * @param {number} [options.rawAttack=64] The velocity at which to release the note (between `0`\n   * and `127`). If the `attack` option is also defined, `rawAttack` will have priority. An invalid\n   * velocity value will silently trigger the default of `64`.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  sendNoteOn(note, options = {}) {\n\n    if (wm.validation) {\n\n      if (options.rawAttack != undefined && !(options.rawAttack >= 0 && options.rawAttack <= 127)) {\n        throw new RangeError(\"The 'rawAttack' option must be an integer between 0 and 127\");\n      }\n\n      if (options.attack != undefined && !(options.attack >= 0 && options.attack <= 1)) {\n        throw new RangeError(\"The 'attack' option must be an number between 0 and 1\");\n      }\n\n      // Legacy compatibility warnings\n      if (options.rawVelocity) {\n        options.rawAttack = options.velocity;\n        options.rawRelease = options.release;\n        console.warn(\"The 'rawVelocity' option is deprecated. Use 'rawAttack' or 'rawRelease'.\");\n      }\n      if (options.velocity) {\n        options.attack = options.velocity;\n        console.warn(\"The 'velocity' option is deprecated. Use 'attack' instead.\");\n      }\n\n    }\n\n    let nVelocity = 64;\n\n    if (options.rawAttack != undefined) {\n      nVelocity = options.rawAttack;\n    } else {\n      if (!isNaN(options.attack)) nVelocity = Math.round(options.attack * 127);\n    }\n\n    let o = {rawAttack: nVelocity};\n\n    wm.getValidNoteArray(note, o).forEach(n => {\n      this.send(\n        (wm.MIDI_CHANNEL_VOICE_MESSAGES.noteon << 4) + (this.number - 1),\n        [n.number, n.rawAttack],\n        wm.convertToTimestamp(options.time)\n      );\n    });\n\n    return this;\n\n  }\n\n  /**\n   * Sends a MIDI **channel mode** message. The channel mode message to send can be specified\n   * numerically or by using one of the following common names:\n   *\n   *   * `\"allsoundoff\"` (#120)\n   *   * `\"resetallcontrollers\"` (#121)\n   *   * `\"localcontrol\"` (#122)\n   *   * `\"allnotesoff\"` (#123)\n   *   * `\"omnimodeoff\"` (#124)\n   *   * `\"omnimodeon\"` (#125)\n   *   * `\"monomodeon\"` (#126)\n   *   * `\"polymodeon\"` (#127)\n   *\n   * It should be noted that, per the MIDI specification, only `localcontrol` and `monomodeon` may\n   * require a value that's not zero. For that reason, the `value` parameter is optional and\n   * defaults to 0.\n   *\n   * To make it easier, all channel mode messages have a matching helper method:\n   *\n   *   - [turnSoundOff()]{@link Output#turnSoundOff}\n   *   - [resetAllControllers()]{@link Output#resetAllControllers}\n   *   - [setLocalControl()]{@link Output#turnSoundOff}\n   *   - [turnNotesOff()]{@link Output#turnNotesOff}\n   *   - [setOmniMode()]{@link Output#setOmniMode}\n   *   - [setPolyphonicMode()]{@link Output#setPolyphonicMode}\n   *\n   * @param command {number|string} The numerical identifier of the channel mode message (integer\n   * between 120-127) or its name as a string.\n   *\n   * @param value {number} The value to send (integer between 0-127).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  sendChannelMode(command, value, options = {}) {\n\n    // Normalize command to integer\n    if (typeof command === \"string\") command = wm.MIDI_CHANNEL_MODE_MESSAGES[command];\n\n    if (wm.validation) {\n\n      if (command === undefined) {\n        throw new TypeError(\"Invalid channel mode message name or number.\");\n      }\n\n      if (isNaN(command) || !(command >= 120 && command <= 127)) {\n        throw new TypeError(\"Invalid channel mode message number.\");\n      }\n\n      if (isNaN(parseInt(value)) || value < 0 || value > 127) {\n        throw new RangeError(\"Value must be an integer between 0 and 127.\");\n      }\n\n    }\n\n    this.send(\n      (wm.MIDI_CHANNEL_VOICE_MESSAGES.channelmode << 4) + (this.number - 1),\n      [command, value],\n      wm.convertToTimestamp(options.time)\n    );\n\n    return this;\n\n  }\n\n  /**\n   * Sets OMNI mode to `\"on\"` or `\"off\"`. MIDI's OMNI mode causes the instrument to respond to\n   * messages from all channels.\n   *\n   * It should be noted that support for OMNI mode is not as common as it used to be.\n   *\n   * @param [state=true] {boolean} Whether to activate OMNI mode (`true`) or not (`false`).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @throws {TypeError} Invalid channel mode message name.\n   * @throws {RangeError} Channel mode controller numbers must be between 120 and 127.\n   * @throws {RangeError} Value must be an integer between 0 and 127.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  setOmniMode(state, options = {}) {\n\n    if (state === undefined || state) {\n      this.sendChannelMode(\"omnimodeon\", 0, options);\n    } else {\n      this.sendChannelMode(\"omnimodeoff\", 0, options);\n    }\n\n    return this;\n\n  }\n\n  /**\n   * Sends a MIDI **channel aftertouch** message. For key-specific aftertouch, you should instead\n   * use [setKeyAftertouch()]{@link Output#setKeyAftertouch}.\n   *\n   * @param [pressure] {number} The pressure level (between 0 and 1). If the `rawValue` option is\n   * set to `true`, the pressure can be defined by using an integer between 0 and 127.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {boolean} [options.rawValue=false] A boolean indicating whether the value should be\n   * considered a float between 0 and 1.0 (default) or a raw integer between 0 and 127.\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   *\n   * @throws RangeError Invalid channel aftertouch value.\n   */\n  setChannelAftertouch(pressure, options = {}) {\n\n    if (wm.validation) {\n\n      if (isNaN(parseFloat(pressure))) {\n        throw new RangeError(\"Invalid channel aftertouch value.\");\n      }\n\n      if (options.rawValue) {\n        if (!(pressure >= 0 && pressure <= 127 && Number.isInteger(pressure))) {\n          throw new RangeError(\n            \"Channel aftertouch raw value must be an integer between 0 and 127.\")\n          ;\n        }\n      } else {\n        if (!(pressure >= 0 && pressure <= 1)) {\n          throw new RangeError(\"Channel aftertouch value must be a float between 0 and 1.\");\n        }\n      }\n\n    }\n\n    this.send(\n      (wm.MIDI_CHANNEL_VOICE_MESSAGES.channelaftertouch << 4) + (this.number - 1),\n      [Math.round(pressure * 127)],\n      wm.convertToTimestamp(options.time)\n    );\n\n    return this;\n\n  }\n\n  /**\n   * Sends a **master tuning** message. The value is decimal and must be larger than -65 semitones\n   * and smaller than 64 semitones.\n   *\n   * Because of the way the MIDI specification works, the decimal portion of the value will be\n   * encoded with a resolution of 14bit. The integer portion must be between -64 and 63\n   * inclusively. This function actually generates two MIDI messages: a **Master Coarse Tuning** and\n   * a **Master Fine Tuning** RPN messages.\n   *\n   * @param [value=0.0] {number} The desired decimal adjustment value in semitones (-65 < x < 64)\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @throws {RangeError} The value must be a decimal number between larger than -65 and smaller\n   * than 64.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  setMasterTuning(value, options = {}) {\n\n    value = parseFloat(value) || 0.0;\n\n    if (wm.validation) {\n\n      if (!(value > -65 && value < 64)) {\n        throw new RangeError(\n          \"The value must be a decimal number larger than -65 and smaller than 64.\"\n        );\n      }\n\n    }\n\n    let coarse = Math.floor(value) + 64;\n    let fine = value - Math.floor(value);\n\n    // Calculate MSB and LSB for fine adjustment (14bit resolution)\n    fine = Math.round((fine + 1) / 2 * 16383);\n    let msb = (fine >> 7) & 0x7F;\n    let lsb = fine & 0x7F;\n\n    this.setRegisteredParameter(\"channelcoarsetuning\", coarse, options);\n    this.setRegisteredParameter(\"channelfinetuning\", [msb, lsb], options);\n\n    return this;\n\n  }\n\n  /**\n   * Sends a **modulation depth range** message to adjust the depth of the modulation wheel's range.\n   * The range can be specified with the `semitones` parameter, the `cents` parameter or by\n   * specifying both parameters at the same time.\n   *\n   * @param {number} semitones The desired adjustment value in semitones (integer between 0 and\n   * 127).\n   *\n   * @param {number} [cents=0] The desired adjustment value in cents (integer between 0 and 127).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  setModulationRange(semitones, cents, options = {}) {\n\n    if (wm.validation) {\n\n      if (!Number.isInteger(semitones) || !(semitones >= 0 && semitones <= 127)) {\n        throw new RangeError(\"The semitones value must be an integer between 0 and 127.\");\n      }\n\n      if (!(cents == undefined) && (!Number.isInteger(cents) || !(cents >= 0 && cents <= 127))) {\n        throw new RangeError(\"If specified, the cents value must be an integer between 0 and 127.\");\n      }\n\n    }\n\n    // Default value for cents\n    if (!(cents >= 0 && cents <= 127)) cents = 0;\n\n    this.setRegisteredParameter(\"modulationrange\", [semitones, cents], options);\n\n    return this;\n\n  }\n\n  /**\n   * Sets a non-registered parameter (NRPN) to the specified value. The NRPN is selected by passing\n   * in a two-position array specifying the values of the two control bytes. The value is specified\n   * by passing in a single integer (most cases) or an array of two integers.\n   *\n   * NRPNs are not standardized in any way. Each manufacturer is free to implement them any way\n   * they see fit. For example, according to the Roland GS specification, you can control the\n   * **vibrato rate** using NRPN (1, 8). Therefore, to set the **vibrato rate** value to **123** you\n   * would use:\n   *\n   * ```js\n   * WebMidi.outputs[0].channels[0].setNonRegisteredParameter([1, 8], 123);\n   * ```\n   *\n   * In some rarer cases, you need to send two values with your NRPN messages. In such cases, you\n   * would use a 2-position array. For example, for its **ClockBPM** parameter (2, 63), Novation\n   * uses a 14-bit value that combines an MSB and an LSB (7-bit values). So, for example, if the\n   * value to send was 10, you could use:\n   *\n   * ```js\n   * WebMidi.outputs[0].channels[0].setNonRegisteredParameter([2, 63], [0, 10]);\n   * ```\n   *\n   * For further implementation details, refer to the manufacturer's documentation.\n   *\n   * @param parameter {number[]} A two-position array specifying the two control bytes (0x63,\n   * 0x62) that identify the non-registered parameter.\n   *\n   * @param [data=[]] {number|number[]} An integer or an array of integers with a length of 1 or 2\n   * specifying the desired data.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @throws {RangeError} The control value must be between 0 and 127.\n   * @throws {RangeError} The msb value must be between 0 and 127\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  setNonRegisteredParameter(nrpn, data, options = {}) {\n\n    data = [].concat(data);\n\n    if (wm.validation) {\n\n      if (!Array.isArray(nrpn) || !Number.isInteger(nrpn[0]) || !Number.isInteger(nrpn[1])) {\n        throw new TypeError(\"The specified NRPN is invalid.\");\n      }\n\n      if (!(nrpn[0] >= 0 && nrpn[0] <= 127)) {\n        throw new RangeError(\"The first byte of the NRPN must be between 0 and 127.\");\n      }\n\n      if (!(nrpn[1] >= 0 && nrpn[1] <= 127)) {\n        throw new RangeError(\"The second byte of the NRPN must be between 0 and 127.\");\n      }\n\n      data.forEach(value => {\n        if (!(value >= 0 && value <= 127)) {\n          throw new RangeError(\"The data bytes of the NRPN must be between 0 and 127.\");\n        }\n      });\n\n    }\n\n    this._selectNonRegisteredParameter(nrpn, options);\n    this._setCurrentParameter(data, options);\n    this._deselectNonRegisteredParameter(options);\n\n    return this;\n\n  }\n\n  /**\n   * Sends a MIDI **pitch bend** message at the scheduled time.\n   *\n   * @param {number|number[]} [value] The intensity of the bend (between -1.0 and 1.0). A value of\n   * zero means no bend. The resulting bend is relative to the pitch bend range that has been\n   * defined. The range can be set with [setPitchBendRange()]{@link OutputChannel#setPitchBendRange}\n   * . So, for example, if the pitch bend range has been set to 12 semitones, using a bend value of\n   * -1 will bend the note 1 octave below its nominal value.\n   *\n   * If the `rawValue` option is set to `true`, the intensity of the bend can be defined by either\n   * using a single integer between 0 and 127 (MSB) or an array of two integers between 0 and 127\n   * representing, respectively, the MSB (most significant byte) and the LSB (least significant\n   * byte). The MSB is expressed in semitones with `64` meaning no bend. A value lower than `64`\n   * bends downwards while a value higher than `64` bends upwards. The LSB is expressed in cents\n   * (1/100 of a semitone). An LSB of `64` also means no bend.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {boolean} [options.rawValue=false] A boolean indicating whether the value should be\n   * considered as a float between -1.0 and 1.0 (default) or as raw integer between 0 and 127 (or\n   * an array of 2 integers if using both MSB and LSB).\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  setPitchBend(value, options = {}) {\n\n    if (wm.validation) {\n\n      if (options.rawValue && Array.isArray(value)) {\n\n        if (!(value[0] >= 0 && value[0] <= 127)) {\n          throw new RangeError(\"The pitch bend MSB must be an integer between 0 and 127.\");\n        }\n        if (!(value[1] >= 0 && value[1] <= 127)) {\n          throw new RangeError(\"The pitch bend LSB must be an integer between 0 and 127.\");\n        }\n\n      } else if (options.rawValue && !Array.isArray(value)) {\n\n        if (!(value >= 0 && value <= 127)) {\n          throw new RangeError(\"The pitch bend MSB must be an integer between 0 and 127.\");\n        }\n\n      } else {\n\n        if (isNaN(value) || value === null) {\n          throw new RangeError(\"Invalid pitch bend value.\");\n        }\n\n        if (!(value >= -1 && value <= 1)) {\n          throw new RangeError(\"The pitch bend MSB must be an integer between 0 and 127.\");\n        }\n\n      }\n\n    }\n\n    let msb = 0;\n    let lsb = 0;\n\n    // Calculate MSB and LSB for both scenarios\n    if (options.rawValue && Array.isArray(value)) {\n      msb = value[0];\n      lsb = value[1];\n    } else if (options.rawValue && !Array.isArray(value)) {\n      msb = value;\n    } else {\n      let nLevel = Math.round((value + 1) / 2 * 16383);\n      msb = (nLevel >> 7) & 0x7F;\n      lsb = nLevel & 0x7F;\n    }\n\n    this.send(\n      (wm.MIDI_CHANNEL_VOICE_MESSAGES.pitchbend << 4) + (this.number - 1),\n      [lsb, msb],\n      wm.convertToTimestamp(options.time)\n    );\n\n    return this;\n\n  }\n\n  /**\n   * Sends a pitch bend range message to the specified channel(s) at the scheduled time so that they\n   * adjust the range used by their pitch bend lever. The range is specified by using the\n   * `semitones` and `cents` parameters. For example, setting the `semitones` parameter to `12`\n   * means that the pitch bend range will be 12 semitones above and below the nominal pitch.\n   *\n   * @param semitones {number} The desired adjustment value in semitones (between 0 and 127). While\n   * nothing imposes that in the specification, it is very common for manufacturers to limit the\n   * range to 2 octaves (-12 semitones to 12 semitones).\n   *\n   * @param [cents=0] {number} The desired adjustment value in cents (integer between 0-127).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @throws {RangeError} The msb value must be between 0 and 127.\n   * @throws {RangeError} The lsb value must be between 0 and 127.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  setPitchBendRange(semitones, cents, options = {}) {\n\n    if (wm.validation) {\n\n      if (!Number.isInteger(semitones) || !(semitones >= 0 && semitones <= 127)) {\n        throw new RangeError(\"The semitones value must be an integer between 0 and 127.\");\n      }\n\n      if (!Number.isInteger(cents) || !(cents >= 0 && cents <= 127)) {\n        throw new RangeError(\"The cents value must be an integer between 0 and 127.\");\n      }\n\n    }\n\n    this.setRegisteredParameter(\"pitchbendrange\", [semitones, cents], options);\n    return this;\n\n  }\n\n  /**\n   * Sends a MIDI **program change** message at the scheduled time.\n   *\n   * **Note**: since version 3.0, the program number is an integer between 1 and 128. In versions\n   * 1.0 and 2.0, the number was between 0 and 127. This change aligns WebMidi.js with most devices\n   * that use a numbering scheme starting at 1.\n   *\n   * @param [program=1] {number} The MIDI patch (program) number (1-128)\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @throws {TypeError} Failed to execute 'send' on 'MIDIOutput': The value at index 1 is greater\n   * than 0xFF.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   *\n   */\n  setProgram(program, options = {}) {\n\n    program = parseInt(program) || 1;\n\n    if (wm.validation) {\n\n      if (!(program >= 1 && program <= 128)) {\n        throw new RangeError(\"The program number must be between 1 and 128.\");\n      }\n\n    }\n\n    this.send(\n      (wm.MIDI_CHANNEL_VOICE_MESSAGES.programchange << 4) + (this.number - 1),\n      [program - 1],\n      wm.convertToTimestamp(options.time)\n    );\n\n    return this;\n\n  }\n\n  /**\n   * Sets the specified MIDI registered parameter to the desired value. The value is defined with\n   * up to two bytes of data (msb, lsb) that each can go from 0 to 127.\n   *\n   * MIDI\n   * [registered parameters]\n   * (https://www.midi.org/specifications-old/item/table-3-control-change-messages-data-bytes-2)\n   * extend the original list of control change messages. The MIDI 1.0 specification lists only a\n   * limited number of them. Here are the original registered parameters with the identifier that\n   * can be used as the first parameter of this function:\n   *\n   *  * Pitchbend Range (0x00, 0x00): `\"pitchbendrange\"`\n   *  * Channel Fine Tuning (0x00, 0x01): `\"channelfinetuning\"`\n   *  * Channel Coarse Tuning (0x00, 0x02): `\"channelcoarsetuning\"`\n   *  * Tuning Program (0x00, 0x03): `\"tuningprogram\"`\n   *  * Tuning Bank (0x00, 0x04): `\"tuningbank\"`\n   *  * Modulation Range (0x00, 0x05): `\"modulationrange\"`\n   *\n   * Note that the **Tuning Program** and **Tuning Bank** parameters are part of the *MIDI Tuning\n   * Standard*, which is not widely implemented.\n   *\n   * Another set of extra parameters have been later added for 3D sound controllers. They are:\n   *\n   *  * Azimuth Angle (0x3D, 0x00): `\"azimuthangle\"`\n   *  * Elevation Angle (0x3D, 0x01): `\"elevationangle\"`\n   *  * Gain (0x3D, 0x02): `\"gain\"`\n   *  * Distance Ratio (0x3D, 0x03): `\"distanceratio\"`\n   *  * Maximum Distance (0x3D, 0x04): `\"maximumdistance\"`\n   *  * Maximum Distance Gain (0x3D, 0x05): `\"maximumdistancegain\"`\n   *  * Reference Distance Ratio (0x3D, 0x06): `\"referencedistanceratio\"`\n   *  * Pan Spread Angle (0x3D, 0x07): `\"panspreadangle\"`\n   *  * Roll Angle (0x3D, 0x08): `\"rollangle\"`\n   *\n   * @param parameter {string|number[]} A string identifying the parameter's name (see above) or a\n   * two-position array specifying the two control bytes (e.g. `[0x65, 0x64]`) that identify the\n   * registered parameter.\n   *\n   * @param [data=[]] {number|number[]} An single integer or an array of integers with a maximum\n   * length of 2 specifying the desired data.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  setRegisteredParameter(rpn, data, options = {}) {\n\n    if (!Array.isArray(rpn)) rpn = wm.MIDI_REGISTERED_PARAMETER[rpn];\n\n    if (wm.validation) {\n\n      if (!Number.isInteger(rpn[0]) || !Number.isInteger(rpn[1])) {\n        throw new TypeError(\"The specified NRPN is invalid.\");\n      }\n\n      if (!(rpn[0] >= 0 && rpn[0] <= 127)) {\n        throw new RangeError(\"The first byte of the RPN must be between 0 and 127.\");\n      }\n\n      if (!(rpn[1] >= 0 && rpn[1] <= 127)) {\n        throw new RangeError(\"The second byte of the RPN must be between 0 and 127.\");\n      }\n\n      [].concat(data).forEach(value => {\n        if (!(value >= 0 && value <= 127)) {\n          throw new RangeError(\"The data bytes of the RPN must be between 0 and 127.\");\n        }\n      });\n\n    }\n\n    this._selectRegisteredParameter(rpn, options);\n    this._setCurrentParameter(data, options);\n    this._deselectRegisteredParameter(options);\n\n    return this;\n\n  }\n\n  /**\n   * Sets the MIDI tuning bank to use. Note that the **Tuning Bank** parameter is part of the\n   * *MIDI Tuning Standard*, which is not widely implemented.\n   *\n   * **Note**: since version 3.0, the bank number is an integer between 1 and 128. In versions\n   * 1.0 and 2.0, the number was between 0 and 127. This change aligns WebMidi.js with most devices\n   * that use a numbering scheme starting at 1.\n   *\n   * @param value {number} The desired tuning bank (1-128).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @throws {RangeError} The bank value must be between 1 and 128.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  setTuningBank(value, options = {}) {\n\n    if (wm.validation) {\n\n      if (!Number.isInteger(value) || !(value >= 1 && value <= 128)) {\n        throw new RangeError(\"The tuning bank number must be between 1 and 128.\");\n      }\n\n    }\n\n    this.setRegisteredParameter(\"tuningbank\", value - 1, options);\n    return this;\n\n  }\n\n  /**\n   * Sets the MIDI tuning program to use. Note that the **Tuning Program** parameter is part of the\n   * *MIDI Tuning Standard*, which is not widely implemented.\n   *\n   * **Note**: since version 3.0, the program number is an integer between 1 and 128. In versions\n   * 1.0 and 2.0, the number was between 0 and 127. This change aligns WebMidi.js with most devices\n   * that use a numbering scheme starting at 1.\n   *\n   * @param value {number} The desired tuning program (1-128).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @throws {RangeError} The program value must be between 1 and 128.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  setTuningProgram(value, options = {}) {\n\n    if (wm.validation) {\n\n      if (!Number.isInteger(value) || !(value >= 1 && value <= 128)) {\n        throw new RangeError(\"The tuning program number must be between 1 and 128.\");\n      }\n\n    }\n\n    this.setRegisteredParameter(\"tuningprogram\", value - 1, options);\n    return this;\n\n  }\n\n  /**\n   * Turns local control on or off. Local control is usually enabled by default. If you disable it,\n   * the instrument will no longer trigger its own sounds. It will only send the MIDI messages to\n   * its out port.\n   *\n   * @param [state=false] {boolean} Whether to activate local control (`true`) or disable it\n   * (`false`).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  setLocalControl(state, options = {}) {\n    if (state) {\n      return this.sendChannelMode(\"localcontrol\", 127, options);\n    } else {\n      return this.sendChannelMode(\"localcontrol\", 0, options);\n    }\n  }\n\n  /**\n   * Sends an **all notes off** channel mode message. This will turn all currently playing notes\n   * off. However, this does not prevent new notes from being played.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  turnNotesOff(options = {}) {\n    return this.sendChannelMode(\"allnotesoff\", 0, options);\n  }\n\n  /**\n   * Sends an **all sound off** channel mode message. This will silence all sounds playing on that\n   * channel but will not prevent new sounds from being triggered.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  turnSoundOff(options = {}) {\n    return this.sendChannelMode(\"allsoundoff\", 0, options);\n  }\n\n  /**\n   * Sends a **reset all controllers** channel mode message. This resets all controllers, such as\n   * the pitch bend, to their default value.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  resetAllControllers(options = {}) {\n    return this.sendChannelMode(\"resetallcontrollers\", 0, options);\n  }\n\n  /**\n   * Sets the polyphonic mode. In `\"poly\"` mode (usually the default), multiple notes can be played\n   * and heard at the same time. In `\"mono\"` mode, only one note will be heard at once even if\n   * multiple notes are being played.\n   *\n   * @param {string} [mode=poly] The mode to use: `\"mono\"` or `\"poly\"`.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number, the\n   * operation will be scheduled for that time. The current time can be retrieved with\n   * [WebMidi.time]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the operation\n   * will be carried out as soon as possible.\n   *\n   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.\n   */\n  setPolyphonicMode(mode, options = {}) {\n    if (mode === \"mono\") {\n      return this.sendChannelMode(\"monomodeon\", 0, options);\n    } else {\n      return this.sendChannelMode(\"polymodeon\", 0, options);\n    }\n  }\n\n}\n\n/**\n * The `Output` class represents a MIDI output port. This object is derived from the host's MIDI\n * subsystem and cannot be instantiated directly.\n *\n * You can find a list of all available `Output` objects in the\n * [WebMidi.outputs]{@link WebMidi#outputs} array.\n *\n * The `Output` class extends the\n * [EventEmitter](https://djipco.github.io/djipevents/EventEmitter.html) class from the\n * [djipevents]{@link https://djipco.github.io/djipevents/index.html} module. This means\n * it also includes methods such as\n * [addListener()](https://djipco.github.io/djipevents/EventEmitter.html#addListener),\n * [removeListener()](https://djipco.github.io/djipevents/EventEmitter.html#removeListener),\n * [hasListener()](https://djipco.github.io/djipevents/EventEmitter.html#hasListener) and several\n * others.\n *\n * @param {MIDIOutput} midiOutput `MIDIOutput` object as provided by the MIDI subsystem\n *\n * @fires Output#opened\n * @fires Output#disconnected\n * @fires Output#closed\n */\nclass Output extends e {\n\n  constructor(midiOutput) {\n\n    super();\n\n    if (wm.validation) {\n\n      if (!midiOutput || midiOutput.type !== \"output\") {\n        throw new TypeError(\"The supplied MIDIOutput is invalid.\");\n      }\n\n    }\n\n    /**\n     * A reference to the `MIDIOutput` object\n     * @type {MIDIOutput}\n     * @private\n     */\n    this._midiOutput = midiOutput;\n\n    /**\n     * Array containing the 16 {@link OutputChannel} objects available for this `Output`. The\n     * channels are numbered 1 through 16.\n     *\n     * @type {OutputChannel[]}\n     */\n    this.channels = [];\n    for (let i = 1; i <= 16; i++) this.channels[i] = new OutputChannel(this, i);\n\n    this._midiOutput.onstatechange = this._onStateChange.bind(this);\n\n  }\n\n  /**\n   * Destroys the `Output`. All listeners are removed, all channels are destroyed and the MIDI\n   * subsystem is unlinked.\n   * @returns {Promise<void>}\n   */\n  async destroy() {\n    this.removeListener();\n    this.channels.forEach(ch => ch.destroy());\n    this.channels = [];\n    this._midiOutput.onstatechange = null;\n    await this.close();\n    this._midiOutput = null;\n  }\n\n  /**\n   * @private\n   */\n  _onStateChange(e) {\n\n    let event = {\n      timestamp: wm.time\n    };\n\n    if (e.port.connection === \"open\") {\n\n      /**\n       * Event emitted when the {@link Output} has been opened by calling the\n       * [open()]{@link Output#open} method.\n       *\n       * @event Output#opened\n       * @type {Object}\n       * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"opened\"`\n       * @property {Output} target The object that triggered the event\n       */\n      event.type = \"opened\";\n      event.target = this;\n      this.emit(\"opened\", event);\n\n    } else if (e.port.connection === \"closed\" && e.port.state === \"connected\") {\n\n      /**\n       * Event emitted when the {@link Output} has been closed by calling the\n       * [close()]{@link Output#close} method.\n       *\n       * @event Output#closed\n       * @type {Object}\n       * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"closed\"`\n       * @property {Output} target The object that triggered the event\n       */\n      event.type = \"closed\";\n      event.target = this;\n      this.emit(\"closed\", event);\n\n    } else if (e.port.connection === \"closed\" && e.port.state === \"disconnected\") {\n\n      /**\n       * Event emitted when the {@link Output} becomes unavailable. This event is typically fired\n       * when the MIDI device is unplugged.\n       *\n       * @event Output#disconnected\n       * @type {Object}\n       * @property {number} timestamp The moment (DOMHighResTimeStamp0 when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {string} type `\"disconnected\"`\n       * @property {Object} target Object with properties describing the {@link Output} that\n       * triggered the event. This is not the actual `Output` as it is no longer available.\n       * @property {string} target.connection `\"closed\"`\n       * @property {string} target.id ID of the input\n       * @property {string} target.manufacturer Manufacturer of the device that provided the input\n       * @property {string} target.name Name of the device that provided the input\n       * @property {string} target.state `\"disconnected\"`\n       * @property {string} target.type `\"output\"`\n       */\n      event.type = \"disconnected\";\n      event.target = {\n        connection: e.port.connection,\n        id: e.port.id,\n        manufacturer: e.port.manufacturer,\n        name: e.port.name,\n        state: e.port.state,\n        type: e.port.type\n      };\n      this.emit(\"disconnected\", event);\n\n    } else if (e.port.connection === \"pending\" && e.port.state === \"disconnected\") ; else {\n      console.warn(\"This statechange event was not caught:\", e.port.connection, e.port.state);\n    }\n\n  }\n\n  /**\n   * Opens the output for usage.\n   *\n   * @returns {Promise<Output>} The promise is fulfilled with the `Output`\n   */\n  async open() {\n\n    // Explicitly opens the port for usage. This is not mandatory. When the port is not explicitly\n    // opened, it is implicitly opened (asynchronously) when calling `send()` on the `MIDIOutput`.\n    // We do it explicitly so that 'connected' events are dispatched immediately and we are ready to\n    // send.\n    try {\n      await this._midiOutput.open();\n      return Promise.resolve(this);\n    } catch (err) {\n      return Promise.reject(err);\n    }\n\n  }\n\n  /**\n   * Closes the output connection. When an output is closed, it cannot be used to send MIDI messages\n   * until the output is opened again by calling [Output.open()]{@link Output#open}. You can check\n   * the connection status by looking at the [connection]{@link Output#connection} property.\n   *\n   * @returns {Promise<void>}\n   */\n  async close() {\n\n    // We close the port. This triggers a 'statechange' event which we listen to to re-trigger the\n    // 'closed' event.\n    if (this._midiOutput) {\n      await this._midiOutput.close();\n    } else {\n      await Promise.resolve();\n    }\n\n  }\n\n  /**\n   * Sends a MIDI message on the MIDI output port, at the scheduled timestamp. It is usually not\n   * necessary to use this method directly since it is often simpler to use one of the helper\n   * methods such as `playNote()`, `stopNote()`, `sendControlChange()`, etc.\n   *\n   * Details on the format of MIDI messages are available in the summary of\n   * [MIDI messages]{@link https://www.midi.org/specifications/item/table-1-summary-of-midi-message}\n   * from the MIDI Manufacturers Association.\n   *\n   * @param status {Number} The MIDI status byte of the message (integer between 128-255).\n   *\n   * @param [data=[]] {number[]} An array of unsigned integers for the message. The number of data\n   * bytes varies depending on the status byte. It is perfectly legal to send no data for some\n   * message types (use `undefined` or an empty array in this case). Each byte must be between 0 and\n   * 255.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @throws {TypeError} Failed to execute 'send' on 'MIDIOutput': The value at index 0 is greater\n   * than 0xFF.\n   *\n   * @throws {TypeError} Failed to execute 'send' on 'MIDIOutput': The value at index 2 is greater\n   * than 0xFF.\n   *\n   * @throws {TypeError} Failed to execute 'send' on 'MIDIOutput': Running status is not allowed at\n   * index 2.\n   *\n   * @throws {TypeError} Failed to execute 'send' on 'MIDIOutput': Message is incomplete.\n   *\n   * @throws {TypeError} Failed to execute 'send' on 'MIDIOutput': Reserved status is not allowed at\n   * index 0.\n   *\n   * @throws {TypeError} Failed to execute 'send' on 'MIDIOutput': System exclusive message is not\n   * allowed at index 0.\n   *\n   * @throws {TypeError} Failed to execute 'send' on 'MIDIOutput': Unexpected end of system\n   * exclusive message at index 0.\n   *\n   * @throws {TypeError} Failed to execute 'send' on 'MIDIOutput': Unexpected status byte at index\n   * 1.\n   *\n   * @throws {TypeError} Failed to execute 'send' on 'MIDIOutput': Unexpected status byte at index\n   * 2.\n   *\n   * @returns {Output} Returns the `Output` object so methods can be chained.\n   */\n  send(status, data = [], options= {}) {\n\n    if (!Array.isArray(data)) data = [data];\n\n    if (wm.validation) {\n\n      if (!(parseInt(status) >= 128 && parseInt(status) <= 255)) {\n        throw new RangeError(\"The status must be an integer between 128 and 255.\");\n      }\n\n      data.forEach(value => {\n        value = parseInt(value);\n        if (isNaN(value)) throw new TypeError(\"Data bytes must be integers.\");\n        if (!(parseInt(value) >= 0 && parseInt(value) <= 255)) {\n          throw new RangeError(\"The data bytes must be integers between 0 and 255.\");\n        }\n      });\n\n      // Legacy-compatibility\n      if (typeof options === \"number\") options = {time: options};\n\n    }\n\n    // Actually send the message\n    this._midiOutput.send([status].concat(data), wm.convertToTimestamp(options.time));\n\n    return this;\n\n  }\n\n  /**\n   * Sends a MIDI [system exclusive]{@link\n    * https://www.midi.org/specifications-old/item/table-4-universal-system-exclusive-messages}\n   * (*sysex*) message. The generated message will automatically be prepended with the *sysex byte*\n   * (0xF0) and terminated with the *end of sysex byte* (0xF7).\n   *\n   * To use the `sendSysex()` method, system exclusive message support must have been enabled. To\n   * do so, you must set the `sysex` option to `true` when calling `WebMidi.enable()`:\n   *\n   * ```js\n   * WebMidi.enable({sysex: true})\n   *   .then(() => console.log(\"System exclusive messages are enabled\");\n   * ```\n   *\n   * Note that, depending on browser, version and platform, it is generally necessary to serve the\n   * page over HTTPS to enable sysex support.\n   *\n   * ##### Examples\n   *\n   * If you want to send a sysex message to a Korg device connected to the first output, you would\n   * use the following code:\n   *\n   * ```js\n   * WebMidi.outputs[0].sendSysex(0x42, [0x1, 0x2, 0x3, 0x4, 0x5]);\n   * ```\n   *\n   * The parameters can be specified using any number notation (decimal, hex, binary, etc.).\n   * Therefore, the code below is equivalent to the code above:\n   *\n   * ```js\n   * WebMidi.outputs[0].sendSysex(66, [1, 2, 3, 4, 5]);\n   * ```\n   *\n   * The above code sends the byte values 1, 2, 3, 4 and 5 to Korg devices (hex 42 is the same as\n   * decimal 66).\n   *\n   * Some manufacturers are identified using 3 bytes. In this case, you would use a 3-position array\n   * as the first parameter. For example, to send the same sysex message to a\n   * *Native Instruments* device:\n   *\n   * ```js\n   * WebMidi.outputs[0].sendSysex([0x00, 0x21, 0x09], [0x1, 0x2, 0x3, 0x4, 0x5]);\n   * ```\n   * There is no limit for the length of the data array. However, it is generally suggested to keep\n   * system exclusive messages to 64Kb or less.\n   *\n   * @param manufacturer {number|number[]} An unsigned integer or an array of three unsigned\n   * integers between 0 and 127 that identify the targeted manufacturer. The *MIDI Manufacturers\n   * Association* maintains a full list of\n   * [Manufacturer ID Numbers](https://www.midi.org/specifications-old/item/manufacturer-id-numbers)\n   * .\n   *\n   * @param [data=number[]] {Array} An array of unsigned integers between 0 and 127. This is the\n   * data you wish to transfer.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @throws {DOMException} Failed to execute 'send' on 'MIDIOutput': System exclusive message is\n   * not allowed.\n   *\n   * @throws {TypeError} Failed to execute 'send' on 'MIDIOutput': The value at index x is greater\n   * than 0xFF.\n   *\n   * @returns {Output} Returns the `Output` object so methods can be chained.\n   */\n  sendSysex(manufacturer, data, options = {}) {\n\n    manufacturer = [].concat(manufacturer);\n\n    data = manufacturer.concat(data, wm.MIDI_SYSTEM_MESSAGES.sysexend);\n    this.send(wm.MIDI_SYSTEM_MESSAGES.sysex, data, {time: options.time});\n\n    return this;\n\n  };\n\n  /**\n   * Clears all messages that have been queued but not yet delivered.\n   *\n   * Warning: this method has been defined in the specification but has not been implemented yet. As\n   * soon as browsers implement it, it will work.\n   *\n   * You can check out the current status of this feature for Chromium (Chrome) here:\n   * https://bugs.chromium.org/p/chromium/issues/detail?id=471798\n   *\n   * @returns {Output} Returns the `Output` object so methods can be chained.\n   */\n  clear() {\n\n    if (this._midiOutput.clear) {\n\n      this._midiOutput.clear();\n\n    } else {\n\n      if (wm.validation) {\n        console.warn(\n          \"The 'clear()' method has not yet been implemented in your environment.\"\n        );\n      }\n\n    }\n\n    return this;\n\n  }\n\n  /**\n   * Sends a MIDI **timecode quarter frame** message. Please note that no processing is being done\n   * on the data. It is up to the developer to format the data according to the\n   * [MIDI Timecode](https://en.wikipedia.org/wiki/MIDI_timecode) format.\n   *\n   * @param value {number} The quarter frame message content (integer between 0 and 127).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @returns {Output} Returns the `Output` object so methods can be chained.\n   */\n  sendTimecodeQuarterFrame(value, options = {}) {\n\n    if (wm.validation) {\n      value = parseInt(value);\n      if (isNaN(value) || !(value >= 0 && value <= 127)) {\n        throw new RangeError(\"The value must be an integer between 0 and 127.\");\n      }\n    }\n\n    this.send(\n      wm.MIDI_SYSTEM_MESSAGES.timecode,\n      value,\n      {time: options.time}\n    );\n\n    return this;\n\n  };\n\n  /**\n   * Sends a **ong position** MIDI message. The value is expressed in MIDI beats (between 0 and\n   * 16383) which are 16th note. Position 0 is always the start of the song.\n   *\n   * @param [value=0] {number} The MIDI beat to cue to (integer between 0 and 16383).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @returns {Output} Returns the `Output` object so methods can be chained.\n   *\n   * @since 3.0.0\n   */\n  setSongPosition(value, options = {}) {\n\n    value = Math.floor(value) || 0;\n\n    var msb = (value >> 7) & 0x7F;\n    var lsb = value & 0x7F;\n\n    this.send(\n      wm.MIDI_SYSTEM_MESSAGES.songposition,\n      [msb, lsb],\n      {time: options.time}\n    );\n    return this;\n\n  }\n\n  /**\n   * @private\n   * @deprecated since version 3.0\n   */\n  sendSongPosition(value, options = {}) {\n\n    if (wm.validation) {\n      console.warn(\n        \"The sendSongPosition() method has been deprecated. Use setSongPosition() instead.\"\n      );\n    }\n\n    return this.setSongPosition(value, options);\n\n  }\n\n  /**\n   * Sends a **song select** MIDI message.\n   *\n   * **Note**: since version 3.0, the song number is an integer between 1 and 128. In versions 1.0\n   * and 2.0, the number was between 0 and 127. This change aligns WebMidi.js with most devices that\n   * use a numbering scheme starting at 1.\n   *\n   * @param value {number} The number of the song to select (integer between 1 and 128).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @throws The song number must be between 1 and 128.\n   *\n   * @returns {Output} Returns the `Output` object so methods can be chained.\n   *\n   * @since 3.0.0\n   */\n  setSong(value, options = {}) {\n\n    if (wm.validation) {\n\n      value = parseInt(value);\n\n      if (isNaN(value) || !(value >= 1 && value <= 128)) {\n        throw new RangeError(\"The program value must be between 1 and 128\");\n      }\n\n    }\n\n    this.send(\n      wm.MIDI_SYSTEM_MESSAGES.songselect,\n      [value],\n      {time: options.time}\n    );\n\n    return this;\n\n  }\n\n  /**\n   * @private\n   * @deprecated since version 3.0\n   */\n  sendSongSelect(value, options = {}) {\n\n    if (wm.validation) {\n      console.warn(\n        \"The sendSongSelect() method has been deprecated. Use setSong() instead.\"\n      );\n    }\n\n    return this.setSong(value, options);\n\n  }\n\n  /**\n   * Sends a MIDI **tune request** real-time message.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @returns {Output} Returns the `Output` object so methods can be chained.\n   *\n   * @since 3.0.0\n   */\n  sendTuneRequest(options = {}) {\n\n    this.send(\n      wm.MIDI_SYSTEM_MESSAGES.tunerequest,\n      undefined,\n      {time: options.time}\n    );\n\n    return this;\n\n  }\n\n  /**\n   * Sends a MIDI **clock* real-time message. According to the standard, there are 24 MIDI Clocks\n   * for every quarter note.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @returns {Output} Returns the `Output` object so methods can be chained.\n   */\n  sendClock(options = {}) {\n\n    this.send(\n      wm.MIDI_SYSTEM_MESSAGES.clock,\n      undefined,\n      {time: options.time}\n    );\n\n    return this;\n\n  }\n\n  /**\n   * Sends a **start** real-time message. A MIDI Start message starts the playback of the current\n   * song at beat 0. To start playback elsewhere in the song, use the\n   * [sendContinue()]{@link Output#sendContinue} method.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @returns {Output} Returns the `Output` object so methods can be chained.\n   */\n  sendStart(options = {}) {\n\n    this.send(\n      wm.MIDI_SYSTEM_MESSAGES.start,\n      undefined,\n      {time: options.time}\n    );\n\n    return this;\n\n  }\n\n  /**\n   * Sends a **continue** real-time message. This resumes song playback where it was previously\n   * stopped or where it was last cued with a song position message. To start playback from the\n   * start, use the [sendStart()]{@link Output#sendStart}` method.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @returns {WebMidi} Returns the `WebMidi` object so methods can be chained.\n   */\n  sendContinue(options = {}) {\n\n    this.send(\n      wm.MIDI_SYSTEM_MESSAGES.continue,\n      undefined,\n      {time: options.time}\n    );\n\n    return this;\n\n  }\n\n  /**\n   * Sends a **stop** real-time message. This tells the device connected to this output to stop\n   * playback immediately (or at the scheduled time).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @returns {Output} Returns the `Output` object so methods can be chained.\n   */\n  sendStop(options = {}) {\n\n    this.send(\n      wm.MIDI_SYSTEM_MESSAGES.stop,\n      undefined,\n      {time: options.time}\n    );\n\n    return this;\n\n  }\n\n  /**\n   * Sends an **active sensing** real-time message. This tells the device connected to this port\n   * that the connection is still good. Active sensing messages should be sent every 300 ms if there\n   * was no other activity on the MIDI port.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @returns {Output} Returns the `Output` object so methods can be chained.\n   */\n  sendActiveSensing(options = {}) {\n\n    this.send(\n      wm.MIDI_SYSTEM_MESSAGES.activesensing,\n      [],\n      {time: options.time}\n    );\n\n    return this;\n\n  }\n\n  /**\n   * Sends a **reset** real-time message. This tells the device connected to this output that it\n   * should reset itself to a default state.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @returns {Output} Returns the `Output` object so methods can be chained.\n   */\n  sendReset(options = {}) {\n\n    this.send(\n      wm.MIDI_SYSTEM_MESSAGES.reset,\n      undefined,\n      {time: options.time}\n    );\n\n    return this;\n\n  }\n\n  /**\n   * @private\n   * @deprecated since version 3.0\n   */\n  sendTuningRequest(options = {}) {\n\n\n    if (wm.validation) {\n      console.warn(\n        \"The sendTuningRequest() method has been deprecated. Use sendTuningRequest() instead.\"\n      );\n    }\n\n    return this.sendTuneRequest(options);\n\n  }\n\n  /**\n   * Sends a MIDI **key aftertouch** message to the specified channel(s) at the scheduled time. This\n   * is a key-specific aftertouch. For a channel-wide aftertouch message, use\n   * [setChannelAftertouch()]{@link Output#setChannelAftertouch}.\n   *\n   * @param note {number|string|Array}  The note for which you are sending an aftertouch value. The\n   * notes can be specified in one of two ways. The first way is by using the MIDI note number (an\n   * integer between 0 and 127). The second way is by using the note name followed by the octave\n   * (C3, G#4, F-1, Db7). The octave range should be between -1 and 9. The lowest note is C-1 (MIDI\n   * note number 0) and the highest note is G9 (MIDI note number 127). It is also possible to use\n   * an array of note names and/or numbers.\n   *\n   * @param [pressure=0.5] {number} The pressure level (between 0 and 1). An invalid pressure value\n   * will silently trigger the default behaviour. If the `rawValue` option is set to `true`, the\n   * pressure can be defined by using an integer between 0 and 127.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]|\"all\"} [options.channels=\"all\"] The MIDI channel number (between `1`\n   * and `16`) or an array of channel numbers to use. The special value `\"all\"` can also be used to\n   * use all channels (default).\n   *\n   * @param {boolean} [options.rawValue=false] A boolean indicating whether the value should be\n   * considered a float between 0 and 1.0 (default) or a raw integer between 0 and 127.\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @return {Output} Returns the `Output` object so methods can be chained.\n   *\n   * @since 3.0.0\n   */\n  setKeyAftertouch(note, pressure, options = {}, legacy = {}) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (Array.isArray(pressure) || Number.isInteger(pressure) || pressure === \"all\") {\n        let channels = pressure;\n        pressure = options;\n        options = legacy;\n        options.channels = channels;\n      }\n\n    }\n\n    if (options.channels == undefined) options.channels = \"all\";\n\n    wm.sanitizeChannels(options.channels).forEach(ch => {\n      this.channels[ch].setKeyAftertouch(note, pressure, options);\n    });\n\n    return this;\n\n  };\n\n  /**\n   * @private\n   * @deprecated since version 3.0\n   */\n  sendKeyAftertouch(note, channel, pressure, options = {}) {\n\n    if (wm.validation) {\n      console.warn(\n        \"The sendKeyAftertouch() method has been deprecated. Use setKeyAftertouch() instead.\"\n      );\n    }\n\n    options.channels = channel;\n    return this.setKeyAftertouch(note, pressure, options);\n\n  }\n\n  /**\n   * Sends a MIDI **control change** message to the specified channel(s) at the scheduled time. The\n   * control change message to send can be specified numerically or by using one of the following\n   * common names:\n   *\n   *  * `bankselectcoarse` (#0)\n   *  * `modulationwheelcoarse` (#1)\n   *  * `breathcontrollercoarse` (#2)\n   *  * `footcontrollercoarse` (#4)\n   *  * `portamentotimecoarse` (#5)\n   *  * `dataentrycoarse` (#6)\n   *  * `volumecoarse` (#7)\n   *  * `balancecoarse` (#8)\n   *  * `pancoarse` (#10)\n   *  * `expressioncoarse` (#11)\n   *  * `effectcontrol1coarse` (#12)\n   *  * `effectcontrol2coarse` (#13)\n   *  * `generalpurposeslider1` (#16)\n   *  * `generalpurposeslider2` (#17)\n   *  * `generalpurposeslider3` (#18)\n   *  * `generalpurposeslider4` (#19)\n   *  * `bankselectfine` (#32)\n   *  * `modulationwheelfine` (#33)\n   *  * `breathcontrollerfine` (#34)\n   *  * `footcontrollerfine` (#36)\n   *  * `portamentotimefine` (#37)\n   *  * `dataentryfine` (#38)\n   *  * `volumefine` (#39)\n   *  * `balancefine` (#40)\n   *  * `panfine` (#42)\n   *  * `expressionfine` (#43)\n   *  * `effectcontrol1fine` (#44)\n   *  * `effectcontrol2fine` (#45)\n   *  * `holdpedal` (#64)\n   *  * `portamento` (#65)\n   *  * `sustenutopedal` (#66)\n   *  * `softpedal` (#67)\n   *  * `legatopedal` (#68)\n   *  * `hold2pedal` (#69)\n   *  * `soundvariation` (#70)\n   *  * `resonance` (#71)\n   *  * `soundreleasetime` (#72)\n   *  * `soundattacktime` (#73)\n   *  * `brightness` (#74)\n   *  * `soundcontrol6` (#75)\n   *  * `soundcontrol7` (#76)\n   *  * `soundcontrol8` (#77)\n   *  * `soundcontrol9` (#78)\n   *  * `soundcontrol10` (#79)\n   *  * `generalpurposebutton1` (#80)\n   *  * `generalpurposebutton2` (#81)\n   *  * `generalpurposebutton3` (#82)\n   *  * `generalpurposebutton4` (#83)\n   *  * `reverblevel` (#91)\n   *  * `tremololevel` (#92)\n   *  * `choruslevel` (#93)\n   *  * `celestelevel` (#94)\n   *  * `phaserlevel` (#95)\n   *  * `databuttonincrement` (#96)\n   *  * `databuttondecrement` (#97)\n   *  * `nonregisteredparametercoarse` (#98)\n   *  * `nonregisteredparameterfine` (#99)\n   *  * `registeredparametercoarse` (#100)\n   *  * `registeredparameterfine` (#101)\n   *\n   * Note: as you can see above, not all control change message have a matching common name. This\n   * does not mean you cannot use the others. It simply means you will need to use their number\n   * instead of their name.\n   *\n   * To view a list of all available `control change` messages, please consult \"Table 3 - Control\n   * Change Messages\" from the [MIDI Messages](\n   * https://www.midi.org/specifications/item/table-3-control-change-messages-data-bytes-2)\n   * specification.\n   *\n   * @param controller {number|string} The MIDI controller name or number (0-119).\n   *\n   * @param [value=0] {number} The value to send (0-127).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]|\"all\"} [options.channels=\"all\"] The MIDI channel number (between `1`\n   * and `16`) or an array of channel numbers to use. The special value `\"all\"` can also be used to\n   * use all channels (default).\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @throws {RangeError} Controller numbers must be between 0 and 119.\n   * @throws {RangeError} Invalid controller name.\n   *\n   * @return {Output} Returns the `Output` object so methods can be chained.\n   */\n  sendControlChange(controller, value, options = {}, legacy = {}) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (Array.isArray(options) || Number.isInteger(options) || options === \"all\") {\n        let channels = options;\n        options = legacy;\n        options.channels = channels;\n      }\n\n    }\n\n    if (options.channels == undefined) options.channels = \"all\";\n\n    wm.sanitizeChannels(options.channels).forEach(ch => {\n      this.channels[ch].sendControlChange(controller, value, options);\n    });\n\n    return this;\n\n  };\n\n  /**\n   * Sends a pitch bend range message to the specified channel(s) at the scheduled time so that they\n   * adjust the range used by their pitch bend lever. The range is specified by using the\n   * `semitones` and `cents` parameters. For example, setting the `semitones` parameter to `12`\n   * means that the pitch bend range will be 12 semitones above and below the nominal pitch.\n   *\n   * @param semitones {number} The desired adjustment value in semitones (between 0 and 127). While\n   * nothing imposes that in the specification, it is very common for manufacturers to limit the\n   * range to 2 octaves (-12 semitones to 12 semitones).\n   *\n   * @param [cents=0] {number} The desired adjustment value in cents (integer between 0-127).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]|\"all\"} [options.channels=\"all\"] The MIDI channel number (between `1`\n   * and `16`) or an array of channel numbers to use. The special value `\"all\"` can also be used to\n   * use all channels (default).\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @throws {RangeError} The msb value must be between 0 and 127.\n   * @throws {RangeError} The lsb value must be between 0 and 127.\n   *\n   * @returns {Output} Returns the `Output` object so methods can be chained.\n   *\n   * @since 3.0.0\n   */\n  setPitchBendRange(semitones, cents, options = {}, legacy = {}) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (Array.isArray(options) || Number.isInteger(options) || options === \"all\") {\n        let channels = options;\n        options = legacy;\n        options.channels = channels;\n      }\n\n    }\n\n    if (options.channels == undefined) options.channels = \"all\";\n\n    wm.sanitizeChannels(options.channels).forEach(ch => {\n      this.channels[ch].setPitchBendRange(semitones, cents, options);\n    });\n\n    return this;\n\n  }\n\n  /**\n   * Sets the specified MIDI registered parameter to the desired value. The value is defined with\n   * up to two bytes of data (msb, lsb) that each can go from 0 to 127.\n   *\n   * MIDI\n   * [registered parameters]\n   * (https://www.midi.org/specifications-old/item/table-3-control-change-messages-data-bytes-2)\n   * extend the original list of control change messages. The MIDI 1.0 specification lists only a\n   * limited number of them. Here are the original registered parameters with the identifier that\n   * can be used as the first parameter of this function:\n   *\n   *  * Pitchbend Range (0x00, 0x00): `\"pitchbendrange\"`\n   *  * Channel Fine Tuning (0x00, 0x01): `\"channelfinetuning\"`\n   *  * Channel Coarse Tuning (0x00, 0x02): `\"channelcoarsetuning\"`\n   *  * Tuning Program (0x00, 0x03): `\"tuningprogram\"`\n   *  * Tuning Bank (0x00, 0x04): `\"tuningbank\"`\n   *  * Modulation Range (0x00, 0x05): `\"modulationrange\"`\n   *\n   * Note that the **Tuning Program** and **Tuning Bank** parameters are part of the *MIDI Tuning\n   * Standard*, which is not widely implemented.\n   *\n   * Another set of extra parameters have been later added for 3D sound controllers. They are:\n   *\n   *  * Azimuth Angle (0x3D, 0x00): `\"azimuthangle\"`\n   *  * Elevation Angle (0x3D, 0x01): `\"elevationangle\"`\n   *  * Gain (0x3D, 0x02): `\"gain\"`\n   *  * Distance Ratio (0x3D, 0x03): `\"distanceratio\"`\n   *  * Maximum Distance (0x3D, 0x04): `\"maximumdistance\"`\n   *  * Maximum Distance Gain (0x3D, 0x05): `\"maximumdistancegain\"`\n   *  * Reference Distance Ratio (0x3D, 0x06): `\"referencedistanceratio\"`\n   *  * Pan Spread Angle (0x3D, 0x07): `\"panspreadangle\"`\n   *  * Roll Angle (0x3D, 0x08): `\"rollangle\"`\n   *\n   * @param parameter {string|number[]} A string identifying the parameter's name (see above) or a\n   * two-position array specifying the two control bytes (e.g. `[0x65, 0x64]`) that identify the\n   * registered parameter.\n   *\n   * @param [data=[]] {number|number[]} A single integer or an array of integers with a maximum\n   * length of 2 specifying the desired data.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]|\"all\"} [options.channels=\"all\"] The MIDI channel number (between `1`\n   * and `16`) or an array of channel numbers to use. The special value `\"all\"` can also be used to\n   * use all channels (default).\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @returns {Output} Returns the `Output` object so methods can be chained.\n   */\n  setRegisteredParameter(parameter, data, options = {}, legacy = {}) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (Array.isArray(options) || Number.isInteger(options) || options === \"all\") {\n        let channels = options;\n        options = legacy;\n        options.channels = channels;\n      }\n\n    }\n\n    if (options.channels == undefined) options.channels = \"all\";\n\n    wm.sanitizeChannels(options.channels).forEach(ch => {\n      this.channels[ch].setRegisteredParameter(parameter, data, options);\n    });\n\n    return this;\n\n  }\n\n  /**\n   * Sends a MIDI **channel aftertouch** message to the specified channel(s). For key-specific\n   * aftertouch, you should instead use [setKeyAftertouch()]{@link Output#setKeyAftertouch}.\n   *\n   * @param [pressure=0.5] {number} The pressure level (between 0 and 1). An invalid pressure value\n   * will silently trigger the default behaviour. If the `rawValue` option is set to `true`, the\n   * pressure can be defined by using an integer between 0 and 127.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]|\"all\"} [options.channels=\"all\"] The MIDI channel number (between `1`\n   * and `16`) or an array of channel numbers to use. The special value `\"all\"` can also be used to\n   * use all channels (default).\n   *\n   * @param {boolean} [options.rawValue=false] A boolean indicating whether the value should be\n   * considered a float between 0 and 1.0 (default) or a raw integer between 0 and 127.\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @return {Output} Returns the `Output` object so methods can be chained.\n   * @since 3.0.0\n   */\n  setChannelAftertouch(pressure, options = {}, legacy = {}) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (Array.isArray(options) || Number.isInteger(options) || options === \"all\") {\n        let channels = options;\n        options = legacy;\n        options.channels = channels;\n      }\n\n    }\n\n    if (options.channels == undefined) options.channels = \"all\";\n    wm.sanitizeChannels(options.channels).forEach(ch => {\n      this.channels[ch].setChannelAftertouch(pressure, options);\n    });\n\n    return this;\n\n  }\n\n  /**\n   * @private\n   * @deprecated since version 3.0\n   */\n  sendChannelAftertouch(pressure, channel, options = {}) {\n\n    if (wm.validation) {\n      console.warn(\n        \"The sendChannelAftertouch() method has been deprecated. Use setChannelAftertouch().\"\n      );\n    }\n\n    options.channels = channel;\n    return this.setChannelAftertouch(pressure, options);\n\n  }\n\n  /**\n   * Sends a MIDI **pitch bend** message to the specified channel(s) at the scheduled time.\n   *\n   * @param {number|number[]} value The intensity of the bend (between -1.0 and 1.0). A value of\n   * zero means no bend. The resulting bend is relative to the pitch bend range that has been\n   * defined. The range can be set with [setPitchBendRange()]{@link OutputChannel#setPitchBendRange}\n   * . So, for example, if the pitch bend range has been set to 12 semitones, using a bend value of\n   * -1 will bend the note 1 octave below its nominal value.\n   *\n   * If an invalid value is specified, the nearest valid value will be used instead.\n   *\n   * If the `rawValue` option is set to `true`, the intensity of the bend can be defined by either\n   * using a single integer between 0 and 127 (MSB) or an array of two integers between 0 and 127\n   * representing, respectively, the MSB (most significant byte) and the LSB (least significant\n   * byte). The MSB is expressed in semitones with `64` meaning no bend. A value lower than `64`\n   * bends downwards while a value higher than `64` bends upwards. The LSB is expressed in cents\n   * (1/100 of a semitone). An LSB of `64` also means no bend.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]|\"all\"} [options.channels=\"all\"] The MIDI channel number (between `1`\n   * and `16`) or an array of channel numbers to use. The special value `\"all\"` can also be used to\n   * use all channels (default).\n   *\n   * @param {boolean} [options.rawValue=false] A boolean indicating whether the value should be\n   * considered as a float between -1.0 and 1.0 (default) or as raw integer between 0 and 127 (or\n   * an array of 2 integers if using both MSB and LSB).\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @returns {Output} Returns the `Output` object so methods can be chained.\n   *\n   * @since 3.0.0\n   */\n  setPitchBend(value, options = {}, legacy = {}) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (Array.isArray(options) || Number.isInteger(options) || options === \"all\") {\n        let channels = options;\n        options = legacy;\n        options.channels = channels;\n      }\n\n    }\n\n    if (options.channels == undefined) options.channels = \"all\";\n\n    wm.sanitizeChannels(options.channels).forEach(ch => {\n      this.channels[ch].setPitchBend(value, options);\n    });\n\n    return this;\n\n  }\n\n  /**\n   * @private\n   * @deprecated since version 3.0\n   */\n  sendPitchBend(bend, channel, options = {}) {\n\n    if (wm.validation) {\n      console.warn(\n        \"The sendPitchBend() method has been deprecated. Use setPitchBend() instead.\"\n      );\n    }\n\n    options.channels = channel;\n    return this.setPitchBend(bend, options);\n\n  }\n\n  /**\n   * Sends a MIDI **program change** message to the specified channel(s) at the scheduled time.\n   *\n   * **Note**: since version 3.0, the program number is an integer between 1 and 128. In versions\n   * 1.0 and 2.0, the number was between 0 and 127. This change aligns WebMidi.js with most devices\n   * that use a numbering scheme starting at 1.\n   *\n   * @param [program=1] {number} The MIDI patch (program) number (1-128)\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]|\"all\"} [options.channels=\"all\"] The MIDI channel number (between `1`\n   * and `16`) or an array of channel numbers to use. The special value `\"all\"` can also be used to\n   * use all channels (default).\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @throws {TypeError} Failed to execute 'send' on 'MIDIOutput': The value at index 1 is greater\n   * than 0xFF.\n   *\n   * @return {Output} Returns the `Output` object so methods can be chained.\n   *\n   * @since 3.0.0\n   */\n  setProgram(program, options = {}, legacy = {}) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (Array.isArray(options) || Number.isInteger(options) || options === \"all\") {\n        let channels = options;\n        options = legacy;\n        options.channels = channels;\n      }\n\n    }\n\n    if (options.channels == undefined) options.channels = \"all\";\n\n    wm.sanitizeChannels(options.channels).forEach(ch => {\n      this.channels[ch].setProgram(program, options);\n    });\n\n    return this;\n\n  }\n\n  /**\n   * @private\n   * @deprecated since version 3.0\n   */\n  sendProgramChange(program, channel, options = {}) {\n\n    if (wm.validation) {\n      console.warn(\n        \"The sendProgramChange() method has been deprecated. Use setProgram() instead.\"\n      );\n    }\n\n    options.channels = channel;\n    return this.setProgram(program, options);\n\n  }\n\n  /**\n   * Sends a **modulation depth range** message to the specified channel(s) so that they adjust the\n   * depth of their modulation wheel's range. The range can be specified with the `semitones`\n   * parameter, the `cents` parameter or by specifying both parameters at the same time.\n   *\n   * @param [semitones=0] {number} The desired adjustment value in semitones (integer between\n   * 0 and 127).\n   *\n   * @param [cents=0] {number} The desired adjustment value in cents (integer between 0 and 127).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]|\"all\"} [options.channels=\"all\"] The MIDI channel number (between `1`\n   * and `16`) or an array of channel numbers to use. The special value `\"all\"` can also be used to\n   * use all channels (default).\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @throws {RangeError} The msb value must be between 0 and 127\n   * @throws {RangeError} The lsb value must be between 0 and 127\n   *\n   * @return {Output} Returns the `Output` object so methods can be chained.\n   *\n   * @since 3.0.0\n   */\n  setModulationRange(semitones, cents, options = {}, legacy = {}) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (Array.isArray(options) || Number.isInteger(options) || options === \"all\") {\n        let channels = options;\n        options = legacy;\n        options.channels = channels;\n      }\n\n    }\n\n    if (options.channels == undefined) options.channels = \"all\";\n\n    wm.sanitizeChannels(options.channels).forEach(ch => {\n      this.channels[ch].setModulationRange(semitones, cents, options);\n    });\n\n    return this;\n\n  };\n\n  /**\n   * Sends a master tuning message to the specified channel(s). The value is decimal and must be\n   * larger than -65 semitones and smaller than 64 semitones.\n   *\n   * Because of the way the MIDI specification works, the decimal portion of the value will be\n   * encoded with a resolution of 14bit. The integer portion must be between -64 and 63\n   * inclusively. This function actually generates two MIDI messages: a **Master Coarse Tuning** and\n   * a **Master Fine Tuning** RPN messages.\n   *\n   * @param [value=0.0] {number} The desired decimal adjustment value in semitones (-65 < x < 64)\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]|\"all\"} [options.channels=\"all\"] The MIDI channel number (between `1`\n   * and `16`) or an array of channel numbers to use. The special value `\"all\"` can also be used to\n   * use all channels (default).\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @throws {RangeError} The value must be a decimal number between larger than -65 and smaller\n   * than 64.\n   *\n   * @return {Output} Returns the `Output` object so methods can be chained.\n   *\n   * @since 3.0.0\n   */\n  setMasterTuning(value, options = {}, legacy = {}) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (Array.isArray(options) || Number.isInteger(options) || options === \"all\") {\n        let channels = options;\n        options = legacy;\n        options.channels = channels;\n      }\n\n    }\n\n    if (options.channels == undefined) options.channels = \"all\";\n\n    wm.sanitizeChannels(options.channels).forEach(ch => {\n      this.channels[ch].setMasterTuning(value, options);\n    });\n\n    return this;\n\n  }\n\n  /**\n   * Sets the MIDI tuning program to use. Note that the **Tuning Program** parameter is part of the\n   * *MIDI Tuning Standard*, which is not widely implemented.\n   *\n   * **Note**: since version 3.0, the program number is an integer between 1 and 128. In versions\n   * 1.0 and 2.0, the number was between 0 and 127. This change aligns WebMidi.js with most devices\n   * that use a numbering scheme starting at 1.\n   *\n   * @param value {number} The desired tuning program (1-128).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]|\"all\"} [options.channels=\"all\"] The MIDI channel number (between `1`\n   * and `16`) or an array of channel numbers to use. The special value `\"all\"` can also be used to\n   * use all channels (default).\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @throws {RangeError} The program value must be between 1 and 128.\n   *\n   * @return {Output} Returns the `Output` object so methods can be chained.\n   *\n   * @since 3.0.0\n   */\n  setTuningProgram(value, options = {}, legacy = {}) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (Array.isArray(options) || Number.isInteger(options) || options === \"all\") {\n        let channels = options;\n        options = legacy;\n        options.channels = channels;\n      }\n\n    }\n\n    if (options.channels == undefined) options.channels = \"all\";\n\n    wm.sanitizeChannels(options.channels).forEach(ch => {\n      this.channels[ch].setTuningProgram(value, options);\n    });\n\n    return this;\n\n  }\n\n  /**\n   * Sets the MIDI tuning bank to use. Note that the **Tuning Bank** parameter is part of the\n   * *MIDI Tuning Standard*, which is not widely implemented.\n   *\n   * **Note**: since version 3.0, the bank number is an integer between 1 and 128. In versions\n   * 1.0 and 2.0, the number was between 0 and 127. This change aligns WebMidi.js with most devices\n   * that use a numbering scheme starting at 1.\n   *\n   * @param value {number} The desired tuning bank (1-128).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]|\"all\"} [options.channels=\"all\"] The MIDI channel number (between `1`\n   * and `16`) or an array of channel numbers to use. The special value `\"all\"` can also be used to\n   * use all channels (default).\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @throws {RangeError} The bank value must be between 1 and 128.\n   *\n   * @return {Output} Returns the `Output` object so methods can be chained.\n   *\n   * @since 3.0.0\n   */\n  setTuningBank(value, options = {}, legacy = {}) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (Array.isArray(options) || Number.isInteger(options) || options === \"all\") {\n        let channels = options;\n        options = legacy;\n        options.channels = channels;\n      }\n\n    }\n\n    if (options.channels == undefined) options.channels = \"all\";\n\n    wm.sanitizeChannels(options.channels).forEach(ch => {\n      this.channels[ch].setTuningBank(value, options);\n    });\n\n    return this;\n\n  };\n\n  /**\n   * Sends a MIDI **channel mode** message to the specified channel(s). The channel mode message to\n   * send can be specified numerically or by using one of the following common names:\n   *\n   *   * `\"allsoundoff\"` (#120)\n   *   * `\"resetallcontrollers\"` (#121)\n   *   * `\"localcontrol\"` (#122)\n   *   * `\"allnotesoff\"` (#123)\n   *   * `\"omnimodeoff\"` (#124)\n   *   * `\"omnimodeon\"` (#125)\n   *   * `\"monomodeon\"` (#126)\n   *   * `\"polymodeon\"` (#127)\n   *\n   * It should be noted that, per the MIDI specification, only `localcontrol` and `monomodeon` may\n   * require a value that's not zero. For that reason, the `value` parameter is optional and\n   * defaults to 0.\n   *\n   * To make it easier, all channel mode messages have a matching helper method:\n   *\n   *   - [turnSoundOff()]{@link OutputChannel#turnSoundOff}\n   *   - [resetAllControllers()]{@link OutputChannel#resetAllControllers}\n   *   - [setLocalControl()]{@link OutputChannel#turnSoundOff}\n   *   - [turnNotesOff()]{@link OutputChannel#turnNotesOff}\n   *   - [setOmniMode()]{@link OutputChannel#setOmniMode}\n   *   - [setPolyphonicMode()]{@link OutputChannel#setPolyphonicMode}\n   *\n   * @param command {number|string} The numerical identifier of the channel mode message (integer\n   * between 120-127) or its name as a string.\n   *\n   * @param [value] {number} The value to send (integer between 0-127).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]|\"all\"} [options.channels=\"all\"] The MIDI channel number (between `1`\n   * and `16`) or an array of channel numbers to use. The special value `\"all\"` can also be used to\n   * use all channels (default).\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @throws {TypeError} Invalid channel mode message name.\n   * @throws {RangeError} Channel mode controller numbers must be between 120 and 127.\n   * @throws {RangeError} Value must be an integer between 0 and 127.\n   *\n   * @return {Output} Returns the `Output` object so methods can be chained.\n   *\n   */\n  sendChannelMode(command, value, options = {}, legacy = {}) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (Array.isArray(options) || Number.isInteger(options) || options === \"all\") {\n        let channels = options;\n        options = legacy;\n        options.channels = channels;\n      }\n\n    }\n\n    if (options.channels == undefined) options.channels = \"all\";\n\n    wm.sanitizeChannels(options.channels).forEach(ch => {\n      this.channels[ch].sendChannelMode(command, value, options);\n    });\n\n    return this;\n\n  }\n\n  /**\n   * Sends an **all sound off** channel mode message. This will silence all sounds playing on that\n   * channel but will not prevent new sounds from being triggered.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]|\"all\"} [options.channels=\"all\"] The MIDI channel number (between `1`\n   * and `16`) or an array of channel numbers to use. The special value `\"all\"` can also be used to\n   * use all channels (default).\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @returns {Output}\n   *\n   * @since 3.0.0\n   */\n  turnSoundOff(options = {}, legacy = {}) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (Array.isArray(options) || Number.isInteger(options) || options === \"all\") {\n        let channels = options;\n        options = legacy;\n        options.channels = channels;\n      }\n\n    }\n\n    if (options.channels == undefined) options.channels = \"all\";\n\n    wm.sanitizeChannels(options.channels).forEach(ch => {\n      this.channels[ch].turnSoundOff(options);\n    });\n\n    return this;\n\n  }\n\n  /**\n   * Sends an **all note soff** channel mode message. This will turn all currently playing notes\n   * off. However, this does not prevent new notes from being played.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]|\"all\"} [options.channels=\"all\"] The MIDI channel number (between `1`\n   * and `16`) or an array of channel numbers to use. The special value `\"all\"` can also be used to\n   * use all channels (default).\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @returns {Output}\n   *\n   * @since 3.0.0\n   */\n  turnNotesOff(options = {}, legacy = {}) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (Array.isArray(options) || Number.isInteger(options) || options === \"all\") {\n        let channels = options;\n        options = legacy;\n        options.channels = channels;\n      }\n\n    }\n\n    if (options.channels == undefined) options.channels = \"all\";\n\n    wm.sanitizeChannels(options.channels).forEach(ch => {\n      this.channels[ch].turnNotesOff(options);\n    });\n\n    return this;\n\n  }\n\n  /**\n   * Sends a **reset all controllers** channel mode message. This resets all controllers, such as\n   * the pitch bend, to their default value.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]|\"all\"} [options.channels=\"all\"] The MIDI channel number (between `1`\n   * and `16`) or an array of channel numbers to use. The special value `\"all\"` can also be used to\n   * use all channels (default).\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @returns {Output}\n   */\n  resetAllControllers(options = {}, legacy = {}) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (Array.isArray(options) || Number.isInteger(options) || options === \"all\") {\n        let channels = options;\n        options = legacy;\n        options.channels = channels;\n      }\n\n    }\n\n    if (options.channels == undefined) options.channels = \"all\";\n\n    wm.sanitizeChannels(options.channels).forEach(ch => {\n      this.channels[ch].resetAllControllers(options);\n    });\n\n    return this;\n\n  }\n\n  /**\n   * Sets the polyphonic mode. In `\"poly\"` mode (usually the default), multiple notes can be played\n   * and heard at the same time. In `\"mono\"` mode, only one note will be heard at once even if\n   * multiple notes are being played.\n   *\n   * @param mode {string} The mode to use: `\"mono\"` or `\"poly\"`.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]|\"all\"} [options.channels=\"all\"] The MIDI channel number (between `1`\n   * and `16`) or an array of channel numbers to use. The special value `\"all\"` can also be used to\n   * use all channels (default).\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @return {Output} Returns the `Output` object so methods can be chained.\n   *\n   * @since 3.0.0\n   */\n  setPolyphonicMode(mode, options = {}, legacy = {}) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (Array.isArray(options) || Number.isInteger(options) || options === \"all\") {\n        let channels = options;\n        options = legacy;\n        options.channels = channels;\n      }\n\n    }\n\n    if (options.channels == undefined) options.channels = \"all\";\n\n    wm.sanitizeChannels(options.channels).forEach(ch => {\n      this.channels[ch].setPolyphonicMode(mode, options);\n    });\n\n    return this;\n\n  }\n\n  /**\n   * Turns local control on or off. Local control is usually enabled by default. If you disable it,\n   * the instrument will no longer trigger its own sounds. It will only send the MIDI messages to\n   * its out port.\n   *\n   * @param [state=false] {boolean} Whether to activate local control (`true`) or disable it\n   * (`false`).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]|\"all\"} [options.channels=\"all\"] The MIDI channel number (between `1`\n   * and `16`) or an array of channel numbers to use. The special value `\"all\"` can also be used to\n   * use all channels (default).\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @return {Output} Returns the `Output` object so methods can be chained.\n   *\n   * @since 3.0.0\n   */\n  setLocalControl(state, options = {}, legacy = {}) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (Array.isArray(options) || Number.isInteger(options) || options === \"all\") {\n        let channels = options;\n        options = legacy;\n        options.channels = channels;\n      }\n\n    }\n\n    if (options.channels == undefined) options.channels = \"all\";\n\n    wm.sanitizeChannels(options.channels).forEach(ch => {\n      this.channels[ch].setLocalControl(state, options);\n    });\n\n    return this;\n\n  }\n\n  /**\n   * Sets OMNI mode to `\"on\"` or `\"off\"` for the specified channel(s). MIDI's OMNI mode causes the\n   * instrument to respond to messages from all channels.\n   *\n   * It should be noted that support for OMNI mode is not as common as it used to be.\n   *\n   * @param [state] {boolean} Whether to activate OMNI mode (`true`) or not (`false`).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]|\"all\"} [options.channels=\"all\"] The MIDI channel number (between `1`\n   * and `16`) or an array of channel numbers to use. The special value `\"all\"` can also be used to\n   * use all channels (default).\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @throws {TypeError} Invalid channel mode message name.\n   * @throws {RangeError} Channel mode controller numbers must be between 120 and 127.\n   * @throws {RangeError} Value must be an integer between 0 and 127.\n   *\n   * @return {Output} Returns the `Output` object so methods can be chained.\n   *\n   * @since 3.0.0\n   */\n  setOmniMode(state, options = {}, legacy = {}) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (Array.isArray(options) || Number.isInteger(options) || options === \"all\") {\n        let channels = options;\n        options = legacy;\n        options.channels = channels;\n      }\n\n    }\n\n    if (options.channels == undefined) options.channels = \"all\";\n\n    wm.sanitizeChannels(options.channels).forEach(ch => {\n      this.channels[ch].setOmniMode(state, options);\n    });\n\n    return this;\n\n  }\n\n  /**\n   * Sets a non-registered parameter to the specified value. The NRPN is selected by passing in a\n   * two-position array specifying the values of the two control bytes. The value is specified by\n   * passing in a single integer (most cases) or an array of two integers.\n   *\n   * NRPNs are not standardized in any way. Each manufacturer is free to implement them any way\n   * they see fit. For example, according to the Roland GS specification, you can control the\n   * **vibrato rate** using NRPN (1, 8). Therefore, to set the **vibrato rate** value to **123** you\n   * would use:\n   *\n   * ```js\n   * WebMidi.outputs[0].setNonRegisteredParameter([1, 8], 123);\n   * ```\n   *\n   * Obviously, you should select a channel so the message is not sent to all channels. For\n   * instance, to send to channel 1 of the first output port, you would use:\n   *\n   * ```js\n   * WebMidi.outputs[0].setNonRegisteredParameter([1, 8], 123, 1);\n   * ```\n   *\n   * In some rarer cases, you need to send two values with your NRPN messages. In such cases, you\n   * would use a 2-position array. For example, for its **ClockBPM** parameter (2, 63), Novation\n   * uses a 14-bit value that combines an MSB and an LSB (7-bit values). So, for example, if the\n   * value to send was 10, you could use:\n   *\n   * ```js\n   * WebMidi.outputs[0].setNonRegisteredParameter([2, 63], [0, 10], [1]);\n   * ```\n   *\n   * For further implementation details, refer to the manufacturer\"s documentation.\n   *\n   * @param parameter {number[]} A two-position array specifying the two control bytes (0x63,\n   * 0x62) that identify the non-registered parameter.\n   *\n   * @param [data=[]] {number|number[]} An integer or an array of integers with a length of 1 or 2\n   * specifying the desired data.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]|\"all\"} [options.channels=\"all\"] The MIDI channel number (between `1`\n   * and `16`) or an array of channel numbers to use. The special value `\"all\"` can also be used to\n   * use all channels (default).\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @throws {RangeError} The control value must be between 0 and 127.\n   * @throws {RangeError} The msb value must be between 0 and 127\n   *\n   * @returns {Output} Returns the `Output` object so methods can be chained.\n   */\n  setNonRegisteredParameter(parameter, data, options = {}, legacy = {}) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (Array.isArray(options) || Number.isInteger(options) || options === \"all\") {\n        let channels = options;\n        options = legacy;\n        options.channels = channels;\n      }\n\n    }\n\n    if (options.channels == undefined) options.channels = \"all\";\n\n    wm.sanitizeChannels(options.channels).forEach(ch => {\n      this.channels[ch].setNonRegisteredParameter(parameter, data, options);\n    });\n\n    return this;\n\n  }\n\n  /**\n   * Increments the specified MIDI registered parameter by 1. Here is the full list of parameter\n   * names that can be used with this method:\n   *\n   *  * Pitchbend Range (0x00, 0x00): `\"pitchbendrange\"`\n   *  * Channel Fine Tuning (0x00, 0x01): `\"channelfinetuning\"`\n   *  * Channel Coarse Tuning (0x00, 0x02): `\"channelcoarsetuning\"`\n   *  * Tuning Program (0x00, 0x03): `\"tuningprogram\"`\n   *  * Tuning Bank (0x00, 0x04): `\"tuningbank\"`\n   *  * Modulation Range (0x00, 0x05): `\"modulationrange\"`\n   *  * Azimuth Angle (0x3D, 0x00): `\"azimuthangle\"`\n   *  * Elevation Angle (0x3D, 0x01): `\"elevationangle\"`\n   *  * Gain (0x3D, 0x02): `\"gain\"`\n   *  * Distance Ratio (0x3D, 0x03): `\"distanceratio\"`\n   *  * Maximum Distance (0x3D, 0x04): `\"maximumdistance\"`\n   *  * Maximum Distance Gain (0x3D, 0x05): `\"maximumdistancegain\"`\n   *  * Reference Distance Ratio (0x3D, 0x06): `\"referencedistanceratio\"`\n   *  * Pan Spread Angle (0x3D, 0x07): `\"panspreadangle\"`\n   *  * Roll Angle (0x3D, 0x08): `\"rollangle\"`\n   *\n   * @param parameter {String|number[]} A string identifying the parameter's name (see above) or a\n   * two-position array specifying the two control bytes (0x65, 0x64) that identify the registered\n   * parameter.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]|\"all\"} [options.channels=\"all\"] The MIDI channel number (between `1`\n   * and `16`) or an array of channel numbers to use. The special value `\"all\"` can also be used to\n   * use all channels (default).\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @returns {Output} Returns the `Output` object so methods can be chained.\n   */\n  incrementRegisteredParameter(parameter, options = {}, legacy = {}) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (Array.isArray(options) || Number.isInteger(options) || options === \"all\") {\n        let channels = options;\n        options = legacy;\n        options.channels = channels;\n      }\n\n    }\n\n    if (options.channels == undefined) options.channels = \"all\";\n\n    wm.sanitizeChannels(options.channels).forEach(ch => {\n      this.channels[ch].incrementRegisteredParameter(parameter, options);\n    });\n\n    return this;\n\n  }\n\n  /**\n   * Decrements the specified MIDI registered parameter by 1. Here is the full list of parameter\n   * names that can be used with this method:\n   *\n   *  * Pitchbend Range (0x00, 0x00): `\"pitchbendrange\"`\n   *  * Channel Fine Tuning (0x00, 0x01): `\"channelfinetuning\"`\n   *  * Channel Coarse Tuning (0x00, 0x02): `\"channelcoarsetuning\"`\n   *  * Tuning Program (0x00, 0x03): `\"tuningprogram\"`\n   *  * Tuning Bank (0x00, 0x04): `\"tuningbank\"`\n   *  * Modulation Range (0x00, 0x05): `\"modulationrange\"`\n   *  * Azimuth Angle (0x3D, 0x00): `\"azimuthangle\"`\n   *  * Elevation Angle (0x3D, 0x01): `\"elevationangle\"`\n   *  * Gain (0x3D, 0x02): `\"gain\"`\n   *  * Distance Ratio (0x3D, 0x03): `\"distanceratio\"`\n   *  * Maximum Distance (0x3D, 0x04): `\"maximumdistance\"`\n   *  * Maximum Distance Gain (0x3D, 0x05): `\"maximumdistancegain\"`\n   *  * Reference Distance Ratio (0x3D, 0x06): `\"referencedistanceratio\"`\n   *  * Pan Spread Angle (0x3D, 0x07): `\"panspreadangle\"`\n   *  * Roll Angle (0x3D, 0x08): `\"rollangle\"`\n   *\n   * @param parameter {String|number[]} A string identifying the parameter\"s name (see above) or a\n   * two-position array specifying the two control bytes (0x65, 0x64) that identify the registered\n   * parameter.\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]|\"all\"} [options.channels=\"all\"] The MIDI channel number (between `1`\n   * and `16`) or an array of channel numbers to use. The special value `\"all\"` can also be used to\n   * use all channels (default).\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @throws TypeError The specified parameter is not available.\n   *\n   * @returns {Output} Returns the `Output` object so methods can be chained.\n   */\n  decrementRegisteredParameter(parameter, options = {}, legacy = {}) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (Array.isArray(options) || Number.isInteger(options) || options === \"all\") {\n        let channels = options;\n        options = legacy;\n        options.channels = channels;\n      }\n\n    }\n\n    if (options.channels == undefined) options.channels = \"all\";\n\n    wm.sanitizeChannels(options.channels).forEach(ch => {\n      this.channels[ch].decrementRegisteredParameter(parameter, options);\n    });\n\n    return this;\n\n  }\n\n  /**\n   * Sends a **note off** message for the specified notes on the specified channel(s). The first\n   * parameter is the note. It can be a single value or an array of the following valid values:\n   *\n   *  - A MIDI note number (integer between `0` and `127`)\n   *  - A note name, followed by the octave (e.g. `\"C3\"`, `\"G#4\"`, `\"F-1\"`, `\"Db7\"`)\n   *  - A {@link Note} object\n   *\n   *  The execution of the **note off** command can be delayed by using the `time` property of the\n   * `options` parameter.\n   *\n   * When using {@link Note} objects, the release velocity defined in the {@link Note} objects has\n   * precedence over the one specified via the method's `options` parameter.\n   *\n   * @param note {number|string|Note|number[]|string[]|Note[]} The note(s) to stop. The notes can be\n   * specified by using a MIDI note number (0-127), a note name (e.g. C3, G#4, F-1, Db7), a\n   * {@link Note} object or an array of the previous types. When using a note name, octave range\n   * must be between -1 and 9. The lowest note is C-1 (MIDI note number 0) and the highest\n   * note is G9 (MIDI note number 127).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]|\"all\"} [options.channels=\"all\"] The MIDI channel number (between `1`\n   * and `16`) or an array of channel numbers to use. The special value `\"all\"` can also be used to\n   * use all channels (default).\n   *\n   * @param {boolean} [options.rawValue=false] Controls whether the release velocity is set using\n   * integers between `0` and `127` (`true`) or a decimal number between `0` and `1` (`false`,\n   * default).\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @param {number} [options.release=0.5] The velocity at which to release the note (between `0`\n   * and `1`). If the `rawValue` option is `true`, the value should be specified as an integer\n   * between `0` and `127`. An invalid velocity value will silently trigger the default of `0.5`.\n   *\n   * @returns {Output} Returns the `Output` object so methods can be chained.\n   */\n  sendNoteOff(note, options= {}, legacy = {}) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (Array.isArray(options) || Number.isInteger(options) || options === \"all\") {\n        let channels = options;\n        options = legacy;\n        options.channels = channels;\n      }\n\n    }\n\n    if (options.channels == undefined) options.channels = \"all\";\n\n    wm.sanitizeChannels(options.channels).forEach(ch => {\n      this.channels[ch].sendNoteOff(note, options);\n    });\n\n    return this;\n\n  }\n\n  /**\n   * This is an alias to the [sendNoteOff()]{@link Output#sendNoteOff} method.\n   *\n   * @see {@link Output#sendNoteOff}\n   *\n   * @param note\n   * @param options\n   * @returns {Output}\n   */\n  stopNote(note, options) {\n    return this.sendNoteOff(note, options);\n  }\n\n  /**\n   * Plays a note or an array of notes on one or more channels of this output. The first parameter\n   * is the note to play. It can be a single value or an array of the following valid values:\n   *\n   *  - A MIDI note number (integer between `0` and `127`)\n   *  - A note name, followed by the octave (e.g. `\"C3\"`, `\"G#4\"`, `\"F-1\"`, `\"Db7\"`)\n   *  - A {@link Note} object\n   *\n   * The `playNote()` method sends a **note on** MIDI message for all specified notes on all\n   * specified channels. If no channels are specified, it will send to all channels. If a `duration`\n   * is set in the `options` parameter or in the {@link Note} object's\n   * [duration]{@link Note#duration} property, it will also schedule a **note off** message to end\n   * the note after said duration. If no `duration` is set, the note will simply play until a\n   * matching **note off** message is sent with [stopNote()]{@link Output#stopNote} or\n   * [sendNoteOff()]{@link Output#sendNoteOff}.\n   *\n   * The execution of the **note on** command can be delayed by using the `time` property of the\n   * `options` parameter.\n   *\n   * When using {@link Note} objects, the durations and velocities defined in the {@link Note}\n   * objects have precedence over the ones specified via the method's `options` parameter.\n   *\n   * **Note**: As per the MIDI standard, a **note on** message with an attack velocity of `0` is\n   * functionally equivalent to a **note off** message.\n   *\n   * @param note {number|string|Note|number[]|string[]|Note[]} The note(s) to play. The notes can be\n   * specified by using a MIDI note number (0-127), a note name (e.g. C3, G#4, F-1, Db7), a\n   * {@link Note} object or an array of the previous types. When using a note name, octave range\n   * must be between -1 and 9. The lowest note is C-1 (MIDI note number 0) and the highest\n   * note is G9 (MIDI note number 127).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]|\"all\"} [options.channels=\"all\"] The MIDI channel number (between `1`\n   * and `16`) or an array of channel numbers to play the note on. The special value `\"all\"` can\n   * also be used to use all channels (default).\n   *\n   * @param {number} [options.duration=undefined] The number of milliseconds (integer) after which a\n   * **note off** message will be scheduled. If left undefined, only a **note on** message is sent.\n   *\n   * @param {boolean} [options.rawValue=false] Controls whether the attack and release velocities\n   * are set using integers between `0` and `127` (`true`) or a decimal number between `0` and `1`\n   * (`false`, default).\n   *\n   * @param {number} [options.release=0.5] The velocity at which to release the note (between `0`\n   * and `1`). If the `rawValue` option is `true`, the value should be specified as an integer\n   * between `0` and `127`. An invalid velocity value will silently trigger the default of `0.5`.\n   * This is only used with the **note off** event triggered when `options.duration` is set.\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @param {number} [options.attack=0.5] The attack velocity to use when playing the note (between\n   * `0` and `1`). If the `rawValue` option is `true`, the value should be specified as an integer\n   * between `0` and `127`. An invalid velocity value will silently trigger the default of `0.5`.\n   *\n   * @returns {Output} Returns the `Output` object so methods can be chained.\n   */\n  playNote(note, options = {}, legacy = {}) {\n\n    if (wm.validation) {\n\n      // Legacy-compatibility warnings\n      if (options.rawVelocity) {\n        console.warn(\"The 'rawVelocity' option is deprecated. Use 'rawAttack' instead.\");\n      }\n\n      if (options.velocity) {\n        console.warn(\"The 'velocity' option is deprecated. Use 'velocity' instead.\");\n      }\n\n      // Legacy compatibility\n      if (Array.isArray(options) || Number.isInteger(options) || options === \"all\") {\n        let channels = options;\n        options = legacy;\n        options.channels = channels;\n      }\n\n    }\n\n    if (options.channels == undefined) options.channels = \"all\";\n\n    wm.sanitizeChannels(options.channels).forEach(ch => {\n      this.channels[ch].playNote(note, options);\n    });\n\n    return this;\n\n  }\n\n  /**\n   * Sends a **note on** message for the specified notes on the specified channel(s). The first\n   * parameter is the note. It can be a single value or an array of the following valid values:\n   *\n   *  - A MIDI note number (integer between `0` and `127`)\n   *  - A note name, followed by the octave (e.g. `\"C3\"`, `\"G#4\"`, `\"F-1\"`, `\"Db7\"`)\n   *  - A {@link Note} object\n   *\n   *  The execution of the **note on** command can be delayed by using the `time` property of the\n   * `options` parameter.\n   *\n   * When using {@link Note} objects, the attack velocity defined in the {@link Note} objects has\n   * precedence over the one specified via the method's `options` parameter. Also, the `duration` is\n   * ignored. If you want to also send a **note off** message, use the\n   * [playNote()]{@link Output#playNote} method instead.\n   *\n   * **Note**: As per the MIDI standard, a **note on** message with an attack velocity of `0` is\n   * functionally equivalent to a **note off** message.\n   *\n   * @param note {number|string|Note|number[]|string[]|Note[]} The note(s) to play. The notes can be\n   * specified by using a MIDI note number (0-127), a note name (e.g. C3, G#4, F-1, Db7), a\n   * {@link Note} object or an array of the previous types. When using a note name, octave range\n   * must be between -1 and 9. The lowest note is C-1 (MIDI note number 0) and the highest\n   * note is G9 (MIDI note number 127).\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number|number[]|\"all\"} [options.channels=\"all\"] The MIDI channel number (between `1`\n   * and `16`) or an array of channel numbers to use. The special value `\"all\"` can also be used to\n   * use all channels (default).\n   *\n   * @param {boolean} [options.rawValue=false] Controls whether the attack velocity is set using\n   * integers between `0` and `127` (`true`) or a decimal number between `0` and `1` (`false`,\n   * default).\n   *\n   * @param {number|string} [options.time] If `time` is a string prefixed with `\"+\"` and followed by\n   * a number, the message will be delayed by that many milliseconds. If the value is a number\n   * (DOMHighResTimeStamp), the operation will be scheduled for that time. If `time` is omitted, or\n   * in the past, the operation will be carried out as soon as possible.\n   *\n   * @param {number} [options.attack=0.5] The velocity at which to play the note (between `0` and\n   * `1`). If the `rawValue` option is `true`, the value should be specified as an integer\n   * between `0` and `127`. An invalid velocity value will silently trigger the default of `0.5`.\n   *\n   * @returns {Output} Returns the `Output` object so methods can be chained.\n   */\n  sendNoteOn(note, options = {}, legacy = {}) {\n\n    if (wm.validation) {\n\n      // Legacy compatibility\n      if (Array.isArray(options) || Number.isInteger(options) || options === \"all\") {\n        let channels = options;\n        options = legacy;\n        options.channels = channels;\n      }\n\n    }\n\n    if (options.channels == undefined) options.channels = \"all\";\n\n    wm.sanitizeChannels(options.channels).forEach(ch => {\n      this.channels[ch].sendNoteOn(note, options);\n    });\n\n    return this;\n\n  }\n\n  /**\n   * Name of the MIDI output\n   *\n   * @type {string}\n   * @readonly\n   */\n  get name() {\n    return this._midiOutput.name;\n  }\n\n  /**\n   * ID string of the MIDI output. The ID is host-specific. Do not expect the same ID on different\n   * platforms. For example, Google Chrome and the Jazz-Plugin report completely different IDs for\n   * the same port.\n   *\n   * @type {string}\n   * @readonly\n   */\n  get id() {\n    return this._midiOutput.id;\n  }\n\n  /**\n   * Output port's connection state: `\"pending\"`, `\"open\"` or `\"closed\"`.\n   *\n   * @type {string}\n   * @readonly\n   */\n  get connection() {\n    return this._midiOutput.connection;\n  }\n\n  /**\n   * Name of the manufacturer of the device that makes this output port available.\n   *\n   * @type {string}\n   * @readonly\n   */\n  get manufacturer() {\n    return this._midiOutput.manufacturer;\n  }\n\n  /**\n   * State of the output port: `\"connected\"` or `\"disconnected\"`.\n   *\n   * @type {string}\n   * @readonly\n   */\n  get state() {\n    return this._midiOutput.state;\n  }\n\n  /**\n   * Type of the output port (`\"output\"`)\n   *\n   * @type {string}\n   * @readonly\n   */\n  get type() {\n    return this._midiOutput.type;\n  }\n\n}\n\n/**\n * The `Note` class represents a single note to be played. The `Note` can be played on a single\n * channel by using [OutputChannel.playNote()]{@link OutputChannel#playNote} or on multiple\n * channels at once by using [Output.playNote()]{@link Output#playNote}.\n *\n * If the note's `duration` property is set, the note will be stopped at the end of the duration. If\n * no duration is set, it will play until it is explicitly stopped using\n * [OutputChannel.stopNote()]{@link OutputChannel#stopNote} or\n * [Output.stopNote()]{@link Output#stopNote}.\n *\n * @param value {string|number} The name or note number of the note to create. If a number is used,\n * it must be an integer between 0 and 127. If a string is used, it must be the note name followed\n * by the octave (`\"C3\"`, `\"G#4\"`, `\"F-1\"`, `\"Db7\"`, etc.). The octave range must be between -1 and\n * 9. The lowest note is C-1 (MIDI note number 0) and the highest note is G9 (MIDI note number 127).\n *\n * @param {Object} [options={}]\n *\n * @param {number} [options.duration=Infinity] The number of milliseconds before the note should be\n * explicitly stopped.\n *\n * @param {number} [options.attack=0.5] The note's attack velocity as a decimal number between 0 and\n * 1.\n *\n * @param {number} [options.release=0.5] The note's release velocity as a decimal number between 0\n * and 1.\n *\n * @param {number} [options.rawAttack=64] The note's attack velocity as an integer between 0 and\n * 127.\n *\n * @param {number} [options.rawRelease=64] The note's release velocity as an integer between 0 and\n * 127.\n *\n * @throws {Error} Invalid note name.\n * @throws {Error} Invalid note number.\n * @throws {RangeError} Invalid duration.\n * @throws {RangeError} Invalid attack value.\n * @throws {RangeError} Invalid rawAttack value.\n * @throws {RangeError} Invalid release value.\n * @throws {RangeError} Invalid rawRelease value.\n *\n * @since 3.0.0\n */\nclass Note {\n\n  constructor(value, options = {}) {\n\n    if (Number.isInteger(value)) {\n      this.number = value;\n    } else {\n      this.name = value;\n    }\n\n    this.duration = (options.duration == undefined) ? Infinity : options.duration;\n    this.attack = (options.attack == undefined) ? 0.5 : options.attack;\n    this.release = (options.release == undefined) ? 0.5 : options.release;\n    if (options.rawAttack != undefined) this.rawAttack = options.rawAttack;\n    if (options.rawRelease != undefined) this.rawRelease = options.rawRelease;\n\n  }\n\n  /**\n   * The name of the note with the octave number (`\"C3\"`, `\"G#4\"`, `\"F-1\"`, `\"Db7\"`, etc.)\n   *\n   * @type {string}\n   */\n  get name() {\n    return wm.NOTES[this._number % 12] + wm.getOctave(this.number);\n  }\n  set name(value) {\n\n    if (wm.validation) {\n      if (wm.guessNoteNumber(value) === false) throw new Error(\"Invalid note name.\");\n    }\n\n    this._number = wm.guessNoteNumber(value);\n\n  }\n\n  /**\n   * The MIDI note number as an integer between 0 and 127\n   * @type {number}\n   */\n  get number() {\n    return this._number;\n  }\n  set number(value) {\n\n    if (wm.validation) {\n      if (wm.guessNoteNumber(value) === false) throw new Error(\"Invalid note number.\");\n    }\n\n    this._number = wm.guessNoteNumber(value);\n\n  }\n\n  /**\n   * The duration of the note as a positive decimal number representing the number of milliseconds\n   * that the note should play for.\n   *\n   * @type {number}\n   */\n  get duration() {\n    return this._duration;\n  }\n  set duration(value) {\n\n    if (wm.validation) {\n      value = parseFloat(value);\n      if (isNaN(value) || value === null || value < 0) throw new RangeError(\"Invalid duration.\");\n    }\n\n    this._duration = value;\n\n  }\n\n  /**\n   * The attack velocity of the note as a decimal number between 0 and 1.\n   * @type {number}\n   */\n  get attack() {\n    return this._rawAttack / 127;\n  }\n  set attack(value) {\n\n    if (wm.validation) {\n      value = parseFloat(value);\n      if (isNaN(value) || value === null || !(value >= 0 && value <= 1)) {\n        throw new RangeError(\"Invalid attack value.\");\n      }\n    }\n\n    this._rawAttack = Math.round(value * 127);\n\n  }\n\n  /**\n   * The raw attack velocity of the note as an integer between 0 and 127.\n   * @type {number}\n   */\n  get rawAttack() {\n    return this._rawAttack;\n  }\n  set rawAttack(value) {\n\n    if (wm.validation) {\n      value = parseFloat(value);\n      if (isNaN(value) || value === null || !(value >= 0 && value <= 127)) {\n        throw new RangeError(\"Invalid rawAttack value.\");\n      }\n    }\n\n    this._rawAttack = value;\n\n  }\n\n  /**\n   * The release velocity of the note as a decimal number between 0 and 1.\n   * @type {number}\n   */\n  get release() {\n    return this._rawRelease / 127;\n  }\n  set release(value) {\n\n    if (wm.validation) {\n      value = parseFloat(value);\n      if (isNaN(value) || value === null || !(value >= 0 && value <= 1)) {\n        throw new RangeError(\"Invalid release value.\");\n      }\n    }\n\n    this._rawRelease = Math.round(value * 127);\n\n  }\n\n  /**\n   * The raw release velocity of the note as an integer between 0 and 127.\n   * @type {number}\n   */\n  get rawRelease() {\n    return this._rawRelease;\n  }\n  set rawRelease(value) {\n\n    if (wm.validation) {\n      value = parseFloat(value);\n      if (isNaN(value) || value === null || !(value >= 0 && value <= 127)) {\n        throw new RangeError(\"Invalid rawRelease value.\");\n      }\n    }\n\n    this._rawRelease = value;\n\n  }\n\n  /**\n   * The octave of the note as an integer between -1 and 9.\n   * @type {number}\n   */\n  get octave() {\n    return Math.floor(Math.floor(this._number) / 12 - 1);\n  }\n\n}\n\n/**\n * The `WebMidi` object makes it easier to work with the Web MIDI API. Basically, it simplifies\n * sending outgoing MIDI messages and reacting to incoming MIDI messages.\n *\n * When using the WebMidi.js library, the `WebMidi` class has already been instantiated for you.\n * If you use the **IIFE** version, you should simply use the global object called `WebMidi`. If you\n * use the **CJS** (CommonJS) or **ESM** (ES6 module) version, you get an already-instantiated\n * object. This means there is no need to instantiate a new `WebMidi` object directly.\n *\n * The `WebMidi` object extends the\n * [EventEmitter](https://djipco.github.io/djipevents/EventEmitter.html) class from the\n * [djipevents]{@link https://djipco.github.io/djipevents/index.html} module. This means\n * it also includes methods such as\n * [addListener()](https://djipco.github.io/djipevents/EventEmitter.html#addListener),\n * [removeListener()](https://djipco.github.io/djipevents/EventEmitter.html#removeListener),\n * [hasListener()](https://djipco.github.io/djipevents/EventEmitter.html#hasListener) and several\n * others.\n *\n * @fires WebMidi#connected\n * @fires WebMidi#disconnected\n * @fires WebMidi#enabled\n * @fires WebMidi#disabled\n *\n * @extends EventEmitter\n */\nclass WebMidi extends e {\n\n  constructor() {\n\n    super();\n\n    /**\n     * The `MIDIAccess` instance used to talk to the Web MIDI API. This should not be used directly\n     * unless you know what you are doing.\n     *\n     * @type {?MIDIAccess}\n     * @readonly\n     */\n    this.interface = null;\n\n    /**\n     * Indicates whether argument validation and backwards-compatibility checks are performed\n     * throughout the WebMidi.js library for object methods and property setters.\n     *\n     * This is an advanced setting that should be used carefully. Setting `validation` to `false`\n     * improves performance but should only be done once the project has been thoroughly tested with\n     * validation turned on.\n     *\n     * @type {boolean}\n     */\n    this.validation = true;\n\n    /**\n     * Array of all {@link Input} objects\n     * @type {Input[]}\n     * @private\n     */\n    this._inputs = [];\n\n    /**\n     * Array of all {@link Output} objects\n     * @type {Output[]}\n     * @private\n     */\n    this._outputs = [];\n\n    /**\n     * Array of statechange events to process. These events must be parsed synchronously so they do\n     * not override each other.\n     *\n     * @type {string[]}\n     * @private\n     */\n    this._stateChangeQueue = [];\n\n    this._octaveOffset = 0;\n\n    // If we are inside Node.js, polyfill navigator.requestMIDIAccess() and import performance.now()\n    if (this.isNode) {\n\n      // Important: performance must be imported before jzz because jzz checks for its existence at\n      // startup and falls back to something less precise if absent.\n      global.performance = require(\"perf_hooks\").performance;\n      global.navigator = require(\"jzz\");\n\n    }\n\n  }\n\n  /**\n   * Checks if the Web MIDI API is available in the current environment and then tries to connect to\n   * the host's MIDI subsystem. This is an asynchronous operation and it causes a security prompt to\n   * be displayed to the user.\n   *\n   * To enable the use of MIDI system exclusive messages, the `sysex` option should be set to\n   * `true`. However, under some environments (e.g. Jazz-Plugin), the `sysex` option is ignored\n   * and system exclusive messages are always enabled. You can check the\n   * [sysexEnabled]{@link WebMidi#sysexEnabled} property to confirm.\n   *\n   * To enable access to software synthesizers available on the host, you would set the `software`\n   * option to `true`. However, this option is only there to future-proof the library as support for\n   * software synths has not yet been implemented in any browser (as of April 2020).\n   *\n   * There are 3 ways to execute code after `WebMidi` has been enabled:\n   *\n   * - Pass a callback function in the options\n   * - Listen to the `enabled` event\n   * - Wait for the promise to resolve\n   *\n   * In order, this is what happens towards the end of the enabling process:\n   *\n   * 1. callback is executed\n   * 2. `enabled` event is triggered\n   * 3. `connected` events from available inputs and outputs are triggered\n   * 4. promise is resolved\n   *\n   * The promise is fulfilled with an object containing two properties (`inputs` and `outputs`) that\n   * contain arrays of available inputs and outputs, respectively.\n   *\n   * **Important note**: starting with Chrome v77, a page using Web MIDI API must be hosted on a\n   * secure origin (`https://`, `localhost` or `file:///`) and the user will always be prompted to\n   * authorize the operation (no matter if the `sysex` option is `true` or not).\n   *\n   * ##### Examples\n   * ```js\n   * // Enabling WebMidi and using the promise\n   * WebMidi.enable().then(ports => {\n   *   console.log(\"WebMidi.js has been enabled!\");\n   *   console.log(\"Inputs: \", ports.inputs);\n   *   console.log(\"Outputs: \", ports.outputs);\n   * })\n   * ```\n   *\n   * ```js\n   * // Enabling WebMidi and listening to 'enabled' event\n   * WebMidi.addListener(\"enabled\", e => {\n   *   console.log(\"WebMidi.js has been enabled!\");\n   * });\n   * WebMidi.enable();\n   * ```\n   *\n   * ```js\n   * // Enabling WebMidi and using callback function\n   * WebMidi.enable({callback: e => {\n   *   console.log(\"WebMidi.js has been enabled!\");\n   * });\n   * ```\n   *\n   * @param [options] {Object}\n   *\n   * @param [options.callback] {function} A function to execute once the operation completes. This\n   * function will receive an `Error` object if enabling the Web MIDI API failed.\n   *\n   * @param [options.sysex=false] {boolean} Whether to enable MIDI system exclusive messages or not.\n   *\n   * @param [options.validation=true] {boolean} Whether to enable library-wide validation of method\n   * arguments and setter values. This is an advanced setting that should be used carefully. Setting\n   * `validation` to `false` improves performance but should only be done once the project has been\n   * thoroughly tested with validation turned on.\n   *\n   * @param [options.software=false] {boolean} Whether to request access to software synthesizers on\n   * the host system. This is part of the spec but has not yet been implemented by most browsers as\n   * of April 2020.\n   *\n   * @async\n   *\n   * @returns {Promise<Object>} The promise is fulfilled with an object containing two properties\n   * (`inputs` and `outputs`) that contain arrays of available inputs and outputs, respectively.\n   *\n   * @throws Error The Web MIDI API is not supported in your environment.\n   * @throws Error Jazz-Plugin must be installed to use WebMIDIAPIShim.\n   */\n  async enable(options = {}, sysex = false) {\n\n    if (this.enabled) return Promise.resolve();\n\n    this.validation = (options.validation !== false);\n\n    if (this.validation) {\n      // Backwards-compatibility. Previous syntax was: enable(callback, sysex)\n      if (typeof options === \"function\") options = {callback: options, sysex: sysex};\n      if (sysex) options.sysex = true;\n    }\n\n    // The Jazz-Plugin takes a while to be available (even after the Window's 'load' event has been\n    // fired). Therefore, we wait a little while to give it time to load.\n    if (!this.supported) {\n\n      await new Promise((resolve, reject) => {\n\n        const start = this.time;\n\n        const intervalID = setInterval(() => {\n\n          if (this.supported) {\n            clearInterval(intervalID);\n            resolve();\n          } else {\n            if (this.time > start + 1500) {\n              clearInterval(intervalID);\n              let error = new Error(\"Web MIDI API support is not available in your environment.\");\n              if (typeof options.callback === \"function\") options.callback(error);\n              reject(error);\n            }\n          }\n\n        }, 25);\n\n      });\n\n    }\n\n    // Request MIDI access\n    try {\n      this.interface = await navigator.requestMIDIAccess(\n        {sysex: options.sysex, software: options.software}\n      );\n    } catch(err) {\n      if (typeof options.callback === \"function\") options.callback(err);\n      return Promise.reject(err);\n    }\n\n    /**\n     * Event emitted once `WebMidi` has been successfully enabled.\n     *\n     * @event WebMidi#enabled\n     * @type {Object}\n     * @property {DOMHighResTimeStamp} timestamp The moment when the event occurred (in milliseconds\n     * since the navigation start of the document).\n     * @property {WebMidi} target The object that triggered the event\n     * @property {string} type `enabled`\n     */\n    let event = {\n      timestamp: this.time,\n      target: this,\n      type: \"enabled\"\n    };\n\n    // Trigger the 'enabled' event. We do it before emitting the 'connected' events so that they can\n    // be listened to in callbacks tied to the 'enabled' event.\n    this.emit(\"enabled\", event);\n    if (typeof options.callback === \"function\") options.callback();\n\n    // We setup the statechange listener before creating the ports so that if properly catches the\n    // the ports' `connected` events\n    this.interface.onstatechange = this._onInterfaceStateChange.bind(this);\n\n    // Update inputs and outputs (this is where `Input` and `Output` objects are created). If\n    // successful, we return a promise fulfilled with all the input/output ports that were found.\n    try {\n      let ports = await this._updateInputsAndOutputs();\n      return Promise.resolve({\n        inputs: ports[0],\n        outputs: ports[1]\n      });\n    } catch (err) {\n      return Promise.reject(err);\n    }\n\n  }\n\n  /**\n   * Completely disables `WebMidi.js` by unlinking the MIDI subsystem's interface and closing all\n   * {@link Input} and {@link Output} objects that may be available. This also means that listeners\n   * added to {@link Input} objects, {@link Output} objects or to `WebMidi` itself are also\n   * destroyed.\n   *\n   * @async\n   * @returns {Promise<void>}\n   *\n   * @throws Error The Web MIDI API is not supported by your environment.\n   *\n   * @since 2.0.0\n   */\n  async disable() {\n\n    if (!this.supported) throw new Error(\"The Web MIDI API is not supported by your environment.\");\n\n    return this._destroyInputsAndOutputs().then(() => {\n\n      if (this.isNode) navigator.close();\n\n      if (this.interface) this.interface.onstatechange = undefined;\n      this.interface = null; // also resets enabled, sysexEnabled\n\n      /**\n       * Event emitted once `WebMidi` has been successfully disabled.\n       *\n       * @event WebMidi#disabled\n       * @type {Object}\n       * @property {DOMHighResTimeStamp} timestamp The moment when the event occurred (in\n       * milliseconds since the navigation start of the document).\n       * @property {WebMidi} target The object that triggered the event\n       * @property {string} type `disabled`\n       */\n      let event = {\n        timestamp: this.time,\n        target: this,\n        type: \"disabled\"\n      };\n\n      // Finally, trigger the 'disabled' event and remove all listeners\n      this.emit(\"disabled\", event);\n      this.removeListener();\n\n    });\n\n  };\n\n  /**\n   * Returns the {@link Input} object that matches the specified ID string or `false` if no matching\n   * input is found. As per the Web MIDI API specification, IDs are strings (not integers).\n   *\n   * Please note that IDs change from one host to another. For example, Chrome does not use the same\n   * kind of IDs as Jazz-Plugin.\n   *\n   * @param id {string} The ID string of the input. IDs can be viewed by looking at the\n   * [inputs]{@link WebMidi#inputs} array. Even though they sometimes look like integers, IDs are\n   * strings.\n   *\n   * @returns {Input|false} An {@link Input} object matching the specified ID string. If no matching\n   * input can be found, the method returns `false`.\n   *\n   * @throws Error WebMidi is not enabled.\n   *\n   * @since 2.0.0\n   */\n  getInputById(id) {\n\n    if (this.validation) {\n      if (!this.enabled) throw new Error(\"WebMidi is not enabled.\");\n      if (!id) return false;\n    }\n\n    for (let i = 0; i < this.inputs.length; i++) {\n      if (this.inputs[i].id === id.toString()) return this.inputs[i];\n    }\n\n    return false;\n\n  };\n\n  /**\n   * Returns the first {@link Input} object whose name **contains** the specified string. Note that\n   * the port names change from one environment to another. For example, Chrome does not report\n   * input names in the same way as the Jazz-Plugin does.\n   *\n   * @param name {string} The non-empty string to look for within the name of MIDI inputs (such as\n   * those visible in the [inputs]{@link WebMidi#inputs} array).\n   *\n   * @returns {Input|false} The {@link Input} that was found or `false` if no input contained the\n   * specified name.\n   *\n   * @throws {Error} WebMidi is not enabled.\n   *\n   * @since 2.0.0\n   */\n  getInputByName(name) {\n\n    if (this.validation) {\n      if (!this.enabled) throw new Error(\"WebMidi is not enabled.\");\n      if (!name) return false;\n      name = name.toString();\n    }\n\n    for (let i = 0; i < this.inputs.length; i++) {\n      if (~this.inputs[i].name.indexOf(name)) return this.inputs[i];\n    }\n\n    return false;\n\n  };\n\n  /**\n   * Returns the first {@link Output} object whose name **contains** the specified string. Note that\n   * the port names change from one environment to another. For example, Chrome does not report\n   * input names in the same way as the Jazz-Plugin does.\n   *\n   * @param name {string} The non-empty string to look for within the name of MIDI inputs (such as\n   * those visible in the [outputs]{@link WebMidi#outputs} array).\n   *\n   * @returns {Output|false} The {@link Output} that was found or `false` if no output matched the\n   * specified name.\n   *\n   * @throws Error WebMidi is not enabled.\n   *\n   * @since 2.0.0\n   */\n  getOutputByName(name) {\n\n    if (this.validation) {\n      if (!this.enabled) throw new Error(\"WebMidi is not enabled.\");\n      if (!name) return false;\n      name = name.toString();\n    }\n\n    for (let i = 0; i < this.outputs.length; i++) {\n      if (~this.outputs[i].name.indexOf(name)) return this.outputs[i];\n    }\n\n    return false;\n\n  };\n\n  /**\n   * Returns the {@link Output} object that matches the specified ID string or `false` if no\n   * matching output is found. As per the Web MIDI API specification, IDs are strings (not\n   * integers).\n   *\n   * Please note that IDs change from one host to another. For example, Chrome does not use the same\n   * kind of IDs as Jazz-Plugin.\n   *\n   * @param id {string} The ID string of the port. IDs can be viewed by looking at the\n   * [outputs]{@link WebMidi#outputs} array.\n   *\n   * @returns {Output|false} An {@link Output} object matching the specified ID string. If no\n   * matching output can be found, the method returns `false`.\n   *\n   * @throws Error WebMidi is not enabled.\n   *\n   * @since 2.0.0\n   */\n  getOutputById(id) {\n\n    if (this.validation) {\n      if (!this.enabled) throw new Error(\"WebMidi is not enabled.\");\n      if (!id) return false;\n    }\n\n    for (let i = 0; i < this.outputs.length; i++) {\n      if (this.outputs[i].id === id.toString()) return this.outputs[i];\n    }\n\n    return false;\n\n  };\n\n  /**\n   * Returns a MIDI note number matching the note name passed in the form of a string parameter. The\n   * note name must include the octave number. The name can also optionally include a sharp (#),\n   * a double sharp (##), a flat (b) or a double flat (bb) symbol. For example, these are all valid\n   * names: C5, G4, D#-1, F0, Gb7, Eb-1, Abb4, B##6, etc.\n   *\n   * When converting note names to numbers, C4 is considered to be middle C (MIDI note number 60) as\n   * per the scientific pitch notation standard.\n   *\n   * The resulting note number is offset by the [octaveOffset]{@link WebMidi#octaveOffset} value (if\n   * not zero). For example, if you pass in \"C4\" and the [octaveOffset]{@link WebMidi#octaveOffset}\n   * value is 2, the resulting MIDI note number will be 36.\n   *\n   * **Note**: since v3.x, this function returns `false` instead of throwing an error when it cannot\n   * parse the name to a number.\n   *\n   * @param name {string} The name of the note in the form of a letter, followed by an optional \"#\",\n   * \"##\", \"b\" or \"bb\" followed by the octave number.\n   *\n   * @returns {number|false} The MIDI note number (an integer between 0 and 127) or `false` if the\n   * name could not successfully be parsed to a number.\n   */\n  getNoteNumberByName(name) {\n\n    if (this.validation) {\n      if (typeof name !== \"string\") name = \"\";\n    }\n\n    let matches = name.match(/([CDEFGAB])(#{0,2}|b{0,2})(-?\\d+)/i);\n    if(!matches) return false;\n\n    let semitones = {C: 0, D: 2, E: 4, F: 5, G: 7, A: 9, B: 11 };\n    let semitone = semitones[matches[1].toUpperCase()];\n    let octave = parseInt(matches[3]);\n    let result = ((octave + 1 - Math.floor(this.octaveOffset)) * 12) + semitone;\n\n    if (matches[2].toLowerCase().indexOf(\"b\") > -1) {\n      result -= matches[2].length;\n    } else if (matches[2].toLowerCase().indexOf(\"#\") > -1) {\n      result += matches[2].length;\n    }\n\n    if (result < 0 || result > 127) return false;\n\n    return result;\n\n  };\n\n  /**\n   * @private\n   * @deprecated since version 3.0. Use getNoteNumberByName() instead.\n   */\n  noteNameToNumber(name) {\n    console.warn(\n      \"The noteNameToNumber() method has been deprecated. Use getNoteNumberByName() instead.\"\n    );\n    return this.getNoteNumberByName(name);\n  }\n\n  /**\n   * Returns the octave number for the specified MIDI note number (0-127). By default, the value is\n   * based on middle C (note number 60) being placed on the 4th octave (C4). However, by using the\n   * [octaveOffset]{@link WebMidi#octaveOffset} property, you can offset the result as desired.\n   *\n   * **Note**: since v3.x, this method returns `false` instead of `undefined` when the value cannot\n   * be parsed to a valid octave.\n   *\n   * @param number {number} An integer representing a valid MIDI note number (between 0 and 127).\n   *\n   * @returns {number|false} The octave (as a signed integer) or `false` if the value could not be\n   * parsed to a valid octave.\n   *\n   * @since 2.0.0-rc.6\n   */\n  getOctave(number) {\n\n    if (this.validation) {\n      number = parseInt(number);\n    }\n\n    if (!isNaN(number) && number >= 0 && number <= 127) {\n      return Math.floor(number / 12 - 1) + this.octaveOffset;\n    } else {\n      return false;\n    }\n\n  }\n\n  /**\n   * Returns a sanitized array of valid MIDI channel numbers (1-16). The parameter should be a\n   * single integer or an array of integers.\n   *\n   * For backwards-compatibility, passing `undefined` as a parameter to this method results in all\n   * channels being returned (1-16). Otherwise, parameters that cannot successfully be parsed to\n   * integers between 1 and 16 are silently ignored.\n   *\n   * @param [channel] {number|number[]} An integer or an array of integers to parse as channel\n   * numbers.\n   *\n   * @returns {Array} An array of 0 or more valid MIDI channel numbers.\n   */\n  sanitizeChannels(channel) {\n\n    let channels;\n\n    if (this.validation) {\n\n      if (channel === \"all\") { // backwards-compatibility\n        channels = [\"all\"];\n      } else if (channel === \"none\") { // backwards-compatibility\n        return [];\n      }\n\n    }\n\n    if (!Array.isArray(channel)) {\n      channels = [channel];\n    } else {\n      channels = channel;\n    }\n\n    // In order to preserve backwards-compatibility, we let this assignment as it is.\n    if (channels.indexOf(\"all\") > -1) {\n      channels = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16];\n    }\n\n    return channels\n      .map(function(ch) {\n        return parseInt(ch);\n      })\n      .filter(function(ch) {\n        return (ch >= 1 && ch <= 16);\n      });\n\n  }\n\n  /**\n   * @private\n   * @deprecated since version 3.0. Use sanitizeChannels() instead.\n   */\n  toMIDIChannels(channel) {\n\n    if (this.validation) {\n      console.warn(\n        \"The toMIDIChannels() method has been deprecated. Use sanitizeChannels() instead.\"\n      );\n    }\n\n    return this.sanitizeChannels(channel);\n\n  }\n\n  /**\n   * Returns a valid MIDI note number (0-127) given the specified input. The parameter usually is a\n   * string containing a note name (`\"C3\"`, `\"F#4\"`, `\"D-2\"`, `\"G8\"`, etc.). If an integer between 0\n   * and 127 is passed, it will simply be returned as is (for convenience). Other strings will be\n   * parsed for integer, if possible.\n   *\n   * **Note**: since v3.x, this method returns `false` instead of throwing an error when the input\n   * is invalid.\n   *\n   * @param input {string|number} A string to extract the note number from. An integer can also be\n   * used, in this case it will simply be returned as is (if between 0 and 127).\n   *\n   * @returns {number|false} A valid MIDI note number (0-127) or `false` if the input could not\n   * successfully be parsed to a note number.\n   */\n  guessNoteNumber(input) {\n\n    let output = false;\n\n    if (Number.isInteger(input) && input >= 0 && input <= 127) {        // uint\n      output = parseInt(input);\n    } else if (parseInt(input) >= 0 && parseInt(input) <= 127) {        // float or uint as string\n      output = parseInt(input);\n    } else if (typeof input === \"string\" || input instanceof String) {  // string\n      output = this.getNoteNumberByName(input);\n    }\n\n    if (output === false) return false;\n    return output;\n\n  }\n\n  /**\n   * Converts an input value, which can be an unsigned integer (0-127), a note name, a {@link Note}\n   * object or an array of the previous types, to an array of {@link Note} objects.\n   *\n   * {@link Note} objects are returned as is. For note numbers and names, a {@link Note} object is\n   * created with the options specified. An error will be thrown when encountering invalid input.\n   *\n   * @param [notes] {number|string|Note|number[]|string[]|Note[]}\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number} [options.duration=Infinity] The number of milliseconds before the note should\n   * be explicitly stopped.\n   *\n   * @param {number} [options.attack=0.5] The note's attack velocity as a decimal number between 0\n   * and 1.\n   *\n   * @param {number} [options.release=0.5] The note's release velocity as a decimal number between 0\n   * and 1.\n   *\n   * @param {number} [options.rawAttack=64] The note's attack velocity as an integer between 0 and\n   * 127.\n   *\n   * @param {number} [options.rawRelease=64] The note's release velocity as an integer between 0 and\n   * 127.\n   *\n   * @returns {Note[]}\n   *\n   * @throws TypeError An element could not be parsed as a note.\n   */\n  getValidNoteArray(notes, options = {}) {\n\n    let result = [];\n    if (!Array.isArray(notes)) notes = [notes];\n\n    notes.forEach(note => {\n      result.push(this.getNoteObject(note, options));\n    });\n\n    return result;\n\n  }\n\n  /**\n   * Converts the `note` parameter to a valid {@link Note} object. The input usually is an unsigned\n   * integer (0-127) or a note name (`\"C4\"`, `\"G#5\"`, etc.). If the input is a {@link Note} object,\n   * it will be returned as is.\n   *\n   * If the input is a note number or name, it is possible to specify options by providing the\n   * optional `options` parameter.\n   *\n   * An error is thrown for invalid input.\n   *\n   * @param [notes] {number|string|Note}\n   *\n   * @param {Object} [options={}]\n   *\n   * @param {number} [options.duration=Infinity] The number of milliseconds before the note should\n   * be explicitly stopped.\n   *\n   * @param {number} [options.attack=0.5] The note's attack velocity as a decimal number between 0\n   * and 1.\n   *\n   * @param {number} [options.release=0.5] The note's release velocity as a decimal number between 0\n   * and 1.\n   *\n   * @param {number} [options.rawAttack=64] The note's attack velocity as an integer between 0 and\n   * 127.\n   *\n   * @param {number} [options.rawRelease=64] The note's release velocity as an integer between 0 and\n   * 127.\n   *\n   * @returns {Note}\n   *\n   * @throws TypeError The input could not be parsed as a note\n   */\n  getNoteObject(note, options) {\n\n    if (note instanceof Note) {\n      return note;\n    } else {\n      let number = this.guessNoteNumber(note);\n      if (number !== false) {\n        return new Note(number, options);\n      } else {\n        throw new TypeError(`The input could not be parsed as a note (${note})`);\n      }\n    }\n\n  }\n\n  /**\n   * Returns a valid timestamp, relative to the navigation start of the document, derived from the\n   * `time` parameter. If the parameter is a string starting with the \"+\" sign and followed by a\n   * number, the resulting timestamp will be the sum of the current timestamp plus that number. If\n   * the parameter is a positive number, it will be returned as is. Otherwise, false will be\n   * returned.\n   *\n   * @param [time] {number|string} The time string (e.g. `\"+2000\"`) or number to parse\n   * @return {number} A positive number\n   */\n  convertToTimestamp(time) {\n\n    let value = false;\n    let parsed = parseFloat(time);\n    if (isNaN(parsed)) return false;\n\n    if (typeof time === \"string\" && time.substring(0, 1) === \"+\") {\n      if (parsed >= 0) value = this.time + parsed;\n    } else {\n      if (parsed >= 0) value = parsed;\n    }\n\n    return value;\n\n  };\n\n  /**\n   *\n   * @return {Promise<void>}\n   * @private\n   */\n  async _destroyInputsAndOutputs() {\n\n    let promises = [];\n\n    this.inputs.forEach(input => promises.push(input.destroy()));\n    this.outputs.forEach(output => promises.push(output.destroy()));\n\n    return Promise.all(promises).then(() => {\n      this._inputs = [];\n      this._outputs = [];\n    });\n\n  }\n\n  /**\n   * @private\n   */\n  _onInterfaceStateChange(e) {\n\n    this._updateInputsAndOutputs();\n\n    /**\n     * Event emitted when an {@link Input} or {@link Output} becomes available. This event is\n     * typically fired whenever a MIDI device is plugged in. Please note that it may fire several\n     * times if a device possesses multiple inputs and/or outputs (which is often the case).\n     *\n     * @event WebMidi#connected\n     * @type {Object}\n     * @property {number} timestamp The moment (DOMHighResTimeStamp) when the event occurred\n     * (in milliseconds since the navigation start of the document).\n     * @property {string} type `connected`\n     * @property {Input|Output} target The {@link Input} or {@link Output} object that triggered the\n     * event.\n     */\n\n    /**\n     * Event emitted when an {@link Input} or {@link Output} becomes unavailable. This event is\n     * typically fired whenever a MIDI device is unplugged. Please note that it may fire several\n     * times if a device possesses multiple inputs and/or outputs (which is often the case).\n     *\n     * @event WebMidi#disconnected\n     * @type {Object}\n     * @property {DOMHighResTimeStamp} timestamp The moment when the event occurred (in milliseconds\n     * since the navigation start of the document).\n     * @property {string} type `disconnected`\n     * @property {Object} target Object with properties describing the {@link Input} or {@Output}\n     * that triggered the event.\n     * @property {string} target.connection `\"closed\"`\n     * @property {string} target.id ID of the input\n     * @property {string} target.manufacturer Manufacturer of the device that provided the input\n     * @property {string} target.name Name of the device that provided the input\n     * @property {string} target.state `disconnected`\n     * @property {string} target.type `input` or `output`\n     */\n    let event = {\n      timestamp: e.timeStamp,\n      type: e.port.state\n    };\n\n    if (this.interface && e.port.state === \"connected\") {\n\n      if (e.port.type === \"output\") {\n        event.port = this.getOutputById(e.port.id); // legacy\n        event.target = event.port;\n      } else if (e.port.type === \"input\") {\n        event.port = this.getInputById(e.port.id); // legacy\n        event.target = event.port;\n      }\n\n    } else {\n\n      // It feels more logical to include a `target` property instead of a `port` property. This is\n      // the terminology used everywhere in the library.\n      event.port = {\n        connection: \"closed\",\n        id: e.port.id,\n        manufacturer: e.port.manufacturer,\n        name: e.port.name,\n        state: e.port.state,\n        type: e.port.type\n      };\n\n      event.target = event.port;\n\n    }\n\n    this.emit(e.port.state, event);\n\n  };\n\n  /**\n   * @private\n   */\n  async _updateInputsAndOutputs() {\n\n    return Promise.all([\n      this._updateInputs(),\n      this._updateOutputs()\n    ]);\n\n  };\n\n  /**\n   * @private\n   */\n  async _updateInputs() {\n\n    let promises = [];\n\n    // Check for items to remove from the existing array (because they are no longer being reported\n    // by the MIDI back-end).\n    for (let i = 0; i < this._inputs.length; i++) {\n\n      let remove = true;\n\n      let updated = this.interface.inputs.values();\n\n      for (let input = updated.next(); input && !input.done; input = updated.next()) {\n        if (this._inputs[i]._midiInput === input.value) {\n          remove = false;\n          break;\n        }\n      }\n\n      if (remove) this._inputs.splice(i, 1);\n\n    }\n\n    // Check for items to add in the existing inputs array because they just appeared in the MIDI\n    // back-end inputs list. We must check for the existence of this.interface because it might\n    // have been closed via WebMidi.disable().\n    this.interface && this.interface.inputs.forEach(nInput => {\n\n      let add = true;\n\n      for (let j = 0; j < this._inputs.length; j++) {\n        if (this._inputs[j]._midiInput === nInput) {\n          add = false;\n        }\n      }\n\n      if (add) {\n        let input = new Input(nInput);\n        this._inputs.push(input);\n        promises.push(input.open());\n      }\n\n    });\n\n    return Promise.all(promises);\n\n  };\n\n  /**\n   * @private\n   */\n  async _updateOutputs() {\n\n    let promises = [];\n\n    // Check for items to remove from the existing array (because they are no longer being reported\n    // by the MIDI back-end).\n    for (let i = 0; i < this._outputs.length; i++) {\n\n      let remove = true;\n\n      let updated = this.interface.outputs.values();\n\n      for (let output = updated.next(); output && !output.done; output = updated.next()) {\n        if (this._outputs[i]._midiOutput === output.value) {\n          remove = false;\n          break;\n        }\n      }\n\n      if (remove) {\n        this._outputs[i].close();\n        this._outputs.splice(i, 1);\n      }\n\n    }\n\n    // Check for items to add in the existing inputs array because they just appeared in the MIDI\n    // back-end outputs list. We must check for the existence of this.interface because it might\n    // have been closed via WebMidi.disable().\n    this.interface && this.interface.outputs.forEach(nOutput => {\n\n      let add = true;\n\n      for (let j = 0; j < this._outputs.length; j++) {\n        if (this._outputs[j]._midiOutput === nOutput) {\n          add = false;\n        }\n      }\n\n      if (add) {\n        let output = new Output(nOutput);\n        this._outputs.push(output);\n        promises.push(output.open());\n      }\n\n    });\n\n    return Promise.all(promises);\n\n  };\n\n  // injectPluginMarkup(parent) {\n  //\n  //   // Silently ignore on Node.js\n  //   if (this.isNode) return;\n  //\n  //   // Default to <body> if no parent is specified\n  //   if (!(parent instanceof Element) && !(parent instanceof HTMLDocument)) {\n  //     parent = document.body;\n  //   }\n  //\n  //   // IE10 needs this:\n  //   // <meta http-equiv=\"X-UA-Compatible\" content=\"requiresActiveX=true\"/>\n  //\n  //   // Create markup and add to parent\n  //   const obj = document.createElement(\"object\");\n  //   obj.classid = \"CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90\"; // IE\n  //   if (!obj.isJazz) obj.type = \"audio/x-jazz\";                 // Standards-compliant\n  //   obj.style.visibility = \"hidden\";\n  //   obj.style.width = obj.style.height = \"0px\";\n  //   parent.appendChild(obj);\n  //\n  // }\n\n  /**\n   * Indicates whether access to the host's MIDI subsystem is active or not.\n   *\n   * @readonly\n   * @type {boolean}\n   */\n  get enabled() {\n    return this.interface !== null;\n  }\n\n  /**\n   * An array of all currently available MIDI inputs.\n   *\n   * @readonly\n   * @type {Array}\n   */\n  get inputs() {\n    return this._inputs;\n  }\n\n  /**\n   * Indicates whether the current environment is Node.js or not\n   * @type {boolean}\n   */\n  get isNode() {\n\n    return (Object.prototype.toString.call(\n      typeof process !== \"undefined\" ? process : 0\n    ) === \"[object process]\");\n\n  }\n\n  /**\n   * An integer to offset the octave both in inbound and outbound messages. By default, middle C\n   * (MIDI note number 60) is placed on the 4th octave (C4).\n   *\n   * If, for example, `octaveOffset` is set to 2, MIDI note number 60 will be reported as C6. If\n   * `octaveOffset` is set to -1, MIDI note number 60 will be reported as C3.\n   *\n   * @type {number}\n   *\n   * @since 2.1\n   */\n  get octaveOffset() {\n    return this._octaveOffset;\n  }\n  set octaveOffset(value) {\n\n    if (this.validation) {\n      value = parseInt(value);\n      if (isNaN(value)) throw new TypeError(\"The 'octaveOffset' property must be a valid number.\");\n    }\n\n    this._octaveOffset = value;\n\n  }\n\n  /**\n   * An array of all currently available MIDI outputs.\n   *\n   * @readonly\n   * @type {Array}\n   */\n  get outputs() {\n    return this._outputs;\n  }\n\n  /**\n   * Indicates whether the environment provides support for the Web MIDI API or not.\n   *\n   * **Note**: in environments that do not offer built-in MIDI support, this will report `true` if\n   * the `navigator.requestMIDIAccess` function is available. For example, if you have installed\n   * WebMIDIAPIShim.js but no plugin, this property will be `true` even though actual support might\n   * not be there.\n   *\n   * @readonly\n   * @type {boolean}\n   */\n  get supported() {\n    return (navigator && navigator.requestMIDIAccess) ? true : false;\n  }\n\n  /**\n   * Indicates whether MIDI system exclusive messages have been activated when WebMidi.js was\n   * enabled via the `enable()` method.\n   *\n   * @readonly\n   * @type Boolean\n   */\n  get sysexEnabled() {\n    return !!(this.interface && this.interface.sysexEnabled);\n  }\n\n  /**\n   * The elapsed time, in milliseconds, since the time\n   * [origin](https://developer.mozilla.org/en-US/docs/Web/API/DOMHighResTimeStamp#The_time_origin).\n   * Said simply, it is the number of milliseconds that passed since the page was loaded. Being a\n   * floating-point number, it has sub-millisecond accuracy. According to the\n   * [documentation](https://developer.mozilla.org/en-US/docs/Web/API/DOMHighResTimeStamp), the\n   * time should be accurate to 5 µs (microseconds). However, due to various constraints, the\n   * browser might only be accurate to one millisecond.\n   *\n   * @type {DOMHighResTimeStamp}\n   * @readonly\n   */\n  get time() {\n    return performance.now();\n  }\n\n  /**\n   * Enum of all MIDI channel voice messages and their associated numerical value:\n   *\n   * - `noteoff`: 0x8 (8)\n   * - `noteon`: 0x9 (9)\n   * - `keyaftertouch`: 0xA (10)\n   * - `controlchange`: 0xB (11)\n   * - `channelmode`: 0xB (11)\n   * - `nrpn`: 0xB (11)\n   * - `programchange`: 0xC (12)\n   * - `channelaftertouch`: 0xD (13)\n   * - `pitchbend`: 0xE (14)\n   *\n   * @enum {Object.<string, number>}\n   * @readonly\n   *\n   * @since 3.0.0\n   */\n  get MIDI_CHANNEL_VOICE_MESSAGES() {\n\n    return {\n      noteoff: 0x8,           // 8\n      noteon: 0x9,            // 9\n      keyaftertouch: 0xA,     // 10\n      controlchange: 0xB,     // 11\n      channelmode: 0xB,       // 11\n      nrpn: 0xB,              // 11\n      programchange: 0xC,     // 12\n      channelaftertouch: 0xD, // 13\n      pitchbend: 0xE          // 14\n    };\n\n  }\n\n  /**\n   * Enum of all MIDI channel voice messages and their associated numerical value. Note that it\n   * has been deprecated since v3.0. You should now use\n   * [MIDI_CHANNEL_VOICE_MESSAGES]{@link WebMidi.MIDI_CHANNEL_VOICE_MESSAGES}.\n   *\n   * @enum {Object.<string, number>}\n   * @readonly\n   * @deprecated since version 3.0 (will be dropped in version 4.0)\n   *\n   * @since 2.0.0\n   */\n  get MIDI_CHANNEL_MESSAGES() {\n    console.warn(\n      \"MIDI_CHANNEL_MESSAGES has been deprecated. Use MIDI_CHANNEL_VOICE_MESSAGES instead.\"\n    );\n    return this.MIDI_CHANNEL_VOICE_MESSAGES;\n  }\n\n  /**\n   * Enum of all channel mode messages and their associated numerical value:\n   *\n   * - `allsoundoff`: 120\n   * - `resetallcontrollers`: 121\n   * - `localcontrol`: 122\n   * - `allnotesoff`: 123\n   * - `omnimodeoff`: 124\n   * - `omnimodeon`: 125\n   * - `monomodeon`: 126\n   * - `polymodeon`: 127\n   *\n   * @enum {Object.<string, number>}\n   * @readonly\n   *\n   * @since 2.0.0\n   */\n  get MIDI_CHANNEL_MODE_MESSAGES() {\n\n    return {\n      allsoundoff: 120,\n      resetallcontrollers: 121,\n      localcontrol: 122,\n      allnotesoff: 123,\n      omnimodeoff: 124,\n      omnimodeon: 125,\n      monomodeon: 126,\n      polymodeon: 127\n    };\n\n  }\n\n  /**\n   * Enum of all control change messages and their associated numerical value:\n   *\n   * - `bankselectcoarse`: 0\n   * - `modulationwheelcoarse`: 1\n   * - `breathcontrollercoarse`: 2\n   * - `footcontrollercoarse`: 4\n   * - `portamentotimecoarse`: 5\n   * - `dataentrycoarse`: 6\n   * - `volumecoarse`: 7\n   * - `balancecoarse`: 8\n   * - `pancoarse`: 10\n   * - `expressioncoarse`: 11\n   * - `effectcontrol1coarse`: 12\n   * - `effectcontrol2coarse`: 13\n   * - `generalpurposeslider1`: 16\n   * - `generalpurposeslider2`: 17\n   * - `generalpurposeslider3`: 18\n   * - `generalpurposeslider4`: 19\n   * - `bankselectfine`: 32\n   * - `modulationwheelfine`: 33\n   * - `breathcontrollerfine`: 34\n   * - `footcontrollerfine`: 36\n   * - `portamentotimefine`: 37\n   * - `dataentryfine`: 38\n   * - `volumefine`: 39\n   * - `balancefine`: 40\n   * - `panfine`: 42\n   * - `expressionfine`: 43\n   * - `effectcontrol1fine`: 44\n   * - `effectcontrol2fine`: 45\n   * - `holdpedal`: 64\n   * - `portamento`: 65\n   * - `sustenutopedal`: 66\n   * - `softpedal`: 67\n   * - `legatopedal`: 68\n   * - `hold2pedal`: 69\n   * - `soundvariation`: 70\n   * - `resonance`: 71\n   * - `soundreleasetime`: 72\n   * - `soundattacktime`: 73\n   * - `brightness`: 74\n   * - `soundcontrol6`: 75\n   * - `soundcontrol7`: 76\n   * - `soundcontrol8`:`77\n   * - `soundcontrol9`: 78\n   * - `soundcontrol10`: 79\n   * - `generalpurposebutton1`: 80\n   * - `generalpurposebutton2`: 81\n   * - `generalpurposebutton3`: 82\n   * - `generalpurposebutton4`: 83\n   * - `reverblevel`: 91\n   * - `tremololevel`: 92\n   * - `choruslevel`: 93\n   * - `celestelevel`: 94\n   * - `phaserlevel`: 95\n   * - `databuttonincrement`: 96\n   * - `databuttondecrement`: 97\n   * - `nonregisteredparametercoarse`: 98\n   * - `nonregisteredparameterfine`: 99\n   * - `registeredparametercoarse`: 100\n   * - `registeredparameterfine`: 101\n   *\n   * @enum {Object.<string, number>}\n   * @readonly\n   *\n   * @since 2.0.0\n   */\n  get MIDI_CONTROL_CHANGE_MESSAGES() {\n\n    return {\n      bankselectcoarse: 0,\n      modulationwheelcoarse: 1,\n      breathcontrollercoarse: 2,\n      footcontrollercoarse: 4,\n      portamentotimecoarse: 5,\n      dataentrycoarse: 6,\n      volumecoarse: 7,\n      balancecoarse: 8,\n      pancoarse: 10,\n      expressioncoarse: 11,\n      effectcontrol1coarse: 12,\n      effectcontrol2coarse: 13,\n      generalpurposeslider1: 16,\n      generalpurposeslider2: 17,\n      generalpurposeslider3: 18,\n      generalpurposeslider4: 19,\n      bankselectfine: 32,\n      modulationwheelfine: 33,\n      breathcontrollerfine: 34,\n      footcontrollerfine: 36,\n      portamentotimefine: 37,\n      dataentryfine: 38,\n      volumefine: 39,\n      balancefine: 40,\n      panfine: 42,\n      expressionfine: 43,\n      effectcontrol1fine: 44,\n      effectcontrol2fine: 45,\n      holdpedal: 64,\n      portamento: 65,\n      sustenutopedal: 66,\n      softpedal: 67,\n      legatopedal: 68,\n      hold2pedal: 69,\n      soundvariation: 70,\n      resonance: 71,\n      soundreleasetime: 72,\n      soundattacktime: 73,\n      brightness: 74,\n      soundcontrol6: 75,\n      soundcontrol7: 76,\n      soundcontrol8: 77,\n      soundcontrol9: 78,\n      soundcontrol10: 79,\n      generalpurposebutton1: 80,\n      generalpurposebutton2: 81,\n      generalpurposebutton3: 82,\n      generalpurposebutton4: 83,\n      reverblevel: 91,\n      tremololevel: 92,\n      choruslevel: 93,\n      celestelevel: 94,\n      phaserlevel: 95,\n      databuttonincrement: 96,\n      databuttondecrement: 97,\n      nonregisteredparametercoarse: 98,\n      nonregisteredparameterfine: 99,\n      registeredparametercoarse: 100,\n      registeredparameterfine: 101\n    };\n\n  }\n\n  /**\n   * Array of valid events triggered at the interface level.\n   *\n   * @type {string[]}\n   * @readonly\n   */\n  get MIDI_INTERFACE_EVENTS() {\n    return [\"connected\", \"disconnected\"];\n  }\n\n  /**\n   * Enum of all control change messages that are used to create NRPN messages and their associated\n   * numerical value:\n   *\n   * - `entrymsb`: 6\n   * - `entrylsb`: 38\n   * - `increment`: 96\n   * - `decrement`: 97\n   * - `paramlsb`: 98\n   * - `parammsb`: 99\n   * - `nullactiveparameter`: 127\n   *\n   * @enum {Object.<string, number>}\n   * @readonly\n   *\n   * @since 2.0.0\n   */\n  get MIDI_NRPN_MESSAGES() {\n\n    return {\n      entrymsb: 6,\n      entrylsb: 38,\n      increment: 96,\n      decrement: 97,\n      paramlsb: 98,\n      parammsb: 99,\n      nullactiveparameter: 127\n    };\n\n  }\n\n  /**\n   * Enum of all registered parameters and their associated pair of numerical values. MIDI\n   * registered parameters extend the original list of control change messages. Currently, there are\n   * only a limited number of them:\n   *\n   * - `pitchbendrange`: [0x00, 0x00]\n   * - `channelfinetuning`: [0x00, 0x01]\n   * - `channelcoarsetuning`: [0x00, 0x02]\n   * - `tuningprogram`: [0x00, 0x03]\n   * - `tuningbank`: [0x00, 0x04]\n   * - `modulationrange`: [0x00, 0x05]\n   * - `azimuthangle`: [0x3D, 0x00]\n   * - `elevationangle`: [0x3D, 0x01]\n   * - `gain`: [0x3D, 0x02]\n   * - `distanceratio`: [0x3D, 0x03]\n   * - `maximumdistance`: [0x3D, 0x04]\n   * - `maximumdistancegain`: [0x3D, 0x05]\n   * - `referencedistanceratio`: [0x3D, 0x06]\n   * - `panspreadangle`: [0x3D, 0x07]\n   * - `rollangle`: [0x3D, 0x08]\n   *\n   * @enum {Object.<string, number>}\n   * @readonly\n   *\n   * @since 2.0.0\n   */\n  get MIDI_REGISTERED_PARAMETER() {\n\n    return {\n      pitchbendrange: [0x00, 0x00],\n      channelfinetuning: [0x00, 0x01],\n      channelcoarsetuning: [0x00, 0x02],\n      tuningprogram: [0x00, 0x03],\n      tuningbank: [0x00, 0x04],\n      modulationrange: [0x00, 0x05],\n      azimuthangle: [0x3D, 0x00],\n      elevationangle: [0x3D, 0x01],\n      gain: [0x3D, 0x02],\n      distanceratio: [0x3D, 0x03],\n      maximumdistance: [0x3D, 0x04],\n      maximumdistancegain: [0x3D, 0x05],\n      referencedistanceratio: [0x3D, 0x06],\n      panspreadangle: [0x3D, 0x07],\n      rollangle: [0x3D, 0x08]\n    };\n\n  }\n\n  /**\n   * Enum of all valid MIDI system messages and matching numerical values. WebMidi.js also uses\n   * two custom messages.\n   *\n   * **System common messages**\n   * - `sysex`: 0xF0 (240)\n   * - `timecode`: 0xF1 (241)\n   * - `songposition`: 0xF2 (242)\n   * - `songselect`: 0xF3 (243)\n   * - `tunerequest`: 0xF6 (246)\n   * - `sysexend`: 0xF7 (247)\n   *\n   * The `sysexend` message is never actually received. It simply ends a sysex stream.\n   *\n   * **System real-time messages**\n   *\n   * - `clock`: 0xF8 (248)\n   * - `start`: 0xFA (250)\n   * - `continue`: 0xFB (251)\n   * - `stop`: 0xFC (252)\n   * - `activesensing`: 0xFE (254)\n   * - `reset`: 0xFF (255)\n   *\n   * Values 249 and 253 are actually relayed by the Web MIDI API but they do not serve a specific\n   * purpose. The\n   * [MIDI 1.0 spec](https://www.midi.org/specifications/item/table-1-summary-of-midi-message)\n   * simply states that they are undefined/reserved.\n   *\n   * **Custom WebMidi.js messages**\n   *\n   * - `midimessage`: 0\n   * - `unknownsystemmessage`: -1\n   *\n   * @enum {Object.<string, number>}\n   * @readonly\n   *\n   * @since 2.0.0\n   */\n  get MIDI_SYSTEM_MESSAGES() {\n\n    return {\n\n      // System common messages\n      sysex: 0xF0,            // 240\n      timecode: 0xF1,         // 241\n      songposition: 0xF2,     // 242\n      songselect: 0xF3,       // 243\n      tunerequest: 0xF6,      // 246\n      tuningrequest: 0xF6,    // for backwards-compatibility (deprecated in version 3.0)\n      sysexend: 0xF7,         // 247 (never actually received - simply ends a sysex)\n\n      // System real-time messages\n      clock: 0xF8,            // 248\n      start: 0xFA,            // 250\n      continue: 0xFB,         // 251\n      stop: 0xFC,             // 252\n      activesensing: 0xFE,    // 254\n      reset: 0xFF,            // 255\n\n      // Custom WebMidi.js messages\n      midimessage: 0,\n      unknownsystemmessage: -1\n\n    };\n\n  }\n\n  /**\n   * Array of standard note names\n   *\n   * @type {string[]}\n   * @readonly\n   */\n  get NOTES() {\n    return [\"C\", \"C#\", \"D\", \"D#\", \"E\", \"F\", \"F#\", \"G\", \"G#\", \"A\", \"A#\", \"B\"];\n  }\n\n}\n\n// Export singleton instance of WebMidi class. The 'constructor' is nulled so that it cannot be used\n// to instantiate a new WebMidi object or extend it. However, it is not freezed so it remains\n// extensible (properties can be added at will).\nconst wm = new WebMidi();\nwm.constructor = null;\n\nexport { Note, wm as WebMidi };\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","(function(global, factory) {\r\n  if (typeof exports === 'object' && typeof module !== 'undefined') {\r\n    module.exports = factory();\r\n  }\r\n  else if (typeof define === 'function' && define.amd) {\r\n    define('JZZ', [], factory);\r\n  }\r\n  else {\r\n    if (!global) global = window;\r\n    if (global.JZZ && global.JZZ.MIDI) return;\r\n    global.JZZ = factory();\r\n  }\r\n})(this, function() {\r\n\r\n  var _scope = typeof window === 'undefined' ? global : window;\r\n  var _version = '1.1.7';\r\n  var i, j, k, m, n;\r\n\r\n  var _time = Date.now || function () { return new Date().getTime(); };\r\n  var _startTime = _time();\r\n  var _now = typeof performance != 'undefined' && performance.now ?\r\n    function() { return performance.now(); } : function() { return _time() - _startTime; };\r\n  var _schedule = function(f) {\r\n    setTimeout(f, 0);\r\n  };\r\n\r\n  // _R: common root for all async objects\r\n  function _R() {\r\n    this._orig = this;\r\n    this._ready = false;\r\n    this._queue = [];\r\n    this._log = [];\r\n  }\r\n  _R.prototype._exec = function() {\r\n    while (this._ready && this._queue.length) {\r\n      var x = this._queue.shift();\r\n      x[0].apply(this, x[1]);\r\n    }\r\n  };\r\n  _R.prototype._push = function(func, arg) { this._queue.push([func, arg]); _R.prototype._exec.apply(this); };\r\n  _R.prototype._slip = function(func, arg) { this._queue.unshift([func, arg]); };\r\n  _R.prototype._pause = function() { this._ready = false; };\r\n  _R.prototype._resume = function() { this._ready = true; _R.prototype._exec.apply(this); };\r\n  _R.prototype._break = function(err) { this._orig._bad = true; this._orig._log.push(err || 'Unknown JZZ error'); };\r\n  _R.prototype._repair = function() { this._orig._bad = false; };\r\n  _R.prototype._crash = function(err) { this._break(err); this._resume(); };\r\n  _R.prototype._err = function() { return this._log[this._log.length - 1]; };\r\n  _R.prototype.log = function() { return _clone(this._log); };\r\n  _R.prototype._image = function() {\r\n    var F = function() {}; F.prototype = this._orig;\r\n    var ret = new F();\r\n    ret._ready = false;\r\n    ret._queue = [];\r\n    return ret;\r\n  };\r\n  _R.prototype._thenable = function() {\r\n    var self = this;\r\n    var F = function() {}; F.prototype = self;\r\n    var ret = new F();\r\n    ret.then = function(good, bad) { self._push(_then, [good, bad]); return this; };      \r\n    return ret;\r\n  };\r\n  function _then(good, bad) {\r\n    if (this._bad) {\r\n      if (bad instanceof Function) bad.apply(this, [new Error(this._err())]);\r\n    }\r\n    else {\r\n      if (good instanceof Function) good.apply(this, [this]);\r\n    }\r\n  }\r\n  function _wait(obj, delay) {\r\n    if (this._bad) obj._crash(this._err());\r\n    else setTimeout(function() { obj._resume(); }, delay);\r\n  }\r\n  _R.prototype.wait = function(delay) {\r\n    if (!delay) return this;\r\n    var ret = this._image();\r\n    this._push(_wait, [ret, delay]);\r\n    return ret._thenable();\r\n  };\r\n  function _kick(obj) { if (this._bad) obj._break(this._err()); obj._resume(); }\r\n  function _rechain(self, obj, name) {\r\n    self[name] = function() {\r\n      var arg = arguments;\r\n      var ret = obj._image();\r\n      this._push(_kick, [ret]);\r\n      return ret[name].apply(ret, arg);\r\n    };\r\n  }\r\n  function _and(q) {\r\n    if (!this._bad) {\r\n      if (q instanceof Function) q.apply(this); else console.log(q);\r\n    }\r\n  }\r\n  _R.prototype.and = function(func) { this._push(_and, [func]); return this._thenable(); };\r\n  function _or(q) {\r\n    if (this._bad) {\r\n      if (q instanceof Function) q.apply(this); else console.log(q);\r\n    }\r\n  }\r\n  _R.prototype.or = function(func) { this._push(_or, [func]); return this._thenable(); };\r\n\r\n  _R.prototype._info = {};\r\n  _R.prototype.info = function() {\r\n    var info = _clone(this._orig._info);\r\n    if (typeof info.engine == 'undefined') info.engine = 'none';\r\n    if (typeof info.sysex == 'undefined') info.sysex = true;\r\n    return info;\r\n  };\r\n  _R.prototype.name = function() { return this.info().name; };\r\n\r\n  function _close(obj) {\r\n    if (this._bad) obj._crash(this._err());\r\n    else {\r\n      this._break('Closed');\r\n      obj._resume();\r\n    }\r\n  }\r\n  _R.prototype.close = function() {\r\n    var ret = new _R();\r\n    if (this._close) this._push(this._close, []);\r\n    this._push(_close, [ret]);\r\n    return ret._thenable();\r\n  };\r\n\r\n  function _tryAny(arr) {\r\n    if (!arr.length) {\r\n      this._break();\r\n      return;\r\n    }\r\n    var func = arr.shift();\r\n    if (arr.length) {\r\n      var self = this;\r\n      this._slip(_or, [ function() { _tryAny.apply(self, [arr]); } ]);\r\n    }\r\n    try {\r\n      this._repair();\r\n      func.apply(this);\r\n    }\r\n    catch (err) {\r\n      this._break(err.toString());\r\n    }\r\n  }\r\n\r\n  function _push(arr, obj) {\r\n    for (var i = 0; i < arr.length; i++) if (arr[i] === obj) return;\r\n    arr.push(obj);\r\n  }\r\n  function _pop(arr, obj) {\r\n    for (var i = 0; i < arr.length; i++) if (arr[i] === obj) {\r\n      arr.splice(i, 1);\r\n      return;\r\n    }\r\n  }\r\n\r\n  // _J: JZZ object\r\n  function _J() {\r\n    _R.apply(this);\r\n  }\r\n  _J.prototype = new _R();\r\n\r\n  function _clone(obj, key, val) {\r\n    if (typeof key == 'undefined') return _clone(obj, [], []);\r\n    if (obj instanceof Object) {\r\n      for (var i = 0; i < key.length; i++) if (key[i] === obj) return val[i];\r\n      var ret;\r\n      if (obj instanceof Array) ret = []; else ret = {};\r\n      key.push(obj); val.push(ret);\r\n      for(var k in obj) if (obj.hasOwnProperty(k)) ret[k] = _clone(obj[k], key, val);\r\n      return ret;\r\n    }\r\n    return obj;\r\n  }\r\n  _J.prototype._info = { name: 'JZZ.js', ver: _version, version: _version, inputs: [], outputs: [] };\r\n\r\n  var _outs = [];\r\n  var _ins = [];\r\n  var _outsW = [];\r\n  var _insW = [];\r\n\r\n  function _postRefresh() {\r\n    _jzz._info.engine = _engine._type;\r\n    _jzz._info.version = _engine._version;\r\n    _jzz._info.sysex = _engine._sysex;\r\n    _jzz._info.inputs = [];\r\n    _jzz._info.outputs = [];\r\n    _outs = [];\r\n    _ins = [];\r\n    _engine._allOuts = {};\r\n    _engine._allIns = {};\r\n    var i, x;\r\n    for (i = 0; i < _engine._outs.length; i++) {\r\n      x = _engine._outs[i];\r\n      x.engine = _engine;\r\n      _engine._allOuts[x.name] = x;\r\n      _jzz._info.outputs.push({\r\n        id: x.name,\r\n        name: x.name,\r\n        manufacturer: x.manufacturer,\r\n        version: x.version,\r\n        engine: _engine._type\r\n      });\r\n      _outs.push(x);\r\n    }\r\n    for (i = 0; i < _virtual._outs.length; i++) {\r\n      x = _virtual._outs[i];\r\n      _jzz._info.outputs.push({\r\n        id: x.name,\r\n        name: x.name,\r\n        manufacturer: x.manufacturer,\r\n        version: x.version,\r\n        engine: x.type\r\n      });\r\n      _outs.push(x);\r\n    }\r\n    for (i = 0; i < _engine._ins.length; i++) {\r\n      x = _engine._ins[i];\r\n      x.engine = _engine;\r\n      _engine._allIns[x.name] = x;\r\n      _jzz._info.inputs.push({\r\n        id: x.name,\r\n        name: x.name,\r\n        manufacturer: x.manufacturer,\r\n        version: x.version,\r\n        engine: _engine._type\r\n      });\r\n      _ins.push(x);\r\n    }\r\n    for (i = 0; i < _virtual._ins.length; i++) {\r\n      x = _virtual._ins[i];\r\n      _jzz._info.inputs.push({\r\n        id: x.name,\r\n        name: x.name,\r\n        manufacturer: x.manufacturer,\r\n        version: x.version,\r\n        engine: x.type\r\n      });\r\n      _ins.push(x);\r\n    }\r\n    if (_jzz._watcher && _jzz._watcher._handles.length) {\r\n      var diff = _diff(_insW, _outsW, _jzz._info.inputs, _jzz._info.outputs);\r\n       if (diff) {\r\n        for (j = 0; j < diff.inputs.removed.length; j++) {\r\n          x = _engine._inMap[diff.inputs.removed[j].name];\r\n          if (x) x._closeAll();\r\n        }\r\n        for (j = 0; j < diff.outputs.removed.length; j++) {\r\n          x = _engine._outMap[diff.outputs.removed[j].name];\r\n          if (x) x._closeAll();\r\n        }\r\n        _fireW(diff);\r\n      }\r\n    }\r\n    _insW = _jzz._info.inputs;\r\n    _outsW = _jzz._info.outputs;\r\n  }\r\n  function _refresh() {\r\n    if (!this._bad) _engine._refresh(this);\r\n  }\r\n  _J.prototype.refresh = function() {\r\n    this._push(_refresh, []);\r\n    return this._thenable();\r\n  };\r\n\r\n  function _filterList(q, arr) {\r\n    var i, n;\r\n    if (q instanceof Function) q = q(arr);\r\n    if (!(q instanceof Array)) q = [q];\r\n    var before = [];\r\n    var after = [];\r\n    var etc = arr.slice();\r\n    var a = before;\r\n    for (i = 0; i < q.length; i++) {\r\n      if (typeof q[i] == 'undefined') a = after;\r\n      else if (q[i] instanceof RegExp) for (n = 0; n < etc.length; n++) {\r\n        if (q[i].test(etc[n].name)) {\r\n          a.push(etc[n]);\r\n          etc.splice(n, 1);\r\n          n--;\r\n        }\r\n      }\r\n      else {\r\n        for (n = 0; n < etc.length; n++) if (q[i] + '' === n + '' || q[i] === etc[n].name || (q[i] instanceof Object && q[i].name === etc[n].name)) {\r\n          a.push(etc[n]);\r\n          etc.splice(n, 1);\r\n          n--;\r\n        }\r\n      }\r\n    }\r\n    return a == before ? before : before.concat(etc).concat(after);\r\n  }\r\n\r\n  function _notFound(port, q) {\r\n    var msg;\r\n    if (q instanceof RegExp) msg = 'Port matching ' + q + ' not found';\r\n    else if (q instanceof Object || typeof q == 'undefined') msg = 'Port not found';\r\n    else msg = 'Port \"' + q + '\" not found';\r\n    port._crash(msg);\r\n  }\r\n  function _openMidiOut(port, arg) {\r\n    if (this._bad) port._crash(this._err());\r\n    else {\r\n      var arr = _filterList(arg, _outs);\r\n      if (!arr.length) { _notFound(port, arg); return; }\r\n      var pack = function(x) { return function() { x.engine._openOut(this, x.name); }; };\r\n      for (var i = 0; i < arr.length; i++) arr[i] = pack(arr[i]);\r\n      port._slip(_tryAny, [arr]);\r\n      port._resume();\r\n    }\r\n  }\r\n  _J.prototype.openMidiOut = function(arg) {\r\n    var port = new _M();\r\n    this._push(_refresh, []);\r\n    this._push(_openMidiOut, [port, arg]);\r\n    return port._thenable();\r\n  };\r\n  _J.prototype._openMidiOutNR = function(arg) {\r\n    var port = new _M();\r\n    this._push(_openMidiOut, [port, arg]);\r\n    return port._thenable();\r\n  };\r\n\r\n  function _openMidiIn(port, arg) {\r\n    if (this._bad) port._crash(this._err());\r\n    else {\r\n      var arr = _filterList(arg, _ins);\r\n      if (!arr.length) { _notFound(port, arg); return; }\r\n      var pack = function(x) { return function() { x.engine._openIn(this, x.name); }; };\r\n      for (var i = 0; i < arr.length; i++) arr[i] = pack(arr[i]);\r\n      port._slip(_tryAny, [arr]);\r\n      port._resume();\r\n    }\r\n  }\r\n  _J.prototype.openMidiIn = function(arg) {\r\n    var port = new _M();\r\n    this._push(_refresh, []);\r\n    this._push(_openMidiIn, [port, arg]);\r\n    return port._thenable();\r\n  };\r\n  _J.prototype._openMidiInNR = function(arg) {\r\n    var port = new _M();\r\n    this._push(_openMidiIn, [port, arg]);\r\n    return port._thenable();\r\n  };\r\n\r\n  function _onChange(watcher, arg) {\r\n    if (this._bad) watcher._crash();\r\n    else {\r\n      watcher._slip(_connectW, [arg]);\r\n      watcher._resume();\r\n    }\r\n  }\r\n  _J.prototype.onChange = function(arg) {\r\n    if (!this._orig._watcher) this._orig._watcher = new _W();\r\n    var watcher = this._orig._watcher._image();\r\n    this._push(_onChange, [watcher, arg]);\r\n    return watcher._thenable();\r\n  };\r\n\r\n  _J.prototype._close = function() {\r\n    _engine._close();\r\n  };\r\n\r\n  // _M: MIDI-In/Out object\r\n  function _M() {\r\n    _R.apply(this);\r\n    this._handles = [];\r\n    this._outs = [];\r\n  }\r\n  _M.prototype = new _R();\r\n  _M.prototype._filter = function(msg) {\r\n    if (this._orig._mpe) {\r\n      var out;\r\n      var outs = 0;\r\n      if (this._handles && this._handles.length) {\r\n        outs = this._handles.length;\r\n        out = this._handles[0];\r\n      }\r\n      if (this._outs && this._outs.length) {\r\n        outs = this._outs.length;\r\n        out = this._outs[0];\r\n      }\r\n      if (outs == 1 && !out._mpe) {\r\n        msg = this._orig._mpe.filter(msg);\r\n      }\r\n    }\r\n    return msg;\r\n  };\r\n  _M.prototype._receive = function(msg) { this._emit(this._filter(msg)); };\r\n  function _receive(msg) { if (!this._bad) this._receive(msg); }\r\n  _M.prototype.send = function() {\r\n    this._push(_receive, [MIDI.apply(null, arguments)]);\r\n    return this._thenable();\r\n  };\r\n  _M.prototype.note = function(c, n, v, t) {\r\n    this.noteOn(c, n, v);\r\n    if (t > 0) this.wait(t).noteOff(c, n);\r\n    return this._thenable();\r\n  };\r\n  _M.prototype._emit = function(msg) {\r\n    var i;\r\n    for (i = 0; i < this._handles.length; i++) this._handles[i].apply(this, [MIDI(msg)._stamp(this)]);\r\n    for (i = 0; i < this._outs.length; i++) {\r\n      var m = MIDI(msg);\r\n      if (!m._stamped(this._outs[i])) this._outs[i].send(m._stamp(this));\r\n    }\r\n  };\r\n  function _emit(msg) { this._emit(msg); }\r\n  _M.prototype.emit = function(msg) {\r\n    this._push(_emit, [msg]);\r\n    return this._thenable();\r\n  };\r\n  function _connect(arg) {\r\n    if (arg instanceof Function) _push(this._orig._handles, arg);\r\n    else _push(this._orig._outs, arg);\r\n  }\r\n  function _disconnect(arg) {\r\n    if (typeof arg == 'undefined') {\r\n      this._orig._handles = [];\r\n      this._orig._outs = [];\r\n    }\r\n    else if (arg instanceof Function) _pop(this._orig._handles, arg);\r\n    else _pop(this._orig._outs, arg);\r\n  }\r\n  _M.prototype.connect = function(arg) {\r\n    this._push(_connect, [arg]);\r\n    return this._thenable();\r\n  };\r\n  _M.prototype.disconnect = function(arg) {\r\n    this._push(_disconnect, [arg]);\r\n    return this._thenable();\r\n  };\r\n  _M.prototype.connected = function() {\r\n    return this._orig._handles.length + this._orig._outs.length;\r\n  };\r\n  _M.prototype.ch = function(n) {\r\n    if (typeof n == 'undefined') return this;\r\n    _validateChannel(n);\r\n    var chan = new _C(this, n);\r\n    this._push(_kick, [chan]);\r\n    return chan._thenable();\r\n  };\r\n  function _mpe(m, n) {\r\n    if (!this._orig._mpe) this._orig._mpe = new MPE();\r\n    this._orig._mpe.setup(m, n);\r\n  }\r\n  _M.prototype.mpe = function(m, n) {\r\n    if (typeof m == 'undefined' && typeof n == 'undefined') return this;\r\n    MPE.validate(m, n);\r\n    var chan = n ? new _E(this, m, n) : new _C(this, m);\r\n    this._push(_mpe, [m, n]);\r\n    this._push(_kick, [chan]);\r\n    return chan._thenable();\r\n  };\r\n  function _validateChannel(c) {\r\n    if (c != parseInt(c) || c < 0 || c > 15)\r\n      throw RangeError('Bad channel value (must not be less than 0 or more than 15): ' + c);\r\n  }\r\n\r\n  // _C: MIDI Channel object\r\n  function _C(port, chan) {\r\n    _M.apply(this);\r\n    this._port = port._orig;\r\n    this._chan = chan;\r\n    _rechain(this, this._port, 'ch');\r\n    _rechain(this, this._port, 'mpe');\r\n    _rechain(this, this._port, 'connect');\r\n    _rechain(this, this._port, 'disconnect');\r\n    _rechain(this, this._port, 'close');\r\n  }\r\n  _C.prototype = new _M();\r\n  _C.prototype.channel = function() { return this._chan; };\r\n  _C.prototype._receive = function(msg) { this._port._receive(msg); };\r\n  _C.prototype.note = function(n, v, t) {\r\n    this.noteOn(n, v);\r\n    if (t) this.wait(t).noteOff(n);\r\n    return this._thenable();\r\n  };\r\n\r\n  // _E: MPE Channel object\r\n  function _E(port, m, n) {\r\n    _M.apply(this);\r\n    this._port = port._orig;\r\n    this._master = m;\r\n    this._band = n;\r\n    _rechain(this, this._port, 'ch');\r\n    _rechain(this, this._port, 'mpe');\r\n    _rechain(this, this._port, 'connect');\r\n    _rechain(this, this._port, 'disconnect');\r\n    _rechain(this, this._port, 'close');\r\n  }\r\n  _E.prototype = new _M();\r\n  _E.prototype.channel = function() { return this._master; };\r\n  _E.prototype._receive = function(msg) { this._port._receive(msg); };\r\n  _E.prototype.note = function(n, v, t) {\r\n    this.noteOn(n, v);\r\n    if (t) this.wait(t).noteOff(n);\r\n    return this._thenable();\r\n  };\r\n\r\n  // _W: Watcher object ~ MIDIAccess.onstatechange\r\n  function _W() {\r\n    _R.apply(this);\r\n    this._handles = [];\r\n    _rechain(this, _jzz, 'refresh');\r\n    _rechain(this, _jzz, 'openMidiOut');\r\n    _rechain(this, _jzz, 'openMidiIn');\r\n    _rechain(this, _jzz, 'onChange');\r\n    _rechain(this, _jzz, 'close');\r\n  }\r\n  _W.prototype = new _R();\r\n  function _connectW(arg) {\r\n    if (arg instanceof Function) {\r\n      if (!this._orig._handles.length) _engine._watch();\r\n      _push(this._orig._handles, arg);\r\n    }\r\n  }\r\n  function _disconnectW(arg) {\r\n    if (typeof arg == 'undefined') this._orig._handles = [];\r\n    else _pop(this._orig._handles, arg);\r\n    if (!this._orig._handles.length) _engine._unwatch();\r\n  }\r\n  _W.prototype.connect = function(arg) {\r\n    this._push(_connectW, [arg]);\r\n    return this._thenable();\r\n  };\r\n  _W.prototype.disconnect = function(arg) {\r\n    this._push(_disconnectW, [arg]);\r\n    return this._thenable();\r\n  };\r\n  function _changed(x0, y0, x1, y1) {\r\n    var i;\r\n    if (x0.length != x1.length || y0.length != y1.length) return true;\r\n    for (i = 0; i < x0.length; i++) if (x0[i].name != x1[i].name) return true;\r\n    for (i = 0; i < y0.length; i++) if (y0[i].name != y1[i].name) return true;\r\n    return false;\r\n  }\r\n  function _diff(x0, y0, x1, y1) {\r\n    if (!_changed(x0, y0, x1, y1)) return;\r\n    var ax = []; // added\r\n    var ay = [];\r\n    var rx = []; // removed\r\n    var ry = [];\r\n    var i;\r\n    var h = {};\r\n    for (i = 0; i < x0.length; i++) h[x0[i].name] = true;\r\n    for (i = 0; i < x1.length; i++) if (!h[x1[i].name]) ax.push(x1[i]);\r\n    h = {};\r\n    for (i = 0; i < x1.length; i++) h[x1[i].name] = true;\r\n    for (i = 0; i < x0.length; i++) if (!h[x0[i].name]) rx.push(x0[i]);\r\n    h = {};\r\n    for (i = 0; i < y0.length; i++) h[y0[i].name] = true;\r\n    for (i = 0; i < y1.length; i++) if (!h[y1[i].name]) ay.push(y1[i]);\r\n    h = {};\r\n    for (i = 0; i < y1.length; i++) h[y1[i].name] = true;\r\n    for (i = 0; i < y0.length; i++) if (!h[y0[i].name]) ry.push(y0[i]);\r\n    return { inputs: { added: ax, removed: rx }, outputs: { added: ay, removed: ry } };\r\n  }\r\n  function _fireW(arg) {\r\n    for (i = 0; i < _jzz._watcher._handles.length; i++) _jzz._watcher._handles[i].apply(_jzz, [arg]);\r\n  }\r\n\r\n  var _jzz;\r\n  var _engine = { _outs: [], _ins: [] };\r\n  var _virtual = { _outs: [], _ins: [] };\r\n\r\n  // Node.js\r\n  function _tryNODE() {\r\n    if (typeof module != 'undefined' && module.exports) {\r\n      _initNode(require('jazz-midi'));\r\n      return;\r\n    }\r\n    this._break();\r\n  }\r\n  // Jazz-Plugin\r\n  function _tryJazzPlugin() {\r\n    var div = document.createElement('div');\r\n    div.style.visibility = 'hidden';\r\n    document.body.appendChild(div);\r\n    var obj = document.createElement('object');\r\n    obj.style.visibility = 'hidden';\r\n    obj.style.width = '0px'; obj.style.height = '0px';\r\n    obj.classid = 'CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90';\r\n    obj.type = 'audio/x-jazz';\r\n    document.body.appendChild(obj);\r\n    if (obj.isJazz) {\r\n      _initJazzPlugin(obj);\r\n      return;\r\n    }\r\n    this._break();\r\n  }\r\n\r\n  // Web MIDI API\r\n  var _navigator;\r\n  var _requestMIDIAccess;\r\n  if (typeof navigator !== 'undefined' && navigator.requestMIDIAccess) {\r\n    _navigator = navigator;\r\n    _requestMIDIAccess = navigator.requestMIDIAccess;\r\n    try {\r\n      if (_requestMIDIAccess.toString().indexOf('JZZ(') != -1) _requestMIDIAccess = undefined;\r\n    }\r\n    catch (err) {}\r\n  }\r\n  function _tryWebMIDI() {\r\n    if (_requestMIDIAccess) {\r\n      var self = this;\r\n      var onGood = function(midi) {\r\n        _initWebMIDI(midi);\r\n        self._resume();\r\n      };\r\n      var onBad = function(msg) {\r\n        self._crash(msg);\r\n      };\r\n      var opt = {};\r\n      _requestMIDIAccess.call(_navigator, opt).then(onGood, onBad);\r\n      this._pause();\r\n      return;\r\n    }\r\n    this._break();\r\n  }\r\n  function _tryWebMIDIsysex() {\r\n    if (_requestMIDIAccess) {\r\n      var self = this;\r\n      var onGood = function(midi) {\r\n        _initWebMIDI(midi, true);\r\n        self._resume();\r\n      };\r\n      var onBad = function(msg) {\r\n        self._crash(msg);\r\n      };\r\n      var opt = {sysex:true};\r\n      _requestMIDIAccess.call(_navigator, opt).then(onGood, onBad);\r\n      this._pause();\r\n      return;\r\n    }\r\n    this._break();\r\n  }\r\n  // Web-extension\r\n  function _tryCRX() {\r\n    var self = this;\r\n    var inst;\r\n    var msg;\r\n    function eventHandle() {\r\n      inst = true;\r\n      if (!msg) msg = document.getElementById('jazz-midi-msg');\r\n      if (!msg) return;\r\n      var a = [];\r\n      try { a = JSON.parse(msg.innerText); } catch (err) {}\r\n      msg.innerText = '';\r\n      document.removeEventListener('jazz-midi-msg', eventHandle);\r\n      if (a[0] === 'version') {\r\n        _initCRX(msg, a[2]);\r\n        self._resume();\r\n      }\r\n      else {\r\n        self._crash();\r\n      }\r\n    }\r\n    this._pause();\r\n    document.addEventListener('jazz-midi-msg', eventHandle);\r\n    try { document.dispatchEvent(new Event('jazz-midi')); } catch (err) {}\r\n    _schedule(function() { if (!inst) self._crash(); });\r\n  }\r\n\r\n  function _zeroBreak() {\r\n    this._pause();\r\n    var self = this;\r\n    _schedule(function() { self._crash(); });\r\n  }\r\n\r\n  function _filterEngines(opt) {\r\n    var ret = [];\r\n    var arr = _filterEngineNames(opt);\r\n    for (var i = 0; i < arr.length; i++) {\r\n      if (arr[i] == 'webmidi') {\r\n        if (opt && opt.sysex === true) ret.push(_tryWebMIDIsysex);\r\n        if (!opt || opt.sysex !== true || opt.degrade === true) ret.push(_tryWebMIDI);\r\n      }\r\n      else if (arr[i] == 'node') { ret.push(_tryNODE); ret.push(_zeroBreak); }\r\n      else if (arr[i] == 'extension') ret.push(_tryCRX);\r\n      else if (arr[i] == 'plugin') ret.push(_tryJazzPlugin);\r\n    }\r\n    ret.push(_initNONE);\r\n    return ret;\r\n  }\r\n\r\n  function _filterEngineNames(opt) {\r\n    var web = ['node', 'extension', 'plugin', 'webmidi'];\r\n    if (!opt || !opt.engine) return web;\r\n    var arr = opt.engine instanceof Array ? opt.engine : [opt.engine];\r\n    var dup = {};\r\n    var none;\r\n    var etc;\r\n    var head = [];\r\n    var tail = [];\r\n    var i;\r\n    for (i = 0; i < arr.length; i++) {\r\n      var name = arr[i].toString().toLowerCase();\r\n      if (dup[name]) continue;\r\n      dup[name] = true;\r\n      if (name === 'none') none = true;\r\n      if (name === 'etc' || typeof name == 'undefined') etc = true;\r\n      if (etc) tail.push(name); else head.push(name);\r\n      _pop(web, name);\r\n    }\r\n    if (etc || head.length || tail.length) none = false;\r\n    return none ? [] : head.concat(etc ? web : tail);\r\n  }\r\n\r\n  function _initJZZ(opt) {\r\n    _initAudioContext();\r\n    _jzz = new _J();\r\n    _jzz._options = opt;\r\n    _jzz._push(_tryAny, [_filterEngines(opt)]);\r\n    _jzz.refresh();\r\n    _jzz._resume();\r\n  }\r\n\r\n  function _initNONE() {\r\n    _engine._type = 'none';\r\n    _engine._version = _version;\r\n    _engine._sysex = true;\r\n    _engine._outs = [];\r\n    _engine._ins = [];\r\n    _engine._refresh = function() { _postRefresh(); };\r\n    _engine._watch = function() {};\r\n    _engine._unwatch = function() {};\r\n    _engine._close = function() {};\r\n  }\r\n  // common initialization for Jazz-Plugin and jazz-midi\r\n  function _initEngineJP() {\r\n    _engine._inArr = [];\r\n    _engine._outArr = [];\r\n    _engine._inMap = {};\r\n    _engine._outMap = {};\r\n    _engine._outsW = [];\r\n    _engine._insW = [];\r\n    _engine._version = _engine._main.version;\r\n    _engine._sysex = true;\r\n    var watcher;\r\n    function _closeAll() {\r\n      for (var i = 0; i < this.clients.length; i++) this._close(this.clients[i]);\r\n    }\r\n    _engine._refresh = function() {\r\n      _engine._outs = [];\r\n      _engine._ins = [];\r\n      var i, x;\r\n      for (i = 0; (x = _engine._main.MidiOutInfo(i)).length; i++) {\r\n        _engine._outs.push({ type: _engine._type, name: x[0], manufacturer: x[1], version: x[2] });\r\n      }\r\n      for (i = 0; (x = _engine._main.MidiInInfo(i)).length; i++) {\r\n        _engine._ins.push({ type: _engine._type, name: x[0], manufacturer: x[1], version: x[2] });\r\n      }\r\n      _postRefresh();\r\n    };\r\n    _engine._openOut = function(port, name) {\r\n      var impl = _engine._outMap[name];\r\n      if (!impl) {\r\n        if (_engine._pool.length <= _engine._outArr.length) _engine._pool.push(_engine._newPlugin());\r\n        impl = {\r\n          name: name,\r\n          clients: [],\r\n          info: {\r\n            name: name,\r\n            manufacturer: _engine._allOuts[name].manufacturer,\r\n            version: _engine._allOuts[name].version,\r\n            type: 'MIDI-out',\r\n            sysex: _engine._sysex,\r\n            engine: _engine._type\r\n          },\r\n          _close: function(port) { _engine._closeOut(port); },\r\n          _closeAll: _closeAll,\r\n          _receive: function(a) { if (a.length) this.plugin.MidiOutRaw(a.slice()); }\r\n        };\r\n        var plugin = _engine._pool[_engine._outArr.length];\r\n        impl.plugin = plugin;\r\n        _engine._outArr.push(impl);\r\n        _engine._outMap[name] = impl;\r\n      }\r\n      if (!impl.open) {\r\n        var s = impl.plugin.MidiOutOpen(name);\r\n        if (s !== name) {\r\n          if (s) impl.plugin.MidiOutClose();\r\n          port._break(); return;\r\n        }\r\n        impl.open = true;\r\n      }\r\n      port._orig._impl = impl;\r\n      _push(impl.clients, port._orig);\r\n      port._info = impl.info;\r\n      port._receive = function(arg) { impl._receive(arg); };\r\n      port._close = function() { impl._close(this); };\r\n    };\r\n    _engine._openIn = function(port, name) {\r\n      var impl = _engine._inMap[name];\r\n      if (!impl) {\r\n        if (_engine._pool.length <= _engine._inArr.length) _engine._pool.push(_engine._newPlugin());\r\n        impl = {\r\n          name: name,\r\n          clients: [],\r\n          info: {\r\n            name: name,\r\n            manufacturer: _engine._allIns[name].manufacturer,\r\n            version: _engine._allIns[name].version,\r\n            type: 'MIDI-in',\r\n            sysex: _engine._sysex,\r\n            engine: _engine._type\r\n          },\r\n          _close: function(port) { _engine._closeIn(port); },\r\n          _closeAll: _closeAll,\r\n          handle: function(t, a) {\r\n            for (var i = 0; i < this.clients.length; i++) {\r\n              var msg = MIDI(a);\r\n              this.clients[i]._emit(msg);\r\n            }\r\n          }\r\n        };\r\n        var makeHandle = function(x) { return function(t, a) { x.handle(t, a); }; };\r\n        impl.onmidi = makeHandle(impl);\r\n        var plugin = _engine._pool[_engine._inArr.length];\r\n        impl.plugin = plugin;\r\n        _engine._inArr.push(impl);\r\n        _engine._inMap[name] = impl;\r\n      }\r\n      if (!impl.open) {\r\n        var s = impl.plugin.MidiInOpen(name, impl.onmidi);\r\n        if (s !== name) {\r\n          if (s) impl.plugin.MidiInClose();\r\n          port._break(); return;\r\n        }\r\n        impl.open = true;\r\n      }\r\n      port._orig._impl = impl;\r\n      _push(impl.clients, port._orig);\r\n      port._info = impl.info;\r\n      port._close = function() { impl._close(this); };\r\n    };\r\n    _engine._closeOut = function(port) {\r\n      var impl = port._impl;\r\n      _pop(impl.clients, port._orig);\r\n      if (!impl.clients.length && impl.open) {\r\n        impl.open = false;\r\n        impl.plugin.MidiOutClose();\r\n      }\r\n    };\r\n    _engine._closeIn = function(port) {\r\n      var impl = port._impl;\r\n      _pop(impl.clients, port._orig);\r\n      if (!impl.clients.length && impl.open) {\r\n        impl.open = false;\r\n        impl.plugin.MidiInClose();\r\n      }\r\n    };\r\n    _engine._close = function() {\r\n      for (var i = 0; i < _engine._inArr.length; i++) if (_engine._inArr[i].open) _engine._inArr[i].plugin.MidiInClose();\r\n      _engine._unwatch();\r\n    };\r\n    _engine._watch = function() {\r\n      if (!watcher) watcher = setInterval(function() { _engine._refresh(); }, 250);\r\n    };\r\n    _engine._unwatch = function() {\r\n      if (watcher) clearInterval(watcher);\r\n      watcher = undefined;\r\n    };\r\n  }\r\n\r\n  function _initNode(obj) {\r\n    _engine._type = 'node';\r\n    _engine._main = obj;\r\n    _engine._pool = [];\r\n    _engine._newPlugin = function() { return new obj.MIDI(); };\r\n    _initEngineJP();\r\n  }\r\n  function _initJazzPlugin(obj) {\r\n    _engine._type = 'plugin';\r\n    _engine._main = obj;\r\n    _engine._pool = [obj];\r\n    _engine._newPlugin = function() {\r\n      var plg = document.createElement('object');\r\n      plg.style.visibility = 'hidden';\r\n      plg.style.width = '0px'; obj.style.height = '0px';\r\n      plg.classid = 'CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90';\r\n      plg.type = 'audio/x-jazz';\r\n      document.body.appendChild(plg);\r\n      return plg.isJazz ? plg : undefined;\r\n    };\r\n    _initEngineJP();\r\n  }\r\n  function _initWebMIDI(access, sysex) {\r\n    _engine._type = 'webmidi';\r\n    _engine._version = 43;\r\n    _engine._sysex = !!sysex;\r\n    _engine._access = access;\r\n    _engine._inMap = {};\r\n    _engine._outMap = {};\r\n    _engine._outsW = [];\r\n    _engine._insW = [];\r\n    var watcher;\r\n    function _closeAll() {\r\n      for (var i = 0; i < this.clients.length; i++) this._close(this.clients[i]);\r\n    }\r\n    _engine._refresh = function() {\r\n      _engine._outs = [];\r\n      _engine._ins = [];\r\n      _engine._access.outputs.forEach(function(port) {\r\n        _engine._outs.push({type: _engine._type, name: port.name, manufacturer: port.manufacturer, version: port.version});\r\n      });\r\n      _engine._access.inputs.forEach(function(port) {\r\n        _engine._ins.push({type: _engine._type, name: port.name, manufacturer: port.manufacturer, version: port.version});\r\n      });\r\n      _postRefresh();\r\n    };\r\n    _engine._openOut = function(port, name) {\r\n      var impl = _engine._outMap[name];\r\n      if (!impl) {\r\n        impl = {\r\n          name: name,\r\n          clients: [],\r\n          info: {\r\n            name: name,\r\n            manufacturer: _engine._allOuts[name].manufacturer,\r\n            version: _engine._allOuts[name].version,\r\n            type: 'MIDI-out',\r\n            sysex: _engine._sysex,\r\n            engine: _engine._type\r\n          },\r\n          _close: function(port) { _engine._closeOut(port); },\r\n          _closeAll: _closeAll,\r\n          _receive: function(a) { if (impl.dev && a.length) this.dev.send(a.slice()); }\r\n        };\r\n      }\r\n      var found;\r\n      _engine._access.outputs.forEach(function(dev) {\r\n        if (dev.name === name) found = dev;\r\n      });\r\n      if (found) {\r\n        impl.dev = found;\r\n        _engine._outMap[name] = impl;\r\n        port._orig._impl = impl;\r\n        _push(impl.clients, port._orig);\r\n        port._info = impl.info;\r\n        port._receive = function(arg) { impl._receive(arg); };\r\n        port._close = function() { impl._close(this); };\r\n        if (impl.dev.open) {\r\n          port._pause();\r\n          impl.dev.open().then(function() {\r\n            port._resume();\r\n          }, function() {\r\n            port._crash();\r\n          });\r\n        }\r\n      }\r\n      else port._break();\r\n    };\r\n    _engine._openIn = function(port, name) {\r\n      var impl = _engine._inMap[name];\r\n      if (!impl) {\r\n        impl = {\r\n          name: name,\r\n          clients: [],\r\n          info: {\r\n            name: name,\r\n            manufacturer: _engine._allIns[name].manufacturer,\r\n            version: _engine._allIns[name].version,\r\n            type: 'MIDI-in',\r\n            sysex: _engine._sysex,\r\n            engine: _engine._type\r\n          },\r\n          _close: function(port) { _engine._closeIn(port); },\r\n          _closeAll: _closeAll,\r\n          handle: function(evt) {\r\n            for (var i = 0; i < this.clients.length; i++) {\r\n              var msg = MIDI([].slice.call(evt.data));\r\n              this.clients[i]._emit(msg);\r\n            }\r\n          }\r\n        };\r\n      }\r\n      var found;\r\n      _engine._access.inputs.forEach(function(dev) {\r\n        if (dev.name === name) found = dev;\r\n      });\r\n      if (found) {\r\n        impl.dev = found;\r\n        var makeHandle = function(x) { return function(evt) { x.handle(evt); }; };\r\n        impl.dev.onmidimessage = makeHandle(impl);\r\n        _engine._inMap[name] = impl;\r\n        port._orig._impl = impl;\r\n        _push(impl.clients, port._orig);\r\n        port._info = impl.info;\r\n        port._close = function() { impl._close(this); };\r\n        if (impl.dev.open) {\r\n          port._pause();\r\n          impl.dev.open().then(function() {\r\n            port._resume();\r\n          }, function() {\r\n            port._crash();\r\n          });\r\n        }\r\n      }\r\n      else port._break();\r\n    };\r\n    _engine._closeOut = function(port) {\r\n      var impl = port._impl;\r\n      _pop(impl.clients, port._orig);\r\n      if (!impl.clients.length) {\r\n        if (impl.dev && impl.dev.close) impl.dev.close();\r\n        impl.dev = undefined;\r\n      }\r\n    };\r\n    _engine._closeIn = function(port) {\r\n      var impl = port._impl;\r\n      _pop(impl.clients, port._orig);\r\n      if (!impl.clients.length) {\r\n        if (impl.dev) {\r\n          impl.dev.onmidimessage = null;\r\n          if (impl.dev.close) impl.dev.close();\r\n        }\r\n        impl.dev = undefined;\r\n      }\r\n    };\r\n    _engine._close = function() {\r\n      _engine._unwatch();\r\n    };\r\n    _engine._watch = function() {\r\n      _engine._access.onstatechange = function() {\r\n        watcher = true;\r\n        _schedule(function() {\r\n          if (watcher) {\r\n            _engine._refresh();\r\n            watcher = false;\r\n          }\r\n        });\r\n      };\r\n    };\r\n    _engine._unwatch = function() {\r\n      _engine._access.onstatechange = undefined;\r\n    };\r\n  }\r\n  function _initCRX(msg, ver) {\r\n    _engine._type = 'extension';\r\n    _engine._version = ver;\r\n    _engine._sysex = true;\r\n    _engine._pool = [];\r\n    _engine._outs = [];\r\n    _engine._ins = [];\r\n    _engine._inArr = [];\r\n    _engine._outArr = [];\r\n    _engine._inMap = {};\r\n    _engine._outMap = {};\r\n    _engine._outsW = [];\r\n    _engine._insW = [];\r\n    _engine.refreshClients = [];\r\n    _engine._msg = msg;\r\n    _engine._newPlugin = function() {\r\n      var plugin = { id: _engine._pool.length };\r\n      _engine._pool.push(plugin);\r\n      if (!plugin.id) plugin.ready = true;\r\n      else document.dispatchEvent(new CustomEvent('jazz-midi', { detail: ['new'] }));\r\n    };\r\n    _engine._newPlugin();\r\n    _engine._refresh = function(client) {\r\n      _engine.refreshClients.push(client);\r\n      client._pause();\r\n      _schedule(function() {\r\n        document.dispatchEvent(new CustomEvent('jazz-midi', { detail: ['refresh'] }));\r\n      });\r\n    };\r\n    function _closeAll() {\r\n      for (var i = 0; i < this.clients.length; i++) this._close(this.clients[i]);\r\n    }\r\n    _engine._openOut = function(port, name) {\r\n      var impl = _engine._outMap[name];\r\n      if (!impl) {\r\n        if (_engine._pool.length <= _engine._outArr.length) _engine._newPlugin();\r\n        var plugin = _engine._pool[_engine._outArr.length];\r\n        impl = {\r\n          name: name,\r\n          clients: [],\r\n          info: {\r\n            name: name,\r\n            manufacturer: _engine._allOuts[name].manufacturer,\r\n            version: _engine._allOuts[name].version,\r\n            type: 'MIDI-out',\r\n            sysex: _engine._sysex,\r\n            engine: _engine._type\r\n          },\r\n          _start: function() { document.dispatchEvent(new CustomEvent('jazz-midi', { detail: ['openout', plugin.id, name] })); },\r\n          _close: function(port) { _engine._closeOut(port); },\r\n          _closeAll: _closeAll,\r\n          _receive: function(a) { if (a.length) { var v = a.slice(); v.splice(0, 0, 'play', plugin.id); document.dispatchEvent(new CustomEvent('jazz-midi', {detail: v})); } }\r\n        };\r\n        impl.plugin = plugin;\r\n        plugin.output = impl;\r\n        _engine._outArr.push(impl);\r\n        _engine._outMap[name] = impl;\r\n      }\r\n      port._orig._impl = impl;\r\n      _push(impl.clients, port._orig);\r\n      port._info = impl.info;\r\n      port._receive = function(arg) { impl._receive(arg); };\r\n      port._close = function() { impl._close(this); };\r\n      if (!impl.open) {\r\n        port._pause();\r\n        if (impl.plugin.ready) impl._start();\r\n      }\r\n    };\r\n    _engine._openIn = function(port, name) {\r\n      var impl = _engine._inMap[name];\r\n      if (!impl) {\r\n        if (_engine._pool.length <= _engine._inArr.length) _engine._newPlugin();\r\n        var plugin = _engine._pool[_engine._inArr.length];\r\n        impl = {\r\n          name: name,\r\n          clients: [],\r\n          info: {\r\n            name: name,\r\n            manufacturer: _engine._allIns[name].manufacturer,\r\n            version: _engine._allIns[name].version,\r\n            type: 'MIDI-in',\r\n            sysex: _engine._sysex,\r\n            engine: _engine._type\r\n          },\r\n          _start: function() { document.dispatchEvent(new CustomEvent('jazz-midi', { detail: ['openin', plugin.id, name] })); },\r\n          _close: function(port) { _engine._closeIn(port); },\r\n          _closeAll: _closeAll\r\n        };\r\n        impl.plugin = plugin;\r\n        plugin.input = impl;\r\n        _engine._inArr.push(impl);\r\n        _engine._inMap[name] = impl;\r\n      }\r\n      port._orig._impl = impl;\r\n      _push(impl.clients, port._orig);\r\n      port._info = impl.info;\r\n      port._close = function() { impl._close(this); };\r\n      if (!impl.open) {\r\n        port._pause();\r\n        if (impl.plugin.ready) impl._start();\r\n      }\r\n    };\r\n    _engine._closeOut = function(port) {\r\n      var impl = port._impl;\r\n      _pop(impl.clients, port._orig);\r\n      if (!impl.clients.length && impl.open) {\r\n        impl.open = false;\r\n        document.dispatchEvent(new CustomEvent('jazz-midi', { detail: ['closeout', impl.plugin.id] }));\r\n      }\r\n    };\r\n    _engine._closeIn = function(port) {\r\n      var impl = port._impl;\r\n      _pop(impl.clients, port._orig);\r\n      if (!impl.clients.length && impl.open) {\r\n        impl.open = false;\r\n        document.dispatchEvent(new CustomEvent('jazz-midi', { detail: ['closein', impl.plugin.id] }));\r\n      }\r\n    };\r\n    _engine._close = function() {\r\n      _engine._unwatch();\r\n    };\r\n    var watcher;\r\n    _engine._watch = function() {\r\n      _engine._insW = _engine._ins;\r\n      _engine._outsW = _engine._outs;\r\n      watcher = setInterval(function() {\r\n        document.dispatchEvent(new CustomEvent('jazz-midi', {detail:['refresh']}));\r\n      }, 250);\r\n    };\r\n    _engine._unwatch = function() {\r\n      clearInterval(watcher);\r\n      watcher = undefined;\r\n    };\r\n    document.addEventListener('jazz-midi-msg', function() {\r\n      var v = _engine._msg.innerText.split('\\n');\r\n      var impl, i, j;\r\n      _engine._msg.innerText = '';\r\n      for (i = 0; i < v.length; i++) {\r\n        var a = [];\r\n        try { a = JSON.parse(v[i]); } catch (err) {}\r\n        if (!a.length) continue;\r\n        if (a[0] === 'refresh') {\r\n          if (a[1].ins) {\r\n            for (j = 0; j < a[1].ins.length; j++) a[1].ins[j].type = _engine._type;\r\n            _engine._ins = a[1].ins;\r\n          }\r\n          if (a[1].outs) {\r\n            for (j = 0; j < a[1].outs.length; j++) a[1].outs[j].type = _engine._type;\r\n            _engine._outs = a[1].outs;\r\n          }\r\n          _postRefresh();\r\n          for (j = 0; j < _engine.refreshClients.length; j++) _engine.refreshClients[j]._resume();\r\n          _engine.refreshClients = [];\r\n        }\r\n        else if (a[0] === 'version') {\r\n          var plugin = _engine._pool[a[1]];\r\n          if (plugin) {\r\n            plugin.ready = true;\r\n            if (plugin.input) plugin.input._start();\r\n            if (plugin.output) plugin.output._start();\r\n          }\r\n        }\r\n        else if (a[0] === 'openout') {\r\n          impl = _engine._pool[a[1]].output;\r\n          if (impl) {\r\n            if (a[2] == impl.name) {\r\n              impl.open = true;\r\n              if (impl.clients) for (j = 0; j < impl.clients.length; j++) impl.clients[j]._resume();\r\n            }\r\n            else if (impl.clients) for (j = 0; j < impl.clients.length; j++) impl.clients[j]._crash();\r\n          }\r\n        }\r\n        else if (a[0] === 'openin') {\r\n          impl = _engine._pool[a[1]].input;\r\n          if (impl) {\r\n            if (a[2] == impl.name) {\r\n              impl.open = true;\r\n              if (impl.clients) for (j = 0; j < impl.clients.length; j++) impl.clients[j]._resume();\r\n            }\r\n            else if (impl.clients) for (j = 0; j < impl.clients.length; j++) impl.clients[j]._crash();\r\n          }\r\n        }\r\n        else if (a[0] === 'midi') {\r\n          impl = _engine._pool[a[1]].input;\r\n          if (impl && impl.clients) {\r\n            for (j = 0; j < impl.clients.length; j++) {\r\n              var msg = MIDI(a.slice(3));\r\n              impl.clients[j]._emit(msg);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  var JZZ = function(opt) {\r\n    if (!_jzz) _initJZZ(opt);\r\n    return _jzz._thenable();\r\n  };\r\n  JZZ.JZZ = JZZ;\r\n  JZZ.version = _version;\r\n  JZZ.info = function() { return _J.prototype.info(); };\r\n  JZZ.Widget = function(arg) {\r\n    var obj = new _M();\r\n    if (arg instanceof Object) for (var k in arg) if (arg.hasOwnProperty(k)) obj[k] = arg[k];\r\n    obj._resume();\r\n    return obj;\r\n  };\r\n  _J.prototype.Widget = JZZ.Widget;\r\n  JZZ.addMidiIn = function(name, widget) {\r\n    var info = _clone(widget._info || {});\r\n    info.name = name;\r\n    info.type = info.type || 'javascript';\r\n    info.manufacturer = info.manufacturer || 'virtual';\r\n    info.version = info.version || '0.0';\r\n    var engine = {\r\n      _info: function() { return info; },\r\n      _openIn: function(port) {\r\n        port._pause();\r\n        port._info = _clone(info);\r\n        port._close = function() { widget.disconnect(port); };\r\n        widget.connect(port);\r\n        port._resume();\r\n      }\r\n    };\r\n    return JZZ.lib.registerMidiIn(name, engine);\r\n  };\r\n  JZZ.addMidiOut = function(name, widget) {\r\n    var info = _clone(widget._info || {});\r\n    info.name = name;\r\n    info.type = info.type || 'javascript';\r\n    info.manufacturer = info.manufacturer || 'virtual';\r\n    info.version = info.version || '0.0';\r\n    var engine = {\r\n      _info: function() { return info; },\r\n      _openOut: function(port) {\r\n        port._pause();\r\n        port._info = _clone(info);\r\n        port._close = function() { port.disconnect(); };\r\n        _connect.apply(port, [widget]);\r\n        port._resume();\r\n      }\r\n    };\r\n    return JZZ.lib.registerMidiOut(name, engine);\r\n  };\r\n\r\n  // JZZ.SMPTE\r\n\r\n  function SMPTE() {\r\n    var self = this instanceof SMPTE ? this : self = new SMPTE();\r\n    SMPTE.prototype.reset.apply(self, arguments);\r\n    return self;\r\n  }\r\n  SMPTE.prototype.reset = function(arg) {\r\n    if (arg instanceof SMPTE) {\r\n      this.setType(arg.getType());\r\n      this.setHour(arg.getHour());\r\n      this.setMinute(arg.getMinute());\r\n      this.setSecond(arg.getSecond());\r\n      this.setFrame(arg.getFrame());\r\n      this.setQuarter(arg.getQuarter());\r\n      return this;\r\n    }\r\n    var arr = arg instanceof Array ? arg : arguments;\r\n    this.setType(arr[0]);\r\n    this.setHour(arr[1]);\r\n    this.setMinute(arr[2]);\r\n    this.setSecond(arr[3]);\r\n    this.setFrame(arr[4]);\r\n    this.setQuarter(arr[5]);\r\n    return this;\r\n  };\r\n  function _fixDropFrame() { if (this.type == 29.97 && !this.second && this.frame < 2 && this.minute % 10) this.frame = 2; }\r\n  SMPTE.prototype.isFullFrame = function() { return this.quarter == 0 || this.quarter == 4; };\r\n  SMPTE.prototype.getType = function() { return this.type; };\r\n  SMPTE.prototype.getHour = function() { return this.hour; };\r\n  SMPTE.prototype.getMinute = function() { return this.minute; };\r\n  SMPTE.prototype.getSecond = function() { return this.second; };\r\n  SMPTE.prototype.getFrame = function() { return this.frame; };\r\n  SMPTE.prototype.getQuarter = function() { return this.quarter; };\r\n  SMPTE.prototype.setType = function(x) {\r\n    if (typeof x == 'undefined' || x == 24) this.type = 24;\r\n    else if (x == 25) this.type = 25;\r\n    else if (x == 29.97) { this.type = 29.97; _fixDropFrame.apply(this); }\r\n    else if (x == 30) this.type = 30;\r\n    else throw RangeError('Bad SMPTE frame rate: ' + x);\r\n    if (this.frame >= this.type) this.frame = this.type - 1; // could not be more than 29\r\n    return this;\r\n  };\r\n  SMPTE.prototype.setHour = function(x) {\r\n    if (typeof x == 'undefined') x = 0;\r\n    if (x != parseInt(x) || x < 0 || x >= 24) throw RangeError('Bad SMPTE hours value: ' + x);\r\n    this.hour = x;\r\n    return this;\r\n  };\r\n  SMPTE.prototype.setMinute = function(x) {\r\n    if (typeof x == 'undefined') x = 0;\r\n    if (x != parseInt(x) || x < 0 || x >= 60) throw RangeError('Bad SMPTE minutes value: ' + x);\r\n    this.minute = x;\r\n    _fixDropFrame.apply(this);\r\n    return this;\r\n  };\r\n  SMPTE.prototype.setSecond = function(x) {\r\n    if (typeof x == 'undefined') x = 0;\r\n    if (x != parseInt(x) || x < 0 || x >= 60) throw RangeError('Bad SMPTE seconds value: ' + x);\r\n    this.second = x;\r\n    _fixDropFrame.apply(this);\r\n    return this;\r\n  };\r\n  SMPTE.prototype.setFrame = function(x) {\r\n    if (typeof x == 'undefined') x = 0;\r\n    if (x != parseInt(x) || x < 0 || x >= this.type) throw RangeError('Bad SMPTE frame number: ' + x);\r\n    this.frame = x;\r\n    _fixDropFrame.apply(this);\r\n    return this;\r\n  };\r\n  SMPTE.prototype.setQuarter = function(x) {\r\n    if (typeof x == 'undefined') x = 0;\r\n    if (x != parseInt(x) || x < 0 || x >= 8) throw RangeError('Bad SMPTE quarter frame: ' + x);\r\n    this.quarter = x;\r\n    return this;\r\n  };\r\n  SMPTE.prototype.incrFrame = function() {\r\n    this.frame++;\r\n    if (this.frame >= this.type) {\r\n      this.frame = 0;\r\n      this.second++;\r\n      if (this.second >= 60) {\r\n        this.second = 0;\r\n        this.minute++;\r\n        if (this.minute >= 60) {\r\n          this.minute = 0;\r\n          this.hour = this.hour >= 23 ? 0 : this.hour + 1;\r\n        }\r\n      }\r\n    }\r\n    _fixDropFrame.apply(this);\r\n    return this;\r\n  };\r\n  SMPTE.prototype.decrFrame = function() {\r\n    if (!this.second && this.frame == 2 && this.type == 29.97 && this.minute % 10) this.frame = 0; // drop-frame\r\n    this.frame--;\r\n    if (this.frame < 0) {\r\n      this.frame = this.type == 29.97 ? 29 : this.type - 1;\r\n      this.second--;\r\n      if (this.second < 0) {\r\n        this.second = 59;\r\n        this.minute--;\r\n        if (this.minute < 0) {\r\n          this.minute = 59;\r\n          this.hour = this.hour ? this.hour - 1 : 23;\r\n        }\r\n      }\r\n    }\r\n    return this;\r\n  };\r\n  SMPTE.prototype.incrQF = function() {\r\n    this.backwards = false;\r\n    this.quarter = (this.quarter + 1) & 7;\r\n    if (this.quarter == 0 || this.quarter == 4) this.incrFrame();\r\n    return this;\r\n  };\r\n  SMPTE.prototype.decrQF = function() {\r\n    this.backwards = true;\r\n    this.quarter = (this.quarter + 7) & 7;\r\n    if (this.quarter == 3 || this.quarter == 7) this.decrFrame();\r\n    return this;\r\n  };\r\n  function _825(a) { return [[24, 25, 29.97, 30][(a[7] >> 1) & 3], ((a[7] & 1) << 4) | a[6], (a[5] << 4) | a[4], (a[3] << 4) | a[2], (a[1] << 4) | a[0]]; }\r\n  SMPTE.prototype.read = function(m) {\r\n    if (!(m instanceof MIDI)) m = MIDI.apply(null, arguments);\r\n    if (m[0] == 0xf0 && m[1] == 0x7f && m[3] == 1 && m[4] == 1 && m[9] == 0xf7) {\r\n      this.type = [24, 25, 29.97, 30][(m[5] >> 5) & 3];\r\n      this.hour = m[5] & 31;\r\n      this.minute = m[6];\r\n      this.second = m[7];\r\n      this.frame = m[8];\r\n      this.quarter = 0;\r\n      this._ = undefined;\r\n      this._b = undefined;\r\n      this._f = undefined;\r\n      return true;\r\n    }\r\n    if (m[0] == 0xf1 && typeof m[1] != 'undefined') {\r\n      var q = m[1] >> 4;\r\n      var n = m[1] & 15;\r\n      if (q == 0) {\r\n        if (this._ == 7) {\r\n          if (this._f == 7) {\r\n            this.reset(_825(this._a));\r\n            this.incrFrame();\r\n          }\r\n          this.incrFrame();\r\n        }\r\n      }\r\n      else if (q == 3) {\r\n        if (this._ == 4) {\r\n          this.decrFrame();\r\n        }\r\n      }\r\n      else if (q == 4) {\r\n        if (this._ == 3) {\r\n          this.incrFrame();\r\n        }\r\n      }\r\n      else if (q == 7) {\r\n        if (this._ === 0) {\r\n          if (this._b === 0) {\r\n            this.reset(_825(this._a));\r\n            this.decrFrame();\r\n          }\r\n          this.decrFrame();\r\n        }\r\n      }\r\n      if (!this._a) this._a = [];\r\n      this._a[q] = n;\r\n      this._f = this._f === q - 1 || q == 0 ? q : undefined;\r\n      this._b = this._b === q + 1 || q == 7 ? q : undefined;\r\n      this._ = q;\r\n      this.quarter = q;\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n  function _mtc(t) {\r\n    if (!t.backwards && t.quarter >= 4) t.decrFrame(); // continue encoding previous frame\r\n    else if (t.backwards && t.quarter < 4) t.incrFrame();\r\n    var ret;\r\n    switch (t.quarter >> 1) {\r\n      case 0: ret = t.frame; break;\r\n      case 1: ret = t.second; break;\r\n      case 2: ret = t.minute; break;\r\n      default: ret = t.hour;\r\n    }\r\n    if (t.quarter & 1) ret >>= 4;\r\n    else ret &= 15;\r\n    if (t.quarter == 7) {\r\n      if (t.type == 25) ret |= 2;\r\n      else if (t.type == 29.97) ret |= 4;\r\n      else if (t.type == 30) ret |= 6;\r\n    }\r\n    // restore original t\r\n    if (!t.backwards && t.quarter >= 4) t.incrFrame();\r\n    else if (t.backwards && t.quarter < 4) t.decrFrame();\r\n    return ret | (t.quarter << 4);\r\n  }\r\n  function _hrtype(t) {\r\n    if (t.type == 25) return t.hour | 0x20;\r\n    if (t.type == 29.97) return t.hour | 0x40;\r\n    if (t.type == 30) return t.hour | 0x60;\r\n    return t.hour;\r\n  }\r\n  function _dec(x) { return x < 10 ? '0' + x : x; }\r\n  function _smptetxt(x) {\r\n    var arr = [];\r\n    for (var i = 0; i < x.length; i++) arr[i] = _dec(x[i]);\r\n    return arr.join(':');\r\n  }\r\n  SMPTE.prototype.toString = function() { return _smptetxt([this.hour, this.minute, this.second, this.frame]); };\r\n  JZZ.SMPTE = SMPTE;\r\n\r\n  // JZZ.MIDI\r\n\r\n  function MIDI(arg) {\r\n    var self = this instanceof MIDI ? this : self = new MIDI();\r\n    var i;\r\n    if (arg instanceof MIDI) {\r\n      self._from = arg._from.slice();\r\n      for (i in arg) if (arg.hasOwnProperty(i) && i != '_from') self[i] = arg[i];\r\n      return self;\r\n    }\r\n    else self._from = [];\r\n    if (typeof arg == 'undefined') return self;\r\n    var arr = arg instanceof Array ? arg : arguments;\r\n    for (i = 0; i < arr.length; i++) {\r\n      n = arr[i];\r\n      if (i == 1) {\r\n        if (self[0] >= 0x80 && self[0] <= 0xAF) n = MIDI.noteValue(n);\r\n        if (self[0] >= 0xC0 && self[0] <= 0xCF) n = MIDI.programValue(n);\r\n      }\r\n      if (n != parseInt(n) || n < 0 || n > 255) _throw(arr[i]);\r\n      self.push(n);\r\n    }\r\n    return self;\r\n  }\r\n  MIDI.prototype = [];\r\n  MIDI.prototype.constructor = MIDI;\r\n  var _noteNum = {};\r\n  MIDI.noteValue = function(x) { return typeof x == 'undefined' ? undefined : _noteNum[x.toString().toLowerCase()]; };\r\n  MIDI.programValue = function(x) { return x; };\r\n  MIDI.freq = function(n, a) {\r\n    if (typeof a == 'undefined') a = 440.0;\r\n    return (a * Math.pow(2, (_7b(MIDI.noteValue(n), n) - 69.0) / 12.0));\r\n  };\r\n  MIDI.shift = function(f, f0) {\r\n    if (typeof f0 == 'undefined') f0 = 440;\r\n    return Math.log2(f / f0) * 12;\r\n  };\r\n  MIDI.to14b = function(x) { return x <= 0 ? 0 : x >= 1 ? 0x3fff : Math.floor(x * 0x4000); };\r\n\r\n  var _noteMap = { c:0, d:2, e:4, f:5, g:7, a:9, b:11, h:11 };\r\n  for (k in _noteMap) {\r\n    if (!_noteMap.hasOwnProperty(k)) continue;\r\n    for (n = 0; n < 12; n++) {\r\n      m = _noteMap[k] + n * 12;\r\n      if (m > 127) break;\r\n      _noteNum[k+n] = m;\r\n      if (m > 0) { _noteNum[k + 'b' + n] = m - 1; _noteNum[k + 'bb' + n] = m - 2; }\r\n      if (m < 127) { _noteNum[k + '#' + n] = m + 1; _noteNum[k + '##' + n] = m + 2; }\r\n    }\r\n  }\r\n  for (n = 0; n < 128; n++) _noteNum[n] = n;\r\n  function _throw(x) { throw RangeError('Bad MIDI value: ' + x); }\r\n  function _ch(c) { _validateChannel(c); return parseInt(c); }\r\n  function _7b(n, m) { if (n != parseInt(n) || n < 0 || n > 0x7f) _throw(typeof m == 'undefined' ? n : m); return parseInt(n); }\r\n  function _8b(n, m) { if (n != parseInt(n) || n < 0 || n > 0xff) _throw(typeof m == 'undefined' ? n : m); return parseInt(n); }\r\n  function _lsb(n) { if (n != parseInt(n) || n < 0 || n > 0x3fff) _throw(n); return parseInt(n) & 0x7f; }\r\n  function _msb(n) { if (n != parseInt(n) || n < 0 || n > 0x3fff) _throw(n); return parseInt(n) >> 7; }\r\n  function _8bs(s) { s = '' + s; for (var i = 0; i < s.length; i++) if (s.charCodeAt(i) > 255) _throw(s[i]); return s; }\r\n  var _helperCH = {\r\n    noteOff: function(c, n, v) { if (typeof v == 'undefined') v = 64; return [0x80 + _ch(c), _7b(MIDI.noteValue(n), n), _7b(v)]; },\r\n    noteOn: function(c, n, v) { if (typeof v == 'undefined') v = 127; return [0x90 + _ch(c), _7b(MIDI.noteValue(n), n), _7b(v)]; },\r\n    aftertouch: function(c, n, v) { return [0xA0 + _ch(c), _7b(MIDI.noteValue(n), n), _7b(v)]; },\r\n    control: function(c, n, v) { return [0xB0 + _ch(c), _7b(n), _7b(v)]; },\r\n    program: function(c, n) { return [0xC0 + _ch(c), _7b(MIDI.programValue(n), n)]; },\r\n    pressure: function(c, n) { return [0xD0 + _ch(c), _7b(n)]; },\r\n    pitchBend: function(c, n, l) { return typeof l == 'undefined' ? [0xE0 + _ch(c), _lsb(n), _msb(n)] : [0xE0 + _ch(c), _7b(l), _7b(n)]; },\r\n    pitchBendF: function(c, x) { return _helperCH.pitchBend(c, MIDI.to14b((x + 1) / 2)); },\r\n    bankMSB: function(c, n) { return [0xB0 + _ch(c), 0x00, _7b(n)]; },\r\n    bankLSB: function(c, n) { return [0xB0 + _ch(c), 0x20, _7b(n)]; },\r\n    modMSB: function(c, n) { return [0xB0 + _ch(c), 0x01, _7b(n)]; },\r\n    modLSB: function(c, n) { return [0xB0 + _ch(c), 0x21, _7b(n)]; },\r\n    breathMSB: function(c, n) { return [0xB0 + _ch(c), 0x02, _7b(n)]; },\r\n    breathLSB: function(c, n) { return [0xB0 + _ch(c), 0x22, _7b(n)]; },\r\n    footMSB: function(c, n) { return [0xB0 + _ch(c), 0x04, _7b(n)]; },\r\n    footLSB: function(c, n) { return [0xB0 + _ch(c), 0x24, _7b(n)]; },\r\n    portamentoMSB: function(c, n) { return [0xB0 + _ch(c), 0x05, _7b(n)]; },\r\n    portamentoLSB: function(c, n) { return [0xB0 + _ch(c), 0x25, _7b(n)]; },\r\n    dataMSB: function(c, n) { return [0xB0 + _ch(c), 0x06, _7b(n)]; },\r\n    dataLSB: function(c, n) { return [0xB0 + _ch(c), 0x26, _7b(n)]; },\r\n    volumeMSB: function(c, n) { return [0xB0 + _ch(c), 0x07, _7b(n)]; },\r\n    volumeLSB: function(c, n) { return [0xB0 + _ch(c), 0x27, _7b(n)]; },\r\n    balanceMSB: function(c, n) { return [0xB0 + _ch(c), 0x08, _7b(n)]; },\r\n    balanceLSB: function(c, n) { return [0xB0 + _ch(c), 0x28, _7b(n)]; },\r\n    panMSB: function(c, n) { return [0xB0 + _ch(c), 0x0A, _7b(n)]; },\r\n    panLSB: function(c, n) { return [0xB0 + _ch(c), 0x2A, _7b(n)]; },\r\n    expressionMSB: function(c, n) { return [0xB0 + _ch(c), 0x0B, _7b(n)]; },\r\n    expressionLSB: function(c, n) { return [0xB0 + _ch(c), 0x2B, _7b(n)]; },\r\n    damper: function(c, b) { return [0xB0 + _ch(c), 0x40, b ? 127 : 0]; },\r\n    portamento: function(c, b) { return [0xB0 + _ch(c), 0x41, b ? 127 : 0]; },\r\n    sostenuto: function(c, b) { return [0xB0 + _ch(c), 0x42, b ? 127 : 0]; },\r\n    soft: function(c, b) { return [0xB0 + _ch(c), 0x43, b ? 127 : 0]; },\r\n    dataIncr: function(c) { return [0xB0 + _ch(c), 0x60, 0]; },\r\n    dataDecr: function(c) { return [0xB0 + _ch(c), 0x61, 0]; },\r\n    nrpnLSB: function(c, n) { return [0xB0 + _ch(c), 0x62, _7b(n)]; },\r\n    nrpnMSB: function(c, n) { return [0xB0 + _ch(c), 0x63, _7b(n)]; },\r\n    rpnLSB: function(c, n) { return [0xB0 + _ch(c), 0x64, _7b(n)]; },\r\n    rpnMSB: function(c, n) { return [0xB0 + _ch(c), 0x65, _7b(n)]; },\r\n    allSoundOff: function(c) { return [0xB0 + _ch(c), 0x78, 0]; },\r\n    allNotesOff: function(c) { return [0xB0 + _ch(c), 0x7b, 0]; },\r\n  };\r\n  var _helperNC = { // no channel\r\n    mtc: function(t) { return [0xF1, _mtc(t)]; },\r\n    songPosition: function(n, l) { return typeof l == 'undefined' ? [0xF2, _lsb(n), _msb(n)] : [0xF2, _7b(l), _7b(n)]; },\r\n    songSelect: function(n) { return [0xF3, _7b(n)]; },\r\n    tune: function() { return [0xF6]; },\r\n    clock: function() { return [0xF8]; },\r\n    start: function() { return [0xFA]; },\r\n    continue: function() { return [0xFB]; },\r\n    stop: function() { return [0xFC]; },\r\n    active: function() { return [0xFE]; },\r\n    sxIdRequest: function() { return [0xF0, 0x7E, 0x7F, 0x06, 0x01, 0xF7]; },\r\n    sxFullFrame: function(t) { return [0xF0, 0x7F, 0x7F, 0x01, 0x01, _hrtype(t), t.getMinute(), t.getSecond(), t.getFrame(), 0xF7]; },\r\n    sxMasterVolume: function(x) { x = MIDI.to14b(x); return [0xF0, 0x7F, 0x7F, 0x04, 0x01, _lsb(x), _msb(x), 0xF7]; },\r\n    sxMasterFineTuning: function(x) { x = MIDI.to14b((x % 1 + 1) / 2); return [0xF0, 0x7F, 0x7F, 0x04, 0x03, _lsb(x), _msb(x), 0xF7]; },\r\n    sxMasterCoarseTuning: function(x) { return [0xF0, 0x7F, 0x7F, 0x04, 0x04, 0x00, 0x40 + x - x % 1, 0xF7]; },\r\n    reset: function() { return [0xFF]; },\r\n  };\r\n  var _helperG = { // compound messages\r\n    bank: function(c, m, l) { return typeof l == 'undefined' ?\r\n      [_helperCH.bankMSB(c, _msb(m)), _helperCH.bankLSB(c, _lsb(m))] : [_helperCH.bankMSB(c, m), _helperCH.bankLSB(c, l)]; },\r\n    modF: function(c, x) { return _helperG.mod(c, MIDI.to14b(x)); },\r\n    mod: function(c, m, l) { return typeof l == 'undefined' ?\r\n      [_helperCH.modMSB(c, _msb(m)), _helperCH.modLSB(c, _lsb(m))] : [_helperCH.modMSB(c, m), _helperCH.modLSB(c, l)]; },\r\n    breathF: function(c, x) { return _helperG.breath(c, MIDI.to14b(x)); },\r\n    breath: function(c, m, l) { return typeof l == 'undefined' ?\r\n      [_helperCH.breathMSB(c, _msb(m)), _helperCH.breathLSB(c, _lsb(m))] : [_helperCH.breathMSB(c, m), _helperCH.breathLSB(c, l)]; },\r\n    footF: function(c, x) { return _helperG.foot(c, MIDI.to14b(x)); },\r\n    foot: function(c, m, l) { return typeof l == 'undefined' ?\r\n      [_helperCH.footMSB(c, _msb(m)), _helperCH.footLSB(c, _lsb(m))] : [_helperCH.footMSB(c, m), _helperCH.footLSB(c, l)]; },\r\n    portamentoTimeF: function(c, x) { return _helperG.portamentoTime(c, MIDI.to14b(x)); },\r\n    portamentoTime: function(c, m, l) { return typeof l == 'undefined' ?\r\n      [_helperCH.portamentoMSB(c, _msb(m)), _helperCH.portamentoLSB(c, _lsb(m))] : [_helperCH.portamentoMSB(c, m), _helperCH.portamentoLSB(c, l)]; },\r\n    dataF: function(c, x) { return _helperG.data(c, MIDI.to14b(x)); },\r\n    data: function(c, m, l) { return typeof l == 'undefined' ?\r\n      [_helperCH.dataMSB(c, _msb(m)), _helperCH.dataLSB(c, _lsb(m))] : [_helperCH.dataMSB(c, m), _helperCH.dataLSB(c, l)]; },\r\n    volumeF: function(c, x) { return _helperG.volume(c, MIDI.to14b(x)); },\r\n    volume: function(c, m, l) { return typeof l == 'undefined' ?\r\n      [_helperCH.volumeMSB(c, _msb(m)), _helperCH.volumeLSB(c, _lsb(m))] : [_helperCH.volumeMSB(c, m), _helperCH.volumeLSB(c, l)]; },\r\n    balanceF: function(c, x) { return _helperG.balance(c, MIDI.to14b((x + 1) / 2)); },\r\n    balance: function(c, m, l) { return typeof l == 'undefined' ?\r\n      [_helperCH.balanceMSB(c, _msb(m)), _helperCH.balanceLSB(c, _lsb(m))] : [_helperCH.balanceMSB(c, m), _helperCH.balanceLSB(c, l)]; },\r\n    panF: function(c, x) { return _helperG.pan(c, MIDI.to14b((x + 1) / 2)); },\r\n    pan: function(c, m, l) { return typeof l == 'undefined' ?\r\n      [_helperCH.panMSB(c, _msb(m)), _helperCH.panLSB(c, _lsb(m))] : [_helperCH.panMSB(c, m), _helperCH.panLSB(c, l)]; },\r\n    expressionF: function(c, x) { return _helperG.expression(c, MIDI.to14b(x)); },\r\n    expression: function(c, m, l) { return typeof l == 'undefined' ?\r\n      [_helperCH.expressionMSB(c, _msb(m)), _helperCH.expressionLSB(c, _lsb(m))] : [_helperCH.expressionMSB(c, m), _helperCH.expressionLSB(c, l)]; },\r\n    nrpn: function(c, m, l) { return typeof l == 'undefined' ?\r\n      [_helperCH.nrpnMSB(c, _msb(m)), _helperCH.nrpnLSB(c, _lsb(m))] : [_helperCH.nrpnMSB(c, m), _helperCH.nrpnLSB(c, l)]; },\r\n    rpn: function(c, m, l) { return typeof l == 'undefined' ?\r\n      [_helperCH.rpnMSB(c, _msb(m)), _helperCH.rpnLSB(c, _lsb(m))] : [_helperCH.rpnMSB(c, m), _helperCH.rpnLSB(c, l)]; },\r\n    rpnPitchBendRange: function(c, x) { return _helperG.rpn(c, 0, 0).concat(_helperG.data(c, _7b(x - x % 1), Math.floor((x % 1) * 128))); },\r\n    rpnFineTuning: function(c, x) { return _helperG.rpn(c, 0, 1).concat(_helperG.dataF(c, (x % 1 + 1) / 2)); },\r\n    rpnCoarseTuning: function(c, x) { return _helperG.rpn(c, 0, 2).concat([_helperCH.dataMSB(c, 0x40 + x - x % 1)]); },\r\n    rpnTuning: function(c, x) { return _helperG.rpnCoarseTuning(c, x).concat(_helperG.rpnFineTuning(c, x)); },\r\n    rpnTuningA: function(c, a) { return _helperG.rpnTuning(c, MIDI.shift(a)); },\r\n  };\r\n  var _helperGNC = { // compound messages no channel\r\n    sxMasterTuning: function(x) { return [_helperNC.sxMasterCoarseTuning(x), _helperNC.sxMasterFineTuning(x)]; },\r\n    sxMasterTuningA: function(a) { return _helperGNC.sxMasterTuning(MIDI.shift(a)); },\r\n  };\r\n  function _smf(ff, dd) {\r\n    var midi = new MIDI();\r\n    midi.ff = _8b(ff);\r\n    midi.dd = typeof dd == 'undefined' ? '' : _8bs(dd);\r\n    return midi;\r\n  }\r\n  var _helperSMF = { // Standard MIDI File events\r\n    smf: function(arg) {\r\n      if (arg instanceof MIDI) return new MIDI(arg);\r\n      var arr = arg instanceof Array ? arg : arguments;\r\n      var ff = _8b(arr[0]);\r\n      var dd = '';\r\n      if (arr.length == 2) dd = _2s(arr[1]);\r\n      else if (arr.length > 2) dd = _2s(Array.prototype.slice.call(arr, 1));\r\n      return _smf(ff, dd);\r\n    },\r\n    smfSeqNumber: function(dd) {\r\n      if (dd == parseInt(dd)) {\r\n        if (dd < 0 || dd > 0xffff) throw RangeError('Sequence number out of range: ' + dd);\r\n        dd = String.fromCharCode(dd >> 8) + String.fromCharCode(dd & 0xff);\r\n      }\r\n      else {\r\n        dd = '' + dd;\r\n        if (dd.length == 0) dd = '\\x00\\x00';\r\n        else if (dd.length == 1) dd = '\\x00' + dd;\r\n        else if (dd.length > 2) throw RangeError('Sequence number out of range: ' + _smftxt(dd));\r\n      }\r\n      return _smf(0, dd);\r\n    },\r\n    smfText: function(dd) { return _smf(1, JZZ.lib.toUTF8(dd)); },\r\n    smfCopyright: function(dd) { return _smf(2, JZZ.lib.toUTF8(dd)); },\r\n    smfSeqName: function(dd) { return _smf(3, JZZ.lib.toUTF8(dd)); },\r\n    smfInstrName: function(dd) { return _smf(4, JZZ.lib.toUTF8(dd)); },\r\n    smfLyric: function(dd) { return _smf(5, JZZ.lib.toUTF8(dd)); },\r\n    smfMarker: function(dd) { return _smf(6, JZZ.lib.toUTF8(dd)); },\r\n    smfCuePoint: function(dd) { return _smf(7, JZZ.lib.toUTF8(dd)); },\r\n    smfProgName: function(dd) { return _smf(8, JZZ.lib.toUTF8(dd)); },\r\n    smfDevName: function(dd) { return _smf(9, JZZ.lib.toUTF8(dd)); },\r\n    smfChannelPrefix: function(dd) {\r\n      if (dd == parseInt(dd)) {\r\n        _validateChannel(dd);\r\n        dd = String.fromCharCode(dd);\r\n      }\r\n      else {\r\n        dd = '' + dd;\r\n        if (dd.length == 0) dd = '\\x00';\r\n        else if (dd.length > 1 || dd.charCodeAt(0) > 15) throw RangeError('Channel number out of range: ' + _smftxt(dd));\r\n      }\r\n      return _smf(32, dd);\r\n    },\r\n    smfMidiPort: function(dd) {\r\n      if (dd == parseInt(dd)) {\r\n        if (dd < 0 || dd > 127) throw RangeError('Port number out of range: ' + dd);\r\n        dd = String.fromCharCode(dd);\r\n      }\r\n      else {\r\n        dd = '' + dd;\r\n        if (dd.length == 0) dd = '\\x00';\r\n        else if (dd.length > 1 || dd.charCodeAt(0) > 127) throw RangeError('Port number out of range: ' + _smftxt(dd));\r\n      }\r\n      return _smf(33, dd);\r\n    },\r\n    smfEndOfTrack: function(dd) {\r\n      if (_2s(dd) != '') throw RangeError('Unexpected data: ' + _smftxt(_2s(dd)));\r\n      return _smf(47);\r\n    },\r\n    smfTempo: function(dd) { // microseconds per quarter note\r\n      if (('' + dd).length == 3) return _smf(81, dd);\r\n      if (dd == parseInt(dd) && dd > 0 && dd <= 0xffffff) {\r\n        return _smf(81, String.fromCharCode(dd >> 16) + String.fromCharCode((dd >> 8) & 0xff) + String.fromCharCode(dd & 0xff));\r\n      }\r\n      throw RangeError('Out of range: ' + _smftxt(_2s(dd)));\r\n    },\r\n    smfBPM: function(bpm) { return _helperSMF.smfTempo(Math.round(60000000.0 / bpm)); },\r\n    smfSMPTE: function(dd) {\r\n      if (dd instanceof SMPTE) return _smf(84, String.fromCharCode(dd.hour) + String.fromCharCode(dd.minute) + String.fromCharCode(dd.second) + String.fromCharCode(dd.frame) + String.fromCharCode((dd.quarter % 4) * 25));\r\n      var s = '' + dd;\r\n      if (s.length == 5) {\r\n        return _smf(84, dd);\r\n      }\r\n      var arr = dd instanceof Array ? dd : Array.prototype.slice.call(arguments);\r\n      arr.splice(0, 0, 30);\r\n      return _helperSMF.smfSMPTE(new SMPTE(arr));\r\n    },\r\n    smfTimeSignature: function(a, b, c, d) {\r\n      var nn, dd, cc, bb;\r\n      var m = ('' + a ).match(/^\\s*(\\d+)\\s*\\/\\s*(\\d+)\\s*$/);\r\n      if (m) {\r\n        nn = parseInt(m[1]);\r\n        dd = parseInt(m[2]);\r\n        if (nn > 0 && nn <= 0xff && dd && !(dd & (dd - 1))) {\r\n          cc = dd; dd = 0;\r\n          for (cc >>= 1; cc; cc >>= 1) dd++;\r\n          cc = b == parseInt(b) ? b : 24;\r\n          bb = c == parseInt(c) ? c : 8;\r\n          return _smf(88, String.fromCharCode(nn) + String.fromCharCode(dd) + String.fromCharCode(cc) + String.fromCharCode(bb));\r\n        }\r\n        else if (('' + a ).length == 4) return _smf(88, a);\r\n      }\r\n      else if (a == parseInt(a) && b == parseInt(b) && b && !(b & (b - 1))) {\r\n        nn = a;\r\n        dd = 0;\r\n        cc = b;\r\n        for (cc >>= 1; cc; cc >>= 1) dd++;\r\n        cc = c == parseInt(c) ? c : 24;\r\n        bb = d == parseInt(d) ? d : 8;\r\n        return _smf(88, String.fromCharCode(nn) + String.fromCharCode(dd) + String.fromCharCode(cc) + String.fromCharCode(bb));\r\n      }\r\n      else if (('' + a ).length == 4) return _smf(88, a);\r\n      throw RangeError('Wrong time signature: ' + _smftxt(_2s(a)));\r\n    },\r\n    smfKeySignature: function(dd) {\r\n      dd = '' + dd;\r\n      var m = dd.match(/^\\s*([A-H][b#]?)\\s*(|maj|major|dur|m|min|minor|moll)\\s*$/i);\r\n      if (m) {\r\n        var sf = {\r\n          CB: 0, GB: 1, DB: 2, AB: 3, EB: 4, BB: 5, F: 6, C: 7, G: 8, D: 9, A: 10,\r\n          E:11, B: 12, H: 12, 'F#': 13, 'C#': 14, 'G#': 15, 'D#': 16, 'A#': 17\r\n        }[m[1].toUpperCase()];\r\n        var mi = { '': 0, MAJ: 0, MAJOR: 0, DUR: 0, M: 1, MIN: 1, MINOR: 1, MOLL: 1}[m[2].toUpperCase()];\r\n        if (typeof sf != 'undefined' && typeof mi != 'undefined') {\r\n          if (mi) sf -= 3;\r\n          sf -= 7;\r\n          if (sf >= -7 && sf < 0) dd = String.fromCharCode(256 + sf) + String.fromCharCode(mi);\r\n          else if (sf >= 0 && sf <= 7) dd = String.fromCharCode(sf) + String.fromCharCode(mi);\r\n        }\r\n      }\r\n      if (dd.length == 2 && dd.charCodeAt(1) <= 1 && (dd.charCodeAt(0) <= 7 || dd.charCodeAt(0) <= 255 && dd.charCodeAt(0) >= 249)) return _smf(89, dd);\r\n      throw RangeError('Incorrect key signature: ' + _smftxt(dd));\r\n    },\r\n    smfSequencer: function(dd) { return _smf(127, _2s(dd)); }\r\n  };\r\n\r\n  function _copyPortHelper(M, name, func) {\r\n    M.prototype[name] = function() { return this.send(func.apply(0, arguments)); };\r\n  }\r\n  function _copyPortHelperG(M, name, func) {\r\n    M.prototype[name] = function() {\r\n      var a = func.apply(0, arguments);\r\n      var g = this;\r\n      for (var i = 0; i < a.length; i++) g = g.send(a[i]);\r\n      return g;\r\n    };\r\n  }\r\n  function _copyChannelHelper(C, name, func) {\r\n    C.prototype[name] = function() {\r\n      return this.send(func.apply(0, [this._chan].concat(Array.prototype.slice.call(arguments))));\r\n    };\r\n  }\r\n  function _copyChannelHelperG(C, name, func) {\r\n    C.prototype[name] = function() {\r\n      var a = func.apply(0, [this._chan].concat(Array.prototype.slice.call(arguments)));\r\n      var g = this;\r\n      for (var i = 0; i < a.length; i++) g = g.send(a[i]);\r\n      return g;\r\n    };\r\n  }\r\n  function _copyHelperNC(name, func) {\r\n    MIDI[name] = function() { return new MIDI(func.apply(0, arguments)); };\r\n  }\r\n  function _copyHelperSMF(name, func) {\r\n    MIDI[name] = function() { return func.apply(0, arguments); };\r\n  }\r\n  function _copyHelperG(name, func) {\r\n    MIDI[name] = function() {\r\n      var i;\r\n      var g = [];\r\n      var a = func.apply(0, arguments);\r\n      for (i = 0; i < a.length; i++) g.push(new MIDI(a[i]));\r\n      return g;\r\n    };\r\n  }\r\n  function _copyHelperCH(name, func) {\r\n    _copyHelperNC(name, func);\r\n    _E.prototype[name] = function() {\r\n      var chan;\r\n      var args = Array.prototype.slice.call(arguments);\r\n      if (args.length < func.length) args = [this._master].concat(args);\r\n      else {\r\n        chan = _7b(MIDI.noteValue(args[0], args[0]));\r\n        args[0] = this._master;\r\n      }\r\n      var msg = func.apply(0, args);\r\n      msg.mpe = chan;\r\n      this.send(msg);\r\n      return this;\r\n    };\r\n  }\r\n  for (k in _helperNC) if (_helperNC.hasOwnProperty(k)) _copyHelperNC(k, _helperNC[k]);\r\n  for (k in _helperSMF) if (_helperSMF.hasOwnProperty(k)) _copyHelperSMF(k, _helperSMF[k]);\r\n  for (k in _helperCH) if (_helperCH.hasOwnProperty(k)) _copyHelperCH(k, _helperCH[k]);\r\n  for (k in _helperG) if (_helperG.hasOwnProperty(k)) _copyHelperG(k, _helperG[k]);\r\n  for (k in _helperGNC) if (_helperGNC.hasOwnProperty(k)) _copyHelperG(k, _helperGNC[k]);\r\n  function _copyMidiHelpers(M, C) {\r\n    for (k in _helperNC) if (_helperNC.hasOwnProperty(k)) _copyPortHelper(M, k, _helperNC[k]);\r\n    for (k in _helperSMF) if (_helperSMF.hasOwnProperty(k)) _copyPortHelper(M, k, _helperSMF[k]);\r\n    for (k in _helperCH) if (_helperCH.hasOwnProperty(k)) _copyPortHelper(M, k, _helperCH[k]);\r\n    for (k in _helperG) if (_helperG.hasOwnProperty(k)) _copyPortHelperG(M, k, _helperG[k]);\r\n    for (k in _helperGNC) if (_helperGNC.hasOwnProperty(k)) _copyPortHelperG(M, k, _helperGNC[k]);\r\n    if (C) {\r\n      for (k in _helperCH) if (_helperCH.hasOwnProperty(k)) _copyChannelHelper(C, k, _helperCH[k]);\r\n      for (k in _helperG) if (_helperG.hasOwnProperty(k)) _copyChannelHelperG(C, k, _helperG[k]);\r\n    }\r\n  }\r\n  _copyMidiHelpers(_M, _C);\r\n\r\n  _E.prototype.noteOn = function(n, v) {\r\n    var msg = MIDI.noteOn(this._master, n, v);\r\n    msg._mpe = msg[1];\r\n    this.send(msg);\r\n    return this;\r\n  };\r\n  _E.prototype.noteOff = function(n, v) {\r\n    var msg = MIDI.noteOff(this._master, n, v);\r\n    msg._mpe = msg[1];\r\n    this.send(msg);\r\n    return this;\r\n  };\r\n  _E.prototype.aftertouch = function(n, v) {\r\n    var msg = MIDI.aftertouch(this._master, n, v);\r\n    msg._mpe = msg[1];\r\n    this.send(msg);\r\n    return this;\r\n  };\r\n\r\n  var _channelMap = { a:10, b:11, c:12, d:13, e:14, f:15, A:10, B:11, C:12, D:13, E:14, F:15 };\r\n  for (k = 0; k < 16; k++) _channelMap[k] = k;\r\n  MIDI.prototype.getChannel = function() {\r\n    if (this.ff == 0x20 && this.dd.length == 1 && this.dd.charCodeAt(0) < 16) return this.dd.charCodeAt(0);\r\n    var c = this[0];\r\n    if (typeof c == 'undefined' || c < 0x80 || c > 0xef) return;\r\n    return c & 15;\r\n  };\r\n  MIDI.prototype.setChannel = function(x) {\r\n    x = _channelMap[x];\r\n    if (typeof x == 'undefined') return this;\r\n    if (this.ff == 0x20) this.dd = String.fromCharCode(x);\r\n    else {\r\n      var c = this[0];\r\n      if (typeof c != 'undefined' && c >= 0x80 && c <= 0xef) this[0] = (c & 0xf0) | x;\r\n    }\r\n    return this;\r\n  };\r\n  MIDI.prototype.getNote = function() {\r\n    var c = this[0];\r\n    if (typeof c == 'undefined' || c < 0x80 || c > 0xaf) return;\r\n    return this[1];\r\n  };\r\n  MIDI.prototype.setNote = function(x) {\r\n    var c = this[0];\r\n    if (typeof c == 'undefined' || c < 0x80 || c > 0xaf) return this;\r\n    x = MIDI.noteValue(x);\r\n    if (typeof x != 'undefined') this[1] = x;\r\n    return this;\r\n  };\r\n  MIDI.prototype.getVelocity = function() {\r\n    var c = this[0];\r\n    if (typeof c == 'undefined' || c < 0x80 || c > 0x9f) return;\r\n    return this[2];\r\n  };\r\n  MIDI.prototype.setVelocity = function(x) {\r\n    var c = this[0];\r\n    if (typeof c == 'undefined' || c < 0x80 || c > 0x9f) return this;\r\n    x = parseInt(x);\r\n    if (x >= 0 && x < 128) this[2] = x;\r\n    return this;\r\n  };\r\n  MIDI.prototype.getSysExChannel = function() {\r\n    if (this[0] == 0xf0) return this[2];\r\n  };\r\n  MIDI.prototype.setSysExChannel = function(x) {\r\n    if (this[0] == 0xf0 && this.length > 2) {\r\n      x = parseInt(x);\r\n      if (x >= 0 && x < 128) this[2] = x;\r\n    }\r\n    return this;\r\n  };\r\n  MIDI.prototype.getData = function() {\r\n    if (typeof this.dd != 'undefined') return this.dd.toString();\r\n  };\r\n  MIDI.prototype.setData = function(dd) {\r\n    this.dd = _2s(dd);\r\n    return this;\r\n  };\r\n  MIDI.prototype.getText = function() {\r\n    if (typeof this.dd != 'undefined') return JZZ.lib.fromUTF8(this.dd);\r\n  };\r\n  MIDI.prototype.setText = function(dd) {\r\n    this.dd = JZZ.lib.toUTF8(dd);\r\n    return this;\r\n  };\r\n  MIDI.prototype.getTempo = function() {\r\n    if (this.ff == 0x51 && typeof this.dd != 'undefined') {\r\n      return this.dd.charCodeAt(0) * 65536 + this.dd.charCodeAt(1) * 256 + this.dd.charCodeAt(2);\r\n    }\r\n  };\r\n  MIDI.prototype.getBPM = function() {\r\n    var ms = this.getTempo();\r\n    if (ms) return 60000000 / ms;\r\n  };\r\n  MIDI.prototype.getTimeSignature = function() {\r\n    if (this.ff == 0x58 && typeof this.dd != 'undefined') {\r\n       return [this.dd.charCodeAt(0), 1 << this.dd.charCodeAt(1)];\r\n    }\r\n  };\r\n  MIDI.prototype.getKeySignature = function() {\r\n    if (this.ff == 0x59 && typeof this.dd != 'undefined') {\r\n      var sf = this.dd.charCodeAt(0);\r\n      var mi = this.dd.charCodeAt(1);\r\n      if (sf & 0x80) sf = sf - 0x100;\r\n      if (sf >= -7 && sf <= 7 && mi >= 0 && mi <= 1) {\r\n        return [sf,\r\n          ['Cb', 'Gb', 'Db', 'Ab', 'Eb', 'Bb', 'F', 'C', 'G', 'D', 'A', 'E', 'B', 'F#', 'C#', 'G#', 'D#', 'A#'][mi ? sf + 10 : sf + 7],\r\n          !!mi\r\n        ];\r\n      }\r\n    }\r\n  };\r\n\r\n  MIDI.prototype.isNoteOn = function() {\r\n    var c = this[0];\r\n    if (typeof c == 'undefined' || c < 0x90 || c > 0x9f) return false;\r\n    return this[2] > 0 ? true : false;\r\n  };\r\n  MIDI.prototype.isNoteOff = function() {\r\n    var c = this[0];\r\n    if (typeof c == 'undefined' || c < 0x80 || c > 0x9f) return false;\r\n    if (c < 0x90) return true;\r\n    return this[2] == 0 ? true : false;\r\n  };\r\n  MIDI.prototype.isSysEx = function() {\r\n    return this[0] == 0xf0;\r\n  };\r\n  MIDI.prototype.isFullSysEx = function() {\r\n    return this[0] == 0xf0 && this[this.length - 1] == 0xf7;\r\n  };\r\n  MIDI.prototype.isSMF = function() {\r\n    return this.ff >= 0 && this.ff <= 0x7f;\r\n  };\r\n  MIDI.prototype.isEOT = function() {\r\n    return this.ff == 0x2f;\r\n  };\r\n  MIDI.prototype.isTempo = function() {\r\n    return this.ff == 0x51;\r\n  };\r\n  MIDI.prototype.isTimeSignature = function() {\r\n    return this.ff == 0x58;\r\n  };\r\n  MIDI.prototype.isKeySignature = function() {\r\n    return this.ff == 0x59;\r\n  };\r\n\r\n  function _s2a(x) {\r\n    var a = [];\r\n    for (var i = 0; i < x.length; i++) {\r\n      a[i] = x.charCodeAt(i);\r\n    }\r\n    return a;\r\n  }\r\n  function _a2s(x) {\r\n    var a = '';\r\n    for (var i = 0; i < x.length; i++) {\r\n      a += String.fromCharCode(x[i]);\r\n    }\r\n    return a;\r\n  }\r\n  function _2s(x) {\r\n    return x instanceof Array ? _a2s(x) : typeof x == 'undefined' ? '' : '' + x;\r\n  }\r\n  function _s2n(x) {\r\n    var n = 0;\r\n    for (var i = 0; i < x.length; i++) n = (n << 8) + x.charCodeAt(i);\r\n    return n;\r\n  }\r\n\r\n  function __hex(x) { return (x < 16 ? '0' : '') + x.toString(16); }\r\n  function _hex(x) {\r\n    var a = [];\r\n    for (var i = 0; i < x.length; i++) {\r\n      a[i] = __hex(x[i]);\r\n    }\r\n    return a.join(' ');\r\n  }\r\n  function _toLine(s) {\r\n    var out = '';\r\n    for (var i = 0; i < s.length; i++) {\r\n      if (s[i] == '\\n') out += '\\\\n';\r\n      else if (s[i] == '\\r') out += '\\\\r';\r\n      else if (s[i] == '\\t') out += '\\\\t';\r\n      else if (s.charCodeAt(i) < 32) out += '\\\\x' + __hex(s.charCodeAt(i));\r\n      else out += s[i];\r\n    }\r\n    return out;\r\n  }\r\n  function _smfhex(dd) {\r\n    return dd.length ? ': ' + _hex(_s2a(dd)) : '';\r\n  }\r\n  function _smftxt(dd) {\r\n    return dd.length ? ': ' + _toLine(JZZ.lib.fromUTF8(dd)) : '';\r\n  }\r\n  MIDI.prototype.toString = function() {\r\n    var s;\r\n    var ss;\r\n    if (!this.length) {\r\n      if (typeof this.ff != 'undefined') {\r\n        s = 'ff' + __hex(this.ff) + ' -- ';\r\n        if (this.ff == 0) s += 'Sequence Number: ' + _s2n(this.dd);\r\n        else if (this.ff > 0 && this.ff < 10) s += ['', 'Text', 'Copyright', 'Sequence Name', 'Instrument Name', 'Lyric', 'Marker', 'Cue Point', 'Program Name', 'Device Name'][this.ff] + _smftxt(this.dd);\r\n        else if (this.ff == 32) s += 'Channel Prefix' + _smfhex(this.dd);\r\n        else if (this.ff == 33) s += 'MIDI Port' + _smfhex(this.dd);\r\n        else if (this.ff == 47) s += 'End of Track' + _smfhex(this.dd);\r\n        else if (this.ff == 81) {\r\n          var bpm = Math.round(this.getBPM() * 100) / 100;\r\n          s += 'Tempo: ' + bpm + ' bpm';\r\n        }\r\n        else if (this.ff == 84) s += 'SMPTE Offset: ' + _smptetxt(_s2a(this.dd));\r\n        else if (this.ff == 88) {\r\n          var d = 1 << this.dd.charCodeAt(1);\r\n          s += 'Time Signature: ' + this.dd.charCodeAt(0) + '/' + d;\r\n          s += ' ' + this.dd.charCodeAt(2) + ' ' + this.dd.charCodeAt(3);\r\n        }\r\n        else if (this.ff == 89) {\r\n          s += 'Key Signature: ';\r\n          var ks = this.getKeySignature();\r\n          if (ks) {\r\n            s += ks[1];\r\n            if (ks[2]) s += ' min';\r\n          }\r\n          else s+= 'invalid';\r\n        }\r\n        else if (this.ff == 127) s += 'Sequencer Specific' + _smfhex(this.dd);\r\n        else s += 'SMF' + _smfhex(this.dd);\r\n        return s;\r\n      }\r\n      return 'empty';\r\n    }\r\n    s = _hex(this);\r\n    if (this[0] < 0x80) return s;\r\n    ss = {\r\n      241: 'MIDI Time Code',\r\n      242: 'Song Position',\r\n      243: 'Song Select',\r\n      244: 'Undefined',\r\n      245: 'Undefined',\r\n      246: 'Tune request',\r\n      248: 'Timing clock',\r\n      249: 'Undefined',\r\n      250: 'Start',\r\n      251: 'Continue',\r\n      252: 'Stop',\r\n      253: 'Undefined',\r\n      254: 'Active Sensing',\r\n      255: 'Reset'\r\n    }[this[0]];\r\n    if (ss) return s + ' -- ' + ss;\r\n    var c = this[0] >> 4;\r\n    ss = {8: 'Note Off', 10: 'Aftertouch', 12: 'Program Change', 13: 'Channel Aftertouch', 14: 'Pitch Wheel'}[c];\r\n    if (ss) return s + ' -- ' + ss;\r\n    if (c == 9) return s + ' -- ' + (this[2] ? 'Note On' : 'Note Off');\r\n    if (c != 11) return s;\r\n    ss = {\r\n      0: 'Bank Select MSB',\r\n      1: 'Modulation Wheel MSB',\r\n      2: 'Breath Controller MSB',\r\n      4: 'Foot Controller MSB',\r\n      5: 'Portamento Time MSB',\r\n      6: 'Data Entry MSB',\r\n      7: 'Channel Volume MSB',\r\n      8: 'Balance MSB',\r\n      10: 'Pan MSB',\r\n      11: 'Expression Controller MSB',\r\n      12: 'Effect Control 1 MSB',\r\n      13: 'Effect Control 2 MSB',\r\n      16: 'General Purpose Controller 1 MSB',\r\n      17: 'General Purpose Controller 2 MSB',\r\n      18: 'General Purpose Controller 3 MSB',\r\n      19: 'General Purpose Controller 4 MSB',\r\n      32: 'Bank Select LSB',\r\n      33: 'Modulation Wheel LSB',\r\n      34: 'Breath Controller LSB',\r\n      36: 'Foot Controller LSB',\r\n      37: 'Portamento Time LSB',\r\n      38: 'Data Entry LSB',\r\n      39: 'Channel Volume LSB',\r\n      40: 'Balance LSB',\r\n      42: 'Pan LSB',\r\n      43: 'Expression Controller LSB',\r\n      44: 'Effect control 1 LSB',\r\n      45: 'Effect control 2 LSB',\r\n      48: 'General Purpose Controller 1 LSB',\r\n      49: 'General Purpose Controller 2 LSB',\r\n      50: 'General Purpose Controller 3 LSB',\r\n      51: 'General Purpose Controller 4 LSB',\r\n      64: 'Damper Pedal On/Off',\r\n      65: 'Portamento On/Off',\r\n      66: 'Sostenuto On/Off',\r\n      67: 'Soft Pedal On/Off',\r\n      68: 'Legato Footswitch',\r\n      69: 'Hold 2',\r\n      70: 'Sound Controller 1',\r\n      71: 'Sound Controller 2',\r\n      72: 'Sound Controller 3',\r\n      73: 'Sound Controller 4',\r\n      74: 'Sound Controller 5',\r\n      75: 'Sound Controller 6',\r\n      76: 'Sound Controller 7',\r\n      77: 'Sound Controller 8',\r\n      78: 'Sound Controller 9',\r\n      79: 'Sound Controller 10',\r\n      80: 'General Purpose Controller 5',\r\n      81: 'General Purpose Controller 6',\r\n      82: 'General Purpose Controller 7',\r\n      83: 'General Purpose Controller 8',\r\n      84: 'Portamento Control',\r\n      88: 'High Resolution Velocity Prefix',\r\n      91: 'Effects 1 Depth',\r\n      92: 'Effects 2 Depth',\r\n      93: 'Effects 3 Depth',\r\n      94: 'Effects 4 Depth',\r\n      95: 'Effects 5 Depth',\r\n      96: 'Data Increment',\r\n      97: 'Data Decrement',\r\n      98: 'Non-Registered Parameter Number LSB',\r\n      99: 'Non-Registered Parameter Number MSB',\r\n      100: 'Registered Parameter Number LSB',\r\n      101: 'Registered Parameter Number MSB',\r\n      120: 'All Sound Off',\r\n      121: 'Reset All Controllers',\r\n      122: 'Local Control On/Off',\r\n      123: 'All Notes Off',\r\n      124: 'Omni Mode Off',\r\n      125: 'Omni Mode On',\r\n      126: 'Mono Mode On',\r\n      127: 'Poly Mode On'\r\n    }[this[1]];\r\n    if (!ss) ss = 'Undefined';\r\n    return s + ' -- ' + ss;\r\n  };\r\n  MIDI.prototype._stamp = function(obj) { this._from.push(obj._orig ? obj._orig : obj); return this; };\r\n  MIDI.prototype._unstamp = function(obj) {\r\n    if (typeof obj == 'undefined') this._from = [];\r\n    else {\r\n      if (obj._orig) obj = obj._orig;\r\n      var i = this._from.indexOf(obj);\r\n      if (i > -1) this._from.splice(i, 1);\r\n    }\r\n    return this;\r\n  };\r\n  MIDI.prototype._stamped = function(obj) {\r\n    if (obj._orig) obj = obj._orig;\r\n    for (var i = 0; i < this._from.length; i++) if (this._from[i] == obj) return true;\r\n    return false;\r\n  };\r\n\r\n  JZZ.MIDI = MIDI;\r\n\r\n  function MPE() {\r\n    var self = this instanceof MPE ? this : self = new MPE();\r\n    self.reset();\r\n    if (arguments.length) MPE.prototype.setup.apply(self, arguments);\r\n    return self;\r\n  }\r\n  MPE.validate = function(arg) {\r\n    var a = arg instanceof Array ? arg : arguments;\r\n    if (a[0] != parseInt(a[0]) || a[0] < 0 || a[0] > 14) throw RangeError('Bad master channel value: ' + a[0]);\r\n    if (a[1] != parseInt(a[1]) || a[1] < 0 || a[0] + a[1] > 15) throw RangeError('Bad zone size value: ' + a[1]);\r\n  };\r\n  MPE.prototype.reset = function() { for (var n = 0; n < 16; n++) this[n] = { band: 0, master: n }; };\r\n  MPE.prototype.setup = function(m, n) {\r\n    MPE.validate(m, n);\r\n    var k;\r\n    var last = m + n;\r\n    if (this[m].master == m && this[m].band == n) return;\r\n    if (!n && !this[m].band) return;\r\n    if (this[m].band) {\r\n      k = m + this[m].band;\r\n      if (last < k) last = k;\r\n    }\r\n    else if (this[m].master == m - 1) {\r\n      k = m - 1;\r\n      k = k + this[k].band;\r\n      if (last < k) last = k;\r\n      this[m - 1] = { band: 0, master: m - 1 };\r\n    }\r\n    else if (this[m].master != m) {\r\n      k = this[m].master;\r\n      k = k + this[k].band;\r\n      if (last < k) last = k;\r\n      this[this[m].master].band = m - this[m].master - 1;\r\n    }\r\n    this[m].master = m;\r\n    this[m].band = n;\r\n    for (k = m + 1; k <= m + n; k++) {\r\n      if (this[k].band && last < k + this[k].band) last = k + this[k].band;\r\n      this[k] = { band: 0, master: m };\r\n    }\r\n    for (; k <= last; k++) this[k] = { band: 0, master: k };\r\n  };\r\n  MPE.prototype.filter = function(msg) {\r\n    var c = msg.getChannel();\r\n    if (!this[c] || !this[this[c].master].band) return msg;\r\n    var m = this[c].master;\r\n    var n = this[m].band;\r\n    var i, j, k;\r\n    if (typeof msg._mpe != 'undefined') {\r\n      k = 256;\r\n      for (i = m + 1; i <= m + n; i++) {\r\n        if (!this[i].notes) {\r\n          if (k > 0) { c = i; k = 0; }\r\n        }\r\n        else {\r\n          if (k > this[i].notes.length) { c = i; k = this[i].notes.length; }\r\n          for (j = 0; j < this[i].notes.length; j++) {\r\n            if (this[i].notes[j] == msg._mpe) { c = i; k = -1; break; }\r\n          }\r\n        }\r\n      }\r\n      msg.setChannel(c);\r\n      msg._mpe = undefined;\r\n    }\r\n    if (c == m) return msg; // bad mpe\r\n    if (msg.isNoteOn()) {\r\n      if (!this[c].notes) this[c].notes = [];\r\n      _push(this[c].notes, msg.getNote());\r\n    }\r\n    else if (msg.isNoteOff()) {\r\n      if (this[c].notes) _pop(this[c].notes, msg.getNote());\r\n    }\r\n    return msg;\r\n  };\r\n  JZZ.MPE = MPE;\r\n\r\n  JZZ.lib = {};\r\n  JZZ.lib.now = _now;\r\n  JZZ.lib.schedule = _schedule;\r\n  JZZ.lib.openMidiOut = function(name, engine) {\r\n    var port = new _M();\r\n    engine._openOut(port);\r\n    port._info = engine._info(name);\r\n    return port;\r\n  };\r\n  JZZ.lib.openMidiIn = function(name, engine) {\r\n    var port = new _M();\r\n    engine._openIn(port);\r\n    port._info = engine._info(name);\r\n    return port;\r\n  };\r\n  JZZ.lib.registerMidiOut = function(name, engine) {\r\n    var x = engine._info(name);\r\n    for (var i = 0; i < _virtual._outs.length; i++) if (_virtual._outs[i].name == x.name) return false;\r\n    x.engine = engine;\r\n    _virtual._outs.push(x);\r\n    if (_jzz) {\r\n      _postRefresh();\r\n      if (_jzz._bad) { _jzz._repair(); _jzz._resume(); }\r\n    }\r\n    return true;\r\n  };\r\n  JZZ.lib.registerMidiIn = function(name, engine) {\r\n    var x = engine._info(name);\r\n    for (var i = 0; i < _virtual._ins.length; i++) if (_virtual._ins[i].name == x.name) return false;\r\n    x.engine = engine;\r\n    _virtual._ins.push(x);\r\n    if (_jzz) {\r\n      _postRefresh();\r\n      if (_jzz._bad) { _jzz._repair(); _jzz._resume(); }\r\n    }\r\n    return true;\r\n  };\r\n  var _ac;\r\n  function _initAudioContext() {\r\n    if (!_ac && typeof window !== 'undefined') {\r\n      var AudioContext = window.AudioContext || window.webkitAudioContext;\r\n      if (AudioContext) {\r\n        _ac = new AudioContext();\r\n        if (_ac && !_ac.createGain) _ac.createGain = _ac.createGainNode;\r\n        var _activateAudioContext = function() {\r\n          if (_ac.state != 'running') {\r\n            _ac.resume();\r\n            var osc = _ac.createOscillator();\r\n            var gain = _ac.createGain();\r\n            try { gain.gain.value = 0; } catch (err) {}\r\n            gain.gain.setTargetAtTime(0, _ac.currentTime, 0.01);\r\n            osc.connect(gain);\r\n            gain.connect(_ac.destination);\r\n            if (!osc.start) osc.start = osc.noteOn;\r\n            if (!osc.stop) osc.stop = osc.noteOff;\r\n            osc.start(0.1); osc.stop(0.11);\r\n          }\r\n          else {\r\n            document.removeEventListener('touchstart', _activateAudioContext);\r\n            document.removeEventListener('touchend', _activateAudioContext);\r\n            document.removeEventListener('mousedown', _activateAudioContext);\r\n            document.removeEventListener('keydown', _activateAudioContext);\r\n          }\r\n        };\r\n        document.addEventListener('touchstart', _activateAudioContext);\r\n        document.addEventListener('touchend', _activateAudioContext);\r\n        document.addEventListener('mousedown', _activateAudioContext);\r\n        document.addEventListener('keydown', _activateAudioContext);\r\n        _activateAudioContext();\r\n      }\r\n    }\r\n  }\r\n  JZZ.lib.copyMidiHelpers = _copyMidiHelpers;\r\n  JZZ.lib.getAudioContext = function() { _initAudioContext(); return _ac; };\r\n  var _b64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\r\n  JZZ.lib.fromBase64 = function(input) {\r\n    var output = '';\r\n    var chr1, chr2, chr3;\r\n    var enc1, enc2, enc3, enc4;\r\n    var i = 0;\r\n    input = input.replace(/[^A-Za-z0-9+/=]/g, '');\r\n    while (i < input.length) {\r\n      enc1 = _b64.indexOf(input.charAt(i++));\r\n      enc2 = _b64.indexOf(input.charAt(i++));\r\n      enc3 = _b64.indexOf(input.charAt(i++));\r\n      enc4 = _b64.indexOf(input.charAt(i++));\r\n      chr1 = (enc1 << 2) | (enc2 >> 4);\r\n      chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\r\n      chr3 = ((enc3 & 3) << 6) | enc4;\r\n      output = output + String.fromCharCode(chr1);\r\n      if (enc3 != 64) {\r\n        output = output + String.fromCharCode(chr2);\r\n      }\r\n      if (enc4 != 64) {\r\n        output = output + String.fromCharCode(chr3);\r\n      }\r\n    }\r\n    return output;\r\n  };\r\n  JZZ.lib.toBase64 = function(data) {\r\n    var o1, o2, o3, h1, h2, h3, h4, bits, i = 0, ac = 0, enc = '', arr = [];\r\n    if (!data) return data;\r\n    do {\r\n      o1 = data.charCodeAt(i++);\r\n      o2 = data.charCodeAt(i++);\r\n      o3 = data.charCodeAt(i++);\r\n      bits = o1 << 16 | o2 << 8 | o3;\r\n      h1 = bits >> 18 & 0x3f;\r\n      h2 = bits >> 12 & 0x3f;\r\n      h3 = bits >> 6 & 0x3f;\r\n      h4 = bits & 0x3f;\r\n      arr[ac++] = _b64.charAt(h1) + _b64.charAt(h2) + _b64.charAt(h3) + _b64.charAt(h4);\r\n    } while(i < data.length);\r\n    enc = arr.join('');\r\n    var r = data.length % 3;\r\n    return (r ? enc.slice(0, r - 3) + '==='.slice(r) : enc);\r\n  };\r\n  JZZ.lib.fromUTF8 = function(data) {\r\n    data = typeof data == 'undefined' ? '' : '' + data;\r\n    var out = '';\r\n    var i, n, m;\r\n    for (i = 0; i < data.length; i++) {\r\n      n = data.charCodeAt(i);\r\n      if (n > 0xff) return data;\r\n      if (n < 0x80) out += data[i];\r\n      else if ((n & 0xe0) == 0xc0) {\r\n        n = (n & 0x1f) << 6;\r\n        i++; if (i >= data.length) return data;\r\n        m = data.charCodeAt(i);\r\n        if ((m & 0xc0) != 0x80) return data;\r\n        n += (m & 0x3f);\r\n        out += String.fromCharCode(n);\r\n      }\r\n      else if ((n & 0xf0) == 0xe0) {\r\n        n = (n & 0x0f) << 12;\r\n        i++; if (i >= data.length) return data;\r\n        m = data.charCodeAt(i);\r\n        if ((m & 0xc0) != 0x80) return data;\r\n        n += (m & 0x3f) << 6;\r\n        i++; if (i >= data.length) return data;\r\n        m = data.charCodeAt(i);\r\n        if ((m & 0xc0) != 0x80) return data;\r\n        n += (m & 0x3f);\r\n        out += String.fromCharCode(n);\r\n      }\r\n      else if ((n & 0xf8) == 0xf0) {\r\n        n = (n & 0x07) << 18;\r\n        i++; if (i >= data.length) return data;\r\n        m = data.charCodeAt(i);\r\n        if ((m & 0xc0) != 0x80) return data;\r\n        n += (m & 0x3f) << 12;\r\n        i++; if (i >= data.length) return data;\r\n        m = data.charCodeAt(i);\r\n        if ((m & 0xc0) != 0x80) return data;\r\n        n += (m & 0x3f) << 6;\r\n        i++; if (i >= data.length) return data;\r\n        m = data.charCodeAt(i);\r\n        if ((m & 0xc0) != 0x80) return data;\r\n        n += (m & 0x3f);\r\n        if (n > 0x10ffff) return data;\r\n        n -= 0x10000;\r\n        out += String.fromCharCode(0xd800 + (n >> 10));\r\n        out += String.fromCharCode(0xdc00 + (n & 0x3ff));\r\n      }\r\n    }\r\n    return out;\r\n  };\r\n  JZZ.lib.toUTF8 = function(data) {\r\n    data = typeof data == 'undefined' ? '' : '' + data;\r\n    var out = '';\r\n    var i, n;\r\n    for (i = 0; i < data.length; i++) {\r\n      n = data.charCodeAt(i);\r\n      if (n < 0x80) out += data[i];\r\n      else if (n < 0x800) {\r\n        out += String.fromCharCode(0xc0 + (n >> 6));\r\n        out += String.fromCharCode(0x80 + (n & 0x3f));\r\n      }\r\n      else if (n < 0x10000) {\r\n        out += String.fromCharCode(0xe0 + (n >> 12));\r\n        out += String.fromCharCode(0x80 + ((n >> 6) & 0x3f));\r\n        out += String.fromCharCode(0x80 + (n & 0x3f));\r\n      }\r\n      else {\r\n        out += String.fromCharCode(0xf0 + (n >> 18));\r\n        out += String.fromCharCode(0x80 + ((n >> 12) & 0x3f));\r\n        out += String.fromCharCode(0x80 + ((n >> 6) & 0x3f));\r\n        out += String.fromCharCode(0x80 + (n & 0x3f));\r\n      }\r\n    }\r\n    return out;\r\n  };\r\n\r\n  // Web MIDI API\r\n  var _wma = [];\r\n  var _outputMap = {};\r\n  var _inputMap = {};\r\n\r\n  var Promise = _scope.Promise;\r\n  if (typeof Promise !== 'function') {\r\n    Promise = function(executor) {\r\n      this.executor = executor;\r\n    };\r\n    Promise.prototype.then = function(resolve, reject) {\r\n      if (typeof resolve !== 'function') {\r\n        resolve = function() {};\r\n      }\r\n      if (typeof reject !== 'function') {\r\n        reject = function() {};\r\n      }\r\n      this.executor(resolve, reject);\r\n    };\r\n  }\r\n  function DOMException(name, message, code) {\r\n    this.name = name;\r\n    this.message = message;\r\n    this.code = code;\r\n  }\r\n\r\n  function MIDIConnectionEvent(port, target) {\r\n    this.bubbles = false;\r\n    this.cancelBubble = false;\r\n    this.cancelable = false;\r\n    this.currentTarget = target;\r\n    this.defaultPrevented = false;\r\n    this.eventPhase = 0;\r\n    this.path = [];\r\n    this.port = port;\r\n    this.returnValue = true;\r\n    this.srcElement = target;\r\n    this.target = target;\r\n    this.timeStamp = _now();\r\n    this.type = 'statechange';\r\n  }\r\n\r\n  function MIDIMessageEvent(port, data) {\r\n    this.bubbles = false;\r\n    this.cancelBubble = false;\r\n    this.cancelable = false;\r\n    this.currentTarget = port;\r\n    this.data = data;\r\n    this.defaultPrevented = false;\r\n    this.eventPhase = 0;\r\n    this.path = [];\r\n    this.receivedTime = _now();\r\n    this.returnValue = true;\r\n    this.srcElement = port;\r\n    this.target = port;\r\n    this.timeStamp = this.receivedTime;\r\n    this.type = 'midimessage';\r\n  }\r\n\r\n  function _statechange(p, a) {\r\n    if (p) {\r\n      if (p.onstatechange) p.onstatechange(new MIDIConnectionEvent(p, p));\r\n      if (a.onstatechange) a.onstatechange(new MIDIConnectionEvent(p, a));\r\n    }\r\n  }\r\n\r\n  function MIDIInput(a, p) {\r\n    var self = this;\r\n    var _open = false;\r\n    var _ochng = null;\r\n    var _onmsg = null;\r\n    this.type = 'input';\r\n    this.id = p.id;\r\n    this.name = p.name;\r\n    this.manufacturer = p.man;\r\n    this.version = p.ver;\r\n    Object.defineProperty(this, 'state', { get: function() { return p.connected ? 'connected' : 'disconnected'; }, enumerable: true });\r\n    Object.defineProperty(this, 'connection', { get: function() {\r\n      return _open ? p.proxy ? 'open' : 'pending' : 'closed';\r\n    }, enumerable: true });\r\n    Object.defineProperty(this, 'onmidimessage', {\r\n      get: function() { return _onmsg; },\r\n      set: function(value) {\r\n        if (value instanceof Function) {\r\n          _onmsg = value;\r\n          if (!_open) try { self.open(); } catch(e) {/**/}\r\n        }\r\n        else _onmsg = null;\r\n      },\r\n      enumerable: true\r\n    });\r\n    Object.defineProperty(this, 'onstatechange', {\r\n      get: function() { return _ochng; },\r\n      set: function(value) {\r\n        if (value instanceof Function) _ochng = value;\r\n        else _ochng = null;\r\n      },\r\n      enumerable: true\r\n    });\r\n    this.open = function() {\r\n      return new Promise(function(resolve, reject) {\r\n        if (_open) resolve(self);\r\n        else {\r\n          p.open().then(function() {\r\n            if (!_open) {\r\n              _open = true;\r\n              _statechange(self, a);\r\n            }\r\n            resolve(self);\r\n          }, function() {\r\n            reject(new DOMException('InvalidAccessError', 'Port is not available', 15));\r\n          });\r\n        }\r\n      });\r\n    };\r\n    this.close = function() {\r\n      return new Promise(function(resolve/*, reject*/) {\r\n        if (_open) {\r\n          _open = false;\r\n          p.close();\r\n          _statechange(self, a);\r\n        }\r\n        resolve(self);\r\n      });\r\n    };\r\n    Object.freeze(this);\r\n  }\r\n\r\n  function _split(q) {\r\n    var i, k;\r\n    while (q.length) {\r\n      for (i = 0; i < q.length; i++) if (q[i] == parseInt(q[i]) && q[i] >= 0x80 && q[i] <= 0xff && q[i] != 0xf7) break;\r\n      q.splice(0, i);\r\n      if (!q.length) return;\r\n      if (q[0] == 0xf0) {\r\n        for (i = 1; i < q.length; i++) if (q[i] == 0xf7) break;\r\n        if (i == q.length) return;\r\n        return q.splice(0, i + 1);\r\n      }\r\n      else {\r\n        k = _datalen(q[0]) + 1;\r\n        if (k > q.length) return;\r\n        for (i = 1; i < k; i++) if (q[i] != parseInt(q[i]) || q[i] < 0 || q[i] >= 0x80) break;\r\n        if (i == k) return q.splice(0, i);\r\n        else q.splice(0, i);\r\n      }\r\n    }\r\n  }\r\n\r\n  function _InputProxy(id, name, man, ver) {\r\n    var self = this;\r\n    this.id = id;\r\n    this.name = name;\r\n    this.man = man;\r\n    this.ver = ver;\r\n    this.connected = true;\r\n    this.ports = [];\r\n    this.pending = [];\r\n    this.proxy = undefined;\r\n    this.queue = [];\r\n    this.onmidi = function(msg) {\r\n      var m;\r\n      self.queue = self.queue.concat(msg.slice());\r\n      for (m = _split(self.queue); m; m = _split(self.queue)) {\r\n        for (i = 0; i < self.ports.length; i++) {\r\n          if (self.ports[i][0].onmidimessage && (m[0] != 0xf0 || self.ports[i][1])) {\r\n            self.ports[i][0].onmidimessage(new MIDIMessageEvent(self, new Uint8Array(m)));\r\n          }\r\n        }\r\n      }\r\n    };\r\n  }\r\n  _InputProxy.prototype.open = function() {\r\n    var self = this;\r\n    return new Promise(function(resolve, reject) {\r\n      var i;\r\n      if (self.proxy || !self.connected) resolve();\r\n      else {\r\n        self.pending.push([resolve, reject]);\r\n        if (self.pending.length == 1) {\r\n          JZZ().openMidiIn(self.name).or(function() {\r\n            for (i = 0; i < self.pending.length; i++) self.pending[i][1]();\r\n            self.pending = [];\r\n          }).and(function() {\r\n            self.proxy = this;\r\n            self.proxy.connect(self.onmidi);\r\n            for (i = 0; i < self.pending.length; i++) self.pending[i][0]();\r\n            self.pending = [];\r\n          });\r\n        }\r\n      }\r\n    });\r\n  };\r\n  _InputProxy.prototype.close = function() {\r\n    var i;\r\n    if (this.proxy) {\r\n      for (i = 0; i < this.ports.length; i++) if (this.ports[i].connection == 'open') return;\r\n      this.proxy.close();\r\n      this.proxy = undefined;\r\n    }\r\n  };\r\n  _InputProxy.prototype.disconnect = function() {\r\n    this.connected = false;\r\n    if (this.proxy) {\r\n      this.proxy.close();\r\n      this.proxy = undefined;\r\n    }\r\n  };\r\n  _InputProxy.prototype.reconnect = function() {\r\n    var self = this;\r\n    var i, p;\r\n    var a = [];\r\n    this.connected = true;\r\n    for (i = 0; i < _wma.length; i++) {\r\n      p = _wma[i].inputs.get(this.id);\r\n      if (p.connection == 'closed') _statechange(p, _wma[i]);\r\n      else a.push([p, _wma[i]]);\r\n    }\r\n    if (a.length) {\r\n      JZZ()._openMidiInNR(self.name).or(function() {\r\n        for (i = 0; i < a.length; i++) a[i][0].close();\r\n      }).and(function() {\r\n        self.proxy = this;\r\n        self.proxy.connect(self.onmidi);\r\n        for (i = 0; i < a.length; i++) _statechange(a[i][0], a[i][1]);\r\n      });\r\n    }\r\n  };\r\n\r\n  function _datalen(x) {\r\n    if (x >= 0x80 && x <= 0xbf || x >= 0xe0 && x <= 0xef || x == 0xf2) return 2;\r\n    if (x >= 0xc0 && x <= 0xdf || x == 0xf1 || x == 0xf3) return 1;\r\n    return 0;\r\n  }\r\n\r\n  var _epr = \"Failed to execute 'send' on 'MIDIOutput': \";\r\n\r\n  function _validate(arr, sysex) {\r\n    var i, k;\r\n    var msg;\r\n    var data = [];\r\n    for (i = 0; i < arr.length; i++) {\r\n      if (arr[i] != parseInt(arr[i]) || arr[i] < 0 || arr[i] > 255) throw TypeError(_epr + arr[i] + ' is not a UInt8 value.');\r\n    }\r\n    k = 0;\r\n    for (i = 0; i < arr.length; i++) {\r\n      if (!k) {\r\n        if (arr[i] < 0x80) throw TypeError(_epr + 'Running status is not allowed at index ' + i + ' (' + arr[i] + ').');\r\n        if (arr[i] == 0xf7) throw TypeError(_epr + 'Unexpected end of system exclusive message at index ' + i + ' (' + arr[i] + ').');\r\n        msg = [arr[i]];\r\n        data.push(msg);\r\n        if (arr[i] == 0xf0) {\r\n          if (!sysex) throw new DOMException('InvalidAccessError', _epr + 'System exclusive messag is not allowed at index ' + i + ' (' + arr[i] + ').', 15);\r\n          k = -1;\r\n          for (; i < arr.length; i++) {\r\n            msg.push(arr[i]);\r\n            if (arr[i] == 0xf7) {\r\n              k = 0;\r\n              break;\r\n            }\r\n          }\r\n        }\r\n        else {\r\n          k = _datalen(arr[i]);\r\n        }\r\n      }\r\n      else {\r\n        if (arr[i] > 0x7f) throw TypeError(_epr + 'Unexpected status byte at index ' + i + ' (' + arr[i] + ').');\r\n        msg.push(arr[i]);\r\n        k--;\r\n      }\r\n    }\r\n    if (k) throw TypeError(_epr + 'Message is incomplete');\r\n    return [data];\r\n  }\r\n\r\n  function MIDIOutput(a, p) {\r\n    var self = this;\r\n    var _open = false;\r\n    var _ochng = null;\r\n    this.type = 'output';\r\n    this.id = p.id;\r\n    this.name = p.name;\r\n    this.manufacturer = p.man;\r\n    this.version = p.ver;\r\n    Object.defineProperty(this, 'state', { get: function() { return p.connected ? 'connected' : 'disconnected'; }, enumerable: true });\r\n    Object.defineProperty(this, 'connection', { get: function() {\r\n      return _open ? p.proxy ? 'open' : 'pending' : 'closed';\r\n    }, enumerable: true });\r\n    Object.defineProperty(this, 'onstatechange', {\r\n      get: function() { return _ochng; },\r\n      set: function(value) {\r\n        if (value instanceof Function) _ochng = value;\r\n        else _ochng = null;\r\n      },\r\n      enumerable: true\r\n    });\r\n    this.open = function() {\r\n      return new Promise(function(resolve, reject) {\r\n        if (_open) resolve(self);\r\n        else {\r\n          p.open().then(function() {\r\n            if (!_open) {\r\n              _open = true;\r\n              _statechange(self, a);\r\n            }\r\n            resolve(self);\r\n          }, function() {\r\n            reject(new DOMException('InvalidAccessError', 'Port is not available', 15));\r\n          });\r\n        }\r\n      });\r\n    };\r\n    this.close = function() {\r\n      return new Promise(function(resolve/*, reject*/) {\r\n        if (_open) {\r\n          _open = false;\r\n          self.clear();\r\n          p.close();\r\n          _statechange(self, a);\r\n        }\r\n        resolve(self);\r\n      });\r\n    };\r\n    this.clear = function() {\r\n    };\r\n    this.send = function(data, timestamp) {\r\n      _validate(data, a.sysexEnabled);\r\n      if (!p.connected) throw new DOMException('InvalidStateError', 'Port is not connected', 11);\r\n      if (_open) {\r\n        var now = _now();\r\n        if (timestamp > now) setTimeout(function() { p.proxy.send(data); }, timestamp - now);\r\n        else p.proxy.send(data);\r\n      }\r\n      else this.open().then(function() { self.send(data, timestamp); });\r\n\r\n    };\r\n    Object.freeze(this);\r\n  }\r\n\r\n  function _OutputProxy(id, name, man, ver) {\r\n    this.id = id;\r\n    this.name = name;\r\n    this.man = man;\r\n    this.ver = ver;\r\n    this.connected = true;\r\n    this.ports = [];\r\n    this.pending = [];\r\n    this.proxy = undefined;\r\n  }\r\n  _OutputProxy.prototype.open = function() {\r\n    var self = this;\r\n    return new Promise(function(resolve, reject) {\r\n      var i;\r\n      if (self.proxy || !self.connected) resolve();\r\n      else {\r\n        self.pending.push([resolve, reject]);\r\n        if (self.pending.length == 1) {\r\n          JZZ().openMidiOut(self.name).or(function() {\r\n            for (i = 0; i < self.pending.length; i++) self.pending[i][1]();\r\n            self.pending = [];\r\n          }).and(function() {\r\n            self.proxy = this;\r\n            for (i = 0; i < self.pending.length; i++) self.pending[i][0]();\r\n            self.pending = [];\r\n          });\r\n        }\r\n      }\r\n    });\r\n  };\r\n  _OutputProxy.prototype.close = function() {\r\n    var i;\r\n    if (this.proxy) {\r\n      for (i = 0; i < this.ports.length; i++) if (this.ports[i].connection == 'open') return;\r\n      this.proxy.close();\r\n      this.proxy = undefined;\r\n    }\r\n  };\r\n  _OutputProxy.prototype.disconnect = function() {\r\n    this.connected = false;\r\n    if (this.proxy) {\r\n      this.proxy.close();\r\n      this.proxy = undefined;\r\n    }\r\n  };\r\n  _OutputProxy.prototype.reconnect = function() {\r\n    var self = this;\r\n    var i, p;\r\n    var a = [];\r\n    this.connected = true;\r\n    for (i = 0; i < _wma.length; i++) {\r\n      p = _wma[i].outputs.get(this.id);\r\n      if (p.connection == 'closed') _statechange(p, _wma[i]);\r\n      else a.push([p, _wma[i]]);\r\n    }\r\n    if (a.length) {\r\n      JZZ()._openMidiOutNR(self.name).or(function() {\r\n        for (i = 0; i < a.length; i++) a[i][0].close();\r\n      }).and(function() {\r\n        self.proxy = this;\r\n        for (i = 0; i < a.length; i++) _statechange(a[i][0], a[i][1]);\r\n      });\r\n    }\r\n  };\r\n\r\n  function _Maplike(data) {\r\n    this.has = function(id) {\r\n      return data.hasOwnProperty(id) && data[id].connected;\r\n    };\r\n    this.keys = function() {\r\n      try { // some old browsers may have no Map object\r\n        var m = new Map();\r\n        for (var id in data) if (this.has(id)) m.set(id, this.get(id));\r\n        return m.keys();\r\n      } catch (e) {}\r\n    };\r\n    this.values = function() {\r\n      try {\r\n        var m = new Map();\r\n        for (var id in data) if (this.has(id)) m.set(id, this.get(id));\r\n        return m.values();\r\n      } catch (e) {}\r\n    };\r\n    this.entries = function() {\r\n      try {\r\n        var m = new Map();\r\n        for (var id in data) if (this.has(id)) m.set(id, this.get(id));\r\n        return m.entries();\r\n      } catch (e) {}\r\n    };\r\n    this.forEach = function(fun, self) {\r\n      if (typeof self == 'undefined') self = this;\r\n      for (var id in data) if (this.has(id)) fun.call(self, this.get(id), id, this);\r\n    };\r\n    Object.defineProperty(this, 'size', {\r\n      get: function() {\r\n        var len = 0;\r\n        for (var id in data) if (this.has(id)) len++;\r\n        return len;\r\n      },\r\n      enumerable: true\r\n    });\r\n  }\r\n\r\n  function MIDIInputMap(_access, _inputs) {\r\n    this.get = function(id) {\r\n      if (_inputMap.hasOwnProperty(id) && _inputMap[id].connected) {\r\n        if (!_inputs[id]) {\r\n          _inputs[id] = new MIDIInput(_access, _inputMap[id]);\r\n          _inputMap[id].ports.push([_inputs[id], _access.sysexEnabled]);\r\n        }\r\n        return _inputs[id];\r\n      }\r\n    };\r\n    Object.freeze(this);\r\n  }\r\n  MIDIInputMap.prototype = new _Maplike(_inputMap);\r\n  MIDIInputMap.prototype.constructor = MIDIInputMap;\r\n\r\n  function MIDIOutputMap(_access, _outputs) {\r\n    this.get = function(id) {\r\n      if (_outputMap.hasOwnProperty(id) && _outputMap[id].connected) {\r\n        if (!_outputs[id]) {\r\n          _outputs[id] = new MIDIOutput(_access, _outputMap[id]);\r\n          _outputMap[id].ports.push([_outputs[id], _access.sysexEnabled]);\r\n        }\r\n        return _outputs[id];\r\n      }\r\n    };\r\n    Object.freeze(this);\r\n  }\r\n  MIDIOutputMap.prototype = new _Maplike(_outputMap);\r\n  MIDIOutputMap.prototype.constructor = MIDIOutputMap;\r\n\r\n  function _wm_watch(x) {\r\n    var i, k, p, a;\r\n    for (i = 0; i < x.inputs.added.length; i++) {\r\n      p = x.inputs.added[i];\r\n      if (!_inputMap.hasOwnProperty(p.id)) _inputMap[p.id] = new _InputProxy(p.id, p.name, p.manufacturer, p.version);\r\n      _inputMap[p.id].reconnect();\r\n    }\r\n    for (i = 0; i < x.outputs.added.length; i++) {\r\n      p = x.outputs.added[i];\r\n      if (!_outputMap.hasOwnProperty(p.id)) _outputMap[p.id] = new _OutputProxy(p.id, p.name, p.manufacturer, p.version);\r\n      _outputMap[p.id].reconnect();\r\n    }\r\n    for (i = 0; i < x.inputs.removed.length; i++) {\r\n      p = x.inputs.removed[i];\r\n      if (_inputMap.hasOwnProperty(p.id)) {\r\n        a = [];\r\n        for (k = 0; k < _wma.length; k++) a.push([_wma[k].inputs.get(p.id), _wma[k]]);\r\n        _inputMap[p.id].disconnect();\r\n        for (k = 0; k < a.length; k++) _statechange(a[k][0], a[k][1]);\r\n      }\r\n    }\r\n    for (i = 0; i < x.outputs.removed.length; i++) {\r\n      p = x.outputs.removed[i];\r\n      if (_outputMap.hasOwnProperty(p.id)) {\r\n        a = [];\r\n        for (k = 0; k < _wma.length; k++) a.push([_wma[k].outputs.get(p.id), _wma[k]]);\r\n        _outputMap[p.id].disconnect();\r\n        for (k = 0; k < a.length; k++) _statechange(a[k][0], a[k][1]);\r\n      }\r\n    }\r\n  }\r\n\r\n  function MIDIAccess(sysex) {\r\n    var _inputs = {};\r\n    var _outputs = {};\r\n    var _onstatechange = null;\r\n    var self = this;\r\n    this.sysexEnabled = sysex;\r\n    this.inputs = new MIDIInputMap(self, _inputs);\r\n    this.outputs = new MIDIOutputMap(self, _outputs);\r\n    Object.defineProperty(this, 'onstatechange', {\r\n      get: function() { return _onstatechange; },\r\n      set: function(f) { _onstatechange = f instanceof Function ? f : null; },\r\n      enumerable: true\r\n    });\r\n    Object.freeze(this);\r\n    var i;\r\n    var p;\r\n    var info = _jzz._info;\r\n    for (i = 0; i < info.inputs.length; i++) {\r\n      p = info.inputs[i];\r\n      if (!_inputMap.hasOwnProperty(p.id)) _inputMap[p.id] = new _InputProxy(p.id, p.name, p.manufacturer, p.version);\r\n    }\r\n    for (i = 0; i < info.outputs.length; i++) {\r\n      p = info.outputs[i];\r\n      if (!_outputMap.hasOwnProperty(p.id)) _outputMap[p.id] = new _OutputProxy(p.id, p.name, p.manufacturer, p.version);\r\n    }\r\n    if (!_wma.length) JZZ().onChange(_wm_watch);\r\n    _wma.push(this);\r\n  }\r\n\r\n  JZZ.requestMIDIAccess = function(opt) {\r\n    return new Promise(function(resolve, reject) {\r\n      JZZ.JZZ(opt).or(function() {\r\n      }).and(function() {\r\n        var sysex = !!(opt && opt.sysex);\r\n        if (sysex && !this.info().sysex) reject(new DOMException('SecurityError', 'Sysex is not allowed', 18));\r\n        else {\r\n          var wma = new MIDIAccess(sysex);\r\n          resolve(wma);\r\n        }\r\n      });\r\n    });\r\n  };\r\n  if (typeof navigator !== 'undefined' && !navigator.requestMIDIAccess) navigator.requestMIDIAccess = JZZ.requestMIDIAccess;\r\n  JZZ.close = function() { if (_engine._close) _engine._close(); };\r\n\r\n  return JZZ;\r\n});\r\n","var path='./bin/';\r\nvar v=process.versions.node.split('.');\r\nif (v[0]<=10) path+='10_15/';\r\nelse if (v[0]<=11) path+='11_15/';\r\nif(process.platform==\"win32\"&&process.arch==\"ia32\") path+='win32/jazz';\r\nelse if(process.platform==\"win32\"&&process.arch==\"x64\") path+='win64/jazz';\r\nelse if(process.platform==\"darwin\"&&process.arch==\"x64\") path+='macos64/jazz';\r\nelse if(process.platform==\"linux\"&&process.arch==\"x64\") path+='linux64/jazz';\r\nelse if(process.platform==\"linux\"&&process.arch==\"arm\") path+='linuxa7/jazz';\r\nmodule.exports=require(path);\r\nmodule.exports.package=require(__dirname + '/package.json');\r\n","// const cam = (video) => {\r\n\r\n// \tvideo = video || document.createElement('video')\r\n\r\n// \tconst stream = await navigator.mediaDevices.getUserMedia({\r\n// \t  audio: false,\r\n// \t  video: {\r\n// \t\tfacingMode: 'user',\r\n// \t\twidth: 640,\r\n// \t\theight: 640\r\n// \t  }\r\n// \t})\r\n\r\n// \tvideo.srcObject = stream\r\n// }\r\nexport const filterVideoCameras = (devices) => {\r\n\t\r\n\treturn devices.filter( device => {\r\n\t\t// console.log(\"filterVideoCameras\", device.kind, device.kind === \"videoinput\" , device)\r\n\t\treturn device.kind === \"videoinput\"\r\n\t\t\r\n\t})\r\n}\r\n// This returns a list of IDS that you can then feed into the setupCamera\r\n// if you want to select a specific camera\r\nexport const detectCameras = async () => {\r\n\treturn navigator.mediaDevices.enumerateDevices()\r\n}\r\n\r\nexport const setupCamera = async (video, deviceId ) => {\r\n\r\n\treturn new Promise( async (resolve,reject) => {\r\n\t\t\r\n\t\tlet stream\r\n\t\tvideo = video || document.createElement('video')\r\n\r\n\t\t// stop it if it is already running?\r\n\t\t//video.stop()\r\n\r\n\t\tvideo.onloadedmetadata = (event) => { \r\n\t\t\t\r\n\t\t\tvideo.play()\r\n\t\t\tvideo.width = video.videoWidth\r\n\t\t\tvideo.height = video.videoHeight\r\n\t\t\tresolve(stream)\r\n\t\t}\r\n\r\n\t\tvideo.onerror = event => reject(stream)\r\n\t\t\r\n\t\tconst videoConstraints = {}\r\n\t\tif (deviceId) {\r\n\t\t  videoConstraints.deviceId = { exact: deviceId }\r\n\t\t} else {\r\n\t\t  videoConstraints.facingMode = 'user' // 'environment'\r\n\t\t}\r\n\r\n\t\tconst constraints = {\r\n\t\t  video: videoConstraints,\r\n\t\t  audio: false\r\n\t\t}\r\n\r\n\t\ttry{\r\n\t\t\t// hope and preay that this is the right camera...\r\n\t\t\tstream = await navigator.mediaDevices.getUserMedia( constraints )\r\n\t\t\t\r\n\t\tvideo.srcObject = stream\r\n\t\t\t\r\n\t\t}catch(error){\r\n// console.error(\"stream\",{constraints,stream,video})\r\n\t\r\n\t\t\treject(error)\r\n\t\t}\r\n\t})\r\n}\r\n","import { clamp, TAU} from \"./maths\"\r\nimport PALETTE, { DEFAULT_COLOURS } from \"./palette\"\r\n\r\nasync function loadImage(image) {\r\n\treturn new Promise( async (resolve,reject) => {\r\n\t\tconst setSize = ()=> {\r\n\t\t\timage.width = image.naturalWidth\r\n\t\t\timage.height = image.naturalHeight\r\n\t\t}\r\n\t\t// check to see if has already loaded...\r\n\t\tif (image.naturalWidth > 0)\r\n\t\t{\r\n\t\t\tsetSize()\r\n\t\t\tresolve(image) \r\n\t\t}else{\r\n\t\t\timage.onloaded = ()=>{ \r\n\t\t\t\tsetSize()\r\n\t\t\t\tresolve(image)\r\n\t\t\t}\r\n\t\t\timage.onerror = error => reject(error)\r\n\t\t}\r\n\t})\r\n}\r\n\r\nexport const setupImage = async (image) => {\r\n\treturn loadImage(image) \r\n}\r\n\r\nexport const canvas = document.querySelector(\"canvas\")\r\nexport const canvasContext = canvas.getContext('2d')\r\n\r\nlet width = canvas.width\r\nlet height = canvas.height\r\n\r\nexport const getCanvasDimensions = () => { \r\n\treturn {\r\n\t\twidth, height\r\n\t}\r\n\t// width:canvas.width, \r\n\t// height:canvas.height \r\n}\r\n\r\nexport const updateCanvasSize = (w,h) => {\r\n\twidth = w || canvas.width\r\n\theight = h || canvas.height\r\n\t// console.error(\"Updated canvas size to\", {w,h}, canvas.width, canvas.height)\r\n}\r\n\r\nexport const drawElement = element => {\r\n\t\r\n\tcanvasContext.save()\r\n\tcanvasContext.translate(width, 0)\r\n\tcanvasContext.scale(-1, 1)\r\n\t// draw data frame to canvas but invert horizontally?\r\n\tcanvasContext.drawImage(element , 0, 0)\r\n\tcanvasContext.restore()\r\n}\r\n\r\nexport const clear = () => {\r\n\t// canvasContext.fillStyle = 'rgba(255,0,0,0)'\r\n\tcanvasContext.clearRect(0, 0, width, height)\r\n\t// canvasContext.fillRect(0, 0, width, height)\r\n\t// canvasContext.restore()\r\n}\r\n\r\n// funky effects!\t\r\nexport const overdraw = (x=0, y=-1) => {\r\n\t\r\n\tcanvasContext.save()\r\n\t\r\n\t//canvasContext.translate(0, -1)\r\n\tcanvasContext.drawImage(canvas,x,y)\r\n\t// for (var i = 0; i < numImages; i++) {\r\n\t// \tcanvasContext.drawImage(img, i * img.width, 0);\r\n\t// }\r\n\tcanvasContext.restore()\r\n}\r\n\r\nexport const drawPart = (part, radius=4, colour=\"red\", lines=true) => {\r\n\t\r\n\tcanvasContext.fillStyle  = colour\r\n\tcanvasContext.strokeStyle = colour\r\n\t\r\n\tcanvasContext.moveTo(part[0][0], part[0][1])\r\n\t\r\n\tcanvasContext.beginPath()\r\n\tfor (let i = 0,  l= part.length; i < l; i++) \r\n\t{\r\n\t\tconst x = part[i][0]\r\n\t\tconst y = part[i][1]\r\n\r\n\t\tcanvasContext.arc(x, y, radius, 0, TAU)\r\n\t\t\r\n\t\tif (lines){\r\n\t\t\tcanvasContext.lineTo(x, y)\r\n\t\t}\r\n\t}\t\r\n\tcanvasContext.fill()\r\n\r\n\tif (lines){\r\n\t\tcanvasContext.stroke()\r\n\t}\r\n}\r\n\r\nexport const drawEye = (eye, colour=\"blue\") => {\r\n\tcanvasContext.fillStyle  = colour\r\n\t\r\n\tconst iris = eye[0]\r\n\tconst inner = eye[1]\r\n\tconst up = eye[2]\r\n\tconst outer = eye[3]\r\n\tconst down = eye[4]\r\n\t\r\n\tcanvasContext.strokeWidth = 0\r\n\t\r\n\t// draw eye path\r\n\tconst arcLength = 6\r\n\tcanvasContext.beginPath()\r\n\tcanvasContext.fillStyle  = 'blue'\r\n\tcanvasContext.arcTo(up[0], up[1], inner[0], inner[1], arcLength)\r\n\tcanvasContext.arcTo(inner[0], inner[1], down[0], down[1], arcLength)\r\n\tcanvasContext.arcTo(down[0], down[1], outer[0], outer[1], arcLength)\r\n\tcanvasContext.arcTo(outer[0], outer[1], up[0], up[1], arcLength)\r\n\tcanvasContext.fill()\r\n\r\n\tlet radius = 2// 1 + clamp( (10+iris[2]) * 0.8, 5, 10 )\r\n\tcanvasContext.beginPath()\r\n\tcanvasContext.fillStyle  = 'black'\r\n\tcanvasContext.arc(iris[0], iris[1], radius, 0, TAU)\r\n\tcanvasContext.fill()\r\n\r\n\t/*\r\n\tradius = 4\r\n\tcanvasContext.beginPath()\r\n\tcanvasContext.fillStyle  = 'blue'\r\n\tcanvasContext.arc(up[0], up[1], radius, 0, TAU)\r\n\tcanvasContext.fill()\r\n\tcanvasContext.closePath()\r\n\r\n\tcanvasContext.beginPath()\r\n\tcanvasContext.fillStyle  = 'purple'\r\n\tcanvasContext.arc(outer[0], outer[1], radius, 0, TAU)\r\n\tcanvasContext.fill()\r\n\t\t\r\n\tcanvasContext.beginPath()\r\n\tcanvasContext.fillStyle  = 'green'\r\n\tcanvasContext.arc(down[0], down[1], radius, 0, TAU)\r\n\tcanvasContext.fill()\r\n\r\n\t\r\n\tcanvasContext.beginPath()\r\n\tcanvasContext.fillStyle  = 'yellow'\r\n\tcanvasContext.arc(inner[0], inner[1], radius, 0, TAU)\r\n\tcanvasContext.fill()\r\n\t*/\r\n\r\n\t\r\n\t\t/*\r\n\t// there are four outer balls\r\n\tfor (let i = 0  ; i < eye.length -1; i++ ) \r\n\t{\r\n\t\tconst x = eye[i][0]\r\n\t\tconst y = eye[i][1]\r\n\t\tconst z = eye[i][2]\r\n\r\n\t\t// const radius = 1 + clamp( (10+z) * 0.8, 5, 10 )\r\n\t\t// canvasContext.arc(x, y, radius, 0, TAU)\r\n\t\t// canvasContext.fill()\r\n\r\n\t\tif (i > 0)\r\n\t\t{\r\n\t\t\tconst arcLength = 7 ;//Math.abs( i%2 ? iris - x : iris - y )\r\n\t\t\tconst previous = eye[i-1]\r\n\t\t\tcanvasContext.arcTo(previous[0],previous[1], x,y,arcLength)\r\n\t\t}\r\n\t}*/\r\n\t// canvasContext.stroke()\r\n}\r\n\r\nexport const drawNode = (pointA, pointB, radius=5, fill=\"blue\", showText=false) => {\r\n\t\r\n\tcanvasContext.fillStyle  = fill\r\n\r\n\tcanvasContext.beginPath()\r\n\tcanvasContext.arc(pointB[0], pointB[1], radius, 0, TAU)\r\n\tcanvasContext.fill()\r\n\r\n\tcanvasContext.beginPath()\r\n\tcanvasContext.arc(pointA[0], pointA[1], radius, 0, TAU)\r\n\tcanvasContext.fill()\r\n\r\n\tcanvasContext.beginPath()\r\n\tcanvasContext.moveTo(pointA[0], pointA[1])\r\n\r\n\tcanvasContext.strokeStyle = \"orange\"\r\n\tcanvasContext.fillStyle = \"orange\"\r\n\tcanvasContext.lineTo(pointB[0], pointB[1])\r\n\r\n\t// add text\r\n\tif (showText)\r\n\t{\r\n\t\tcanvasContext.stroke( )\r\n\t\tcanvasContext.fillStyle = PALETTE.blue\r\n\t\tcanvasContext.font = \"12px Oxanium\"\r\n\t\tcanvasContext.textAlign = \"center\"\r\n\t\tcanvasContext.fillText(`${Math.floor(mouthRange)}px`, pointA[0], pointA[1] - 20 )\r\n\t}\r\n}\r\n\r\n\r\nexport const drawMouth = ( prediction, colour=\"yellow\", debug=true ) => {\r\n\t\r\n\tconst { annotations, mouthRange,mouthWidth, mouthOpen } = prediction\r\n\tconst {lipsUpperInner,lipsLowerInner} = annotations \r\n\tconst lips = [lipsUpperInner, lipsLowerInner]\r\n\t\r\n\t// central piece of the mouth\r\n\tconst lipUpperMiddle = lipsUpperInner[5]\r\n\tconst lipLowerMiddle = lipsLowerInner[5]\r\n\r\n\t// kermit style mouth with gradient!\r\n\t// const topGradient = ctx.createLinearGradient(0, 0, 0, lipVerticalOpening)\r\n\t// topGradient.addColorStop(0, \"black\")\r\n\t// topGradient.addColorStop(1, \"white\")\r\n\r\n\t// how can we work out height of the mouth???\r\n\tconst mouthGradient = canvasContext.createLinearGradient(0, 0, mouthWidth, mouthRange )\r\n\tmouthGradient.addColorStop(0, colour)\r\n\tmouthGradient.addColorStop(0.5, PALETTE.dark )\r\n\tmouthGradient.addColorStop(1, colour)\r\n\r\n\t// canvasContext.beginPath()\r\n\t// canvasContext.moveTo(lipsUpper[0][0], lipsUpper[0][1])\r\n\t// for (let i = 0, q=lip.length; i < q; i++) \r\n\t// {\r\n\t// \tconst x = lip[i][0]\r\n\t// \tconst y = lip[i][1]\r\n\r\n\t// \tcanvasContext.lineTo(x, y)\r\n\t// }\t\r\n\t// canvasContext.fill()\r\n\t\r\n\t\r\n\tcanvasContext.beginPath()\r\n\tcanvasContext.moveTo(lipsUpperInner[0][0], lipsUpperInner[0][1])\r\n\r\n\tcanvasContext.fillStyle  = mouthGradient\r\n\r\n\t// dual lips mode\r\n\tfor (let l = 0, t=lips.length; l < t; l++) {\r\n\r\n\t\tconst lip = lips[l]\r\n\t\t\r\n\t\tfor (let i = 0, q=lip.length; i < q; i++) \r\n\t\t{\r\n\t\t\tconst x = lip[i][0]\r\n\t\t\tconst y = lip[i][1]\r\n\t\r\n\t\t\tcanvasContext.lineTo(x, y)\r\n\t\t}\t\r\n\t}\r\n\tcanvasContext.fill()\r\n\r\n\tif (debug)\r\n\t{\r\n\t\tdrawNode(lipLowerMiddle, lipUpperMiddle, 5)\r\n\t}\r\n\t\r\n\treturn {lipUpperMiddle, lipLowerMiddle }\r\n}\r\n\r\n\r\nexport const drawText = (x, y, text='', size='10px', align=\"center\") => {\r\n\tconst f = false\r\n\tcanvasContext.font = `900 ${size} Oxanium`\r\n\tcanvasContext.textAlign = align\r\n\tcanvasContext.fillStyle = f ? PALETTE.dark :  PALETTE.white\r\n\tcanvasContext.strokeStyle  = f ? PALETTE.white : PALETTE.dark\r\n\tcanvasContext.strokeText(`${text}`, x,y )\r\n\tcanvasContext.fillText(`${text}`, x, y )\r\n}\r\n\r\n// multi line\r\nexport const drawParagraph = (x, y, paragraph=[], size='10px', lineHeight=20) => {\r\n\tlet textY = y\r\n\tfor (const p of paragraph)\r\n\t{\r\n\t\tdrawText( x, textY, p, size, \"left\" )\r\n\t\ttextY += lineHeight\r\n\t}\r\n}\r\n\r\nexport const drawInstrument = (boundingBox, instrumentName, extra='') => {\r\n\r\n\t// use prediction.boundingBox\r\n\tconst {bottomRight, topLeft} = boundingBox\r\n\tconst text = `${instrumentName.toUpperCase()} - ${extra}`\r\n\t// canvasContext.beginPath()\r\n\t// // these aren't scaled :(\r\n\t// canvasContext.fillStyle  = colour\r\n\t// // canvasContext.rect( topLeft[0], topLeft[1], bottomRight[0], bottomRight[1] )\r\n\t// canvasContext.strokeRect( topLeft[0], topLeft[1], bottomRight[0], bottomRight[1] )\r\n\t// canvasContext.fill()\r\n\tdrawText( topLeft[0], topLeft[1], text, \"24px\" )\r\n}\r\n\r\nexport const drawBoundingBox = (boundingBox, colour='red') => {\r\n\tconst {bottomRight, topLeft} = boundingBox\r\n\tcanvasContext.beginPath()\r\n\t// these aren't scaled :(\r\n\tcanvasContext.fillStyle  = colour\r\n\t// canvasContext.rect( topLeft[0], topLeft[1], bottomRight[0], bottomRight[1] )\r\n\tcanvasContext.strokeRect( topLeft[0], topLeft[1], bottomRight[0], bottomRight[1] )\r\n\tcanvasContext.fill()\r\n}\r\n\r\nimport {easeInQuad } from './maths'\r\nconst modifier = easeInQuad\r\n\r\n\r\nlet nodeCount = 0\r\n\r\nexport const setNodeCount = value => nodeCount += value\r\n\r\nlet cycleCounter = 0\r\n\r\n// Just draws lots of dots on an image on the canvas\r\nexport const drawPoints = (prediction, hue=60, size=3, colourCycle=false, showText=true) => {\r\n\r\n\tconst { scaledMesh } = prediction\r\n\tconst quantity = scaledMesh.length\r\n\t\r\n\t// draw face points at correct position on canvas\r\n\tfor (let i = 0; i < quantity; i++) \r\n\t{\r\n\t\tconst x = scaledMesh[i][0]\r\n\t\tconst y = scaledMesh[i][1]\r\n\t\tconst z = scaledMesh[i][2]\r\n\t\t// z index should not be considered as depth as we\r\n\t\t// start from the front and head back\r\n\t\t\r\n\t\t// const depth = size * ( z + 2) * 0.1\r\n\t\tconst depth =  (1 - ( ((z+45) / 45)) )//* 0.1\r\n\t\t\r\n\t\tconst radius = clamp(size * modifier(depth), 1, size)\r\n\t\tconst alpha = clamp( depth, 0.5, 1)\r\n\t\t// console.log({depth,radius,alpha})\r\n// const radius = size * Math.abs(10 - z) * 0.1\r\n\t\tcanvasContext.beginPath()\r\n\t\t\r\n\t\tif (showText && ( i === (nodeCount % quantity) ))\r\n\t\t{\r\n\t\t\tcanvasContext.stroke( )\r\n\t\t\tcanvasContext.font = \"22px Oxanium\"\r\n\t\t\tcanvasContext.textAlign = \"center\"\r\n\t\t\tcanvasContext.fillStyle = PALETTE.dark\r\n\t\t\tcanvasContext.fillText(`#${i}`, x + radius + 1, y  )\r\n\t\t\t\r\n\t\t\tcanvasContext.fillStyle = `hsla(0,90%,70%,1)`\r\n\t\t\tcanvasContext.arc(x, y, radius * 3, 0, TAU)\r\n\t\t}else{\r\n\r\n\t\t\tconst modifiedHue = colourCycle ? ((cycleCounter++)+hue+360*i/quantity)%360 : hue\r\n\t\t\tcanvasContext.fillStyle = `hsla(${modifiedHue},70%,50%,${alpha})`\r\n\t\t\r\n\t\t\tcanvasContext.arc(x, y, radius, 0, TAU)\r\n\t\t}\r\n\r\n\t\tcanvasContext.fill()\r\n\t}\r\n}\r\n\r\n// every frame this gets called with an array of points in a mesh face\r\n// we use certain deviations to determine direction and mouth size\r\nexport const drawFace = (prediction, options=DEFAULT_COLOURS, singing=false, mouthOpen=false, debug=false) => {\r\n\r\n\t// singing - the user has their mouth open beyond the threshold\r\n\t// mouthOpen - the user has their mouth closed\r\n\r\n\t// extract our data\r\n\t// const imageData = canvasContext.getImageData(0, 0, canvas.width, canvas.height)\r\n\t// const data = imageData.data\r\n\t// now change the colour of certain pixels in line with the points\r\n\t// for (var i = 0; i < data.length; i += 4) \r\n\t// {\r\n    //     data[i]     = 255 - data[i];     // red\r\n    //     data[i + 1] = 255 - data[i + 1]; // green\r\n    //     data[i + 2] = 255 - data[i + 2]; // blue\r\n    // }\r\n\t// canvasContext.putImageData(imageData, 0, 0)\r\n\tconst { scaledMesh, annotations} = prediction\r\n\t\r\n\t// MOUTH ==============================================\r\n\tconst {lipsUpperInner,lipsLowerInner } = annotations\r\n\t\r\n\t// top lips\r\n\tif (mouthOpen && singing)\r\n\t{\r\n\t\tdrawMouth(prediction, options.mouth, debug)\r\n\t\t\r\n\t}else{\r\n\t\t// mouth closedc or not singing\r\n\t\tdrawMouth(prediction, options.mouthClosed, debug)\r\n\t}\r\n\t// drawPart(lipsUpperInner, options.lipsUpperInner)\r\n\t// drawPart(lipsLowerInner, options.lipsLowerInner)\r\n\t\r\n\t// EYES ===========================================\r\n\tconst {leftEyeIris,rightEyeIris} = annotations\r\n\t\r\n\tdrawEye(leftEyeIris, options.leftEyeIris)\r\n\tdrawEye(rightEyeIris, options.rightEyeIris)\r\n\r\n\t// const {leftEyeLower0,rightEyeLower0, midwayBetweenEyes} = annotations\r\n\t\r\n\t// drawPart(midwayBetweenEyes, options.midwayBetweenEyes )\r\n\t\r\n\t// eye lids\r\n\t// drawPart(leftEyeLower0, options.leftEyeLower0 )\r\n\t// drawPart(rightEyeLower0, options.rightEyeLower0 )\r\n\r\n\t// these aren't scaled :(\r\n\t// canvasContext.fillStyle  = 'orange'\r\n\t// canvasContext.beginPath()\r\n\t// canvasContext.arc( midwayBetweenEyes[0], midwayBetweenEyes[1], 10, 0, TAU )\r\n\t// canvasContext.fill()\r\n}\r\n\r\nexport const drawQuantise = (active, bar=-1, extras=\"\") => {\r\n\t\r\n\tconst stroke = 30\r\n\r\n\t// text\r\n\t// canvasContext.strokeWidth = stroke//+\"px\"\r\n\t// canvasContext.font = \"24px Oxanium\"\r\n\t// canvasContext.textAlign = \"left\"\r\n\t// canvasContext.fillStyle = PALETTE.grey\r\n\t// canvasContext.strokeStyle = PALETTE.dark\r\n\t// canvasContext.fillText( (bar === -1 ? `-` : `${bar+1}`) + extras, stroke, stroke)\r\n\t\r\n\t// blobs\r\n\tfor (let i=0, l= bar+1; i<l; ++i)\r\n\t{\r\n\t\tcanvasContext.fillStyle = i === bar ? PALETTE.cream : PALETTE.orange\r\n\t\tcanvasContext.strokeStyle = i ===  bar ? PALETTE.orange : PALETTE.brown\r\n\t\tcanvasContext.lineWidth = 4\r\n\t\tcanvasContext.beginPath()\r\n\t\tcanvasContext.arc( i * 20 + 20, 20, 4, 0, TAU )\r\n\t\tcanvasContext.fill()\r\n\t\tcanvasContext.stroke()\r\n\t}\r\n\t\r\n\t\t\r\n\t// draw a frame around the whole qindow\r\n\t// canvasContext.fillStyle = \"hsla(90, 80%, \"+(active ? 90 : 10 )+\"%, 0.9)\"\r\n\t// canvasContext.strokeRect(0,0,width,height)\r\n\t// console.log(\"quantise enabled!\")\r\n}\r\n\r\nexport const drawWaves = (dataArray, bufferLength)=>{\r\n\r\n\tcanvasContext.lineWidth = 2\r\n\tcanvasContext.strokeStyle = 'rgb(0, 0, 0)'\r\n\r\n\tcanvasContext.beginPath()\r\n\r\n\tconst sliceWidth = width * 1.0 / bufferLength\r\n\tlet x = 0\r\n\r\n\tfor(let i = 0; i < bufferLength; i++) \r\n\t{\r\n\t  const v = dataArray[i] / 128\r\n\t  const y = v * height / 2\r\n\r\n\t  if(i === 0) \r\n\t  {\r\n\t\tcanvasContext.moveTo(x, y)\r\n\t  } else {\r\n\t\tcanvasContext.lineTo(x, y)\r\n\t  }\r\n\r\n\t  x += sliceWidth\r\n\t}\r\n\r\n\tcanvasContext.lineTo(width, height/2)\r\n\tcanvasContext.stroke()\r\n}\r\n\r\n// converts the canvas into a PNG / JPEG and adds returns as a blob?\r\nexport const takePhotograph = (type=\"image/png\") => {\r\n\r\n\t// reassemble canvas?\r\n\treturn canvas.toDataURL(type)\r\n}\r\n\r\nexport const drawBars = (dataArray, bufferLength)=>{\r\n\r\n\tconst barWidth = (width / bufferLength) * 2\t// number here is just cos we only care about a really narrow band\r\n\tlet barHeight\r\n\tlet x = 0\r\n\r\n\tfor(let i = 0; i < bufferLength; i++) \r\n\t{\r\n\t\tbarHeight = dataArray[i]\r\n\r\n\t\tcanvasContext.fillStyle = 'hsla(' + (barHeight/height*360) + ',50%,50%,0.3)'\r\n\t\tcanvasContext.fillRect(x, 0, barWidth, barHeight )\r\n// height-barHeight\r\n\t\tx += barWidth + 1\r\n\t}\r\n\r\n\t// console.log(\"draw bars\", dataArray, bufferLength)\r\n\t\r\n}","// AKA \"Sequences\"\r\n\r\n// Just a simple factory for creating random repetitive beats\r\n\r\n// \r\nexport const factory = (bars=16) => {\r\n\r\n\t// each bar has 4 sub divisions\r\n\tconst gaps = bars * 4\r\n\tconst sequence = []\r\n\tfor (let i=0; i<gaps; ++i)\r\n\t{\r\n\t\tconst playNote = false\r\n\t\tsequence.push(playNote)\r\n\t}\r\n\treturn sequence\r\n}\r\n\r\nexport const pattern = ( sequence, offset=0 )=>{\r\n\r\n\tlet index = offset\r\n\t\r\n\tconst length = sequence.length - 1\r\n\r\n\t// accessors\r\n\treturn {\r\n\t\treset:()=> {\r\n\t\t\tindex = 0\r\n\t\t\treturn sequence[index]\r\n\t\t},\r\n\t\tprevious:()=>{\r\n\t\t\tconst newIndex = index - 1\r\n\t\t\tindex = newIndex < 0 ? length : newIndex\r\n\t\t\treturn sequence[index]\r\n\t\t},\r\n\t\tnext:()=>{\r\n\t\t\tconst newIndex = index + 1\r\n\t\t\tindex = newIndex > length ? 0 : newIndex\r\n\t\t\treturn sequence[index]\r\n\t\t},\r\n\t\tposition: i => sequence[i],\r\n\t\tlength:sequence.length,\r\n\t\tcurrent:()=> sequence[index],\r\n\t\tset:s => sequence = s\r\n\t}\r\n}\r\n\r\nconst kickSequences = [\r\n\t[\r\n\t\t255,0,0,0,\r\n\t\t255,0,0,0,\r\n\t\t255,0,0,0,\r\n\t\t255,0,0,0\r\n\t]\r\n]\r\n\r\nconst snareSequences = [\r\n\t[\r\n\t\t0,0,255,0,\r\n\t\t0,0,255,0,\r\n\t\t0,0,255,0,\r\n\t\t0,0,255,0\r\n\t]\r\n]\r\n\r\nconst hatSequences = [\r\n\t[\r\n\t\t255,0,255,0,\r\n\t\t255,0,255,0,\r\n\t\t255,0,255,0,\r\n\t\t255,0,255,0\r\n\t]\r\n]\r\n\r\nexport const kickSequence = pattern( kickSequences[0] )\r\nexport const snareSequence = pattern(snareSequences[0])\r\nexport const hatSequence = pattern(hatSequences[0])\r\n\r\n// should we add ways to randomise this???\r\nexport const kitSequence = () => {\r\n\treturn {\r\n\t\tkick:pattern( kickSequences[0] ),\r\n\t\that:pattern( hatSequences[0] ),\r\n\t\tsnare:pattern( snareSequences[0] )\r\n\t}\r\n}\r\n\r\nexport const combinePatternWithInstrument = (pattern, instrument )=> {\r\n\r\n}\r\n\r\nexport const playNextPart = (pattern, instrument, ...options )=> {\r\n\tconst velocity = pattern.next()\r\n\tif (velocity > 0)\r\n\t{\r\n\t\tinstrument(velocity, ...options)\t// velocity\r\n\t\treturn true\r\n\t}else{\r\n\t\t// no note but noteOff?\r\n\t\treturn false\r\n\t}\r\n}\r\n\r\n// const kickVelocity = patterns.kick.next()\r\n// if (kickVelocity > 0)\r\n// {\r\n// \tkit.kick()\t// kickVelocity\r\n// }\r\n// const snareVelocity = patterns.snare.next()\r\n// if (snareVelocity > 0)\r\n// {\r\n// \tkit.snare() // snareVelocity\r\n// }\r\n\r\n// const hatVelocity = patterns.hats.next()\r\n// if (hatVelocity > 0)\r\n// {\r\n// \tkit.hat() // snareVelocity\r\n// }\r\n\r\n","export const QUICK_START = [\r\n\t`No faces found!`,\r\n\t`Look at me and open your mouth`,\r\n\t`Move your face close to the screen`,\r\n\t`Try and put it in the centre`,\r\n\t`Make sure you allowed the camera!`\r\n]\r\nexport const INSTRUCTIONS = [\r\n\t`Welcome to the <strong>interFACE</strong>`,\r\n\t`Smile at the screen to begin...`,\r\n\t`Tilt your head forwards and backwards to change octave`,\r\n\t`Roll your head left and right to change pitch`,\r\n\t`Then open you mouth to make it louder!`,\r\n\t`Change instruments by tapping your face on screen`,\r\n\t`or hold your finger down to see all instruments`,\r\n\t`Facing left plays the black keys`,\r\n\t`Facing right plays the white keys`,\r\n\t`Connect a MIDI instrument and click the MIDI button`,\r\n\t`Use your eyes to shape the sound`,\r\n\t`To play the MIDI instrument with your head`,\r\n\t`Change tempo and quantize using the secret keys`,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t`Arrow Up - add more bars`,\r\n\t`Arrow Down - remove a bar`,\r\n\t`Arrow Left - previous instrument`,\r\n\t`Arrow Right - next instrument`,\r\n\t`A - 808`,\r\n\t`S - Snare`,\r\n\t`D - Closed Hat`,\r\n\t`Q - Clack`,\r\n\t`W - Cowbell`,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t``,\r\n\t`OMG I can't believe you are still here!`,\r\n\t`Secret Keys are as follows`,\r\n\t`B - Play percussive accompanyment (alpha)`,\r\n\t`TAB - show more info on screen`,\r\n]\r\n\r\nexport const getHelp = index => QUICK_START[index%(QUICK_START.length-1)]\r\nexport const getInstruction = index => INSTRUCTIONS[index%(INSTRUCTIONS.length-1)]\r\n\r\n// let instructionCount = 0\r\n// export const getNextInstruction = () => INSTRUCTIONS[(instructionCount+1)%(INSTRUCTIONS.length-2)]\r\n\r\nlet instructionCount = 0\r\nexport const getNextInstruction = () => INSTRUCTIONS[(instructionCount+1)%(INSTRUCTIONS.length-1)]","// each person in the app has their own instrument and face\r\nimport {DEFAULT_COLOURS} from './palette'\r\nimport { \r\n\tactive, playing, \r\n\tloadInstrument, NOTE_NAMES, randomInstrument, \r\n\tplayTrack,\r\n\tsetShape, setFrequency, \r\n\tgetNoteName} from './audio'\r\n\r\nimport { clear,\r\n\t\tdrawFace, drawPoints, drawPart, drawEye, drawMouth, drawBoundingBox, \r\n\t\tdrawText,drawParagraph,\r\n\t\tdrawWaves, drawBars, drawInstrument} from './visual'\r\nimport { rescale, easeInSine, easeOutSine , easeInCubic, easeOutCubic, linear, easeOutQuad, lerp, clamp, TAU} from \"./maths\"\r\nimport {INSTRUMENT_FOLDERS, cleanTitle, MUSICAL_NOTES} from './instruments'\r\nimport { setupInstrumentForm} from './ui'\r\n// options easeInCubic // easeInSine\r\n// const ease = easeOutQuad\r\n\r\n// Maximum simultaneous tracks to play (will wait for slot)\r\nconst MAX_TRACKS = 18\r\n\r\nexport const NAMES = ['a','b','c'].map( m => `person-${m}` )\r\n\t\t\t\t\r\nexport const DEFAULT_OPTIONS = {\r\n\t...DEFAULT_COLOURS,\r\n\r\n\t// Passed to the delay node\r\n\tdelayTime: 0.14,\r\n\tdelayLength: 10,\r\n\r\n\t// mouse hold for\r\n\tmouseHoldDuration:0.6,\r\n\r\n\t// how much feedback to apply to the feedback node\r\n\tfeedback:0.1,\r\n\r\n\t// size of the mouth to signal activity\r\n\tmouthCutOff:0.2,\r\n\t// size of the mouth to signal silence\r\n\tmouthSilence:0.05,\r\n\r\n\t// volume smooth rate = smaller means faster fades?\r\n\tvolumeRate:0.7,\r\n\r\n\t// this is the amount of decimal places used to smooth the mouth\r\n\t// the higher the number the less smooth the output is\r\n\t// 1 or 2 should be more than enough\r\n\tprecision:3,\r\n\r\n\t// set this to one of the interpolation methods above\r\n\tease:linear //easeOutSine // easeInSine // linear\r\n}\r\n\r\nexport default class Person{\r\n\r\n\tconstructor(name, audioContext, destinationNode, options={} ) {\r\n\t\t\r\n\t\tthis.options = Object.assign({}, DEFAULT_OPTIONS, options)\r\n\t\tthis.name = name\r\n\t\tthis.counter = 0\r\n\t\tthis.instrumentLoading = false\r\n\t\tthis.data = null\r\n\t\tthis.audioContext = audioContext\r\n\t\tthis.active = false\r\n\t\tthis.tracks = 0\r\n\t\tthis.octave = 4\r\n\t\tthis.midiActive = false\r\n\t\tthis.midiChannel = \"all\"\r\n\t\tthis.hue = options.hue || Math.random() * 360\r\n\t\tthis.saturation = 40\r\n\t\tthis.precision = Math.pow(10, parseInt(this.options.precision) )\r\n\t\t\r\n\t\t// Head orientation\r\n\t\tthis.yaw = 0\r\n\t\tthis.pitch = 0\r\n\t\tthis.roll = 0\r\n\r\n\t\tthis.singing = false\r\n\t\tthis.isMouthOpen = false\r\n\t\tthis.mouseDownAt = -1\r\n\t\tthis.lastNoteName = \"A0\"\r\n\t\tthis.debug = options.debug || false\r\n\r\n\t\t// this.range = 1 / ( 1 - this.options.mouthCutOff )\r\n\t\tthis.mouthScale = rescale(this.options.mouthCutOff)\r\n\r\n\t\tthis.stereoNode = audioContext.createStereoPanner()\r\n\r\n\t\tconst delayNode = audioContext.createDelay( this.options.delayLength )\r\n\t\tconst feedbackNode = audioContext.createGain()\r\n\t\tdelayNode.delayTime.value = this.options.delayTime\r\n\t\tfeedbackNode.gain.value = this.options.feedback\r\n\r\n\t\tthis.gainNode = audioContext.createGain()\r\n\t\tthis.gainNode.gain.value = 0\r\n\r\n\t\tthis.stereoNode.connect(this.gainNode)\r\n\r\n\t\t// DELAY\r\n\t\t// this.stereoNode.connect(delayNode)\r\n\r\n\t\t// delayNode.connect(feedbackNode)\r\n\t\t// feedbackNode.connect(delayNode)\r\n\r\n\t\t// //delayNode.connect(destinationNode)\r\n\t\t// delayNode.connect(this.gainNode)\r\n\r\n\t\tthis.gainNode.connect(destinationNode)\r\n\r\n\t\t// fetch dom element\r\n\t\tthis.button = document.getElementById(name)\r\n\t\tthis.button.addEventListener( 'mousedown', event => {\r\n\r\n\t\t\tthis.mouseDownAt = audioContext.currentTime\r\n\t\t\t\r\n\t\t\t// test to see how long we are help down for?\r\n\t\t\tconst waitPatiently = () => {\r\n\r\n\t\t\t\tconst elapsed = this.mouseDownFor\r\n\t\t\t\tif ( elapsed < this.options.mouseHoldDuration )\r\n\t\t\t\t{\r\n\t\t\t\t\t// ignore?\r\n\t\t\t\t\t//console.log(\"mouseDownFor\", elapsed )\r\n\r\n\t\t\t\t\trequestAnimationFrame( waitPatiently )\r\n\t\t\t\t}else if (this.isMouseDown){\r\n\t\t\t\t\t// FIXME\r\n\t\t\t\t\tthis.mouseDownAt = -1\r\n\t\t\t\t\tthis.showForm()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\twaitPatiently()\r\n\t\t\tevent.preventDefault()\r\n\t\t})\r\n\r\n\t\t// FACE has been pressed!\r\n\t\tthis.button.addEventListener( 'mouseup', event => {\r\n\t\t\t// should this trigger something else depending on time?\r\n\t\t\tconst elapsed = this.mouseDownFor\r\n\t\t\t//console.log(\"mouseDownFor\", elapsed )\r\n\r\n\t\t\tif (this.instrumentLoading)\r\n\t\t\t{\r\n\r\n\t\t\t}else{\r\n\t\t\t\tthis.loadInstrument( randomInstrument() )\r\n\t\t\t}\r\n\r\n\t\t\t// and reset\r\n\t\t\tthis.mouseDownAt = -1\r\n\t\t\tevent.preventDefault()\r\n\t\t})\r\n\r\n\t\tthis.button.addEventListener( 'mouseover', event => {\r\n\t\t\tthis.isMouseOver = true\r\n\t\t})\r\n\t\tthis.button.addEventListener( 'mouseout', event => {\r\n\t\t\tthis.isMouseOver = false\r\n\t\t})\r\n\t\t// this.button.addEventListener( 'instrumentchange', event => {\r\n\t\t// \tconsole.log(\"External event for instrument\", event )\r\n\t\t// })\r\n\r\n\t\t\r\n\t\t//console.log(\"Created new person\", this, \"connecting to\", destinationNode )\r\n\t}\r\n\r\n\tget mouseDownFor(){\r\n\t\treturn this.audioContext.currentTime - this.mouseDownAt\r\n\t}\r\n\r\n\tget isMouseDown(){\r\n\t\treturn this.mouseDownAt > -1\r\n\t}\r\n\r\n\tget isMouseHeld(){\r\n\t\treturn this.options.mouseHoldDuration < this.mouseDownFor\r\n\t}\r\n\r\n\tget controlsID (){\r\n\t\treturn `${this.name}-controls`\r\n\t}\r\n\tget controls (){\r\n\t\treturn document.getElementById(this.controlsID)\r\n\t}\r\n\r\n\tget instrumentName(){\r\n\t\treturn this.instrument ? this.instrument.name : 'loading'\r\n\t}\r\n\t\r\n\tget instrumentTitle(){\r\n\t\treturn this.instrument ? this.instrument.title : 'loading'\r\n\t}\r\n\t\r\n\tget instrumentIndex(){\r\n\t\treturn INSTRUMENT_FOLDERS.indexOf(this.instrumentName)\r\n\t}\r\n\r\n\tget hasMIDI(){\r\n\t\treturn this.midi && this.midiChannel\r\n\t}\r\n\r\n\tupdate(prediction){\r\n\t\t\r\n\t\tthis.counter++\r\n\t\tthis.data = prediction\r\n\t}\r\n\r\n\tdraw(prediction, showText=true){\r\n\t\t\r\n\t\tif (!prediction && !this.prediction)\r\n\t\t{\r\n\t\t\t// nothing to refresh so exit here\r\n\t\t\treturn\r\n\r\n\t\t}else if (!prediction){\r\n\t\t\t// refresh\r\n\t\t\tprediction = this.prediction\r\n\t\t}\r\n\t\t\r\n\t\tlet hue = this.hue\r\n\r\n\t\tif (this.instrumentLoading )\r\n\t\t{\r\n\t\t\thue += 120\r\n\t\t}\r\n\r\n\t\tlet saturation = this.saturation\r\n\r\n\t\tconst options = this.options\r\n\r\n\t\t// update colours...\r\n\t\toptions.dots = hue\r\n\t\toptions.mouth = `hsla(${(hue+30)%360},${saturation}%,40%,0.8)`\r\n\t\toptions.mouthClosed = `hsla(${(hue+30)%360},${saturation}%,10%,0.99)`\r\n\t\toptions.lipsUpperInner = `hsla(${(hue+50)%360},${saturation}%,50%,1)`\r\n\t\toptions.lipsLowerInner = `hsla(${(hue+50)%360},${saturation}%,50%,1)`\r\n\t\toptions.midwayBetweenEyes = `hsla(${(hue+270)%360},${saturation}%,50%,1)`\r\n\t\toptions.leftEyeLower0 = `hsla(${(hue+300)%360},${saturation}%,50%,0.8)`\r\n\t\toptions.rightEyeLower0 = `hsla(${(hue+300)%360},${saturation}%,50%,0.8)`\r\n\t\toptions.leftEyeIris = `hsla(${(hue+90)%360},${saturation}%,50%,1)`\r\n\t\toptions.rightEyeIris = `hsla(${(hue+90)%360},${saturation}%,50%,1)`\r\n\r\n\t\t// NB. assumes screen has been previously cleared\t\r\n\t\t// drawBox( prediction )\r\n\t\tdrawPoints( prediction, options.dots, 3, this.instrumentLoading, this.debug )\r\n\r\n\t\tdrawFace( prediction, options, this.singing, this.isMouthOpen, this.debug )\r\n\t\t\r\n\t\t// drawBoundingBox( prediction.boundingBox )\r\n\r\n\t\t// use the eyes?\r\n\t\t\r\n\t\t// if this is mirrored using the option in the TF model...\r\n\t\tconst {bottomRight, topLeft} = prediction.boundingBox\r\n\t\tconst boxWidth = Math.abs(bottomRight[0] - topLeft[0])\r\n\t\tconst boxHeight = Math.abs(bottomRight[1] - topLeft[1])\r\n\t\t\t\r\n\t\t// we only want this every frame or so as this \r\n\t\t// is altering the DOM\r\n\t\tif (this.counter%12===0)\r\n\t\t{\r\n\t\t\t// this.button.style.setProperty('--person-a-x', `${topLeft[0]}` )\r\n\t\t\tthis.button.style.setProperty('--person-a-x', `${bottomRight[0]}` )\r\n\t\t\tthis.button.style.setProperty('--person-a-y', topLeft[1] )\r\n\t\t\tthis.button.style.setProperty('--person-a-w', boxWidth )\r\n\t\t\tthis.button.style.setProperty('--person-a-h', boxHeight )\t\t\t\r\n\t\t}\r\n\r\n\t\t// everything here is for displaying the text\r\n\t\tif (!showText)\r\n\t\t{\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\t// draw silhoette if the user is \r\n\t\t// if you want it to flicker...\r\n\t\t// interacting&& this.counter%2 === 0)\r\n\t\tconst {silhouette} = prediction.annotations\r\n\t\t\t\r\n\t\t if ( this.isMouseOver || this.instrumentLoading ){\r\n\r\n\t\t\t// draw silhoette directly on the canvas or\r\n\t\t\t// SVG shape in the button for hitarea?\r\n\t\t\t// user is interacting...\r\n\t\t\tif (this.isMouseDown && !this.instrumentLoading)\r\n\t\t\t{\r\n\t\t\t\t// user is holding mouse down on user...\r\n\t\t\t\tconst remaining = 1 - this.mouseDownFor / this.options.mouseHoldDuration\r\n\t\t\t\tconst percentageRemaining = 100 - Math.ceil(remaining*100)\r\n\t\t\t\t\r\n\t\t\t\tif (this.isMouseHeld)\r\n\t\t\t\t{\r\n\t\t\t\t\t// user is holding mouse down on user...\r\n\t\t\t\t\tdrawInstrument(prediction.boundingBox, this.instrumentTitle, 'Select')\t\t\t\r\n\t\t\t\t\tdrawPart( silhouette, 4, `hsla(${hue},50%,${percentageRemaining}%,0.3)`, true)\r\n\t\t\t\t\tdrawParagraph(prediction.boundingBox.topLeft[0], prediction.boundingBox.topLeft[1] + 40, [`Press me`], '14px' )\r\n\t\t\t\t}else{\r\n\t\t\t\t\t\r\n\t\t\t\t\tdrawInstrument(prediction.boundingBox, this.instrumentTitle, `${100-percentageRemaining}`)\t\t\t\r\n\t\t\t\t\tdrawPart( silhouette, 4, `hsla(${hue},50%,${percentageRemaining}%,0.5)`, true)\r\n\t\t\t\t\tdrawParagraph(prediction.boundingBox.topLeft[0], prediction.boundingBox.topLeft[1] + 40, [`Hold me to see all instruments`], '14px' )\r\n\t\t\t\t}\r\n\r\n\t\t\t}else{\r\n\t\t\t\t\r\n\t\t\t\t// No mouse held\r\n\t\t\t\tdrawInstrument(prediction.boundingBox, this.instrumentTitle, '')\r\n\t\t\t\tdrawPart( silhouette, 4, 'hsla('+hue+',50%,50%,0.3)', true)\r\n\t\t\t\t/*\t\r\n\t\t\t\tconst offsetX = topLeft[0]\r\n\t\t\t\tconst offsetY = topLeft[1]\r\n\t\t\t\tconst svgCoord = coord => `${boxWidth - (coord[0] - offsetX)} ${(coord[1] - offsetY)}`\r\n\t\t\t\tconst svgPaths = silhouette.map( part => `L${svgCoord(part)}`)\r\n\t\t\t\tconst circles = silhouette.map( part =>{\r\n\t\t\t\t\tconst c = svgCoord(part)\r\n\t\t\t\t\treturn `<circle cx=\"${c[0] - offsetX}\" cy=\"${c[1]}\" r=\"20\" />`\r\n\t\t\t\t})\r\n\t\t\t\t// for outline...+ ` Z`\r\n\t\t\t\tconst svgPath = `M${svgCoord(silhouette[0])} ` + svgPaths.join(\" \")\r\n\t\t\t\t//  height=\"210\" width=\"400\"\r\n\t\t\t\tconst silhoetteShape = \r\n\t\t\t\t`<svg width=\"${boxWidth}\" height=\"${boxHeight}\" viewBox=\"0 0 ${boxWidth} ${boxHeight}\">\r\n\t\t\t\t\t<path d=\"${svgPath}\" />\r\n\t\t\t\t\t${circles.join('')}\r\n\t\t\t\t</svg>`\r\n\t\t\t\t//console.log(\"SVG\",silhouette, silhoetteShape)\r\n\t\t\t\tthis.button.innerHTML = silhoetteShape\t\r\n\t\t\t\t*/\r\n\r\n\t\t\t}\r\n\t\t\r\n\t\t}else if (this.instrumentLoading){\r\n\r\n\t\t\tdrawInstrument(prediction.boundingBox, this.instrumentTitle, 'loading...')\r\n\r\n\t\t}else{\r\n\r\n\t\t\t// Main flow \r\n\t\t\tconst extra = this.debug ? ` ${this.lastNoteName}`  : ` ${this.lastNoteName}`\r\n\r\n\t\t\t// eye:${prediction.eyeDirection}\r\n\t\t\tdrawInstrument(prediction.boundingBox, this.instrumentTitle, extra + (this.singing ? MUSICAL_NOTES[this.counter%(MUSICAL_NOTES.length-1)] : this.isMouthOpen ? '~' : '' )  )\r\n\t\t\tif (this.debug )\r\n\t\t\t{\r\n\t\t\t\tconst paragraphs = [\r\n\t\t\t\t\t`gain:${(this.gainNode.gain.value).toFixed(2)}`, \r\n\t\t\t\t\t`happiness:${(prediction.happiness).toFixed(3)}`, \r\n\t\t\t\t\t`mouthRange:${(prediction.mouthRange).toFixed(3)}`, \r\n\t\t\t\t\t`mouthRatio:${(prediction.mouthRatio).toFixed(3)}`, \r\n\t\t\t\t\t`mouthWidth:${(prediction.mouthWidth).toFixed(3)}`, \r\n\t\t\t\t\t`pitch:${(prediction.pitch).toFixed(3)}`, \r\n\t\t\t\t\t`roll:${(prediction.roll).toFixed(3)}`, \r\n\t\t\t\t\t`yaw:${(prediction.yaw).toFixed(3)}`,\r\n\t\t\t\t\t`eyes:${(prediction.eyeDirection).toFixed(3)}`,\r\n\t\t\t\t\t`mouth:${(prediction.mouthOpen).toFixed(3)}`,\r\n\t\t\t\t\t`dims:${(prediction.mouthWidth).toFixed(2)}x${(prediction.mouthRange).toFixed(2)}`,\r\n\t\t\t\t\t'facing'+prediction.lookingRight ? 'left' : 'right'\r\n\t\t\t\t]\r\n\t\t\t\tdrawParagraph(prediction.boundingBox.topLeft[0], prediction.boundingBox.topLeft[1] + 40, paragraphs, '14px' )\r\n\t\t\t\t// drawText(prediction.boundingBox.topLeft[0], prediction.boundingBox.topLeft[1], extra )\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t// Sing some songs\r\n\tsing(){\r\n\r\n\t\tif (!this.data || this.tracks > MAX_TRACKS)\r\n\t\t{\r\n\t\t\treturn {\r\n\t\t\t\tyaw:0, pitch:0, \r\n\t\t\t\tlipPercentage:0,\r\n\t\t\t\teyeDirection:0\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// only change the note if not active?\r\n\t\tif (active)\r\n\t\t{\r\n\t\t\t// return\r\n\t\t}\r\n\r\n\t\tconst prediction = this.data\r\n\t\tconst options = this.options\r\n\r\n\t\t// do some checks on data to see if an event\r\n\t\t// should be triggered such as eye left / right\r\n\r\n\t\t// we want to ignore the 0-5px range too as inconclusive!\r\n\t\tconst lipPercentage = prediction.mouthOpen\r\n\t\t\r\n\t\t// Controls minor / major\r\n\t\tconst yaw = prediction.yaw\r\n\t\t\r\n\t\t// Octave control by up and down head\r\n\t\tconst pitch = clamp(0.5 * (prediction.pitch + 1), 0,1)\r\n\t\t// const pitch = (prediction.pitch + 1 ) / 2\r\n\t\t\r\n\t\t// -1 => +1 -> convert to \r\n\t\t// ignore < -0.5 and > 0.5\r\n\t\tconst roll = clamp((prediction.roll + 0.5) , 0, 1)\r\n\t\t\r\n\t\t// Controls stereo pan\r\n\t\tconst eyeDirection = clamp(prediction.eyeDirection , -1, 1 )  // (prediction.eyeDirection + 1)/ 2\r\n\r\n\t\t// volume is an log of this\r\n\t\tconst amp = clamp(lipPercentage, 0, 1 ) //- 0.1\r\n\t\tconst logAmp = options.ease(amp)\r\n\t\tconst newOctave = Math.round(pitch * 7)\r\n\r\n\t\t// octave needs to be up or down from existing?\r\n\t\tthis.octave = newOctave\r\n\r\n\t\t// FIXME: if we don't want the happy notes...\r\n\t\t// we can flip this on somehow?\r\n\t\tconst isMinor = prediction.lookingRight\r\n\r\n\t\tconst noteName = getNoteName(roll, this.octave, isMinor)\r\n\r\n\t\tthis.lastNoteName = noteName\r\n\t\tthis.hue = roll * 360\r\n\t\tthis.saturation = 100 * lipPercentage\r\n\r\n\r\n\t\t\r\n\t\t// console.log(\"Person\", prediction.yaw , yaw)\r\n\t\t// // console.log(\"Person\", {lipPercentage, yaw, pitch, amp, logAmp})\r\n\r\n\t\tthis.stereoNode.pan.value = eyeDirection\r\n\t\t//this.stereoNode.pan.setValueAtTime(panControl.value, this.audioContext.currentTime);\r\n\t\t\r\n\t\t// you want the scale to be from 0-1 but from 03-1\r\n\t\tlet newVolume\r\n\r\n\t\t// !active && active is updated by playback state\r\n\t\tif ( this.instrument && amp >= options.mouthCutOff )\r\n\t\t{\r\n\t\t\t// here is where we need to do our majic\r\n\t\t\t// play a note from the collectionlogAmp\r\n\t\t\tconst note = this.instrument[ noteName ]\r\n\r\n\t\t\tif (!note){\r\n\t\t\t\tconsole.log(\"note not found!\", {noteName, roll, octave:this.octave, isMinor})\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// TODO: add velocity logAmp\r\n\t\t\tthis.tracks++\r\n\t\t\tconst track = playTrack( note, 0, this.stereoNode ).then( ()=>{\r\n\t\t\t\tthis.active = false\r\n\t\t\t\tthis.tracks--\r\n\t\t\t\t//console.log(\"Sample completed playback... request tock\", this.tracks )\r\n\t\t\t})\r\n\t\t\t\r\n\t\t\t// rescale for 0.3->1\r\n\t\t\tnewVolume = this.mouthScale( amp )\r\n\t\t\t// curve\r\n\t\t\tnewVolume = options.ease(newVolume)\r\n\t\t\t// smooth\r\n\t\t\tnewVolume = Math.round( newVolume * this.precision ) / this.precision \r\n\t\t\t\r\n\t\t\t// newVolume = Math.round( newVolume * options.precision * 10 ) / (options.precision * 10) \r\n\t\t\t// newVolume = parseFloat( newVolume.toFixed( options.precision)) \r\n\t\t\t\r\n\t\t\t// send out some MIDI yum yum noteName && \r\n\t\t\tif (this.hasMIDI)\r\n\t\t\t// if (this.hasMIDI && !this.active)\r\n\t\t\t{\r\n\t\t\t\t// duration: 2000,\r\n\t\t\t\t// https://github.com/djipco/webmidi/blob/develop/src/Output.js\r\n\t\t\t\t//console.log(\"MIDI\",amp, noteNumber, INSTRUMENT_NAMES.length, noteName, this.midiChannel)\r\n\t\t\t\tconst midiOptions = { \r\n\t\t\t\t\tchannels:this.midiChannel,\r\n\t\t\t\t\tattack:amp\r\n\t\t\t\t}\r\n\t\t\t\tthis.midi.playNote( noteName, midiOptions )\r\n\t\t\t\tthis.midiActive = true\r\n\t\t\t\t\r\n\t\t\t\t// /console.log(\"MIDI noteOn\", noteName, \"Channel:\"+this.midiChannel, {midiOptions, channel:this.midiChannel, hasMIDI:this.hasMIDI} )\r\n\r\n\t\t\t}else{\r\n\t\t\t\t// add connect midi device note?\r\n\t\t\t}\r\n\r\n\t\t\tthis.singing = true\r\n\t\t\tthis.isMouthOpen = true\r\n\t\t\tthis.active = true\r\n\t\t\t\r\n\t\t}else if ( amp > options.mouthSilence && amp < options.mouthCutOff ){\r\n\r\n\t\t\t// this.gainNode.gain.value = 0\r\n\t\t\t//const destinationVolume  = 0 // logAmp\r\n\t\t\t\r\n\t\t\t// newVolume = this.gainNode.gain.value + (destinationVolume - this.gainNode.gain.value) * options.volumeRate\r\n\t\t\tnewVolume = 0\r\n\t\t\tthis.singing = false\r\n\t\t\tthis.isMouthOpen = true\r\n\r\n\t\t}else{\r\n\r\n\t\t\t// no instrument available or mouth totally closed\r\n\t\t\tnewVolume = 0\r\n\t\t\tthis.singing = false\r\n\t\t\tthis.isMouthOpen = false\r\n\t\t\t// no instruments in memory yet... play silence?\r\n\t\t\tif (this.hasMIDI)\r\n\t\t\t{\r\n\t\t\t\tthis.midi.stopNote(noteName)\r\n\t\t\t\tthis.midiActive = false\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Midi pitch bending with eyes!\r\n\t\tif (this.hasMIDI && eyeDirection !== 0)\r\n\t\t{\r\n\t\t\tthis.midi.setPitchBend( eyeDirection )\r\n\t\t}\r\n\r\n\r\n// WebMidi.outputs[0].channels[1].stopNote(\"C3\", {time: \"+2500\"});\r\n\r\n// // Set polyphonic aftertouch : Send polyphonic aftertouch message to channel 8\r\n\r\n// WebMidi.outputs[0].channels[8].setKeyAftertouch(\"B#3\", 0.25);\r\n\r\n// // Set pitch bend value : The value is between -1 and 1 (a value of 0 means no bend).\r\n\r\n// WebMidi.outputs[0].channels[8].setPitchBend(-0.25);\r\n\r\n\t\t// try and smooth the volume if it is fading out...\r\n\t\t// if ( this.gainNode.gain.value > newVolume)\r\n\t\t// {\r\n\t\t// \t// volume decrease fades\r\n\t\t\tthis.gainNode.gain.value = this.gainNode.gain.value + (newVolume - this.gainNode.gain.value) * options.volumeRate\r\n\t\t\r\n\t\t// }else{\r\n\r\n\t\t// \tthis.gainNode.gain.value = this.gainNode.gain.value + (newVolume - this.gainNode.gain.value) * 0.9\r\n\t\t// \t// volume in direct\r\n\t\t// \t// this.gainNode.gain.value = newVolume\r\n\t\t// }\r\n\t\t// this.gainNode.gain.value = newVolume\r\n\t\t//console.log(\"Gain\", this.gainNode.gain.value, \"newVolume\", newVolume, \"Precision\", this.precision )\r\n\t\t\r\n\t\tthis.yaw = yaw\r\n\t\tthis.pitch = pitch\r\n\t\tthis.roll = roll\r\n\r\n\t\treturn {\r\n\t\t\tyaw, pitch, roll,\r\n\t\t\tlipPercentage,\r\n\t\t\teyeDirection\r\n\t\t}\r\n\t}\r\n\r\n\tasync loadRandomInstrument(callback){\r\n\t\treturn await this.loadInstrument( randomInstrument(), callback )\r\n\t}\r\n\r\n\tasync loadPreviousInstrument(callback){\r\n\t\tconst index = this.index\r\n\t\tconst newIndex = index-1 < 0 ? 0 : index-1\r\n\t\treturn await this.loadInstrument( INSTRUMENT_FOLDERS[newIndex], callback )\r\n\t}\r\n\r\n\tasync loadNextInstrument(callback){\r\n\t\tconst index = this.index\r\n\t\tconst newIndex = index+1 >= INSTRUMENT_FOLDERS.length ? 0 : index+1\r\n\t\treturn await this.loadInstrument( INSTRUMENT_FOLDERS[newIndex], callback )\r\n\t}\r\n\r\n\t// we need loadiing events?\r\n\tasync loadInstrument(instrumentName, callback){\r\n\t\tthis.instrumentLoading = true\r\n\t\tthis.instrument = await loadInstrument( instrumentName )\r\n\t\tthis.instrumentLoading = false\r\n\t\tcallback && callback( instrumentName )\r\n\t\t\r\n\t\t// you have to dispatch the event from an element!\r\n\t\tthis.button.dispatchEvent(new CustomEvent(\"instrumentchange\", {\r\n\t\t\tdetail: { instrument:this.instrument, instrumentName }\r\n\t\t}))\r\n\r\n\t\treturn instrumentName\r\n\t}\r\n\r\n\tsetMIDI(midi, channel=\"all\"){\r\n\t\tthis.midiChannel = channel\r\n\t\tthis.midi = midi\r\n\t\tconsole.log(\"MIDI set for person\", this, \"Channel:\"+this.midiChannel, {midi,channel, hasMIDI:this.hasMIDI } )\r\n\t}\r\n\r\n\t// Instrument selected from the DOM UI face click\r\n\tonInstrumentInput(event) {\r\n\t\tconst id = event.target.id\r\n\t\t//console.error(id, \"on inputted\", event)\r\n\t\tthis.hideForm()\r\n\t\tthis.loadInstrument(id)\r\n\t\tevent.preventDefault()\r\n\t}\r\n\r\n\tshowForm(){\r\n\r\n\t\t//console.log(\"showForm\", this.controlsID, this.controls)\r\n\r\n\t\tthis.controls.innerHTML = setupInstrumentForm( ()=> {})\r\n\t\tconst inputs = this.controls.querySelectorAll('input')\r\n\t\tinputs.forEach( input => input.addEventListener('change', event => this.onInstrumentInput(event) ), false)\r\n\t\t\r\n\t\t// find active input field and focus\r\n\t\tconst active = document.getElementById(this.instrumentName)\r\n\t\tif (active)\r\n\t\t{\r\n\t\t\tactive.focus()\r\n\t\t}else{\r\n\t\t\t// send focus to form\r\n\t\t\tthis.controls.focus()\r\n\t\t}\r\n\t\t// this.controls.classList.toggle(\"showing\",true)\r\n\t}\r\n\r\n\thideForm(){\r\n\t\t//const inputs = this.controls.querySelectorAll('input')\r\n\t\t//inputs.forEach( input => input.removeEventListener('change',  this.onInstrumentInput))\r\n\t\tthis.controls.innerHTML = ''\r\n\t}\r\n}","import Analytics from 'analytics'\r\nimport googleAnalytics from '@analytics/google-analytics'\r\n \r\n\r\nlet analytics\r\n\r\nexport const setupReporting = (name=\"Interface\", id=\"G-1XT0GV0L6J\") => {\r\n\tanalytics = Analytics({\r\n\t\tapp: name,\r\n\t\tplugins: [\r\n\t\t\tgoogleAnalytics({\r\n\t\t\t\ttrackingId:id\r\n\t\t\t})\r\n\t\t]\r\n\t})\r\n\t\r\n\t// Track a page view \r\n\tanalytics.page()\r\n\t\r\n\treturn analytics\r\n\t\r\n\r\n\t// // Track a custom event \r\n\t// analytics.track('playedVideo', {\r\n\t// \tcategory: 'Videos',\r\n\t// \tlabel: 'Fall Campaign',\r\n\t// \tvalue: 42\r\n\t// })\r\n\t\r\n\t// // Identify a visitor\r\n\t// analytics.identify('user-id-xyz', {\r\n\t// \tfirstName: 'bill',\r\n\t// \tlastName: 'murray'\r\n\t// })\t\r\n}\r\n\r\nexport const track = (name, data) => {\r\n\tif (analytics)\r\n\t{\r\n\t\tanalytics.track(name, data)\t\t\r\n\t}\r\n}\r\nexport const trackExit = () => {\r\n\t\r\n\t// // Track a custom event \r\n\t// analytics.track('playedVideo', {\r\n\t// \tcategory: 'Videos',\r\n\t// \tlabel: 'Fall Campaign',\r\n\t// \tvalue: 42\r\n\t// })\r\n}\r\n\r\nexport const trackError = (error, code=42, category=\"Fails\") =>{ \r\n\tif (analytics)\r\n\t{\r\n\t\tanalytics.track('Error', {\r\n\t\t\tcategory:category,\r\n\t\t\tlabel:error,\r\n\t\t\tvalue:code\r\n\t\t})\t\t\r\n\t}\r\n}","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nfunction _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }\n\nvar analytics = require('@analytics/core');\nvar analytics__default = _interopDefault(analytics);\nvar storage = _interopDefault(require('@analytics/storage-utils'));\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar defineProperty = _defineProperty;\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(source, true).forEach(function (key) {\n        defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(source).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nvar objectSpread2 = _objectSpread2;\n\nfunction analyticsLib() {\n  var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var defaultSettings = {\n    storage: storage\n  };\n  return analytics__default(objectSpread2(objectSpread2({}, defaultSettings), opts));\n}\n\nexports.EVENTS = analytics.EVENTS;\nexports.CONSTANTS = analytics.CONSTANTS;\nexports.default = analyticsLib;\nexports.init = analyticsLib;\nexports.Analytics = analyticsLib;\n","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar analyticsUtils = require('analytics-utils');\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nvar arrayWithoutHoles = _arrayWithoutHoles;\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nvar iterableToArray = _iterableToArray;\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nvar nonIterableSpread = _nonIterableSpread;\n\nfunction _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || nonIterableSpread();\n}\n\nvar toConsumableArray = _toConsumableArray;\n\nfunction createCommonjsModule(fn, module) {\n\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n}\n\nvar _typeof_1 = createCommonjsModule(function (module) {\nfunction _typeof2(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof2 = function _typeof2(obj) { return typeof obj; }; } else { _typeof2 = function _typeof2(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof2(obj); }\n\nfunction _typeof(obj) {\n  if (typeof Symbol === \"function\" && _typeof2(Symbol.iterator) === \"symbol\") {\n    module.exports = _typeof = function _typeof(obj) {\n      return _typeof2(obj);\n    };\n  } else {\n    module.exports = _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : _typeof2(obj);\n    };\n  }\n\n  return _typeof(obj);\n}\n\nmodule.exports = _typeof;\n});\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar defineProperty = _defineProperty;\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(source, true).forEach(function (key) {\n        defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(source).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nvar objectSpread2 = _objectSpread2;\n\nvar FUNC = 'function';\nvar UNDEF = 'undefined';\nvar REDUCER = 'reducer';\nvar base = '@@redux/';\nvar ACTION_INIT = base + 'INIT';\nvar ACTION_TEST = base + Math.random().toString(36);\n\nvar $$observable =\n/* #__PURE__ */\nfunction () {\n  return (typeof Symbol === \"undefined\" ? \"undefined\" : _typeof_1(Symbol)) === FUNC && Symbol.observable || '@@observable';\n}();\n/*\n * Creates a Redux store that holds the state tree.\n * The only way to change the data in the store is to call `dispatch()` on it.\n *\n * There should only be a single store in your app. To specify how different\n * parts of the state tree respond to actions, you may combine several reducers\n * into a single reducer function by using `combineReducers`.\n *\n * @param {Function} reducer A function that returns the next state tree, given\n * the current state tree and the action to handle.\n *\n * @param {any} [preloadedState] The initial state. You may optionally specify it\n * to hydrate the state from the server in universal apps, or to restore a\n * previously serialized user session.\n * If you use `combineReducers` to produce the root reducer function, this must be\n * an object with the same shape as `combineReducers` keys.\n *\n * @param {Function} [enhancer] The store enhancer. You may optionally specify it\n * to enhance the store with third-party capabilities such as middleware,\n * time travel, persistence, etc. The only store enhancer that ships with Redux\n * is `applyMiddleware()`.\n *\n * @returns {Store} A Redux store that lets you read the state, dispatch actions\n * and subscribe to changes.\n */\n\n\nvar msg = ' != ' + FUNC;\nfunction createStore(reducer, preloadedState, enhancer) {\n  if (_typeof_1(preloadedState) === FUNC && _typeof_1(enhancer) === UNDEF) {\n    enhancer = preloadedState;\n    preloadedState = undefined;\n  }\n\n  if (_typeof_1(enhancer) !== UNDEF) {\n    if (_typeof_1(enhancer) !== FUNC) {\n      throw new Error('enhancer' + msg);\n    }\n\n    return enhancer(createStore)(reducer, preloadedState);\n  }\n\n  if (_typeof_1(reducer) !== FUNC) {\n    throw new Error(REDUCER + msg);\n  }\n\n  var currentReducer = reducer;\n  var currentState = preloadedState;\n  var currentListeners = [];\n  var nextListeners = currentListeners;\n  var isDispatching = false;\n\n  function ensureCanMutateNextListeners() {\n    if (nextListeners === currentListeners) {\n      nextListeners = currentListeners.slice();\n    }\n  }\n  /*\n   * Reads the state tree managed by the store.\n   *\n   * @returns {any} The current state tree of your application.\n   */\n\n\n  function getState() {\n    return currentState;\n  }\n  /*\n   * Adds a change listener. It will be called any time an action is dispatched,\n   * and some part of the state tree may potentially have changed. You may then\n   * call `getState()` to read the current state tree inside the callback.\n   *\n   * You may call `dispatch()` from a change listener, with the following\n   * caveats:\n   *\n   * 1. The subscriptions are snapshotted just before every `dispatch()` call.\n   * If you subscribe or unsubscribe while the listeners are being invoked, this\n   * will not have any effect on the `dispatch()` that is currently in progress.\n   * However, the next `dispatch()` call, whether nested or not, will use a more\n   * recent snapshot of the subscription list.\n   *\n   * 2. The listener should not expect to see all state changes, as the state\n   * might have been updated multiple times during a nested `dispatch()` before\n   * the listener is called. It is, however, guaranteed that all subscribers\n   * registered before the `dispatch()` started will be called with the latest\n   * state by the time it exits.\n   *\n   * @param {Function} listener A callback to be invoked on every dispatch.\n   * @returns {Function} A function to remove this change listener.\n   */\n\n\n  function subscribe(listener) {\n    if (_typeof_1(listener) !== FUNC) {\n      throw new Error('Listener' + msg);\n    }\n\n    var isSubscribed = true;\n    ensureCanMutateNextListeners();\n    nextListeners.push(listener);\n    return function unsubscribe() {\n      if (!isSubscribed) {\n        return;\n      }\n\n      isSubscribed = false;\n      ensureCanMutateNextListeners();\n      var index = nextListeners.indexOf(listener);\n      nextListeners.splice(index, 1);\n    };\n  }\n  /**\n   * Dispatches an action. It is the only way to trigger a state change.\n   *\n   * The `reducer` function, used to create the store, will be called with the\n   * current state tree and the given `action`. Its return value will\n   * be considered the **next** state of the tree, and the change listeners\n   * will be notified.\n   *\n   * The base implementation only supports plain object actions. If you want to\n   * dispatch a Promise, an Observable, a thunk, or something else, you need to\n   * wrap your store creating function into the corresponding middleware. For\n   * example, see the documentation for the `redux-thunk` package. Even the\n   * middleware will eventually dispatch plain object actions using this method.\n   *\n   * @param {Object} action A plain object representing “what changed”. It is\n   * a good idea to keep actions serializable so you can record and replay user\n   * sessions, or use the time travelling `redux-devtools`. An action must have\n   * a `type` property which may not be `undefined`. It is a good idea to use\n   * string constants for action types.\n   *\n   * @returns {Object} For convenience, the same action object you dispatched.\n   *\n   * Note that, if you use a custom middleware, it may wrap `dispatch()` to\n   * return something else (for example, a Promise you can await).\n   */\n\n\n  function dispatch(action) {\n    if (!analyticsUtils.isObject(action)) {\n      throw new Error('Act != obj');\n    }\n\n    if (_typeof_1(action.type) === UNDEF) {\n      throw new Error('ActType ' + UNDEF);\n    }\n\n    if (isDispatching) {\n      throw new Error('Dispatch in ' + REDUCER);\n    }\n\n    try {\n      isDispatching = true;\n      currentState = currentReducer(currentState, action);\n    } finally {\n      isDispatching = false;\n    }\n\n    var listeners = currentListeners = nextListeners;\n\n    for (var i = 0; i < listeners.length; i++) {\n      var listener = listeners[i];\n      listener();\n    }\n\n    return action;\n  }\n  /**\n   * Replaces the reducer currently used by the store to calculate the state.\n   *\n   * You might need this if your app implements code splitting and you want to\n   * load some of the reducers dynamically. You might also need this if you\n   * implement a hot reloading mechanism for Redux.\n   *\n   * @param {Function} nextReducer The reducer for the store to use instead.\n   * @returns {void}\n   */\n\n\n  function replaceReducer(nextReducer) {\n    if (_typeof_1(nextReducer) !== FUNC) {\n      throw new Error('next ' + REDUCER + msg);\n    }\n\n    currentReducer = nextReducer;\n    dispatch({\n      type: ACTION_INIT\n    });\n  }\n  /**\n   * Interoperability point for observable/reactive libraries.\n   * @returns {observable} A minimal observable of state changes.\n   * For more information, see the observable proposal:\n   * https://github.com/tc39/proposal-observable\n   */\n\n\n  function observable() {\n    var outerSubscribe = subscribe;\n    return defineProperty({\n      /*\n       * The minimal observable subscription method.\n       * @param {Object} observer Any object that can be used as an observer.\n       * The observer object should have a `next` method.\n       * @returns {subscription} An object with an `unsubscribe` method that can\n       * be used to unsubscribe the observable from the store, and prevent further\n       * emission of values from the observable.\n       */\n      subscribe: function subscribe(observer) {\n        if (_typeof_1(observer) !== 'object') {\n          throw new TypeError('Observer != obj');\n        }\n\n        function observeState() {\n          if (observer.next) {\n            observer.next(getState());\n          }\n        }\n\n        observeState();\n        var unsubscribe = outerSubscribe(observeState);\n        return {\n          unsubscribe: unsubscribe\n        };\n      }\n    }, $$observable, function () {\n      return this;\n    });\n  } // When a store is created, an \"INIT\" action is dispatched so that every\n  // reducer returns their initial state. This effectively populates\n  // the initial state tree.\n\n\n  dispatch({\n    type: ACTION_INIT\n  });\n  return defineProperty({\n    dispatch: dispatch,\n    subscribe: subscribe,\n    getState: getState,\n    replaceReducer: replaceReducer\n  }, $$observable, observable);\n}\n\nfunction getUndefinedStateErrorMessage(key, action) {\n  var actionType = action && action.type;\n  var actionName = actionType && actionType.toString() || '?';\n  return 'action ' + actionName + REDUCER + ' ' + key + ' returns ' + UNDEF;\n}\n\nfunction assertReducerShape(reducers) {\n  Object.keys(reducers).forEach(function (key) {\n    var reducer = reducers[key];\n    var initialState = reducer(undefined, {\n      type: ACTION_INIT\n    });\n\n    if (_typeof_1(initialState) === UNDEF || _typeof_1(reducer(undefined, {\n      type: ACTION_TEST\n    })) === UNDEF) {\n      throw new Error(REDUCER + ' ' + key + ' ' + UNDEF);\n    }\n  });\n}\n/**\n * Turns an object whose values are different reducer functions, into a single\n * reducer function. It will call every child reducer, and gather their results\n * into a single state object, whose keys correspond to the keys of the passed\n * reducer functions.\n *\n * @param {Object} reducers An object whose values correspond to different\n * reducer functions that need to be combined into one. One handy way to obtain\n * it is to use ES6 `import * as reducers` syntax. The reducers may never return\n * undefined for any action. Instead, they should return their initial state\n * if the state passed to them was undefined, and the current state for any\n * unrecognized action.\n *\n * @returns {Function} A reducer function that invokes every reducer inside the\n * passed object, and builds a state object with the same shape.\n */\n\n\nfunction combineReducers(reducers) {\n  var reducerKeys = Object.keys(reducers);\n  var finalReducers = {};\n\n  for (var i = 0; i < reducerKeys.length; i++) {\n    var key = reducerKeys[i];\n\n    if (_typeof_1(reducers[key]) === FUNC) {\n      finalReducers[key] = reducers[key];\n    }\n  }\n\n  var finalReducerKeys = Object.keys(finalReducers);\n\n  var shapeAssertionError;\n\n  try {\n    assertReducerShape(finalReducers);\n  } catch (e) {\n    shapeAssertionError = e;\n  }\n\n  return function combination() {\n    var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    var action = arguments.length > 1 ? arguments[1] : undefined;\n\n    if (shapeAssertionError) {\n      throw shapeAssertionError;\n    }\n\n    var hasChanged = false;\n    var nextState = {};\n\n    for (var _i = 0; _i < finalReducerKeys.length; _i++) {\n      var _key = finalReducerKeys[_i];\n      var reducer = finalReducers[_key];\n      var previousStateForKey = state[_key];\n      var nextStateForKey = reducer(previousStateForKey, action);\n\n      if (_typeof_1(nextStateForKey) === UNDEF) {\n        var errorMessage = getUndefinedStateErrorMessage(_key, action);\n        throw new Error(errorMessage);\n      }\n\n      nextState[_key] = nextStateForKey;\n      hasChanged = hasChanged || nextStateForKey !== previousStateForKey;\n    }\n\n    return hasChanged ? nextState : state;\n  };\n}\n\nfunction compose() {\n  for (var _len = arguments.length, funcs = new Array(_len), _key = 0; _key < _len; _key++) {\n    funcs[_key] = arguments[_key];\n  }\n\n  if (funcs.length === 0) {\n    return function (arg) {\n      return arg;\n    };\n  }\n\n  if (funcs.length === 1) {\n    return funcs[0];\n  }\n\n  return funcs.reduce(function (a, b) {\n    return function () {\n      return a(b.apply(void 0, arguments));\n    };\n  });\n}\n\n/**\n * Creates a store enhancer that applies middleware to the dispatch method\n * of the Redux store. This is handy for a variety of tasks, such as expressing\n * asynchronous actions in a concise manner, or logging every action payload.\n *\n * See `redux-thunk` package as an example of the Redux middleware.\n *\n * Because middleware is potentially asynchronous, this should be the first\n * store enhancer in the composition chain.\n *\n * Note that each middleware will be given the `dispatch` and `getState` functions\n * as named arguments.\n *\n * @param {...Function} middlewares The middleware chain to be applied.\n * @returns {Function} A store enhancer applying the middleware.\n */\n\nfunction applyMiddleware() {\n  for (var _len = arguments.length, middlewares = new Array(_len), _key = 0; _key < _len; _key++) {\n    middlewares[_key] = arguments[_key];\n  }\n\n  return function (createStore) {\n    return function (reducer, preloadedState, enhancer) {\n      var store = createStore(reducer, preloadedState, enhancer);\n      var _dispatch = store.dispatch;\n      var chain = [];\n      var middlewareAPI = {\n        getState: store.getState,\n        dispatch: function dispatch(action) {\n          return _dispatch(action);\n        }\n      };\n      chain = middlewares.map(function (middleware) {\n        return middleware(middlewareAPI);\n      });\n      _dispatch = compose.apply(void 0, toConsumableArray(chain))(store.dispatch);\n      return objectSpread2(objectSpread2({}, store), {}, {\n        dispatch: _dispatch\n      });\n    };\n  };\n}\n\nvar coreEvents = [\n/**\n * `bootstrap` - Fires when analytics library starts up.\n * This is the first event fired. '.on/once' listeners are not allowed on bootstrap\n * Plugins can attach logic to this event\n */\n'bootstrap',\n/**\n * `params` - Fires when analytics parses URL parameters\n */\n'params',\n/**\n * `campaign` - Fires if params contain \"utm\" parameters\n */\n'campaign',\n/**\n * `initializeStart` - Fires before 'initialize', allows for plugins to cancel loading of other plugins\n */\n'initializeStart',\n/**\n * `initialize` - Fires when analytics loads plugins\n */\n'initialize',\n/**\n * `initializeEnd` - Fires after initialize, allows for plugins to run logic after initialization methods run\n */\n'initializeEnd',\n/**\n * `ready` - Fires when all analytic providers are fully loaded. This waits for 'initialize' and 'loaded' to return true\n */\n'ready',\n/**\n * `resetStart` - Fires if analytic.reset() is called.\n * Use this event to cancel reset based on a specific condition\n */\n'resetStart',\n/**\n * `reset` - Fires if analytic.reset() is called.\n * Use this event to run custom cleanup logic (if needed)\n */\n'reset',\n/**\n * `resetEnd` - Fires after analytic.reset() is called.\n * Use this event to run a callback after user data is reset\n */\n'resetEnd',\n/******************\n * Page Events\n ******************/\n\n/**\n * `pageStart` - Fires before 'page' events fire.\n *  This allows for dynamic page view cancellation based on current state of user or options passed in.\n */\n'pageStart',\n/**\n * `page` - Core analytics hook for page views.\n *  If your plugin or integration tracks page views, this is the event to fire on.\n */\n'page',\n/**\n * `pageEnd` - Fires after all registered 'page' methods fire.\n */\n'pageEnd',\n/**\n * `pageAborted` - Fires if 'page' call is cancelled by a plugin\n */\n'pageAborted',\n/****************\n * Track Events\n ***************/\n\n/**\n * `trackStart` - Called before the 'track' events fires.\n *  This allows for dynamic page view cancellation based on current state of user or options passed in.\n */\n'trackStart',\n/**\n * `track` - Core analytics hook for event tracking.\n *  If your plugin or integration tracks custom events, this is the event to fire on.\n */\n'track',\n/**\n * `trackEnd` - Fires after all registered 'track' events fire from plugins.\n */\n'trackEnd',\n/**\n * `trackAborted` - Fires if 'track' call is cancelled by a plugin\n */\n'trackAborted',\n/******************\n * Identify Events\n ******************/\n\n/**\n * `identifyStart` - Called before the 'identify' events fires.\n * This allows for dynamic page view cancellation based on current state of user or options passed in.\n */\n'identifyStart',\n/**\n * `identify` - Core analytics hook for user identification.\n *  If your plugin or integration identifies users or user traits, this is the event to fire on.\n */\n'identify',\n/**\n * `identifyEnd` - Fires after all registered 'identify' events fire from plugins.\n */\n'identifyEnd',\n/**\n * `identifyAborted` - Fires if 'track' call is cancelled by a plugin\n */\n'identifyAborted',\n/**\n * `userIdChanged` - Fires when a user id is updated\n */\n'userIdChanged',\n/******************\n * Plugin Events\n ******************/\n\n/**\n * `registerPlugins` - Fires when analytics is registering plugins\n */\n'registerPlugins',\n/**\n * `enablePlugin` - Fires when 'analytics.plugins.enable()' is called\n */\n'enablePlugin',\n/**\n * `disablePlugin` - Fires when 'analytics.plugins.disable()' is called\n */\n'disablePlugin',\n/*\n * `loadPlugin` - Fires when 'analytics.loadPlugin()' is called\n */\n// 'loadPlugin',\n\n/******************\n * Browser activity events\n ******************/\n\n/**\n * `online` - Fires when browser network goes online.\n * This fires only when coming back online from an offline state.\n */\n'online',\n/**\n * `offline` - Fires when browser network goes offline.\n */\n'offline',\n/******************\n * Storage events\n ******************/\n\n/**\n * `setItemStart` - Fires when analytics.storage.setItem is initialized.\n * This event gives plugins the ability to intercept keys & values and alter them before they are persisted.\n */\n'setItemStart',\n/**\n * `setItem` - Fires when analytics.storage.setItem is called.\n * This event gives plugins the ability to intercept keys & values and alter them before they are persisted.\n */\n'setItem',\n/**\n * `setItemEnd` - Fires when setItem storage is complete.\n */\n'setItemEnd',\n/**\n * `setItemAborted` - Fires when setItem storage is cancelled by a plugin.\n */\n'setItemAborted',\n/**\n * `removeItemStart` - Fires when analytics.storage.removeItem is initialized.\n * This event gives plugins the ability to intercept removeItem calls and abort / alter them.\n */\n'removeItemStart',\n/**\n * `removeItem` - Fires when analytics.storage.removeItem is called.\n * This event gives plugins the ability to intercept removeItem calls and abort / alter them.\n */\n'removeItem',\n/**\n * `removeItemEnd` - Fires when removeItem storage is complete.\n */\n'removeItemEnd',\n/**\n * `removeItemAborted` - Fires when removeItem storage is cancelled by a plugin.\n */\n'removeItemAborted'];\n/* Keys on a plugin that are not considered events */\n\nvar nonEvents = ['name', 'EVENTS', 'config', 'loaded'];\nvar pluginEvents = {\n  registerPluginType: function registerPluginType(name) {\n    return \"registerPlugin:\".concat(name);\n  },\n  pluginReadyType: function pluginReadyType(name) {\n    return \"ready:\".concat(name);\n  }\n};\nvar EVENTS = coreEvents.reduce(function (acc, curr) {\n  acc[curr] = curr;\n  return acc;\n}, pluginEvents);\nfunction isReservedAction(type) {\n  return coreEvents.includes(type);\n}\n\n/**\n * Anonymous visitor Id localstorage key\n * @typedef {String} ANON_ID\n */\nvar ANON_ID = '__anon_id';\n/**\n * Visitor Id localstorage key\n * @typedef {String} USER_ID\n */\n\nvar USER_ID = '__user_id';\n/**\n * Visitor traits localstorage key\n * @typedef {String} USER_TRAITS\n */\n\nvar USER_TRAITS = '__user_traits';\n\nvar constants = /*#__PURE__*/Object.freeze({\n  ANON_ID: ANON_ID,\n  USER_ID: USER_ID,\n  USER_TRAITS: USER_TRAITS\n});\n\nvar utmRegex = /^utm_/;\nvar propRegex = /^an_prop_/;\nvar traitRegex = /^an_trait_/; // Middleware runs during EVENTS.initialize\n\nfunction initializeMiddleware(instance) {\n  var _instance$storage = instance.storage,\n      setItem = _instance$storage.setItem,\n      getItem = _instance$storage.getItem;\n  return function (store) {\n    return function (next) {\n      return function (action) {\n        /* Handle bootstrap event */\n        if (action.type === EVENTS.bootstrap) {\n          var params = action.params,\n              user = action.user;\n          /* 1. Set anonymous ID. TODO move UUID generation to main function. To fix race conditions */\n\n          if (!getItem(ANON_ID)) {\n            setItem(ANON_ID, user.anonymousId);\n          }\n          /* 2. Parse url params */\n\n\n          var paramsArray = Object.keys(action.params);\n\n          if (paramsArray.length) {\n            var an_uid = params.an_uid,\n                an_event = params.an_event;\n            var groupedParams = paramsArray.reduce(function (acc, key) {\n              // match utm params & dclid (display) & gclid (cpc)\n              if (key.match(utmRegex) || key.match(/^(d|g)clid/)) {\n                var cleanName = key.replace(utmRegex, '');\n                var keyName = cleanName === 'campaign' ? 'name' : cleanName;\n                acc.campaign[keyName] = params[key];\n              }\n\n              if (key.match(propRegex)) {\n                acc.props[key.replace(propRegex, '')] = params[key];\n              }\n\n              if (key.match(traitRegex)) {\n                acc.traits[key.replace(traitRegex, '')] = params[key];\n              }\n\n              return acc;\n            }, {\n              campaign: {},\n              props: {},\n              traits: {}\n            });\n            store.dispatch(objectSpread2(objectSpread2({\n              type: EVENTS.params,\n              raw: params\n            }, groupedParams), an_uid ? {\n              userId: an_uid\n            } : {}));\n            /* If userId set, call identify */\n\n            if (an_uid) {\n              // timeout to debounce and make sure integration is registered. Todo refactor\n              setTimeout(function () {\n                return instance.identify(an_uid, groupedParams.traits);\n              }, 0);\n            }\n            /* If tracking event set, call track */\n\n\n            if (an_event) {\n              // timeout to debounce and make sure integration is registered. Todo refactor\n              setTimeout(function () {\n                return instance.track(an_event, groupedParams.props);\n              }, 0);\n            } // if url has utm params\n\n\n            if (Object.keys(groupedParams.campaign).length) {\n              store.dispatch({\n                type: EVENTS.campaign,\n                campaign: groupedParams.campaign\n              });\n            }\n          }\n        }\n\n        return next(action);\n      };\n    };\n  };\n}\n\nvar LIBRARY_NAME = 'analytics';\nvar ID = 'userId';\nvar ANONID = 'anonymousId';\nvar ERROR_URL = 'https://lytics.dev/errors/';\n\n/* user reducer */\n\nfunction userReducer(storage) {\n  return function user() {\n    var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    var action = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    if (action.type === EVENTS.setItemEnd) {\n      // Set anonymousId if changed by storage.setItem\n      if (action.key === ANON_ID) {\n        return objectSpread2(objectSpread2({}, state), {\n          anonymousId: action.value\n        });\n      } // Set userId if changed by storage.setItem\n\n\n      if (action.key === USER_ID) {\n        return objectSpread2(objectSpread2({}, state), {\n          userId: action.value\n        });\n      }\n    }\n\n    switch (action.type) {\n      case EVENTS.identify:\n        return Object.assign({}, state, {\n          userId: action.userId,\n          traits: objectSpread2(objectSpread2({}, state.traits), action.traits)\n        });\n\n      case EVENTS.reset:\n        // Side effect to fix race condition in Node. TODO refactor\n        [ID, ANONID, 'traits'].forEach(function (key) {\n          analyticsUtils.globalContext[tempKey(key)] = null;\n        });\n        [USER_ID, ANON_ID, USER_TRAITS].forEach(function (key) {\n          storage.removeItem(key);\n        });\n        return Object.assign({}, state, {\n          userId: null,\n          // TODO reset anon id automatically?\n          anonymousId: null,\n          traits: {}\n        });\n\n      default:\n        return state;\n    }\n  };\n}\nfunction getPersistedUserData(params, storage) {\n  return {\n    userId: storage.getItem(USER_ID) || params.an_uid,\n    anonymousId: storage.getItem(ANON_ID) || params.an_aid || analyticsUtils.uuid(),\n    traits: storage.getItem(USER_TRAITS) || {}\n  };\n}\nvar tempKey = function tempKey(key) {\n  return '__TEMP__' + key;\n};\nfunction getUserPropFunc(storage) {\n  return function getUserProp(key, instance, payload) {\n    /* 1. Try current state */\n    var currentId = instance.getState('user')[key];\n\n    if (currentId) {\n      // console.log('from state', currentId)\n      return currentId;\n    }\n    /* 2. Try event payload */\n\n\n    if (payload && analyticsUtils.isObject(payload) && payload[key]) {\n      // console.log('from payload', payload[key])\n      return payload[key];\n    }\n    /* 3. Try persisted data */\n\n\n    var persistedInfo = getPersistedUserData({}, storage)[key];\n\n    if (persistedInfo) {\n      // console.log('from persistedInfo', persistedInfo)\n      return persistedInfo;\n    }\n    /* 4. Else, try to get in memory placeholder. TODO watch this for future issues */\n\n\n    if (analyticsUtils.globalContext[tempKey(key)]) {\n      // console.log('from global', globalContext[tempKey(key)])\n      return analyticsUtils.globalContext[tempKey(key)];\n    } // return null instead of undefined for consistency\n\n\n    return null;\n  };\n}\n\nfunction identifyMiddleware(instance) {\n  var _instance$storage = instance.storage,\n      setItem = _instance$storage.setItem,\n      removeItem = _instance$storage.removeItem,\n      getItem = _instance$storage.getItem;\n  return function (store) {\n    return function (next) {\n      return function (action) {\n        var userId = action.userId,\n            traits = action.traits,\n            options = action.options,\n            callback = action.callback;\n        /* Reset user id and traits */\n\n        if (action.type === EVENTS.reset) {\n          // Remove stored data\n          [USER_ID, USER_TRAITS, ANON_ID].forEach(function (key) {\n            return removeItem(key);\n          });\n          [ID, ANONID, 'traits'].forEach(function (key) {\n            analyticsUtils.globalContext[tempKey(key)] = undefined;\n          });\n\n          if (analyticsUtils.isFunction(callback)) {\n            callback();\n          }\n        }\n\n        if (action.type === EVENTS.identify) {\n          /* If no anon id. Set it! */\n          if (!getItem(ANON_ID)) {\n            setItem(ANON_ID, analyticsUtils.uuid());\n          }\n\n          var currentId = getItem(USER_ID);\n          var currentTraits = getItem(USER_TRAITS) || {};\n\n          if (currentId && currentId !== userId) {\n            store.dispatch({\n              type: EVENTS.userIdChanged,\n              old: {\n                userId: currentId,\n                traits: currentTraits\n              },\n              \"new\": {\n                userId: userId,\n                traits: traits\n              },\n              options: options\n            });\n          }\n          /* Save user id */\n\n\n          if (userId) {\n            setItem(USER_ID, userId);\n          }\n          /* Save user traits */\n\n\n          if (traits) {\n            setItem(USER_TRAITS, objectSpread2(objectSpread2({}, currentTraits), traits));\n          }\n        }\n\n        return next(action);\n      };\n    };\n  };\n}\n\nvar runtime_1 = createCommonjsModule(function (module) {\n/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nvar runtime = (function (exports) {\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  function define(obj, key, value) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n    return obj[key];\n  }\n  try {\n    // IE 8 has a broken Object.defineProperty that only works on DOM objects.\n    define({}, \"\");\n  } catch (err) {\n    define = function(obj, key, value) {\n      return obj[key] = value;\n    };\n  }\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  exports.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n  var IteratorPrototype = {};\n  IteratorPrototype[iteratorSymbol] = function () {\n    return this;\n  };\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n      NativeIteratorPrototype !== Op &&\n      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n    Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;\n  GeneratorFunctionPrototype.constructor = GeneratorFunction;\n  GeneratorFunction.displayName = define(\n    GeneratorFunctionPrototype,\n    toStringTagSymbol,\n    \"GeneratorFunction\"\n  );\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      define(prototype, method, function(arg) {\n        return this._invoke(method, arg);\n      });\n    });\n  }\n\n  exports.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  exports.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      define(genFun, toStringTagSymbol, \"GeneratorFunction\");\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  exports.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator, PromiseImpl) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === \"object\" &&\n            hasOwn.call(value, \"__await\")) {\n          return PromiseImpl.resolve(value.__await).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return PromiseImpl.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration.\n          result.value = unwrapped;\n          resolve(result);\n        }, function(error) {\n          // If a rejected Promise was yielded, throw the rejection back\n          // into the async generator function so it can be handled there.\n          return invoke(\"throw\", error, resolve, reject);\n        });\n      }\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new PromiseImpl(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  AsyncIterator.prototype[asyncIteratorSymbol] = function () {\n    return this;\n  };\n  exports.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  exports.async = function(innerFn, outerFn, self, tryLocsList, PromiseImpl) {\n    if (PromiseImpl === void 0) PromiseImpl = Promise;\n\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList),\n      PromiseImpl\n    );\n\n    return exports.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n\n        } else if (context.method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n\n        } else if (context.method === \"return\") {\n          context.abrupt(\"return\", context.arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done\n          };\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n          context.method = \"throw\";\n          context.arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === \"throw\") {\n        // Note: [\"return\"] must be used for ES3 parsing compatibility.\n        if (delegate.iterator[\"return\"]) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = \"return\";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === \"throw\") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // \"return\" to \"throw\", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = \"throw\";\n        context.arg = new TypeError(\n          \"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === \"throw\") {\n      context.method = \"throw\";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (! info) {\n      context.method = \"throw\";\n      context.arg = new TypeError(\"iterator result is not an object\");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value;\n\n      // Resume execution at the desired location (see delegateYield).\n      context.next = delegate.nextLoc;\n\n      // If context.method was \"throw\" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was \"next\", forget context.arg since it has been\n      // \"consumed\" by the delegate iterator. If context.method was\n      // \"return\", allow the original .return call to continue in the\n      // outer generator.\n      if (context.method !== \"return\") {\n        context.method = \"next\";\n        context.arg = undefined;\n      }\n\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    }\n\n    // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n    context.delegate = null;\n    return ContinueSentinel;\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  define(Gp, toStringTagSymbol, \"Generator\");\n\n  // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn't happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n  Gp[iteratorSymbol] = function() {\n    return this;\n  };\n\n  Gp.toString = function() {\n    return \"[object Generator]\";\n  };\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  exports.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  exports.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.method = \"next\";\n      this.arg = undefined;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = \"next\";\n          context.arg = undefined;\n        }\n\n        return !! caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = \"next\";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = this.arg = record.arg;\n        this.method = \"return\";\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      if (this.method === \"next\") {\n        // Deliberately forget the last sent value so that we don't\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    }\n  };\n\n  // Regardless of whether this script is executing as a CommonJS module\n  // or not, return the runtime object so that we can declare the variable\n  // regeneratorRuntime in the outer scope, which allows this module to be\n  // injected easily by `bin/regenerator --include-runtime script.js`.\n  return exports;\n\n}(\n  // If this script is executing as a CommonJS module, use module.exports\n  // as the regeneratorRuntime namespace. Otherwise create a new empty\n  // object. Either way, the resulting object will be used to initialize\n  // the regeneratorRuntime variable at the top of this file.\n  module.exports\n));\n\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  // This module should not be running in strict mode, so the above\n  // assignment should always work unless something is misconfigured. Just\n  // in case runtime.js accidentally runs in strict mode, we can escape\n  // strict mode using a global Function call. This could conceivably fail\n  // if a Content Security Policy forbids using Function, but in that case\n  // the proper solution is to fix the accidental strict mode problem. If\n  // you've misconfigured your bundler to force strict mode and applied a\n  // CSP to forbid Function, and you're not willing to fix either of those\n  // problems, please detail your unique predicament in a GitHub issue.\n  Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n}\n});\n\nvar regenerator = runtime_1;\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nvar asyncToGenerator = _asyncToGenerator;\n\nvar stack = {};\n\nfunction runCallback(id, payload) {\n  if (stack[id] && analyticsUtils.isFunction(stack[id])) {\n    stack[id](payload);\n    delete stack[id];\n  }\n}\n\nfunction waitForReady(data, predicate, timeout) {\n  return new Promise(function (resolve, reject) {\n    if (predicate()) {\n      return resolve(data);\n    } // Timeout. Add to queue\n\n\n    if (timeout < 1) {\n      return reject(objectSpread2(objectSpread2({}, data), {}, {\n        queue: true\n      })); // eslint-disable-line\n    } // Else recursive retry\n\n\n    return pause(10).then(function (_) {\n      return waitForReady(data, predicate, timeout - 10).then(resolve, reject);\n    });\n  });\n}\n\nfunction pause(ms) {\n  return new Promise(function (resolve) {\n    return setTimeout(resolve, ms);\n  });\n}\n\nfunction processQueue(store, getPlugins, instance) {\n  var pluginMethods = getPlugins();\n\n  var _store$getState = store.getState(),\n      plugins = _store$getState.plugins,\n      context = _store$getState.context,\n      queue = _store$getState.queue,\n      user = _store$getState.user;\n\n  var isOnline = !context.offline;\n  /* If network connection found and there is items in queue, process them all */\n\n  if (isOnline && queue && queue.actions && queue.actions.length) {\n    var pipeline = queue.actions.reduce(function (acc, item, index) {\n      var isLoaded = plugins[item.plugin].loaded;\n\n      if (isLoaded) {\n        acc.process.push(item);\n        acc.processIndex.push(index);\n      } else {\n        acc.requeue.push(item);\n        acc.requeueIndex.push(index);\n      }\n\n      return acc;\n    }, {\n      processIndex: [],\n      process: [],\n      requeue: [],\n      requeueIndex: []\n    });\n\n    if (pipeline.processIndex && pipeline.processIndex.length) {\n      pipeline.processIndex.forEach(function (i) {\n        var processAction = queue.actions[i]; // console.log('RePROCESS THIS>', processAction)\n        // Call methods directly right now\n\n        var currentPlugin = processAction.plugin;\n        var currentMethod = processAction.payload.type;\n        var method = pluginMethods[currentPlugin][currentMethod];\n\n        if (method && analyticsUtils.isFunction(method)) {\n          /* enrich queued payload with userId / anon id if missing */\n\n          /* TODO hoist enrich into where action queued? */\n          var enrichedPayload = enrich(processAction.payload, user);\n          method({\n            payload: enrichedPayload,\n            config: plugins[currentPlugin].config,\n            instance: instance\n          });\n          /* Then redispatch for .on listeners / other middleware */\n\n          var pluginEvent = \"\".concat(currentMethod, \":\").concat(currentPlugin);\n          store.dispatch(objectSpread2(objectSpread2({}, enrichedPayload), {}, {\n            type: pluginEvent,\n\n            /* Internal data for analytics engine */\n            _: {\n              called: pluginEvent,\n              from: 'queueDrain'\n            }\n          }));\n        }\n      });\n      /* Removed processed actions */\n\n      var reQueueActions = queue.actions.filter(function (value, index) {\n        // !~ === return pipeline.processIndex.indexOf(index) === -1\n        return !~pipeline.processIndex.indexOf(index);\n      });\n      /* Set queue actions. TODO refactor to non mutatable or move out of redux */\n\n      queue.actions = reQueueActions;\n    }\n  }\n}\n/* Heartbeat retries queued events */\n\nfunction heartBeat(store, getPlugins, instance) {\n  return setInterval(function () {\n    return processQueue(store, getPlugins, instance);\n  }, 3e3);\n}\n\nfunction fixEmptyValues(obj, objTwo, key) {\n  if (obj.hasOwnProperty(key) && !obj[key] && objTwo[key]) {\n    // console.log('enrich', key)\n    return Object.assign({}, obj, defineProperty({}, \"\".concat(key), objTwo[key]));\n  }\n\n  return obj;\n} // Assign userId && anonymousId values if present in payload but null\n\n\nfunction enrich(payload) {\n  var user = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  return [ID, ANONID].reduce(function (acc, key) {\n    return fixEmptyValues(acc, user, key);\n  }, payload);\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nvar arrayWithHoles = _arrayWithHoles;\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nvar iterableToArrayLimit = _iterableToArrayLimit;\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}\n\nvar nonIterableRest = _nonIterableRest;\n\nfunction _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || nonIterableRest();\n}\n\nvar slicedToArray = _slicedToArray;\n\nfunction fitlerDisabledPlugins(allPlugins) {\n  var settings = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  return Object.keys(allPlugins).filter(function (name) {\n    var fromCallOptions = options.plugins || {}; // If enabled/disabled by options. Override settings\n\n    if (analyticsUtils.isBoolean(fromCallOptions[name])) {\n      return fromCallOptions[name];\n    } // If all: false disable everything unless true explicitly set\n\n\n    if (fromCallOptions.all === false) {\n      return false;\n    } // else use state.plugin settings\n\n\n    if (settings[name] && settings[name].enabled === false) {\n      return false;\n    }\n\n    return true;\n  }).map(function (name) {\n    return allPlugins[name];\n  });\n}\n\nvar endsWithStartRegex = /Start$/;\nvar bootstrapRegex = /^bootstrap/;\nvar readyRegex = /^ready/;\nfunction runPlugins (_x, _x2, _x3, _x4, _x5) {\n  return _ref.apply(this, arguments);\n}\n\nfunction _ref() {\n  _ref = asyncToGenerator(\n  /*#__PURE__*/\n  regenerator.mark(function _callee(action, getPlugins, instance, store, eventsInfo) {\n    var pluginObject, originalType, updatedType, state, activePlugins, allActivePluginKeys, allMatches, actionBefore, actionDuring, afterName, actionAfter, cb;\n    return regenerator.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            pluginObject = analyticsUtils.isFunction(getPlugins) ? getPlugins() : getPlugins;\n            originalType = action.type;\n            updatedType = originalType.replace(endsWithStartRegex, '');\n            /* If action already dispatched exit early. This makes it so plugin methods are not fired twice. */\n\n            if (!(action._ && action._.called)) {\n              _context.next = 5;\n              break;\n            }\n\n            return _context.abrupt(\"return\", action);\n\n          case 5:\n            state = instance.getState();\n            /* Remove plugins that are disabled by options or by settings */\n\n            activePlugins = fitlerDisabledPlugins(pluginObject, state.plugins, action.options);\n            /* If analytics.plugin.enable calls do special behavior */\n\n            if (originalType === EVENTS.initializeStart && action.fromEnable) {\n              // Return list of all enabled plugins that have NOT been initialized yet\n              activePlugins = Object.keys(state.plugins).filter(function (name) {\n                var info = state.plugins[name];\n                return action.plugins.includes(name) && !info.initialized;\n              }).map(function (name) {\n                return pluginObject[name];\n              });\n            } // console.log(`engine activePlugins ${action.type}`, activePlugins)\n\n\n            allActivePluginKeys = activePlugins.map(function (p) {\n              return p.name;\n            }); // console.log('allActivePluginKeys', allActivePluginKeys)\n\n            allMatches = getAllMatchingCalls(originalType, activePlugins, pluginObject); // console.log('allMatches', allMatches)\n\n            /* @TODO cache matches and purge on enable/disable/add plugin */\n\n            /**\n             * Process all 'actionBefore' hooks\n             * Example:\n             *  This is processes 'pageStart' methods from plugins and update the event to send through the chain\n             */\n\n            _context.next = 12;\n            return processEvent({\n              action: action,\n              data: {\n                exact: allMatches.before,\n                namespaced: allMatches.beforeNS\n              },\n              state: state,\n              allPlugins: pluginObject,\n              allMatches: allMatches,\n              instance: instance,\n              store: store,\n              EVENTS: eventsInfo\n            });\n\n          case 12:\n            actionBefore = _context.sent;\n\n            if (!shouldAbortAll(actionBefore, allActivePluginKeys.length)) {\n              _context.next = 15;\n              break;\n            }\n\n            return _context.abrupt(\"return\", actionBefore);\n\n          case 15:\n            if (!(originalType === updatedType)) {\n              _context.next = 19;\n              break;\n            }\n\n            /* If type the same don't double process */\n            actionDuring = actionBefore;\n            _context.next = 22;\n            break;\n\n          case 19:\n            _context.next = 21;\n            return processEvent({\n              action: objectSpread2(objectSpread2({}, actionBefore), {}, {\n                type: updatedType\n              }),\n              data: {\n                exact: allMatches.during,\n                namespaced: allMatches.duringNS\n              },\n              state: state,\n              allPlugins: pluginObject,\n              allMatches: allMatches,\n              instance: instance,\n              store: store,\n              EVENTS: eventsInfo\n            });\n\n          case 21:\n            actionDuring = _context.sent;\n\n          case 22:\n            if (!originalType.match(endsWithStartRegex)) {\n              _context.next = 29;\n              break;\n            }\n\n            afterName = \"\".concat(updatedType, \"End\");\n            _context.next = 26;\n            return processEvent({\n              action: objectSpread2(objectSpread2({}, actionDuring), {}, {\n                type: afterName\n              }),\n              data: {\n                exact: allMatches.after,\n                namespaced: allMatches.afterNS\n              },\n              state: state,\n              allPlugins: pluginObject,\n              allMatches: allMatches,\n              instance: instance,\n              store: store,\n              EVENTS: eventsInfo\n            });\n\n          case 26:\n            actionAfter = _context.sent;\n            // console.log('____ actionAfter', actionAfter)\n\n            /* Fire callback if supplied */\n            cb = getCallback(actionAfter); // console.log(`cb ${updatedType}`, cb)\n\n            if (cb) {\n              /** @TODO figure out exact args calls and .on will get */\n              // TODO make err, payload so promisfy utilities will work\n              cb({\n                payload: actionAfter\n              }); // eslint-disable-line\n            }\n\n          case 29:\n            return _context.abrupt(\"return\", actionBefore);\n\n          case 30:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _ref.apply(this, arguments);\n}\n\nfunction getCallback(action) {\n  if (!action.meta) return false;\n  return Object.keys(action.meta).reduce(function (acc, key) {\n    var thing = action.meta[key];\n    if (analyticsUtils.isFunction(thing)) return thing;\n    return acc;\n  }, false);\n}\n/**\n * Async reduce over matched plugin methods\n * Fires plugin functions\n */\n\n\nfunction processEvent(_x6) {\n  return _processEvent.apply(this, arguments);\n}\n\nfunction _processEvent() {\n  _processEvent = asyncToGenerator(\n  /*#__PURE__*/\n  regenerator.mark(function _callee5(_ref2) {\n    var data, action, instance, state, allPlugins, allMatches, store, EVENTS$$1, plugins, context, method, isStartEvent, abortable, makeArgs, queueData, payloads, resolvedAction, endAction;\n    return regenerator.wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            data = _ref2.data, action = _ref2.action, instance = _ref2.instance, state = _ref2.state, allPlugins = _ref2.allPlugins, allMatches = _ref2.allMatches, store = _ref2.store, EVENTS$$1 = _ref2.EVENTS;\n            plugins = state.plugins, context = state.context;\n            method = action.type;\n            isStartEvent = method.match(endsWithStartRegex); // console.log(`data ${method}`, data)\n            // console.log(`data allMatches ${method}`, allMatches)\n\n            abortable = data.exact.map(function (x) {\n              return x.pluginName;\n            });\n            /* If abort is called from xyzStart */\n\n            if (isStartEvent) {\n              abortable = allMatches.during.map(function (x) {\n                return x.pluginName;\n              });\n            }\n            /* make args for functions to concume */\n\n\n            makeArgs = argumentFactory(instance, abortable); // console.log('makeArgs', makeArgs)\n\n            /* Check if plugin loaded, if not mark action for queue */\n\n            queueData = data.exact.reduce(function (acc, thing) {\n              var pluginName = thing.pluginName,\n                  methodName = thing.methodName;\n              var addToQueue = false; // Queue actions if plugin not loaded except for initialize and reset\n\n              if (!methodName.match(/^initialize/) && !methodName.match(/^reset/)) {\n                addToQueue = !plugins[pluginName].loaded;\n              }\n              /* If offline and its a core method. Add to queue */\n\n\n              if (context.offline && methodName.match(/^(page|track|identify)/)) {\n                addToQueue = true;\n              }\n\n              acc[\"\".concat(pluginName)] = addToQueue;\n              return acc;\n            }, {});\n            /* generate plugin specific payloads */\n\n            _context5.next = 10;\n            return data.exact.reduce(\n            /*#__PURE__*/\n            function () {\n              var _ref6 = asyncToGenerator(\n              /*#__PURE__*/\n              regenerator.mark(function _callee3(scoped, curr, i) {\n                var pluginName, curScope, scopedPayload;\n                return regenerator.wrap(function _callee3$(_context3) {\n                  while (1) {\n                    switch (_context3.prev = _context3.next) {\n                      case 0:\n                        pluginName = curr.pluginName;\n                        _context3.next = 3;\n                        return scoped;\n\n                      case 3:\n                        curScope = _context3.sent;\n\n                        if (!(data.namespaced && data.namespaced[pluginName])) {\n                          _context3.next = 11;\n                          break;\n                        }\n\n                        _context3.next = 7;\n                        return data.namespaced[pluginName].reduce(\n                        /*#__PURE__*/\n                        function () {\n                          var _ref7 = asyncToGenerator(\n                          /*#__PURE__*/\n                          regenerator.mark(function _callee2(acc, p, count) {\n                            var curScopeData, genAbort, val, returnValue;\n                            return regenerator.wrap(function _callee2$(_context2) {\n                              while (1) {\n                                switch (_context2.prev = _context2.next) {\n                                  case 0:\n                                    genAbort = function _ref8(currentAct, pname, otherPlug) {\n                                      return function (reason, plugins) {\n                                        var callsite = otherPlug || pname; // console.log(`__abort msg: ${reason}`)\n                                        // console.log(`__abort ${pname}`)\n                                        // console.log(`__abort xxx: ${plugins}`)\n                                        // console.log(`__abort otherPlug`, otherPlug)\n\n                                        return objectSpread2(objectSpread2({}, currentAct), {}, {\n                                          abort: {\n                                            reason: reason,\n                                            plugins: plugins || [pname],\n                                            caller: method,\n                                            from: callsite\n                                          }\n                                        });\n                                      };\n                                    };\n\n                                    _context2.next = 3;\n                                    return acc;\n\n                                  case 3:\n                                    curScopeData = _context2.sent;\n\n                                    if (!(!p.method || !analyticsUtils.isFunction(p.method))) {\n                                      _context2.next = 6;\n                                      break;\n                                    }\n\n                                    return _context2.abrupt(\"return\", curScopeData);\n\n                                  case 6:\n                                    /* Make sure plugins don’t call themselves */\n                                    validateMethod(p.methodName, p.pluginName);\n                                    _context2.next = 9;\n                                    return p.method({\n                                      payload: curScopeData,\n                                      instance: instance,\n                                      abort: genAbort(curScopeData, pluginName, p.pluginName),\n                                      config: getConfig(p.pluginName, plugins, allPlugins),\n                                      plugins: plugins\n                                    });\n\n                                  case 9:\n                                    val = _context2.sent;\n                                    returnValue = analyticsUtils.isObject(val) ? val : {};\n                                    return _context2.abrupt(\"return\", Promise.resolve(objectSpread2(objectSpread2({}, curScopeData), returnValue)));\n\n                                  case 12:\n                                  case \"end\":\n                                    return _context2.stop();\n                                }\n                              }\n                            }, _callee2);\n                          }));\n\n                          return function (_x10, _x11, _x12) {\n                            return _ref7.apply(this, arguments);\n                          };\n                        }(), Promise.resolve(action));\n\n                      case 7:\n                        scopedPayload = _context3.sent;\n\n                        /* Set scoped payload */\n                        curScope[pluginName] = scopedPayload;\n                        _context3.next = 12;\n                        break;\n\n                      case 11:\n                        /* Set payload as default action */\n                        curScope[pluginName] = action;\n\n                      case 12:\n                        return _context3.abrupt(\"return\", Promise.resolve(curScope));\n\n                      case 13:\n                      case \"end\":\n                        return _context3.stop();\n                    }\n                  }\n                }, _callee3);\n              }));\n\n              return function (_x7, _x8, _x9) {\n                return _ref6.apply(this, arguments);\n              };\n            }(), Promise.resolve({}));\n\n          case 10:\n            payloads = _context5.sent;\n            _context5.next = 13;\n            return data.exact.reduce(\n            /*#__PURE__*/\n            function () {\n              var _ref9 = asyncToGenerator(\n              /*#__PURE__*/\n              regenerator.mark(function _callee4(promise, curr, i) {\n                var lastLoop, pluginName, currentPlugin, currentActionValue, payloadValue, funcArgs, val, returnValue, merged, scopedPayload, nameSpaceEvent, actionDepth, updatedPayload;\n                return regenerator.wrap(function _callee4$(_context4) {\n                  while (1) {\n                    switch (_context4.prev = _context4.next) {\n                      case 0:\n                        lastLoop = data.exact.length === i + 1;\n                        pluginName = curr.pluginName;\n                        currentPlugin = allPlugins[pluginName];\n                        _context4.next = 5;\n                        return promise;\n\n                      case 5:\n                        currentActionValue = _context4.sent;\n                        payloadValue = payloads[pluginName] ? payloads[pluginName] : {};\n                        /* If eventStart, allow for value merging */\n\n                        if (isStartEvent) {\n                          payloadValue = currentActionValue;\n                        }\n\n                        if (!shouldAbort(payloadValue, pluginName)) {\n                          _context4.next = 11;\n                          break;\n                        }\n\n                        // console.log(`> Abort from payload specific \"${pluginName}\" abort value`, payloadValue)\n                        abortDispatch({\n                          data: payloadValue,\n                          method: method,\n                          instance: instance,\n                          pluginName: pluginName,\n                          store: store\n                        });\n                        return _context4.abrupt(\"return\", Promise.resolve(currentActionValue));\n\n                      case 11:\n                        if (!shouldAbort(currentActionValue, pluginName)) {\n                          _context4.next = 14;\n                          break;\n                        }\n\n                        // console.log(`> Abort from ${method} abort value`, currentActionValue)\n                        if (lastLoop) {\n                          abortDispatch({\n                            data: currentActionValue,\n                            method: method,\n                            instance: instance,\n                            // pluginName,\n                            store: store\n                          });\n                        }\n\n                        return _context4.abrupt(\"return\", Promise.resolve(currentActionValue));\n\n                      case 14:\n                        if (!(queueData.hasOwnProperty(pluginName) && queueData[pluginName] === true)) {\n                          _context4.next = 17;\n                          break;\n                        }\n\n                        // console.log('Queue this instead', pluginName)\n                        store.dispatch({\n                          type: \"queue\",\n                          plugin: pluginName,\n                          payload: payloadValue,\n\n                          /* Internal data for analytics engine */\n                          _: {\n                            called: \"queue\",\n                            from: 'queueMechanism' // for debugging\n\n                          }\n                        });\n                        return _context4.abrupt(\"return\", Promise.resolve(currentActionValue));\n\n                      case 17:\n                        /*\n                        const checkForLoaded = () => {\n                          const p = instance.getState('plugins')\n                          return p[currentPlugin.name].loaded\n                        }\n                        // const p = instance.getState('plugins')\n                        console.log(`loaded \"${currentPlugin.name}\" > ${method}:`, p[currentPlugin.name].loaded)\n                        // await waitForReady(currentPlugin, checkForLoaded, 10000).then((d) => {\n                        //   console.log(`Loaded ${method}`, currentPlugin.name)\n                        // }).catch((e) => {\n                        //   console.log(`Error ${method} ${currentPlugin.name}`, e)\n                        //   // TODO dispatch failure\n                        // })\n                        */\n                        // @TODO figure out if we want queuing semantics\n                        funcArgs = makeArgs(payloads[pluginName], allPlugins[pluginName]); // console.log(`funcArgs ${method} ${pluginName}`, funcArgs)\n\n                        /* Run the plugin function */\n\n                        _context4.next = 20;\n                        return currentPlugin[method]({\n                          // currentPlugin: pluginName,\n                          abort: funcArgs.abort,\n                          // Send in original action value or scope payload\n                          payload: payloadValue,\n                          instance: instance,\n                          config: getConfig(pluginName, plugins, allPlugins),\n                          plugins: plugins\n                        });\n\n                      case 20:\n                        val = _context4.sent;\n                        returnValue = analyticsUtils.isObject(val) ? val : {};\n                        merged = objectSpread2(objectSpread2({}, currentActionValue), returnValue);\n                        scopedPayload = payloads[pluginName]; // || currentActionValue\n\n                        if (shouldAbort(scopedPayload, pluginName)) {\n                          // console.log(`>> HANDLE abort ${method} ${pluginName}`)\n                          abortDispatch({\n                            data: scopedPayload,\n                            method: method,\n                            instance: instance,\n                            pluginName: pluginName,\n                            store: store\n                          });\n                        } else {\n                          nameSpaceEvent = \"\".concat(method, \":\").concat(pluginName);\n                          actionDepth = (nameSpaceEvent.match(/:/g) || []).length;\n\n                          if (actionDepth < 2 && !method.match(bootstrapRegex) && !method.match(readyRegex)) {\n                            updatedPayload = isStartEvent ? merged : payloadValue; // Dispatched for `.on('xyz') listeners.\n\n                            instance.dispatch(objectSpread2(objectSpread2({}, updatedPayload), {}, {\n                              type: nameSpaceEvent,\n                              _: {\n                                called: nameSpaceEvent,\n                                from: 'submethod'\n                              }\n                            }));\n                          }\n                        } // console.log('merged', merged)\n\n\n                        return _context4.abrupt(\"return\", Promise.resolve(merged));\n\n                      case 26:\n                      case \"end\":\n                        return _context4.stop();\n                    }\n                  }\n                }, _callee4);\n              }));\n\n              return function (_x13, _x14, _x15) {\n                return _ref9.apply(this, arguments);\n              };\n            }(), Promise.resolve(action));\n\n          case 13:\n            resolvedAction = _context5.sent;\n\n            if (!(!method.match(endsWithStartRegex) && !method.match(/^registerPlugin/) && // !method.match(/^disablePlugin/) &&\n            // !method.match(/^enablePlugin/) &&\n            !method.match(readyRegex) && !method.match(bootstrapRegex) && !method.match(/^params/) && !method.match(/^userIdChanged/))) {\n              _context5.next = 21;\n              break;\n            }\n\n            if (EVENTS$$1.plugins.includes(method)) ; // console.log(`Dont dispatch for ${method}`, resolvedAction)\n            // return resolvedAction\n\n            /*\n              Verify this original action setup.\n              It's intended to keep actions from double dispatching themselves\n            */\n\n\n            if (!(resolvedAction._ && resolvedAction._.originalAction === method)) {\n              _context5.next = 18;\n              break;\n            }\n\n            return _context5.abrupt(\"return\", resolvedAction);\n\n          case 18:\n            endAction = objectSpread2(objectSpread2({}, resolvedAction), {\n              _: {\n                originalAction: resolvedAction.type,\n                called: resolvedAction.type,\n                from: 'engineEnd'\n              }\n            });\n            /* If all plugins are aborted, dispatch xAborted */\n\n            if (shouldAbortAll(resolvedAction, data.exact.length) && !method.match(/End$/)) {\n              endAction = objectSpread2(objectSpread2({}, endAction), {\n                type: resolvedAction.type + 'Aborted'\n              });\n            }\n\n            store.dispatch(endAction);\n\n          case 21:\n            return _context5.abrupt(\"return\", resolvedAction);\n\n          case 22:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5);\n  }));\n  return _processEvent.apply(this, arguments);\n}\n\nfunction abortDispatch(_ref3) {\n  var data = _ref3.data,\n      method = _ref3.method,\n      instance = _ref3.instance,\n      pluginName = _ref3.pluginName,\n      store = _ref3.store;\n  var postFix = pluginName ? ':' + pluginName : '';\n  var abortEvent = method + 'Aborted' + postFix;\n  store.dispatch(objectSpread2(objectSpread2({}, data), {}, {\n    type: abortEvent,\n    _: {\n      called: abortEvent,\n      from: 'abort'\n    }\n  }));\n}\n\nfunction getConfig(name, pluginState, allPlugins) {\n  var pluginData = pluginState[name] || allPlugins[name];\n\n  if (pluginData && pluginData.config) {\n    return pluginData.config;\n  }\n\n  return {};\n}\n\nfunction getPluginFunctions(methodName, plugins) {\n  return plugins.reduce(function (arr, plugin) {\n    return !plugin[methodName] ? arr : arr.concat({\n      methodName: methodName,\n      pluginName: plugin.name,\n      method: plugin[methodName]\n    });\n  }, []);\n}\n\nfunction formatMethod(type) {\n  return type.replace(endsWithStartRegex, '');\n}\n/**\n * Return array of event names\n * @param  {String} eventType - original event type\n * @param  {String} namespace - optional namespace postfix\n * @return {array} - type, method, end\n */\n\n\nfunction getEventNames(eventType, namespace) {\n  var method = formatMethod(eventType);\n  var postFix = namespace ? \":\".concat(namespace) : ''; // `typeStart:pluginName`\n\n  var type = \"\".concat(eventType).concat(postFix); // `type:pluginName`\n\n  var methodName = \"\".concat(method).concat(postFix); // `typeEnd:pluginName`\n\n  var end = \"\".concat(method, \"End\").concat(postFix);\n  return [type, methodName, end];\n}\n/* Collect all calls for a given event in the system */\n\n\nfunction getAllMatchingCalls(eventType, activePlugins, allPlugins) {\n  var eventNames = getEventNames(eventType); // console.log('eventNames', eventNames)\n  // 'eventStart', 'event', & `eventEnd`\n\n  var core = eventNames.map(function (word) {\n    return getPluginFunctions(word, activePlugins);\n  }); // Gather nameSpaced Events\n\n  return activePlugins.reduce(function (acc, plugin) {\n    var name = plugin.name;\n    var nameSpacedEvents = getEventNames(eventType, name); // console.log('eventNames namespaced', nameSpacedEvents)\n\n    var _nameSpacedEvents$map = nameSpacedEvents.map(function (word) {\n      return getPluginFunctions(word, activePlugins);\n    }),\n        _nameSpacedEvents$map2 = slicedToArray(_nameSpacedEvents$map, 3),\n        beforeFuncs = _nameSpacedEvents$map2[0],\n        duringFuncs = _nameSpacedEvents$map2[1],\n        afterFuncs = _nameSpacedEvents$map2[2];\n\n    if (beforeFuncs.length) {\n      acc.beforeNS[name] = beforeFuncs;\n    }\n\n    if (duringFuncs.length) {\n      acc.duringNS[name] = duringFuncs;\n    }\n\n    if (afterFuncs.length) {\n      acc.afterNS[name] = afterFuncs;\n    }\n\n    return acc;\n  }, {\n    before: core[0],\n    beforeNS: {},\n    during: core[1],\n    duringNS: {},\n    after: core[2],\n    afterNS: {}\n  });\n}\n\nfunction shouldAbort(_ref4, pluginName) {\n  var abort = _ref4.abort;\n  if (!abort) return false;\n  if (abort === true) return true;\n  return includes(abort, pluginName) || abort && includes(abort.plugins, pluginName);\n}\n\nfunction shouldAbortAll(_ref5, pluginsCount) {\n  var abort = _ref5.abort;\n  if (!abort) return false;\n  if (abort === true || analyticsUtils.isString(abort)) return true;\n  var plugins = abort.plugins;\n  return isArray(abort) && abort.length === pluginsCount || isArray(plugins) && plugins.length === pluginsCount;\n}\n\nfunction isArray(arr) {\n  return Array.isArray(arr);\n}\n\nfunction includes(arr, name) {\n  if (!arr || !isArray(arr)) return false;\n  return arr.includes(name);\n}\n/**\n * Generate arguments to pass to plugin methods\n * @param  {Object} instance - analytics instance\n * @param  {array} abortablePlugins - plugins that can be cancelled by caller\n * @return {*} function to inject plugin params\n */\n\n\nfunction argumentFactory(instance, abortablePlugins) {\n  // console.log('abortablePlugins', abortablePlugins)\n  return function (action, plugin, otherPlugin) {\n    var config = plugin.config,\n        name = plugin.name;\n    var method = \"\".concat(name, \".\").concat(action.type);\n\n    if (otherPlugin) {\n      method = otherPlugin.event;\n    }\n\n    var abortF = action.type.match(endsWithStartRegex) ? abortFunction(name, method, abortablePlugins, otherPlugin, action) : notAbortableError(action, method);\n    return {\n      /* self: plugin, for future maybe */\n      // clone objects to avoid reassign\n      payload: formatPayload(action),\n      instance: instance,\n      config: config || {},\n      abort: abortF\n    };\n  };\n}\n\nfunction abortFunction(pluginName, method, abortablePlugins, otherPlugin, action) {\n  return function (reason, plugins) {\n    var caller = otherPlugin ? otherPlugin.name : pluginName;\n    var pluginsToAbort = plugins && isArray(plugins) ? plugins : abortablePlugins;\n\n    if (otherPlugin) {\n      pluginsToAbort = plugins && isArray(plugins) ? plugins : [pluginName];\n\n      if (!pluginsToAbort.includes(pluginName) || pluginsToAbort.length !== 1) {\n        throw new Error(\"Method \".concat(method, \" can only abort \").concat(pluginName, \" plugin. \").concat(JSON.stringify(pluginsToAbort), \" input valid\"));\n      }\n    }\n\n    return objectSpread2(objectSpread2({}, action), {}, {\n      // 🔥 todo verify this merge is ok\n      abort: {\n        reason: reason,\n        plugins: pluginsToAbort,\n        caller: method,\n        _: caller\n      }\n    });\n  };\n}\n\nfunction notAbortableError(action, method) {\n  return function () {\n    throw new Error(action.type + ' action not cancellable. Remove abort in ' + method);\n  };\n}\n/**\n * Verify plugin is not calling itself with whatever:myPluginName self refs\n */\n\n\nfunction validateMethod(actionName, pluginName) {\n  var text = getNameSpacedAction(actionName);\n  var methodCallMatchesPluginNamespace = text && text.name === pluginName;\n\n  if (methodCallMatchesPluginNamespace) {\n    var sub = getNameSpacedAction(text.method);\n    var subText = sub ? 'or ' + sub.method : '';\n    throw new Error([pluginName + ' plugin is calling method ' + actionName, 'Plugins cant call self', \"Use \".concat(text.method, \" \").concat(subText, \" in \").concat(pluginName, \" plugin insteadof \").concat(actionName)].join('\\n'));\n  }\n}\n\nfunction getNameSpacedAction(event) {\n  var split = event.match(/(.*):(.*)/);\n\n  if (!split) {\n    return false;\n  }\n\n  return {\n    method: split[1],\n    name: split[2]\n  };\n}\n\nfunction formatPayload(action) {\n  return Object.keys(action).reduce(function (acc, key) {\n    // redact type from { payload }\n    if (key === 'type') {\n      return acc;\n    }\n\n    if (analyticsUtils.isObject(action[key])) {\n      acc[key] = Object.assign({}, action[key]);\n    } else {\n      acc[key] = action[key];\n    }\n\n    return acc;\n  }, {});\n}\n/*\nfunction getMatchingMethods(eventType, activePlugins) {\n  const exact = getPluginFunctions(eventType, activePlugins)\n  // console.log('exact', exact)\n  // Gather nameSpaced Events\n  return activePlugins.reduce((acc, plugin) => {\n    const { name } = plugin\n    const clean = getPluginFunctions(`${eventType}:${name}`, activePlugins)\n    if (clean.length) {\n      acc.namespaced[name] = clean\n    }\n    return acc\n  }, {\n    exact: exact,\n    namespaced: {}\n  })\n}\n*/\n\nfunction pluginMiddleware(instance, getPlugins, systemEvents) {\n  var isReady = {};\n  return function (store) {\n    return function (next) {\n      return (\n        /*#__PURE__*/\n        function () {\n          var _ref = asyncToGenerator(\n          /*#__PURE__*/\n          regenerator.mark(function _callee(action) {\n            var type, abort, plugins, updatedAction, allPlugins, pluginsArray, allRegisteredPlugins, completed, failed, disabled, waitForPluginsToLoad, updated;\n            return regenerator.wrap(function _callee$(_context) {\n              while (1) {\n                switch (_context.prev = _context.next) {\n                  case 0:\n                    type = action.type, abort = action.abort, plugins = action.plugins;\n                    updatedAction = action;\n\n                    if (!abort) {\n                      _context.next = 4;\n                      break;\n                    }\n\n                    return _context.abrupt(\"return\", next(action));\n\n                  case 4:\n                    /* Analytics.plugins.enable called, we need to init the plugins */\n                    if (type === EVENTS.enablePlugin) {\n                      store.dispatch({\n                        type: EVENTS.initializeStart,\n                        plugins: plugins,\n                        disabled: [],\n                        fromEnable: true,\n                        ts: action.ts\n                      });\n                    }\n\n                    if (type === EVENTS.disablePlugin) {\n                      // debounced to fix race condition\n                      setTimeout(function () {\n                        // If cached called, resolve promise/run callback\n                        runCallback(action.ts);\n                      }, 0);\n                    }\n                    /* @TODO implement\n                    if (type === EVENTS.loadPlugin) {\n                      // Rerun initialize calls in plugins\n                      const allPlugins = getPlugins()\n                      const pluginsToLoad = Object.keys(allPlugins).filter((name) => {\n                        return plugins.includes(name)\n                      }).reduce((acc, curr) => {\n                        acc[curr] = allPlugins[curr]\n                        return acc\n                      }, {})\n                      const initializeAction = {\n                        type: EVENTS.initializeStart,\n                        plugins: plugins\n                      }\n                      const updated = await runPlugins(initializeAction, pluginsToLoad, instance, store, systemEvents)\n                      return next(updated)\n                    }\n                    */\n                    //*  || type.match(/^initializeAbort:/)\n\n\n                    if (type === EVENTS.initializeEnd) {\n                      allPlugins = getPlugins();\n                      pluginsArray = Object.keys(allPlugins);\n                      allRegisteredPlugins = pluginsArray.filter(function (name) {\n                        return plugins.includes(name);\n                      }).map(function (name) {\n                        return allPlugins[name];\n                      });\n                      completed = [];\n                      failed = [];\n                      disabled = action.disabled; // console.log('allRegisteredPlugins', allRegisteredPlugins)\n\n                      waitForPluginsToLoad = allRegisteredPlugins.map(function (plugin) {\n                        var loaded = plugin.loaded,\n                            name = plugin.name;\n                        /* Plugins will abort trying to load after 10 seconds. 1e4 === 10000 MS */\n\n                        return waitForReady(plugin, loaded, 1e4).then(function (d) {\n                          if (!isReady[name]) {\n                            // only dispatch namespaced rdy once\n                            store.dispatch({\n                              type: EVENTS.pluginReadyType(name),\n                              // `ready:${name}`\n                              name: name,\n                              events: Object.keys(plugin).filter(function (name) {\n                                return !nonEvents.includes(name);\n                              })\n                            });\n                            isReady[name] = true;\n                          }\n\n                          completed = completed.concat(name);\n                          return plugin; // It's loaded! run the command\n                        })[\"catch\"](function (e) {\n                          // Timeout Add to queue\n                          // console.log('Error generic waitForReady. Push this to queue', e)\n                          if (e instanceof Error) {\n                            throw new Error(e);\n                          }\n\n                          failed = failed.concat(e.name); // Failed to fire, add to queue\n\n                          return e;\n                        });\n                      });\n                      Promise.all(waitForPluginsToLoad).then(function (calls) {\n                        // setTimeout to ensure runs after 'page'\n                        var payload = {\n                          plugins: completed,\n                          failed: failed,\n                          disabled: disabled\n                        };\n                        setTimeout(function () {\n                          if (pluginsArray.length === waitForPluginsToLoad.length + disabled.length) {\n                            store.dispatch(objectSpread2(objectSpread2({}, {\n                              type: EVENTS.ready\n                            }), payload));\n                          } // If cached called, resolve promise/run callback\n\n\n                          runCallback(action.ts, payload);\n                        }, 0);\n                      });\n                    }\n                    /* New plugin system */\n\n\n                    if (!(type !== EVENTS.bootstrap)) {\n                      _context.next = 13;\n                      break;\n                    }\n\n                    if (/^ready:([^:]*)$/.test(type)) {\n                      // Immediately flush queue\n                      setTimeout(function () {\n                        return processQueue(store, getPlugins, instance);\n                      }, 0);\n                    }\n\n                    _context.next = 11;\n                    return runPlugins(action, getPlugins, instance, store, systemEvents);\n\n                  case 11:\n                    updated = _context.sent;\n                    return _context.abrupt(\"return\", next(updated));\n\n                  case 13:\n                    return _context.abrupt(\"return\", next(updatedAction));\n\n                  case 14:\n                  case \"end\":\n                    return _context.stop();\n                }\n              }\n            }, _callee);\n          }));\n\n          return function (_x) {\n            return _ref.apply(this, arguments);\n          };\n        }()\n      );\n    };\n  };\n}\n\nfunction timeStamp() {\n  return new Date().getTime();\n}\n\nfunction storageMiddleware(storage) {\n  return function (store) {\n    return function (next) {\n      return function (action) {\n        var type = action.type,\n            key = action.key,\n            value = action.value,\n            options = action.options;\n\n        if (type === EVENTS.setItem || type === EVENTS.removeItem) {\n          if (action.abort) {\n            return next(action);\n          } // Run storage set or remove\n\n\n          if (type === EVENTS.setItem) {\n            storage.setItem(key, value, options);\n          } else {\n            storage.removeItem(key, options);\n          }\n        }\n\n        return next(action);\n      };\n    };\n  };\n}\nvar setItem = function setItem(key, value, opts) {\n  return {\n    type: EVENTS.setItemStart,\n    timestamp: timeStamp(),\n    key: key,\n    value: value,\n    options: opts\n  };\n};\nvar removeItem = function removeItem(key, opts) {\n  return {\n    type: EVENTS.removeItemStart,\n    timestamp: timeStamp(),\n    key: key,\n    options: opts\n  };\n};\n/*\n  Todo: emit events for keys we care about\n  window.addEventListener('storage', (event) => console.log(event));\n*/\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nvar classCallCheck = _classCallCheck;\n\n/* Class to fix dynamic middlewares from conflicting with each other\nif more than one analytic instance is active */\n\nvar DynamicMiddleware = function DynamicMiddleware() {\n  var _this = this;\n\n  classCallCheck(this, DynamicMiddleware);\n\n  defineProperty(this, \"before\", []);\n\n  defineProperty(this, \"after\", []);\n\n  defineProperty(this, \"addMiddleware\", function (middlewares, position) {\n    _this[position] = _this[position].concat(middlewares);\n  });\n\n  defineProperty(this, \"removeMiddleware\", function (middleware, position) {\n    var index = _this[position].findIndex(function (d) {\n      return d === middleware;\n    });\n\n    if (index === -1) return;\n    _this[position] = [].concat(toConsumableArray(_this[position].slice(0, index)), toConsumableArray(_this[position].slice(index + 1)));\n  });\n\n  defineProperty(this, \"dynamicMiddlewares\", function (position) {\n    return function (store) {\n      return function (next) {\n        return function (action) {\n          var middlewareAPI = {\n            getState: store.getState,\n            dispatch: function dispatch(act) {\n              return store.dispatch(act);\n            }\n          };\n\n          var chain = _this[position].map(function (middleware) {\n            return middleware(middlewareAPI);\n          });\n\n          return compose.apply(void 0, toConsumableArray(chain))(next)(action);\n        };\n      };\n    };\n  });\n};\n\nfunction createReducer(getPlugins) {\n  return function plugins() {\n    var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    var action = arguments.length > 1 ? arguments[1] : undefined;\n    var newState = {};\n\n    if (action.type === 'initialize:aborted') {\n      return state;\n    }\n\n    if (/^registerPlugin:([^:]*)$/.test(action.type)) {\n      var name = getNameFromEventType(action.type, 'registerPlugin');\n      var plugin = getPlugins()[name];\n\n      if (!plugin || !name) {\n        return state;\n      }\n\n      var isEnabled = action.enabled;\n      newState[name] = {\n        enabled: isEnabled,\n\n        /* if no initialization method. Set initialized true */\n        initialized: isEnabled ? Boolean(!plugin.initialize) : false,\n\n        /* If plugin enabled === false, set loaded to false, else check plugin.loaded function */\n        loaded: isEnabled ? Boolean(plugin.loaded()) : false,\n        config: plugin.config || {}\n      };\n      return objectSpread2(objectSpread2({}, state), newState);\n    }\n\n    if (/^initialize:([^:]*)$/.test(action.type)) {\n      var _name = getNameFromEventType(action.type, EVENTS.initialize);\n\n      var _plugin = getPlugins()[_name];\n\n      if (!_plugin || !_name) {\n        return state;\n      }\n\n      newState[_name] = objectSpread2(objectSpread2({}, state[_name]), {\n        initialized: true,\n\n        /* check plugin.loaded function */\n        loaded: Boolean(_plugin.loaded())\n      });\n      return objectSpread2(objectSpread2({}, state), newState);\n    }\n\n    if (/^ready:([^:]*)$/.test(action.type)) {\n      // const name = getNameFromEventType(action.type, 'ready')\n      newState[action.name] = objectSpread2(objectSpread2({}, state[action.name]), {\n        loaded: true\n      });\n      return objectSpread2(objectSpread2({}, state), newState);\n    }\n\n    switch (action.type) {\n      /* case EVENTS.pluginFailed:\n        // console.log('PLUGIN_FAILED', action.name)\n        newState[action.name] = {\n          ...state[action.name],\n          ...{ loaded: false }\n        }\n        return { ...state, ...newState }\n      */\n\n      /* When analytics.plugins.disable called */\n      case EVENTS.disablePlugin:\n        return objectSpread2(objectSpread2({}, state), togglePluginStatus(action.plugins, false, state));\n\n      /* When analytics.plugins.enable called */\n\n      case EVENTS.enablePlugin:\n        return objectSpread2(objectSpread2({}, state), togglePluginStatus(action.plugins, true, state));\n\n      default:\n        return state;\n    }\n  };\n}\n\nfunction getNameFromEventType(type, baseName) {\n  return type.substring(baseName.length + 1, type.length);\n}\n\nfunction togglePluginStatus(plugins, status, currentState) {\n  return plugins.reduce(function (acc, pluginKey) {\n    acc[pluginKey] = objectSpread2(objectSpread2({}, currentState[pluginKey]), {\n      enabled: status\n    });\n    return acc;\n  }, currentState);\n}\n\n// TODO fix os. os getting stripped out for node build\n\nfunction getBrowserOS() {\n  if (!analyticsUtils.inBrowser) return false;\n  var os = navigator.appVersion; // ~os bitwise operator to check if in navigator\n\n  if (~os.indexOf('Win')) return 'Windows';\n  if (~os.indexOf('Mac')) return 'MacOS';\n  if (~os.indexOf('X11')) return 'UNIX';\n  if (~os.indexOf('Linux')) return 'Linux'; // default\n\n  return 'Unknown OS';\n}\n\nvar osName;\nvar referrer;\nvar locale;\nvar timeZone;\n\n{\n  osName = getBrowserOS();\n  referrer = analyticsUtils.inBrowser ? document.referrer : null;\n  locale = analyticsUtils.getBrowserLocale();\n  timeZone = analyticsUtils.getTimeZone();\n}\n\nvar initialState = {\n  initialized: false,\n  sessionId: analyticsUtils.uuid(),\n  app: null,\n  version: null,\n  debug: false,\n  offline: analyticsUtils.inBrowser ? !navigator.onLine : false,\n  // use node network is-online\n  os: {\n    name: osName\n  },\n  userAgent: analyticsUtils.inBrowser ? navigator.userAgent : 'node',\n  // https://github.com/bestiejs/platform.js\n  library: {\n    name: LIBRARY_NAME,\n    // TODO fix version number. npm run publish:patch has wrong version\n    version: \"0.9.2\"\n  },\n  timezone: timeZone,\n  locale: locale,\n  campaign: {},\n  referrer: referrer // context reducer\n\n};\nfunction context() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState;\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n  var initialized = state.initialized;\n  var type = action.type,\n      campaign = action.campaign;\n\n  switch (type) {\n    case EVENTS.campaign:\n      return objectSpread2(objectSpread2({}, state), {\n        campaign: campaign\n      });\n\n    case EVENTS.offline:\n      return objectSpread2(objectSpread2({}, state), {\n        offline: true\n      });\n\n    case EVENTS.online:\n      return objectSpread2(objectSpread2({}, state), {\n        offline: false\n      });\n\n    default:\n      if (!initialized) {\n        return objectSpread2(objectSpread2(objectSpread2({}, initialState), state), {\n          initialized: true\n        });\n      }\n\n      return state;\n  }\n}\nvar excludeItems = ['plugins', 'reducers', 'storage']; // Pull plugins and reducers off intital config\n\nfunction makeContext(config) {\n  return Object.keys(config).reduce(function (acc, current) {\n    if (excludeItems.includes(current)) {\n      return acc;\n    }\n\n    acc[current] = config[current];\n    return acc;\n  }, {});\n}\n\nfunction serialize(obj) {\n  var s = obj;\n\n  try {\n    s = JSON.parse(JSON.stringify(obj));\n  } catch (err) {}\n\n  return s;\n}\n\nvar hashRegex = /#.*$/;\n\nfunction canonicalUrl() {\n  if (!analyticsUtils.inBrowser) return;\n  var tags = document.getElementsByTagName('link');\n\n  for (var i = 0, tag; tag = tags[i]; i++) {\n    if (tag.getAttribute('rel') === 'canonical') {\n      return tag.getAttribute('href');\n    }\n  }\n}\n\nfunction urlPath(url) {\n  var regex = /(http[s]?:\\/\\/)?([^\\/\\s]+\\/)(.*)/g;\n  var matches = regex.exec(url);\n  var pathMatch = matches && matches[3] ? matches[3].split('?')[0].replace(hashRegex, '') : '';\n  return '/' + pathMatch;\n}\n/**\n * Return the canonical URL and rmove the hash.\n * @param  {string} search - search param\n * @return {string} return current canonical URL\n */\n\n\nfunction currentUrl(search) {\n  var canonical = canonicalUrl();\n  if (!canonical) return window.location.href.replace(hashRegex, '');\n  return canonical.match(/\\?/) ? canonical : canonical + search;\n}\n/**\n * Page data for overides\n * @typedef {object} PageData\n * @property {string} [title] - Page title\n * @property {string} [url] - Page url\n * @property {string} [path] - Page path\n * @property {string} [search] - Page search\n * @property {string} [width] - Page width\n * @property {string} [height] - Page height\n*/\n\n/**\n * Get information about current page\n * @typedef {Function} getPageData\n * @param  {PageData} [pageData = {}] - Page data overides\n * @return {PageData} resolved page data\n */\n\n\nvar getPageData = function getPageData() {\n  var pageData = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  if (!analyticsUtils.inBrowser) return pageData;\n  var _document = document,\n      title = _document.title,\n      referrer = _document.referrer;\n  var _window = window,\n      location = _window.location,\n      innerWidth = _window.innerWidth,\n      innerHeight = _window.innerHeight;\n  var hash = location.hash,\n      search = location.search;\n  var url = currentUrl(search);\n  var page = {\n    title: title,\n    url: url,\n    path: urlPath(url),\n    hash: hash,\n    search: search,\n    width: innerWidth,\n    height: innerHeight\n  };\n\n  if (referrer && referrer !== '') {\n    page.referrer = referrer;\n  }\n\n  return objectSpread2(objectSpread2({}, page), pageData);\n};\nvar initialState$1 = {\n  last: {},\n  history: [] // page reducer\n\n};\nfunction page() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState$1;\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n  var properties = action.properties,\n      options = action.options,\n      meta = action.meta;\n\n  switch (action.type) {\n    case EVENTS.page:\n      var viewData = serialize(objectSpread2({\n        properties: properties,\n        meta: meta\n      }, Object.keys(options).length && {\n        options: options\n      }));\n      return objectSpread2(objectSpread2({}, state), {\n        last: viewData,\n        // Todo prevent LARGE arrays https://bit.ly/2MnBwPT\n        history: state.history.concat(viewData)\n      });\n\n    default:\n      return state;\n  }\n}\n\nvar initialState$2 = {\n  last: {},\n  history: [] // track reducer\n\n};\nfunction trackReducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState$2;\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n  var type = action.type,\n      meta = action.meta,\n      options = action.options,\n      event = action.event,\n      properties = action.properties;\n\n  switch (type) {\n    case EVENTS.track:\n      var trackEvent = serialize(objectSpread2(objectSpread2({\n        event: event,\n        properties: properties\n      }, Object.keys(options).length && {\n        options: options\n      }), {}, {\n        meta: meta\n      }));\n      return objectSpread2(objectSpread2({}, state), {\n        last: trackEvent,\n        // Todo prevent LARGE arrays https://bit.ly/2MnBwPT\n        history: state.history.concat(trackEvent)\n      });\n    // todo push events to history\n\n    default:\n      return state;\n  }\n}\n\n/*\nTODO figure out if this should live in state...\nQueue could be in mermory as well.\nBut also needs to be persisted to storage\n*/\n\nvar initialState$3 = {\n  actions: []\n};\nfunction queueReducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState$3;\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n  var type = action.type,\n      payload = action.payload;\n\n  switch (type) {\n    case 'queue':\n      var actionChain;\n      /* prioritize identify in event queue */\n\n      if (payload && payload.type && payload.type === EVENTS.identify) {\n        actionChain = [action].concat(state.actions);\n      } else {\n        actionChain = state.actions.concat(action);\n      }\n\n      return objectSpread2(objectSpread2({}, state), {}, {\n        actions: actionChain\n      });\n\n    case 'dequeue':\n      return [];\n    // todo push events to history\n\n    default:\n      return state;\n  }\n}\n\nfunction listen(events, func, toAdd) {\n  if (!analyticsUtils.inBrowser) return false;\n  var fn = window[(toAdd ? 'add' : 'remove') + 'EventListener'];\n  events.split(' ').forEach(function (ev) {\n    fn(ev, func);\n  });\n}\n\nfunction check() {\n  return Promise.resolve(!navigator.onLine);\n}\nfunction watch(cb) {\n  var fn = function fn(_) {\n    return check().then(cb);\n  };\n\n  var listener = listen.bind(null, 'online offline', fn);\n  listener(true); // return unsubscribe\n\n  return function (_) {\n    return listener(false);\n  };\n}\n\nfunction getCallbackFromArgs() {\n  return Array.prototype.slice.call(arguments).reduce(function (acc, arg) {\n    if (acc) return acc;\n\n    if (analyticsUtils.isFunction(arg)) {\n      return arg;\n    }\n\n    return acc;\n  }, false);\n}\n\nfunction Debug() {\n  // initialize global history\n\n  var prePostFix = '__'; // __analytics__\n\n  var globalVariable = prePostFix + LIBRARY_NAME + prePostFix;\n  analyticsUtils.globalContext[globalVariable] = [];\n  return function (createStore$$1) {\n    return function (reducer, preloadedState, enhancer) {\n      var store = createStore$$1(reducer, preloadedState, enhancer);\n      var origDispatch = store.dispatch;\n\n      var dispatch = function dispatch(action) {\n        var a = action.action || action;\n        analyticsUtils.globalContext[globalVariable].push(a);\n        return origDispatch(action);\n      };\n\n      return Object.assign(store, {\n        dispatch: dispatch\n      });\n    };\n  };\n}\nfunction composeWithDebug(config) {\n  return function () {\n    return compose(compose.apply(null, arguments), Debug(config));\n  };\n}\n\nfunction ensureArray(strOrArr) {\n  if (!strOrArr) return [];\n  return analyticsUtils.isString(strOrArr) ? [strOrArr] : strOrArr;\n}\n\nvar _setItem = setItem,\n    _removeItem = removeItem;\n/**\n * Analytics library configuration\n *\n * After the library is initialized with config, the core API is exposed & ready for use in the application.\n *\n * @param {object} config - analytics core config\n * @param {string} [config.app] - Name of site / app\n * @param {string} [config.version] - Version of your app\n * @param {boolean} [config.debug] - Should analytics run in debug mode\n * @param {Array.<AnalyticsPlugin>}  [config.plugins] - Array of analytics plugins\n * @return {AnalyticsInstance} Analytics Instance\n * @example\n *\n * import Analytics from 'analytics'\n * import pluginABC from 'analytics-plugin-abc'\n * import pluginXYZ from 'analytics-plugin-xyz'\n *\n * // initialize analytics\n * const analytics = Analytics({\n *   app: 'my-awesome-app',\n *   plugins: [\n *     pluginABC,\n *     pluginXYZ\n *   ]\n * })\n *\n */\n\nfunction analytics() {\n  var config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var customReducers = config.reducers || {};\n  /* Parse plugins array */\n\n  var parsedOptions = (config.plugins || []).reduce(function (acc, plugin) {\n    if (analyticsUtils.isFunction(plugin)) {\n      /* Custom redux middleware */\n      acc.middlewares = acc.middlewares.concat(plugin);\n      return acc;\n    } // Legacy plugin with name\n\n\n    if (plugin.NAMESPACE) plugin.name = plugin.NAMESPACE;\n\n    if (!plugin.name) {\n      /* Plugins must supply a \"name\" property. See error url for more details */\n      throw new Error(ERROR_URL + '1');\n    } // if plugin exposes EVENTS capture available events\n\n\n    var definedEvents = plugin.EVENTS ? Object.keys(plugin.EVENTS).map(function (k) {\n      return plugin.EVENTS[k];\n    }) : [];\n    var enabledFromMerge = !(plugin.enabled === false);\n    var enabledFromPluginConfig = !(plugin.config && plugin.config.enabled === false); // top level { enabled: false } takes presidence over { config: enabled: false }\n\n    acc.pluginEnabled[plugin.name] = enabledFromMerge && enabledFromPluginConfig;\n    delete plugin.enabled;\n\n    if (plugin.methods) {\n      acc.methods[plugin.name] = Object.keys(plugin.methods).reduce(function (a, c) {\n        // enrich methods with analytics instance\n        a[c] = appendArguments(plugin.methods[c]);\n        return a;\n      }, {}); // Remove additional methods from plugins\n\n      delete plugin.methods;\n    } // Convert available methods into events\n\n\n    var methodsToEvents = Object.keys(plugin); // Combine events\n\n    var allEvents = methodsToEvents.concat(definedEvents); // Dedupe events list\n\n    var allEventsUnique = new Set(acc.events.concat(allEvents));\n    acc.events = Array.from(allEventsUnique);\n    acc.pluginsArray = acc.pluginsArray.concat(plugin);\n\n    if (acc.plugins[plugin.name]) {\n      throw new Error(plugin.name + ' already loaded');\n    }\n\n    acc.plugins[plugin.name] = plugin;\n\n    if (!acc.plugins[plugin.name].loaded) {\n      // set default loaded func\n      acc.plugins[plugin.name].loaded = function () {\n        return true;\n      };\n    }\n\n    return acc;\n  }, {\n    plugins: {},\n    pluginEnabled: {},\n    methods: {},\n    pluginsArray: [],\n    middlewares: [],\n    events: []\n  });\n  /* Storage by default is set to global & is not persisted */\n\n  var storage = config.storage ? config.storage : {\n    getItem: function getItem(key) {\n      return analyticsUtils.globalContext[key];\n    },\n    setItem: function setItem$$1(key, value) {\n      return analyticsUtils.globalContext[key] = value;\n    },\n    removeItem: function removeItem$$1(key) {\n      return analyticsUtils.globalContext[key] = undefined;\n    }\n  };\n  var getUserProp = getUserPropFunc(storage); // mutable intregrations object for dynamic loading\n\n  var customPlugins = parsedOptions.plugins;\n  /* Grab all registered events from plugins loaded */\n\n  var pluginEvents = parsedOptions.events.filter(function (name) {\n    return !nonEvents.includes(name);\n  });\n  var uniqueEvents = new Set(pluginEvents.concat(coreEvents).filter(function (name) {\n    return !nonEvents.includes(name);\n  }));\n  var allSystemEvents = Array.from(uniqueEvents).sort();\n  var allPluginEvents = pluginEvents.sort();\n  /* plugin methods(functions) must be kept out of state. thus they live here */\n\n  var getPlugins = function getPlugins() {\n    return customPlugins;\n  };\n\n  var _ref = new DynamicMiddleware(),\n      addMiddleware = _ref.addMiddleware,\n      removeMiddleware = _ref.removeMiddleware,\n      dynamicMiddlewares = _ref.dynamicMiddlewares;\n\n  var nonAbortable = function nonAbortable() {\n    // throw new Error(`${ERROR_URL}3`)\n    throw new Error('Abort disabled in listener');\n  }; // Async promise resolver\n\n\n  var resolvePromise = function resolvePromise(resolver, cb) {\n    return function (payload) {\n      if (cb) cb(payload);\n      resolver(payload);\n    };\n  }; // Parse URL parameters\n\n\n  var params = analyticsUtils.paramsParse(); // Initialize visitor information\n\n  var initialUser = getPersistedUserData(params, storage);\n  /**\n   * Async Management methods for plugins. \n   * \n   * This is also where [custom methods](https://bit.ly/329vFXy) are loaded into the instance.\n   * @typedef {Object} Plugins\n   * @property {EnablePlugin} enable - Set storage value\n   * @property {DisablePlugin} disable - Remove storage value\n   * @example\n   *\n   * // Enable a plugin by namespace\n   * analytics.plugins.enable('keenio')\n   *\n   * // Disable a plugin by namespace\n   * analytics.plugins.disable('google-analytics')\n   */\n\n  var plugins = objectSpread2({\n    /**\n     * Enable analytics plugin\n     * @typedef {Function} EnablePlugin\n     * @param  {String|Array} plugins - name of plugins(s) to disable\n     * @param  {Function} [callback] - callback after enable runs\n     * @returns {Promise}\n     * @example\n     *\n     * analytics.plugins.enable('google-analytics').then(() => {\n     *   console.log('do stuff')\n     * })\n     *\n     * // Enable multiple plugins at once\n     * analytics.plugins.enable(['google-analytics', 'segment']).then(() => {\n     *   console.log('do stuff')\n     * })\n     */\n    enable: function enable(plugins, callback) {\n      var time = analyticsUtils.uuid();\n      return new Promise(function (resolve) {\n        stack[time] = resolvePromise(resolve, callback);\n        store.dispatch({\n          type: EVENTS.enablePlugin,\n          plugins: ensureArray(plugins),\n          ts: time,\n          _: {\n            originalAction: EVENTS.enablePlugin\n          }\n        });\n      });\n    },\n\n    /**\n     * Disable analytics plugin\n     * @typedef {Function} DisablePlugin\n     * @param  {String|Array} plugins - name of integration(s) to disable\n     * @param  {Function} callback - callback after disable runs\n     * @returns {Promise}\n     * @example\n     *\n     * analytics.plugins.disable('google').then(() => {\n     *   console.log('do stuff')\n     * })\n     *\n     * analytics.plugins.disable(['google', 'segment']).then(() => {\n     *   console.log('do stuff')\n     * })\n     */\n    disable: function disable(plugins, callback) {\n      var time = analyticsUtils.uuid();\n      return new Promise(function (resolve) {\n        stack[time] = resolvePromise(resolve, callback);\n        store.dispatch({\n          type: EVENTS.disablePlugin,\n          plugins: ensureArray(plugins),\n          ts: time,\n          _: {\n            originalAction: EVENTS.disablePlugin\n          }\n        });\n      });\n    }\n  }, parsedOptions.methods);\n  /**\n   * Analytic instance returned from initialization\n   * @typedef {Object} AnalyticsInstance\n   * @property {Identify} identify - Identify a user\n   * @property {Track} track - Track an analytics event\n   * @property {Page} page - Trigger page view\n   * @property {User} user - Get user data\n   * @property {Reset} reset - Clear information about user & reset analytics\n   * @property {Ready} ready - Fire callback on analytics ready event\n   * @property {On} on - Fire callback on analytics lifecycle events.\n   * @property {Once} once - Fire callback on analytics lifecycle events once.\n   * @property {GetState} getState - Get data about user, activity, or context.\n   * @property {Storage} storage - storage methods\n   * @property {Plugins} plugins - plugin methods\n   */\n\n\n  var instance = {\n    /**\n    * Identify a user. This will trigger `identify` calls in any installed plugins and will set user data in localStorage\n    * @typedef {Function} Identify\n    * @param  {String}   userId  - Unique ID of user\n    * @param  {Object}   [traits]  - Object of user traits\n    * @param  {Object}   [options] - Options to pass to identify call\n    * @param  {Function} [callback] - Callback function after identify completes\n    * @returns {Promise}\n    * @api public\n    *\n    * @example\n    *\n    * // Basic user id identify\n    * analytics.identify('xyz-123')\n    *\n    * // Identify with additional traits\n    * analytics.identify('xyz-123', {\n    *   name: 'steve',\n    *   company: 'hello-clicky'\n    * })\n    *\n    * // Fire callback with 2nd or 3rd argument\n    * analytics.identify('xyz-123', () => {\n    *   console.log('do this after identify')\n    * })\n    *\n    * // Disable sending user data to specific analytic tools\n    * analytics.identify('xyz-123', {}, {\n    *   plugins: {\n    *     // disable sending this identify call to segment\n    *     segment: false\n    *   }\n    * })\n    *\n    * // Send user data to only to specific analytic tools\n    * analytics.identify('xyz-123', {}, {\n    *   plugins: {\n    *     // disable this specific identify in all plugins except customerio\n    *     all: false,\n    *     customerio: true\n    *   }\n    * })\n    */\n    identify: function identify(userId, traits, options, callback) {\n      var id = analyticsUtils.isString(userId) ? userId : null;\n      var data = analyticsUtils.isObject(userId) ? userId : traits;\n      var opts = options || {};\n      var user = instance.user();\n      /* sets temporary in memory id. Not to be relied on */\n\n      analyticsUtils.globalContext[tempKey(ID)] = id;\n      var resolvedId = id || data.userId || getUserProp(ID, instance, data);\n      return new Promise(function (resolve, reject) {\n        store.dispatch(objectSpread2(objectSpread2({\n          type: EVENTS.identifyStart,\n          userId: resolvedId,\n          traits: data || {},\n          options: opts,\n          anonymousId: user.anonymousId\n        }, user.id && user.id !== id && {\n          previousId: user.id\n        }), {}, {\n          meta: {\n            timestamp: timeStamp(),\n            callback: resolvePromise(resolve, getCallbackFromArgs(traits, options, callback))\n          }\n        }));\n      });\n    },\n\n    /**\n     * Track an analytics event. This will trigger `track` calls in any installed plugins\n     * @typedef {Function} Track\n     * @param  {String}   eventName - Event name\n     * @param  {Object}   [payload]   - Event payload\n     * @param  {Object}   [options]   - Event options\n     * @param  {Function} [callback]  - Callback to fire after tracking completes\n     * @returns {Promise}\n     * @api public\n     *\n     * @example\n     *\n     * // Basic event tracking\n     * analytics.track('buttonClicked')\n     *\n     * // Event tracking with payload\n     * analytics.track('itemPurchased', {\n     *   price: 11,\n     *   sku: '1234'\n     * })\n     *\n     * // Fire callback with 2nd or 3rd argument\n     * analytics.track('newsletterSubscribed', () => {\n     *   console.log('do this after track')\n     * })\n     *\n     * // Disable sending this event to specific analytic tools\n     * analytics.track('cartAbandoned', {\n     *   items: ['xyz', 'abc']\n     * }, {\n     *   plugins: {\n     *     // disable track event for segment\n     *     segment: false\n     *   }\n     * })\n     *\n     * // Send event to only to specific analytic tools\n     * analytics.track('customerIoOnlyEventExample', {\n     *   price: 11,\n     *   sku: '1234'\n     * }, {\n     *   plugins: {\n     *     // disable this specific track call all plugins except customerio\n     *     all: false,\n     *     customerio: true\n     *   }\n     * })\n     */\n    track: function track(eventName, payload, options, callback) {\n      var name = analyticsUtils.isObject(eventName) ? eventName.event : eventName;\n\n      if (!name || !analyticsUtils.isString(name)) {\n        throw new Error('Event missing');\n      }\n\n      var data = analyticsUtils.isObject(eventName) ? eventName : payload || {};\n      var opts = analyticsUtils.isObject(options) ? options : {};\n      return new Promise(function (resolve, reject) {\n        store.dispatch({\n          type: EVENTS.trackStart,\n          event: name,\n          properties: data,\n          options: opts,\n          userId: getUserProp(ID, instance, payload),\n          anonymousId: getUserProp(ANONID, instance, payload),\n          meta: {\n            timestamp: timeStamp(),\n            callback: resolvePromise(resolve, getCallbackFromArgs(payload, options, callback))\n          }\n        });\n      });\n    },\n\n    /**\n     * Trigger page view. This will trigger `page` calls in any installed plugins\n     * @typedef {Function} Page\n     * @param  {PageData} [data] - Page data overrides.\n     * @param  {Object}   [options] - Page tracking options\n     * @param  {Function} [callback] - Callback to fire after page view call completes\n     * @returns {Promise}\n     * @api public\n     *\n     * @example\n     *\n     * // Basic page tracking\n     * analytics.page()\n     *\n     * // Page tracking with page data overrides\n     * analytics.page({\n     *   url: 'https://google.com'\n     * })\n     *\n     * // Fire callback with 1st, 2nd or 3rd argument\n     * analytics.page(() => {\n     *   console.log('do this after page')\n     * })\n     *\n     * // Disable sending this pageview to specific analytic tools\n     * analytics.page({}, {\n     *   plugins: {\n     *     // disable page tracking event for segment\n     *     segment: false\n     *   }\n     * })\n     *\n     * // Send pageview to only to specific analytic tools\n     * analytics.page({}, {\n     *   plugins: {\n     *     // disable this specific page in all plugins except customerio\n     *     all: false,\n     *     customerio: true\n     *   }\n     * })\n     */\n    page: function page$$1(data, options, callback) {\n      var d = analyticsUtils.isObject(data) ? data : {};\n      var opts = analyticsUtils.isObject(options) ? options : {};\n      return new Promise(function (resolve, reject) {\n        store.dispatch({\n          type: EVENTS.pageStart,\n          properties: getPageData(d),\n          options: opts,\n          userId: getUserProp(ID, instance, d),\n          anonymousId: getUserProp(ANONID, instance, d),\n          meta: {\n            timestamp: timeStamp(),\n            callback: resolvePromise(resolve, getCallbackFromArgs(data, options, callback))\n          }\n        });\n      });\n    },\n\n    /**\n     * Get user data\n     * @typedef {Function} User\n     * @param {string} [key] - dot.prop.path of user data. Example: 'traits.company.name'\n     * @returns {string|object} value of user data or null\n     *\n     * @example\n     *\n     * // Get all user data\n     * const userData = analytics.user()\n     *\n     * // Get user id\n     * const userId = analytics.user('userId')\n     *\n     * // Get user company name\n     * const companyName = analytics.user('traits.company.name')\n     */\n    user: function user(key) {\n      if (key === ID || key === 'id') {\n        var findId = getUserProp(ID, instance);\n        return findId;\n      }\n\n      var user = instance.getState('user');\n      if (!key) return user;\n      return analyticsUtils.dotProp(user, key);\n    },\n\n    /**\n     * Clear all information about the visitor & reset analytic state.\n     * @typedef {Function} Reset\n     * @param {Function} [callback] - Handler to run after reset\n     * @returns {Promise}\n     * @example\n     *\n     * // Reset current visitor\n     * analytics.reset()\n     */\n    reset: function reset(callback) {\n      return new Promise(function (resolve, reject) {\n        store.dispatch({\n          type: EVENTS.resetStart,\n          timestamp: timeStamp(),\n          callback: resolvePromise(resolve, callback)\n        });\n      });\n    },\n\n    /**\n     * Fire callback on analytics ready event\n     * @typedef {Function} Ready\n     * @param  {Function} callback - function to trigger when all providers have loaded\n     * @returns {DetachListeners} - Function to detach listener\n     *\n     * @example\n     *\n     * analytics.ready() => {\n     *   console.log('all plugins have loaded or were skipped', payload)\n     * })\n     */\n    ready: function ready(callback) {\n      return instance.on(EVENTS.ready, callback);\n    },\n\n    /**\n     * Attach an event handler function for analytics lifecycle events.\n     * @typedef {Function} On\n     * @param  {String}   name - Name of event to listen to\n     * @param  {Function} callback - function to fire on event\n     * @return {DetachListeners} - Function to detach listener\n     *\n     * @example\n     *\n     * // Fire function when 'track' calls happen\n     * analytics.on('track', ({ payload }) => {\n     *   console.log('track call just happened. Do stuff')\n     * })\n     *\n     * // Remove listener before it is called\n     * const removeListener = analytics.on('track', ({ payload }) => {\n     *   console.log('This will never get called')\n     * })\n     *\n     * // cleanup .on listener\n     * removeListener()\n     */\n    on: function on(name, callback) {\n      if (!name || !analyticsUtils.isFunction(callback)) {\n        return false;\n      }\n\n      if (name === EVENTS.bootstrap) {\n        throw new Error('.on disabled for ' + name);\n      }\n\n      var startRegex = /Start$|Start:/;\n\n      if (name === '*') {\n        var beforeHandler = function beforeHandler(store) {\n          return function (next) {\n            return function (action) {\n              if (action.type.match(startRegex)) {\n                callback({\n                  // eslint-disable-line\n                  payload: action,\n                  instance: instance,\n                  plugins: customPlugins\n                });\n              }\n\n              return next(action);\n            };\n          };\n        };\n\n        var afterHandler = function afterHandler(store) {\n          return function (next) {\n            return function (action) {\n              if (!action.type.match(startRegex)) {\n                callback({\n                  // eslint-disable-line\n                  payload: action,\n                  instance: instance,\n                  plugins: customPlugins\n                });\n              }\n\n              return next(action);\n            };\n          };\n        };\n\n        addMiddleware(beforeHandler, before);\n        addMiddleware(afterHandler, after);\n        /**\n         * Detach listeners\n         * @typedef {Function} DetachListeners\n         */\n\n        return function () {\n          removeMiddleware(beforeHandler, before);\n          removeMiddleware(afterHandler, after);\n        };\n      }\n\n      var position = name.match(startRegex) ? before : after; // eslint-disable-line\n\n      var handler = function handler(store) {\n        return function (next) {\n          return function (action) {\n            // Subscribe to EVERYTHING\n            if (action.type === name) {\n              callback({\n                // eslint-disable-line\n                payload: action,\n                instance: instance,\n                plugins: customPlugins,\n                abort: nonAbortable\n              });\n            }\n            /* For future matching of event subpaths `track:*` etc\n            } else if (name.match(/\\*$/)) {\n              const match = (name === '*') ? '.' : name\n              const regex = new RegExp(`${match}`, 'g')\n            } */\n\n\n            return next(action);\n          };\n        };\n      };\n\n      addMiddleware(handler, position);\n      return function () {\n        return removeMiddleware(handler, position);\n      };\n    },\n\n    /**\n     * Attach a handler function to an event and only trigger it only once.\n     * @typedef {Function} Once\n     * @param  {String} name - Name of event to listen to\n     * @param  {Function} callback - function to fire on event\n     * @return {DetachListeners} - Function to detach listener\n     *\n     * @example\n     *\n     * // Fire function only once 'track'\n     * analytics.once('track', ({ payload }) => {\n     *   console.log('This will only triggered once when analytics.track() fires')\n     * })\n     *\n     * // Remove listener before it is called\n     * const listener = analytics.once('track', ({ payload }) => {\n     *   console.log('This will never get called b/c listener() is called')\n     * })\n     *\n     * // cleanup .once listener before it fires\n     * listener()\n     */\n    once: function once(name, callback) {\n      if (!name || !analyticsUtils.isFunction(callback)) {\n        return false;\n      }\n\n      if (name === EVENTS.bootstrap) {\n        throw new Error('.once disabled for ' + name);\n      }\n\n      var listener = instance.on(name, function (_ref2) {\n        var payload = _ref2.payload;\n        callback({\n          // eslint-disable-line\n          payload: payload,\n          instance: instance,\n          plugins: customPlugins,\n          abort: nonAbortable\n        }); // detach listener after its called once\n\n        listener();\n      });\n      return listener;\n    },\n\n    /**\n     * Get data about user, activity, or context. Access sub-keys of state with `dot.prop` syntax.\n     * @typedef {Function} GetState\n     * @param  {string} [key] - dot.prop.path value of state\n     * @return {any}\n     *\n     * @example\n     *\n     * // Get the current state of analytics\n     * analytics.getState()\n     *\n     * // Get a subpath of state\n     * analytics.getState('context.offline')\n     */\n    getState: function getState(key) {\n      var state = store.getState();\n      if (key) return analyticsUtils.dotProp(state, key);\n      return Object.assign({}, state);\n    },\n\n    /*\n     * Emit events for other plugins or middleware to react to.\n     * @param  {Object} action - event to dispatch\n     */\n    dispatch: function dispatch(action) {\n      var actionData = analyticsUtils.isString(action) ? {\n        type: action\n      } : action;\n\n      if (isReservedAction(actionData.type)) {\n        throw new Error('reserved action ' + actionData.type);\n      }\n\n      var meta = actionData.meta || {};\n\n      var _private = action._ || {}; // Dispatch actionStart\n      // const autoPrefixType = `${theAction.type.replace(/Start$/, '')}Start`\n\n\n      var dispatchData = objectSpread2(objectSpread2({}, actionData), {}, {\n        meta: objectSpread2({\n          timestamp: timeStamp()\n        }, meta),\n        _: objectSpread2({\n          originalAction: actionData.type\n        }, _private) // type: `${autoPrefixType}`\n\n      });\n\n      store.dispatch(dispatchData);\n    },\n    // Do not use. Will be removed. Here for Backwards compatiblity.\n    // Moved to analytics.plugins.enable\n    enablePlugin: plugins.enable,\n    /// Do not use. Will be removed. Here for Backwards compatiblity.\n    /// Moved to analytics.plugins.disable\n    disablePlugin: plugins.disable,\n    // Do not use. Will be removed. Here for Backwards compatiblity.\n    // Moved to analytics.plugins.load\n    // loadPlugin: plugins.load,\n    // New plugins api\n    plugins: plugins,\n\n    /**\n     * Storage utilities for persisting data.\n     * These methods will allow you to save data in localStorage, cookies, or to the window.\n     * @typedef {Object} Storage\n     * @property {GetItem} getItem - Get value from storage\n     * @property {SetItem} setItem - Set storage value\n     * @property {RemoveItem} removeItem - Remove storage value\n     *\n     * @example\n     *\n     * // Pull storage off analytics instance\n     * const { storage } = analytics\n     *\n     * // Get value\n     * storage.getItem('storage_key')\n     *\n     * // Set value\n     * storage.setItem('storage_key', 'value')\n     *\n     * // Remove value\n     * storage.removeItem('storage_key')\n     */\n    storage: {\n      /**\n       * Get value from storage\n       * @typedef {Function} GetItem\n       * @param {String} key - storage key\n       * @param {Object} [options] - storage options\n       * @return {Any}\n       *\n       * @example\n       *\n       * analytics.storage.getItem('storage_key')\n       */\n      getItem: storage.getItem,\n\n      /**\n       * Set storage value\n       * @typedef {Function} SetItem\n       * @param {String} key - storage key\n       * @param {any} value - storage value\n       * @param {Object} [options] - storage options\n       *\n       * @example\n       *\n       * analytics.storage.setItem('storage_key', 'value')\n       */\n      setItem: function setItem$$1(key, value, options) {\n        store.dispatch(_setItem(key, value, options));\n      },\n\n      /**\n       * Remove storage value\n       * @typedef {Function} RemoveItem\n       * @param {String} key - storage key\n       * @param {Object} [options] - storage options\n       *\n       * @example\n       *\n       * analytics.storage.removeItem('storage_key')\n       */\n      removeItem: function removeItem$$1(key, options) {\n        store.dispatch(_removeItem(key, options));\n      }\n    },\n\n    /*\n     * Set the anonymous ID of the visitor\n     * @param {String} anonymousId - anonymous Id to set\n     * @param {Object} [options] - storage options\n     *\n     * @example\n     *\n     * // Set anonymous ID\n     * analytics.setAnonymousId('1234567')\n     */\n    setAnonymousId: function setAnonymousId(anonymousId, options) {\n      instance.storage.setItem(ANON_ID, anonymousId, options);\n    },\n\n    /*\n     * Events exposed by core analytics library and all loaded plugins\n     * @type {Array}\n     */\n    events: {\n      all: allSystemEvents,\n      core: coreEvents,\n      plugins: allPluginEvents // byType: (type) => {} @Todo grab logic from engine and give inspectable events\n\n    }\n  };\n  var middlewares = parsedOptions.middlewares.concat([\n  /* Core analytics middleware */\n  dynamicMiddlewares(before), // Before dynamic middleware <-- fixed pageStart .on listener\n\n  /* Plugin engine */\n  pluginMiddleware(instance, getPlugins, {\n    all: allSystemEvents,\n    plugins: allPluginEvents\n  }), storageMiddleware(storage), initializeMiddleware(instance), identifyMiddleware(instance),\n  /* after dynamic middleware */\n  dynamicMiddlewares(after)]);\n  /* Initial analytics state keys */\n\n  var coreReducers = {\n    context: context,\n    user: userReducer(storage),\n    page: page,\n    track: trackReducer,\n    plugins: createReducer(getPlugins),\n    queue: queueReducer\n  };\n  var composeEnhancers = compose;\n  var composeWithGlobalDebug = compose;\n\n  if (analyticsUtils.inBrowser && config.debug) {\n    var devTools = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__;\n\n    if (devTools) {\n      composeEnhancers = devTools({\n        trace: true,\n        traceLimit: 25\n      });\n    }\n\n    composeWithGlobalDebug = function composeWithGlobalDebug() {\n      if (arguments.length === 0) return Debug();\n      if (analyticsUtils.isObject(_typeof_1(arguments[0]))) return composeWithDebug(arguments[0]);\n      return composeWithDebug().apply(null, arguments);\n    };\n  }\n\n  var initialConfig = makeContext(config);\n  var intialPluginState = parsedOptions.pluginsArray.reduce(function (acc, plugin) {\n    var name = plugin.name,\n        config = plugin.config,\n        loaded = plugin.loaded;\n    var isEnabled = parsedOptions.pluginEnabled[name];\n    acc[name] = {\n      enabled: isEnabled,\n      // If plugin enabled & has no initialize method, set initialized to true, else false\n      initialized: isEnabled ? Boolean(!plugin.initialize) : false,\n      loaded: Boolean(loaded()),\n      config: config || {}\n    };\n    return acc;\n  }, {});\n  var initialState = {\n    context: initialConfig,\n    user: initialUser,\n    plugins: intialPluginState // Todo allow for more userland defined initial state?\n\n    /* Create analytics store! */\n\n  };\n  var store = createStore( // register reducers\n  combineReducers(objectSpread2(objectSpread2({}, coreReducers), customReducers)), // set user defined initial state\n  initialState, // register middleware & plugins used\n  composeWithGlobalDebug(composeEnhancers(applyMiddleware.apply(void 0, toConsumableArray(middlewares)))));\n  /* Synchronously call bootstrap & register Plugin methods */\n\n  var pluginKeys = Object.keys(customPlugins);\n  /* Bootstrap analytic plugins */\n\n  store.dispatch({\n    type: EVENTS.bootstrap,\n    plugins: pluginKeys,\n    config: initialConfig,\n    params: params,\n    user: initialUser\n  });\n  var enabledPlugins = pluginKeys.filter(function (name) {\n    return parsedOptions.pluginEnabled[name];\n  });\n  var disabledPlugins = pluginKeys.filter(function (name) {\n    return !parsedOptions.pluginEnabled[name];\n  });\n  /* Register analytic plugins */\n\n  store.dispatch({\n    type: EVENTS.registerPlugins,\n    plugins: pluginKeys,\n    enabled: parsedOptions.pluginEnabled\n  });\n  /* dispatch register for individual plugins */\n\n  parsedOptions.pluginsArray.map(function (plugin, i) {\n    var bootstrap = plugin.bootstrap,\n        config = plugin.config,\n        name = plugin.name;\n\n    if (bootstrap && analyticsUtils.isFunction(bootstrap)) {\n      bootstrap({\n        instance: instance,\n        config: config,\n        payload: plugin\n      });\n    }\n    /* Register plugins */\n\n\n    store.dispatch({\n      type: EVENTS.registerPluginType(name),\n      name: name,\n      enabled: parsedOptions.pluginEnabled[name],\n      plugin: plugin\n    });\n    /* All plugins registered initialize, is last loop */\n\n    if (parsedOptions.pluginsArray.length === i + 1) {\n      store.dispatch({\n        type: EVENTS.initializeStart,\n        plugins: enabledPlugins,\n        disabled: disabledPlugins\n      });\n    }\n  });\n\n  {\n    /* Watch for network events */\n    watch(function (offline) {\n      store.dispatch({\n        type: offline ? EVENTS.offline : EVENTS.online\n      });\n    });\n    /* Tick heartbeat for queued events */\n\n    heartBeat(store, getPlugins, instance);\n  }\n\n  function appendArguments(fn) {\n    return function () {\n      var originalArgs = Array.prototype.slice.call(arguments); // Pass analytics instance as last arg for arrow functions\n\n      var argsToPass = Array.apply(null, Array(fn.length)).map(function () {}).map(function (x, i) {\n        if (originalArgs[i] || originalArgs[i] === false || originalArgs[i] === null) {\n          return originalArgs[i];\n        }\n      }) // Add instance to args\n      .concat(instance); // Set instance on extended methods\n\n      return fn.apply({\n        instance: instance\n      }, argsToPass);\n    };\n  }\n  /* Return analytics instance */\n\n\n  return instance;\n} // Duplicated strings\n\n\nvar before = 'before';\nvar after = 'after'; // const uId = 'userId'\n\nexports.default = analytics;\nexports.init = analytics;\nexports.Analytics = analytics;\nexports.EVENTS = EVENTS;\nexports.CONSTANTS = constants;\n","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nfunction _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }\n\nvar dlv = _interopDefault(require('dlv'));\nvar storageUtils = require('@analytics/storage-utils');\nvar storageUtils__default = _interopDefault(storageUtils);\n\nfunction _typeof(obj) {\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function (obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function (obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction isFunction(x) {\n  return typeof x === 'function';\n}\nfunction isString(x) {\n  return typeof x === 'string';\n}\nfunction isUndefined(x) {\n  return typeof x === 'undefined';\n}\nfunction isBoolean(x) {\n  return typeof x === 'boolean';\n}\nfunction isArray(x) {\n  return Array.isArray(x);\n}\nfunction isObject(obj) {\n  if (_typeof(obj) !== 'object' || obj === null) return false;\n  var proto = obj;\n\n  while (Object.getPrototypeOf(proto) !== null) {\n    proto = Object.getPrototypeOf(proto);\n  }\n\n  return Object.getPrototypeOf(obj) === proto;\n}\n\nfunction decode(s) {\n  try {\n    return decodeURIComponent(s.replace(/\\+/g, ' '));\n  } catch (e) {\n    return null;\n  }\n}\n\nvar inBrowser = typeof document !== 'undefined';\n\nfunction getBrowserLocale() {\n  if (!inBrowser) return;\n  var _navigator = navigator,\n      language = _navigator.language,\n      languages = _navigator.languages,\n      userLanguage = _navigator.userLanguage;\n  if (userLanguage) return userLanguage; // IE only\n\n  return languages && languages.length ? languages[0] : language;\n}\n\nfunction getTimeZone() {\n  try {\n    return Intl.DateTimeFormat().resolvedOptions().timeZone;\n  } catch (error) {}\n}\n\nfunction isExternalReferrer(ref) {\n  if (!inBrowser) return false;\n  var referrer = ref || document.referrer;\n\n  if (referrer) {\n    var port = window.document.location.port;\n    var _ref = referrer.split('/')[2];\n\n    if (port) {\n      _ref = _ref.replace(\":\".concat(port), '');\n    }\n\n    return _ref !== window.location.hostname;\n  }\n\n  return false;\n}\n\n/**\n * Check if a script is loaded\n * @param  {String|RegExp} script - Script src as string or regex\n * @return {Boolean} is script loaded\n */\n\nfunction isScriptLoaded(script) {\n  if (!inBrowser) return true;\n  var scripts = document.getElementsByTagName('script');\n  return !!Object.keys(scripts).filter(function (key) {\n    var src = scripts[key].src;\n\n    if (typeof script === 'string') {\n      return src.indexOf(script) !== -1;\n    } else if (script instanceof RegExp) {\n      return src.match(script);\n    }\n\n    return false;\n  }).length;\n}\n\nfunction noOp() {}\n\nfunction paramsClean(url, param) {\n  var search = (url.split('?') || [,])[1]; // eslint-disable-line\n\n  if (!search || search.indexOf(param) === -1) {\n    return url;\n  } // remove all utm params from URL search\n\n\n  var regex = new RegExp(\"(\\\\&|\\\\?)\".concat(param, \"([_A-Za-z0-9\\\"+=.\\\\/\\\\-@%]+)\"), 'g');\n  var cleanSearch = \"?\".concat(search).replace(regex, '').replace(/^&/, '?'); // replace search params with clean params\n\n  var cleanURL = url.replace(\"?\".concat(search), cleanSearch); // use browser history API to clean the params\n\n  return cleanURL;\n}\n\n/**\n * Get a given query parameter value\n * @param  {string} param - Key of parameter to find\n * @param  {string} url - url to search\n * @return {string} match\n */\n\nfunction getValueParamValue(param, url) {\n  return decode((RegExp(\"\".concat(param, \"=(.+?)(&|$)\")).exec(url) || [, ''])[1]);\n}\n\n/**\n * Get search string from given url\n * @param  {string} [url] - optional url string. If no url, window.location.search will be used\n * @return {string} url search string\n */\n\nfunction getSearchString(url) {\n  if (url) {\n    var p = url.match(/\\?(.*)/);\n    return p && p[1] ? p[1].split('#')[0] : '';\n  }\n\n  return inBrowser && window.location.search.substring(1);\n}\n/**\n * Parse url parameters into javascript object\n * @param  {string} [url] - URI to parse. If no url supplied window.location will be used\n * @return {object} parsed url parameters\n */\n\n\nfunction paramsParse(url) {\n  return getParamsAsObject(getSearchString(url));\n}\n/*\n?first=abc&a[]=123&a[]=false&b[]=str&c[]=3.5&a[]=last\nhttps://random.url.com?Target=Report&Method=getStats&fields%5B%5D=Offer.name&fields%5B%5D=Advertiser.company&fields%5B%5D=Stat.clicks&fields%5B%5D=Stat.conversions&fields%5B%5D=Stat.cpa&fields%5B%5D=Stat.payout&fields%5B%5D=Stat.date&fields%5B%5D=Stat.offer_id&fields%5B%5D=Affiliate.company&groups%5B%5D=Stat.offer_id&groups%5B%5D=Stat.date&filters%5BStat.affiliate_id%5D%5Bconditional%5D=EQUAL_TO&filters%5BStat.affiliate_id%5D%5Bvalues%5D=1831&limit=9999\nhttps://random.url.com?Target=Offer&Method=findAll&filters%5Bhas_goals_enabled%5D%5BTRUE%5D=1&filters%5Bstatus%5D=active&fields%5B%5D=id&fields%5B%5D=name&fields%5B%5D=default_goal_name\nhttp://localhost:3000/?Target=Offer&Method=findAll&filters[has_goals_enabled][TRUE]=1&filters[status]=active&filters[wow]arr[]=yaz&filters[wow]arr[]=naz&fields[]=id&fields[]=name&fields[]=default_goal_name */\n\nfunction getParamsAsObject(query) {\n  var params = {};\n  var temp;\n  var re = /([^&=]+)=?([^&]*)/g;\n\n  while (temp = re.exec(query)) {\n    var k = decode(temp[1]);\n    var v = decode(temp[2]);\n\n    if (k.substring(k.length - 2) === '[]') {\n      k = k.substring(0, k.length - 2);\n      (params[k] || (params[k] = [])).push(v);\n    } else {\n      params[k] = v === '' ? true : v;\n    }\n  }\n\n  for (var prop in params) {\n    var arr = prop.split('[');\n\n    if (arr.length > 1) {\n      assign(params, arr.map(function (x) {\n        return x.replace(/[?[\\]\\\\ ]/g, '');\n      }), params[prop]);\n      delete params[prop];\n    }\n  }\n\n  return params;\n}\n\nfunction assign(obj, keyPath, value) {\n  var lastKeyIndex = keyPath.length - 1;\n\n  for (var i = 0; i < lastKeyIndex; ++i) {\n    var key = keyPath[i];\n\n    if (!(key in obj)) {\n      obj[key] = {};\n    }\n\n    obj = obj[key];\n  }\n\n  obj[keyPath[lastKeyIndex]] = value;\n}\n/*\nhttps://github.com/choojs/nanoquery/blob/791cbdfe49cc380f0b2f93477572128946171b46/browser.js\nvar reg = /([^?=&]+)(=([^&]*))?/g\n\nfunction qs (url) {\n  var obj = {}\n  url.replace(/^.*\\?/, '').replace(reg, function (a0, a1, a2, a3) {\n    var value = decodeURIComponent(a3)\n    var key = decodeURIComponent(a1)\n    if (obj.hasOwnProperty(key)) {\n      if (Array.isArray(obj[key])) obj[key].push(value)\n      else obj[key] = [obj[key], value]\n    } else {\n      obj[key] = value\n    }\n  })\n  return obj\n}\n*/\n\n/**\n * Removes params from url in browser\n * @param  {string}   param       - param key to remove from current URL\n * @param  {function} [callback]  - callback function to run. Only runs in browser\n * @return {promise}\n */\n\nfunction paramsRemove(param, callback) {\n  if (!inBrowser) return Promise.resolve();\n  return new Promise(function (resolve, reject) {\n    if (window.history && window.history.replaceState) {\n      var url = window.location.href;\n      var cleanUrl = paramsClean(url, param);\n\n      if (url !== cleanUrl) {\n        /* replace URL with history API */\n        // eslint-disable-next-line no-restricted-globals\n        history.replaceState({}, '', cleanUrl);\n      }\n    }\n\n    if (callback) callback();\n    return resolve();\n  });\n}\n\n/**\n * Get host domain of url\n * @param  {String} url - href of page\n * @return {String} hostname of page\n *\n * @example\n *  getDomainHost('https://subdomain.my-site.com/')\n *  > subdomain.my-site.com\n */\n\nfunction getDomainHost(url) {\n  if (!inBrowser) return null;\n  var a = document.createElement('a');\n  a.setAttribute('href', url);\n  return a.hostname;\n}\n/**\n * Get host domain of url\n * @param  {String} url - href of page\n * @return {String} base hostname of page\n *\n * @example\n *  getDomainBase('https://subdomain.my-site.com/')\n *  > my-site.com\n */\n\nfunction getDomainBase(url) {\n  var host = getDomainHost(url) || '';\n  return host.split('.').slice(-2).join('.');\n}\n/**\n * Remove TLD from domain string\n * @param  {String} baseDomain - host name of site\n * @return {String}\n * @example\n *  trimTld('google.com')\n *  > google\n */\n\nfunction trimTld(baseDomain) {\n  var arr = baseDomain.split('.');\n  return arr.length > 1 ? arr.slice(0, -1).join('.') : baseDomain;\n}\nvar url = {\n  trimTld: trimTld,\n  getDomainBase: getDomainBase,\n  getDomainHost: getDomainHost\n};\n\nvar googleKey = 'google';\n/**\n * Checks a given url and parses referrer data\n * @param  {String} [referrer] - (optional) referring URL\n * @param  {String} [currentUrl] - (optional) the current url\n * @return {Object}     [description]\n */\n\nfunction parseReferrer(referrer, currentUrl) {\n  if (!inBrowser) return false; // default referral data\n\n  var refData = {\n    'source': '(direct)',\n    'medium': '(none)',\n    'campaign': '(not set)' // Add raw ref url if external\n\n  };\n\n  if (referrer && isExternalReferrer(referrer)) {\n    refData.referrer = referrer;\n  }\n\n  var domainInfo = parseDomain(referrer); // Read referrer URI and infer source\n\n  if (domainInfo && Object.keys(domainInfo).length) {\n    refData = Object.assign({}, refData, domainInfo);\n  } // Read URI params and use set utm params\n\n\n  var params = paramsParse(currentUrl);\n  var paramKeys = Object.keys(params);\n\n  if (!paramKeys.length) {\n    return refData;\n  } // set campaign params off GA matches\n\n\n  var gaParams = paramKeys.reduce(function (acc, key) {\n    // match utm params & dclid (display) & gclid (cpc)\n    if (key.match(/^utm_/)) {\n      acc[\"\".concat(key.replace(/^utm_/, ''))] = params[key];\n    } // https://developers.google.com/analytics/devguides/collection/protocol/v1/parameters\n    // dclid - cpc Cost-Per-Thousand Impressions\n    // gclid - cpc Cost per Click\n\n\n    if (key.match(/^(d|g)clid/)) {\n      acc['source'] = googleKey;\n      acc['medium'] = params.gclid ? 'cpc' : 'cpm';\n      acc[key] = params[key];\n    }\n\n    return acc;\n  }, {});\n  return Object.assign({}, refData, gaParams);\n}\n/**\n * Client side domain parser for determining marketing data.\n * @param  {String} referrer - ref url\n * @return {Object}\n */\n\nfunction parseDomain(referrer) {\n  if (!referrer || !inBrowser) return false;\n  var referringDomain = getDomainBase(referrer);\n  var a = document.createElement('a');\n  a.href = referrer; // Shim for the billion google search engines\n\n  if (a.hostname.indexOf(googleKey) > -1) {\n    referringDomain = googleKey;\n  } // If is search engine\n\n\n  if (searchEngines[referringDomain]) {\n    var searchEngine = searchEngines[referringDomain];\n    var queryParam = typeof searchEngine === 'string' ? searchEngine : searchEngine.p;\n    var termRegex = new RegExp(queryParam + '=.*?([^&#]*|$)', 'gi');\n    var term = a.search.match(termRegex);\n    return {\n      source: searchEngine.n || trimTld(referringDomain),\n      medium: 'organic',\n      term: (term ? term[0].split('=')[1] : '') || '(not provided)'\n    };\n  } // Default\n\n\n  var medium = !isExternalReferrer(referrer) ? 'internal' : 'referral';\n  return {\n    source: a.hostname,\n    medium: medium\n  };\n}\n/**\n * Search engine query string data\n * @type {Object}\n */\n\n\nvar Q = 'q';\nvar QUERY = 'query';\nvar searchEngines = {\n  'daum.net': Q,\n  'eniro.se': 'search_word',\n  'naver.com': QUERY,\n  'yahoo.com': 'p',\n  'msn.com': Q,\n  'aol.com': Q,\n  'ask.com': Q,\n  'baidu.com': 'wd',\n  'yandex.com': 'text',\n  'rambler.ru': 'words',\n  'google': Q,\n  'bing.com': {\n    'p': Q,\n    'n': 'live'\n  }\n};\n\nfunction uuid() {\n  var u = '',\n      m = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx',\n      i = 0,\n      rb = Math.random() * 0xffffffff | 0;\n\n  while (i++ < 36) {\n    var c = m[i - 1],\n        r = rb & 0xf,\n        v = c == 'x' ? r : r & 0x3 | 0x8;\n    u += c == '-' || c == '4' ? c : v.toString(16);\n    rb = i % 8 == 0 ? Math.random() * 0xffffffff | 0 : rb >> 4;\n  }\n\n  return u;\n}\n\nfunction throttle(func, wait) {\n  var context, args, result;\n  var timeout = null;\n  var previous = 0;\n\n  var later = function later() {\n    previous = new Date();\n    timeout = null;\n    result = func.apply(context, args);\n  };\n\n  return function () {\n    var now = new Date();\n\n    if (!previous) {\n      previous = now;\n    }\n\n    var remaining = wait - (now - previous);\n    context = this;\n    args = arguments;\n\n    if (remaining <= 0) {\n      clearTimeout(timeout);\n      timeout = null;\n      previous = now;\n      result = func.apply(context, args);\n    } else if (!timeout) {\n      timeout = setTimeout(later, remaining);\n    }\n\n    return result;\n  };\n}\n\nexports.dotProp = dlv;\nexports.storage = storageUtils__default;\nexports.getCookie = storageUtils.getCookie;\nexports.setCookie = storageUtils.setCookie;\nexports.globalContext = storageUtils.globalContext;\nexports.removeCookie = storageUtils.removeCookie;\nexports.isFunction = isFunction;\nexports.isString = isString;\nexports.isArray = isArray;\nexports.isObject = isObject;\nexports.isUndefined = isUndefined;\nexports.isBoolean = isBoolean;\nexports.decodeUri = decode;\nexports.getBrowserLocale = getBrowserLocale;\nexports.getTimeZone = getTimeZone;\nexports.inBrowser = inBrowser;\nexports.isExternalReferrer = isExternalReferrer;\nexports.isScriptLoaded = isScriptLoaded;\nexports.noOp = noOp;\nexports.paramsClean = paramsClean;\nexports.paramsGet = getValueParamValue;\nexports.paramsParse = paramsParse;\nexports.paramsRemove = paramsRemove;\nexports.parseReferrer = parseReferrer;\nexports.url = url;\nexports.uuid = uuid;\nexports.throttle = throttle;\n","!function(t,n){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=function(t,n,e,i,o){for(n=n.split?n.split(\".\"):n,i=0;i<n.length;i++)t=t?t[n[i]]:o;return t===o?e:t}:\"function\"==typeof define&&define.amd?define(function(){return function(t,n,e,i,o){for(n=n.split?n.split(\".\"):n,i=0;i<n.length;i++)t=t?t[n[i]]:o;return t===o?e:t}}):t.dlv=function(t,n,e,i,o){for(n=n.split?n.split(\".\"):n,i=0;i<n.length;i++)t=t?t[n[i]]:o;return t===o?e:t}}(this);\n//# sourceMappingURL=dlv.umd.js.map\n","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar cookieUtils = require('@analytics/cookie-utils');\n\nfunction hasLocalStorage() {\n\n  try {\n    if (typeof localStorage === 'undefined' || typeof JSON === 'undefined') {\n      return false;\n    } // test for safari private\n\n\n    localStorage.setItem('_t_', '1');\n    localStorage.removeItem('_t_');\n  } catch (err) {\n    return false;\n  }\n\n  return true;\n}\n\nfunction _typeof(obj) {\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function (obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function (obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction parse(input) {\n  var value;\n\n  try {\n    value = JSON.parse(input);\n\n    if (typeof value === 'undefined') {\n      value = input;\n    }\n\n    if (value === 'true') {\n      value = true;\n    }\n\n    if (value === 'false') {\n      value = false;\n    }\n\n    if (parseFloat(value) === value && _typeof(value) !== 'object') {\n      value = parseFloat(value);\n    }\n  } catch (e) {\n    value = input;\n  }\n\n  return value;\n}\n\nvar globalContext = (typeof self === \"undefined\" ? \"undefined\" : _typeof(self)) === 'object' && self.self === self && self || (typeof global === \"undefined\" ? \"undefined\" : _typeof(global)) === 'object' && global.global === global && global || undefined;\n\nvar LOCAL_STORAGE = 'localStorage';\nvar COOKIE = 'cookie';\nvar GLOBAL = 'global'; // Verify support\n\nvar hasStorage = hasLocalStorage();\nvar hasCookies = cookieUtils.hasCookieSupport();\n/**\n * Get storage item from localStorage, cookie, or window\n * @param  {string} key - key of item to get\n * @param  {object|string} [options] - storage options. If string location of where to get storage\n * @param  {string} [options.storage] - Define type of storage to pull from.\n * @return {Any}  the value of key\n */\n\nfunction getItem(key) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  if (!key) return null;\n  var storageType = getStorageType(options); // Get value from all locations\n\n  if (storageType === 'all') return getAll(key);\n  /* 1. Try localStorage */\n\n  if (useLocal(storageType)) {\n    var value = localStorage.getItem(key);\n    if (value || storageType === LOCAL_STORAGE) return parse(value);\n  }\n  /* 2. Fallback to cookie */\n\n\n  if (useCookie(storageType)) {\n    var _value = cookieUtils.getCookie(key);\n\n    if (_value || storageType === COOKIE) return parse(_value);\n  }\n  /* 3. Fallback to window/global. */\n\n\n  return globalContext[key] || null;\n}\n\nfunction getAll(key) {\n  return {\n    cookie: parse(cookieUtils.getCookie(key)),\n    localStorage: parse(localStorage.getItem(key)),\n    global: globalContext[key] || null\n  };\n}\n/**\n * Store values in localStorage, cookie, or window\n * @param {string} key - key of item to set\n * @param {*} value - value of item to set\n * @param {object|string} [options] - storage options. If string location of where to get storage\n * @param {string} [options.storage] - Define type of storage to pull from.\n * @returns {object} returns old value, new values, & location of storage\n */\n\n\nfunction setItem(key, value) {\n  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  if (!key || !value) return false;\n  var storageType = getStorageType(options);\n  var saveValue = JSON.stringify(value);\n  /* 1. Try localStorage */\n\n  if (useLocal(storageType)) {\n    // console.log('SET as localstorage', saveValue)\n    var _oldValue = parse(localStorage.getItem(key));\n\n    localStorage.setItem(key, saveValue);\n    return {\n      value: value,\n      oldValue: _oldValue,\n      location: LOCAL_STORAGE\n    };\n  }\n  /* 2. Fallback to cookie */\n\n\n  if (useCookie(storageType)) {\n    // console.log('SET as cookie', saveValue)\n    var _oldValue2 = parse(cookieUtils.getCookie(key));\n\n    cookieUtils.setCookie(key, saveValue);\n    return {\n      value: value,\n      oldValue: _oldValue2,\n      location: COOKIE\n    };\n  }\n  /* 3. Fallback to window/global */\n\n\n  var oldValue = globalContext[key];\n  globalContext[key] = value;\n  return {\n    value: value,\n    oldValue: oldValue,\n    location: GLOBAL\n  };\n}\n/**\n * Remove values from localStorage, cookie, or window\n * @param {string} key - key of item to set\n * @param {object|string} [options] - storage options. If string location of where to get storage\n * @param {string} [options.storage] - Define type of storage to pull from.\n */\n\nfunction removeItem(key) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  if (!key) return false;\n  var storageType = getStorageType(options);\n\n  if (useLocal(storageType)) {\n    /* 1. Try localStorage */\n    localStorage.removeItem(key);\n    return LOCAL_STORAGE;\n  } else if (useCookie(storageType)) {\n    /* 2. Fallback to cookie */\n    cookieUtils.removeCookie(key);\n    return COOKIE;\n  }\n  /* 3. Fallback to window/global */\n\n\n  globalContext[key] = undefined;\n  return GLOBAL;\n}\n\nfunction getStorageType(options) {\n  return typeof options === 'string' ? options : options.storage;\n}\n\nfunction useLocal(storage) {\n  return hasStorage && (!storage || storage === LOCAL_STORAGE);\n}\n\nfunction useCookie(storage) {\n  return hasCookies && (!storage || storage === COOKIE);\n}\nvar index = {\n  getItem: getItem,\n  setItem: setItem,\n  removeItem: removeItem\n};\n\nexports.getCookie = cookieUtils.getCookie;\nexports.setCookie = cookieUtils.setCookie;\nexports.removeCookie = cookieUtils.removeCookie;\nexports.hasCookieSupport = cookieUtils.hasCookieSupport;\nexports.getItem = getItem;\nexports.setItem = setItem;\nexports.removeItem = removeItem;\nexports.globalContext = globalContext;\nexports.hasLocalStorageSupport = hasLocalStorage;\nexports.default = index;\n","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\n/*\n// set\ncookie('test', 'a')\n\n// complex set - cookie(name, value, ttl, path, domain, secure)\ncookie('test', 'a', 60*60*24, '/api', '*.example.com', true)\n\n// get\ncookie('test')\n\n// destroy\ncookie('test', '', -1)\n*/\nfunction cookie(name, value, ttl, path, domain, secure) {\n  if (typeof window === 'undefined') return;\n  /* Set values */\n\n  if (arguments.length > 1) {\n    // eslint-disable-next-line no-return-assign\n    return document.cookie = name + '=' + encodeURIComponent(value) + ( // eslint-disable-next-line operator-linebreak\n    !ttl ? '' : // Has TTL set expiration on cookie\n    '; expires=' + new Date(+new Date() + ttl * 1000).toUTCString() + ( // If path set path\n    !path ? '' : '; path=' + path) + ( // If domain set domain\n    !domain ? '' : '; domain=' + domain) + ( // If secure set secure\n    !secure ? '' : '; secure'));\n  }\n\n  return decodeURIComponent((('; ' + document.cookie).split('; ' + name + '=')[1] || '').split(';')[0]);\n}\n\nfunction hasCookieSupport() {\n  try {\n    var key = '_c_'; // Try to set cookie\n\n    cookie(key, '1');\n    var valueSet = document.cookie.indexOf(key) !== -1; // Cleanup cookie\n\n    cookie(key, '', -1);\n    return valueSet;\n  } catch (e) {\n    return false;\n  }\n}\n\n/**\n * Get a cookie value\n * @param  {string} name - key of cookie\n * @return {string} value of cookie\n */\n\nvar getCookie = cookie;\n/**\n * Set a cookie value\n * @param {string} name  - key of cookie\n * @param {string} value - value of cookie\n * @param {string} days  - days to keep cookie\n */\n\nvar setCookie = cookie;\n/**\n * Remove a cookie value.\n * @param {string} name  - key of cookie\n */\n\nfunction removeCookie(name) {\n  return cookie(name, '', -1);\n}\n\nexports.hasCookieSupport = hasCookieSupport;\nexports.setCookie = setCookie;\nexports.getCookie = getCookie;\nexports.removeCookie = removeCookie;\n","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\n// googleAnalytics events from a node server environment.\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\n/* global ga */\nvar defaultConfig = {\n  /* See description below */\n  trackingId: null,\n\n  /* See description below */\n  debug: false,\n\n  /* See description below */\n  anonymizeIp: false,\n\n  /* See description below */\n  customDimensions: {},\n\n  /* See description below */\n  resetCustomDimensionsOnPage: [],\n\n  /* See description below */\n  setCustomDimensionsToPage: true\n  /* Custom metrics https://bit.ly/3c5de88 */\n  // TODO customMetrics: { key: 'metric1' }\n\n  /* Content groupings https://bit.ly/39Zt3Me */\n  // TODO contentGroupings: { key: 'contentGroup1' }\n\n};\nvar loadedInstances = {};\n/**\n * Google analytics plugin\n * @link https://getanalytics.io/plugins/google-analytics/\n * @link https://analytics.google.com/analytics/web/\n * @link https://developers.google.com/analytics/devguides/collection/analyticsjs\n * @param {object}  pluginConfig - Plugin settings\n * @param {string}  pluginConfig.trackingId - Google Analytics site tracking Id\n * @param {boolean} [pluginConfig.debug] - Enable Google Analytics debug mode\n * @param {boolean} [pluginConfig.anonymizeIp] - Enable [Anonymizing IP addresses](https://bit.ly/3c660Rd) sent to Google Analytics. [See details below](#anonymize-visitor-ips)\n * @param {object}  [pluginConfig.customDimensions] - Map [Custom dimensions](https://bit.ly/3c5de88) to send extra information to Google Analytics. [See details below](#using-ga-custom-dimensions)\n * @param {object}  [pluginConfig.resetCustomDimensionsOnPage] - Reset custom dimensions by key on analytics.page() calls. Useful for single page apps.\n * @param {boolean} [pluginConfig.setCustomDimensionsToPage] - Mapped dimensions will be set to the page & sent as properties of all subsequent events on that page. If false, analytics will only pass custom dimensions as part of individual events\n * @param {string}  [pluginConfig.instanceName] - Custom tracker name for google analytics. Use this if you need multiple googleAnalytics scripts loaded\n * @param {string}  [pluginConfig.customScriptSrc] - Custom URL for google analytics script, if proxying calls\n * @param {object}  [pluginConfig.cookieConfig] - Additional cookie properties for configuring the [ga cookie](https://developers.google.com/analytics/devguides/collection/analyticsjs/cookies-user-id#configuring_cookie_field_settings)\n * @param {object}  [pluginConfig.tasks] - [Set custom google analytic tasks](https://developers.google.com/analytics/devguides/collection/analyticsjs/tasks)\n * @return {*}\n * @example\n *\n * googleAnalytics({\n *   trackingId: 'UA-1234567'\n * })\n */\n\nfunction googleAnalytics$1() {\n  var pluginConfig = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var pageCalledOnce = false; // Allow for multiple google analytics instances\n\n  var _getInstanceDetails = getInstanceDetails(pluginConfig),\n      instanceName = _getInstanceDetails.instanceName,\n      instancePrefix = _getInstanceDetails.instancePrefix;\n\n  return {\n    name: 'google-analytics',\n    config: _objectSpread({}, defaultConfig, pluginConfig),\n    // Load google analytics\n    initialize: function initialize(pluginApi) {\n      var config = pluginApi.config,\n          instance = pluginApi.instance;\n      if (!config.trackingId) throw new Error('No GA trackingId defined'); // var to hoist\n\n      var scriptSrc = config.customScriptSrc || 'https://www.google-analytics.com/analytics.js'; // Load google analytics script to page\n\n      if (gaNotLoaded(scriptSrc)) {\n        /* eslint-disable */\n        (function (i, s, o, g, r, a, m) {\n          i['GoogleAnalyticsObject'] = r;\n          i[r] = i[r] || function () {\n            (i[r].q = i[r].q || []).push(arguments);\n          }, i[r].l = 1 * new Date();\n          a = s.createElement(o), m = s.getElementsByTagName(o)[0];\n          a.async = 1;\n          a.src = g;\n          m.parentNode.insertBefore(a, m);\n        })(window, document, 'script', scriptSrc, 'ga');\n        /* eslint-enable */\n\n      } // Initialize tracker instance on page\n\n\n      if (!loadedInstances[instanceName]) {\n        var gaConfig = _objectSpread({\n          cookieDomain: config.domain || 'auto',\n          siteSpeedSampleRate: config.siteSpeedSampleRate || 1,\n          sampleRate: config.sampleRate || 100,\n          allowLinker: true\n        }, config.cookieConfig);\n\n        if (instanceName) {\n          gaConfig.name = instanceName;\n        }\n\n        ga('create', config.trackingId, gaConfig);\n\n        if (config.debug) {\n          // Disable sends to GA http://bit.ly/2Ro0vTR\n          ga(\"\".concat(instancePrefix, \"set\"), 'sendHitTask', null);\n          window.ga_debug = {\n            trace: true\n          };\n        }\n\n        if (config.anonymizeIp) {\n          ga(\"\".concat(instancePrefix, \"set\"), 'anonymizeIp', true);\n        }\n\n        if (config.tasks) {\n          var taskList = ['customTask', 'previewTask', 'checkProtocolTask', 'validationTask', 'checkStorageTask', 'historyImportTask', 'samplerTask', 'buildHitTask', 'sendHitTask', 'timingTask', 'displayFeaturesTask'];\n          taskList.forEach(function (taskName) {\n            if (config.tasks.hasOwnProperty(taskName)) {\n              var task = config.tasks[taskName];\n\n              if (typeof task === 'function') {\n                ga(config.tasks[taskName]);\n              } else if (task === null) {\n                ga(\"\".concat(instancePrefix, \"set\"), taskName, task);\n              }\n            }\n          });\n        }\n        /* set custom dimensions from user traits */\n\n\n        var user = instance.user() || {};\n        var traits = user.traits || {};\n\n        if (Object.keys(traits).length) {\n          var customDimensions = formatObjectIntoDimensions$1(traits, config);\n          ga(\"\".concat(instancePrefix, \"set\"), customDimensions);\n        }\n\n        loadedInstances[instanceName] = true;\n      }\n    },\n    // Google Analytics page view\n    page: function page(_ref) {\n      var payload = _ref.payload,\n          config = _ref.config,\n          instance = _ref.instance;\n      var properties = payload.properties;\n      var resetCustomDimensionsOnPage = config.resetCustomDimensionsOnPage,\n          customDimensions = config.customDimensions;\n      var campaign = instance.getState('context.campaign');\n      if (gaNotLoaded()) return;\n      /* If dimensions are specifiied to reset, clear them before page view */\n\n      if (resetCustomDimensionsOnPage && resetCustomDimensionsOnPage.length) {\n        var resetDimensions = resetCustomDimensionsOnPage.reduce(function (acc, key) {\n          if (customDimensions[key]) {\n            acc[customDimensions[key]] = null; // { dimension1: null } etc\n          }\n\n          return acc;\n        }, {});\n\n        if (Object.keys(resetDimensions).length) {\n          // Reset custom dimensions\n          ga(\"\".concat(instancePrefix, \"set\"), resetDimensions);\n        }\n      }\n\n      var path = properties.path || document.location.pathname;\n      var pageView = {\n        page: path,\n        title: properties.title,\n        location: properties.url\n      };\n      var pageData = {\n        page: path,\n        title: properties.title // allow referrer override if referrer was manually set\n\n      };\n\n      if (properties.referrer !== document.referrer) {\n        pageData.referrer = properties.referrer;\n      }\n\n      var campaignData = addCampaignData(campaign);\n      var dimensions = setCustomDimensions(properties, config, instancePrefix);\n      /* Dimensions will only be included in the event if config.setCustomDimensionsToPage is false */\n\n      var finalPayload = _objectSpread({}, pageView, campaignData, dimensions);\n\n      ga(\"\".concat(instancePrefix, \"set\"), pageData); // Remove location for SPA tracking after initial page view\n\n      if (pageCalledOnce) {\n        delete finalPayload.location;\n      }\n      /* send page view to GA */\n\n\n      ga(\"\".concat(instancePrefix, \"send\"), 'pageview', finalPayload); // Set after initial page view\n\n      pageCalledOnce = true;\n    },\n\n    /**\n     * Google Analytics track event\n     * @example\n     *\n     * analytics.track('playedVideo', {\n     *   category: 'Videos',\n     *   label: 'Fall Campaign',\n     *   value: 42\n     * })\n     */\n    track: function track(_ref2) {\n      var payload = _ref2.payload,\n          config = _ref2.config,\n          instance = _ref2.instance;\n      var properties = payload.properties,\n          event = payload.event;\n      var label = properties.label,\n          value = properties.value,\n          category = properties.category,\n          nonInteraction = properties.nonInteraction;\n      var campaign = instance.getState('context.campaign'); // TODO inline this trackEvent\n\n      trackEvent$1({\n        hitType: 'event',\n        event: event,\n        label: label,\n        category: category || 'All',\n        value: value,\n        nonInteraction: nonInteraction,\n        campaign: campaign\n      }, config, payload);\n    },\n    identify: function identify(_ref3) {\n      var payload = _ref3.payload,\n          config = _ref3.config;\n      identifyVisitor$1(payload.userId, payload.traits, config);\n    },\n    loaded: function loaded() {\n      return !!window.gaplugins;\n    }\n  };\n}\n\nfunction gaNotLoaded(scriptSrc) {\n  if (scriptSrc) {\n    return !scriptLoaded(scriptSrc);\n  }\n\n  return typeof ga === 'undefined';\n}\n\nfunction getInstanceDetails(pluginConfig) {\n  var instanceName = pluginConfig.instanceName;\n  return {\n    instancePrefix: instanceName ? \"\".concat(instanceName, \".\") : '',\n    instanceName: instanceName\n  };\n}\n/**\n * Send event tracking to Google Analytics\n * @param  {object} eventData - GA event payload\n * @param  {string} [eventData.hitType = 'event'] - hitType https://bit.ly/2Jab9L1 one of 'pageview', 'screenview', 'event', 'transaction', 'item', 'social', 'exception', 'timing'\n * @param  {string} [eventData.event] - event Action https://bit.ly/2CUzeoz\n * @param  {string} [eventData.label] - event Label http://bit.ly/2oo8eb3\n * @param  {string} [eventData.category] - event Category http://bit.ly/2EAy9UP\n * @param  {string} [eventData.nonInteraction = false] - nonInteraction https://bit.ly/2CUzeoz\n * @return {object} sent data\n */\n\n\nfunction trackEvent$1(eventData) {\n  var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var payload = arguments.length > 2 ? arguments[2] : undefined;\n  if (gaNotLoaded()) return;\n\n  var _getInstanceDetails2 = getInstanceDetails(opts),\n      instancePrefix = _getInstanceDetails2.instancePrefix;\n\n  var data = {\n    // hitType https://bit.ly/2Jab9L1 one of 'pageview', 'screenview', 'event', 'transaction', 'item', 'social', 'exception', 'timing'\n    hitType: eventData.hitType || 'event',\n    // eventAction https://bit.ly/2CUzeoz\n    eventAction: eventData.event,\n    // eventLabel http://bit.ly/2oo8eb3\n    eventLabel: eventData.label,\n    // eventCategory http://bit.ly/2EAy9UP\n    eventCategory: eventData.category || 'All',\n    // nonInteraction https://bit.ly/2CUzeoz\n    nonInteraction: eventData.nonInteraction !== undefined ? !!eventData.nonInteraction : false\n  };\n\n  if (eventData.value) {\n    // how much is this action worth?\n    data.eventValue = format(eventData.value);\n  }\n  /* Attach campaign data */\n\n\n  var campaignData = addCampaignData(eventData);\n  /* Set Dimensions or return them for payload is config.setCustomDimensionsToPage is false */\n\n  var dimensions = setCustomDimensions(payload.properties, opts, instancePrefix);\n\n  var finalPayload = _objectSpread({}, data, campaignData, dimensions);\n  /* Send data to Google Analytics */\n\n\n  ga(\"\".concat(instancePrefix, \"send\"), 'event', finalPayload);\n  return finalPayload;\n}\n/**\n * Add campaign data to GA payload https://bit.ly/34qFCPn\n * @param {Object} [campaignData={}] [description]\n * @param {String} [campaignData.campaignName] - Name of campaign\n * @param {String} [campaignData.campaignSource] - Source of campaign\n * @param {String} [campaignData.campaignMedium] - Medium of campaign\n * @param {String} [campaignData.campaignContent] - Content of campaign\n * @param {String} [campaignData.campaignKeyword] - Keyword of campaign\n */\n\nfunction addCampaignData() {\n  var campaignData = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var campaign = {};\n  var name = campaignData.name,\n      source = campaignData.source,\n      medium = campaignData.medium,\n      content = campaignData.content,\n      keyword = campaignData.keyword;\n  if (name) campaign.campaignName = name;\n  if (source) campaign.campaignSource = source;\n  if (medium) campaign.campaignMedium = medium;\n  if (content) campaign.campaignContent = content;\n  if (keyword) campaign.campaignKeyword = keyword;\n  return campaign;\n}\n/* Todo add includeSearch options ¯\\_(ツ)_/¯\nfunction getPagePath(props, opts = {}) {\n  if (!props) return\n  if (opts.includeSearch && props.search) {\n    return `${props.path}${props.search}`\n  }\n  return props.path\n}\n*/\n// properties, data=opts\n\n\nfunction formatObjectIntoDimensions$1(properties) {\n  var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var customDimensions = opts.customDimensions; // TODO map opts.customMetrics; Object.keys(customMetrics) { key: 'metric1' }\n  // TODO map opts.contentGroupings; Object.keys(contentGroupings) { key: 'contentGroup1' }\n\n  /* Map values from payload to any defined custom dimensions */\n\n  return Object.keys(customDimensions).reduce(function (acc, key) {\n    var dimensionKey = customDimensions[key];\n    var value = get$1(properties, key) || properties[key];\n\n    if (typeof value === 'boolean') {\n      value = value.toString();\n    }\n\n    if (value || value === 0) {\n      acc[dimensionKey] = value;\n      return acc;\n    }\n\n    return acc;\n  }, {});\n}\n\nfunction get$1(obj, key, def, p, undef) {\n  key = key.split ? key.split('.') : key;\n\n  for (p = 0; p < key.length; p++) {\n    obj = obj ? obj[key[p]] : undef;\n  }\n\n  return obj === undef ? def : obj;\n}\n\nfunction setCustomDimensions() {\n  var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var opts = arguments.length > 1 ? arguments[1] : undefined;\n  var instancePrefix = arguments.length > 2 ? arguments[2] : undefined;\n  var customDimensions = formatObjectIntoDimensions$1(props, opts);\n\n  if (!Object.keys(customDimensions).length) {\n    return {};\n  } // If setCustomDimensionsToPage false, don't save custom dimensions from event to page\n\n\n  if (!opts.setCustomDimensionsToPage) {\n    return customDimensions;\n  } // Set custom dimensions\n\n\n  ga(\"\".concat(instancePrefix, \"set\"), customDimensions);\n  return {};\n}\n/**\n * Identify a visitor by Id\n * @param  {string} id - unique visitor ID\n */\n\n\nfunction identifyVisitor$1(id) {\n  var traits = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var conf = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  if (gaNotLoaded()) return;\n\n  var _getInstanceDetails3 = getInstanceDetails(conf),\n      instancePrefix = _getInstanceDetails3.instancePrefix;\n\n  if (id) ga(\"\".concat(instancePrefix, \"set\"), 'userId', id);\n\n  if (Object.keys(traits).length) {\n    var custom = formatObjectIntoDimensions$1(traits, conf);\n    ga(\"\".concat(instancePrefix, \"set\"), custom);\n  }\n}\n\nfunction scriptLoaded(scriptSrc) {\n  var scripts = document.querySelectorAll('script[src]');\n  return !!Object.keys(scripts).filter(function (key) {\n    return (scripts[key].src || '') === scriptSrc;\n  }).length;\n}\n\nfunction format(value) {\n  if (!value || value < 0) return 0;\n  return Math.round(value);\n}\n\nvar browser = /*#__PURE__*/Object.freeze({\n  default: googleAnalytics$1,\n  trackEvent: trackEvent$1,\n  identifyVisitor: identifyVisitor$1\n});\n\n/* This module will shake out unused code + work in browser and node 🎉 */\n\nvar index = googleAnalytics$1;\n/* init for CDN usage. globalName.init() */\n\nvar init = googleAnalytics$1;\n/* Standalone API */\n\nvar initialize$1 = undefined;\nvar page = undefined;\nvar track = trackEvent$1;\nvar identify = identifyVisitor$1;\n\nexports.default = index;\nexports.init = init;\nexports.identify = identify;\nexports.track = track;\nexports.page = page;\nexports.initialize = initialize$1;\n","const cacheLoader = require('../../cacheLoader');\n\nmodule.exports = cacheLoader(function loadJSBundle(bundle) {\n  return new Promise(function(resolve, reject) {\n    var script = document.createElement('script');\n    script.async = true;\n    script.type = 'text/javascript';\n    script.charset = 'utf-8';\n    script.src = bundle;\n    script.onerror = function(e) {\n      script.onerror = script.onload = null;\n      reject(e);\n    };\n\n    script.onload = function() {\n      script.onerror = script.onload = null;\n      resolve();\n    };\n\n    document.getElementsByTagName('head')[0].appendChild(script);\n  });\n});\n","\"use strict\";\n\nlet cachedBundles = {};\n\nmodule.exports = function (loader) {\n  return function (bundle) {\n    if (cachedBundles[bundle]) {\n      return cachedBundles[bundle];\n    }\n\n    return cachedBundles[bundle] = loader(bundle).catch(function (e) {\n      delete cachedBundles[bundle];\n      throw e;\n    });\n  };\n};"],"names":["require","register","JSON","parse","mapping","module","exports","pairs","keys","Object","i","length","id","resolved","Error","_install","_store","_speech","_audio","_timing","_ui","_locationHandler","_synthesizers","_midi","_camera","_visual","_patterns","_instructions","_person","_interopRequireWildcard","_reporting","_version","body","document","documentElement","main","querySelector","image","isRecording","startRecording","stopRecording","record","store","createStore","people","camera","photo","audio","midi","midiButton","reporter","kit","patterns","recorder","inputElement","video","isLoading","ultimateFailure","midiAvailable","cameraLoading","noFacesFound","counter","cameraPan","x","y","classList","toggle","ui","getLocationSettings","metronome","backingTrack","clear","transparent","synch","debug","muted","duet","quantise","text","spectrogram","speak","SETTINGS","maxFaces","shouldLoadIrisModel","toSay","hasSpeech","say","loadInstruments","async","method","callback","map","instrument","person","setToast","name","console","log","loadRandomInstrument","getPerson","index","undefined","options","dots","leftEyeIris","rightEyeIris","hue","Math","random","NAMES","savedOptions","has","getItem","Person","audioContext","randomInstrument","button","addEventListener","event","detail","cache","setItem","instrumentName","loadInstrument","outputs","setMIDI","push","enableMIDIForPerson","personIndex","portIndex","showMIDI","setupMIDIButton","setupMIDI","setFeedback","addListener","e","forEach","setText","add","error","enableMIDI","loadCamera","deviceId","newCamera","setupCamera","track","category","label","value","trackError","installation","loadMeter","loadingLoop","requestAnimationFrame","showReloadButton","remove","destination","getElementById","needsInstall","VERSION","style","display","needsUpdate","onLoaded","settings","progressCallback","loadIndex","loadModel","setupInterface","setToggle","status","addToHistory","toggleVideoVisiblity","isVideoVisible","setButton","unique","ceil","now","dimensions","getCanvasDimensions","img","Image","src","takePhotograph","alt","Date","toString","width","height","anchor","createElement","href","innerHTML","download","appendChild","scrollIntoView","setupReporting","then","setupImage","removeItem","videoCameraDevices","filterVideoCameras","detectCameras","setupCameraForm","selected","setProperty","updateCanvasSize","errorMessage","String","replace","setupAudio","createDrumkit","kitSequence","canvas","nodeName","toLowerCase","addToolTips","volume","parseFloat","setVolume","update","predictions","tickerTape","drawElement","t","overdraw","sin","cos","drawQuantise","getBar","updateByteFrequencyData","drawBars","dataArray","bufferLength","l","prediction","faceInViewConfidence","getHelp","floor","draw","stuff","sing","eyeDirection","pitch","roll","yaw","mouthRange","DEFAULT_OPTIONS","LIPS_RANGE","getInstruction","start","bar","bars","barsElapsed","timePassed","elapsed","expected","drift","level","intervals","lag","metronomeLength","clack","kick","playNextPart","snare","hat","playing","timePerBar","setup","assign","progress","progressBar","setAttribute","installer","updateApp","updater","updateAvailable","showUpdateButton","pwa","window","onbeforeunload","trackExit","oncontextmenu","key","innerText","previousInstrument","nextInstrument","b","getBars","setBars","setTimeBetween","getBPM","ub","ubars","ut","setNodeCount","cowbell","recording","mp3","encodeRecording","audioSrc","URL","createObjectURL","visibility","_manifest","isSupportingBrowser","hasOwnProperty","deferredPrompt","installed","hasPrompt","openModal","defer","manifestData","relatedApps","isIOS","navigator","userAgent","includes","maxTouchPoints","cancelInstall","Promise","resolve","reject","getManifestData","response","fetch","manifestPath","data","json","manifestToCheck","icons","description","err","begin","showInstaller","standalone","getInstalledRelatedApps","firstUpdated","matchMedia","matches","short_name","replaceAll","DATE","getDate","addTooltip","success","prompt","userChoice","outcome","install","preventDefault","once","_instruments","_utils","_fullScreen","buttonInstrument","buttonRecord","buttonQuantise","buttonMIDI","buttonVideo","controls","bindTextElement","element","rate","clearAfter","split","cachedMessage","interval","clearInterval","currentMessage","db","debounce","message","responseRate","join","clearTimeout","after","setTimeout","fragment","cameras","select","optionElements","selection","selectedIndex","INSTRUMENT_FOLDERS","folder","INSTRUMENT_NAMES","midiEnabled","test","toolTip","target","getAttribute","buttonName","toggleName","parentNode","action","query","querySelectorAll","h1","buttonShare","buttonSolo","buttonDuet","title","shareElement","url","getShareLink","canFullscreen","buttonFullscreen","fullscreen","toggleFullScreen","releaseDate","versionElement","currentVersion","formattedDate","getMonth","getFullYear","toLocaleTimeString","hour12","hour","minute","loadSoloMode","loadDuetMode","cleanTitle","wait","timerId","args","fullscreenEnabled","mozFullScreenEnabled","webkitRequestFullScreen","exitFullscreen","goFullscreen","requestFullscreen","fullscreenElement","guessType","lower","Array","isArray","indexOf","convertIntegerArrayToBooleans","isNaN","defaultOptions","locationOptions","urlParams","URLSearchParams","location","search","reload","toQuery","option","searchParams","set","history","pushState","mouth","mouthClosed","lipsUpperInner","lipsLowerInner","midwayBetweenEyes","leftEyeLower0","rightEyeLower0","white","dark","grey","cream","brown","blue","green","yellow","orange","red","getBundleURL","bundleURL","getBaseURL","stack","match","dirname","_filePath","filePath","slice","slashIndex","lastIndexOf","relative","from","to","fromParts","shift","divergeIndex","toParts","parts","apply","fromId","toId","_dirname","storage","localStorage","save","updates","encoded","stringify","getVoices","voices","startTime","waitForVoices","speechSynthesis","interupt","lang","filtered","filter","voice","getSpecificVoice","speech","SpeechSynthesisUtterance","voiceURI","onend","onerror","cancel","talk","pending","_maths","BANKS","NOTES_BLACK","NOTES_WHITE","mediaRecorder","gainNode","delayNode","feedbackNode","analyser","compressor","reverb","destinationVolume","active","BUFFER_SIZE","INPUT_CHANNELS","OUTPUT_CHANNELS","AudioContext","webkitAudioContext","createGain","gain","createDynamicsCompressor","threshold","knee","ratio","attack","release","createConvolver","createDelay","createAnalyser","minDecibels","maxDecibels","smoothingTimeConstant","fftSize","frequencyBinCount","Uint8Array","connect","createScriptProcessor","getByteFrequencyData","getByteTimeDomainData","monitor","result","state","resume","shape","oscillator","type","frequency","clamp","fadeVolume","newVolume","setValueAtTime","currentTime","amplitude","audioBuffer","offset","loop","trackSource","createBufferSource","buffer","onended","disconnect","createInstrumentBanks","fileTye","dot","bank","NOTE_NAMES","NOTE_NAMES_FRIENDLY","note","percent","octave","isMinor","noteNumber","noteName","loadInstrumentParts","path","instrumentPath","part","arrayBuffer","decodeAudioData","loadAudio","output","all","stream","isAvailable","MediaRecorder","isTypeSupported","Blob","downloadRecording","blob","recordedChunks","a","click","revokeObjectURL","ondataavailable","ev","onwarning","onstop","stop","PI","t1","pow","scaledTime","scaledTime1","sqrt","magnitude","scaledTime2","s","p","asin","easeInBounce","easeOutBounce","TAU","smallest","largest","range","end","amt","val","min","max","timingWorker","Worker","currentInterval","isRunning","time","postMessage","command","timeBetween","onmessage","accurateTiming","createQueue","factorymethod","quantity","instruments","createKick","osc","createOscillator","osc2","gainOsc","gainOsc2","inputDryNode","velocity","duration","cancelScheduledValues","exponentialRampToValueAtTime","createSnare","osc3","gainOsc3","filterGain","noise","createBuffer","sampleRate","createBiquadFilter","getChannelData","linearRampToValueAtTime","createHihat","gainOsc4","bandpass","highpass","oscillators","osc4","createClack","cowbellGainNode","Q","ratios","ocatave","createCowbell","createKicks","createSnares","createHihats","_webmidiEsm","WebMidi","enable","ports","catch","constructor","this","eventMap","eventsSuspended","n","r","ANY_EVENT","TypeError","prepend","unshift","addOneTimeListener","remaining","Symbol","for","hasListener","entries","some","eventNames","getListeners","suspendEvent","suspended","unsuspendEvent","getListenerCount","emit","concat","arguments","context","count","removeListener","[object Object]","parseInt","eventCount","ReferenceError","InputChannel","input","number","super","destroy","_parseEvent","dataBytes","wm","MIDI_SYSTEM_MESSAGES","sysex","midiMessageEvent","rawData","statusByte","timestamp","timeStamp","_parseEventForStandardMessages","getStructuredMidiMessage","data1","data2","MIDI_CHANNEL_VOICE_MESSAGES","noteoff","noteon","Note","rawRelease","rawAttack","keyaftertouch","rawValue","controlchange","controller","getCcNameByNumber","channelmode","getChannelModeByNumber","_parseChannelModeMessage","programchange","channelaftertouch","pitchbend","validation","cm","MIDI_CHANNEL_MODE_MESSAGES","RangeError","cc","MIDI_CONTROL_CHANGE_MESSAGES","Input","midiInput","_midiInput","channels","onstatechange","_onStateChange","bind","onmidimessage","_onMidiMessage","ch","close","port","connection","manufacturer","warn","channel","timecode","songposition","songselect","song","tunerequest","clock","continue","activesensing","reset","open","listener","listeners","sanitizeChannels","on","every","nrpnEventsEnabled","OutputChannel","send","setKeyAftertouch","pressure","useRawValue","Number","isInteger","round","getValidNoteArray","convertToTimestamp","sendControlChange","_selectNonRegisteredParameter","parameter","_deselectRegisteredParameter","_deselectNonRegisteredParameter","_selectRegisteredParameter","_setCurrentParameter","decrementRegisteredParameter","MIDI_REGISTERED_PARAMETER","valid","getOwnPropertyNames","incrementRegisteredParameter","playNote","sendNoteOn","isFinite","trim","NaN","noteOffOptions","sendNoteOff","rawVelocity","nVelocity","o","stopNote","sendChannelMode","setOmniMode","setChannelAftertouch","setMasterTuning","coarse","fine","msb","lsb","setRegisteredParameter","setModulationRange","semitones","cents","setNonRegisteredParameter","nrpn","setPitchBend","nLevel","setPitchBendRange","setProgram","program","rpn","setTuningBank","setTuningProgram","setLocalControl","turnNotesOff","turnSoundOff","resetAllControllers","setPolyphonicMode","mode","Output","midiOutput","_midiOutput","sendSysex","sysexend","sendTimecodeQuarterFrame","setSongPosition","sendSongPosition","setSong","sendSongSelect","sendTuneRequest","sendClock","sendStart","sendContinue","sendStop","sendActiveSensing","sendReset","sendTuningRequest","legacy","sendKeyAftertouch","sendChannelAftertouch","sendPitchBend","bend","sendProgramChange","Infinity","NOTES","_number","getOctave","guessNoteNumber","_duration","_rawAttack","_rawRelease","interface","_inputs","_outputs","_stateChangeQueue","_octaveOffset","isNode","global","performance","enabled","supported","intervalID","setInterval","requestMIDIAccess","software","_onInterfaceStateChange","_updateInputsAndOutputs","inputs","_destroyInputsAndOutputs","getInputById","getInputByName","getOutputByName","getOutputById","getNoteNumberByName","semitone","C","D","E","F","G","A","B","toUpperCase","octaveOffset","noteNameToNumber","toMIDIChannels","notes","getNoteObject","parsed","substring","promises","_updateInputs","_updateOutputs","updated","values","next","done","splice","nInput","j","nOutput","prototype","call","process","sysexEnabled","MIDI_CHANNEL_MESSAGES","allsoundoff","resetallcontrollers","localcontrol","allnotesoff","omnimodeoff","omnimodeon","monomodeon","polymodeon","bankselectcoarse","modulationwheelcoarse","breathcontrollercoarse","footcontrollercoarse","portamentotimecoarse","dataentrycoarse","volumecoarse","balancecoarse","pancoarse","expressioncoarse","effectcontrol1coarse","effectcontrol2coarse","generalpurposeslider1","generalpurposeslider2","generalpurposeslider3","generalpurposeslider4","bankselectfine","modulationwheelfine","breathcontrollerfine","footcontrollerfine","portamentotimefine","dataentryfine","volumefine","balancefine","panfine","expressionfine","effectcontrol1fine","effectcontrol2fine","holdpedal","portamento","sustenutopedal","softpedal","legatopedal","hold2pedal","soundvariation","resonance","soundreleasetime","soundattacktime","brightness","soundcontrol6","soundcontrol7","soundcontrol8","soundcontrol9","soundcontrol10","generalpurposebutton1","generalpurposebutton2","generalpurposebutton3","generalpurposebutton4","reverblevel","tremololevel","choruslevel","celestelevel","phaserlevel","databuttonincrement","databuttondecrement","nonregisteredparametercoarse","nonregisteredparameterfine","registeredparametercoarse","registeredparameterfine","MIDI_INTERFACE_EVENTS","MIDI_NRPN_MESSAGES","entrymsb","entrylsb","increment","decrement","paramlsb","parammsb","nullactiveparameter","pitchbendrange","channelfinetuning","channelcoarsetuning","tuningprogram","tuningbank","modulationrange","azimuthangle","elevationangle","distanceratio","maximumdistance","maximumdistancegain","referencedistanceratio","panspreadangle","rollangle","tuningrequest","midimessage","unknownsystemmessage","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","runTimeout","fun","currentQueue","queue","draining","queueIndex","cleanUpNextTick","drainQueue","timeout","len","run","marker","runClearTimeout","Item","array","noop","nextTick","browser","env","argv","version","versions","off","removeAllListeners","prependListener","prependOnceListener","binding","cwd","chdir","dir","umask","factory","define","amd","JZZ","MIDI","k","m","_scope","_time","getTime","_startTime","_now","_schedule","f","_R","_orig","_ready","_queue","_log","_then","good","bad","_bad","Function","_err","_wait","obj","delay","_crash","_resume","_kick","_break","_rechain","self","arg","ret","_image","_push","_and","q","_or","_close","_tryAny","arr","func","_slip","_repair","_pop","_J","_clone","_exec","_pause","_thenable","and","or","_info","info","engine","ver","_jzz","_outs","_ins","_outsW","_insW","_postRefresh","_engine","_type","_sysex","_allOuts","_allIns","_virtual","_watcher","_handles","diff","x0","y0","x1","y1","_changed","ax","ay","rx","ry","h","added","removed","_diff","_inMap","_closeAll","_outMap","_fireW","_refresh","_filterList","before","etc","RegExp","_notFound","msg","_openMidiOut","pack","_openOut","_openMidiIn","_openIn","_onChange","watcher","_connectW","_M","_receive","_emit","_connect","_disconnect","_mpe","MPE","_validateChannel","c","_C","chan","_port","_chan","_E","_master","_band","_W","_watch","_disconnectW","_unwatch","refresh","openMidiOut","_openMidiOutNR","openMidiIn","_openMidiInNR","onChange","_filter","out","outs","v","noteOn","noteOff","_stamp","_stamped","connected","mpe","validate","_navigator","_requestMIDIAccess","_tryNODE","_main","_pool","_newPlugin","_initEngineJP","_tryJazzPlugin","div","classid","isJazz","plg","_initJazzPlugin","_tryWebMIDI","_initWebMIDI","_tryWebMIDIsysex","_tryCRX","inst","eventHandle","removeEventListener","clients","_inArr","_outArr","refreshClients","_msg","plugin","dispatchEvent","CustomEvent","ready","client","impl","_start","_closeOut","_impl","_closeIn","ins","_initCRX","Event","_zeroBreak","_filterEngines","opt","web","none","dup","head","tail","_filterEngineNames","degrade","_initNONE","MidiOutInfo","MidiInInfo","MidiOutRaw","MidiOutOpen","MidiOutClose","handle","onmidi","MidiInOpen","MidiInClose","access","_access","found","dev","evt","_initAudioContext","_options","_initJZZ","SMPTE","_fixDropFrame","second","frame","_825","_mtc","backwards","quarter","decrFrame","incrFrame","_hrtype","_dec","_smptetxt","_from","noteValue","programValue","_throw","Widget","addMidiIn","widget","lib","registerMidiIn","addMidiOut","registerMidiOut","setType","getType","setHour","getHour","setMinute","getMinute","setSecond","getSecond","setFrame","getFrame","setQuarter","getQuarter","isFullFrame","incrQF","decrQF","read","_","_b","_f","_a","_noteNum","freq","_7b","f0","log2","to14b","_noteMap","d","g","_ch","_8b","_lsb","_msb","_helperCH","aftertouch","control","pitchBend","pitchBendF","bankMSB","bankLSB","modMSB","modLSB","breathMSB","breathLSB","footMSB","footLSB","portamentoMSB","portamentoLSB","dataMSB","dataLSB","volumeMSB","volumeLSB","balanceMSB","balanceLSB","panMSB","panLSB","expressionMSB","expressionLSB","damper","sostenuto","soft","dataIncr","dataDecr","nrpnLSB","nrpnMSB","rpnLSB","rpnMSB","allSoundOff","allNotesOff","_helperNC","mtc","songPosition","songSelect","tune","sxIdRequest","sxFullFrame","sxMasterVolume","sxMasterFineTuning","sxMasterCoarseTuning","_helperG","modF","mod","breathF","breath","footF","foot","portamentoTimeF","portamentoTime","dataF","volumeF","balanceF","balance","panF","pan","expressionF","expression","rpnPitchBendRange","rpnFineTuning","rpnCoarseTuning","rpnTuning","rpnTuningA","_helperGNC","sxMasterTuning","sxMasterTuningA","_smf","ff","dd","charCodeAt","_8bs","_helperSMF","smf","_2s","smfSeqNumber","fromCharCode","_smftxt","smfText","toUTF8","smfCopyright","smfSeqName","smfInstrName","smfLyric","smfMarker","smfCuePoint","smfProgName","smfDevName","smfChannelPrefix","smfMidiPort","smfEndOfTrack","smfTempo","smfBPM","bpm","smfSMPTE","smfTimeSignature","nn","bb","smfKeySignature","sf","CB","GB","DB","AB","EB","BB","H","F#","C#","G#","D#","A#","mi","","MAJ","MAJOR","DUR","M","MIN","MINOR","MOLL","smfSequencer","_copyPortHelper","_copyPortHelperG","_copyChannelHelper","_copyChannelHelperG","_copyHelperNC","_copyHelperSMF","_copyHelperG","_copyHelperCH","_copyMidiHelpers","_ac","_channelMap","_s2a","_a2s","__hex","_hex","_smfhex","_toLine","fromUTF8","createGainNode","_activateAudioContext","setTargetAtTime","getChannel","setChannel","getNote","setNote","getVelocity","setVelocity","getSysExChannel","setSysExChannel","getData","setData","getText","getTempo","ms","getTimeSignature","getKeySignature","isNoteOn","isNoteOff","isSysEx","isFullSysEx","isSMF","isEOT","isTempo","isTimeSignature","isKeySignature","ss","_s2n","ks","241","242","243","244","245","246","248","249","250","251","252","253","254","255","8","10","12","13","14","0","1","2","4","5","6","7","11","16","17","18","19","32","33","34","36","37","38","39","40","42","43","44","45","48","49","50","51","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","88","91","92","93","94","95","96","97","98","99","100","101","120","121","122","123","124","125","126","127","_unstamp","band","master","last","schedule","copyMidiHelpers","getAudioContext","_b64","fromBase64","chr1","chr2","chr3","enc2","enc3","enc4","charAt","toBase64","h2","h3","h4","bits","ac","enc","_wma","_outputMap","_inputMap","DOMException","code","MIDIConnectionEvent","bubbles","cancelBubble","cancelable","currentTarget","defaultPrevented","eventPhase","returnValue","srcElement","MIDIMessageEvent","receivedTime","_statechange","MIDIInput","_open","_ochng","_onmsg","man","defineProperty","get","enumerable","proxy","freeze","_split","_datalen","_InputProxy","executor","reconnect","_epr","MIDIOutput","_validate","_OutputProxy","_Maplike","Map","MIDIInputMap","MIDIOutputMap","_wm_watch","MIDIAccess","_onstatechange","wma","node","platform","arch","package","__dirname","devices","device","kind","mediaDevices","enumerateDevices","onloadedmetadata","play","videoWidth","videoHeight","videoConstraints","exact","facingMode","constraints","getUserMedia","srcObject","_palette","setSize","naturalWidth","naturalHeight","onloaded","loadImage","canvasContext","getContext","w","translate","scale","drawImage","restore","clearRect","radius","colour","lines","fillStyle","strokeStyle","moveTo","beginPath","arc","lineTo","fill","stroke","drawEye","eye","iris","inner","up","outer","down","strokeWidth","arcTo","drawNode","pointA","pointB","showText","PALETTE","font","textAlign","fillText","drawMouth","annotations","mouthWidth","mouthOpen","lips","lipUpperMiddle","lipLowerMiddle","mouthGradient","createLinearGradient","addColorStop","lip","drawText","size","align","strokeText","paragraph","lineHeight","textY","boundingBox","extra","bottomRight","topLeft","strokeRect","modifier","easeInQuad","nodeCount","cycleCounter","colourCycle","scaledMesh","depth","alpha","modifiedHue","DEFAULT_COLOURS","singing","extras","lineWidth","sliceWidth","toDataURL","barWidth","barHeight","fillRect","gaps","sequence","pattern","previous","newIndex","position","current","kickSequences","snareSequences","hatSequences","kickSequence","snareSequence","hatSequence","QUICK_START","INSTRUCTIONS","delayTime","delayLength","mouseHoldDuration","feedback","mouthCutOff","mouthSilence","volumeRate","precision","ease","linear","destinationNode","instrumentLoading","tracks","midiActive","midiChannel","saturation","isMouthOpen","mouseDownAt","lastNoteName","mouthScale","rescale","stereoNode","createStereoPanner","waitPatiently","mouseDownFor","isMouseDown","showForm","isMouseOver","isMouseHeld","controlsID","instrumentTitle","instrumentIndex","hasMIDI","drawPoints","drawFace","boxWidth","abs","boxHeight","silhouette","percentageRemaining","drawInstrument","drawPart","drawParagraph","MUSICAL_NOTES","paragraphs","toFixed","happiness","mouthRatio","lookingRight","lipPercentage","amp","newOctave","getNoteName","playTrack","midiOptions","onInstrumentInput","hideForm","setupInstrumentForm","focus","_analytics","_interopRequireDefault","_googleAnalytics","analytics","default","app","plugins","trackingId","page","_interopDefault","ex","analytics__default","configurable","writable","ownKeys","object","enumerableOnly","getOwnPropertySymbols","symbols","sym","getOwnPropertyDescriptor","objectSpread2","source","getOwnPropertyDescriptors","defineProperties","analyticsLib","opts","defaultSettings","EVENTS","CONSTANTS","init","Analytics","analyticsUtils","arrayWithoutHoles","arr2","iterableToArray","iter","iterator","nonIterableSpread","toConsumableArray","createCommonjsModule","fn","_typeof_1","_typeof2","_typeof","FUNC","UNDEF","ACTION_TEST","$$observable","observable","reducer","preloadedState","enhancer","currentReducer","currentState","currentListeners","nextListeners","isDispatching","ensureCanMutateNextListeners","getState","subscribe","isSubscribed","dispatch","isObject","base","replaceReducer","nextReducer","outerSubscribe","observer","observeState","unsubscribe","getUndefinedStateErrorMessage","actionType","combineReducers","reducers","reducerKeys","finalReducers","shapeAssertionError","finalReducerKeys","initialState","REDUCER","assertReducerShape","hasChanged","nextState","_i","_key","previousStateForKey","nextStateForKey","compose","_len","funcs","reduce","applyMiddleware","middlewares","chain","_dispatch","middlewareAPI","middleware","coreEvents","nonEvents","acc","curr","registerPluginType","pluginReadyType","isReservedAction","ANON_ID","USER_ID","USER_TRAITS","constants","utmRegex","propRegex","traitRegex","initializeMiddleware","instance","_instance$storage","bootstrap","params","user","anonymousId","paramsArray","an_uid","an_event","groupedParams","cleanName","keyName","campaign","props","traits","raw","userId","identify","ID","ANONID","userReducer","setItemEnd","globalContext","tempKey","getPersistedUserData","an_aid","uuid","getUserPropFunc","payload","currentId","persistedInfo","identifyMiddleware","isFunction","currentTraits","userIdChanged","old","new","regenerator","runtime","Op","hasOwn","$Symbol","iteratorSymbol","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","wrap","innerFn","outerFn","tryLocsList","protoGenerator","Generator","generator","create","Context","_invoke","doneResult","delegate","delegateResult","maybeInvokeDelegate","ContinueSentinel","sent","_sent","dispatchException","abrupt","tryCatch","makeInvokeMethod","GeneratorFunction","GeneratorFunctionPrototype","IteratorPrototype","getProto","getPrototypeOf","NativeIteratorPrototype","Gp","defineIteratorMethods","AsyncIterator","PromiseImpl","previousPromise","callInvokeWithMethodAndArg","invoke","__await","unwrapped","resultName","nextLoc","pushTryEntry","locs","entry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","resetTryEntry","completion","iterable","iteratorMethod","displayName","isGeneratorFunction","genFun","ctor","mark","setPrototypeOf","__proto__","awrap","reverse","pop","skipTempReset","prev","rootRecord","rval","exception","loc","caught","hasCatch","hasFinally","finallyEntry","complete","finish","thrown","delegateYield","regeneratorRuntime","accidentalStrictMode","asyncGeneratorStep","gen","_next","asyncToGenerator","runCallback","waitForReady","predicate","processQueue","getPlugins","pluginMethods","_store$getState","offline","actions","pipeline","item","loaded","processIndex","requeue","requeueIndex","processAction","currentPlugin","currentMethod","enrichedPayload","fixEmptyValues","enrich","config","pluginEvent","called","reQueueActions","heartBeat","objTwo","arrayWithHoles","iterableToArrayLimit","_arr","_n","_d","_e","_s","nonIterableRest","slicedToArray","fitlerDisabledPlugins","allPlugins","fromCallOptions","isBoolean","endsWithStartRegex","bootstrapRegex","readyRegex","runPlugins","_x","_x2","_x3","_x4","_x5","_ref","_callee","eventsInfo","pluginObject","originalType","updatedType","activePlugins","allActivePluginKeys","allMatches","actionBefore","actionDuring","afterName","actionAfter","cb","_context","initializeStart","fromEnable","initialized","getAllMatchingCalls","processEvent","namespaced","beforeNS","shouldAbortAll","during","duringNS","afterNS","getCallback","meta","thing","_x6","_processEvent","_callee5","_ref2","EVENTS$$1","isStartEvent","abortable","makeArgs","queueData","payloads","resolvedAction","endAction","_context5","pluginName","argumentFactory","methodName","addToQueue","_ref6","_callee3","scoped","curScope","scopedPayload","_context3","_ref7","_callee2","curScopeData","genAbort","_context2","currentAct","pname","otherPlug","reason","callsite","abort","caller","validateMethod","getConfig","_x10","_x11","_x12","_x7","_x8","_x9","_ref9","_callee4","promise","lastLoop","currentActionValue","payloadValue","funcArgs","merged","nameSpaceEvent","updatedPayload","_context4","shouldAbort","abortDispatch","_x13","_x14","_x15","originalAction","_ref3","abortEvent","pluginState","pluginData","getPluginFunctions","getEventNames","eventType","namespace","formatMethod","postFix","core","word","_nameSpacedEvents$map","_nameSpacedEvents$map2","beforeFuncs","duringFuncs","afterFuncs","_ref4","_ref5","pluginsCount","isString","abortablePlugins","otherPlugin","abortF","pluginsToAbort","abortFunction","notAbortableError","formatPayload","actionName","getNameSpacedAction","sub","subText","pluginMiddleware","systemEvents","isReady","updatedAction","pluginsArray","allRegisteredPlugins","completed","failed","disabled","waitForPluginsToLoad","enablePlugin","ts","disablePlugin","initializeEnd","events","calls","storageMiddleware","osName","referrer","locale","timeZone","classCallCheck","Constructor","DynamicMiddleware","_this","findIndex","act","createReducer","newState","getNameFromEventType","isEnabled","Boolean","initialize","_name","_plugin","togglePluginStatus","baseName","pluginKey","inBrowser","os","appVersion","getBrowserOS","getBrowserLocale","getTimeZone","sessionId","onLine","library","timezone","online","excludeItems","makeContext","serialize","hashRegex","urlPath","exec","currentUrl","canonical","tag","tags","getElementsByTagName","canonicalUrl","getPageData","pageData","_document","_window","innerWidth","innerHeight","hash","initialState$1","properties","viewData","initialState$2","trackReducer","trackEvent","initialState$3","queueReducer","actionChain","listen","toAdd","watch","getCallbackFromArgs","Debug","createStore$$1","origDispatch","composeWithDebug","ensureArray","strOrArr","_setItem","setItemStart","_removeItem","removeItemStart","customReducers","parsedOptions","NAMESPACE","ERROR_URL","definedEvents","enabledFromMerge","enabledFromPluginConfig","pluginEnabled","methods","appendArguments","allEvents","allEventsUnique","Set","getUserProp","customPlugins","pluginEvents","uniqueEvents","allSystemEvents","sort","allPluginEvents","addMiddleware","removeMiddleware","dynamicMiddlewares","nonAbortable","resolvePromise","resolver","paramsParse","initialUser","disable","resolvedId","identifyStart","previousId","eventName","trackStart","pageStart","dotProp","resetStart","startRegex","beforeHandler","afterHandler","handler","actionData","_private","dispatchData","setAnonymousId","coreReducers","composeEnhancers","composeWithGlobalDebug","devTools","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","trace","traceLimit","initialConfig","intialPluginState","pluginKeys","enabledPlugins","disabledPlugins","originalArgs","argsToPass","registerPlugins","dlv","storageUtils","storageUtils__default","decode","decodeURIComponent","isExternalReferrer","ref","hostname","paramsClean","param","regex","cleanSearch","temp","re","prop","getParamsAsObject","getSearchString","keyPath","lastKeyIndex","getDomainHost","getDomainBase","trimTld","baseDomain","searchEngines","daum.net","eniro.se","naver.com","yahoo.com","msn.com","aol.com","ask.com","baidu.com","yandex.com","rambler.ru","google","bing.com","getCookie","setCookie","removeCookie","proto","isUndefined","decodeUri","language","languages","userLanguage","Intl","DateTimeFormat","resolvedOptions","isScriptLoaded","script","scripts","noOp","paramsGet","paramsRemove","replaceState","cleanUrl","parseReferrer","refData","medium","domainInfo","referringDomain","searchEngine","queryParam","termRegex","term","parseDomain","paramKeys","gaParams","gclid","u","rb","throttle","later","cookieUtils","hasLocalStorage","LOCAL_STORAGE","COOKIE","GLOBAL","hasStorage","hasCookies","hasCookieSupport","storageType","getStorageType","getAll","useLocal","useCookie","_value","cookie","saveValue","_oldValue","oldValue","_oldValue2","hasLocalStorageSupport","ttl","domain","secure","encodeURIComponent","toUTCString","valueSet","_defineProperty","_objectSpread","defaultConfig","anonymizeIp","customDimensions","resetCustomDimensionsOnPage","setCustomDimensionsToPage","loadedInstances","googleAnalytics$1","pluginConfig","pageCalledOnce","_getInstanceDetails","getInstanceDetails","instanceName","instancePrefix","pluginApi","scriptSrc","customScriptSrc","gaNotLoaded","insertBefore","gaConfig","cookieDomain","siteSpeedSampleRate","allowLinker","cookieConfig","ga","ga_debug","tasks","taskName","task","formatObjectIntoDimensions$1","resetDimensions","pathname","pageView","finalPayload","addCampaignData","setCustomDimensions","trackEvent$1","hitType","nonInteraction","identifyVisitor$1","gaplugins","scriptLoaded","eventData","_getInstanceDetails2","eventAction","eventLabel","eventCategory","eventValue","format","campaignData","content","keyword","campaignName","campaignSource","campaignMedium","campaignContent","campaignKeyword","dimensionKey","get$1","def","undef","conf","_getInstanceDetails3","custom","parcelRequire","cacheLoader","bundle","charset","onload","cachedBundles","loader"],"version":3,"file":"source.296131de.js.map"}