var me=(R,J)=>()=>(J||R((J={exports:{}}).exports,J),J.exports);var pe=me((de,ae)=>{(function(R,J,N,E,L){var U=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{},T=typeof U[E]=="function"&&U[E],I=T.cache||{},B=typeof ae!="undefined"&&typeof ae.require=="function"&&ae.require.bind(ae);function a(v,w){if(!I[v]){if(!R[v]){var j=typeof U[E]=="function"&&U[E];if(!w&&j)return j(v,!0);if(T)return T(v,!0);if(B&&typeof v=="string")return B(v);var z=new Error("Cannot find module '"+v+"'");throw z.code="MODULE_NOT_FOUND",z}Y.resolve=Q,Y.cache={};var D=I[v]=new a.Module(v);R[v][0].call(D.exports,Y,D,D.exports,this)}return I[v].exports;function Y(W){var A=Y.resolve(W);return A===!1?{}:a(A)}function Q(W){var A=R[v][1][W];return A??W}}function m(v){this.id=v,this.bundle=a,this.exports={}}a.isParcelRequire=!0,a.Module=m,a.modules=R,a.cache=I,a.parent=T,a.register=function(v,w){R[v]=[function(j,z){z.exports=w},{}]},Object.defineProperty(a,"root",{get:function(){return U[E]}}),U[E]=a;for(var g=0;g<J.length;g++)a(J[g]);if(N){var V=a(N);typeof de=="object"&&typeof ae!="undefined"?ae.exports=V:typeof define=="function"&&define.amd?define(function(){return V}):L&&(this[L]=V)}})({"1ubN2":[function(R,J,N){var E=R("@parcel/transformer-js/src/esmodule-helpers.js");E.defineInteropFlag(N);var L=R("@webaudiomodules/sdk"),U=R("@webaudiomodules/sdk-parammgr/src/ParamMgrFactory.js"),T=E.interopDefault(U),I=R("./simple.wam.js"),B=R("url:./descriptor.json"),a=E.interopDefault(B),m=R("./descriptor.json"),g=E.interopDefault(m);const V="simple",v=j=>j.substring(0,j.lastIndexOf("/"));class w extends L.WebAudioModule{_baseUrl=v(a.default);_descriptorUrl=a.default;_descriptor=g.default;_templateUrl=`${this._baseUrl}/wam2/${V}/template.html`;async initialize(z){const D=await fetch(this._templateUrl);return this.templateHtmlStr=await D.text(),super.initialize(z)}async createAudioNode(z){const D=(0,I.createSimpleEngine)(this.audioContext,this._descriptor,z),Y={gain:1},Q=await T.default.create(this,{internalParamsConfig:Y});return D.setup(Q),D}async createGui(){}}N.default=w},{"@webaudiomodules/sdk":"hWxzW","@webaudiomodules/sdk-parammgr/src/ParamMgrFactory.js":"eSiyn","./simple.wam.js":"nvEVR","url:./descriptor.json":"4bM5M","./descriptor.json":"1M6jQ","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],hWxzW:[function(R,J,N){var E=R("@parcel/transformer-js/src/esmodule-helpers.js");E.defineInteropFlag(N),E.export(N,"WamNode",()=>i),E.export(N,"WebAudioModule",()=>U),E.export(N,"addFunctionModule",()=>D),E.export(N,"apiVersion",()=>h),E.export(N,"getRingBuffer",()=>I),E.export(N,"getWamArrayRingBuffer",()=>a),E.export(N,"getWamEventRingBuffer",()=>j),E.export(N,"getWamParameter",()=>Q),E.export(N,"getWamParameterInfo",()=>A),E.export(N,"getWamParameterInterpolator",()=>q),E.export(N,"getWamProcessor",()=>Z),E.export(N,"initializeWamEnv",()=>g),E.export(N,"initializeWamGroup",()=>v),E.export(N,"initializeWamHost",()=>S);var L=class{static get isWebAudioModuleConstructor(){return!0}static createInstance(p,u,l){return new this(p,u).initialize(l)}constructor(p,u){this._groupId=p,this._audioContext=u,this._initialized=!1,this._audioNode=void 0,this._timestamp=performance.now(),this._guiModuleUrl=void 0,this._descriptorUrl="./descriptor.json",this._descriptor={identifier:"com.webaudiomodule.default",name:`WebAudioModule_${this.constructor.name}`,vendor:"WebAudioModuleVendor",description:"",version:"0.0.0",apiVersion:"2.0.0",thumbnail:"",keywords:[],isInstrument:!1,website:"",hasAudioInput:!0,hasAudioOutput:!0,hasAutomationInput:!0,hasAutomationOutput:!0,hasMidiInput:!0,hasMidiOutput:!0,hasMpeInput:!0,hasMpeOutput:!0,hasOscInput:!0,hasOscOutput:!0,hasSysexInput:!0,hasSysexOutput:!0}}get isWebAudioModule(){return!0}get groupId(){return this._groupId}get moduleId(){return this.descriptor.identifier}get instanceId(){return this.moduleId+this._timestamp}get descriptor(){return this._descriptor}get identifier(){return this.descriptor.identifier}get name(){return this.descriptor.name}get vendor(){return this.descriptor.vendor}get audioContext(){return this._audioContext}get audioNode(){return this.initialized||console.warn("WAM should be initialized before getting the audioNode"),this._audioNode}set audioNode(p){this._audioNode=p}get initialized(){return this._initialized}set initialized(p){this._initialized=p}async createAudioNode(p){throw new TypeError("createAudioNode() not provided")}async initialize(p){return this._audioNode||(this.audioNode=await this.createAudioNode()),this.initialized=!0,this}async _loadGui(){const p=this._guiModuleUrl;if(!p)throw new TypeError("Gui module not found");return R(p)}async _loadDescriptor(){const p=this._descriptorUrl;if(!p)throw new TypeError("Descriptor not found");const l=await(await fetch(p)).json();return Object.assign(this._descriptor,l),this._descriptor}async createGui(){if(this.initialized||console.warn("Plugin should be initialized before getting the gui"),!this._guiModuleUrl)return;const{createElement:p}=await this._loadGui();return p(this)}destroyGui(){}},U=L,T=p=>{const u=globalThis;class l{static getStorageForCapacity(s,r){if(!r.BYTES_PER_ELEMENT)throw new Error("Pass in a ArrayBuffer subclass");const t=8+(s+1)*r.BYTES_PER_ELEMENT;return new SharedArrayBuffer(t)}constructor(s,r){if(!r.BYTES_PER_ELEMENT)throw new Error("Pass a concrete typed array class as second argument");this._Type=r,this._capacity=(s.byteLength-8)/r.BYTES_PER_ELEMENT,this.buf=s,this.write_ptr=new Uint32Array(this.buf,0,1),this.read_ptr=new Uint32Array(this.buf,4,1),this.storage=new r(this.buf,8,this._capacity)}get type(){return this._Type.name}push(s){const r=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);if((t+1)%this._storageCapacity()===r)return 0;const o=Math.min(this._availableWrite(r,t),s.length),c=Math.min(this._storageCapacity()-t,o),d=o-c;return this._copy(s,0,this.storage,t,c),this._copy(s,c,this.storage,0,d),Atomics.store(this.write_ptr,0,(t+o)%this._storageCapacity()),o}pop(s){const r=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);if(t===r)return 0;const o=!Number.isInteger(s),c=Math.min(this._availableRead(r,t),o?s.length:s);if(o){const d=Math.min(this._storageCapacity()-r,c),b=c-d;this._copy(this.storage,r,s,0,d),this._copy(this.storage,0,s,d,b)}return Atomics.store(this.read_ptr,0,(r+c)%this._storageCapacity()),c}get empty(){const s=Atomics.load(this.read_ptr,0);return Atomics.load(this.write_ptr,0)===s}get full(){const s=Atomics.load(this.read_ptr,0);return(Atomics.load(this.write_ptr,0)+1)%this._capacity!==s}get capacity(){return this._capacity-1}get availableRead(){const s=Atomics.load(this.read_ptr,0),r=Atomics.load(this.write_ptr,0);return this._availableRead(s,r)}get availableWrite(){const s=Atomics.load(this.read_ptr,0),r=Atomics.load(this.write_ptr,0);return this._availableWrite(s,r)}_availableRead(s,r){return r>s?r-s:r+this._storageCapacity()-s}_availableWrite(s,r){let t=s-r-1;return r>=s&&(t+=this._storageCapacity()),t}_storageCapacity(){return this._capacity}_copy(s,r,t,o,c){for(let d=0;d<c;d++)t[o+d]=s[r+d]}}if(u.AudioWorkletProcessor){const f=u.webAudioModules.getModuleScope(p);f.RingBuffer||(f.RingBuffer=l)}return l},I=T,B=p=>{const u=globalThis;class l{static DefaultArrayCapacity=2;static getStorageForEventCapacity(s,r,t,o){if(o===void 0?o=l.DefaultArrayCapacity:o=Math.max(o,l.DefaultArrayCapacity),!t.BYTES_PER_ELEMENT)throw new Error("Pass in a ArrayBuffer subclass");const c=r*o;return s.getStorageForCapacity(c,t)}constructor(s,r,t,o,c){if(!o.BYTES_PER_ELEMENT)throw new Error("Pass in a ArrayBuffer subclass");this._arrayLength=t,this._arrayType=o,this._arrayElementSizeBytes=o.BYTES_PER_ELEMENT,this._arraySizeBytes=this._arrayLength*this._arrayElementSizeBytes,this._sab=r,c===void 0?c=l.DefaultArrayCapacity:c=Math.max(c,l.DefaultArrayCapacity),this._arrayArray=new o(this._arrayLength),this._rb=new s(this._sab,o)}write(s){if(s.length!==this._arrayLength||this._rb.availableWrite<this._arrayLength)return!1;let t=!0;return this._rb.push(s)!=this._arrayLength&&(t=!1),t}read(s,r){if(s.length!==this._arrayLength)return!1;const t=this._rb.availableRead;if(t<this._arrayLength)return!1;r&&t>this._arrayLength&&this._rb.pop(t-this._arrayLength);let o=!1;return this._rb.pop(s)===this._arrayLength&&(o=!0),o}}if(u.AudioWorkletProcessor){const f=u.webAudioModules.getModuleScope(p);f.WamArrayRingBuffer||(f.WamArrayRingBuffer=l)}return l},a=B,m=p=>{const u=globalThis;if(u.AudioWorkletProcessor&&u.webAudioModules)return;const l=new Map,f=new Map;class s{constructor(){}get apiVersion(){return p}getModuleScope(t){return l.has(t)||l.set(t,{}),l.get(t)}getGroup(t,o){const c=f.get(t);if(c.validate(o))return c;throw"Invalid key"}addGroup(t){f.has(t.groupId)||f.set(t.groupId,t)}removeGroup(t){f.delete(t.groupId)}addWam(t){f.get(t.groupId).addWam(t)}removeWam(t){f.get(t.groupId).removeWam(t)}connectEvents(t,o,c,d=0){f.get(t).connectEvents(o,c,d)}disconnectEvents(t,o,c,d){f.get(t).disconnectEvents(o,c,d)}emitEvents(t,...o){f.get(t.groupId).emitEvents(t,...o)}}u.AudioWorkletProcessor&&(u.webAudioModules||(u.webAudioModules=new s))},g=m,V=(p,u)=>{const l=globalThis;class f{constructor(r,t){this._groupId=r,this._validate=o=>o==t,this._processors=new Map,this._eventGraph=new Map}get groupId(){return this._groupId}get processors(){return this._processors}get eventGraph(){return this._eventGraph}validate(r){return this._validate(r)}addWam(r){this._processors.set(r.instanceId,r)}removeWam(r){this._eventGraph.has(r)&&this._eventGraph.delete(r),this._eventGraph.forEach(t=>{t.forEach(o=>{o&&o.has(r)&&o.delete(r)})}),this._processors.delete(r.instanceId)}connectEvents(r,t,o){const c=this._processors.get(r),d=this._processors.get(t);let b;if(this._eventGraph.has(c)?b=this._eventGraph.get(c):(b=[],this._eventGraph.set(c,b)),b[o])b[o].add(d);else{const n=new Set;n.add(d),b[o]=n}}disconnectEvents(r,t,o){const c=this._processors.get(r);if(!this._eventGraph.has(c))return;const d=this._eventGraph.get(c);if(typeof t=="undefined"){d.forEach(n=>{n&&n.clear()});return}const b=this._processors.get(t);if(typeof o=="undefined"){d.forEach(n=>{n&&n.delete(b)});return}!d[o]||d[o].delete(b)}emitEvents(r,...t){if(!this._eventGraph.has(r))return;this._eventGraph.get(r).forEach(c=>{c&&c.forEach(d=>d.scheduleEvents(...t))})}}l.AudioWorkletProcessor&&l.webAudioModules.addGroup(new f(p,u))},v=V,w=p=>{const u=globalThis;class l{static DefaultExtraBytesPerEvent=64;static WamEventBaseBytes=13;static WamAutomationEventBytes=l.WamEventBaseBytes+2+8+1;static WamTransportEventBytes=l.WamEventBaseBytes+4+8+8+1+1+1;static WamMidiEventBytes=l.WamEventBaseBytes+1+1+1;static WamBinaryEventBytes=l.WamEventBaseBytes+4;static getStorageForEventCapacity(s,r,t){t===void 0?t=l.DefaultExtraBytesPerEvent:t=Math.max(t,l.DefaultExtraBytesPerEvent);const o=(Math.max(l.WamAutomationEventBytes,l.WamTransportEventBytes,l.WamMidiEventBytes,l.WamBinaryEventBytes)+t)*r;return s.getStorageForCapacity(o,Uint8Array)}constructor(s,r,t,o){this._eventSizeBytes={},this._encodeEventType={},this._decodeEventType={},["wam-automation","wam-transport","wam-midi","wam-sysex","wam-mpe","wam-osc","wam-info"].forEach((d,b)=>{let n=0;switch(d){case"wam-automation":n=l.WamAutomationEventBytes;break;case"wam-transport":n=l.WamTransportEventBytes;break;case"wam-mpe":case"wam-midi":n=l.WamMidiEventBytes;break;case"wam-osc":case"wam-sysex":case"wam-info":n=l.WamBinaryEventBytes;break;default:break}this._eventSizeBytes[d]=n,this._encodeEventType[d]=b,this._decodeEventType[b]=d}),this._parameterCode=0,this._parameterCodes={},this._encodeParameterId={},this._decodeParameterId={},this.setParameterIds(t),this._sab=r,o===void 0?o=l.DefaultExtraBytesPerEvent:o=Math.max(o,l.DefaultExtraBytesPerEvent),this._eventBytesAvailable=Math.max(l.WamAutomationEventBytes,l.WamTransportEventBytes,l.WamMidiEventBytes,l.WamBinaryEventBytes)+o,this._eventBytes=new ArrayBuffer(this._eventBytesAvailable),this._eventBytesView=new DataView(this._eventBytes),this._rb=new s(this._sab,Uint8Array),this._eventSizeArray=new Uint8Array(this._eventBytes,0,4),this._eventSizeView=new DataView(this._eventBytes,0,4)}_writeHeader(s,r,t){let o=0;return this._eventBytesView.setUint32(o,s),o+=4,this._eventBytesView.setUint8(o,this._encodeEventType[r]),o+=1,this._eventBytesView.setFloat64(o,Number.isFinite(t)?t:-1),o+=8,o}_encode(s){let r=0;const{type:t,time:o}=s;switch(s.type){case"wam-automation":{if(!(s.data.id in this._encodeParameterId))break;const c=this._eventSizeBytes[t];r=this._writeHeader(c,t,o);const{data:d}=s,b=this._encodeParameterId[d.id],{value:n,normalized:_}=d;this._eventBytesView.setUint16(r,b),r+=2,this._eventBytesView.setFloat64(r,n),r+=8,this._eventBytesView.setUint8(r,_?1:0),r+=1}break;case"wam-transport":{const c=this._eventSizeBytes[t];r=this._writeHeader(c,t,o);const{data:d}=s,{currentBar:b,currentBarStarted:n,tempo:_,timeSigNumerator:M,timeSigDenominator:P,playing:C}=d;this._eventBytesView.setUint32(r,b),r+=4,this._eventBytesView.setFloat64(r,n),r+=8,this._eventBytesView.setFloat64(r,_),r+=8,this._eventBytesView.setUint8(r,M),r+=1,this._eventBytesView.setUint8(r,P),r+=1,this._eventBytesView.setUint8(r,C?1:0),r+=1}break;case"wam-mpe":case"wam-midi":{const c=this._eventSizeBytes[t];r=this._writeHeader(c,t,o);const{data:d}=s,{bytes:b}=d;let n=0;for(;n<3;)this._eventBytesView.setUint8(r,b[n]),r+=1,n++}break;case"wam-osc":case"wam-sysex":case"wam-info":{let c=null;if(s.type==="wam-info"){const{data:M}=s;c=new TextEncoder().encode(M.instanceId)}else{const{data:M}=s;c=M.bytes}const d=c.length,b=this._eventSizeBytes[t];r=this._writeHeader(b+d,t,o),this._eventBytesView.setUint32(r,d),r+=4;const n=r+d;n>this._eventBytesAvailable&&console.error(`Event requires ${n} bytes but only ${this._eventBytesAvailable} have been allocated!`),new Uint8Array(this._eventBytes,r,d).set(c),r+=d}break;default:break}return new Uint8Array(this._eventBytes,0,r)}_decode(){let s=0;const r=this._decodeEventType[this._eventBytesView.getUint8(s)];s+=1;let t=this._eventBytesView.getFloat64(s);switch(t===-1&&(t=void 0),s+=8,r){case"wam-automation":{const o=this._eventBytesView.getUint16(s);s+=2;const c=this._eventBytesView.getFloat64(s);s+=8;const d=!!this._eventBytesView.getUint8(s);if(s+=1,!(o in this._decodeParameterId))break;const b=this._decodeParameterId[o];return{type:r,time:t,data:{id:b,value:c,normalized:d}}}case"wam-transport":{const o=this._eventBytesView.getUint32(s);s+=4;const c=this._eventBytesView.getFloat64(s);s+=8;const d=this._eventBytesView.getFloat64(s);s+=8;const b=this._eventBytesView.getUint8(s);s+=1;const n=this._eventBytesView.getUint8(s);s+=1;const _=this._eventBytesView.getUint8(s)==1;return s+=1,{type:r,time:t,data:{currentBar:o,currentBarStarted:c,tempo:d,timeSigNumerator:b,timeSigDenominator:n,playing:_}}}case"wam-mpe":case"wam-midi":{const o=[0,0,0];let c=0;for(;c<3;)o[c]=this._eventBytesView.getUint8(s),s+=1,c++;return{type:r,time:t,data:{bytes:o}}}case"wam-osc":case"wam-sysex":case"wam-info":{const o=this._eventBytesView.getUint32(s);s+=4;const c=new Uint8Array(o);if(c.set(new Uint8Array(this._eventBytes,s,o)),s+=o,r==="wam-info"){const b={instanceId:new TextDecoder().decode(c)};return{type:r,time:t,data:b}}else return{type:r,time:t,data:{bytes:c}}}default:break}return!1}write(...s){const r=s.length;let t=this._rb.availableWrite,o=0,c=0;for(;c<r;){const d=s[c],b=this._encode(d),n=b.byteLength;let _=0;if(t>=n)n===0?o++:_=this._rb.push(b);else break;t-=_,c++}return c-o}read(){if(this._rb.empty)return[];const s=[];let r=this._rb.availableRead,t=0;for(;r>0;){t=this._rb.pop(this._eventSizeArray),r-=t;const o=this._eventSizeView.getUint32(0),c=new Uint8Array(this._eventBytes,0,o-4);t=this._rb.pop(c),r-=t;const d=this._decode();d&&s.push(d)}return s}setParameterIds(s){this._encodeParameterId={},this._decodeParameterId={},s.forEach(r=>{let t=-1;r in this._parameterCodes?t=this._parameterCodes[r]:(t=this._generateParameterCode(),this._parameterCodes[r]=t),this._encodeParameterId[r]=t,this._decodeParameterId[t]=r})}_generateParameterCode(){if(this._parameterCode>65535)throw Error("Too many parameters have been registered!");return this._parameterCode++}}if(u.AudioWorkletProcessor){const f=u.webAudioModules.getModuleScope(p);f.WamEventRingBuffer||(f.WamEventRingBuffer=l)}return l},j=w,z=(p,u,...l)=>{const f=`(${u.toString()})(${l.map(r=>JSON.stringify(r)).join(", ")});`,s=URL.createObjectURL(new Blob([f],{type:"text/javascript"}));return p.addModule(s)},D=z,Y=p=>{const u=globalThis;class l{constructor(s){this.info=s,this._value=s.defaultValue}set value(s){this._value=s}get value(){return this._value}set normalizedValue(s){this.value=this.info.denormalize(s)}get normalizedValue(){return this.info.normalize(this.value)}}if(u.AudioWorkletProcessor){const f=u.webAudioModules.getModuleScope(p);f.WamParameter||(f.WamParameter=l)}return l},Q=Y,W=p=>{const u=globalThis,l=(c,d)=>d===0?c:c**1.5**-d,f=(c,d)=>d===0?c:c**1.5**d,s=(c,d,b,n=0)=>l(d===0&&b===1?c:(c-d)/(b-d)||0,n),r=(c,d,b,n=0)=>d===0&&b===1?f(c,n):f(c,n)*(b-d)+d,t=(c,d,b)=>c>=d&&c<=b;class o{constructor(d,b={}){let{type:n,label:_,defaultValue:M,minValue:P,maxValue:C,discreteStep:$,exponent:x,choices:G,units:k}=b;n===void 0&&(n="float"),_===void 0&&(_=""),M===void 0&&(M=0),G===void 0&&(G=[]),n==="boolean"||n==="choice"?($=1,P=0,G.length?C=G.length-1:C=1):(P===void 0&&(P=0),C===void 0&&(C=1),$===void 0&&($=0),x===void 0&&(x=0),k===void 0&&(k=""));const F=`Param config error | ${d}: `;if(P>=C)throw Error(F.concat("minValue must be less than maxValue"));if(!t(M,P,C))throw Error(F.concat("defaultValue out of range"));if($%1||$<0)throw Error(F.concat("discreteStep must be a non-negative integer"));if($>0&&(P%1||C%1||M%1))throw Error(F.concat("non-zero discreteStep requires integer minValue, maxValue, and defaultValue"));if(n==="choice"&&!G.length)throw Error(F.concat("choice type parameter requires list of strings in choices"));this.id=d,this.label=_,this.type=n,this.defaultValue=M,this.minValue=P,this.maxValue=C,this.discreteStep=$,this.exponent=x,this.choices=G,this.units=k}normalize(d){return s(d,this.minValue,this.maxValue,this.exponent)}denormalize(d){return r(d,this.minValue,this.maxValue,this.exponent)}valueString(d){return this.choices?this.choices[d]:this.units!==""?`${d} ${this.units}`:`${d}`}}if(u.AudioWorkletProcessor){const c=u.webAudioModules.getModuleScope(p);c.WamParameterInfo||(c.WamParameterInfo=o)}return o},A=W,O=p=>{const u=globalThis,l=128,f="0_0";class s{static _tables;static _tableReferences;constructor(t,o,c=0){s._tables||(s._tables={nullTableKey:new Float32Array(0)},s._tableReferences={nullTableKey:[]}),this.info=t,this.values=new Float32Array(l),this._tableKey=f,this._table=s._tables[this._tableKey],this._skew=2;const{discreteStep:d}=t;this._discrete=!!d,this._N=this._discrete?0:o,this._n=0,this._startValue=t.defaultValue,this._endValue=t.defaultValue,this._currentValue=t.defaultValue,this._deltaValue=0,this._inverted=!1,this._changed=!0,this._filled=0,this._discrete?this._skew=0:this.setSkew(c),this.setStartValue(this._startValue)}_removeTableReference(t){if(t===f)return;const{id:o}=this.info,c=s._tableReferences[t];if(c){const d=c.indexOf(o);d!==-1&&c.splice(d,1),c.length===0&&(delete s._tables[t],delete s._tableReferences[t])}}setSkew(t){if(this._skew===t||this._discrete)return;if(t<-1||t>1)throw Error("skew must be in range [-1.0, 1.0]");const o=[this._N,t].join("_"),c=this._tableKey,{id:d}=this.info;if(o!==c){if(s._tables[o]){const b=s._tableReferences[o];b?b.push(d):s._tableReferences[o]=[d]}else{let b=Math.abs(t);b=Math.pow(3-b,b*(b+2));const n=b===1,_=this._N,M=new Float32Array(_+1);if(n)for(let P=0;P<=_;++P)M[P]=P/_;else for(let P=0;P<=_;++P)M[P]=(P/_)**b;s._tables[o]=M,s._tableReferences[o]=[d]}this._removeTableReference(c),this._skew=t,this._tableKey=o,this._table=s._tables[this._tableKey]}}setStartValue(t,o=!0){this._n=this._N,this._startValue=t,this._endValue=t,this._currentValue=t,this._deltaValue=0,this._inverted=!1,o?(this.values.fill(t),this._changed=!0,this._filled=this.values.length):(this._changed=!1,this._filled=0)}setEndValue(t){t!==this._endValue&&(this._n=0,this._startValue=this._currentValue,this._endValue=t,this._deltaValue=this._endValue-this._startValue,this._inverted=this._deltaValue>0&&this._skew>=0||this._deltaValue<=0&&this._skew<0,this._changed=!1,this._filled=0)}process(t,o){if(this.done)return;const c=o-t;let d=0;const b=this._N-this._n;if(this._discrete||!b)d=c;else{if(b<c&&(d=Math.min(c-b,l),o-=d),o>t)if(this._inverted)for(let n=t;n<o;++n){const _=1-this._table[this._N-++this._n];this.values[n]=this._startValue+_*this._deltaValue}else for(let n=t;n<o;++n){const _=this._table[++this._n];this.values[n]=this._startValue+_*this._deltaValue}d>0&&(t=o,o+=d)}d>0&&(this.values.fill(this._endValue,t,o),this._filled+=d),this._currentValue=this.values[o-1],this._n===this._N&&(this._changed?this._filled>=this.values.length&&(this.setStartValue(this._endValue,!1),this._changed=!0,this._filled=this.values.length):this._changed=!0)}get done(){return this._changed&&this._filled===this.values.length}is(t){return this._endValue===t&&this.done}destroy(){this._removeTableReference(this._tableKey)}}if(u.AudioWorkletProcessor){const r=u.webAudioModules.getModuleScope(p);r.WamParameterInterpolator||(r.WamParameterInterpolator=s)}return s},q=O,H=p=>{const u=globalThis,{AudioWorkletProcessor:l,webAudioModules:f}=u,s=u.webAudioModules.getModuleScope(p),{RingBuffer:r,WamEventRingBuffer:t,WamParameter:o,WamParameterInterpolator:c}=s;class d extends l{constructor(n){super();const{groupId:_,moduleId:M,instanceId:P,useSab:C}=n.processorOptions;if(!M)throw Error("must provide moduleId argument in processorOptions!");if(!P)throw Error("must provide instanceId argument in processorOptions!");this.groupId=_,this.moduleId=M,this.instanceId=P,this._samplesPerQuantum=128,this._compensationDelay=0,this._parameterInfo={},this._parameterState={},this._parameterInterpolators={},this._eventQueue=[],this._pendingResponses={},this._useSab=!!C&&!!globalThis.SharedArrayBuffer,this._eventSabReady=!1,this._audioToMainEventSab=null,this._mainToAudioEventSab=null,this._eventWriter=null,this._eventReader=null,this._initialized=!1,this._destroyed=!1,f.addWam(this),this.port.onmessage=this._onMessage.bind(this),this._useSab&&this._configureSab()}getCompensationDelay(){return this._compensationDelay}scheduleEvents(...n){let _=0;for(;_<n.length;)this._eventQueue.push({id:0,event:n[_]}),_++}emitEvents(...n){f.emitEvents(this,...n)}clearEvents(){this._eventQueue=[]}process(n,_,M){if(!this._initialized)return!0;if(this._destroyed)return!1;this._eventSabReady&&this.scheduleEvents(...this._eventReader.read());const P=this._getProcessingSlices();let C=0;for(;C<P.length;){const{range:$,events:x}=P[C],[G,k]=$;let F=0;for(;F<x.length;)this._processEvent(x[F]),F++;this._interpolateParameterValues(G,k),this._process(G,k,n,_,M),C++}return!0}destroy(){this._destroyed=!0,this.port.close(),f.removeWam(this)}_generateWamParameterInfo(){return{}}_initialize(){this._parameterState={},this._parameterInterpolators={},this._parameterInfo=this._generateWamParameterInfo(),Object.keys(this._parameterInfo).forEach(n=>{const _=this._parameterInfo[n];this._parameterState[n]=new o(this._parameterInfo[n]),this._parameterInterpolators[n]=new c(_,256)})}_configureSab(){const n=1024,_=Object.keys(this._parameterInfo);this._eventSabReady&&(this._eventWriter.setParameterIds(_),this._eventReader.setParameterIds(_)),this.port.postMessage({eventSab:{eventCapacity:n,parameterIds:_}})}async _onMessage(n){if(n.data.request){const{id:_,request:M,content:P}=n.data,C={id:_,response:M},$=M.split("/"),x=$[0],G=$[1];if(C.content="error",x==="get")if(G==="parameterInfo"){let{parameterIds:k}=P;k.length||(k=Object.keys(this._parameterInfo));const F={};let X=0;for(;X<k.length;){const ee=k[X];F[ee]=this._parameterInfo[ee],X++}C.content=F}else if(G==="parameterValues"){let{normalized:k,parameterIds:F}=P;C.content=this._getParameterValues(k,F)}else G==="state"?C.content=this._getState():G==="compensationDelay"&&(C.content=this.getCompensationDelay());else if(x==="set"){if(G==="parameterValues"){const{parameterValues:k}=P;this._setParameterValues(k,!0),delete C.content}else if(G==="state"){const{state:k}=P;this._setState(k),delete C.content}}else if(x==="add"){if(G==="event"){const{event:k}=P;this._eventQueue.push({id:_,event:k});return}}else if(x==="remove"){if(G==="events"){const k=this._eventQueue.map(F=>F.id);this.clearEvents(),C.content=k}}else if(x==="connect"){if(G==="events"){const{wamInstanceId:k,output:F}=P;this._connectEvents(k,F),delete C.content}}else if(x==="disconnect"){if(G==="events"){const{wamInstanceId:k,output:F}=P;this._disconnectEvents(k,F),delete C.content}}else if(x==="initialize"){if(G==="processor")this._initialize(),this._initialized=!0,delete C.content;else if(G==="eventSab"){const{mainToAudioEventSab:k,audioToMainEventSab:F}=P;this._audioToMainEventSab=F,this._mainToAudioEventSab=k;const X=Object.keys(this._parameterInfo);this._eventWriter=new t(r,this._audioToMainEventSab,X),this._eventReader=new t(r,this._mainToAudioEventSab,X),this._eventSabReady=!0,delete C.content}}this.port.postMessage(C)}else n.data.destroy&&this.destroy()}_onTransport(n){console.error("_onTransport not implemented!")}_onMidi(n){console.error("_onMidi not implemented!")}_onSysex(n){console.error("_onMidi not implemented!")}_onMpe(n){console.error("_onMpe not implemented!")}_onOsc(n){console.error("_onOsc not implemented!")}_setState(n){n.parameterValues&&this._setParameterValues(n.parameterValues,!1)}_getState(){return{parameterValues:this._getParameterValues(!1)}}_getParameterValues(n,_){const M={};(!_||!_.length)&&(_=Object.keys(this._parameterState));let P=0;for(;P<_.length;){const C=_[P],$=this._parameterState[C];M[C]={id:C,value:n?$.normalizedValue:$.value,normalized:n},P++}return M}_setParameterValues(n,_){const M=Object.keys(n);let P=0;for(;P<M.length;)this._setParameterValue(n[M[P]],_),P++}_setParameterValue(n,_){const{id:M,value:P,normalized:C}=n,$=this._parameterState[M];if(!$)return;C?$.normalizedValue=P:$.value=P;const x=this._parameterInterpolators[M];_?x.setEndValue($.value):x.setStartValue($.value)}_interpolateParameterValues(n,_){const M=Object.keys(this._parameterInterpolators);let P=0;for(;P<M.length;)this._parameterInterpolators[M[P]].process(n,_),P++}_connectEvents(n,_){f.connectEvents(this.groupId,this.instanceId,n,_)}_disconnectEvents(n,_){if(typeof n=="undefined"){f.disconnectEvents(this.groupId,this.instanceId);return}f.disconnectEvents(this.groupId,this.instanceId,n,_)}_getProcessingSlices(){const n="add/event",{currentTime:_,sampleRate:M}=u,P={};let C=0;for(;C<this._eventQueue.length;){const{id:k,event:F}=this._eventQueue[C],X=F.time-_,ee=X>0?Math.round(X*M):0;if(ee<this._samplesPerQuantum)P[ee]?P[ee].push(F):P[ee]=[F],k?this.port.postMessage({id:k,response:n}):this._eventSabReady?this._eventWriter.write(F):this.port.postMessage({event:F}),this._eventQueue.shift(),C=-1;else break;C++}const $=[],x=Object.keys(P);x[0]!=="0"&&(x.unshift("0"),P["0"]=[]);const G=x.length-1;for(C=0;C<x.length;){const k=x[C],F=parseInt(k),X=C<G?parseInt(x[C+1]):this._samplesPerQuantum;$.push({range:[F,X],events:P[k]}),C++}return $}_processEvent(n){switch(n.type){case"wam-automation":this._setParameterValue(n.data,!0);break;case"wam-transport":this._onTransport(n.data);break;case"wam-midi":this._onMidi(n.data);break;case"wam-sysex":this._onSysex(n.data);break;case"wam-mpe":this._onMpe(n.data);break;case"wam-osc":this._onOsc(n.data);break;default:break}}_process(n,_,M,P,C){console.error("_process not implemented!")}}return u.AudioWorkletProcessor&&(s.WamProcessor||(s.WamProcessor=d)),d},Z=H,K=I(),e=j(),i=class extends AudioWorkletNode{static async addModules(p,u){const{audioWorklet:l}=p;await D(l,I,u),await D(l,j,u),await D(l,a,u),await D(l,Q,u),await D(l,A,u),await D(l,q,u),await D(l,Z,u)}constructor(p,u){const{audioContext:l,groupId:f,moduleId:s,instanceId:r}=p;u.processorOptions={groupId:f,moduleId:s,instanceId:r,...u.processorOptions};super(l,s,u);this.module=p,this._supportedEventTypes=new Set(["wam-automation","wam-transport","wam-midi","wam-sysex","wam-mpe","wam-osc"]),this._messageId=1,this._pendingResponses={},this._pendingEvents={},this._useSab=!1,this._eventSabReady=!1,this._destroyed=!1,this.port.onmessage=this._onMessage.bind(this)}get groupId(){return this.module.groupId}get moduleId(){return this.module.moduleId}get instanceId(){return this.module.instanceId}async getParameterInfo(...p){const u="get/parameterInfo",l=this._generateMessageId();return new Promise(f=>{this._pendingResponses[l]=f,this.port.postMessage({id:l,request:u,content:{parameterIds:p}})})}async getParameterValues(p,...u){const l="get/parameterValues",f=this._generateMessageId();return new Promise(s=>{this._pendingResponses[f]=s,this.port.postMessage({id:f,request:l,content:{normalized:p,parameterIds:u}})})}async setParameterValues(p){const u="set/parameterValues",l=this._generateMessageId();return new Promise(f=>{this._pendingResponses[l]=f,this.port.postMessage({id:l,request:u,content:{parameterValues:p}})})}async getState(){const p="get/state",u=this._generateMessageId();return new Promise(l=>{this._pendingResponses[u]=l,this.port.postMessage({id:u,request:p})})}async setState(p){const u="set/state",l=this._generateMessageId();return new Promise(f=>{this._pendingResponses[l]=f,this.port.postMessage({id:l,request:u,content:{state:p}})})}async getCompensationDelay(){const p="get/compensationDelay",u=this._generateMessageId();return new Promise(l=>{this._pendingResponses[u]=l,this.port.postMessage({id:u,request:p})})}addEventListener(p,u,l){this._supportedEventTypes.has(p)&&super.addEventListener(p,u,l)}removeEventListener(p,u,l){this._supportedEventTypes.has(p)&&super.removeEventListener(p,u,l)}scheduleEvents(...p){let u=0;const l=p.length;for(this._eventSabReady&&(u=this._eventWriter.write(...p));u<l;){const f=p[u],s="add/event",r=this._generateMessageId();let t=!1;new Promise((o,c)=>{this._pendingResponses[r]=o,this._pendingEvents[r]=()=>{t||c()},this.port.postMessage({id:r,request:s,content:{event:f}})}).then(o=>{t=!0,delete this._pendingEvents[r],this._onEvent(f)}).catch(o=>{delete this._pendingResponses[r]}),u++}}async clearEvents(){const p="remove/events",u=this._generateMessageId();if(Object.keys(this._pendingEvents).length)return new Promise(f=>{this._pendingResponses[u]=f,this.port.postMessage({id:u,request:p})}).then(f=>{f.forEach(s=>{this._pendingEvents[s](),delete this._pendingEvents[s]})})}connectEvents(p,u){const l="connect/events",f=this._generateMessageId();new Promise((s,r)=>{this._pendingResponses[f]=s,this.port.postMessage({id:f,request:l,content:{wamInstanceId:p,output:u}})})}disconnectEvents(p,u){const l="disconnect/events",f=this._generateMessageId();new Promise((s,r)=>{this._pendingResponses[f]=s,this.port.postMessage({id:f,request:l,content:{wamInstanceId:p,output:u}})})}destroy(){this._audioToMainInterval&&clearInterval(this._audioToMainInterval),this.port.postMessage({destroy:!0}),this.port.close(),this.disconnect(),this._destroyed=!0}_generateMessageId(){return this._messageId++}async _initialize(){const p="initialize/processor",u=this._generateMessageId();return new Promise(l=>{this._pendingResponses[u]=l,this.port.postMessage({id:u,request:p})})}_onMessage(p){const{data:u}=p,{response:l,event:f,eventSab:s}=u;if(l){const{id:r,content:t}=u,o=this._pendingResponses[r];o&&(delete this._pendingResponses[r],o(t))}else if(s){this._useSab=!0;const{eventCapacity:r,parameterIds:t}=s;if(this._eventSabReady){this._eventWriter.setParameterIds(t),this._eventReader.setParameterIds(t);return}this._mainToAudioEventSab=e.getStorageForEventCapacity(K,r),this._audioToMainEventSab=e.getStorageForEventCapacity(K,r),this._eventWriter=new e(K,this._mainToAudioEventSab,t),this._eventReader=new e(K,this._audioToMainEventSab,t);const o="initialize/eventSab",c=this._generateMessageId();new Promise((d,b)=>{this._pendingResponses[c]=d,this.port.postMessage({id:c,request:o,content:{mainToAudioEventSab:this._mainToAudioEventSab,audioToMainEventSab:this._audioToMainEventSab}})}).then(d=>{this._eventSabReady=!0,this._audioToMainInterval=setInterval(()=>{this._eventReader.read().forEach(n=>{this._onEvent(n)})},100)})}else f&&this._onEvent(f)}_onEvent(p){const{type:u}=p;this.dispatchEvent(new CustomEvent(u,{bubbles:!0,detail:p}))}},h="2.0.0-alpha.6",y=async(p,u=`wam-host-${performance.now().toString()}`,l=performance.now().toString())=>(await D(p.audioWorklet,g,h),await D(p.audioWorklet,v,u,l),[u,l]),S=y},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"14tkN":[function(R,J,N){N.interopDefault=function(E){return E&&E.__esModule?E:{default:E}},N.defineInteropFlag=function(E){Object.defineProperty(E,"__esModule",{value:!0})},N.exportAll=function(E,L){return Object.keys(E).forEach(function(U){U==="default"||U==="__esModule"||L.hasOwnProperty(U)||Object.defineProperty(L,U,{enumerable:!0,get:function(){return E[U]}})}),L},N.export=function(E,L,U){Object.defineProperty(E,L,{enumerable:!0,get:U})}},{}],eSiyn:[function(R,J,N){var E=R("@parcel/transformer-js/src/esmodule-helpers.js");E.defineInteropFlag(N);var L=R("./sdk/src/addFunctionModule.js"),U=E.interopDefault(L),T=R("./ParamMgrProcessor.js"),I=E.interopDefault(T),B=R("./ParamConfigurator.js"),a=E.interopDefault(B),m=R("./ParamMgrNode.js"),g=E.interopDefault(m);class V{static async create(w,j={}){const{audioContext:z,moduleId:D}=w,Y=j.instanceId||w.instanceId,Q=j.groupId||w.groupId,{paramsConfig:W,paramsMapping:A,internalParamsConfig:O}=new a.default(j),q=Object.entries(W).reduce((e,[i,{defaultValue:h}])=>(e[i]=h,e),{}),H=Object.entries(W).reduce((e,[i,{id:h,label:y,type:S,defaultValue:p,minValue:u,maxValue:l,discreteStep:f,exponent:s,choices:r,units:t}])=>(e[i]={id:h,label:y,type:S,defaultValue:p,minValue:u,maxValue:l,discreteStep:f,exponent:s,choices:r,units:t},e),{});console.error("TESTING",{module:w,worklet:z.audioWorklet,processor:I.default,moduleId:D,serializableParamsConfig:H}),await(0,U.default)(z.audioWorklet,I.default,D,H);const Z={internalParamsConfig:O,parameterData:q,processorOptions:{paramsConfig:W,paramsMapping:A,internalParamsMinValues:Object.values(O).map(e=>Math.max(0,e?.minValue||0)),internalParams:Object.keys(O),groupId:Q,instanceId:Y,moduleId:D}},K=new g.default(w,Z);return await K.initialize(),K}}N.default=V},{"./sdk/src/addFunctionModule.js":"liPay","./ParamMgrProcessor.js":"j5FWt","./ParamConfigurator.js":"dRPWr","./ParamMgrNode.js":"iyp0x","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],liPay:[function(R,J,N){var E=R("@parcel/transformer-js/src/esmodule-helpers.js");E.defineInteropFlag(N);const L=(U,T,...I)=>{const B=`(${T.toString()})(${I.map(m=>JSON.stringify(m)).join(", ")});`,a=URL.createObjectURL(new Blob([B],{type:"text/javascript"}));return U.addModule(a)};N.default=L},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],j5FWt:[function(R,J,N){var E=R("@parcel/transformer-js/src/esmodule-helpers.js");E.defineInteropFlag(N);const L=(U,T)=>{const I=globalThis,{AudioWorkletProcessor:B,registerProcessor:a,webAudioModules:m}=I,g=I.webAudioModules.getModuleScope(U),V=!!globalThis.SharedArrayBuffer,v=globalThis.SharedArrayBuffer||globalThis.ArrayBuffer,w=(W,A)=>A===0?W:W**1.5**-A,j=(W,A,O,q=0)=>w(A===0&&O===1?W:(W-A)/(O-A)||0,q),z=(W,A,O)=>A===0&&O===1?W:(W-A)/(O-A)||0,D=(W,A,O)=>A===0&&O===1?W:W*(O-A)+A,Y=(W,A,O,q,H,Z,K)=>D(z(z(Math.min(H,Math.max(q,W)),A,O),z(q,A,O),z(H,A,O)),Z,K);class Q extends B{static get parameterDescriptors(){return Object.entries(T).map(([A,{defaultValue:O,minValue:q,maxValue:H}])=>({name:A,defaultValue:O,minValue:q,maxValue:H}))}constructor(A){super();this.destroyed=!1,this.supportSharedArrayBuffer=V;const{paramsMapping:O,internalParamsMinValues:q,internalParams:H,groupId:Z,instanceId:K}=A.processorOptions;this.groupId=Z,this.moduleId=U,this.instanceId=K,this.internalParamsMinValues=q,this.paramsConfig=T,this.paramsMapping=O,this.paramsValues={},Object.entries(T).forEach(([h,{defaultValue:y}])=>{this.paramsValues[h]=y}),this.internalParams=H,this.internalParamsCount=this.internalParams.length,this.buffer=new v((this.internalParamsCount+1)*Float32Array.BYTES_PER_ELEMENT),this.$lock=new Int32Array(this.buffer,0,1),this.$internalParamsBuffer=new Float32Array(this.buffer,4,this.internalParamsCount),this.eventQueue=[],this.handleEvent=null,I.webAudioModules.addWam(this),g.paramMgrProcessors||(g.paramMgrProcessors={}),g.paramMgrProcessors[this.instanceId]=this,this.messagePortRequestId=-1;const e={},i={};this.call=(h,...y)=>new Promise((S,p)=>{const u=this.messagePortRequestId--;e[u]=S,i[u]=p,this.port.postMessage({id:u,call:h,args:y})}),this.handleMessage=({data:h})=>{const{id:y,call:S,args:p,value:u,error:l}=h;if(S){const f={id:y};try{f.value=this[S](...p)}catch(s){f.error=s}this.port.postMessage(f)}else l?i[y]?.(l):e[y]?.(u),delete e[y],delete i[y]},this.port.start(),this.port.addEventListener("message",this.handleMessage)}setParamsMapping(A){this.paramsMapping=A}getBuffer(){return{lock:this.$lock,paramsBuffer:this.$internalParamsBuffer}}getCompensationDelay(){return 128}getParameterInfo(...A){A.length===0&&(A=Object.keys(this.paramsConfig));const O={};return A.forEach(q=>{O[q]=this.paramsConfig[q]}),O}getParameterValues(A,...O){O.length===0&&(O=Object.keys(this.paramsConfig));const q={};return O.forEach(H=>{if(!(H in this.paramsValues))return;const{minValue:Z,maxValue:K,exponent:e}=this.paramsConfig[H],i=this.paramsValues[H];q[H]={id:H,value:A?j(i,Z,K,e):i,normalized:A}}),q}scheduleEvents(...A){this.eventQueue.push(...A);const{currentTime:O}=I;this.eventQueue.sort((q,H)=>(q.time||O)-(H.time||O))}emitEvents(...A){m.emitEvents(this,...A)}clearEvents(){this.eventQueue=[]}lock(){globalThis.Atomics&&Atomics.store(this.$lock,0,1)}unlock(){globalThis.Atomics&&Atomics.store(this.$lock,0,0)}process(A,O,q){if(this.destroyed)return!1;const H=1;this.lock(),Object.entries(this.paramsConfig).forEach(([e,{minValue:i,maxValue:h}])=>{const y=q[e];e in this.paramsValues&&(this.paramsValues[e]=y[y.length-1]),!!this.paramsMapping[e]&&Object.entries(this.paramsMapping[e]).forEach(([S,p])=>{const u=this.internalParams.indexOf(S);if(u===-1)return;const l=this.internalParamsMinValues[u],{sourceRange:f,targetRange:s}=p,[r,t]=f,[o,c]=s;let d;i!==o||h!==c||i!==r||h!==t?d=y.map(b=>Y(b,i,h,r,t,o,c)-l):l?d=y.map(b=>b-l):d=y,d.length===1?O[u+H][0].fill(d[0]):O[u+H][0].set(d),this.$internalParamsBuffer[u]=d[0]})}),this.unlock(),this.supportSharedArrayBuffer||this.call("setBuffer",{lock:this.$lock,paramsBuffer:this.$internalParamsBuffer});const{currentTime:Z}=I;let K;for(K=0;K<this.eventQueue.length;K++){const e=this.eventQueue[K];if(e.time&&e.time>Z)break;typeof this.handleEvent=="function"&&this.handleEvent(e),this.call("dispatchWamEvent",e)}return K&&this.eventQueue.splice(0,K),!0}connectEvents(A,O){m.connectEvents(this.groupId,this.instanceId,A,O)}disconnectEvents(A,O){if(typeof A=="undefined"){m.disconnectEvents(this.groupId,this.instanceId);return}m.disconnectEvents(this.groupId,this.instanceId,A,O)}destroy(){I.webAudioModules.removeWam(this),g.paramMgrProcessors&&delete g.paramMgrProcessors[this.instanceId],this.destroyed=!0,this.port.close()}}try{a(U,Q)}catch(W){console.warn(W)}};N.default=L},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],dRPWr:[function(R,J,N){var E=R("@parcel/transformer-js/src/esmodule-helpers.js");E.defineInteropFlag(N);var L=R("./sdk/src/WamParameterInfo.js"),U=E.interopDefault(L);const T=(0,U.default)();class I{constructor(a={}){const{paramsConfig:m,paramsMapping:g,internalParamsConfig:V}=a;this._paramsConfig=m,this._paramsMapping=g,this._internalParamsConfig=V}_paramsConfig=void 0;get paramsConfig(){const{internalParamsConfig:a}=this;return Object.entries(this._paramsConfig||a).reduce((m,[g,V])=>{const v=a[g];return m[g]=new T(g,{...V,label:V.label??g,defaultValue:V.defaultValue??v?.defaultValue,minValue:V.minValue??v?.minValue,maxValue:V.maxValue??v?.maxValue}),m},{})}_internalParamsConfig=void 0;get internalParamsConfig(){return Object.entries(this._internalParamsConfig||{}).reduce((a,[m,g])=>{if(g instanceof AudioParam)a[m]=g;else{const V={minValue:0,maxValue:1,defaultValue:0,automationRate:30};a[m]={...V,...g}}return a},{})}_paramsMapping={};get paramsMapping(){const a=this._paramsMapping||{},m=this.paramsConfig,g=this.internalParamsConfig;return Object.entries(m).reduce((V,[v,{minValue:w,maxValue:j}])=>{const z=[w,j],D={sourceRange:z,targetRange:[...z]};if(a[v]){const Y=Object.entries(a[v]).reduce((Q,[W,A])=>(g[W]&&(Q[W]={...D,...A}),Q),{});V[v]=Y}else g[v]&&(V[v]={[v]:{...D}});return V},{})}}N.default=I},{"./sdk/src/WamParameterInfo.js":"fsZ9I","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],fsZ9I:[function(R,J,N){var E=R("@parcel/transformer-js/src/esmodule-helpers.js");E.defineInteropFlag(N);const L=U=>{const T=globalThis,I=(v,w)=>w===0?v:v**1.5**-w,B=(v,w)=>w===0?v:v**1.5**w,a=(v,w,j,z=0)=>I(w===0&&j===1?v:(v-w)/(j-w)||0,z),m=(v,w,j,z=0)=>w===0&&j===1?B(v,z):B(v,z)*(j-w)+w,g=(v,w,j)=>v>=w&&v<=j;class V{constructor(w,j={}){let{type:z,label:D,defaultValue:Y,minValue:Q,maxValue:W,discreteStep:A,exponent:O,choices:q,units:H}=j;z===void 0&&(z="float"),D===void 0&&(D=""),Y===void 0&&(Y=0),q===void 0&&(q=[]),z==="boolean"||z==="choice"?(A=1,Q=0,q.length?W=q.length-1:W=1):(Q===void 0&&(Q=0),W===void 0&&(W=1),A===void 0&&(A=0),O===void 0&&(O=0),H===void 0&&(H=""));const Z=`Param config error | ${w}: `;if(Q>=W)throw Error(Z.concat("minValue must be less than maxValue"));if(!g(Y,Q,W))throw Error(Z.concat("defaultValue out of range"));if(A%1||A<0)throw Error(Z.concat("discreteStep must be a non-negative integer"));if(A>0&&(Q%1||W%1||Y%1))throw Error(Z.concat("non-zero discreteStep requires integer minValue, maxValue, and defaultValue"));if(z==="choice"&&!q.length)throw Error(Z.concat("choice type parameter requires list of strings in choices"));this.id=w,this.label=D,this.type=z,this.defaultValue=Y,this.minValue=Q,this.maxValue=W,this.discreteStep=A,this.exponent=O,this.choices=q,this.units=H}normalize(w){return a(w,this.minValue,this.maxValue,this.exponent)}denormalize(w){return m(w,this.minValue,this.maxValue,this.exponent)}valueString(w){return this.choices?this.choices[w]:this.units!==""?`${w} ${this.units}`:`${w}`}}if(T.AudioWorkletProcessor){const v=T.webAudioModules.getModuleScope(U);v.WamParameterInfo||(v.WamParameterInfo=V)}return V};N.default=L},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],iyp0x:[function(R,J,N){var E=R("@parcel/transformer-js/src/esmodule-helpers.js");E.defineInteropFlag(N);var L=R("./MgrAudioParam.js"),U=E.interopDefault(L);const T=globalThis.AudioWorkletNode;class I extends T{constructor(a,m){super(a.audioContext,a.moduleId,{numberOfInputs:0,numberOfOutputs:1+m.processorOptions.internalParams.length,parameterData:m.parameterData,processorOptions:m.processorOptions});const{processorOptions:g,internalParamsConfig:V}=m;this.initialized=!1,this.module=a,this.instanceId=m.processorOptions.instanceId,this.groupId=m.processorOptions.groupId,this.paramsConfig=g.paramsConfig,this.internalParams=g.internalParams,this.internalParamsConfig=V,this.$prevParamsBuffer=new Float32Array(this.internalParams.length),this.paramsUpdateCheckFn=[],this.paramsUpdateCheckFnRef=[],this.messageRequestId=0,Object.entries(this.getParams()).forEach(([j,z])=>{Object.setPrototypeOf(z,U.default.prototype),z._info=this.paramsConfig[j]});const v={},w={};this.call=(j,...z)=>{const D=this.messageRequestId;return this.messageRequestId+=1,new Promise((Y,Q)=>{v[D]=Y,w[D]=Q,this.port.postMessage({id:D,call:j,args:z})})},this.handleMessage=({data:j})=>{const{id:z,call:D,args:Y,value:Q,error:W}=j;if(D){const A={id:z};try{A.value=this[D](...Y)}catch(O){A.error=O}this.port.postMessage(A)}else W?w[z]?.(W):v[z]?.(Q),delete v[z],delete w[z]},this.port.start(),this.port.addEventListener("message",this.handleMessage)}get parameters(){return super.parameters}get moduleId(){return this.module.moduleId}async initialize(){const a=await this.call("getBuffer"),{lock:m,paramsBuffer:g}=a;this.$lock=m,this.$paramsBuffer=g;const V=1;return Object.entries(this.internalParamsConfig).forEach(([v,w],j)=>{if(this.context.state==="suspended"&&(this.$paramsBuffer[j]=w.defaultValue),w instanceof AudioParam)try{w.automationRate="a-rate"}catch{}finally{w.value=Math.max(0,w.minValue),this.connect(w,V+j)}else w instanceof AudioNode?this.connect(w,V+j):this.requestDispatchIParamChange(v)}),this.connect(this.module.audioContext.destination,0,0),this.initialized=!0,this}setBuffer({lock:a,paramsBuffer:m}){this.$lock=a,this.$paramsBuffer=m}setParamsMapping(a){return this.call("setParamsMapping",a)}getCompensationDelay(){return this.call("getCompensationDelay")}getParameterInfo(...a){return this.call("getParameterInfo",...a)}getParameterValues(a,...m){return this.call("getParameterValues",a,...m)}scheduleAutomation(a){const m=a.time||this.context.currentTime,{id:g,normalized:V,value:v}=a.data,w=this.getParam(g);!w||(w.info.type==="float"?V?w.linearRampToNormalizedValueAtTime(v,m):w.linearRampToValueAtTime(v,m):V?w.setNormalizedValueAtTime(v,m):w.setValueAtTime(v,m))}scheduleEvents(...a){a.forEach(m=>{m.type==="wam-automation"&&this.scheduleAutomation(m)}),this.call("scheduleEvents",...a)}emitEvents(...a){this.call("emitEvents",...a)}clearEvents(){this.call("clearEvents")}dispatchWamEvent(a){a.type==="wam-automation"?this.scheduleAutomation(a):this.dispatchEvent(new CustomEvent(a.type,{detail:a}))}async setParameterValues(a){Object.keys(a).forEach(m=>{const g=a[m],V=this.parameters.get(m);!V||(g.normalized?V.normalizedValue=g.value:V.value=g.value)})}async getState(){return this.getParamsValues()}async setState(a){this.setParamsValues(a)}convertTimeToFrame(a){return Math.round(a*this.context.sampleRate)}convertFrameToTime(a){return a/this.context.sampleRate}requestDispatchIParamChange=a=>{const m=this.internalParamsConfig[a];if(!("onChange"in m))return;const{automationRate:g,onChange:V}=m;if(typeof g!="number"||!g)return;const v=1e3/g,w=this.internalParams.indexOf(a);w!==-1&&(w>=this.internalParams.length||(typeof this.paramsUpdateCheckFnRef[w]=="number"&&window.clearTimeout(this.paramsUpdateCheckFnRef[w]),this.paramsUpdateCheckFn[w]=()=>{const j=this.$prevParamsBuffer[w],z=this.$paramsBuffer[w];z!==j&&(V(z,j),this.$prevParamsBuffer[w]=z),this.paramsUpdateCheckFnRef[w]=window.setTimeout(this.paramsUpdateCheckFn[w],v)},this.paramsUpdateCheckFn[w]()))};getIParamIndex(a){const m=this.internalParams.indexOf(a);return m===-1?null:m}connectIParam(a,m,g){const V=1,v=this.getIParamIndex(a);v!==null&&(m instanceof AudioNode?typeof g=="number"?this.connect(m,V+v,g):this.connect(m,V+v):this.connect(m,V+v))}disconnectIParam(a,m,g){const V=1,v=this.getIParamIndex(a);v!==null&&(m instanceof AudioNode?typeof g=="number"?this.disconnect(m,V+v,g):this.disconnect(m,V+v):this.disconnect(m,V+v))}getIParamValue(a){const m=this.getIParamIndex(a);return m!==null?this.$paramsBuffer[m]:null}getIParamsValues(){const a={};return this.internalParams.forEach((m,g)=>{a[m]=this.$paramsBuffer[g]}),a}getParam(a){return this.parameters.get(a)||null}getParams(){return Object.fromEntries(this.parameters)}getParamValue(a){const m=this.parameters.get(a);return m?m.value:null}setParamValue(a,m){const g=this.parameters.get(a);!g||(g.value=m)}getParamsValues(){const a={};return this.parameters.forEach((m,g)=>{a[g]=m.value}),a}setParamsValues(a){!a||Object.entries(a).forEach(([m,g])=>{this.setParamValue(m,g)})}getNormalizedParamValue(a){const m=this.parameters.get(a);return m?m.normalizedValue:null}setNormalizedParamValue(a,m){const g=this.parameters.get(a);!g||(g.normalizedValue=m)}getNormalizedParamsValues(){const a={};return this.parameters.forEach((m,g)=>{a[g]=this.getNormalizedParamValue(g)}),a}setNormalizedParamsValues(a){!a||Object.entries(a).forEach(([m,g])=>{this.setNormalizedParamValue(m,g)})}setParamValueAtTime(a,m,g){const V=this.parameters.get(a);return V?V.setValueAtTime(m,g):null}setNormalizedParamValueAtTime(a,m,g){const V=this.parameters.get(a);return V?V.setNormalizedValueAtTime(m,g):null}linearRampToParamValueAtTime(a,m,g){const V=this.parameters.get(a);return V?V.linearRampToValueAtTime(m,g):null}linearRampToNormalizedParamValueAtTime(a,m,g){const V=this.parameters.get(a);return V?V.linearRampToNormalizedValueAtTime(m,g):null}exponentialRampToParamValueAtTime(a,m,g){const V=this.parameters.get(a);return V?V.exponentialRampToValueAtTime(m,g):null}exponentialRampToNormalizedParamValueAtTime(a,m,g){const V=this.parameters.get(a);return V?V.exponentialRampToNormalizedValueAtTime(m,g):null}setParamTargetAtTime(a,m,g,V){const v=this.parameters.get(a);return v?v.setTargetAtTime(m,g,V):null}setNormalizedParamTargetAtTime(a,m,g,V){const v=this.parameters.get(a);return v?v.setNormalizedTargetAtTime(m,g,V):null}setParamValueCurveAtTime(a,m,g,V){const v=this.parameters.get(a);return v?v.setValueCurveAtTime(m,g,V):null}setNormalizedParamValueCurveAtTime(a,m,g,V){const v=this.parameters.get(a);return v?v.setNormalizedValueCurveAtTime(m,g,V):null}cancelScheduledParamValues(a,m){const g=this.parameters.get(a);return g?g.cancelScheduledValues(m):null}cancelAndHoldParamAtTime(a,m){const g=this.parameters.get(a);return g?g.cancelAndHoldAtTime(m):null}connectEvents(a,m){this.call("connectEvents",a,m)}disconnectEvents(a,m){this.call("disconnectEvents",a,m)}async destroy(){this.disconnect(),this.paramsUpdateCheckFnRef.forEach(a=>{typeof a=="number"&&window.clearTimeout(a)}),await this.call("destroy"),this.port.close()}}N.default=I},{"./MgrAudioParam.js":"73ndB","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"73ndB":[function(R,J,N){var E=R("@parcel/transformer-js/src/esmodule-helpers.js");E.defineInteropFlag(N);class L extends AudioParam{get exponent(){return this.info.exponent}_info=void 0;get info(){return this._info}set info(T){this._info=T}set normalizedValue(T){this.value=this.info.denormalize(T)}get normalizedValue(){return this.info.normalize(this.value)}setValueAtTime(T,I){return super.setValueAtTime(T,I)}setNormalizedValueAtTime(T,I){const B=this.info.denormalize(T);return this.setValueAtTime(B,I)}linearRampToValueAtTime(T,I){return super.linearRampToValueAtTime(T,I)}linearRampToNormalizedValueAtTime(T,I){const B=this.info.denormalize(T);return this.linearRampToValueAtTime(B,I)}exponentialRampToValueAtTime(T,I){return super.exponentialRampToValueAtTime(T,I)}exponentialRampToNormalizedValueAtTime(T,I){const B=this.info.denormalize(T);return this.exponentialRampToValueAtTime(B,I)}setTargetAtTime(T,I,B){return super.setTargetAtTime(T,I,B)}setNormalizedTargetAtTime(T,I,B){const a=this.info.denormalize(T);return this.setTargetAtTime(a,I,B)}setValueCurveAtTime(T,I,B){return super.setValueCurveAtTime(T,I,B)}setNormalizedValueCurveAtTime(T,I,B){const a=Array.from(T).map(m=>this.info.denormalize(m));return this.setValueCurveAtTime(a,I,B)}cancelScheduledParamValues(T){return super.cancelScheduledValues(T)}cancelAndHoldParamAtTime(T){return super.cancelAndHoldAtTime(T)}}N.default=L},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],nvEVR:[function(R,J,N){var E=R("@parcel/transformer-js/src/esmodule-helpers.js");E.defineInteropFlag(N),E.export(N,"createSimpleEngine",()=>T);var L=R("@webaudiomodules/sdk-parammgr");class U extends L.CompositeAudioNode{_wamNode=void 0;isEnabled=!0;get paramMgr(){return this._wamNode}constructor(B,a){super(B,a);this.createNodes()}noteOn(){console.error("NOTE ON",arguments)}noteOff(){console.error("NOTE OFF",arguments)}setup(B){B.addEventListener("wam-midi",a=>this.processMIDIEvents([{event:a.detail.data.bytes,time:0}])),this._wamNode=B,this.connectNodes(),this._output=this.outputNode,console.log("simple.wam CONSTRUCTOR SETUP",{wamNode:B,thiswamNode:this._wamNode})}createNodes(){this.outputNode=this.context.createGain(),this.dryGainNode=this.context.createGain(),this.wetGainNode=this.context.createGain(),this.delayNode=this.context.createDelay(.05),this.feedbackGainNode=this.context.createGain(),this.channelMerger=this.context.createChannelMerger(2)}connectNodes(){super.connect(this.wetGainNode),super.connect(this.dryGainNode),this.wetGainNode.gain.value=.5,this.wetGainNode.connect(this.delayNode),this.delayNode.delayTime.value=.05,this.delayNode.connect(this.feedbackGainNode),this.feedbackGainNode.gain.value=.6,this.feedbackGainNode.connect(this.delayNode),this.feedbackGainNode.connect(this.wetGainNode),this.wetGainNode.connect(this.outputNode)}set status(B){this.isEnabled!==B&&(this.isEnabled=B,this.isEnabled?(console.log("BYPASS MODE OFF FX RUNNING"),this.wetGainNode.gain.linearRampToValueAtTime(1,this.context.currentTime+.5),this.dryGainNode.gain.linearRampToValueAtTime(0,this.context.currentTime+.5)):(console.log("BYPASS MODE ON"),this.wetGainNode.gain.linearRampToValueAtTime(0,this.context.currentTime+.5),this.dryGainNode.gain.linearRampToValueAtTime(1,this.context.currentTime+.5)))}processMIDIEvents(B){B.forEach(a=>{if(a.event[0]==MIDI.NOTE_ON){const m=a.event[1];a.event[2]?this.noteOn(m,a.time):this.noteOff(m,a.time)}else if(a.event[0]==MIDI.NOTE_OFF){const m=a.event[1];this.noteOff(m,a.time)}})}}N.default=U;const T=(I,B,a)=>new U(I,a)},{"@webaudiomodules/sdk-parammgr":"iUHts","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],iUHts:[function(R,J,N){var E=R("@parcel/transformer-js/src/esmodule-helpers.js");E.defineInteropFlag(N),E.export(N,"CompositeAudioNode",()=>w),E.export(N,"ParamMgrFactory",()=>K);var L=Object.defineProperty,U=Object.defineProperties,T=Object.getOwnPropertyDescriptors,I=Object.getOwnPropertySymbols,B=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,m=(e,i,h)=>i in e?L(e,i,{enumerable:!0,configurable:!0,writable:!0,value:h}):e[i]=h,g=(e,i)=>{for(var h in i||(i={}))B.call(i,h)&&m(e,h,i[h]);if(I)for(var h of I(i))a.call(i,h)&&m(e,h,i[h]);return e},V=(e,i)=>U(e,T(i)),v=(e,i,h)=>(m(e,typeof i!="symbol"?i+"":i,h),h),w=class extends GainNode{constructor(){super(...arguments);v(this,"_output"),v(this,"_wamNode")}get groupId(){return this.module.groupId}get moduleId(){return this.module.moduleId}get instanceId(){return this.module.instanceId}get module(){return this._wamNode.module}addEventListener(...e){return this._wamNode.addEventListener(...e)}removeEventListener(...e){return this._wamNode.removeEventListener(...e)}dispatchEvent(...e){return this._wamNode.dispatchEvent(...e)}getParameterInfo(...e){return this._wamNode.getParameterInfo(...e)}getParameterValues(...e){return this._wamNode.getParameterValues(...e)}setParameterValues(...e){return this._wamNode.setParameterValues(...e)}getState(){return this._wamNode.getState()}setState(...e){return this._wamNode.setState(...e)}getCompensationDelay(){return this._wamNode.getCompensationDelay()}scheduleEvents(...e){return this._wamNode.scheduleEvents(...e)}clearEvents(){return this._wamNode.clearEvents()}connectEvents(...e){return this._wamNode.connectEvents(...e)}disconnectEvents(...e){return this._wamNode.disconnectEvents(...e)}destroy(){return this._wamNode.destroy()}set channelCount(e){this._output?this._output.channelCount=e:super.channelCount=e}get channelCount(){return this._output?this._output.channelCount:super.channelCount}set channelCountMode(e){this._output?this._output.channelCountMode=e:super.channelCountMode=e}get channelCountMode(){return this._output?this._output.channelCountMode:super.channelCountMode}set channelInterpretation(e){this._output?this._output.channelInterpretation=e:super.channelInterpretation=e}get channelInterpretation(){return this._output?this._output.channelInterpretation:super.channelInterpretation}get numberOfInputs(){return super.numberOfInputs}get numberOfOutputs(){return this._output?this._output.numberOfOutputs:super.numberOfOutputs}get gain(){}connect(...e){return this._output&&this._output!==this?this._output.connect(...e):super.connect(...e)}disconnect(...e){return this._output&&this._output!==this?this._output.disconnect(...e):super.disconnect(...e)}},j=(e,i,...h)=>{const y=`(${i.toString()})(${h.map(p=>JSON.stringify(p)).join(", ")});`,S=URL.createObjectURL(new Blob([y],{type:"text/javascript"}));return e.addModule(S)},z=j,D=(e,i)=>{const h=globalThis,{AudioWorkletProcessor:y,registerProcessor:S,webAudioModules:p}=h,u=h.webAudioModules.getModuleScope(e),l=!!globalThis.SharedArrayBuffer,f=globalThis.SharedArrayBuffer||globalThis.ArrayBuffer,s=(b,n)=>n===0?b:b**1.5**-n,r=(b,n,_,M=0)=>s(n===0&&_===1?b:(b-n)/(_-n)||0,M),t=(b,n,_)=>n===0&&_===1?b:(b-n)/(_-n)||0,o=(b,n,_)=>n===0&&_===1?b:b*(_-n)+n,c=(b,n,_,M,P,C,$)=>o(t(t(Math.min(P,Math.max(M,b)),n,_),t(M,n,_),t(P,n,_)),C,$);class d extends y{static get parameterDescriptors(){return Object.entries(i).map(([n,{defaultValue:_,minValue:M,maxValue:P}])=>({name:n,defaultValue:_,minValue:M,maxValue:P}))}constructor(n){super();this.destroyed=!1,this.supportSharedArrayBuffer=l;const{paramsMapping:_,internalParamsMinValues:M,internalParams:P,groupId:C,instanceId:$}=n.processorOptions;this.groupId=C,this.moduleId=e,this.instanceId=$,this.internalParamsMinValues=M,this.paramsConfig=i,this.paramsMapping=_,this.paramsValues={},Object.entries(i).forEach(([k,{defaultValue:F}])=>{this.paramsValues[k]=F}),this.internalParams=P,this.internalParamsCount=this.internalParams.length,this.buffer=new f((this.internalParamsCount+1)*Float32Array.BYTES_PER_ELEMENT),this.$lock=new Int32Array(this.buffer,0,1),this.$internalParamsBuffer=new Float32Array(this.buffer,4,this.internalParamsCount),this.eventQueue=[],this.handleEvent=null,h.webAudioModules.addWam(this),u.paramMgrProcessors||(u.paramMgrProcessors={}),u.paramMgrProcessors[this.instanceId]=this,this.messagePortRequestId=-1;const x={},G={};this.call=(k,...F)=>new Promise((X,ee)=>{const te=this.messagePortRequestId--;x[te]=X,G[te]=ee,this.port.postMessage({id:te,call:k,args:F})}),this.handleMessage=({data:k})=>{var F,X;const{id:ee,call:te,args:ie,value:le,error:ne}=k;if(te){const re={id:ee};try{re.value=this[te](...ie)}catch(oe){re.error=oe}this.port.postMessage(re)}else ne?(F=G[ee])==null||F.call(G,ne):(X=x[ee])==null||X.call(x,le),delete x[ee],delete G[ee]},this.port.start(),this.port.addEventListener("message",this.handleMessage)}setParamsMapping(n){this.paramsMapping=n}getBuffer(){return{lock:this.$lock,paramsBuffer:this.$internalParamsBuffer}}getCompensationDelay(){return 128}getParameterInfo(...n){n.length===0&&(n=Object.keys(this.paramsConfig));const _={};return n.forEach(M=>{_[M]=this.paramsConfig[M]}),_}getParameterValues(n,..._){_.length===0&&(_=Object.keys(this.paramsConfig));const M={};return _.forEach(P=>{if(!(P in this.paramsValues))return;const{minValue:C,maxValue:$,exponent:x}=this.paramsConfig[P],G=this.paramsValues[P];M[P]={id:P,value:n?r(G,C,$,x):G,normalized:n}}),M}scheduleEvents(...n){this.eventQueue.push(...n);const{currentTime:_}=h;this.eventQueue.sort((M,P)=>(M.time||_)-(P.time||_))}emitEvents(...n){p.emitEvents(this,...n)}clearEvents(){this.eventQueue=[]}lock(){globalThis.Atomics&&Atomics.store(this.$lock,0,1)}unlock(){globalThis.Atomics&&Atomics.store(this.$lock,0,0)}process(n,_,M){if(this.destroyed)return!1;const P=1;this.lock(),Object.entries(this.paramsConfig).forEach(([x,{minValue:G,maxValue:k}])=>{const F=M[x];x in this.paramsValues&&(this.paramsValues[x]=F[F.length-1]),!!this.paramsMapping[x]&&Object.entries(this.paramsMapping[x]).forEach(([X,ee])=>{const te=this.internalParams.indexOf(X);if(te===-1)return;const ie=this.internalParamsMinValues[te],{sourceRange:le,targetRange:ne}=ee,[re,oe]=le,[ce,he]=ne;let se;G!==ce||k!==he||G!==re||k!==oe?se=F.map(ue=>c(ue,G,k,re,oe,ce,he)-ie):ie?se=F.map(ue=>ue-ie):se=F,se.length===1?_[te+P][0].fill(se[0]):_[te+P][0].set(se),this.$internalParamsBuffer[te]=se[0]})}),this.unlock(),this.supportSharedArrayBuffer||this.call("setBuffer",{lock:this.$lock,paramsBuffer:this.$internalParamsBuffer});const{currentTime:C}=h;let $;for($=0;$<this.eventQueue.length;$++){const x=this.eventQueue[$];if(x.time&&x.time>C)break;typeof this.handleEvent=="function"&&this.handleEvent(x),this.call("dispatchWamEvent",x)}return $&&this.eventQueue.splice(0,$),!0}connectEvents(n,_){p.connectEvents(this.groupId,this.instanceId,n,_)}disconnectEvents(n,_){if(typeof n=="undefined"){p.disconnectEvents(this.groupId,this.instanceId);return}p.disconnectEvents(this.groupId,this.instanceId,n,_)}destroy(){h.webAudioModules.removeWam(this),u.paramMgrProcessors&&delete u.paramMgrProcessors[this.instanceId],this.destroyed=!0,this.port.close()}}try{S(e,d)}catch(b){console.warn(b)}},Y=D,Q=e=>{const i=globalThis,h=(f,s)=>s===0?f:f**1.5**-s,y=(f,s)=>s===0?f:f**1.5**s,S=(f,s,r,t=0)=>h(s===0&&r===1?f:(f-s)/(r-s)||0,t),p=(f,s,r,t=0)=>s===0&&r===1?y(f,t):y(f,t)*(r-s)+s,u=(f,s,r)=>f>=s&&f<=r;class l{constructor(s,r={}){let{type:t,label:o,defaultValue:c,minValue:d,maxValue:b,discreteStep:n,exponent:_,choices:M,units:P}=r;t===void 0&&(t="float"),o===void 0&&(o=""),c===void 0&&(c=0),M===void 0&&(M=[]),t==="boolean"||t==="choice"?(n=1,d=0,M.length?b=M.length-1:b=1):(d===void 0&&(d=0),b===void 0&&(b=1),n===void 0&&(n=0),_===void 0&&(_=0),P===void 0&&(P=""));const C=`Param config error | ${s}: `;if(d>=b)throw Error(C.concat("minValue must be less than maxValue"));if(!u(c,d,b))throw Error(C.concat("defaultValue out of range"));if(n%1||n<0)throw Error(C.concat("discreteStep must be a non-negative integer"));if(n>0&&(d%1||b%1||c%1))throw Error(C.concat("non-zero discreteStep requires integer minValue, maxValue, and defaultValue"));if(t==="choice"&&!M.length)throw Error(C.concat("choice type parameter requires list of strings in choices"));this.id=s,this.label=o,this.type=t,this.defaultValue=c,this.minValue=d,this.maxValue=b,this.discreteStep=n,this.exponent=_,this.choices=M,this.units=P}normalize(s){return S(s,this.minValue,this.maxValue,this.exponent)}denormalize(s){return p(s,this.minValue,this.maxValue,this.exponent)}valueString(s){return this.choices?this.choices[s]:this.units!==""?`${s} ${this.units}`:`${s}`}}if(i.AudioWorkletProcessor){const f=i.webAudioModules.getModuleScope(e);f.WamParameterInfo||(f.WamParameterInfo=l)}return l},W=Q,A=W(),O=class{constructor(e={}){v(this,"_paramsConfig"),v(this,"_internalParamsConfig"),v(this,"_paramsMapping",{});const{paramsConfig:i,paramsMapping:h,internalParamsConfig:y}=e;this._paramsConfig=i,this._paramsMapping=h,this._internalParamsConfig=y}get paramsConfig(){const{internalParamsConfig:e}=this;return Object.entries(this._paramsConfig||e).reduce((i,[h,y])=>{var S,p,u,l;const f=e[h];return i[h]=new A(h,V(g({},y),{label:(S=y.label)!=null?S:h,defaultValue:(p=y.defaultValue)!=null?p:f==null?void 0:f.defaultValue,minValue:(u=y.minValue)!=null?u:f==null?void 0:f.minValue,maxValue:(l=y.maxValue)!=null?l:f==null?void 0:f.maxValue})),i},{})}get internalParamsConfig(){return Object.entries(this._internalParamsConfig||{}).reduce((e,[i,h])=>{if(h instanceof AudioParam)e[i]=h;else{const y={minValue:0,maxValue:1,defaultValue:0,automationRate:30};e[i]=g(g({},y),h)}return e},{})}get paramsMapping(){const e=this._paramsMapping||{},i=this.paramsConfig,h=this.internalParamsConfig;return Object.entries(i).reduce((y,[S,{minValue:p,maxValue:u}])=>{const l=[p,u],f={sourceRange:l,targetRange:[...l]};if(e[S]){const s=Object.entries(e[S]).reduce((r,[t,o])=>(h[t]&&(r[t]=g(g({},f),o)),r),{});y[S]=s}else h[S]&&(y[S]={[S]:g({},f)});return y},{})}},q=class extends AudioParam{constructor(){super(...arguments);v(this,"_info")}get exponent(){return this.info.exponent}get info(){return this._info}set info(e){this._info=e}set normalizedValue(e){this.value=this.info.denormalize(e)}get normalizedValue(){return this.info.normalize(this.value)}setValueAtTime(e,i){return super.setValueAtTime(e,i)}setNormalizedValueAtTime(e,i){const h=this.info.denormalize(e);return this.setValueAtTime(h,i)}linearRampToValueAtTime(e,i){return super.linearRampToValueAtTime(e,i)}linearRampToNormalizedValueAtTime(e,i){const h=this.info.denormalize(e);return this.linearRampToValueAtTime(h,i)}exponentialRampToValueAtTime(e,i){return super.exponentialRampToValueAtTime(e,i)}exponentialRampToNormalizedValueAtTime(e,i){const h=this.info.denormalize(e);return this.exponentialRampToValueAtTime(h,i)}setTargetAtTime(e,i,h){return super.setTargetAtTime(e,i,h)}setNormalizedTargetAtTime(e,i,h){const y=this.info.denormalize(e);return this.setTargetAtTime(y,i,h)}setValueCurveAtTime(e,i,h){return super.setValueCurveAtTime(e,i,h)}setNormalizedValueCurveAtTime(e,i,h){const y=Array.from(e).map(S=>this.info.denormalize(S));return this.setValueCurveAtTime(y,i,h)}cancelScheduledParamValues(e){return super.cancelScheduledValues(e)}cancelAndHoldParamAtTime(e){return super.cancelAndHoldAtTime(e)}},H=globalThis.AudioWorkletNode,Z=class extends H{constructor(e,i){super(e.audioContext,e.moduleId,{numberOfInputs:0,numberOfOutputs:1+i.processorOptions.internalParams.length,parameterData:i.parameterData,processorOptions:i.processorOptions});v(this,"requestDispatchIParamChange",u=>{const l=this.internalParamsConfig[u];if(!("onChange"in l))return;const{automationRate:f,onChange:s}=l;if(typeof f!="number"||!f)return;const r=1e3/f,t=this.internalParams.indexOf(u);t!==-1&&(t>=this.internalParams.length||(typeof this.paramsUpdateCheckFnRef[t]=="number"&&window.clearTimeout(this.paramsUpdateCheckFnRef[t]),this.paramsUpdateCheckFn[t]=()=>{const o=this.$prevParamsBuffer[t],c=this.$paramsBuffer[t];c!==o&&(s(c,o),this.$prevParamsBuffer[t]=c),this.paramsUpdateCheckFnRef[t]=window.setTimeout(this.paramsUpdateCheckFn[t],r)},this.paramsUpdateCheckFn[t]()))});const{processorOptions:h,internalParamsConfig:y}=i;this.initialized=!1,this.module=e,this.instanceId=i.processorOptions.instanceId,this.groupId=i.processorOptions.groupId,this.paramsConfig=h.paramsConfig,this.internalParams=h.internalParams,this.internalParamsConfig=y,this.$prevParamsBuffer=new Float32Array(this.internalParams.length),this.paramsUpdateCheckFn=[],this.paramsUpdateCheckFnRef=[],this.messageRequestId=0,Object.entries(this.getParams()).forEach(([u,l])=>{Object.setPrototypeOf(l,q.prototype),l._info=this.paramsConfig[u]});const S={},p={};this.call=(u,...l)=>{const f=this.messageRequestId;return this.messageRequestId+=1,new Promise((s,r)=>{S[f]=s,p[f]=r,this.port.postMessage({id:f,call:u,args:l})})},this.handleMessage=({data:u})=>{var l,f;const{id:s,call:r,args:t,value:o,error:c}=u;if(r){const d={id:s};try{d.value=this[r](...t)}catch(b){d.error=b}this.port.postMessage(d)}else c?(l=p[s])==null||l.call(p,c):(f=S[s])==null||f.call(S,o),delete S[s],delete p[s]},this.port.start(),this.port.addEventListener("message",this.handleMessage)}get parameters(){return super.parameters}get moduleId(){return this.module.moduleId}async initialize(){const e=await this.call("getBuffer"),{lock:i,paramsBuffer:h}=e;this.$lock=i,this.$paramsBuffer=h;const y=1;return Object.entries(this.internalParamsConfig).forEach(([S,p],u)=>{if(this.context.state==="suspended"&&(this.$paramsBuffer[u]=p.defaultValue),p instanceof AudioParam)try{p.automationRate="a-rate"}catch{}finally{p.value=Math.max(0,p.minValue),this.connect(p,y+u)}else p instanceof AudioNode?this.connect(p,y+u):this.requestDispatchIParamChange(S)}),this.connect(this.module.audioContext.destination,0,0),this.initialized=!0,this}setBuffer({lock:e,paramsBuffer:i}){this.$lock=e,this.$paramsBuffer=i}setParamsMapping(e){return this.call("setParamsMapping",e)}getCompensationDelay(){return this.call("getCompensationDelay")}getParameterInfo(...e){return this.call("getParameterInfo",...e)}getParameterValues(e,...i){return this.call("getParameterValues",e,...i)}scheduleAutomation(e){const i=e.time||this.context.currentTime,{id:h,normalized:y,value:S}=e.data,p=this.getParam(h);!p||(p.info.type==="float"?y?p.linearRampToNormalizedValueAtTime(S,i):p.linearRampToValueAtTime(S,i):y?p.setNormalizedValueAtTime(S,i):p.setValueAtTime(S,i))}scheduleEvents(...e){e.forEach(i=>{i.type==="wam-automation"&&this.scheduleAutomation(i)}),this.call("scheduleEvents",...e)}emitEvents(...e){this.call("emitEvents",...e)}clearEvents(){this.call("clearEvents")}dispatchWamEvent(e){e.type==="wam-automation"?this.scheduleAutomation(e):this.dispatchEvent(new CustomEvent(e.type,{detail:e}))}async setParameterValues(e){Object.keys(e).forEach(i=>{const h=e[i],y=this.parameters.get(i);!y||(h.normalized?y.normalizedValue=h.value:y.value=h.value)})}async getState(){return this.getParamsValues()}async setState(e){this.setParamsValues(e)}convertTimeToFrame(e){return Math.round(e*this.context.sampleRate)}convertFrameToTime(e){return e/this.context.sampleRate}getIParamIndex(e){const i=this.internalParams.indexOf(e);return i===-1?null:i}connectIParam(e,i,h){const y=1,S=this.getIParamIndex(e);S!==null&&(i instanceof AudioNode?typeof h=="number"?this.connect(i,y+S,h):this.connect(i,y+S):this.connect(i,y+S))}disconnectIParam(e,i,h){const y=1,S=this.getIParamIndex(e);S!==null&&(i instanceof AudioNode?typeof h=="number"?this.disconnect(i,y+S,h):this.disconnect(i,y+S):this.disconnect(i,y+S))}getIParamValue(e){const i=this.getIParamIndex(e);return i!==null?this.$paramsBuffer[i]:null}getIParamsValues(){const e={};return this.internalParams.forEach((i,h)=>{e[i]=this.$paramsBuffer[h]}),e}getParam(e){return this.parameters.get(e)||null}getParams(){return Object.fromEntries(this.parameters)}getParamValue(e){const i=this.parameters.get(e);return i?i.value:null}setParamValue(e,i){const h=this.parameters.get(e);!h||(h.value=i)}getParamsValues(){const e={};return this.parameters.forEach((i,h)=>{e[h]=i.value}),e}setParamsValues(e){!e||Object.entries(e).forEach(([i,h])=>{this.setParamValue(i,h)})}getNormalizedParamValue(e){const i=this.parameters.get(e);return i?i.normalizedValue:null}setNormalizedParamValue(e,i){const h=this.parameters.get(e);!h||(h.normalizedValue=i)}getNormalizedParamsValues(){const e={};return this.parameters.forEach((i,h)=>{e[h]=this.getNormalizedParamValue(h)}),e}setNormalizedParamsValues(e){!e||Object.entries(e).forEach(([i,h])=>{this.setNormalizedParamValue(i,h)})}setParamValueAtTime(e,i,h){const y=this.parameters.get(e);return y?y.setValueAtTime(i,h):null}setNormalizedParamValueAtTime(e,i,h){const y=this.parameters.get(e);return y?y.setNormalizedValueAtTime(i,h):null}linearRampToParamValueAtTime(e,i,h){const y=this.parameters.get(e);return y?y.linearRampToValueAtTime(i,h):null}linearRampToNormalizedParamValueAtTime(e,i,h){const y=this.parameters.get(e);return y?y.linearRampToNormalizedValueAtTime(i,h):null}exponentialRampToParamValueAtTime(e,i,h){const y=this.parameters.get(e);return y?y.exponentialRampToValueAtTime(i,h):null}exponentialRampToNormalizedParamValueAtTime(e,i,h){const y=this.parameters.get(e);return y?y.exponentialRampToNormalizedValueAtTime(i,h):null}setParamTargetAtTime(e,i,h,y){const S=this.parameters.get(e);return S?S.setTargetAtTime(i,h,y):null}setNormalizedParamTargetAtTime(e,i,h,y){const S=this.parameters.get(e);return S?S.setNormalizedTargetAtTime(i,h,y):null}setParamValueCurveAtTime(e,i,h,y){const S=this.parameters.get(e);return S?S.setValueCurveAtTime(i,h,y):null}setNormalizedParamValueCurveAtTime(e,i,h,y){const S=this.parameters.get(e);return S?S.setNormalizedValueCurveAtTime(i,h,y):null}cancelScheduledParamValues(e,i){const h=this.parameters.get(e);return h?h.cancelScheduledValues(i):null}cancelAndHoldParamAtTime(e,i){const h=this.parameters.get(e);return h?h.cancelAndHoldAtTime(i):null}connectEvents(e,i){this.call("connectEvents",e,i)}disconnectEvents(e,i){this.call("disconnectEvents",e,i)}async destroy(){this.disconnect(),this.paramsUpdateCheckFnRef.forEach(e=>{typeof e=="number"&&window.clearTimeout(e)}),await this.call("destroy"),this.port.close()}},K=class{static async create(e,i={}){const{audioContext:h,moduleId:y}=e,S=i.instanceId||e.instanceId,p=i.groupId||e.groupId,{paramsConfig:u,paramsMapping:l,internalParamsConfig:f}=new O(i),s=Object.entries(u).reduce((c,[d,{defaultValue:b}])=>(c[d]=b,c),{}),r=Object.entries(u).reduce((c,[d,{id:b,label:n,type:_,defaultValue:M,minValue:P,maxValue:C,discreteStep:$,exponent:x,choices:G,units:k}])=>(c[d]={id:b,label:n,type:_,defaultValue:M,minValue:P,maxValue:C,discreteStep:$,exponent:x,choices:G,units:k},c),{});await z(h.audioWorklet,Y,y,r);const t={internalParamsConfig:f,parameterData:s,processorOptions:{paramsConfig:u,paramsMapping:l,internalParamsMinValues:Object.values(f).map(c=>Math.max(0,(c==null?void 0:c.minValue)||0)),internalParams:Object.keys(f),groupId:p,instanceId:S,moduleId:y}},o=new Z(e,t);return await o.initialize(),o}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"4bM5M":[function(R,J,N){J.exports=R("bd1d48ef83d75769").getBundleURL("a82ob")+R("89d54cfb39ee5240").resolve("imUpw")},{bd1d48ef83d75769:"bGZ1f","89d54cfb39ee5240":"6jNRu"}],bGZ1f:[function(R,J,N){"use strict";var E={};function L(B){var a=E[B];return a||(a=U(),E[B]=a),a}function U(){try{throw new Error}catch(a){var B=(""+a.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^)\n]+/g);if(B)return T(B[2])}return"/"}function T(B){return(""+B).replace(/^((?:https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/.+)\/[^/]+$/,"$1")+"/"}function I(B){var a=(""+B).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^/]+/);if(!a)throw new Error("Origin not found");return a[0]}N.getBundleURL=L,N.getBaseURL=T,N.getOrigin=I},{}],"6jNRu":[function(R,J,N){"use strict";var E={};function L(T){for(var I=Object.keys(T),B=0;B<I.length;B++)E[I[B]]=T[I[B]]}function U(T){var I=E[T];if(I==null)throw new Error("Could not resolve bundle with id "+T);return I}J.exports.register=L,J.exports.resolve=U},{}],"1M6jQ":[function(R,J,N){J.exports=JSON.parse('{"name":"WamExample","identifier":"com.designerzen.simple","vendor":"designerzen","description":"Michel told me I should try this out","version":"1.0.0","apiVersion":"2.0.0","thumbnail":"screenshot.png","keywords":["ai","motion-capture","xr"],"website":"https://interface.place","isInstrument":true,"hasMidiInput":true,"hasAudioInput":true,"hasAudioOutput":true}')},{}]},["1ubN2"],"1ubN2","parcelRequireaaed")});export default pe();
