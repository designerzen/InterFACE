!function(e,t,n,r,a){var s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},o="function"==typeof s.parcelRequireaaed&&s.parcelRequireaaed,i=o.cache||{},l="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function c(t,n){if(!i[t]){if(!e[t]){var r="function"==typeof s.parcelRequireaaed&&s.parcelRequireaaed;if(!n&&r)return r(t,!0);if(o)return o(t,!0);if(l&&"string"==typeof t)return l(t);var a=new Error("Cannot find module '"+t+"'");throw a.code="MODULE_NOT_FOUND",a}d.resolve=function(n){var r=e[t][1][n];return null!=r?r:n},d.cache={};var u=i[t]=new c.Module(t);e[t][0].call(u.exports,d,u,u.exports,this)}return i[t].exports;function d(e){var t=d.resolve(e);return!1===t?{}:c(t)}}c.isParcelRequire=!0,c.Module=function(e){this.id=e,this.bundle=c,this.exports={}},c.modules=e,c.cache=i,c.parent=o,c.register=function(t,n){e[t]=[function(e,t){t.exports=n},{}]},Object.defineProperty(c,"root",{get:function(){return s.parcelRequireaaed}}),s.parcelRequireaaed=c;for(var u=0;u<t.length;u++)c(t[u]);var d=c(n);"object"==typeof exports&&"undefined"!=typeof module?module.exports=d:"function"==typeof define&&define.amd&&define((function(){return d}))}({"4dg9m":[function(e,t,n){e("./helpers/bundle-manifest").register(JSON.parse('{"kPWjp":"index.ebf7d130.js","1XLIV":"timing.settimeout.worker.867220de.js","9Dn3o":"manifest.7fa60d45.webmanifest","aoX8U":"android-chrome-512x512.d05e1292.png","75ujM":"android-chrome-192x192.48a3b030.png","cwD58":"android-chrome-48x48.e0fc3253.png","6Gxta":"android-chrome-24x24.b9ecdc58.png","e0yIn":"screen1.2625ade3.png","8VVsq":"screen2.e97de4be.png","i599B":"screen3.44f277a6.png","ecLhi":"changes.623ed1ac.js","kYk3P":"changes.b2d29960.html","6ZiDd":"service-worker.js","257vJ":"body.5843ea5b.js","5AKhY":"body.d76b56ab.js","d5l0U":"face.ba8735ea.js","blv9t":"share-menu.17201719.js"}'))},{"./helpers/bundle-manifest":"6jNRu"}],"6jNRu":[function(e,t,n){"use strict";var r={};t.exports.register=function(e){for(var t=Object.keys(e),n=0;n<t.length;n++)r[t[n]]=e[t[n]]},t.exports.resolve=function(e){var t=r[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}},{}],gPDLX:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js"),a=e("./store"),s=e("./state"),o=e("./audio/speech"),i=e("./audio/recorder"),l=e("./audio/audio"),c=e("./audio/synthesizers"),u=e("./audio/midi-out"),d=e("./timing/timing.js"),h=e("./timing/patterns"),p=e("./dom/ui"),m=e("./dom/dialog"),f=r.interopDefault(m),g=e("./dom/select"),v=e("./dom/toggle"),y=e("./dom/button"),b=e("./dom/text"),E=e("./dom/errors"),w=e("./dom/load-progress"),I=e("./dom/photographs"),x=e("./visual/canvas"),S=e("./visual/2d"),N=e("./visual/spectrograms"),_=e("./visual/quantise"),T=e("./visual/2d.stave"),M=(r.interopDefault(T),e("./location-handler")),A=e("./hardware/camera"),C=e("./models/instructions"),k=e("./reporting"),O=e("./version"),R=e("./maths/maths"),L=e("./person"),D=r.interopDefault(L),P=e("./i18n"),j=e("./settings"),B=e("./utils"),U=e("./pwa/pwa");const F=M.getReferer(),G=M.getRefererHostname().split(".").pop(),H=j.getDomainDefaults(G),V=document.documentElement,$=document.querySelector("main"),q=document.querySelector("img"),z={},W={};V.classList.toggle("loading",!0),V.classList.add(G),f.default();const Y=a.createStore();let K=s.loadState(H,$);M.forceSecure(K.debug);const{isRecording:Q,startRecording:X,stopRecording:J}=i.record(),Z=P.getBrowserLocales()[0],ee=[];let te,ne,re,ae,se,oe,ie,le,ce,ue,de=p.video,he=!0,pe=!1,me=!1,fe=!1,ge=!0,ve=!1,ye=!1,be=0;const Ee=Y.getItem("info")||{lastTime:-1,count:0},we=(Ee.lastTime>0&&(Date.now(),Ee.lastTime),{lag:0,drift:0}),Ie={x:1,y:1},xe=e=>{K.speak&&o.hasSpeech()&&o.say(e,!0)},Se=e=>{const t=l.setVolume(e);return Y.setItem("audio",{volume:t}),b.setToast(`Volume ${Math.ceil(100*t)}%`,0),t},Ne=e=>(e=>{d.setTimeBetween(e);const t=d.getBPM();return b.setToast(`Tempo : Period set at ${e} milliseconds between bars<br>or ${t}BPM`),Y.setItem("tempo",{period:e,bpm:t}),e})(6e4/e),_e=async(e,t)=>ee.map((async n=>{const r=await n[e](t);return b.setToast(`${n.name} has ${n.instrumentTitle} loaded`),r})),Te=async e=>await _e("loadRandomInstrument",e),Me=e=>{if(null==ee[e]){const t=((e,t)=>{K.duet;const n={dots:t,leftEyeIris:t,rightEyeIris:t,hue:360*Math.random(),debug:K.debug,photoSensitive:K.photoSensitive,instrumentPack:K.instrumentPack,stereoPan:K.stereo,drawMask:K.masks,drawEyes:K.eyes},r=Y.has(e)?Y.getItem(e):{},a=Object.assign({},n,r),s=new D.default(e,l.audioContext,re,a),o=r.instrument||l.randomInstrument();return s.button.addEventListener(L.EVENT_INSTRUMENT_CHANGED,(t=>{const{detail:n}=t;Y.setItem(e,{instrument:n.instrumentName}),b.setToast(`${n.instrument.title} Loaded`)})),s.loadInstrument(o,(e=>{})),s})(j.NAMES[e],L.EYE_COLOURS[e]);return ee.push(t),t}return ee[e]},Ae=(e,t)=>{ee.forEach((n=>{n.options[e]=t}))},Ce=e=>{const t=Array.isArray(e);ee.forEach(((n,r)=>{const a=t?e[r]:e;n.options={...n.options,...a}}))},ke=(e=0,t=[],n=0)=>{const r=Me(e),a=t[e<t.length?e:0];a?(r.setMIDI(a,n),console.log(K.midiChannel,r.hasMIDI?"Replacing":"Enabling",`MIDI #${n} for ${r.name}`,{ui:K,port:a,midiDevices:t,personIndex:e,midiChannel:n},ae.outputs[n])):console.error("No matching MIDI Instrument",K.midiChannel,r.hasMIDI?"Enabling":"Disabling",`MIDI #${n} for ${r.name}`,{ui:K,port:a,portIndex:n},ae.outputs[n])},Oe=e=>{const t=e.length;if(t>0){let n=`MIDI : <br>${e.map((e=>e.name||"MIDI Instrument")).join("<br>")}`;ee.forEach(((t,n)=>ke(n,e,K.midiChannel))),$.classList.toggle("midi-no-devices",!1),$.classList.toggle("midi-connected",!0),$.classList.toggle(`midi-devices-${t}`,!0),$.classList.remove("midi-unavailable"),b.setToast(n),se.setText("<span class='hide-text'>Click to </span>Disable"),se.setLabel(n)}else b.setFeedback(fe?"Lost MIDI Device connection":"MIDI Available but no instruments detected",0),b.setToast("No MIDI Devices connected"),$.classList.toggle("midi-no-devices",!0),$.classList.toggle("midi-connected",!1)},Re=async()=>(se=y.setupMIDIButton(document.getElementById("button-midi"),(async e=>(await(async()=>{try{ae=await u.setupMIDI(),ae.addListener("connected",(e=>Oe(ae.outputs))),ae.addListener("disconnected",(e=>Oe(ae.outputs))),Oe(ae.outputs),fe=ae,$.classList.add("midi-available")}catch(e){return console.error("Total MIDI failure",e),b.setFeedback("MIDI NOT Available<br>"+e,0),$.classList.add("midi-unavailable"),!1}return!0})(),b.setFeedback("MIDI available<br>Connecting to instruments...",0),$.classList.add("midi-activated"),!1))),!0),Le=()=>{let e="";window.addEventListener("keydown",(async t=>{const n=!isNaN(parseInt(t.key));switch(t.key){case"CapsLock":s.setState("debug",!K.debug),ee.forEach((e=>e.debug=K.debug)),b.setToast(`DEBUG : ${K.debug}`),xe(K.debug?"secret mode unlocked":"disabling developer mode");break;case"Space":Te();break;case"ArrowLeft":(async e=>{await _e("loadPreviousInstrument",e)})();break;case"ArrowRight":(async e=>{await _e("loadNextInstrument",e)})();break;case"QuestionMark":case"?":xe(document.getElementById("toast").innerText);break;case"ArrowUp":let e=d.getBars()+1,t=d.setBars(e);d.setTimeBetween(d.timePerBar());b.setToast(`Bars : ${t} / BPM : ${d.getBPM()}`);break;case"ArrowDown":let r=d.getBars()-1,a=d.setBars(r);d.setTimeBetween(d.timePerBar());b.setToast(`Bars ${a} / BPM : ${d.getBPM()}`);break;case",":S.setNodeCount(-1);break;case".":S.setNodeCount(1);break;case"a":le.kick();break;case"b":s.setState("backingTrack",!K.backingTrack,z),b.setToast(K.backingTrack?"Backing track starting":"Ending Backing Track");break;case"c":s.setState("clear",!K.clear,z);break;case"d":le.hat();break;case"e":le.clack();break;case"f":p.toggleVisibility(document.getElementById("shared-controls"));break;case"g":const o=p.toggleVisibility(document.getElementById("feedback"));p.toggleVisibility(document.getElementById("toast")),K.text=o;break;case"h":p.toggleVisibility(x.canvas);break;case"i":const i=await l.setReverb();b.setToast(`Reverb : '${i}' loaded`);break;case"j":case"v":p.toggleVisibility(p.video);break;case"k":case"Tab":break;case"l":s.setState("speak",!K.speak,z),b.setToast(K.speak?"Reading out instructions":"Staying quiet");break;case"m":s.setState("metronome",!K.metronome,z),b.setToast(K.metronome?"Quantised enabled":"Quantise disabled");break;case"q":s.setState("muted",!K.muted,z),Se(K.muted?1:0);break;case"r":Q()?(console.error("Recording END",ue),b.setToast("Recording Ended - now encoding"),J().then((e=>{const t=encodeRecording(e,"audio/mp3;"),n=window.URL.createObjectURL(t);console.error("Recording END",{recording:e,audioSrc:n,mp3:t})}))):(b.setToast("Recording START"),console.error("Recording START",re),ue=await X(re),console.error("Recording...",ue));break;case"s":le.snare();break;case"t":s.setState("text",!K.text,z);break;case"w":le.cowbell();break;case"x":const c=d.tapTempo();c>1&&Ne(c);break;case"z":be=0;break;default:n||(Te(),xe("Loading random instruments"))}if(n){if(e+=t.key,3===e.length){const t=parseFloat(e);Ne(t),e=""}}else e="";M.addToHistory(K,t.key)}))};w.setLoadProgress(0,"Initialising... Please wait"),ie=k.setupReporting("InterFACE"),V.classList.toggle("debug",K.debug);let De=!1;const Pe=async()=>{if(!De){De=!0;try{await e("646f9ac66a9da2e7")}catch(e){V.classList.add("sharing-disabled")}null}},je=async()=>{he?requestAnimationFrame(je):me?(V.classList.add("failure"),y.showReloadButton()):(async()=>{const e=()=>{if(ye)return xe("Hello! Open your mouth to begin!"),V.classList.toggle("searching-for-user",!1),Me(0);requestAnimationFrame(e)};V.classList.toggle("loading",!1),V.classList.toggle("loaded",!0),Le(),V.classList.toggle("searching-for-user",!0),xe("I am looking for your face");const t=await e();K.debug&&console.log(`InterFACE Version ${O.VERSION} from ${F} in ${Z} used ${Ee.count} times, last time was ${Math.ceil(Ee.timeElapsedSinceLastPlay/1e3)} seconds ago`,t)})()},Be=Object.assign({},j.DEFAULT_TENSORFLOW_OPTIONS,{maxFaces:K.duet?2:1});(async(t,n)=>{let r,a,o=0;if(n(o++/3),"body"===t.model){const{loadBodyModel:t}=await e("ff03fadd294516ba");r=t}else{const{loadFaceModel:t}=await e("b299360f26953c8b");r=t}n(o++/3),p.setupInterface(K),n(o++/3),z.quantise=v.setToggle("button-quantise",(e=>{s.setState("quantise",e),b.setToast("Quantise "+(K.quantise?"enabled":"disabled"))}),K.quantise),z.settings=v.setToggle("button-settings",(e=>{s.setState("showSettings",e),b.setToast("Settings "+(e?"enabled":"disabled"))}),K.showSettings),z.metronome=v.setToggle("button-metronome",(e=>{s.setState("metronome",e),b.setToast("Metronome "+(K.metronome?"enabled":"disabled"))}),K.metronome),z.backingTrack=v.setToggle("button-percussion",(e=>{s.setState("backingTrack",e),b.setToast(K.backingTrack?"Backing track starting":"Ending Backing Track")}),K.backingTrack),z.spectrogram=v.setToggle("button-spectrogram",(e=>{s.setState("spectrogram",e),b.setToast("Spectrogram "+(K.spectrogram?"enabled":"disabled"))}),K.spectrogram),z.speak=v.setToggle("button-speak",(e=>{s.setState("speak",e),b.setToast("Speaking "+(K.speak?"enabled":"disabled"))}),K.speak),z.transparent=v.setToggle("button-transparent",(e=>{s.setState("transparent",!e),b.setToast("Video Synch "+(K.spectrogram?"enabled":"disabled"))}),K.transparent),z.clear=v.setToggle("button-clear",(e=>{s.setState("clear",e)}),K.clear),z.muted=v.setToggle("button-mute",(e=>{s.setState("muted",!K.muted),Se(K.muted?1:0)}),K.muted),z.disco=v.setToggle("button-disco",(e=>{var t;s.setState("masks",e),e?(K.clear=!1,t=["drawMask","drawNodes","drawMesh","meshOnSing"],a=ee.map((e=>t.reduce(((t,n,r,a)=>(t[n]=e.options[n],t)),{}))),Ce({drawMask:!0,drawNodes:!1,drawMesh:!1,meshOnSing:!0})):(K.clear=!0,Ce(a),a=null)}),K.masks),z.masks=v.setToggle("button-meshes",(e=>{s.setState("masks",!K.masks),Ae("drawMask",K.masks)}),K.masks),z.eyes=v.setToggle("button-eyes",(e=>{s.setState("eyes",!K.eyes),Ae("drawEyes",K.eyes)}),K.eyes),z.overlay=v.setToggle("button-overlay",(e=>{p.toggleVideoVisiblity(!p.isVideoVisible())})),z.text=v.setToggle("button-subtitles",(e=>{s.setState("text",!K.text)})),y.setButton("button-photograph",(e=>{I.appendPhotographElement()})),y.setButton("button-video",(e=>Te())),y.setButton("button-reset",(e=>{K={...H},s.refreshState()})),W.tempo=g.connectSelect("select-tempo",(e=>{const t=parseInt(e.innerHTML);p.updateTempo(t),Ne(t)})),W.eyes=g.connectSelect("select-eyes",(e=>{const t=e.value.split(","),n=B.convertOptionToObject(t);Ce({scleraRadius:n.s,irisRadius:n.i,pupilRadius:n.p,eyeRatio:n.a||1})})),W.samples=g.connectSelect("select-samples",(async e=>{const t=e.value;Ce({instrumentPack:t});await(async e=>await _e("reloadInstrument",e))();s.setState("instrumentPack",t)})),W.palette=g.connectSelect("select-palette",(e=>{const t=e.value.split(","),n=B.convertOptionToObject(t);Ce({saturation:n.s,luminosity:n.l})})),W.reverbs=g.connectReverbControls((async e=>{if(e&&e.value){const t=e.value;await l.setReverb(t)}else console.error(e,e.previousSibling)}));const i=document.getElementById("link-about");return B.addMouseTapAndHoldEvents(i),i.addEventListener(B.MOUSE_TAP,(e=>{})),i.addEventListener(B.MOUSE_HELD,(e=>{})),s.refreshState(),n(o++/3),r(de,t)})(Be,((e,t)=>{w.setLoadProgress(e,t)})).then((async e=>{b.setFeedback(""),b.setToast(""),V.classList.toggle("loading",!1),requestAnimationFrame(Pe);let t=setTimeout((()=>{b.setToast("Please select how many players you want to play"),t=setTimeout((()=>b.setToast("by clicking either button")),15e3)}),6e4);try{const{players:e,advancedMode:t}=await p.showPlayerSelector(Be);s.setState("duet",e>1),s.setState("advancedMode",t)}catch(e){console.error("player selection failed",e)}return b.setFeedback("Please wait loading! This can take <strong>some</strong> time..."),clearInterval(t),V.classList.toggle("loading",!0),b.setToast(""),(async(e,t,n)=>{let r=0;$.classList.add(G);try{if(b.setFeedback("Setting things up...<br>This can take a while!"),n(r++/7,"Setting things up..."),q&&(b.setFeedback("Image downloaded...<br> Please wait"),ne=await S.setupImage(q)),n(r++/7,"Looking for cameras"),p.video){b.setFeedback("Attempting to locate a camera...<br>Please click accept if you are prompted");const e=await A.findBestCamera(Y,p.video),{videoCameraDevices:t}=e;te=e.camera,ge=!1,b.setFeedback(e.saved?"Found saved camera":t.length>1?"Located a Camera but you can change it in Settings > Camera":"Located front facing camera"),t.length>1&&(p.setupCameraForm(t,(async e=>{ge=!0,te=await A.loadCamera(p.video,e.value,e.label),ge=!1,Y.setItem("camera",{deviceId:e.value}),b.setToast(`Camera ${e.label} changed`,0)})),$.classList.toggle("multiple-cameras",!0)),b.setFeedback("Camera connected",0),n(r++/7,"Camera connected")}$.style.setProperty("--width",p.video.width),$.style.setProperty("--height",p.video.height),$.classList.toggle("landscape",p.video.width>p.video.height),$.classList.toggle("portrait",p.video.width<p.video.height),$.classList.toggle("square",p.video.width===p.video.height),x.updateCanvasSize(p.video.width,p.video.height),n(r++/7)}catch(e){const t=String(e).replace("NotAllowedError: ","");return b.setFeedback(`Camera could not be accessed<br><strong>${t}</strong>`,0),b.setToast(t),he=!1,me=!0,void k.trackError("Camera Rejected or Not allowed")}try{const e=Y.getItem("audio"),t=e?e.volume:1;re=await l.setupAudio(),Se(t),n(r++/7),le=c.createDrumkit(),ce=h.kitSequence(),b.setFeedback("Audio available...<br>Instrument Sounds ready"),n(r++/7)}catch(e){return me=!0,void b.setFeedback("Something went wrong with the Audio<br>"+e,0)}if(u.testForMIDI()){try{await Re()?$.classList.add("midi"):($.classList.add("midi","no-instrument"),b.setFeedback("MIDI available<br>Connect a MIDI instrument <strong>and click the button</strong>",0))}catch(e){console.log("no MIDI!",e),$.classList.add("no-midi"),$.classList.add("midi-unavailable"),b.setFeedback("MIDI unavailable, or no instrument connected<br>"+e,0)}n(r++/7,"MIDI Located")}else n(r++/7),$.classList.add("midi-unavailable"),b.setFeedback("MIDI is not available in this browser,<br>It'll work better in Brave, Edge or Chrome",0);x.canvas.width=de.width,x.canvas.height=de.height,$.classList.add(de.nodeName.toLowerCase()),b.addToolTips(document.getElementById("controls"));const a=Y.getItem("audio")?parseFloat(Y.getItem("audio").volume):1;l.setVolume(a>0?a:1),n(r++/7),e(de===p.video,(e=>{if(be++,he&&(he=!1),ge)return;let t="";if(K.clear)x.clear(),K.transparent||x.drawElement(de);else{const e=.01*be%R.TAU;x.overdraw(-7*Ie.x+Math.sin(e),-4*Ie.y+Math.cos(e))}K.quantise&&_.drawQuantise(pe,d.getBar(),d.getBars()),K.spectrogram&&(l.updateByteFrequencyData(),N.drawBars(l.dataArray,l.bufferLength));let n=!1;if(e){for(let r=0,a=e.length;r<a;++r){const a=e[r],s=Me(r);if(!(a&&a.faceInViewConfidence>.9))return void(ve||($.classList.toggle(`${s.name}-active`,!1),$.classList.toggle("no-faces",!0),ve=!0));if(ve&&(ve=!1,$.classList.toggle(`${s.name}-active`,!0),$.classList.toggle("no-faces",!1)),ye=!0,n=!0,s.update(a),s.draw(a,K.text,!1,pe),!K.quantise&&!K.muted){const e=s.sing();s.singing,0===r&&(Ie.x=e.eyeDirection,Ie.y=e.pitch)}t+=`<br>PITCH:${a.pitch} ROLL:${a.roll} YAW:${a.yaw} MOUTH:${Math.ceil(100*a.mouthRange)}%`}n||b.setFeedback(C.getHelp(Math.floor(be/100)))}e?b.setFeedback(C.getInstruction(Math.floor(be/100))):b.setFeedback(C.getHelp(Math.floor(be/100))),pe&&(pe=!1)}),(()=>!ge)),oe=d.startTimer((e=>{const{bar:t,bars:n,barsElapsed:r,timePassed:a,elapsed:s,expected:o,drift:i,level:l,intervals:c,lag:u}=e;if(we.lag=u,we.drift=i,!K.muted){if(K.metronome&&n){const e=.1;le.clack(e,n%4==0?.2:.1)}if(K.quantise)for(let e=0,t=ee.length;e<t;++e){const t=Me(e).sing();0===e&&(Ie.x=t.eyeDirection,Ie.y=t.pitch)}K.backingTrack&&t%2==0&&(h.playNextPart(ce.kick,le.kick),h.playNextPart(ce.snare,le.snare),h.playNextPart(ce.hat,le.hat)),pe=!0}}),d.convertBPMToPeriod(s.getState("bpm")))})(e,0,(e=>{w.setLoadProgress(e)}))})).then((e=>{p.focusApp()})).catch((e=>{E.showError(e,"Try hard refresh")})),je(),window.onbeforeunload=()=>{const e=Object.assign({},Ee,{lastTime:Date.now(),count:Ee.count++});Y.setItem("info",e),k.trackExit(),b.setToast("bye bye!"),b.setFeedback("<strong>I hope you had fun!</strong>")},document.addEventListener("visibilitychange",(e=>{document.documentElement.classList.toggle("tab-hidden",document.hidden)}),!1),window.oncontextmenu=()=>{be=0},window.addEventListener("popstate",(e=>{})),U.installOrUpdate(K.debug).then((e=>{if(console.log("PWA",e.log,{state:e}),V.classList.toggle("updates-available",e.updateAvailable),V.classList.toggle("first-run",e.isFirstRun),V.classList.toggle("installable",e.isInstallable),e.isInstallable){const t=document.getElementById("button-install");t.addEventListener("click",(async n=>{const r=await e.install(t);console.log("installed",r.success,{installed:r}),b.setToast(r.success?"Installed to HomeScreen":"You can always install again in the future")})),t.hidden=!1}else if(e.updatesAvailable){document.getElementById("button-update")}})).catch((e=>console.error("PWA",e)))},{"./store":"g3Glw","./state":"8OFN5","./audio/speech":"8DrPb","./audio/recorder":"hVk2E","./audio/audio":"kGLQw","./audio/synthesizers":"aonYx","./audio/midi-out":"ce9G1","./timing/timing.js":"adRuD","./timing/patterns":"4s9sC","./dom/ui":"dAURW","./dom/dialog":"l66Iq","./dom/select":"cBFxP","./dom/toggle":"f71P0","./dom/button":"6WDhH","./dom/text":"cwBIr","./dom/errors":"9dSnZ","./dom/load-progress":"iSXnP","./dom/photographs":"h5wXQ","./visual/canvas":"2h2QK","./visual/2d":"2Ac2W","./visual/spectrograms":"ZL00j","./visual/quantise":"2HWvY","./visual/2d.stave":"3T44M","./location-handler":"6ch5Y","./hardware/camera":"6WcRe","./models/instructions":"kq8Be","./reporting":"2GQJM","./version":"98oCg","./maths/maths":"iDBHd","./person":"iikaL","./i18n":"xOeWy","./settings":"h7RGC","./utils":"9g7cm","./pwa/pwa":"6fCzM",ff03fadd294516ba:"bGgTT",b299360f26953c8b:"M23qu","646f9ac66a9da2e7":"7LLzG","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],g3Glw:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"createStore",(()=>s));var a=e("./utils");const s=(e="InterFACE")=>{const t=localStorage.getItem(e),n=Object.assign({},JSON.parse(t)),r=a.debounce((t=>{const n=JSON.stringify(t);localStorage.setItem(e,n)}),20);return{save:r,has:e=>!!n[e],removeItem:e=>{delete n[e]},getItem:e=>n[e],setItem:(e,t)=>(n[e]=Object.assign({},n[e],t),r(n),n)}}},{"./utils":"9g7cm","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"9g7cm":[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"convertOptionToObject",(()=>a)),r.export(n,"debounce",(()=>s)),r.export(n,"MOUSE_HELD",(()=>i)),r.export(n,"MOUSE_HOLDING",(()=>l)),r.export(n,"MOUSE_TAP",(()=>c)),r.export(n,"addMouseTapAndHoldEvents",(()=>u)),r.export(n,"decodeBase64",(()=>d));const a=e=>e.reduce(((e,t)=>{const n=t.split(":");return e[n[0]]=parseFloat(n[1]),e}),{}),s=(e,t)=>{let n;return(...r)=>(clearTimeout(n),n=setTimeout((()=>e(...r)),t),n)},o=()=>performance.now()||Date.now(),i="mouse_held",l="mouse_holding",c="mouse_tap",u=(e,t=800)=>{let n=-1,r=!1,a=!1;const s=(t,n={})=>{e.dispatchEvent(new CustomEvent(t,{detail:n}))},u=()=>{if(r&&a){const e=o()-n;if(e<t){const n=1-e/t,a=100-Math.ceil(100*n);console.log("mouseDownFor",a,{elapsed:e,remaining:n}),s(l,{elapsed:e,isMouseOver:r,remaining:n,percentageRemaining:a}),requestAnimationFrame(u)}else n=-1}};return e.addEventListener("mousedown",(e=>{n=o(),a=!0,u(),e.preventDefault()})),e.addEventListener("mouseup",(e=>{const l=o()-n;s(l<t?c:i,{elapsed:l,isMouseOver:r}),n=-1,a=!1,e.preventDefault()})),e.addEventListener("mouseover",(e=>{r=!0})),e.addEventListener("mouseout",(e=>{r=!1})),{}};const d=(e,t)=>{const n=e.replace(/[^A-Za-z0-9\+\/]/g,""),r=n.length,a=t?Math.ceil((3*r+1>>2)/t)*t:3*r+1>>2,s=new Uint8Array(a);for(let e,t,i=0,l=0,c=0;c<r;c++)if(t=3&c,i|=((o=n.charCodeAt(c))>64&&o<91?o-65:o>96&&o<123?o-71:o>47&&o<58?o+4:43===o?62:47===o?63:0)<<18-6*t,3===t||r-c==1){for(e=0;e<3&&l<a;e++,l++)s[l]=i>>>(16>>>e&24)&255;i=0}var o;return s}},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"14tkN":[function(e,t,n){n.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},n.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.exportAll=function(e,t){return Object.keys(e).forEach((function(n){"default"===n||"__esModule"===n||t.hasOwnProperty(n)||Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[n]}})})),t},n.export=function(e,t,n){Object.defineProperty(e,t,{enumerable:!0,get:n})}},{}],"8OFN5":[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"getState",(()=>l)),r.export(n,"createState",(()=>c)),r.export(n,"loadState",(()=>u)),r.export(n,"refreshState",(()=>d)),r.export(n,"setState",(()=>h));var a=e("./location-handler");let s,o=null;const i=(e,t)=>{s.classList.toggle(`flag-${e}`,t)},l=e=>e?o[e]:o,c=(e,t)=>(o=Object.assign({},e),s=t||document.documentElement,o),u=(e,t)=>c(a.getLocationSettings(e),t),d=()=>(Object.entries(o).forEach((([e,t])=>{i(e,t)})),o),h=(e,t,n=null,r=!0)=>(o[e]=t,r&&a.addToHistory(o,e),i(e,t),n&&n[e]&&(n[e].setAttribute("checked",t),"LABEL"===n[e].parentNode.nodeName&&n[e].parentNode.classList.toggle("checked",t)),o)},{"./location-handler":"6ch5Y","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"6ch5Y":[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"parseType",(()=>s)),r.export(n,"getLocationSettings",(()=>o)),r.export(n,"createQueryString",(()=>i)),r.export(n,"getShareLink",(()=>l)),r.export(n,"getReferer",(()=>c)),r.export(n,"getRefererHostname",(()=>u)),r.export(n,"refresh",(()=>d)),r.export(n,"forceSecure",(()=>h)),r.export(n,"addToHistory",(()=>p));const a=e=>{if("string"==typeof e){const t=e.toLowerCase();return"true"===t||"1"===t||"false"!==t&&"0"!==t&&e}return Array.isArray(e)?e.toString():data},s=e=>"string"==typeof e?isNaN(parseFloat(e))?"true"===e.toLowerCase()||"false"!==e&&(e.indexOf(",")>=0?convertIntegerArrayToBooleans(e.split(",")):e):parseFloat(e):Array.isArray(e)?e.toString():e,o=e=>{{const t=new URLSearchParams(window.location.search),n=Object.assign({},e);for(const[e,r]of t)n[e]=a(r);return n}},i=e=>new URLSearchParams(e).toString(),l=e=>window.location+i(e),c=()=>document.referrer||document.location||"interface.place",u=()=>new URL(c()).hostname,d=e=>{e&&p(e),window.location.reload()},h=(e=!1)=>{e||"localhost"===location.hostname||"https:"===location.protocol||(location.protocol="https:")},p=(e,t="")=>{const n=new URL(window.location);for(let t in e){const r=e[t];n.searchParams.set(t,r)}window.history.pushState(e,t,n)}},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"8DrPb":[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"hasSpeech",(()=>a)),r.export(n,"say",(()=>o)),r.export(n,"stopSpeaking",(()=>i)),r.export(n,"isVoiceActive",(()=>l));const a=()=>"speechSynthesis"in window,s=async()=>new Promise(((e,t)=>{let n;const r=Date.now(),a=()=>{if(n=window.speechSynthesis.getVoices(),n.length>0)e(n);else{Date.now()-r<1e4?setTimeout(a,0):t("No voices found")}};a()})),o=async(e,t=!0,n=1,r=1,o=1,i,l)=>new Promise(((c,u)=>{if(a){const a=async()=>{try{const a=i&&l?await(async(e="en-US",t="Zira")=>{const n=s(),r=n.filter((n=>n.lang===e&&n.name.indexOf(t)>-1));return r.length<1?n:r})(i,l):await s(),d=a[0],h=new SpeechSynthesisUtterance;h.lang="en-US",h.voice=d,h.voiceURI="native",h.onend=e=>{h.onend=null,c(e)},h.onerror=e=>{u()},h.volume=n,h.rate=r,h.pitch=o,h.text=e,t&&window.speechSynthesis.cancel(),window.speechSynthesis.speak(h)}catch(e){u(e)}};a()}else u("Speech tech not available")})),i=()=>window.speechSynthesis.cancel(),l=()=>window.speechSynthesis.pending},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],hVk2E:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"record",(()=>a));const a=e=>{let t,n=!1;return{isAvailable:()=>!!(window&&window.MediaRecorder&&"function"==typeof window.MediaRecorder.isTypeSupported&&window.Blob),downloadRecording:()=>{var e=new Blob(recordedChunks,{type:"video/webm"}),t=URL.createObjectURL(e),n=document.createElement("a");document.body.appendChild(n),n.style="display: none",n.href=t,n.download="test.webm",n.click(),window.URL.revokeObjectURL(t)},encodeRecording:(e,t="audio/mp3;")=>new Blob(e,{type:t}),startRecording:e=>new Promise(((r,a)=>{if(n)return a("already recording");t=[],mediaRecorder=new MediaRecorder(e),mediaRecorder.ondataavailable=n=>{t.push(n.data),r({mediaRecorder:mediaRecorder,dataArray:t,stream:e})},mediaRecorder.onwarning=function(e){console.log("onwarning fired")},mediaRecorder.onerror=e=>{switch(console.log("onerror fired"),e.name){case"InvalidState":case"OutOfMemory":case"IllegalStreamModification":case"OtherRecordingError":case"GenericError":break;default:console.error("MediaRecorder Error",e)}},mediaRecorder.start(),n=!0})),stopRecording:()=>new Promise(((e,r)=>{if(!n)return r("Not recording");mediaRecorder.onstop=r=>{n=!1,e(t)},mediaRecorder.stop()})),isRecording:()=>n}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],kGLQw:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"audioContext",(()=>d)),r.export(n,"bufferLength",(()=>h)),r.export(n,"dataArray",(()=>p)),r.export(n,"playing",(()=>y)),r.export(n,"active",(()=>b)),r.export(n,"randomInstrument",(()=>E)),r.export(n,"chooseFilters",(()=>w)),r.export(n,"setReverb",(()=>x)),r.export(n,"setupAudio",(()=>S)),r.export(n,"updateByteFrequencyData",(()=>N)),r.export(n,"updateByteTimeDomainData",(()=>_)),r.export(n,"stopAudio",(()=>M)),r.export(n,"playAudio",(()=>A)),r.export(n,"createOscillator",(()=>C)),r.export(n,"setShape",(()=>k)),r.export(n,"setFrequency",(()=>O)),r.export(n,"getVolume",(()=>R)),r.export(n,"setVolume",(()=>L)),r.export(n,"loadAudio",(()=>D)),r.export(n,"playTrack",(()=>P)),r.export(n,"loadInstrumentParts",(()=>j)),r.export(n,"loadInstrumentPack",(()=>B));e("../maths/maths");var a=e("./instruments"),s=e("./rack"),o=e("./effects/reverb"),i=(e("./effects/delay"),e("./effects/dub"),e("./effects/compressor")),l=e("./effects/distortion"),c=e("./effects/amplitude"),u=e("./notes");let d,h,p,m,f,g,v,y=!1,b=!1;const E=()=>a.INSTRUMENT_FOLDERS[Math.floor(Math.random()*a.INSTRUMENT_FOLDERS.length)],w=async e=>s.chain([v,await i.createCompressor(d),await l.createDistortion(d)],d),I={reverb:.1,normalise:!0,smoothingTimeConstant:.45},x=async e=>{const t=e||await o.randomReverb();return g.impulseFilter(t)},S=async e=>{const t=Object.assign({},I,e);return d=new(window.AudioContext||window.webkitAudioContext),v=await c.createAmplitude(d,1),g=await o.createReverb(d,t.reverb,t.normalise),f=d.createAnalyser(),f.minDecibels=-90,f.maxDecibels=-10,f.smoothingTimeConstant=t.smoothingTimeConstant,h=f.frequencyBinCount,p=new Uint8Array(h),s.chain([v,g,f],d)},N=()=>{f.fftSize=2048,f.getByteFrequencyData(p),h=f.frequencyBinCount},_=()=>{f.fftSize=256,f.getByteTimeDomainData(p),h=f.frequencyBinCount},T=()=>{const e=requestAnimationFrame(T);return f.getByteFrequencyData(p),e},M=()=>!!y&&(y=!1,!0),A=()=>!y&&("suspended"===d.state&&d.resume(),y=!0,T(),!0),C=()=>{},k=e=>{m.type=e},O=e=>{m.frequency.value=e},R=()=>v.volume(),L=e=>v.volume(e),D=async e=>{const t=await fetch(e),n=await t.arrayBuffer();return await d.decodeAudioData(n)},P=(e,t=0,n=delayNode,r={loop:!1})=>new Promise(((a,s)=>{const o=d.createBufferSource();o.buffer=e,o.loop=r.loop,o.connect(n),o.onended=()=>{o.disconnect(),b=!1,a()},o.onerror=e=>{o.disconnect(),b=!1,s(e)},"suspended"===d.state&&d.resume(),0==t?o.start():o.start(0,d.currentTime-t),b=!0}));const j=(e="alto_sax-mp3",t="FluidR3_GM")=>{const n=`${t}/${e}`;return u.createInstrumentBanks().map((e=>D(`./assets/audio/${n}/${e}`)))},B=async(e="alto_sax-mp3",t="FluidR3_GM",n)=>{const r={title:a.cleanTitle(e),name:e},s=await Promise.all(j(e,t));return u.NOTE_NAMES.forEach(((e,t)=>{r[e.split(".")[0]]=s[t]})),r}},{"../maths/maths":"iDBHd","./instruments":"ftlvJ","./rack":"bgac0","./effects/reverb":"7szM4","./effects/delay":"dwS9E","./effects/dub":"d9jC2","./effects/compressor":"2ANWD","./effects/distortion":"fknul","./effects/amplitude":"drp0R","./notes":"5HewV","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],iDBHd:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"TAU",(()=>a)),r.export(n,"HALF_PI",(()=>s)),r.export(n,"rescale",(()=>u)),r.export(n,"determineAngle",(()=>d)),r.export(n,"distanceBetween2Points",(()=>h)),r.export(n,"distanceBetween3Points",(()=>p)),r.export(n,"distance3D",(()=>m)),r.export(n,"distance2D",(()=>f)),r.export(n,"lerp",(()=>g)),r.export(n,"clamp",(()=>v)),r.export(n,"twist",(()=>y));const a=2*Math.PI,s=.5*Math.PI,{PI:o,sqrt:i,atan2:l,tan:c}=Math,u=(e,t=1)=>{const n=1/(t-e);return t=>n*(t-e)},d=(e,t)=>{const n=e[1]-t[1],r=t[0]-e[0];return l(n,r)},h=(e,t)=>i((e[0]-t[0])**2+(e[1]-t[1])**2),p=(e,t)=>i((e[0]-t[0])**2+(e[1]-t[1])**2+(e[2]-t[2])**2),m=(e,t,n,r,a,s)=>i((e-t)**2+(n-r)**2+(a-s)**2),f=(e,t,n,r)=>i((e-t)**2+(n-r)**2),g=(e,t,n)=>(1-n)*e+n*t,v=(e,t,n)=>e>n?n:e<t?t:e,y=(e,t=0)=>v((e=e<0?-1*(e+1):1-e)+t,-1,1)},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],ftlvJ:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"MUSICAL_NOTES",(()=>a)),r.export(n,"INSTRUMENT_PACK_FM",(()=>s)),r.export(n,"INSTRUMENT_PACK_FATBOY",(()=>o)),r.export(n,"INSTRUMENT_PACK_MUSYNGKITE",(()=>i)),r.export(n,"INSTRUMENT_PACKS",(()=>l)),r.export(n,"INSTRUMENT_FOLDERS",(()=>c)),r.export(n,"cleanTitle",(()=>u)),r.export(n,"INSTRUMENT_NAMES",(()=>d)),r.export(n,"instrumentCache",(()=>h)),r.export(n,"fetchInstrument",(()=>p)),r.export(n,"storeInstrument",(()=>m));const a=["♫","𝅗𝅥","𝅘𝅥","𝅘𝅥𝅮","𝅘𝅥𝅯","𝅘𝅥𝅰","𝅘𝅥𝅱","𝅘𝅥𝅲"],s="FluidR3_GM",o="FatBoy",i="MusyngKite",l=[s,o],c=["accordion-mp3","acoustic_bass-mp3","acoustic_grand_piano-mp3","acoustic_guitar_nylon-mp3","acoustic_guitar_steel-mp3","agogo-mp3","alto_sax-mp3","applause-mp3","bagpipe-mp3","banjo-mp3","baritone_sax-mp3","bassoon-mp3","bird_tweet-mp3","blown_bottle-mp3","brass_section-mp3","breath_noise-mp3","bright_acoustic_piano-mp3","celesta-mp3","cello-mp3","choir_aahs-mp3","church_organ-mp3","clarinet-mp3","clavinet-mp3","contrabass-mp3","distortion_guitar-mp3","drawbar_organ-mp3","dulcimer-mp3","electric_bass_finger-mp3","electric_bass_pick-mp3","electric_grand_piano-mp3","electric_guitar_clean-mp3","electric_guitar_jazz-mp3","electric_guitar_muted-mp3","electric_piano_1-mp3","electric_piano_2-mp3","english_horn-mp3","fiddle-mp3","flute-mp3","french_horn-mp3","fretless_bass-mp3","fx_1_rain-mp3","fx_2_soundtrack-mp3","fx_3_crystal-mp3","fx_4_atmosphere-mp3","fx_5_brightness-mp3","fx_6_goblins-mp3","fx_7_echoes-mp3","fx_8_scifi-mp3","glockenspiel-mp3","guitar_fret_noise-mp3","guitar_harmonics-mp3","gunshot-mp3","harmonica-mp3","harpsichord-mp3","helicopter-mp3","honkytonk_piano-mp3","kalimba-mp3","koto-mp3","lead_1_square-mp3","lead_2_sawtooth-mp3","lead_3_calliope-mp3","lead_4_chiff-mp3","lead_5_charang-mp3","lead_6_voice-mp3","lead_7_fifths-mp3","lead_8_bass__lead-mp3","marimba-mp3","melodic_tom-mp3","music_box-mp3","muted_trumpet-mp3","oboe-mp3","ocarina-mp3","orchestra_hit-mp3","orchestral_harp-mp3","overdriven_guitar-mp3","pad_1_new_age-mp3","pad_2_warm-mp3","pad_3_polysynth-mp3","pad_4_choir-mp3","pad_5_bowed-mp3","pad_6_metallic-mp3","pad_7_halo-mp3","pad_8_sweep-mp3","pan_flute-mp3","percussive_organ-mp3","piccolo-mp3","pizzicato_strings-mp3","recorder-mp3","reed_organ-mp3","reverse_cymbal-mp3","rock_organ-mp3","seashore-mp3","shakuhachi-mp3","shamisen-mp3","shanai-mp3","sitar-mp3","slap_bass_1-mp3","slap_bass_2-mp3","soprano_sax-mp3","steel_drums-mp3","string_ensemble_1-mp3","string_ensemble_2-mp3","synth_bass_1-mp3","synth_bass_2-mp3","synth_brass_1-mp3","synth_brass_2-mp3","synth_choir-mp3","synth_drum-mp3","synth_strings_1-mp3","synth_strings_2-mp3","taiko_drum-mp3","tango_accordion-mp3","telephone_ring-mp3","tenor_sax-mp3","timpani-mp3","tinkle_bell-mp3","tremolo_strings-mp3","trombone-mp3","trumpet-mp3","tuba-mp3","tubular_bells-mp3","vibraphone-mp3","viola-mp3","violin-mp3","voice_oohs-mp3","whistle-mp3","woodblock-mp3","xylophone-mp3"],u=e=>e&&e.length>1?e.replaceAll("_"," ").replace("-mp3",""):"",d=c.map((e=>u(e))),h={},p=e=>h[e],m=(e,t)=>{h[e]=t}},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],bgac0:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"inputNode",(()=>l)),r.export(n,"inputDryNode",(()=>c)),r.export(n,"resolveRoute",(()=>u)),r.export(n,"chain",(()=>d)),r.export(n,"removeLink",(()=>h)),r.export(n,"unchain",(()=>p));let a=null,s=null,o=null,i=null;const l=()=>a.name?a.node:a,c=()=>s,u=e=>e.name?e.node:e,d=(e,t=null)=>{p();const n=e.length;if(n>1)for(let t=1;t<n;++t){const r=u(e[t-1]),o=u(e[t]);r.connect(o),1===t&&(a=r),t===n-1&&(s=o)}else a=s=u(e[0]);return t&&s.connect(t.destination),o=e,i=t,a},h=e=>{},p=()=>{if(o&&i){const e=o.length;if(e>1)for(let t=1;t<e;++t){const e=u(routes[t-1]),n=u(routes[t]);e.disconnect(n)}s.disconnect(audioContext.destination)}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"7szM4":[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"DIRS",(()=>s)),r.export(n,"REVERB_PATHS",(()=>c)),r.export(n,"loadImpulseJSON",(()=>d)),r.export(n,"loadImpulseList",(()=>h)),r.export(n,"getImpulseList",(()=>p)),r.export(n,"randomReverb",(()=>m)),r.export(n,"createReverb",(()=>f));var a=e("./effect");const s=["EMT140-Plate","Voxengo"],o="sampled.instrument.json";let i;const l="./assets/audio/acoustics/",c=s.map((e=>`${l}${e}/${o}`)),u={},d=async e=>{if(u[e])return u[e];const t=await fetch(`${l}${e}/${o}`),n=await t.json();return u[e]=n.files.map((t=>`${l}${e}/${t}`)),u[e]},h=async(e=s)=>{const t=e.map((async e=>{const t=await d(e,e);return console.error(t,e),t})),n=[].concat(...t);return console.error(e,t,n),n},p=async()=>{if(i)return i;try{return i=await h(),i}catch(e){console.error({impulses:i})}},m=async()=>{try{const e=await p();return e[Math.ceil((e.length-1)*Math.random())]}catch(e){throw Error("Random reverb failed to fetch list"+e)}},f=async(e,t=.4,n=!0,r="./assets/audio/acoustics/ir-hall.mp3")=>{const s=async t=>{const n=await fetch(t),r=await n.arrayBuffer();return await e.decodeAudioData(r)},o=new DynamicsCompressorNode(e),i=new GainNode(e,{gain:t}),l=e.createConvolver();return l.buffer=await s(r),l.normalize=n,o.connect(e.destination),o.connect(l),l.connect(i).connect(e.destination),{name:"reverb",node:l,impulseFilter:async e=>(l.buffer=await s(e),l.normalize=n,e),gain:e=>a.changeParameter(i,"gain",e)}}},{"./effect":"h3z6p","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],h3z6p:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"changeParameter",(()=>a));const a=(e,t,n)=>(n&&(e[t]=n),n??e[t])},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],dwS9E:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"createDelay",(()=>s));var a=e("./effect");const s=async(e,t=.05,n=.4)=>{const r=e.createDelay(t),s=e.createGain(n);return s.gain.value=n,s.connect(r),r.connect(e.destination),{name:"delay",node:s,feedback:e=>a.changeParameter(s,"gain",e),delayTime:e=>a.changeParameter(r,"delayTime",e)}}},{"./effect":"h3z6p","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],d9jC2:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"createDub",(()=>s));var a=e("./effect");const s=async(e,t=.5,n=.4,r=1e3,s=2.5)=>{const o=e.createDelay(s);o.delayTime.value=t;const i=e.createGain();i.gain.value=n;const l=e.createBiquadFilter();return l.frequency.value=r,o.connect(i),i.connect(l),l.connect(o),{name:"dub",node:o,delayTime:e=>a.changeParameter(o,"delayTime",e),feedback:e=>a.changeParameter(i,"gain",e),filter:e=>a.changeParameter(l,"frequency",e)}}},{"./effect":"h3z6p","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"2ANWD":[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"createCompressor",(()=>s));var a=e("./effect");const s=async(e,t=-70,n=40,r=5,s=0,o=.5,i=0)=>{const l=e.createDynamicsCompressor();return l.threshold.value=t,l.knee.value=n,l.ratio.value=r,l.attack.value=s,l.release.value=o,{name:"compressor",node:l,knee:e=>a.changeParameter(l,"knee",e),threshold:e=>a.changeParameter(l,"threshold",e),ratio:e=>a.changeParameter(l,"ratio",e),attack:e=>a.changeParameter(l,"attack",e),release:e=>a.changeParameter(l,"release",e)}}},{"./effect":"h3z6p","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],fknul:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"createDistortion",(()=>s));e("./effect");function a(e){for(var t,n="number"==typeof e?e:50,r=44100,a=new Float32Array(r),s=Math.PI/180,o=0;o<r;++o)t=2*o/r-1,a[o]=(3+n)*t*20*s/(Math.PI+n*Math.abs(t));return a}const s=async(e,t=1,n="4x")=>{const r=e.createWaveShaper();return r.oversample=n,r.curve=a(t),{name:"distortion",node:r,curve:e=>r.curve=a(e),oversample:e=>r.oversample=e}}},{"./effect":"h3z6p","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],drp0R:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"createAmplitude",(()=>s));var a=e("../../maths/maths");const s=async(e,t=1,n=!1)=>{const r=e.createGain(),s=t=>{const n=r.gain.value,a=n+.1*(t-n);return r.gain.value.setValueAtTime(t,e.currentTime),n===t||requestAnimationFrame(s),a},o=e=>{n?s():r.gain.value=a.clamp(t,0,1)};return o(),{name:"amplitude",node:r,volume:e=>e?(o(),e):r.gain.value}}},{"../../maths/maths":"iDBHd","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"5HewV":[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"BANKS",(()=>s)),r.export(n,"NOTES_BLACK",(()=>o)),r.export(n,"NOTES_WHITE",(()=>i)),r.export(n,"NOTES_BLACK_INDEXES",(()=>l)),r.export(n,"NOTES_WHITE_INDEXES",(()=>c)),r.export(n,"SOLFEGE_SCALE",(()=>u)),r.export(n,"createInstrumentBanks",(()=>d)),r.export(n,"NOTE_NAMES",(()=>h)),r.export(n,"NOTE_NAMES_FRIENDLY",(()=>p)),r.export(n,"getNoteSound",(()=>m)),r.export(n,"getNoteText",(()=>f)),r.export(n,"getNoteName",(()=>g));var a=e("../maths/maths");const s=["A","Ab","B","Bb","C","D","Db","E","Eb","F","G","Gb"],o=["Ab","Bb","Db","Eb","Gb"],i=["A","B","C","D","E","F","G"],l=o.length-1,c=i.length-1,u=["Doe","Ray","Me","Far","Sew","La","Tea"],d=(e="mp3",t=".")=>{const n=[];for(let r=0;r<s.length;++r){const a=s[r];"A"===a&&n.push(`A0${t}${e}`);for(let r=1;r<8;++r)n.push(`${a}${r}${t}${e}`);"C"===a&&n.push(`C8${t}${e}`)}return n},h=d("",""),p={};h.forEach((e=>{p[e]=e}));const m=(e,t=!1)=>u[Math.floor(e*(u.length-1))],f=e=>{const t=e.charAt(0);let n;return 3===e.length?(n=parseInt(e.charAt(2))+1,`${t}#${n}`):(n=parseInt(e.charAt(1))+1,`${t}${n}`)},g=(e,t=3,n=!1)=>{let r,s;return n?(r=Math.floor(e*l),s=o[r]):(r=Math.floor(e*c),s=i[r]),`${s}${a.clamp(t,1,7)}`}},{"../maths/maths":"iDBHd","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],aonYx:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"createQueue",(()=>i)),r.export(n,"createKick",(()=>l)),r.export(n,"createSnare",(()=>c)),r.export(n,"createHihat",(()=>u)),r.export(n,"createClack",(()=>d)),r.export(n,"createCowbell",(()=>h)),r.export(n,"createKicks",(()=>p)),r.export(n,"createSnares",(()=>m)),r.export(n,"createHihats",(()=>f)),r.export(n,"createCowbells",(()=>g)),r.export(n,"createClacks",(()=>v)),r.export(n,"createDrumkit",(()=>y));var a=e("./audio"),s=e("./rack");const o=1e-7,i=(e,t=5)=>{const n=[];for(let r=0;r<t;++r){const t=e();n.push(t)}let r=0;return(...e)=>{r=r+1<t?r+1:0;(0,n[r])(...e)}},l=()=>{const e=a.audioContext.createOscillator(),t=a.audioContext.createOscillator(),n=a.audioContext.createGain(),r=a.audioContext.createGain();e.type="triangle",t.type="sine";return e.connect(n),t.connect(r),n.connect(s.inputDryNode()),r.connect(s.inputDryNode()),(s=1,i=.05,l=.01,c=.5)=>{const u=a.audioContext.currentTime;n.gain.cancelScheduledValues(u),r.gain.cancelScheduledValues(u),e.frequency.cancelScheduledValues(u),t.frequency.cancelScheduledValues(u),n.gain.setValueAtTime(1,u),n.gain.exponentialRampToValueAtTime(o,u+i),r.gain.setValueAtTime(1,a.audioContext.currentTime),r.gain.exponentialRampToValueAtTime(o,u+i),e.frequency.setValueAtTime(90,a.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(l,u+i),t.frequency.setValueAtTime(50,a.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(l,u+i);try{e.start(u),t.start(u)}catch(e){}}},c=()=>{const e=a.audioContext.createOscillator(),t=a.audioContext.createGain(),n=a.audioContext.createGain(),r=a.audioContext.createBufferSource(),i=a.audioContext.createBuffer(1,4096,a.audioContext.sampleRate),l=a.audioContext.createBiquadFilter();l.type="highpass",e.type="triangle",e.frequency.value=100;const c=i.getChannelData(0);for(var u=0;u<4096;u++)c[u]=Math.random();r.buffer=i,r.loop=!0,e.connect(t),t.connect(s.inputDryNode()),r.connect(l),l.connect(n),n.connect(s.inputDryNode());return(s=1,i=.2)=>{const c=a.audioContext.currentTime;n.gain.cancelScheduledValues(c),n.gain.setValueAtTime(1,c),n.gain.exponentialRampToValueAtTime(o,c+i),t.gain.cancelScheduledValues(c),t.gain.setValueAtTime(o,c),t.gain.exponentialRampToValueAtTime(o,c+i/2),l.frequency.cancelScheduledValues(c),l.frequency.setValueAtTime(100,c),l.frequency.linearRampToValueAtTime(1e3,c+i);try{e.start(c),r.start(c)}catch(e){}}},u=()=>{const e=a.audioContext.createGain(),t=a.audioContext.createBiquadFilter();t.type="bandpass",t.frequency.value=1e4;const n=a.audioContext.createBiquadFilter();n.type="highpass",n.frequency.value=7e3;const r=[2,3,4.16,5.43,6.79,8.21].map((e=>{const n=a.audioContext.createOscillator();return n.type="square",n.frequency.value=40*e,n.connect(t),n}));t.connect(n),n.connect(e),e.connect(s.inputDryNode());return(t=1,n=.05)=>{const s=a.audioContext.currentTime;e.gain.cancelScheduledValues(s),r.forEach((e=>e.frequency.cancelScheduledValues(s))),e.gain.setValueAtTime(1,s),e.gain.exponentialRampToValueAtTime(o,s+n);try{r.forEach((e=>e.start(s)))}catch(e){}}},d=()=>{const e=a.audioContext.createGain(),t=a.audioContext.createBiquadFilter();t.type="bandpass",t.frequency.value=2640,t.Q.value=3.5;const n=a.audioContext.createBiquadFilter();n.type="highpass",n.frequency.value=7e3;const r=[587,845],i=r.map((e=>{const n=a.audioContext.createOscillator();return n.type="triangle",n.frequency.value=1*e,n.connect(t),n}));t.connect(n),n.connect(e),e.connect(s.inputDryNode());return(t=1,n=.05,s=1)=>{const l=a.audioContext.currentTime;e.gain.cancelScheduledValues(l),i.forEach(((e,t)=>{e.frequency.cancelScheduledValues(l),e.frequency.value=s*r[t]})),e.gain.setValueAtTime(1,l),e.gain.exponentialRampToValueAtTime(o,l+n);try{i.forEach((e=>e.start(l)))}catch(e){}}},h=()=>{const e=a.audioContext.createGain(),t=a.audioContext.createBiquadFilter();t.type="bandpass",t.frequency.value=2640,t.Q.value=3.5;const n=[587,845].map((e=>{const n=a.audioContext.createOscillator();return n.type="triangle",n.frequency.value=1*e,n.connect(t),n}));t.connect(e),e.connect(s.inputDryNode());return(t=1,r=.05)=>{const s=a.audioContext.currentTime;e.gain.cancelScheduledValues(s),n.forEach((e=>e.frequency.cancelScheduledValues(s))),e.gain.setValueAtTime(1,s),e.gain.exponentialRampToValueAtTime(o,s+r);try{n.forEach((e=>e.start(s)))}catch(e){}}},p=(e=2)=>i(l,e),m=(e=3)=>i(c,e),f=(e=3)=>i(u,e),g=(e=2)=>i(h,e),v=(e=2)=>i(d,e),y=()=>{const e=p(),t=f();return{kick:e,snare:m(),hat:t,cowbell:h(),clack:d()}}},{"./audio":"kGLQw","./rack":"bgac0","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],ce9G1:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"testForMIDI",(()=>s)),r.export(n,"setupMIDI",(()=>o));var a=e("webmidi");const s=()=>void 0!==navigator.requestMIDIAccess,o=(e,t)=>new Promise(((n,r)=>{a.WebMidi.enable().then((r=>{a.WebMidi.addListener("connected",(function(t){e&&e(t)})),a.WebMidi.addListener("disconnected",(function(e){t&&t()})),n(a.WebMidi)})).catch((e=>r(e)))}))},{webmidi:"hhSo0","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],hhSo0:[function(require,module,exports){"use strict";var global=arguments[3];Object.defineProperty(exports,"__esModule",{value:!0});class EventEmitter{constructor(e=!1){this.eventMap={},this.eventsSuspended=1==e}addListener(e,t,n={}){if("string"==typeof e&&e.length<1||e instanceof String&&e.length<1||"string"!=typeof e&&!(e instanceof String)&&e!==EventEmitter.ANY_EVENT)throw new TypeError("The 'event' parameter must be a string or EventEmitter.ANY_EVENT.");if("function"!=typeof t)throw new TypeError("The callback must be a function.");const r=new Listener(e,this,t,n);return this.eventMap[e]||(this.eventMap[e]=[]),n.prepend?this.eventMap[e].unshift(r):this.eventMap[e].push(r),r}addOneTimeListener(e,t,n={}){n.remaining=1,this.addListener(e,t,n)}static get ANY_EVENT(){return Symbol.for("Any event")}hasListener(e,t){return void 0===e?!!(this.eventMap[EventEmitter.ANY_EVENT]&&this.eventMap[EventEmitter.ANY_EVENT].length>0)||Object.entries(this.eventMap).some((([,e])=>e.length>0)):!!(this.eventMap[e]&&this.eventMap[e].length>0)&&(t instanceof Listener?this.eventMap[e].filter((e=>e===t)).length>0:"function"==typeof t?this.eventMap[e].filter((e=>e.callback===t)).length>0:null==t)}get eventNames(){return Object.keys(this.eventMap)}getListeners(e){return this.eventMap[e]||[]}suspendEvent(e){this.getListeners(e).forEach((e=>{e.suspended=!0}))}unsuspendEvent(e){this.getListeners(e).forEach((e=>{e.suspended=!1}))}getListenerCount(e){return this.getListeners(e).length}emit(e,...t){if("string"!=typeof e&&!(e instanceof String))throw new TypeError("The 'event' parameter must be a string.");if(this.eventsSuspended)return;let n=[],r=this.eventMap[EventEmitter.ANY_EVENT]||[];return this.eventMap[e]&&(r=r.concat(this.eventMap[e])),r.forEach((e=>{if(e.suspended)return;let r=[...t];Array.isArray(e.arguments)&&(r=r.concat(e.arguments)),e.remaining>0&&(n.push(e.callback.apply(e.context,r)),e.count++),--e.remaining<1&&e.remove()})),n}removeListener(e,t,n={}){if(void 0===e)return void(this.eventMap={});if(!this.eventMap[e])return;let r=this.eventMap[e].filter((e=>t&&e.callback!==t||n.remaining&&n.remaining!==e.remaining||n.context&&n.context!==e.context));r.length?this.eventMap[e]=r:delete this.eventMap[e]}async waitFor(e,t={}){return t.duration=parseInt(t.duration),(isNaN(t.duration)||t.duration<=0)&&(t.duration=1/0),new Promise(((n,r)=>{let a,s=this.addListener(e,(()=>{clearTimeout(a),n()}),{remaining:1});t.duration!==1/0&&(a=setTimeout((()=>{s.remove(),r("The duration expired before the event was emitted.")}),t.duration))}))}get eventCount(){return Object.keys(this.eventMap).length}}class Listener{constructor(e,t,n,r={}){if("string"!=typeof e&&!(e instanceof String)&&e!==EventEmitter.ANY_EVENT)throw new TypeError("The 'event' parameter must be a string or EventEmitter.ANY_EVENT.");if(!t)throw new ReferenceError("The 'target' parameter is mandatory.");if("function"!=typeof n)throw new TypeError("The 'callback' must be a function.");void 0===r.arguments||Array.isArray(r.arguments)||(r.arguments=[r.arguments]),(r=Object.assign({context:t,remaining:1/0,arguments:void 0,duration:1/0},r)).duration!==1/0&&setTimeout((()=>this.remove()),r.duration),this.arguments=r.arguments,this.callback=n,this.context=r.context,this.count=0,this.event=e,this.remaining=parseInt(r.remaining)>=1?parseInt(r.remaining):1/0,this.suspended=!1,this.target=t}remove(){this.target.removeListener(this.event,this.callback,{context:this.context,remaining:this.remaining})}}
/**
 * The `Enumerations` class contains enumerations and arrays of elements used throughout the
 * library. All properties are static and should be referenced using the class name. For example:
 * `Enumerations.MIDI_CHANNEL_MESSAGES`.
 *
 * @license Apache-2.0
 * @since 3.0.0
 */class Enumerations{static get MIDI_CHANNEL_MESSAGES(){return{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,programchange:12,channelaftertouch:13,pitchbend:14}}static get MIDI_CHANNEL_NUMBERS(){return[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]}static get MIDI_CHANNEL_MODE_MESSAGES(){return{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127}}static get MIDI_CONTROL_CHANGE_MESSAGES(){return{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,controller3:3,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,controller9:9,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,controller14:14,controller15:15,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,controller20:20,controller21:21,controller22:22,controller23:23,controller24:24,controller25:25,controller26:26,controller27:27,controller28:28,controller29:29,controller30:30,controller31:31,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,controller35:35,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,controller41:41,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,controller46:46,controller47:47,controller48:48,controller49:49,controller50:50,controller51:51,controller52:52,controller53:53,controller54:54,controller55:55,controller56:56,controller57:57,controller58:58,controller59:59,controller60:60,controller61:61,controller62:62,controller63:63,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,controller84:84,controller85:85,controller86:86,controller87:87,controller88:88,controller89:89,controller90:90,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101,controller102:102,controller103:103,controller104:104,controller105:105,controller106:106,controller107:107,controller108:108,controller109:109,controller110:110,controller111:111,controller112:112,controller113:113,controller114:114,controller115:115,controller116:116,controller117:117,controller118:118,controller119:119,allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127}}static get MIDI_REGISTERED_PARAMETERS(){return{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]}}static get MIDI_SYSTEM_MESSAGES(){return{sysex:240,timecode:241,songposition:242,songselect:243,tunerequest:246,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1}}static get CHANNEL_EVENTS(){return["noteoff","controlchange","noteon","keyaftertouch","programchange","channelaftertouch","pitchbend","allnotesoff","allsoundoff","localcontrol","monomode","omnimode","resetallcontrollers","nrpn","nrpn-dataentrycoarse","nrpn-dataentryfine","nrpn-databuttonincrement","nrpn-databuttondecrement","rpn","rpn-dataentrycoarse","rpn-dataentryfine","rpn-databuttonincrement","rpn-databuttondecrement"]}}
/**
 * The `Note` class represents a single musical note such as `"D3"`, `"G#4"`, `"F-1"`, `"Gb7"`, etc.
 *
 * `Note` objects can be played back on a single channel by calling
 * [`OutputChannel.playNote()`]{@link OutputChannel#playNote} or, on multiple channels of the same
 * output, by calling [`Output.playNote()`]{@link Output#playNote}.
 *
 * The note has [`attack`](#attack) and [`release`](#release) velocities set at `0.5` by default.
 * These can be changed by passing in the appropriate option. It is also possible to set a
 * system-wide default for attack and release velocities by using the
 * [`WebMidi.defaults`](WebMidi#defaults) property.
 *
 * If you prefer to work with raw MIDI values (`0` to `127`), you can use [`rawAttack`](#rawAttack) and
 * [`rawRelease`](#rawRelease) to both get and set the values.
 *
 * The note may have a [`duration`](#duration). If it does, playback will be automatically stopped
 * when the duration has elapsed by sending a `"noteoff"` event. By default, the duration is set to
 * `Infinity`. In this case, it will never stop playing unless explicitly stopped by calling a
 * method such as [`OutputChannel.stopNote()`]{@link OutputChannel#stopNote},
 * [`Output.stopNote()`]{@link Output#stopNote} or similar.
 *
 * @license Apache-2.0
 * @since 3.0.0
 */class Note{constructor(e,t={}){this.duration=wm.defaults.note.duration,this.attack=wm.defaults.note.attack,this.release=wm.defaults.note.release,null!=t.duration&&(this.duration=t.duration),null!=t.attack&&(this.attack=t.attack),null!=t.rawAttack&&(this.attack=Utilities.from7bitToFloat(t.rawAttack)),null!=t.release&&(this.release=t.release),null!=t.rawRelease&&(this.release=Utilities.from7bitToFloat(t.rawRelease)),Number.isInteger(e)?this.identifier=Utilities.toNoteIdentifier(e):this.identifier=e}get identifier(){return this._name+(this._accidental||"")+this._octave}set identifier(e){const t=Utilities.getNoteDetails(e);if(wm.validation&&!e)throw new Error("Invalid note identifier");this._name=t.name,this._accidental=t.accidental,this._octave=t.octave}get name(){return this._name}set name(e){if(wm.validation&&(e=e.toUpperCase(),!["C","D","E","F","G","A","B"].includes(e)))throw new Error("Invalid name value");this._name=e}get accidental(){return this._accidental}set accidental(e){if(wm.validation&&(e=e.toLowerCase(),!["#","##","b","bb"].includes(e)))throw new Error("Invalid accidental value");this._accidental=e}get octave(){return this._octave}set octave(e){if(wm.validation&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid octave value");this._octave=e}get duration(){return this._duration}set duration(e){if(wm.validation&&(e=parseFloat(e),isNaN(e)||null===e||e<0))throw new RangeError("Invalid duration value.");this._duration=e}get attack(){return this._attack}set attack(e){if(wm.validation&&(e=parseFloat(e),isNaN(e)||!(e>=0&&e<=1)))throw new RangeError("Invalid attack value.");this._attack=e}get release(){return this._release}set release(e){if(wm.validation&&(e=parseFloat(e),isNaN(e)||!(e>=0&&e<=1)))throw new RangeError("Invalid release value.");this._release=e}get rawAttack(){return Utilities.fromFloatTo7Bit(this._attack)}set rawAttack(e){this._attack=Utilities.from7bitToFloat(e)}get rawRelease(){return Utilities.fromFloatTo7Bit(this._release)}set rawRelease(e){this._release=Utilities.from7bitToFloat(e)}get number(){return Utilities.toNoteNumber(this.identifier)}getOffsetNumber(e=0,t=0){return wm.validation&&(e=parseInt(e)||0,t=parseInt(t)||0),Math.min(Math.max(this.number+12*e+t,0),127)}}
/**
 * The `Utilities` class contains general-purpose utility methods. All methods are static and
 * should be called using the class name. For example: `Utilities.getNoteDetails("C4")`.
 *
 * @license Apache-2.0
 * @since 3.0.0
 */class Utilities{
/**
   * Returns a MIDI note number matching the identifier passed in the form of a string. The
   * identifier must include the octave number. The identifier also optionally include a sharp (#),
   * a double sharp (##), a flat (b) or a double flat (bb) symbol. For example, these are all valid
   * identifiers: C5, G4, D#-1, F0, Gb7, Eb-1, Abb4, B##6, etc.
   *
   * When converting note identifiers to numbers, C4 is considered to be middle C (MIDI note number
   * 60) as per the scientific pitch notation standard.
   *
   * The resulting note number can be offset by using the `octaveOffset` parameter.
   *
   * @param identifier {string} The identifier in the form of a letter, followed by an optional "#",
   * "##", "b" or "bb" followed by the octave number. For exemple: C5, G4, D#-1, F0, Gb7, Eb-1,
   * Abb4, B##6, etc.
   *
   * @param {number} [octaveOffset=0] A integer to offset the octave by.
   *
   * @returns {number} The MIDI note number (an integer between 0 and 127).
   *
   * @throws RangeError Invalid 'octaveOffset' value
   *
   * @throws TypeError Invalid note identifier
   *
   * @license Apache-2.0
   * @since 3.0.0
   * @static
   */
static toNoteNumber(e,t=0){if(t=null==t?0:parseInt(t),isNaN(t))throw new RangeError("Invalid 'octaveOffset' value");"string"!=typeof e&&(e="");const n=this.getNoteDetails(e);if(!n)throw new TypeError("Invalid note identifier");let r=12*(n.octave+1+t);if(r+={C:0,D:2,E:4,F:5,G:7,A:9,B:11}[n.name],n.accidental&&(n.accidental.startsWith("b")?r-=n.accidental.length:r+=n.accidental.length),r<0||r>127)throw new RangeError("Invalid octaveOffset value");return r}static getNoteDetails(e){Number.isInteger(e)&&(e=this.toNoteIdentifier(e));const t=e.match(/^([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)$/i);if(!t)throw new TypeError("Invalid note identifier");const n=t[1].toUpperCase(),r=parseInt(t[3]);let a=t[2].toLowerCase();return a=""===a?void 0:a,{accidental:a,identifier:n+(a||"")+r,name:n,octave:r}}static sanitizeChannels(e){let t;if(this.validation)if("all"===e)t=["all"];else if("none"===e)return[];return t=Array.isArray(e)?e:[e],t.indexOf("all")>-1&&(t=Enumerations.MIDI_CHANNEL_NUMBERS),t.map((function(e){return parseInt(e)})).filter((function(e){return e>=1&&e<=16}))}static toTimestamp(e){let t=!1;const n=parseFloat(e);return!isNaN(n)&&("string"==typeof e&&"+"===e.substring(0,1)?n>=0&&(t=wm.time+n):n>=0&&(t=n),t)}static guessNoteNumber(e,t){t=parseInt(t)||0;let n=!1;if(Number.isInteger(e)&&e>=0&&e<=127)n=parseInt(e);else if(parseInt(e)>=0&&parseInt(e)<=127)n=parseInt(e);else if("string"==typeof e||e instanceof String)try{n=this.toNoteNumber(e.trim(),t)}catch(e){return!1}return n}static toNoteIdentifier(e,t){if(e=parseInt(e),isNaN(e)||e<0||e>127)throw new RangeError("Invalid note number");if(t=null==t?0:parseInt(t),isNaN(t))throw new RangeError("Invalid octaveOffset value");const n=Math.floor(e/12-1)+t;return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][e%12]+n.toString()}static buildNote(e,t={}){if(t.octaveOffset=parseInt(t.octaveOffset)||0,e instanceof Note)return e;let n=this.guessNoteNumber(e,t.octaveOffset);if(!1===n)throw new TypeError(`The input could not be parsed as a note (${e})`);return t.octaveOffset=void 0,new Note(n,t)}static buildNoteArray(e,t={}){let n=[];return Array.isArray(e)||(e=[e]),e.forEach((e=>{n.push(this.buildNote(e,t))})),n}static from7bitToFloat(e){return e===1/0&&(e=127),e=parseInt(e)||0,Math.min(Math.max(e/127,0),1)}static fromFloatTo7Bit(e){return e===1/0&&(e=1),e=parseFloat(e)||0,Math.min(Math.max(Math.round(127*e),0),127)}static fromMsbLsbToFloat(e,t=0){wm.validation&&(e=Math.min(Math.max(parseInt(e)||0,0),127),t=Math.min(Math.max(parseInt(t)||0,0),127));const n=((e<<7)+t)/16383;return Math.min(Math.max(n,0),1)}static fromFloatToMsbLsb(e){wm.validation&&(e=Math.min(Math.max(parseFloat(e)||0,0),1));const t=Math.round(16383*e);return{msb:t>>7,lsb:127&t}}static offsetNumber(e,t=0,n=0){if(wm.validation){if(e=parseInt(e),isNaN(e))throw new Error("Invalid note number");t=parseInt(t)||0,n=parseInt(n)||0}return Math.min(Math.max(e+12*t+n,0),127)}static getPropertyByValue(e,t){return Object.keys(e).find((n=>e[n]===t))}static getCcNameByNumber(e){return Utilities.getPropertyByValue(Enumerations.MIDI_CONTROL_CHANGE_MESSAGES,e)}static getChannelModeByNumber(e){if(!(e>=120&&e<=127))return!1;for(let t in Enumerations.MIDI_CHANNEL_MODE_MESSAGES)if(Enumerations.MIDI_CHANNEL_MODE_MESSAGES.hasOwnProperty(t)&&e===Enumerations.MIDI_CHANNEL_MODE_MESSAGES[t])return t;return!1}static get isNode(){return new Function("try { return this === global; } catch(e) { return false; }")()}static get isBrowser(){return new Function("try { return this === window; } catch(e) { return false; }")()}}
/**
 * The `OutputChannel` class represents a single output MIDI channel. `OutputChannel` objects are
 * provided by an [`Output`](Output) port which, itself, is made available by a device. The
 * `OutputChannel` object is derived from the host's MIDI subsystem and should not be instantiated
 * directly.
 *
 * All 16 `OutputChannel` objects can be found inside the parent output's
 * [`channels`]{@link Output#channels} property.
 *
 * @param {Output} output The [`Output`](Output) this channel belongs to.
 * @param {number} number The MIDI channel number (`1` - `16`).
 *
 * @extends EventEmitter
 * @license Apache-2.0
 * @since 3.0.0
 */class OutputChannel extends EventEmitter{constructor(e,t){super(),this._output=e,this._number=t,this._octaveOffset=0}destroy(){this._output=null,this._number=null,this._octaveOffset=0,this.removeListener()}send(e,t={time:0}){return this.output.send(e,t),this}sendKeyAftertouch(e,t,n={}){if(wm.validation){if(n.useRawValue&&(n.rawValue=n.useRawValue),isNaN(parseFloat(t)))throw new RangeError("Invalid key aftertouch value.");if(n.rawValue){if(!(t>=0&&t<=127&&Number.isInteger(t)))throw new RangeError("Key aftertouch raw value must be an integer between 0 and 127.")}else if(!(t>=0&&t<=1))throw new RangeError("Key aftertouch value must be a float between 0 and 1.")}n.rawValue||(t=Utilities.fromFloatTo7Bit(t));const r=wm.octaveOffset+this.output.octaveOffset+this.octaveOffset;return Array.isArray(e)||(e=[e]),Utilities.buildNoteArray(e).forEach((e=>{this.send([(Enumerations.MIDI_CHANNEL_MESSAGES.keyaftertouch<<4)+(this.number-1),e.getOffsetNumber(r),t],{time:Utilities.toTimestamp(n.time)})})),this
/**
   * Sends a MIDI **control change** message to the channel at the scheduled time. The control
   * change message to send can be specified numerically (`0` to `127`) or by using one of the
   * following common names:
   *
   * | Number | Name                          |
   * |--------|-------------------------------|
   * | 0      |`bankselectcoarse`             |
   * | 1      |`modulationwheelcoarse`        |
   * | 2      |`breathcontrollercoarse`       |
   * | 4      |`footcontrollercoarse`         |
   * | 5      |`portamentotimecoarse`         |
   * | 6      |`dataentrycoarse`              |
   * | 7      |`volumecoarse`                 |
   * | 8      |`balancecoarse`                |
   * | 10     |`pancoarse`                    |
   * | 11     |`expressioncoarse`             |
   * | 12     |`effectcontrol1coarse`         |
   * | 13     |`effectcontrol2coarse`         |
   * | 18     |`generalpurposeslider3`        |
   * | 19     |`generalpurposeslider4`        |
   * | 32     |`bankselectfine`               |
   * | 33     |`modulationwheelfine`          |
   * | 34     |`breathcontrollerfine`         |
   * | 36     |`footcontrollerfine`           |
   * | 37     |`portamentotimefine`           |
   * | 38     |`dataentryfine`                |
   * | 39     |`volumefine`                   |
   * | 40     |`balancefine`                  |
   * | 42     |`panfine`                      |
   * | 43     |`expressionfine`               |
   * | 44     |`effectcontrol1fine`           |
   * | 45     |`effectcontrol2fine`           |
   * | 64     |`holdpedal`                    |
   * | 65     |`portamento`                   |
   * | 66     |`sustenutopedal`               |
   * | 67     |`softpedal`                    |
   * | 68     |`legatopedal`                  |
   * | 69     |`hold2pedal`                   |
   * | 70     |`soundvariation`               |
   * | 71     |`resonance`                    |
   * | 72     |`soundreleasetime`             |
   * | 73     |`soundattacktime`              |
   * | 74     |`brightness`                   |
   * | 75     |`soundcontrol6`                |
   * | 76     |`soundcontrol7`                |
   * | 77     |`soundcontrol8`                |
   * | 78     |`soundcontrol9`                |
   * | 79     |`soundcontrol10`               |
   * | 80     |`generalpurposebutton1`        |
   * | 81     |`generalpurposebutton2`        |
   * | 82     |`generalpurposebutton3`        |
   * | 83     |`generalpurposebutton4`        |
   * | 91     |`reverblevel`                  |
   * | 92     |`tremololevel`                 |
   * | 93     |`choruslevel`                  |
   * | 94     |`celestelevel`                 |
   * | 95     |`phaserlevel`                  |
   * | 96     |`databuttonincrement`          |
   * | 97     |`databuttondecrement`          |
   * | 98     |`nonregisteredparametercoarse` |
   * | 99     |`nonregisteredparameterfine`   |
   * | 100    |`registeredparametercoarse`    |
   * | 101    |`registeredparameterfine`      |
   * | 120    |`allsoundoff`                  |
   * | 121    |`resetallcontrollers`          |
   * | 122    |`localcontrol`                 |
   * | 123    |`allnotesoff`                  |
   * | 124    |`omnimodeoff`                  |
   * | 125    |`omnimodeon`                   |
   * | 126    |`monomodeon`                   |
   * | 127    |`polymodeon`                   |
   *
   * As you can see above, not all control change message have a matching name. This does not mean
   * you cannot use the others. It simply means you will need to use their number
   * (`0` to `127`) instead of their name. While you can still use them, numbers `120` to `127` are
   * usually reserved for *channel mode* messages. See
   * [`sendChannelMode()`]{@link OutputChannel#sendChannelMode} method for more info.
   *
   * To view a detailed list of all available **control change** messages, please consult "Table 3 -
   * Control Change Messages" from the [MIDI Messages](
   * https://www.midi.org/specifications/item/table-3-control-change-messages-data-bytes-2)
   * specification.
   *
   * **Note**: messages #0-31 (MSB) are paired with messages #32-63 (LSB). For example, message #1
   * (`modulationwheelcoarse`) can be accompanied by a second control change message for
   * `modulationwheelfine` to achieve a greater level of precision. if you want to specify both MSB
   * and LSB for messages between `0` and `31`, you can do so by passing a 2-value array as the
   * second parameter.
   *
   * @param {number|string} controller The MIDI controller name or number (`0` - `127`).
   *
   * @param {number|number[]} value The value to send (0-127). You can also use a two-position array
   * for controllers 0 to 31. In this scenario, the first value will be sent as usual and the second
   * value will be sent to the matching LSB controller (which is obtained by adding 32 to the first
   * controller)
   *
   * @param {object} [options={}]
   *
   * @param {number|string} [options.time=(now)] If `time` is a string prefixed with `"+"` and
   * followed by a number, the message will be delayed by that many milliseconds. If the value is a
   * positive number
   * ([`DOMHighResTimeStamp`]{@link https://developer.mozilla.org/docs/Web/API/DOMHighResTimeStamp}),
   * the operation will be scheduled for that time. The current time can be retrieved with
   * [`WebMidi.time`]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the
   * operation will be carried out as soon as possible.
   *
   * @throws {RangeError} Controller numbers must be between 0 and 127.
   * @throws {RangeError} Invalid controller name.
   * @throws {TypeError} The value array must have a length of 2.
   *
   * @returns {OutputChannel} Returns the `OutputChannel` object so methods can be chained.
   *
   * @license Apache-2.0
   * @since 3.0.0
   */}sendControlChange(e,t,n={}){if("string"==typeof e&&(e=Enumerations.MIDI_CONTROL_CHANGE_MESSAGES[e]),Array.isArray(t)||(t=[t]),wm.validation){if(void 0===e)throw new TypeError("Control change must be identified with a valid name or an integer between 0 and 127.");if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new TypeError("Control change number must be an integer between 0 and 127.");if(2===(t=t.map((e=>{const t=Math.min(Math.max(parseInt(e),0),127);if(isNaN(t))throw new TypeError("Values must be integers between 0 and 127");return t}))).length&&e>=32)throw new TypeError("To use a value array, the controller must be between 0 and 31")}return t.forEach(((r,a)=>{this.send([(Enumerations.MIDI_CHANNEL_MESSAGES.controlchange<<4)+(this.number-1),e+32*a,t[a]],{time:Utilities.toTimestamp(n.time)})})),this}_selectNonRegisteredParameter(e,t={}){return this.sendControlChange(99,e[0],t),this.sendControlChange(98,e[1],t),this}_deselectRegisteredParameter(e={}){return this.sendControlChange(101,127,e),this.sendControlChange(100,127,e),this}_deselectNonRegisteredParameter(e={}){return this.sendControlChange(101,127,e),this.sendControlChange(100,127,e),this}_selectRegisteredParameter(e,t={}){return this.sendControlChange(101,e[0],t),this.sendControlChange(100,e[1],t),this}_setCurrentParameter(e,t={}){return e=[].concat(e),this.sendControlChange(6,e[0],t),e.length<2||this.sendControlChange(38,e[1],t),this}sendRpnDecrement(e,t={}){if(Array.isArray(e)||(e=Enumerations.MIDI_REGISTERED_PARAMETERS[e]),wm.validation){if(void 0===e)throw new TypeError("The specified registered parameter is invalid.");let t=!1;if(Object.getOwnPropertyNames(Enumerations.MIDI_REGISTERED_PARAMETERS).forEach((n=>{Enumerations.MIDI_REGISTERED_PARAMETERS[n][0]===e[0]&&Enumerations.MIDI_REGISTERED_PARAMETERS[n][1]===e[1]&&(t=!0)})),!t)throw new TypeError("The specified registered parameter is invalid.")}return this._selectRegisteredParameter(e,t),this.sendControlChange(97,0,t),this._deselectRegisteredParameter(t),this}sendRpnIncrement(e,t={}){if(Array.isArray(e)||(e=Enumerations.MIDI_REGISTERED_PARAMETERS[e]),wm.validation){if(void 0===e)throw new TypeError("The specified registered parameter is invalid.");let t=!1;if(Object.getOwnPropertyNames(Enumerations.MIDI_REGISTERED_PARAMETERS).forEach((n=>{Enumerations.MIDI_REGISTERED_PARAMETERS[n][0]===e[0]&&Enumerations.MIDI_REGISTERED_PARAMETERS[n][1]===e[1]&&(t=!0)})),!t)throw new TypeError("The specified registered parameter is invalid.")}return this._selectRegisteredParameter(e,t),this.sendControlChange(96,0,t),this._deselectRegisteredParameter(t),this}playNote(e,t={}){if(this.sendNoteOn(e,t),t.duration>0&&isFinite(String(t.duration).trim()||NaN)){let n={time:(Utilities.toTimestamp(t.time)||wm.time)+t.duration,release:t.release,rawRelease:t.rawRelease};this.sendNoteOff(e,n)}return this}sendNoteOff(e,t={}){if(wm.validation){if(null!=t.rawRelease&&!(t.rawRelease>=0&&t.rawRelease<=127))throw new RangeError("The 'rawRelease' option must be an integer between 0 and 127");if(null!=t.release&&!(t.release>=0&&t.release<=1))throw new RangeError("The 'release' option must be an number between 0 and 1");t.rawVelocity&&(t.rawRelease=t.velocity,console.warn("The 'rawVelocity' option is deprecated. Use 'rawRelease' instead.")),t.velocity&&(t.release=t.velocity,console.warn("The 'velocity' option is deprecated. Use 'attack' instead."))}let n=64;null!=t.rawRelease?n=t.rawRelease:isNaN(t.release)||(n=Math.round(127*t.release));const r=wm.octaveOffset+this.output.octaveOffset+this.octaveOffset;return Utilities.buildNoteArray(e,{rawRelease:parseInt(n)}).forEach((e=>{this.send([(Enumerations.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(this.number-1),e.getOffsetNumber(r),e.rawRelease],{time:Utilities.toTimestamp(t.time)})})),this}stopNote(e,t={}){return this.sendNoteOff(e,t)}sendNoteOn(e,t={}){if(wm.validation){if(null!=t.rawAttack&&!(t.rawAttack>=0&&t.rawAttack<=127))throw new RangeError("The 'rawAttack' option must be an integer between 0 and 127");if(null!=t.attack&&!(t.attack>=0&&t.attack<=1))throw new RangeError("The 'attack' option must be an number between 0 and 1");t.rawVelocity&&(t.rawAttack=t.velocity,t.rawRelease=t.release,console.warn("The 'rawVelocity' option is deprecated. Use 'rawAttack' or 'rawRelease'.")),t.velocity&&(t.attack=t.velocity,console.warn("The 'velocity' option is deprecated. Use 'attack' instead."))}let n=64;null!=t.rawAttack?n=t.rawAttack:isNaN(t.attack)||(n=Math.round(127*t.attack));const r=wm.octaveOffset+this.output.octaveOffset+this.octaveOffset;return Utilities.buildNoteArray(e,{rawAttack:n}).forEach((e=>{this.send([(Enumerations.MIDI_CHANNEL_MESSAGES.noteon<<4)+(this.number-1),e.getOffsetNumber(r),e.rawAttack],{time:Utilities.toTimestamp(t.time)})})),this}sendChannelMode(e,t=0,n={}){if("string"==typeof e&&(e=Enumerations.MIDI_CHANNEL_MODE_MESSAGES[e]),wm.validation){if(void 0===e)throw new TypeError("Invalid channel mode message name or number.");if(isNaN(e)||!(e>=120&&e<=127))throw new TypeError("Invalid channel mode message number.");if(isNaN(parseInt(t))||t<0||t>127)throw new RangeError("Value must be an integer between 0 and 127.")}return this.send([(Enumerations.MIDI_CHANNEL_MESSAGES.controlchange<<4)+(this.number-1),e,t],{time:Utilities.toTimestamp(n.time)}),this}sendOmniMode(e,t={}){return void 0===e||e?this.sendChannelMode("omnimodeon",0,t):this.sendChannelMode("omnimodeoff",0,t),this}sendChannelAftertouch(e,t={}){if(wm.validation){if(isNaN(parseFloat(e)))throw new RangeError("Invalid channel aftertouch value.");if(t.rawValue){if(!(e>=0&&e<=127&&Number.isInteger(e)))throw new RangeError("Channel aftertouch raw value must be an integer between 0 and 127.")}else if(!(e>=0&&e<=1))throw new RangeError("Channel aftertouch value must be a float between 0 and 1.")}return this.send([(Enumerations.MIDI_CHANNEL_MESSAGES.channelaftertouch<<4)+(this.number-1),Math.round(127*e)],{time:Utilities.toTimestamp(t.time)}),this}sendMasterTuning(e,t={}){if(e=parseFloat(e)||0,wm.validation&&!(e>-65&&e<64))throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");let n=Math.floor(e)+64,r=e-Math.floor(e);r=Math.round((r+1)/2*16383);let a=r>>7&127,s=127&r;return this.sendRpnValue("channelcoarsetuning",n,t),this.sendRpnValue("channelfinetuning",[a,s],t),this}sendModulationRange(e,t,n={}){if(wm.validation){if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new RangeError("The semitones value must be an integer between 0 and 127.");if(!(null==t||Number.isInteger(t)&&t>=0&&t<=127))throw new RangeError("If specified, the cents value must be an integer between 0 and 127.")}return t>=0&&t<=127||(t=0),this.sendRpnValue("modulationrange",[e,t],n),this}sendNrpnValue(e,t,n={}){if(t=[].concat(t),wm.validation){if(!Array.isArray(e)||!Number.isInteger(e[0])||!Number.isInteger(e[1]))throw new TypeError("The specified NRPN is invalid.");if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The first byte of the NRPN must be between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The second byte of the NRPN must be between 0 and 127.");t.forEach((e=>{if(!(e>=0&&e<=127))throw new RangeError("The data bytes of the NRPN must be between 0 and 127.")}))}return this._selectNonRegisteredParameter(e,n),this._setCurrentParameter(t,n),this._deselectNonRegisteredParameter(n),this}sendPitchBend(e,t={}){if(wm.validation)if(t.rawValue&&Array.isArray(e)){if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The pitch bend MSB must be an integer between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The pitch bend LSB must be an integer between 0 and 127.")}else if(t.rawValue&&!Array.isArray(e)){if(!(e>=0&&e<=127))throw new RangeError("The pitch bend MSB must be an integer between 0 and 127.")}else{if(isNaN(e)||null===e)throw new RangeError("Invalid pitch bend value.");if(!(e>=-1&&e<=1))throw new RangeError("The pitch bend MSB must be an integer between 0 and 127.")}let n=0,r=0;if(t.rawValue&&Array.isArray(e))n=e[0],r=e[1];else if(t.rawValue&&!Array.isArray(e))n=e;else{const t=Utilities.fromFloatToMsbLsb((e+1)/2);n=t.msb,r=t.lsb}return this.send([(Enumerations.MIDI_CHANNEL_MESSAGES.pitchbend<<4)+(this.number-1),r,n],{time:Utilities.toTimestamp(t.time)}),this}sendPitchBendRange(e,t,n={}){if(wm.validation){if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new RangeError("The semitones value must be an integer between 0 and 127.");if(!Number.isInteger(t)||!(t>=0&&t<=127))throw new RangeError("The cents value must be an integer between 0 and 127.")}return this.sendRpnValue("pitchbendrange",[e,t],n),this}sendProgramChange(e,t={}){if(e=parseInt(e)||0,wm.validation&&!(e>=0&&e<=127))throw new RangeError("The program number must be between 0 and 127.");return this.send([(Enumerations.MIDI_CHANNEL_MESSAGES.programchange<<4)+(this.number-1),e],{time:Utilities.toTimestamp(t.time)}),this}sendRpnValue(e,t,n={}){if(Array.isArray(e)||(e=Enumerations.MIDI_REGISTERED_PARAMETERS[e]),wm.validation){if(!Number.isInteger(e[0])||!Number.isInteger(e[1]))throw new TypeError("The specified NRPN is invalid.");if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The first byte of the RPN must be between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The second byte of the RPN must be between 0 and 127.");[].concat(t).forEach((e=>{if(!(e>=0&&e<=127))throw new RangeError("The data bytes of the RPN must be between 0 and 127.")}))}return this._selectRegisteredParameter(e,n),this._setCurrentParameter(t,n),this._deselectRegisteredParameter(n),this}sendTuningBank(e,t={}){if(wm.validation&&(!Number.isInteger(e)||!(e>=0&&e<=127)))throw new RangeError("The tuning bank number must be between 0 and 127.");return this.sendRpnValue("tuningbank",e,t),this}sendTuningProgram(e,t={}){if(wm.validation&&(!Number.isInteger(e)||!(e>=0&&e<=127)))throw new RangeError("The tuning program number must be between 0 and 127.");return this.sendRpnValue("tuningprogram",e,t),this}sendLocalControl(e,t={}){return e?this.sendChannelMode("localcontrol",127,t):this.sendChannelMode("localcontrol",0,t)}sendAllNotesOff(e={}){return this.sendChannelMode("allnotesoff",0,e)}sendAllSoundOff(e={}){return this.sendChannelMode("allsoundoff",0,e)}sendResetAllControllers(e={}){return this.sendChannelMode("resetallcontrollers",0,e)}sendPolyphonicMode(e,t={}){return"mono"===e?this.sendChannelMode("monomodeon",0,t):this.sendChannelMode("polymodeon",0,t)}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get output(){return this._output}get number(){return this._number}}
/**
 * The `Output` class represents a single MIDI output port (not to be confused with a MIDI channel).
 * A port is made available by a MIDI device. A MIDI device can advertise several input and output
 * ports. Each port has 16 MIDI channels which can be accessed via the [`channels`](#channels)
 * property.
 *
 * The `Output` object is automatically instantiated by the library according to the host's MIDI
 * subsystem and should not be directly instantiated.
 *
 * You can access all available `Output` objects by referring to the
 * [`WebMidi.outputs`](WebMidi#outputs) array or by using methods such as
 * [`WebMidi.getOutputByName()`](WebMidi#getOutputByName) or
 * [`WebMidi.getOutputById()`](WebMidi#getOutputById).
 *
 * @fires Output#opened
 * @fires Output#disconnected
 * @fires Output#closed
 *
 * @extends EventEmitter
 * @license Apache-2.0
 */class Output extends EventEmitter{constructor(e){super(),this._midiOutput=e,this._octaveOffset=0,this.channels=[];for(let e=1;e<=16;e++)this.channels[e]=new OutputChannel(this,e);this._midiOutput.onstatechange=this._onStateChange.bind(this)}async destroy(){this.removeListener(),this.channels.forEach((e=>e.destroy())),this.channels=[],this._midiOutput.onstatechange=null,await this.close(),this._midiOutput=null}_onStateChange(e){let t={timestamp:wm.time};"open"===e.port.connection?(t.type="opened",t.target=this,t.port=t.target,this.emit("opened",t)):"closed"===e.port.connection&&"connected"===e.port.state?(t.type="closed",t.target=this,t.port=t.target,this.emit("closed",t)):"closed"===e.port.connection&&"disconnected"===e.port.state?(t.type="disconnected",t.port={connection:e.port.connection,id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this.emit("disconnected",t)):"pending"===e.port.connection&&"disconnected"===e.port.state||console.warn("This statechange event was not caught:",e.port.connection,e.port.state)}async open(){try{return await this._midiOutput.open(),Promise.resolve(this)}catch(e){return Promise.reject(e)}}async close(){this._midiOutput?await this._midiOutput.close():await Promise.resolve()}
/**
   * Sends a MIDI message on the MIDI output port. If no time is specified, the message will be
   * sent immediately. The message should be an array of 8 bit unsigned integers (0-225), a
   * [`Uint8Array`]{@link https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array}
   * object or a [`Message`](Message) object.
   *
   * It is usually not necessary to use this method directly as you can use one of the simpler
   * helper methods such as [`playNote()`](#playNote), [`stopNote()`](#stopNote),
   * [`sendControlChange()`](#sendControlChange), etc.
   *
   * Details on the format of MIDI messages are available in the summary of
   * [MIDI messages]{@link https://www.midi.org/specifications-old/item/table-1-summary-of-midi-message}
   * from the MIDI Manufacturers Association.
   *
   * @param message {number[]|Uint8Array|Message} An array of 8bit unsigned integers, a `Uint8Array`
   * object (not available in Node.js) containing the message bytes or a `Message` object.
   *
   * @param {object} [options={}]
   *
   * @param {number|string} [options.time=(now)] If `time` is a string prefixed with `"+"` and
   * followed by a number, the message will be delayed by that many milliseconds. If the value is a
   * positive number
   * ([`DOMHighResTimeStamp`]{@link https://developer.mozilla.org/docs/Web/API/DOMHighResTimeStamp}),
   * the operation will be scheduled for that time. The current time can be retrieved with
   * [`WebMidi.time`]{@link WebMidi#time}. If `options.time` is omitted, or in the past, the
   * operation will be carried out as soon as possible.
   *
   * @throws {RangeError} The first byte (status) must be an integer between 128 and 255.
   *
   * @returns {Output} Returns the `Output` object so methods can be chained.
   *
   * @license Apache-2.0
   */send(e,t={time:0},n=0){if(e instanceof Message&&(e=Utilities.isNode?e.data:e.rawData),e instanceof Uint8Array&&Utilities.isNode&&(e=Array.from(e)),wm.validation){if(Array.isArray(e)||e instanceof Uint8Array||(e=[e],Array.isArray(t)&&(e=e.concat(t)),t=isNaN(n)?{time:0}:{time:n}),!(parseInt(e[0])>=128&&parseInt(e[0])<=255))throw new RangeError("The first byte (status) must be an integer between 128 and 255.");e.slice(1).forEach((e=>{if(!((e=parseInt(e))>=0&&e<=255))throw new RangeError("Data bytes must be integers between 0 and 255.")})),t||(t={time:0})}return this._midiOutput.send(e,Utilities.toTimestamp(t.time)),this}sendSysex(e,t=[],n={}){if(e=[].concat(e),t instanceof Uint8Array){const r=new Uint8Array(1+e.length+t.length+1);r[0]=Enumerations.MIDI_SYSTEM_MESSAGES.sysex,r.set(Uint8Array.from(e),1),r.set(t,1+e.length),r[r.length-1]=Enumerations.MIDI_SYSTEM_MESSAGES.sysexend,this.send(r,{time:n.time})}else{const r=e.concat(t,Enumerations.MIDI_SYSTEM_MESSAGES.sysexend);this.send([Enumerations.MIDI_SYSTEM_MESSAGES.sysex].concat(r),{time:n.time})}return this}clear(){return this._midiOutput.clear?this._midiOutput.clear():wm.validation&&console.warn("The 'clear()' method has not yet been implemented in your environment."),this}sendTimecodeQuarterFrame(e,t={}){if(wm.validation&&(e=parseInt(e),isNaN(e)||!(e>=0&&e<=127)))throw new RangeError("The value must be an integer between 0 and 127.");return this.send([Enumerations.MIDI_SYSTEM_MESSAGES.timecode,e],{time:t.time}),this}sendSongPosition(e=0,t={}){var n=(e=Math.floor(e)||0)>>7&127,r=127&e;return this.send([Enumerations.MIDI_SYSTEM_MESSAGES.songposition,n,r],{time:t.time}),this}sendSongSelect(e=0,t={}){if(wm.validation&&(e=parseInt(e),isNaN(e)||!(e>=0&&e<=127)))throw new RangeError("The program value must be between 0 and 127");return this.send([Enumerations.MIDI_SYSTEM_MESSAGES.songselect,e],{time:t.time}),this}sendTuneRequest(e={}){return this.send([Enumerations.MIDI_SYSTEM_MESSAGES.tunerequest],{time:e.time}),this}sendClock(e={}){return this.send([Enumerations.MIDI_SYSTEM_MESSAGES.clock],{time:e.time}),this}sendStart(e={}){return this.send([Enumerations.MIDI_SYSTEM_MESSAGES.start],{time:e.time}),this}sendContinue(e={}){return this.send([Enumerations.MIDI_SYSTEM_MESSAGES.continue],{time:e.time}),this}sendStop(e={}){return this.send([Enumerations.MIDI_SYSTEM_MESSAGES.stop],{time:e.time}),this}sendActiveSensing(e={}){return this.send([Enumerations.MIDI_SYSTEM_MESSAGES.activesensing],{time:e.time}),this}sendReset(e={}){return this.send([Enumerations.MIDI_SYSTEM_MESSAGES.reset],{time:e.time}),this}sendTuningRequest(e={}){return wm.validation&&console.warn("The sendTuningRequest() method has been deprecated. Use sendTuningRequest() instead."),this.sendTuneRequest(e)}sendKeyAftertouch(e,t,n={}){return null==n.channels&&(n.channels=Enumerations.MIDI_CHANNEL_NUMBERS),Utilities.sanitizeChannels(n.channels).forEach((r=>{this.channels[r].sendKeyAftertouch(e,t,n)})),this}sendControlChange(e,t,n={},r={}){if(wm.validation&&(Array.isArray(n)||Number.isInteger(n)||"all"===n)){const e=n;(n=r).channels=e,"all"===n.channels&&(n.channels=Enumerations.MIDI_CHANNEL_NUMBERS)}return null==n.channels&&(n.channels=Enumerations.MIDI_CHANNEL_NUMBERS),Utilities.sanitizeChannels(n.channels).forEach((r=>{this.channels[r].sendControlChange(e,t,n)})),this}sendPitchBendRange(e=0,t=0,n={}){return null==n.channels&&(n.channels=Enumerations.MIDI_CHANNEL_NUMBERS),Utilities.sanitizeChannels(n.channels).forEach((r=>{this.channels[r].sendPitchBendRange(e,t,n)})),this}setPitchBendRange(e=0,t=0,n="all",r={}){return wm.validation&&(console.warn("The setPitchBendRange() method is deprecated. Use sendPitchBendRange() instead."),r.channels=n,"all"===r.channels&&(r.channels=Enumerations.MIDI_CHANNEL_NUMBERS)),this.sendPitchBendRange(e,t,r)}sendRpnValue(e,t,n={}){return null==n.channels&&(n.channels=Enumerations.MIDI_CHANNEL_NUMBERS),Utilities.sanitizeChannels(n.channels).forEach((r=>{this.channels[r].sendRpnValue(e,t,n)})),this}setRegisteredParameter(e,t=[],n="all",r={}){return wm.validation&&(console.warn("The setRegisteredParameter() method is deprecated. Use sendRpnValue() instead."),r.channels=n,"all"===r.channels&&(r.channels=Enumerations.MIDI_CHANNEL_NUMBERS)),this.sendRpnValue(e,t,r)}sendChannelAftertouch(e,t={},n={}){if(wm.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=n).channels=e,"all"===t.channels&&(t.channels=Enumerations.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=Enumerations.MIDI_CHANNEL_NUMBERS),Utilities.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendChannelAftertouch(e,t)})),this}sendPitchBend(e,t={},n={}){if(wm.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=n).channels=e,"all"===t.channels&&(t.channels=Enumerations.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=Enumerations.MIDI_CHANNEL_NUMBERS),Utilities.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendPitchBend(e,t)})),this}sendProgramChange(e=0,t={},n={}){if(wm.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=n).channels=e,"all"===t.channels&&(t.channels=Enumerations.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=Enumerations.MIDI_CHANNEL_NUMBERS),Utilities.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendProgramChange(e,t)})),this}sendModulationRange(e,t,n={}){return null==n.channels&&(n.channels=Enumerations.MIDI_CHANNEL_NUMBERS),Utilities.sanitizeChannels(n.channels).forEach((r=>{this.channels[r].sendModulationRange(e,t,n)})),this}setModulationRange(e=0,t=0,n="all",r={}){return wm.validation&&(console.warn("The setModulationRange() method is deprecated. Use sendModulationRange() instead."),r.channels=n,"all"===r.channels&&(r.channels=Enumerations.MIDI_CHANNEL_NUMBERS)),this.sendModulationRange(e,t,r)}sendMasterTuning(e,t={}){return null==t.channels&&(t.channels=Enumerations.MIDI_CHANNEL_NUMBERS),Utilities.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendMasterTuning(e,t)})),this}setMasterTuning(e,t={},n={}){return wm.validation&&(console.warn("The setMasterTuning() method is deprecated. Use sendMasterTuning() instead."),n.channels=t,"all"===n.channels&&(n.channels=Enumerations.MIDI_CHANNEL_NUMBERS)),this.sendMasterTuning(e,n)}sendTuningProgram(e,t={}){return null==t.channels&&(t.channels=Enumerations.MIDI_CHANNEL_NUMBERS),Utilities.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendTuningProgram(e,t)})),this}setTuningProgram(e,t="all",n={}){return wm.validation&&(console.warn("The setTuningProgram() method is deprecated. Use sendTuningProgram() instead."),n.channels=t,"all"===n.channels&&(n.channels=Enumerations.MIDI_CHANNEL_NUMBERS)),this.sendTuningProgram(e,n)}sendTuningBank(e=0,t={}){return null==t.channels&&(t.channels=Enumerations.MIDI_CHANNEL_NUMBERS),Utilities.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendTuningBank(e,t)})),this}setTuningBank(e,t="all",n={}){return wm.validation&&(console.warn("The setTuningBank() method is deprecated. Use sendTuningBank() instead."),n.channels=t,"all"===n.channels&&(n.channels=Enumerations.MIDI_CHANNEL_NUMBERS)),this.sendTuningBank(e,n)}sendChannelMode(e,t=0,n={},r={}){if(wm.validation&&(Array.isArray(n)||Number.isInteger(n)||"all"===n)){const e=n;(n=r).channels=e,"all"===n.channels&&(n.channels=Enumerations.MIDI_CHANNEL_NUMBERS)}return null==n.channels&&(n.channels=Enumerations.MIDI_CHANNEL_NUMBERS),Utilities.sanitizeChannels(n.channels).forEach((r=>{this.channels[r].sendChannelMode(e,t,n)})),this}sendAllSoundOff(e={}){return null==e.channels&&(e.channels=Enumerations.MIDI_CHANNEL_NUMBERS),Utilities.sanitizeChannels(e.channels).forEach((t=>{this.channels[t].sendAllSoundOff(e)})),this}sendAllNotesOff(e={}){return null==e.channels&&(e.channels=Enumerations.MIDI_CHANNEL_NUMBERS),Utilities.sanitizeChannels(e.channels).forEach((t=>{this.channels[t].sendAllNotesOff(e)})),this}sendResetAllControllers(e={},t={}){if(wm.validation&&(Array.isArray(e)||Number.isInteger(e)||"all"===e)){const n=e;(e=t).channels=n,"all"===e.channels&&(e.channels=Enumerations.MIDI_CHANNEL_NUMBERS)}return null==e.channels&&(e.channels=Enumerations.MIDI_CHANNEL_NUMBERS),Utilities.sanitizeChannels(e.channels).forEach((t=>{this.channels[t].sendResetAllControllers(e)})),this}sendPolyphonicMode(e,t={},n={}){if(wm.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=n).channels=e,"all"===t.channels&&(t.channels=Enumerations.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=Enumerations.MIDI_CHANNEL_NUMBERS),Utilities.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendPolyphonicMode(e,t)})),this}sendLocalControl(e,t={},n={}){if(wm.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=n).channels=e,"all"===t.channels&&(t.channels=Enumerations.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=Enumerations.MIDI_CHANNEL_NUMBERS),Utilities.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendLocalControl(e,t)})),this}sendOmniMode(e,t={},n={}){if(wm.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=n).channels=e,"all"===t.channels&&(t.channels=Enumerations.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=Enumerations.MIDI_CHANNEL_NUMBERS),Utilities.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendOmniMode(e,t)})),this}sendNrpnValue(e,t,n={}){return null==n.channels&&(n.channels=Enumerations.MIDI_CHANNEL_NUMBERS),Utilities.sanitizeChannels(n.channels).forEach((r=>{this.channels[r].sendNrpnValue(e,t,n)})),this}setNonRegisteredParameter(e,t=[],n="all",r={}){return wm.validation&&(console.warn("The setNonRegisteredParameter() method is deprecated. Use sendNrpnValue() instead."),r.channels=n,"all"===r.channels&&(r.channels=Enumerations.MIDI_CHANNEL_NUMBERS)),this.sendNrpnValue(e,t,r)}sendRpnIncrement(e,t={}){return null==t.channels&&(t.channels=Enumerations.MIDI_CHANNEL_NUMBERS),Utilities.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendRpnIncrement(e,t)})),this}incrementRegisteredParameter(e,t="all",n={}){return wm.validation&&(console.warn("The incrementRegisteredParameter() method is deprecated. Use sendRpnIncrement() instead."),n.channels=t,"all"===n.channels&&(n.channels=Enumerations.MIDI_CHANNEL_NUMBERS)),this.sendRpnIncrement(e,n)}sendRpnDecrement(e,t={}){return null==t.channels&&(t.channels=Enumerations.MIDI_CHANNEL_NUMBERS),Utilities.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendRpnDecrement(e,t)})),this}decrementRegisteredParameter(e,t="all",n={}){return wm.validation&&(console.warn("The decrementRegisteredParameter() method is deprecated. Use sendRpnDecrement() instead."),n.channels=t,"all"===n.channels&&(n.channels=Enumerations.MIDI_CHANNEL_NUMBERS)),this.sendRpnDecrement(e,n)}sendNoteOff(e,t={},n={}){if(wm.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=n).channels=e,"all"===t.channels&&(t.channels=Enumerations.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=Enumerations.MIDI_CHANNEL_NUMBERS),Utilities.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendNoteOff(e,t)})),this}stopNote(e,t){return this.sendNoteOff(e,t)}playNote(e,t={},n={}){if(wm.validation&&(t.rawVelocity&&console.warn("The 'rawVelocity' option is deprecated. Use 'rawAttack' instead."),t.velocity&&console.warn("The 'velocity' option is deprecated. Use 'velocity' instead."),Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=n).channels=e,"all"===t.channels&&(t.channels=Enumerations.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=Enumerations.MIDI_CHANNEL_NUMBERS),Utilities.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].playNote(e,t)})),this}sendNoteOn(e,t={},n={}){if(wm.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=n).channels=e,"all"===t.channels&&(t.channels=Enumerations.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=Enumerations.MIDI_CHANNEL_NUMBERS),Utilities.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendNoteOn(e,t)})),this}get name(){return this._midiOutput.name}get id(){return this._midiOutput.id}get connection(){return this._midiOutput.connection}get manufacturer(){return this._midiOutput.manufacturer}get state(){return this._midiOutput.state}get type(){return this._midiOutput.type}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}}
/**
 * The `Forwarder` class allows the forwarding of MIDI messages to predetermined outputs. When you
 * call its [`forward()`](#forward) method, it will send the specified [`Message`](Message) object
 * to all the outputs listed in its [`destinations`](#destinations) property.
 *
 * If specific channels or message types have been defined in the [`channels`](#channels) or
 * [`types`](#types) properties, only messages matching the channels/types will be forwarded.
 *
 * While it can be manually instantiated, you are more likely to come across a `Forwarder` object as
 * the return value of the [`Input.addForwarder()`](Input#addForwarder) method.
 *
 * @license Apache-2.0
 * @since 3.0.0
 */class Forwarder{constructor(e=[],t={}){this.destinations=[],this.types=[...Object.keys(Enumerations.MIDI_SYSTEM_MESSAGES),...Object.keys(Enumerations.MIDI_CHANNEL_MESSAGES)],this.channels=Enumerations.MIDI_CHANNEL_NUMBERS,this.suspended=!1,Array.isArray(e)||(e=[e]),t.types&&!Array.isArray(t.types)&&(t.types=[t.types]),t.channels&&!Array.isArray(t.channels)&&(t.channels=[t.channels]),wm.validation&&(e.forEach((e=>{if(!(e instanceof Output))throw new TypeError("Destinations must be of type 'Output'.")})),void 0!==t.types&&t.types.forEach((e=>{if(!Enumerations.MIDI_SYSTEM_MESSAGES.hasOwnProperty(e)&&!Enumerations.MIDI_CHANNEL_MESSAGES.hasOwnProperty(e))throw new TypeError("Type must be a valid message type.")})),void 0!==t.channels&&t.channels.forEach((e=>{if(!Enumerations.MIDI_CHANNEL_NUMBERS.includes(e))throw new TypeError("MIDI channel must be between 1 and 16.")}))),this.destinations=e,t.types&&(this.types=t.types),t.channels&&(this.channels=t.channels)}forward(e){this.suspended||this.types.includes(e.type)&&(e.channel&&!this.channels.includes(e.channel)||this.destinations.forEach((t=>{(!wm.validation||t instanceof Output)&&t.send(e)})))}}
/**
 * The `InputChannel` class represents a single MIDI input channel (1-16) from a single input
 * device. This object is derived from the host's MIDI subsystem and should not be instantiated
 * directly.
 *
 * All 16 `InputChannel` objects can be found inside the input's [`channels`](Input#channels)
 * property.
 *
 * @fires InputChannel#midimessage
 * @fires InputChannel#unknownmessage
 *
 * @fires InputChannel#noteoff
 * @fires InputChannel#noteon
 * @fires InputChannel#keyaftertouch
 * @fires InputChannel#programchange
 * @fires InputChannel#event:controlchange-controllerxxx
 * @fires InputChannel#channelaftertouch
 * @fires InputChannel#pitchbend
 * @fires InputChannel#controlchange
 *
 * @fires InputChannel#allnotesoff
 * @fires InputChannel#allsoundoff
 * @fires InputChannel#localcontrol
 * @fires InputChannel#monomode
 * @fires InputChannel#omnimode
 * @fires InputChannel#resetallcontrollers
 *
 * @fires InputChannel#event:nrpn
 * @fires InputChannel#event:nrpn-dataentrycoarse
 * @fires InputChannel#event:nrpn-dataentryfine
 * @fires InputChannel#event:nrpn-databuttonincrement
 * @fires InputChannel#event:nrpn-databuttondecrement
 * @fires InputChannel#event:rpn
 * @fires InputChannel#event:rpn-dataentrycoarse
 * @fires InputChannel#event:rpn-dataentryfine
 * @fires InputChannel#event:rpn-databuttonincrement
 * @fires InputChannel#event:rpn-databuttondecrement
 *
 * @extends EventEmitter
 * @license Apache-2.0
 * @since 3.0.0
 */class InputChannel extends EventEmitter{constructor(e,t){super(),this._input=e,this._number=t,this._octaveOffset=0,this._nrpnBuffer=[],this._rpnBuffer=[],this.parameterNumberEventsEnabled=!0,this.notesState=new Array(128).fill(!1)}destroy(){this._input=null,this._number=null,this._octaveOffset=0,this._nrpnBuffer=[],this.notesState=new Array(128).fill(!1),this.parameterNumberEventsEnabled=!1,this.removeListener()}_processMidiMessageEvent(e){const t=Object.assign({},e);t.port=this.input,t.target=this,t.type="midimessage",this.emit(t.type,t),this._parseEventForStandardMessages(t)}_parseEventForStandardMessages(e){const t=Object.assign({},e);t.type=t.message.type||"unknownmessage";const n=e.message.dataBytes[0],r=e.message.dataBytes[1];if("noteoff"===t.type||"noteon"===t.type&&0===r)this.notesState[n]=!1,t.type="noteoff",t.note=new Note(Utilities.offsetNumber(n,this.octaveOffset+this.input.octaveOffset+wm.octaveOffset),{rawAttack:0,rawRelease:r}),t.value=Utilities.from7bitToFloat(r),t.rawValue=r,t.velocity=t.note.release,t.rawVelocity=t.note.rawRelease;else if("noteon"===t.type)this.notesState[n]=!0,t.note=new Note(Utilities.offsetNumber(n,this.octaveOffset+this.input.octaveOffset+wm.octaveOffset),{rawAttack:r}),t.value=Utilities.from7bitToFloat(r),t.rawValue=r,t.velocity=t.note.attack,t.rawVelocity=t.note.rawAttack;else if("keyaftertouch"===t.type)t.note=new Note(Utilities.offsetNumber(n,this.octaveOffset+this.input.octaveOffset+wm.octaveOffset)),t.value=Utilities.from7bitToFloat(r),t.rawValue=r,t.identifier=t.note.identifier,t.key=t.note.number,t.rawKey=n;else if("controlchange"===t.type){t.controller={number:n,name:Utilities.getCcNameByNumber(n)},t.subtype=t.controller.name||"controller"+n,t.value=Utilities.from7bitToFloat(r),t.rawValue=r;const e=Object.assign({},t);e.type=`${t.type}-controller${n}`,delete e.subtype,this.emit(e.type,e),t.message.dataBytes[0]>=120&&this._parseChannelModeMessage(t),this.parameterNumberEventsEnabled&&this._isRpnOrNrpnController(t.message.dataBytes[0])&&this._parseEventForParameterNumber(t)}else"programchange"===t.type?(t.value=n,t.rawValue=t.value):"channelaftertouch"===t.type?(t.value=Utilities.from7bitToFloat(n),t.rawValue=n):"pitchbend"===t.type?(t.value=((r<<7)+n-8192)/8192,t.rawValue=(r<<7)+n):t.type="unknownmessage";this.emit(t.type,t)}_parseChannelModeMessage(e){const t=Object.assign({},e);t.type=t.controller.name,"localcontrol"===t.type&&(t.value=127===t.message.data[2],t.rawValue=t.message.data[2]),"omnimodeon"===t.type?(t.type="omnimode",t.value=!0,t.rawValue=t.message.data[2]):"omnimodeoff"===t.type&&(t.type="omnimode",t.value=!1,t.rawValue=t.message.data[2]),"monomodeon"===t.type?(t.type="monomode",t.value=!0,t.rawValue=t.message.data[2]):"polymodeon"===t.type&&(t.type="monomode",t.value=!1,t.rawValue=t.message.data[2]),this.emit(t.type,t)}_parseEventForParameterNumber(e){const t=e.message.dataBytes[0],n=e.message.dataBytes[1],r=Enumerations.MIDI_CONTROL_CHANGE_MESSAGES;t===r.nonregisteredparameterfine||t===r.registeredparameterfine?(this._nrpnBuffer=[],this._rpnBuffer=[],t===r.nonregisteredparameterfine?this._nrpnBuffer=[e.message]:127!==n&&(this._rpnBuffer=[e.message])):t===r.nonregisteredparametercoarse||t===r.registeredparametercoarse?t===r.nonregisteredparametercoarse?(this._rpnBuffer=[],1===this._nrpnBuffer.length?this._nrpnBuffer.push(e.message):this._nrpnBuffer=[]):(this._nrpnBuffer=[],1===this._rpnBuffer.length&&127!==n?this._rpnBuffer.push(e.message):this._rpnBuffer=[]):t!==r.dataentrycoarse&&t!==r.dataentryfine&&t!==r.databuttonincrement&&t!==r.databuttondecrement||(2===this._rpnBuffer.length?this._dispatchParameterNumberEvent("rpn",this._rpnBuffer[0].dataBytes[1],this._rpnBuffer[1].dataBytes[1],e):2===this._nrpnBuffer.length?this._dispatchParameterNumberEvent("nrpn",this._nrpnBuffer[0].dataBytes[1],this._nrpnBuffer[1].dataBytes[1],e):(this._nrpnBuffer=[],this._rpnBuffer=[]))}_isRpnOrNrpnController(e){return e===Enumerations.MIDI_CONTROL_CHANGE_MESSAGES.dataentrycoarse||e===Enumerations.MIDI_CONTROL_CHANGE_MESSAGES.dataentryfine||e===Enumerations.MIDI_CONTROL_CHANGE_MESSAGES.databuttonincrement||e===Enumerations.MIDI_CONTROL_CHANGE_MESSAGES.databuttondecrement||e===Enumerations.MIDI_CONTROL_CHANGE_MESSAGES.nonregisteredparametercoarse||e===Enumerations.MIDI_CONTROL_CHANGE_MESSAGES.nonregisteredparameterfine||e===Enumerations.MIDI_CONTROL_CHANGE_MESSAGES.registeredparametercoarse||e===Enumerations.MIDI_CONTROL_CHANGE_MESSAGES.registeredparameterfine}_dispatchParameterNumberEvent(e,t,n,r){e="nrpn"===e?"nrpn":"rpn";const a={target:r.target,timestamp:r.timestamp,message:r.message,parameterMsb:t,parameterLsb:n,value:Utilities.from7bitToFloat(r.message.dataBytes[1]),rawValue:r.message.dataBytes[1]};a.parameter="rpn"===e?Object.keys(Enumerations.MIDI_REGISTERED_PARAMETERS).find((e=>Enumerations.MIDI_REGISTERED_PARAMETERS[e][0]===t&&Enumerations.MIDI_REGISTERED_PARAMETERS[e][1]===n)):(t<<7)+n;const s=Utilities.getPropertyByValue(Enumerations.MIDI_CONTROL_CHANGE_MESSAGES,r.message.dataBytes[0]);a.type=`${e}-${s}`,this.emit(a.type,a),a.type=e,a.subtype=s,this.emit(a.type,a)}getChannelModeByNumber(e){return wm.validation&&(console.warn("The 'getChannelModeByNumber()' method has been moved to the 'Utilities' class."),e=Math.floor(e)),Utilities.getChannelModeByNumber(e)}getCcNameByNumber(e){if(wm.validation&&(console.warn("The 'getCcNameByNumber()' method has been moved to the 'Utilities' class."),!((e=parseInt(e))>=0&&e<=127)))throw new RangeError("Invalid control change number.");return Utilities.getCcNameByNumber(e)}getNoteState(e){e instanceof Note&&(e=e.identifier);const t=Utilities.guessNoteNumber(e,wm.octaveOffset+this.input.octaveOffset+this.octaveOffset);return this.notesState[t]}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get input(){return this._input}get number(){return this._number}get nrpnEventsEnabled(){return this.parameterNumberEventsEnabled}set nrpnEventsEnabled(e){this.validation&&(e=!!e),this.parameterNumberEventsEnabled=e}}
/**
 * The `Message` class represents a single MIDI message. It has several properties that make it
 * easy to make sense of the binary data it contains.
 *
 * @license Apache-2.0
 * @since 3.0.0
 */class Message{constructor(e){this.rawData=e,this.data=Array.from(this.rawData),this.statusByte=this.rawData[0],this.rawDataBytes=this.rawData.slice(1),this.dataBytes=this.data.slice(1),this.isChannelMessage=!1,this.isSystemMessage=!1,this.command=void 0,this.channel=void 0,this.manufacturerId=void 0,this.type=void 0,this.statusByte<240?(this.isChannelMessage=!0,this.command=this.statusByte>>4,this.channel=1+(15&this.statusByte)):(this.isSystemMessage=!0,this.command=this.statusByte),this.isChannelMessage?this.type=Utilities.getPropertyByValue(Enumerations.MIDI_CHANNEL_MESSAGES,this.command):this.isSystemMessage&&(this.type=Utilities.getPropertyByValue(Enumerations.MIDI_SYSTEM_MESSAGES,this.command)),this.statusByte===Enumerations.MIDI_SYSTEM_MESSAGES.sysex&&(0===this.dataBytes[0]?(this.manufacturerId=this.dataBytes.slice(0,3),this.dataBytes=this.dataBytes.slice(3,this.rawDataBytes.length-1),this.rawDataBytes=this.rawDataBytes.slice(3,this.rawDataBytes.length-1)):(this.manufacturerId=[this.dataBytes[0]],this.dataBytes=this.dataBytes.slice(1,this.dataBytes.length-1),this.rawDataBytes=this.rawDataBytes.slice(1,this.rawDataBytes.length-1)))}}
/**
 * The `Input` class represents a single MIDI input port. This object is automatically instantiated
 * by the library according to the host's MIDI subsystem and does not need to be directly
 * instantiated. Instead, you can access all `Input` objects by referring to the
 * [`WebMidi.inputs`](WebMidi#inputs) array. You can also retrieve inputs by using methods such as
 * [`WebMidi.getInputByName()`](WebMidi#getInputByName) and
 * [`WebMidi.getInputById()`](WebMidi#getInputById).
 *
 * Note that a single MIDI device may expose several inputs and/or outputs.
 *
 * **Important**: the `Input` class does not directly fire channel-specific MIDI messages
 * (such as [`noteon`](InputChannel#event:noteon) or
 * [`controlchange`](InputChannel#event:controlchange), etc.). The [`InputChannel`](InputChannel)
 * object does that. However, you can still use the
 * [`Input.addListener()`](#addListener) method to listen to channel-specific events on multiple
 * [`InputChannel`](InputChannel) objects at once.
 *
 * @fires Input#opened
 * @fires Input#disconnected
 * @fires Input#closed
 * @fires Input#midimessage
 *
 * @fires Input#sysex
 * @fires Input#timecode
 * @fires Input#songposition
 * @fires Input#songselect
 * @fires Input#tunerequest
 * @fires Input#clock
 * @fires Input#start
 * @fires Input#continue
 * @fires Input#stop
 * @fires Input#activesensing
 * @fires Input#reset
 *
 * @fires Input#unknownmidimessage
 *
 * @extends EventEmitter
 * @license Apache-2.0
 */class Input extends EventEmitter{constructor(e){super(),this._midiInput=e,this._octaveOffset=0,this.channels=[];for(let e=1;e<=16;e++)this.channels[e]=new InputChannel(this,e);this._forwarders=[],this._midiInput.onstatechange=this._onStateChange.bind(this),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}async destroy(){this.removeListener(),this.channels.forEach((e=>e.destroy())),this.channels=[],this._forwarders=[],this._midiInput&&(this._midiInput.onstatechange=null,this._midiInput.onmidimessage=null),await this.close(),this._midiInput=null}_onStateChange(e){let t={timestamp:wm.time,target:this,port:this};"open"===e.port.connection?(t.type="opened",this.emit("opened",t)):"closed"===e.port.connection&&"connected"===e.port.state?(t.type="closed",this.emit("closed",t)):"closed"===e.port.connection&&"disconnected"===e.port.state?(t.type="disconnected",t.port={connection:e.port.connection,id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this.emit("disconnected",t)):"pending"===e.port.connection&&"disconnected"===e.port.state||console.warn("This statechange event was not caught: ",e.port.connection,e.port.state)}_onMidiMessage(e){const t=new Message(e.data),n={port:this,target:this,message:t,timestamp:e.timeStamp,type:"midimessage",data:t.data,rawData:t.data,statusByte:t.data[0],dataBytes:t.dataBytes};this.emit("midimessage",n),t.isSystemMessage?this._parseEvent(n):t.isChannelMessage&&this.channels[t.channel]._processMidiMessageEvent(n),this._forwarders.forEach((e=>e.forward(t)))}_parseEvent(e){const t=Object.assign({},e);t.type=t.message.type||"unknownmidimessage","songselect"===t.type&&(t.song=e.data[1]+1,t.value=e.data[1],t.rawValue=t.value),this.emit(t.type,t)}async open(){try{await this._midiInput.open()}catch(e){return Promise.reject(e)}return Promise.resolve(this)}async close(){if(!this._midiInput)return Promise.resolve(this);try{await this._midiInput.close()}catch(e){return Promise.reject(e)}return Promise.resolve(this)}getChannelModeByNumber(){wm.validation&&console.warn("The 'getChannelModeByNumber()' method has been moved to the 'Utilities' class.")}addListener(e,t,n={}){if(wm.validation&&"function"==typeof n){let e=null!=t?[].concat(t):void 0;t=n,n={channels:e}}if(Enumerations.CHANNEL_EVENTS.includes(e)){void 0===n.channels&&(n.channels=Enumerations.MIDI_CHANNEL_NUMBERS);let r=[];return Utilities.sanitizeChannels(n.channels).forEach((a=>{r.push(this.channels[a].addListener(e,t,n))})),r}return super.addListener(e,t,n)}addOneTimeListener(e,t,n={}){return n.remaining=1,this.addListener(e,t,n)}on(e,t,n,r){return this.addListener(e,t,n,r)}hasListener(e,t,n={}){if(wm.validation&&"function"==typeof n){let e=[].concat(t);t=n,n={channels:e}}return Enumerations.CHANNEL_EVENTS.includes(e)?(void 0===n.channels&&(n.channels=Enumerations.MIDI_CHANNEL_NUMBERS),Utilities.sanitizeChannels(n.channels).every((n=>this.channels[n].hasListener(e,t)))):super.hasListener(e,t)}removeListener(e,t,n={}){if(wm.validation&&"function"==typeof n){let e=[].concat(t);t=n,n={channels:e}}if(void 0===n.channels&&(n.channels=Enumerations.MIDI_CHANNEL_NUMBERS),null==e)return Utilities.sanitizeChannels(n.channels).forEach((e=>{this.channels[e]&&this.channels[e].removeListener()})),super.removeListener();Enumerations.CHANNEL_EVENTS.includes(e)?Utilities.sanitizeChannels(n.channels).forEach((r=>{this.channels[r].removeListener(e,t,n)})):super.removeListener(e,t,n)}addForwarder(e,t={}){let n;return n=e instanceof Forwarder?e:new Forwarder(e,t),this._forwarders.push(n),n}removeForwarder(e){this._forwarders=this._forwarders.filter((t=>t!==e))}hasForwarder(e){return this._forwarders.includes(e)}get name(){return this._midiInput.name}get id(){return this._midiInput.id}get connection(){return this._midiInput.connection}get manufacturer(){return this._midiInput.manufacturer}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get state(){return this._midiInput.state}get type(){return this._midiInput.type}get nrpnEventsEnabled(){return wm.validation&&console.warn("The 'nrpnEventsEnabled' property has been moved to the 'InputChannel' class."),!1}}if(Utilities.isNode)try{window.navigator}catch(err){let jzz;eval('jzz = require("jzz")'),global.navigator=jzz}
/**
 * The `WebMidi` object makes it easier to work with the low-level Web MIDI API. Basically, it
 * simplifies sending outgoing MIDI messages and reacting to incoming MIDI messages.
 *
 * When using the WebMidi.js library, you should know that the `WebMidi` class has already been
 * instantiated. You cannot instantiate it yourself. If you use the **IIFE** version, you should
 * simply use the global object called `WebMidi`. If you use the **CJS** (CommonJS) or **ESM** (ES6
 * module) version, you get an already-instantiated object when you import the module.
 *
 * @fires WebMidi#connected
 * @fires WebMidi#disabled
 * @fires WebMidi#disconnected
 * @fires WebMidi#enabled
 * @fires WebMidi#error
 * @fires WebMidi#midiaccessgranted
 * @fires WebMidi#portschanged
 *
 * @extends EventEmitter
 * @license Apache-2.0
 */class WebMidi extends EventEmitter{constructor(){super(),this.defaults={note:{attack:Utilities.from7bitToFloat(64),release:Utilities.from7bitToFloat(64),duration:1/0}},this.interface=null,this.validation=!0,this._inputs=[],this._disconnectedInputs=[],this._outputs=[],this._disconnectedOutputs=[],this._stateChangeQueue=[],this._octaveOffset=0}async enable(e={},t=!1){if(this.validation=!1!==e.validation,this.validation&&("function"==typeof e&&(e={callback:e,sysex:t}),t&&(e.sysex=!0)),this.enabled)return"function"==typeof e.callback&&e.callback(),Promise.resolve();const n={timestamp:this.time,target:this,type:"error",error:void 0},r={timestamp:this.time,target:this,type:"midiaccessgranted"},a={timestamp:this.time,target:this,type:"enabled"};try{"function"==typeof e.requestMIDIAccessFunction?this.interface=await e.requestMIDIAccessFunction({sysex:e.sysex,software:e.software}):this.interface=await navigator.requestMIDIAccess({sysex:e.sysex,software:e.software})}catch(t){return n.error=t,this.emit("error",n),"function"==typeof e.callback&&e.callback(t),Promise.reject(t)}this.emit("midiaccessgranted",r),this.interface.onstatechange=this._onInterfaceStateChange.bind(this);try{await this._updateInputsAndOutputs()}catch(t){return n.error=t,this.emit("error",n),"function"==typeof e.callback&&e.callback(t),Promise.reject(t)}return this.emit("enabled",a),"function"==typeof e.callback&&e.callback(),Promise.resolve(this)}async disable(){return this._destroyInputsAndOutputs().then((()=>{navigator&&"function"==typeof navigator.close&&navigator.close(),this.interface&&(this.interface.onstatechange=void 0),this.interface=null;let e={timestamp:this.time,target:this,type:"disabled"};this.emit("disabled",e),this.removeListener()}))}getInputById(e,t={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return}if(t.disconnected){for(let t=0;t<this._disconnectedInputs.length;t++)if(this._disconnectedInputs[t].id===e.toString())return this._disconnectedInputs[t]}else for(let t=0;t<this.inputs.length;t++)if(this.inputs[t].id===e.toString())return this.inputs[t]}getInputByName(e,t={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return;e=e.toString()}if(t.disconnected){for(let t=0;t<this._disconnectedInputs.length;t++)if(~this._disconnectedInputs[t].name.indexOf(e))return this._disconnectedInputs[t]}else for(let t=0;t<this.inputs.length;t++)if(~this.inputs[t].name.indexOf(e))return this.inputs[t]}getOutputByName(e,t={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return;e=e.toString()}if(t.disconnected){for(let t=0;t<this._disconnectedOutputs.length;t++)if(~this._disconnectedOutputs[t].name.indexOf(e))return this._disconnectedOutputs[t]}else for(let t=0;t<this.outputs.length;t++)if(~this.outputs[t].name.indexOf(e))return this.outputs[t]}getOutputById(e,t={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return}if(t.disconnected){for(let t=0;t<this._disconnectedOutputs.length;t++)if(this._disconnectedOutputs[t].id===e.toString())return this._disconnectedOutputs[t]}else for(let t=0;t<this.outputs.length;t++)if(this.outputs[t].id===e.toString())return this.outputs[t]}noteNameToNumber(e){return this.validation&&console.warn("The noteNameToNumber() method is deprecated. Use Utilities.toNoteNumber() instead."),Utilities.toNoteNumber(e,this.octaveOffset)}getOctave(e){return this.validation&&(console.warn("The getOctave()is deprecated. Use Utilities.getNoteDetails() instead"),e=parseInt(e)),!isNaN(e)&&e>=0&&e<=127&&Utilities.getNoteDetails(Utilities.offsetNumber(e,this.octaveOffset)).octave}sanitizeChannels(e){return this.validation&&console.warn("The sanitizeChannels() method has been moved to the utilities class."),Utilities.sanitizeChannels(e)}toMIDIChannels(e){return this.validation&&console.warn("The toMIDIChannels() method has been deprecated. Use Utilities.sanitizeChannels() instead."),Utilities.sanitizeChannels(e)}guessNoteNumber(e){return this.validation&&console.warn("The guessNoteNumber() method has been deprecated. Use Utilities.guessNoteNumber() instead."),Utilities.guessNoteNumber(e,this.octaveOffset)}getValidNoteArray(e,t={}){return this.validation&&console.warn("The getValidNoteArray() method has been moved to the Utilities.buildNoteArray()"),Utilities.buildNoteArray(e,t)}convertToTimestamp(e){return this.validation&&console.warn("The convertToTimestamp() method has been moved to Utilities.toTimestamp()."),Utilities.toTimestamp(e)}async _destroyInputsAndOutputs(){let e=[];return this.inputs.forEach((t=>e.push(t.destroy()))),this.outputs.forEach((t=>e.push(t.destroy()))),Promise.all(e).then((()=>{this._inputs=[],this._outputs=[]}))}_onInterfaceStateChange(e){this._updateInputsAndOutputs();let t={timestamp:e.timeStamp,type:e.port.state,target:this};if("connected"===e.port.state&&"open"===e.port.connection){"output"===e.port.type?t.port=this.getOutputById(e.port.id):"input"===e.port.type&&(t.port=this.getInputById(e.port.id)),this.emit(e.port.state,t);const n=Object.assign({},t);n.type="portschanged",this.emit(n.type,n)}else if("disconnected"===e.port.state&&"pending"===e.port.connection){"input"===e.port.type?t.port=this.getInputById(e.port.id,{disconnected:!0}):"output"===e.port.type&&(t.port=this.getOutputById(e.port.id,{disconnected:!0})),this.emit(e.port.state,t);const n=Object.assign({},t);n.type="portschanged",this.emit(n.type,n)}}async _updateInputsAndOutputs(){return Promise.all([this._updateInputs(),this._updateOutputs()])}async _updateInputs(){if(!this.interface)return;for(let e=this._inputs.length-1;e>=0;e--){const t=this._inputs[e];Array.from(this.interface.inputs.values()).find((e=>e===t._midiInput))||(this._disconnectedInputs.push(t),this._inputs.splice(e,1))}let e=[];return this.interface.inputs.forEach((t=>{if(!this._inputs.find((e=>e._midiInput===t))){let n=this._disconnectedInputs.find((e=>e._midiInput===t));n||(n=new Input(t)),this._inputs.push(n),e.push(n.open())}})),Promise.all(e)}async _updateOutputs(){if(!this.interface)return;for(let e=this._outputs.length-1;e>=0;e--){const t=this._outputs[e];Array.from(this.interface.outputs.values()).find((e=>e===t._midiOutput))||(this._disconnectedOutputs.push(t),this._outputs.splice(e,1))}let e=[];return this.interface.outputs.forEach((t=>{if(!this._outputs.find((e=>e._midiOutput===t))){let n=this._disconnectedOutputs.find((e=>e._midiOutput===t));n||(n=new Output(t)),this._outputs.push(n),e.push(n.open())}})),Promise.all(e)}get enabled(){return null!==this.interface}get inputs(){return this._inputs}get isNode(){return this.validation&&console.warn("WebMidi.isNode has been deprecated. Use Utilities.isNode instead."),Utilities.isNode}get isBrowser(){return this.validation&&console.warn("WebMidi.isBrowser has been deprecated. Use Utilities.isBrowser instead."),Utilities.isBrowser}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get outputs(){return this._outputs}get supported(){return"undefined"!=typeof navigator&&navigator.requestMIDIAccess}get sysexEnabled(){return!(!this.interface||!this.interface.sysexEnabled)}get time(){return performance.now()}get version(){return"3.0.19"}get CHANNEL_EVENTS(){return this.validation&&console.warn("The CHANNEL_EVENTS enum has been moved to Enumerations.CHANNEL_EVENTS."),Enumerations.CHANNEL_EVENTS}get MIDI_SYSTEM_MESSAGES(){return this.validation&&console.warn("The MIDI_SYSTEM_MESSAGES enum has been moved to Enumerations.MIDI_SYSTEM_MESSAGES."),Enumerations.MIDI_SYSTEM_MESSAGES}get MIDI_CHANNEL_MODE_MESSAGES(){return this.validation&&console.warn("The MIDI_CHANNEL_MODE_MESSAGES enum has been moved to Enumerations.MIDI_CHANNEL_MODE_MESSAGES."),Enumerations.MIDI_CHANNEL_MODE_MESSAGES}get MIDI_CONTROL_CHANGE_MESSAGES(){return this.validation&&console.warn("The MIDI_CONTROL_CHANGE_MESSAGES enum has been moved to Enumerations.MIDI_CONTROL_CHANGE_MESSAGES."),Enumerations.MIDI_CONTROL_CHANGE_MESSAGES}get MIDI_REGISTERED_PARAMETER(){return this.validation&&console.warn("The MIDI_REGISTERED_PARAMETER enum has been moved to Enumerations.MIDI_REGISTERED_PARAMETERS."),this.MIDI_REGISTERED_PARAMETERS}get NOTES(){return this.validation&&console.warn("The NOTES enum has been deprecated."),["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"]}}const wm=new WebMidi;wm.constructor=null,exports.Enumerations=Enumerations,exports.Forwarder=Forwarder,exports.Input=Input,exports.InputChannel=InputChannel,exports.Message=Message,exports.Note=Note,exports.Output=Output,exports.OutputChannel=OutputChannel,exports.Utilities=Utilities,exports.WebMidi=wm},{}],adRuD:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"CMD_START",(()=>a)),r.export(n,"CMD_STOP",(()=>s)),r.export(n,"CMD_UPDATE",(()=>o)),r.export(n,"EVENT_READY",(()=>i)),r.export(n,"EVENT_STARTING",(()=>l)),r.export(n,"EVENT_STOPPING",(()=>c)),r.export(n,"EVENT_TICK",(()=>u)),r.export(n,"MAX_BARS_ALLOWED",(()=>d)),r.export(n,"isAvailable",(()=>I)),r.export(n,"now",(()=>x)),r.export(n,"elapsed",(()=>S)),r.export(n,"convertBPMToPeriod",(()=>N)),r.export(n,"getTimePerBar",(()=>_)),r.export(n,"getTotalTime",(()=>T)),r.export(n,"getBar",(()=>M)),r.export(n,"getBars",(()=>A)),r.export(n,"getBarProgress",(()=>C)),r.export(n,"setBars",(()=>k)),r.export(n,"getMicroTempo",(()=>O)),r.export(n,"getMicrosPerMIDIClock",(()=>R)),r.export(n,"getBPM",(()=>L)),r.export(n,"setBPM",(()=>D)),r.export(n,"setTimeBetween",(()=>P)),r.export(n,"startTimer",(()=>j)),r.export(n,"stopTimer",(()=>B)),r.export(n,"tapTempo",(()=>F));const a="start",s="stop",o="update",i="ready",l="starting",c="stopping",u="tick",d=32,h=window.AudioContext||window.webkitAudioContext;let p,m=-1,f=100,g=null,v=!1,y=!0,b=0,E=16,w=0;try{p=new Worker(e("eef8a62b03b21459"))}catch(e){y=!1}const I=()=>y,x=()=>g.currentTime,S=()=>.001*(x()-m),N=e=>6e4/e,_=()=>f,T=()=>f*E,M=()=>b,A=()=>E,C=()=>b/E,k=e=>(E=e<1?1:e>d?d:e,E),O=()=>.001*_(),R=()=>O()/24,L=()=>6e4/_(),D=e=>P(N(e)),P=e=>(f=e,p.postMessage({command:o,interval:f,time:x()}),f),j=(e,t=200,n={})=>(w=0,null===g&&(g=new h,"suspended"===g.state&&g.resume()),f=t,p.onmessage=n=>{const r=x(),a=n.data;switch(a.event){case l:m=r,v=!0;break;case u:const s=a.intervals,o=s*t*.001,i=r-m,c=a.time,d=c%t*.001,h=c-i,p=Math.floor(c/t);b=++w%E,e&&e({bar:b,bars:E,barsElapsed:w,timePassed:c,elapsed:i,expected:o,drift:h,level:p,intervals:s,lag:d});break;default:console.log("message: ",n)}},p.onerror=e=>{console.error("error...",{error:e}),p.postMessage({error:e,time:g.currentTime})},p.postMessage({command:a,time:g.currentTime,interval:t,accurateTiming:!1}),{currentTime:x(),timingWorker:p}),B=()=>{const e=x();return p.onmessage=e=>{if(e.event===c)v=!1,g=null},p.postMessage({command:s,time:e}),{currentTime:e,timingWorker:p}};let U=[];const F=(e=!0,t=1e4,n=2)=>{const r=x();e&&U.length>0&&r-U[U.length-1]>t&&(U=[]),U.push(r);const a=U.length,s=a-1,o=U[s]-U[0];if(a>=n){return o/s}return-1}},{eef8a62b03b21459:"bPCLq","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],bPCLq:[function(e,t,n){let r=e("./helpers/get-worker-url"),a=e("./helpers/bundle-url"),s=a.getBundleURL("kPWjp")+e("./helpers/bundle-manifest").resolve("1XLIV");t.exports=r(s,a.getOrigin(s),!1)},{"./helpers/get-worker-url":"5Byxz","./helpers/bundle-url":"bGZ1f","./helpers/bundle-manifest":"6jNRu"}],"5Byxz":[function(e,t,n){"use strict";t.exports=function(e,t,n){if(t===self.location.origin)return e;var r=n?"import "+JSON.stringify(e)+";":"importScripts("+JSON.stringify(e)+");";return URL.createObjectURL(new Blob([r],{type:"application/javascript"}))}},{}],bGZ1f:[function(e,t,n){"use strict";var r={};function a(e){return(""+e).replace(/^((?:https?|file|ftp|(chrome|moz)-extension):\/\/.+)\/[^/]+$/,"$1")+"/"}n.getBundleURL=function(e){var t=r[e];return t||(t=function(){try{throw new Error}catch(t){var e=(""+t.stack).match(/(https?|file|ftp|(chrome|moz)-extension):\/\/[^)\n]+/g);if(e)return a(e[2])}return"/"}(),r[e]=t),t},n.getBaseURL=a,n.getOrigin=function(e){var t=(""+e).match(/(https?|file|ftp|(chrome|moz)-extension):\/\/[^/]+/);if(!t)throw new Error("Origin not found");return t[0]}},{}],"4s9sC":[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"createPattern",(()=>a)),r.export(n,"factory",(()=>s)),r.export(n,"pattern",(()=>o)),r.export(n,"kickSequence",(()=>d)),r.export(n,"snareSequence",(()=>h)),r.export(n,"hatSequence",(()=>p)),r.export(n,"kitSequence",(()=>m)),r.export(n,"combinePatternWithInstrument",(()=>f)),r.export(n,"playNextPart",(()=>g));const a=(e,t=16)=>{new Array},s=(e=16)=>new Array(4*e).fill(0),o=(e,t=0)=>{let n=t;const r=e.length-1;return{reset:()=>(n=0,e[n]),previous:()=>{const t=n-1;return n=t<0?r:t,e[n]},next:()=>{const t=n+1;return n=t>r?0:t,e[n]},position:t=>e[t],length:e.length,current:()=>e[n],set:t=>e=t}},i=[[255,0,0,0,255,0,0,0,255,0,0,0,255,0,0,0]],l=[[0,0,255,0,0,0,255,0,0,0,255,0,0,0,255,0]],c=new Array(16).map((e=>255*e/16)),u=[[255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0]],d=o(i[0]),h=o(l[0]),p=o(u[0]),m=()=>({kick:o(i[0]),hat:o(u[0]),snare:o(l[0]),roll:o(c)}),f=(e,t)=>{},g=(e,t,...n)=>{const r=e.next();return r>0&&(t(r,...n),!0)}},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],dAURW:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"buttonQuantise",(()=>p)),r.export(n,"buttonVideo",(()=>m)),r.export(n,"controls",(()=>f)),r.export(n,"video",(()=>v)),r.export(n,"isVisible",(()=>y)),r.export(n,"setVisibility",(()=>b)),r.export(n,"toggleVisibility",(()=>E)),r.export(n,"isVideoVisible",(()=>w)),r.export(n,"toggleVideoVisiblity",(()=>I)),r.export(n,"setControls",(()=>x)),r.export(n,"setupCameraForm",(()=>S)),r.export(n,"setupInstrumentForm",(()=>N)),r.export(n,"updateTempo",(()=>_)),r.export(n,"showPlayerSelector",(()=>T)),r.export(n,"setupInterface",(()=>M)),r.export(n,"focusApp",(()=>A));var a=e("../audio/instruments"),s=e("./full-screen"),o=e("../location-handler"),i=e("../models/info"),l=e("./toggle"),c=e("./select");const u=document;let d,h,p,m,f;const g=u.querySelector("main"),v=u.querySelector("video"),y=e=>"hidden"!==e.style.visibility,b=(e,t)=>(e.style.visibility=t?"hidden":"visible",y(e)),E=e=>{const t=y(e);return b(e,!t),y(e)},w=()=>y(v),I=e=>{const t=b(v,e||!w());console.error("toggling video vis",{value:e,currentlyVisible:t})},x=(e,t="person-a-controls")=>{u.getElementById(t).appendChild(e)},S=(e,t)=>{const n=u.getElementById("camera").querySelector("#camera select"),r=e.map(((e,t)=>`<option value="${e.deviceId}">${e.label}</option>`));n.innerHTML=`<optgroup label="Detected Cameras">${r.join("")}</optgroup>`,c.connectSelect(n,t)},N=e=>{const t=a.INSTRUMENT_FOLDERS.map(((e,t)=>`<label for="${e}">${a.INSTRUMENT_NAMES[t]}<input id="${e}" name="instrument-selector" type="radio" value="${e}"></input></label>`));return t.unshift("<legend>Select an instrument</legend>"),`${t.join("")}`},_=e=>{const t=u.getElementById("input-tempo");t&&t.setAttribute("value",e),console.log("Setting tempo",e)},T=e=>new Promise(((t,n)=>{const r="player-selection",a=u.getElementById("onboard"),s=u.getElementById("player-selector"),o=s.querySelector("#button-solo"),i=s.querySelector("#button-duet"),l=s.querySelector("#button-trio"),c=(u.getElementById("button-start"),s.querySelector("#toggle-advanced-mode"));let d=e.advancedMode||!1,h=e.duet?2:1;c.setAttribute("checked",!d),u.documentElement.classList.toggle(r,!0);const p=e=>{h=e,u.documentElement.classList.remove("solo","duet"),u.documentElement.classList.add(1===h?"solo":"duet")};o.addEventListener("click",(e=>p(1))),i.addEventListener("click",(e=>p(2))),l.addEventListener("click",(e=>p(3))),c.addEventListener("change",(e=>{d=!d,g.classList.toggle("beginner",!d)})),a.addEventListener("submit",(e=>{var n;return e.preventDefault(),(n=h)<2?(o.classList.toggle("hide",!0),i.classList.toggle("hide",!1),g.classList.add("solo")):(i.classList.toggle("hide",!0),o.classList.toggle("hide",!1),g.classList.add("duet")),s.classList.add("completed"),u.documentElement.classList.toggle(r,!0),setTimeout((()=>{u.documentElement.classList.toggle("advanced",d),u.documentElement.classList.toggle(r,!1),s.classList.remove("completed")}),45),t({players:n,advancedMode:d}),!1}),!0),g.classList.toggle("beginner",!d),p(h),s.focus()})),M=e=>{u.querySelector("h1");const t=u.getElementById("share"),n=u.querySelector("share-menu");if(n.url=o.getShareLink(e),t.addEventListener("mousedown",(t=>{n.setAttribute("url",o.getShareLink(e)),console.error("SHARING",{shareElement:n,url:n.url})}),!1),f=u.getElementById("controls"),d=u.getElementById("button-instrument"),m=u.getElementById("button-video"),h=u.getElementById("button-record"),p=u.getElementById("button-quantise"),s.canFullscreen()){const t=l.setToggle("button-fullscreen",(n=>{e.fullscreen=s.toggleFullScreen(),t.classList.toggle("fs",e.fullscreen)}),!1)}else u.getElementById("button-fullscreen").classList.toggle("hide",!0);const r=u.getElementById("version"),a=r.innerHTML;r.innerHTML=`${a} <span id="release">${i.formattedDate}</span>`,f.addEventListener("submit",(e=>{e.preventDefault()}),!0)},A=()=>{}},{"../audio/instruments":"ftlvJ","./full-screen":"ebc87","../location-handler":"6ch5Y","../models/info":"dytk0","./toggle":"f71P0","./select":"cBFxP","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],ebc87:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"canFullscreen",(()=>a)),r.export(n,"exitFullscreen",(()=>s)),r.export(n,"goFullscreen",(()=>o)),r.export(n,"toggleFullScreen",(()=>i));const a=()=>document.fullscreenEnabled||document.mozFullScreenEnabled||document.documentElement.webkitRequestFullScreen,s=()=>{document.exitFullscreen()},o=e=>{a()&&document.documentElement.requestFullscreen()},i=()=>document.fullscreenElement?(document.exitFullscreen&&s(),!1):(o(),!0)},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],dytk0:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"formattedDate",(()=>o));var a=e("../version");const s=new Date(a.DATE),o=`${s.getDate()}/${s.getMonth()+1}/${s.getFullYear()} ${s.toLocaleTimeString("en-GB",{hour12:!0,hour:"numeric",minute:"numeric"})}`},{"../version":"98oCg","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"98oCg":[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"VERSION",(()=>a)),r.export(n,"DATE",(()=>s));const a="0.8.1",s=1651576401100},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],f71P0:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"setToggle",(()=>s));var a=e("./button");const s=(e,t,n)=>{const r=a.setButton(e,(()=>{n=!n,"LABEL"===r.parentNode.nodeName&&r.parentNode.classList.toggle("checked",n),t(n)}));return n&&(r.setAttribute("checked",n),r.parentNode.classList.toggle("checked",n)),r}},{"./button":"6WDhH","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"6WDhH":[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"setButton",(()=>i)),r.export(n,"showReloadButton",(()=>l)),r.export(n,"createInstallButton",(()=>c)),r.export(n,"showUpdateButton",(()=>u)),r.export(n,"setupMIDIButton",(()=>d));var a=e("./text"),s=e("../version"),o=e("../models/info");const i=(e,t)=>{const n=document.getElementById(e);return!!n&&(n.addEventListener("click",(e=>{t&&t({element:n})})),n)},l=()=>{},c=e=>{const t=`Click to install ${e.short_name} V-${s.VERSION.replaceAll(".","-")}<br>Date:${o.formattedDate}`,n=document.createElement("button");return n.id="button-install",n.classList.add("install-app"),n.setAttribute("aria-label",t),n.style.setProperty("--logo",`url(${e.icons[0].src})`),n.innerHTML="Install",a.addTooltip(n),n},u=(e,t)=>{const n=doc.createElement("button");n.id="button-update",n.setAttribute("aria-label","Update to new version"),n.classList.add("update-available"),n.innerHTML="Update",n.addEventListener("click",(()=>t())),e.appendChild(n)},d=(e,t)=>{let n=!1;return e.addEventListener("mousedown",(async e=>(e.preventDefault(),t&&t(),n=!0,!1)),{once:!0}),{setText:t=>e.innerHTML=t,setLabel:t=>e.setAttribute("aria-label",t)}}},{"./text":"cwBIr","../version":"98oCg","../models/info":"dytk0","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],cwBIr:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"bindTextElement",(()=>s)),r.export(n,"setFeedback",(()=>o)),r.export(n,"setToast",(()=>l)),r.export(n,"addTooltip",(()=>u)),r.export(n,"addToolTips",(()=>d));var a=e("../utils");const s=(e,t=700,n=0,r=!1)=>{let s=null,o=-1,i=-1,l=null;const c=a.debounce((t=>{e.innerHTML=t}),t);return e?(a,u=t)=>{r&&(a=a.split(/!|\./i).join("<br>")),l=a,""!==e.innerHTML&&s==a||(clearTimeout(i),s=a,0===u?(clearTimeout(o),e.innerHTML=a):o=c(a),n>0&&(i=(t=>{const r=n*t;return i=setTimeout((()=>{e.innerHTML=""}),r),r})(a.length)))}:null},o=s(document.getElementById("feedback"),20),i=document.getElementById("toast"),l=((e,t=6,n=550)=>{let r="",a=null,s=!1,o=!1;return e?(i,l=t)=>{if(o=!1,i===r)return;clearInterval(a),r=i;const c=(t=0,r=1)=>{const l=i.slice(0,t);if(s=!0,e.innerHTML=l,t<i.length)requestAnimationFrame((()=>c(t+r,r)));else{s=!1;const t=n*i.length;a=setTimeout((()=>{e.innerHTML="",o=!0}),t)}};l<1?c(i.length,10):c(s?r.length:0,l)}:null})(i),c=e=>{i.setAttribute("style",`--left: ${e.offsetLeft}; \n\t\t --top: ${e.offsetTop};`)},u=e=>e.addEventListener("mouseover",(e=>{const t=e.target.getAttribute("aria-label")||e.target.innerHTML;"BUTTON"===e.target.nodeName?c(e.target):c(e.target.parentElement),l(t)})),d=(e,t="button, select, input")=>{e.querySelectorAll(t).forEach((e=>u(e)))}},{"../utils":"9g7cm","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],cBFxP:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"connectSelect",(()=>o)),r.export(n,"connectPaletteSelector",(()=>i)),r.export(n,"connectReverbSelector",(()=>l)),r.export(n,"connectTempoControls",(()=>c)),r.export(n,"connectReverbControls",(()=>u));var a=e("./ui"),s=e("../audio/effects/reverb");const o=async(e,t)=>{const n="string"==typeof e?document.getElementById(e):e;if(!n)throw Error("No element found with that spec");return n.addEventListener("change",(e=>{const r=n.options[n.selectedIndex||n.options.selectedIndex];t&&t(r),e.preventDefault()})),n},i=e=>o("select-palette",e),l=e=>o("select-impulse",e),c=e=>{o("select-tempo",(t=>{const n=parseInt(t.innerHTML);a.updateTempo(n),e&&e(n)}))},u=e=>{const t="select-impulse",n=s.DIRS,r=document.getElementById(t);if(r){const e=(e,t)=>e.map((e=>{const t=e=e.trim(),n=e.substring(e.lastIndexOf("/")+1);return`<option value="${t}">${n.substring(0,n.lastIndexOf("."))}</option>`})).join("\n"),t=n.map((async t=>{const n=await s.loadImpulseJSON(t);return`<optgroup>${t}</optgroup>${e(n,t)}`}));Promise.all(t).then((e=>{r.innerHTML=e.join("")}))}else console.error("Injecting impulse FAILED to ",{options:r,impulseList:impulseList});return o(t,(t=>e&&e(t)))}},{"./ui":"dAURW","../audio/effects/reverb":"7szM4","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],l66Iq:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n);var a=e("dialog-polyfill"),s=r.interopDefault(a);const o=new Event("closing"),i=new Event("closed"),l=new Event("opening"),c=new Event("opened"),u=new Event("removed"),d=new MutationObserver(((e,t)=>{e.forEach((async e=>{if("open"===e.attributeName){const t=e.target;if(!t.hasAttribute("open"))return;t.removeAttribute("inert");const n=t.querySelector("[autofocus]");n?n.focus():t.querySelector("button").focus(),t.dispatchEvent(l),await p(t),t.dispatchEvent(c)}}))})),h=new MutationObserver(((e,t)=>{e.forEach((e=>{e.removedNodes.forEach((e=>{"DIALOG"===e.nodeName&&(dialog.removeEventListener("click",m),dialog.removeEventListener("close",f),e.dispatchEvent(u))}))}))})),p=e=>Promise.allSettled(e.getAnimations().map((e=>e.finished))),m=({target:e})=>{"DIALOG"===e.nodeName&&e.close("dismiss")},f=async({target:e})=>{e.setAttribute("inert",""),e.dispatchEvent(o),await p(e),e.dispatchEvent(i)},g=({target:e})=>{console.log("Dialog closing",e)},v=({target:e})=>{console.log("Dialog closed",e),console.info("Dialog user action:",e.returnValue),e.returnValue},y=({target:e})=>{console.log("Dialog open",e)},b=({target:e})=>{console.log("Dialog opening",e)},E=({target:e})=>{e.removeEventListener("closing",g),e.removeEventListener("closed",v),e.removeEventListener("opening",b),e.removeEventListener("opened",y),e.removeEventListener("removed",E)};n.default=()=>{document.querySelectorAll("dialog").forEach((e=>{s.default.registerDialog(e),(async e=>{e.addEventListener("click",m),e.addEventListener("close",f),d.observe(e,{attributes:!0}),h.observe(document.body,{attributes:!1,subtree:!1,childList:!0}),await p(e),e.removeAttribute("loading")})(e),e.addEventListener("closing",g),e.addEventListener("closed",v),e.addEventListener("opening",b),e.addEventListener("opened",y),e.addEventListener("removed",E)}))}},{"dialog-polyfill":"8cLAB","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"8cLAB":[function(e,t,n){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(n);var r=window.CustomEvent;function a(e,t){var n="on"+t.type.toLowerCase();return"function"==typeof e[n]&&e[n](t),e.dispatchEvent(t)}function s(e){for(;e;){if("dialog"===e.localName)return e;e=e.parentElement?e.parentElement:e.parentNode?e.parentNode.host:null}return null}function o(e){for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;e&&e.blur&&e!==document.body&&e.blur()}function i(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1}function l(e){return!(!e||!e.hasAttribute("method"))&&"dialog"===e.getAttribute("method").toLowerCase()}function c(e){var t=["button","input","keygen","select","textarea"].map((function(e){return e+":not([disabled])"}));t.push('[tabindex]:not([disabled]):not([tabindex=""])');var n=e.querySelector(t.join(", "));if(!n&&"attachShadow"in Element.prototype)for(var r=e.querySelectorAll("*"),a=0;a<r.length&&!(r[a].tagName&&r[a].shadowRoot&&(n=c(r[a].shadowRoot)));a++);return n}function u(e){return e.isConnected||document.body.contains(e)}function d(e){if(e.submitter)return e.submitter;var t=e.target;if(!(t instanceof HTMLFormElement))return null;var n=m.formSubmitter;if(!n){var r=e.target;n=("getRootNode"in r&&r.getRootNode()||document).activeElement}return n&&n.form===t?n:null}function h(e){if(!e.defaultPrevented){var t=e.target,n=m.imagemapUseValue,r=d(e);null===n&&r&&(n=r.value);var a=s(t);if(a)"dialog"===(r&&r.getAttribute("formmethod")||t.getAttribute("method"))&&(e.preventDefault(),null!=n?a.close(n):a.close())}}function p(e){if(this.dialog_=e,this.replacedStyleTop_=!1,this.openAsModal_=!1,e.hasAttribute("role")||e.setAttribute("role","dialog"),e.show=this.show.bind(this),e.showModal=this.showModal.bind(this),e.close=this.close.bind(this),e.addEventListener("submit",h,!1),"returnValue"in e||(e.returnValue=""),"MutationObserver"in window){new MutationObserver(this.maybeHideModal.bind(this)).observe(e,{attributes:!0,attributeFilter:["open"]})}else{var t,n=!1,r=function(){n?this.downgradeModal():this.maybeHideModal(),n=!1}.bind(this),a=function(a){if(a.target===e){var s="DOMNodeRemoved";n|=a.type.substr(0,s.length)===s,window.clearTimeout(t),t=window.setTimeout(r,0)}};["DOMAttrModified","DOMNodeRemoved","DOMNodeRemovedFromDocument"].forEach((function(t){e.addEventListener(t,a)}))}Object.defineProperty(e,"open",{set:this.setOpen.bind(this),get:e.hasAttribute.bind(e,"open")}),this.backdrop_=document.createElement("div"),this.backdrop_.className="backdrop",this.backdrop_.addEventListener("mouseup",this.backdropMouseEvent_.bind(this)),this.backdrop_.addEventListener("mousedown",this.backdropMouseEvent_.bind(this)),this.backdrop_.addEventListener("click",this.backdropMouseEvent_.bind(this))}r&&"object"!=typeof r||((r=function(e,t){t=t||{};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!!t.bubbles,!!t.cancelable,t.detail||null),n}).prototype=window.Event.prototype),p.prototype={get dialog(){return this.dialog_},maybeHideModal:function(){this.dialog_.hasAttribute("open")&&u(this.dialog_)||this.downgradeModal()},downgradeModal:function(){this.openAsModal_&&(this.openAsModal_=!1,this.dialog_.style.zIndex="",this.replacedStyleTop_&&(this.dialog_.style.top="",this.replacedStyleTop_=!1),this.backdrop_.parentNode&&this.backdrop_.parentNode.removeChild(this.backdrop_),m.dm.removeDialog(this))},setOpen:function(e){e?this.dialog_.hasAttribute("open")||this.dialog_.setAttribute("open",""):(this.dialog_.removeAttribute("open"),this.maybeHideModal())},backdropMouseEvent_:function(e){if(this.dialog_.hasAttribute("tabindex"))this.dialog_.focus();else{var t=document.createElement("div");this.dialog_.insertBefore(t,this.dialog_.firstChild),t.tabIndex=-1,t.focus(),this.dialog_.removeChild(t)}var n=document.createEvent("MouseEvents");n.initMouseEvent(e.type,e.bubbles,e.cancelable,window,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget),this.dialog_.dispatchEvent(n),e.stopPropagation()},focus_:function(){var e=this.dialog_.querySelector("[autofocus]:not([disabled])");!e&&this.dialog_.tabIndex>=0&&(e=this.dialog_),e||(e=c(this.dialog_)),o(document.activeElement),e&&e.focus()},updateZIndex:function(e,t){if(e<t)throw new Error("dialogZ should never be < backdropZ");this.dialog_.style.zIndex=e,this.backdrop_.style.zIndex=t},show:function(){this.dialog_.open||(this.setOpen(!0),this.focus_())},showModal:function(){if(this.dialog_.hasAttribute("open"))throw new Error("Failed to execute 'showModal' on dialog: The element is already open, and therefore cannot be opened modally.");if(!u(this.dialog_))throw new Error("Failed to execute 'showModal' on dialog: The element is not in a Document.");if(!m.dm.pushDialog(this))throw new Error("Failed to execute 'showModal' on dialog: There are too many open modal dialogs.");(function(e){for(;e&&e!==document.body;){var t=window.getComputedStyle(e),n=function(e,n){return!(void 0===t[e]||t[e]===n)};if(t.opacity<1||n("zIndex","auto")||n("transform","none")||n("mixBlendMode","normal")||n("filter","none")||n("perspective","none")||"isolate"===t.isolation||"fixed"===t.position||"touch"===t.webkitOverflowScrolling)return!0;e=e.parentElement}return!1})(this.dialog_.parentElement)&&console.warn("A dialog is being shown inside a stacking context. This may cause it to be unusable. For more information, see this link: https://github.com/GoogleChrome/dialog-polyfill/#stacking-context"),this.setOpen(!0),this.openAsModal_=!0,m.needsCentering(this.dialog_)?(m.reposition(this.dialog_),this.replacedStyleTop_=!0):this.replacedStyleTop_=!1,this.dialog_.parentNode.insertBefore(this.backdrop_,this.dialog_.nextSibling),this.focus_()},close:function(e){if(!this.dialog_.hasAttribute("open"))throw new Error("Failed to execute 'close' on dialog: The element does not have an 'open' attribute, and therefore cannot be closed.");this.setOpen(!1),void 0!==e&&(this.dialog_.returnValue=e);var t=new r("close",{bubbles:!1,cancelable:!1});a(this.dialog_,t)}};var m={reposition:function(e){var t=document.body.scrollTop||document.documentElement.scrollTop,n=t+(window.innerHeight-e.offsetHeight)/2;e.style.top=Math.max(t,n)+"px"},isInlinePositionSetByStylesheet:function(e){for(var t=0;t<document.styleSheets.length;++t){var n=document.styleSheets[t],r=null;try{r=n.cssRules}catch(e){}if(r)for(var a=0;a<r.length;++a){var s=r[a],o=null;try{o=document.querySelectorAll(s.selectorText)}catch(e){}if(o&&i(o,e)){var l=s.style.getPropertyValue("top"),c=s.style.getPropertyValue("bottom");if(l&&"auto"!==l||c&&"auto"!==c)return!0}}}return!1},needsCentering:function(e){return"absolute"===window.getComputedStyle(e).position&&(!("auto"!==e.style.top&&""!==e.style.top||"auto"!==e.style.bottom&&""!==e.style.bottom)&&!m.isInlinePositionSetByStylesheet(e))},forceRegisterDialog:function(e){if((window.HTMLDialogElement||e.showModal)&&console.warn("This browser already supports <dialog>, the polyfill may not work correctly",e),"dialog"!==e.localName)throw new Error("Failed to register dialog: The element is not a dialog.");new p(e)},registerDialog:function(e){e.showModal||m.forceRegisterDialog(e)},DialogManager:function(){this.pendingDialogStack=[];var e=this.checkDOM_.bind(this);this.overlay=document.createElement("div"),this.overlay.className="_dialog_overlay",this.overlay.addEventListener("click",function(t){this.forwardTab_=void 0,t.stopPropagation(),e([])}.bind(this)),this.handleKey_=this.handleKey_.bind(this),this.handleFocus_=this.handleFocus_.bind(this),this.zIndexLow_=1e5,this.zIndexHigh_=100150,this.forwardTab_=void 0,"MutationObserver"in window&&(this.mo_=new MutationObserver((function(t){var n=[];t.forEach((function(e){for(var t,r=0;t=e.removedNodes[r];++r)t instanceof Element&&("dialog"===t.localName&&n.push(t),n=n.concat(t.querySelectorAll("dialog")))})),n.length&&e(n)})))}};if(m.DialogManager.prototype.blockDocument=function(){document.documentElement.addEventListener("focus",this.handleFocus_,!0),document.addEventListener("keydown",this.handleKey_),this.mo_&&this.mo_.observe(document,{childList:!0,subtree:!0})},m.DialogManager.prototype.unblockDocument=function(){document.documentElement.removeEventListener("focus",this.handleFocus_,!0),document.removeEventListener("keydown",this.handleKey_),this.mo_&&this.mo_.disconnect()},m.DialogManager.prototype.updateStacking=function(){for(var e,t=this.zIndexHigh_,n=0;e=this.pendingDialogStack[n];++n)e.updateZIndex(--t,--t),0===n&&(this.overlay.style.zIndex=--t);var r=this.pendingDialogStack[0];r?(r.dialog.parentNode||document.body).appendChild(this.overlay):this.overlay.parentNode&&this.overlay.parentNode.removeChild(this.overlay)},m.DialogManager.prototype.containedByTopDialog_=function(e){for(;e=s(e);){for(var t,n=0;t=this.pendingDialogStack[n];++n)if(t.dialog===e)return 0===n;e=e.parentElement}return!1},m.DialogManager.prototype.handleFocus_=function(e){var t=e.composedPath?e.composedPath()[0]:e.target;if(!this.containedByTopDialog_(t)&&document.activeElement!==document.documentElement&&(e.preventDefault(),e.stopPropagation(),o(t),void 0!==this.forwardTab_)){var n=this.pendingDialogStack[0];return n.dialog.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_PRECEDING&&(this.forwardTab_?n.focus_():t!==document.documentElement&&document.documentElement.focus()),!1}},m.DialogManager.prototype.handleKey_=function(e){if(this.forwardTab_=void 0,27===e.keyCode){e.preventDefault(),e.stopPropagation();var t=new r("cancel",{bubbles:!1,cancelable:!0}),n=this.pendingDialogStack[0];n&&a(n.dialog,t)&&n.dialog.close()}else 9===e.keyCode&&(this.forwardTab_=!e.shiftKey)},m.DialogManager.prototype.checkDOM_=function(e){this.pendingDialogStack.slice().forEach((function(t){-1!==e.indexOf(t.dialog)?t.downgradeModal():t.maybeHideModal()}))},m.DialogManager.prototype.pushDialog=function(e){var t=(this.zIndexHigh_-this.zIndexLow_)/2-1;return!(this.pendingDialogStack.length>=t)&&(1===this.pendingDialogStack.unshift(e)&&this.blockDocument(),this.updateStacking(),!0)},m.DialogManager.prototype.removeDialog=function(e){var t=this.pendingDialogStack.indexOf(e);-1!==t&&(this.pendingDialogStack.splice(t,1),0===this.pendingDialogStack.length&&this.unblockDocument(),this.updateStacking())},m.dm=new m.DialogManager,m.formSubmitter=null,m.imagemapUseValue=null,void 0===window.HTMLDialogElement){var f=document.createElement("form");if(f.setAttribute("method","dialog"),"dialog"!==f.method){var g=Object.getOwnPropertyDescriptor(HTMLFormElement.prototype,"method");if(g){var v=g.get;g.get=function(){return l(this)?"dialog":v.call(this)};var y=g.set;g.set=function(e){return"string"==typeof e&&"dialog"===e.toLowerCase()?this.setAttribute("method",e):y.call(this,e)},Object.defineProperty(HTMLFormElement.prototype,"method",g)}}document.addEventListener("click",(function(e){if(m.formSubmitter=null,m.imagemapUseValue=null,!e.defaultPrevented){var t=e.target;if("composedPath"in e)t=e.composedPath().shift()||t;if(t&&l(t.form)){if(!("submit"===t.type&&["button","input"].indexOf(t.localName)>-1)){if("input"!==t.localName||"image"!==t.type)return;m.imagemapUseValue=e.offsetX+","+e.offsetY}s(t)&&(m.formSubmitter=t)}}}),!1),document.addEventListener("submit",(function(e){var t=e.target;if(!s(t)){var n=d(e);"dialog"===(n&&n.getAttribute("formmethod")||t.getAttribute("method"))&&e.preventDefault()}}));var b=HTMLFormElement.prototype.submit;HTMLFormElement.prototype.submit=function(){if(!l(this))return b.call(this);var e=s(this);e&&e.close()}}n.default=m},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"9dSnZ":[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"showError",(()=>a));const a=(e,t,n=!1)=>{console.error("Could not load",e),console.warn("Consider:",t)}},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],iSXnP:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"setLoadProgress",(()=>c)),r.export(n,"getLoadProgress",(()=>u));const a=document;let s=0;const o=["Please wait","Loading.","Loading..","Loading...","Almost done!"],i=a.getElementById("progress-bar"),l=a.querySelector("progress"),c=(e,t)=>{s=e,l.setAttribute("value",parseInt(e)),t&&t.length||(t=o[Math.ceil(e*(o.length-1))]),i.innerHTML!==t&&(i.innerHTML=t)},u=()=>s},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],h5wXQ:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"createPhotographElement",(()=>i)),r.export(n,"appendPhotographElement",(()=>l));var a=e("../timing/timing.js"),s=e("../visual/canvas"),o=e("../visual/2d");const i=()=>{const e=Math.ceil(1e7*a.now()),t=`photograph-${e}`,n=s.getCanvasDimensions(),r=new Image;r.src=o.takePhotograph(),r.alt="Photograph taken "+Date.now().toString(),r.width=n.width,r.height=n.height;const i=document.createElement("a");return i.href=r.src,i.innerHTML="Click to download this photograph",i.id=t,i.download=`snapshot-${e}.png`,i.appendChild(r),i},l=()=>{const e=i();document.getElementById("photographs").appendChild(e),requestAnimationFrame((()=>document.getElementById(e.id).scrollIntoView()))}},{"../timing/timing.js":"adRuD","../visual/canvas":"2h2QK","../visual/2d":"2Ac2W","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"2h2QK":[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"canvas",(()=>a)),r.export(n,"canvasContext",(()=>s)),r.export(n,"updateCanvasSize",(()=>l)),r.export(n,"getCanvasDimensions",(()=>c)),r.export(n,"clear",(()=>u)),r.export(n,"overdraw",(()=>d)),r.export(n,"copyCanvasToClipboard",(()=>h)),r.export(n,"drawElement",(()=>p));const a=document.querySelector("canvas"),s=a.getContext("2d");let o=a.width,i=a.height;const l=(e,t)=>{o=e??a.width,i=t??a.height},c=()=>({width:o,height:i}),u=()=>{s.clearRect(0,0,o,i)},d=(e=0,t=-1)=>{s.save(),s.drawImage(a,e,t),s.restore()},h=async()=>a.toBlob((async e=>{await navigator.clipboard.write([new ClipboardItem({[e.type]:e})])})),p=e=>{s.save(),s.translate(o,0),s.scale(-1,1),s.drawImage(e,0,0),s.restore()}},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"2Ac2W":[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"takePhotograph",(()=>u)),r.export(n,"drawShapeByIndexes",(()=>d)),r.export(n,"drawPart",(()=>h)),r.export(n,"drawTriangle",(()=>p)),r.export(n,"drawNode",(()=>m)),r.export(n,"drawText",(()=>f)),r.export(n,"drawParagraph",(()=>g)),r.export(n,"drawInstrument",(()=>v)),r.export(n,"drawBoundingBox",(()=>y)),r.export(n,"setNodeCount",(()=>E)),r.export(n,"drawPoints",(()=>x)),r.export(n,"drawFaceMesh",(()=>S)),r.export(n,"drawFace",(()=>N));var a=e("../maths/maths"),s=e("../palette"),o=r.interopDefault(s),i=e("./canvas"),l=e("../maths/easing"),c=e("../models/face-mesh-model");const u=(e="image/png")=>i.canvas.toDataURL(e),d=(e,t,n=2,r="red",a=!0,s=!0)=>{i.canvasContext.fillStyle=r,i.canvasContext.strokeStyle=r,i.canvasContext.moveTo(e[t[0]][0],e[t[0]][1]),i.canvasContext.beginPath();for(let n=1,r=t.length;n<r;n++)i.canvasContext.lineTo(e[t[n]][0],e[t[n]][1]);i.canvasContext.closePath(),s&&i.canvasContext.fill(),a&&i.canvasContext.stroke()},h=(e,t=2,n="red",r=!0,s=!0,l=!1)=>{i.canvasContext.fillStyle=n,i.canvasContext.strokeStyle=n,i.canvasContext.moveTo(e[0][0],e[0][1]),i.canvasContext.beginPath();for(let n=0,s=e.length;n<s;n++){const s=e[n][0],o=e[n][1];i.canvasContext.arc(s,o,t,0,a.TAU),r&&i.canvasContext.lineTo(s,o)}if(s&&i.canvasContext.fill(),r&&i.canvasContext.stroke(),l)for(let t=0,n=e.length;t<n;t+=2){const n=e[t][0],r=e[t][1];i.canvasContext.stroke(),i.canvasContext.font="18px Oxanium",i.canvasContext.textAlign="center",i.canvasContext.fillStyle=o.default.dark,i.canvasContext.fillText(`#${t}`,n,r)}},p=(e,t,n,r,a,s,o,l=1)=>{i.canvasContext.beginPath(),i.canvasContext.lineWidth=l,i.canvasContext.strokeStyle=o,i.canvasContext.moveTo(e,t),i.canvasContext.lineTo(n,r),i.canvasContext.lineTo(a,s),i.canvasContext.closePath(),i.canvasContext.stroke()},m=(e,t,n=5,r="blue")=>{i.canvasContext.fillStyle=r,i.canvasContext.beginPath(),i.canvasContext.arc(t[0],t[1],n,0,a.TAU),i.canvasContext.fill(),i.canvasContext.beginPath(),i.canvasContext.arc(e[0],e[1],n,0,a.TAU),i.canvasContext.fill(),i.canvasContext.beginPath(),i.canvasContext.moveTo(e[0],e[1]),i.canvasContext.strokeStyle=o.default.orange,i.canvasContext.fillStyle=o.default.orange,i.canvasContext.lineTo(t[0],t[1])},f=(e,t,n="",r="10px",a="center")=>{i.canvasContext.font=`900 ${r} Oxanium`,i.canvasContext.textAlign=a,i.canvasContext.fillStyle=o.default.white,i.canvasContext.strokeStyle=o.default.dark,i.canvasContext.strokeText(`${n}`,e,t),i.canvasContext.fillText(`${n}`,e,t)},g=(e,t,n=[],r="8px",a=20)=>{let s=t;for(const t of n)f(e,s,t,r,"left"),s+=a},v=(e,t,n="")=>{const r=`${t.toUpperCase()} - ${n}`;f(e.topLeft[0],e.topLeft[1],r,"24px")},y=(e,t="red")=>{const{bottomRight:n,topLeft:r}=e;i.canvasContext.beginPath(),i.canvasContext.fillStyle=t,i.canvasContext.strokeRect(r[0],r[1],n[0],n[1]),i.canvasContext.fill()};let b=0;const E=e=>b+=e;let w=0;const I=l.easeInQuad,x=(e,t={h:0,s:100,l:100},n=3,r=!1,s=!0)=>{const{scaledMesh:l}=e,c=l.length;for(let e=0;e<c;e++){const u=l[e][0],d=l[e][1],h=1-(l[e][2]+45)/45,p=a.clamp(n*I(h),1,n),m=a.clamp(h,.5,1);if(i.canvasContext.beginPath(),s&&e===b%c)i.canvasContext.stroke(),i.canvasContext.font="22px Oxanium",i.canvasContext.textAlign="center",i.canvasContext.fillStyle=o.default.dark,i.canvasContext.fillText(`#${e}`,u+p+1,d),i.canvasContext.fillStyle="hsla(0,90%,70%,1)",i.canvasContext.arc(u,d,3*p,0,a.TAU);else{const n=t.h,s=r?(w+++n+360*e/c)%360:n;i.canvasContext.fillStyle=`hsla(${s},${t.s}%,${t.l}%,${m})`,i.canvasContext.arc(u,d,p,0,a.TAU)}i.canvasContext.fill()}},S=(e,t={h:0,s:100,l:100},n=.5,r=!1,a=.2)=>{const{scaledMesh:s}=e,o=t.h;for(let e=0,a=c.TRIANGLE_MATRIX.length-2;e<a;e+=3){const i=s[c.TRIANGLE_MATRIX[e]],l=s[c.TRIANGLE_MATRIX[e+1]],u=s[c.TRIANGLE_MATRIX[e+2]],d=t.a||1,h=`hsla(${r?(o+360*e/a)%360:o},${t.s}%,${t.l}%,${d})`;p(i[0],i[1],l[0],l[1],u[0],u[1],h,n)}},N=(e,t=s.DEFAULT_COLOURS,n=!1,r=!1,a=!1)=>{const{annotations:o}=e;r&&n?drawMouth(e,t.mouth,a):drawMouth(e,t.mouthClosed,a)}},{"../maths/maths":"iDBHd","../palette":"bNJmu","./canvas":"2h2QK","../maths/easing":"8aGct","../models/face-mesh-model":"4YeaK","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],bNJmu:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"DEFAULT_COLOURS",(()=>a)),r.export(n,"DAMI_KIM_COLOURS",(()=>s)),r.export(n,"PASTEL_COLOURS",(()=>o));const a={hue:90,saturation:80,luminosity:50,hueRange:360,dots:60,mouth:"rgba(255,0,0,0.5)",mouthClosed:"rgba(255,0,0,0.2)",lipsUpperInner:"pink",lipsLowerInner:"pink",midwayBetweenEyes:"blue",leftEyeLower0:"red",rightEyeLower0:"red",leftEyeIris:"yellow",rightEyeIris:"yellow"},s={...a},o={...a};n.default={white:"hsl(22, 28%, 87%)",dark:"hsl(30, 6%, 14%)",grey:"hsl(11, 6%, 50%)",cream:"hsl(27, 30%, 45%)",brown:"hsl(23, 22%, 30%)",blue:"hsl(196, 18%, 33%)",green:"hsl(56, 18%, 33%)",yellow:"hsl(56, 18%, 33%)",orange:"hsl(28, 69%, 38%)",red:"hsl(9, 58%, 35%)"}},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"8aGct":[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"linear",(()=>a)),r.export(n,"easeInSine",(()=>s)),r.export(n,"easeOutSine",(()=>o)),r.export(n,"easeInOutSine",(()=>i)),r.export(n,"easeInQuad",(()=>l)),r.export(n,"easeOutQuad",(()=>c)),r.export(n,"easeInOutQuad",(()=>u)),r.export(n,"easeInCubic",(()=>d)),r.export(n,"easeOutCubic",(()=>h)),r.export(n,"easeInOutCubic",(()=>p)),r.export(n,"easeInQuart",(()=>m)),r.export(n,"easeOutQuart",(()=>f)),r.export(n,"easeInOutQuart",(()=>g)),r.export(n,"easeInQuint",(()=>v)),r.export(n,"easeOutQuint",(()=>y)),r.export(n,"easeInOutQuint",(()=>b)),r.export(n,"easeInExpo",(()=>E)),r.export(n,"easeOutExpo",(()=>w)),r.export(n,"easeInOutExpo",(()=>I)),r.export(n,"easeInCirc",(()=>x)),r.export(n,"easeOutCirc",(()=>S)),r.export(n,"easeInOutCirc",(()=>N)),r.export(n,"easeInBack",(()=>_)),r.export(n,"easeOutBack",(()=>T)),r.export(n,"easeInOutBack",(()=>M)),r.export(n,"easeInElastic",(()=>A)),r.export(n,"easeOutElastic",(()=>C)),r.export(n,"easeInOutElastic",(()=>k)),r.export(n,"easeOutBounce",(()=>O)),r.export(n,"easeInBounce",(()=>R)),r.export(n,"easeInOutBounce",(()=>L));const a=e=>e,s=e=>-1*Math.cos(e*(Math.PI/2))+1;function o(e){return Math.sin(e*(Math.PI/2))}function i(e){return-.5*(Math.cos(Math.PI*e)-1)}function l(e){return e*e}function c(e){return e*(2-e)}function u(e){return e<.5?2*e*e:(4-2*e)*e-1}function d(e){return e*e*e}function h(e){const t=e-1;return t*t*t+1}function p(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}function m(e){return e*e*e*e}function f(e){const t=e-1;return 1-t*t*t*t}function g(e){const t=e-1;return e<.5?8*e*e*e*e:1-8*t*t*t*t}function v(e){return e*e*e*e*e}function y(e){const t=e-1;return 1+t*t*t*t*t}function b(e){const t=e-1;return e<.5?16*e*e*e*e*e:1+16*t*t*t*t*t}function E(e){return 0===e?0:Math.pow(2,10*(e-1))}function w(e){return 1===e?1:1-Math.pow(2,-10*e)}function I(e){if(0===e||1===e)return e;const t=2*e,n=t-1;return t<1?.5*Math.pow(2,10*n):.5*(2-Math.pow(2,-10*n))}function x(e){const t=e/1;return-1*(Math.sqrt(1-t*e)-1)}function S(e){const t=e-1;return Math.sqrt(1-t*t)}function N(e){const t=2*e,n=t-2;return t<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-n*n)+1)}function _(e,t=1.70158){return e*e*((t+1)*e-t)}function T(e,t=1.70158){const n=e/1-1;return n*n*((t+1)*n+t)+1}function M(e,t=1.70158){const n=2*e,r=n-2,a=1.525*t;return n<1?.5*n*n*((a+1)*n-a):.5*(r*r*((a+1)*r+a)+2)}function A(e,t=.7){if(0===e||1===e)return e;const n=e/1-1,r=1-t,a=r/(2*Math.PI)*Math.asin(1);return-Math.pow(2,10*n)*Math.sin((n-a)*(2*Math.PI)/r)}function C(e,t=.7){const n=1-t,r=2*e;if(0===e||1===e)return e;const a=n/(2*Math.PI)*Math.asin(1);return Math.pow(2,-10*r)*Math.sin((r-a)*(2*Math.PI)/n)+1}function k(e,t=.65){const n=1-t;if(0===e||1===e)return e;const r=2*e,a=r-1,s=n/(2*Math.PI)*Math.asin(1);return r<1?Math.pow(2,10*a)*Math.sin((a-s)*(2*Math.PI)/n)*-.5:Math.pow(2,-10*a)*Math.sin((a-s)*(2*Math.PI)/n)*.5+1}function O(e){const t=e/1;if(t<1/2.75)return 7.5625*t*t;if(t<2/2.75){const e=t-1.5/2.75;return 7.5625*e*e+.75}if(t<2.5/2.75){const e=t-2.25/2.75;return 7.5625*e*e+.9375}{const e=t-2.625/2.75;return 7.5625*e*e+.984375}}function R(e){return 1-O(1-e)}function L(e){return e<.5?.5*R(2*e):.5*O(2*e-1)+.5}},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"4YeaK":[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"TRIANGLE_MATRIX",(()=>a));const a=[127,34,139,11,0,37,232,231,120,72,37,39,128,121,47,232,121,128,104,69,67,175,171,148,157,154,155,118,50,101,73,39,40,9,151,108,48,115,131,194,204,211,74,40,185,80,42,183,40,92,186,230,229,118,202,212,214,83,18,17,76,61,146,160,29,30,56,157,173,106,204,194,135,214,192,203,165,98,21,71,68,51,45,4,144,24,23,77,146,91,205,50,187,201,200,18,91,106,182,90,91,181,85,84,17,206,203,36,148,171,140,92,40,39,193,189,244,159,158,28,247,246,161,236,3,196,54,68,104,193,168,8,117,228,31,189,193,55,98,97,99,126,47,100,166,79,218,155,154,26,209,49,131,135,136,150,47,126,217,223,52,53,45,51,134,211,170,140,67,69,108,43,106,91,230,119,120,226,130,247,63,53,52,238,20,242,46,70,156,78,62,96,46,53,63,143,34,227,173,155,133,123,117,111,44,125,19,236,134,51,216,206,205,154,153,22,39,37,167,200,201,208,36,142,100,57,212,202,20,60,99,28,158,157,35,226,113,160,159,27,204,202,210,113,225,46,43,202,204,62,76,77,137,123,116,41,38,72,203,129,142,64,98,240,49,102,64,41,73,74,212,216,207,42,74,184,169,170,211,170,149,176,105,66,69,122,6,168,123,147,187,96,77,90,65,55,107,89,90,180,101,100,120,63,105,104,93,137,227,15,86,85,129,102,49,14,87,86,55,8,9,100,47,121,145,23,22,88,89,179,6,122,196,88,95,96,138,172,136,215,58,172,115,48,219,42,80,81,195,3,51,43,146,61,171,175,199,81,82,38,53,46,225,144,163,110,246,33,7,52,65,66,229,228,117,34,127,234,107,108,69,109,108,151,48,64,235,62,78,191,129,209,126,111,35,143,163,161,246,117,123,50,222,65,52,19,125,141,221,55,65,3,195,197,25,7,33,220,237,44,70,71,139,122,193,245,247,130,33,71,21,162,153,158,159,170,169,150,188,174,196,216,186,92,144,160,161,2,97,167,141,125,241,164,167,37,72,38,12,145,159,160,38,82,13,63,68,71,226,35,111,158,153,154,101,50,205,206,92,165,209,198,217,165,167,97,220,115,218,133,112,243,239,238,241,214,135,169,190,173,133,171,208,32,125,44,237,86,87,178,85,86,179,84,85,180,83,84,181,201,83,182,137,93,132,76,62,183,61,76,184,57,61,185,212,57,186,214,207,187,34,143,156,79,239,237,123,137,177,44,1,4,201,194,32,64,102,129,213,215,138,59,166,219,242,99,97,2,94,141,75,59,235,24,110,228,25,130,226,23,24,229,22,23,230,26,22,231,112,26,232,189,190,243,221,56,190,28,56,221,27,28,222,29,27,223,30,29,224,247,30,225,238,79,20,166,59,75,60,75,240,147,177,215,20,79,166,187,147,213,112,233,244,233,128,245,128,114,188,114,217,174,131,115,220,217,198,236,198,131,134,177,132,58,143,35,124,110,163,7,228,110,25,356,389,368,11,302,267,452,350,349,302,303,269,357,343,277,452,453,357,333,332,297,175,152,377,384,398,382,347,348,330,303,304,270,9,336,337,278,279,360,418,262,431,304,408,409,310,415,407,270,409,410,450,348,347,422,430,434,313,314,17,306,307,375,387,388,260,286,414,398,335,406,418,364,367,416,423,358,327,251,284,298,281,5,4,373,374,253,307,320,321,425,427,411,421,313,18,321,405,406,320,404,405,315,16,17,426,425,266,377,400,369,322,391,269,417,465,464,386,257,258,466,260,388,456,399,419,284,332,333,417,285,8,346,340,261,413,441,285,327,460,328,355,371,329,392,439,438,382,341,256,429,420,360,364,394,379,277,343,437,443,444,283,275,440,363,431,262,369,297,338,337,273,375,321,450,451,349,446,342,467,293,334,282,458,461,462,276,353,383,308,324,325,276,300,293,372,345,447,382,398,362,352,345,340,274,1,19,456,248,281,436,427,425,381,256,252,269,391,393,200,199,428,266,330,329,287,273,422,250,462,328,258,286,384,265,353,342,387,259,257,424,431,430,342,353,276,273,335,424,292,325,307,366,447,345,271,303,302,423,266,371,294,455,460,279,278,294,271,272,304,432,434,427,272,407,408,394,430,431,395,369,400,334,333,299,351,417,168,352,280,411,325,319,320,295,296,336,319,403,404,330,348,349,293,298,333,323,454,447,15,16,315,358,429,279,14,15,316,285,336,9,329,349,350,374,380,252,318,402,403,6,197,419,318,319,325,367,364,365,435,367,397,344,438,439,272,271,311,195,5,281,273,287,291,396,428,199,311,271,268,283,444,445,373,254,339,263,466,249,282,334,296,449,347,346,264,447,454,336,296,299,338,10,151,278,439,455,292,407,415,358,371,355,340,345,372,390,249,466,346,347,280,442,443,282,19,94,370,441,442,295,248,419,197,263,255,359,440,275,274,300,383,368,351,412,465,263,467,466,301,368,389,380,374,386,395,378,379,412,351,419,436,426,322,373,390,388,2,164,393,370,462,461,164,0,267,302,11,12,374,373,387,268,12,13,293,300,301,446,261,340,385,384,381,330,266,425,426,423,391,429,355,437,391,327,326,440,457,438,341,382,362,459,457,461,434,430,394,414,463,362,396,369,262,354,461,457,316,403,402,315,404,403,314,405,404,313,406,405,421,418,406,366,401,361,306,408,407,291,409,408,287,410,409,432,436,410,434,416,411,264,368,383,309,438,457,352,376,401,274,275,4,421,428,262,294,327,358,433,416,367,289,455,439,462,370,326,2,326,370,305,460,455,254,449,448,255,261,446,253,450,449,252,451,450,256,452,451,341,453,452,413,464,463,441,413,414,258,442,441,257,443,442,259,444,443,260,445,444,467,342,445,459,458,250,289,392,290,290,328,460,376,433,435,250,290,392,411,416,433,341,463,464,453,464,465,357,465,412,343,412,399,360,363,440,437,399,456,420,456,363,401,435,288,372,383,353,339,255,249,448,261,255,133,243,190,133,155,112,33,246,247,33,130,25,398,384,286,362,398,414,362,463,341,263,359,467,263,249,255,466,467,260,75,60,166,238,239,79,162,127,139,72,11,37,121,232,120,73,72,39,114,128,47,233,232,128,103,104,67,152,175,148,173,157,155,119,118,101,74,73,40,107,9,108,49,48,131,32,194,211,184,74,185,191,80,183,185,40,186,119,230,118,210,202,214,84,83,17,77,76,146,161,160,30,190,56,173,182,106,194,138,135,192,129,203,98,54,21,68,5,51,4,145,144,23,90,77,91,207,205,187,83,201,18,181,91,182,180,90,181,16,85,17,205,206,36,176,148,140,165,92,39,245,193,244,27,159,28,30,247,161,174,236,196,103,54,104,55,193,8,111,117,31,221,189,55,240,98,99,142,126,100,219,166,218,112,155,26,198,209,131,169,135,150,114,47,217,224,223,53,220,45,134,32,211,140,109,67,108,146,43,91,231,230,120,113,226,247,105,63,52,241,238,242,124,46,156,95,78,96,70,46,63,116,143,227,116,123,111,1,44,19,3,236,51,207,216,205,26,154,22,165,39,167,199,200,208,101,36,100,43,57,202,242,20,99,56,28,157,124,35,113,29,160,27,211,204,210,124,113,46,106,43,204,96,62,77,227,137,116,73,41,72,36,203,142,235,64,240,48,49,64,42,41,74,214,212,207,183,42,184,210,169,211,140,170,176,104,105,69,193,122,168,50,123,187,89,96,90,66,65,107,179,89,180,119,101,120,68,63,104,234,93,227,16,15,85,209,129,49,15,14,86,107,55,9,120,100,121,153,145,22,178,88,179,197,6,196,89,88,96,135,138,136,138,215,172,218,115,219,41,42,81,5,195,51,57,43,61,208,171,199,41,81,38,224,53,225,24,144,110,105,52,66,118,229,117,227,34,234,66,107,69,10,109,151,219,48,235,183,62,191,142,129,126,116,111,143,7,163,246,118,117,50,223,222,52,94,19,141,222,221,65,196,3,197,45,220,44,156,70,139,188,122,245,139,71,162,145,153,159,149,170,150,122,188,196,206,216,92,163,144,161,164,2,167,242,141,241,0,164,37,11,72,12,144,145,160,12,38,13,70,63,71,31,226,111,157,158,154,36,101,205,203,206,165,126,209,217,98,165,97,237,220,218,237,239,241,210,214,169,140,171,32,241,125,237,179,86,178,180,85,179,181,84,180,182,83,181,194,201,182,177,137,132,184,76,183,185,61,184,186,57,185,216,212,186,192,214,187,139,34,156,218,79,237,147,123,177,45,44,4,208,201,32,98,64,129,192,213,138,235,59,219,141,242,97,97,2,141,240,75,235,229,24,228,31,25,226,230,23,229,231,22,230,232,26,231,233,112,232,244,189,243,189,221,190,222,28,221,223,27,222,224,29,223,225,30,224,113,247,225,99,60,240,213,147,215,60,20,166,192,187,213,243,112,244,244,233,245,245,128,188,188,114,174,134,131,220,174,217,236,236,198,134,215,177,58,156,143,124,25,110,7,31,228,25,264,356,368,0,11,267,451,452,349,267,302,269,350,357,277,350,452,357,299,333,297,396,175,377,381,384,382,280,347,330,269,303,270,151,9,337,344,278,360,424,418,431,270,304,409,272,310,407,322,270,410,449,450,347,432,422,434,18,313,17,291,306,375,259,387,260,424,335,418,434,364,416,391,423,327,301,251,298,275,281,4,254,373,253,375,307,321,280,425,411,200,421,18,335,321,406,321,320,405,314,315,17,423,426,266,396,377,369,270,322,269,413,417,464,385,386,258,248,456,419,298,284,333,168,417,8,448,346,261,417,413,285,326,327,328,277,355,329,309,392,438,381,382,256,279,429,360,365,364,379,355,277,437,282,443,283,281,275,363,395,431,369,299,297,337,335,273,321,348,450,349,359,446,467,283,293,282,250,458,462,300,276,383,292,308,325,283,276,293,264,372,447,346,352,340,354,274,19,363,456,281,426,436,425,380,381,252,267,269,393,421,200,428,371,266,329,432,287,422,290,250,328,385,258,384,446,265,342,386,387,257,422,424,430,445,342,276,422,273,424,306,292,307,352,366,345,268,271,302,358,423,371,327,294,460,331,279,294,303,271,304,436,432,427,304,272,408,395,394,431,378,395,400,296,334,299,6,351,168,376,352,411,307,325,320,285,295,336,320,319,404,329,330,349,334,293,333,366,323,447,316,15,315,331,358,279,317,14,316,8,285,9,277,329,350,253,374,252,319,318,403,351,6,419,324,318,325,397,367,365,288,435,397,278,344,439,310,272,311,248,195,281,375,273,291,175,396,199,312,311,268,276,283,445,390,373,339,295,282,296,448,449,346,356,264,454,337,336,299,337,338,151,294,278,455,308,292,415,429,358,355,265,340,372,388,390,466,352,346,280,295,442,282,354,19,370,285,441,295,195,248,197,457,440,274,301,300,368,417,351,465,251,301,389,385,380,386,394,395,379,399,412,419,410,436,322,387,373,388,326,2,393,354,370,461,393,164,267,268,302,12,386,374,387,312,268,13,298,293,301,265,446,340,380,385,381,280,330,425,322,426,391,420,429,437,393,391,326,344,440,438,458,459,461,364,434,394,428,396,262,274,354,457,317,316,402,316,315,403,315,314,404,314,313,405,313,421,406,323,366,361,292,306,407,306,291,408,291,287,409,287,432,410,427,434,411,372,264,383,459,309,457,366,352,401,1,274,4,418,421,262,331,294,358,435,433,367,392,289,439,328,462,326,94,2,370,289,305,455,339,254,448,359,255,446,254,253,449,253,252,450,252,256,451,256,341,452,414,413,463,286,441,414,286,258,441,258,257,442,257,259,443,259,260,444,260,467,445,309,459,250,305,289,290,305,290,460,401,376,435,309,250,392,376,411,433,453,341,464,357,453,465,343,357,412,437,343,399,344,360,440,420,437,456,360,420,363,361,401,288,265,372,353,390,339,249,339,448,255]},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],ZL00j:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"drawWaves",(()=>c)),r.export(n,"drawBars",(()=>u));var a=e("./canvas"),s=e("../palette");r.interopDefault(s);let o=0;const{width:i,height:l}=a.getCanvasDimensions(),c=(e,t)=>{a.canvasContext.lineWidth=2,a.canvasContext.strokeStyle=`hsla(${o}, 100, 150, 0.5)`,a.canvasContext.beginPath(),o=o++%360;const n=1*i/t;let r=0;for(let s=0;s<t;s++){const t=e[s]/128*l/2;0===s?a.canvasContext.moveTo(r,t):a.canvasContext.lineTo(r,t),r+=n}a.canvasContext.lineTo(i,l/2),a.canvasContext.stroke()},u=(e,t)=>{const n=i/t*2;let r,s=0;for(let o=0;o<t;o++)r=e[o],a.canvasContext.fillStyle="hsla("+r/l*360+",50%,50%,0.3)",a.canvasContext.fillRect(s,0,n,r),s+=n+1}},{"./canvas":"2h2QK","../palette":"bNJmu","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"2HWvY":[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"drawQuantise",(()=>u));var a=e("../maths/maths"),s=e("../palette"),o=r.interopDefault(s),i=e("./canvas");const{width:l,height:c}=i.getCanvasDimensions(),u=(e,t=-1,n=1,r=30,s=4)=>{const l=c/(n+1);for(let n=0,c=t+1;n<c;++n){let c=0,u=n*l+l;i.canvasContext.fillStyle=n===t?o.default.cream:o.default.orange,i.canvasContext.strokeStyle=n===t?o.default.orange:o.default.brown,i.canvasContext.strokeWidth=r,i.canvasContext.lineWidth=e&&n===t?8:4,i.canvasContext.beginPath(),i.canvasContext.arc(c,u,s,0,a.TAU),i.canvasContext.fill(),i.canvasContext.stroke(),i.canvasContext.closePath()}i.canvasContext.lineWidth=1}},{"../maths/maths":"iDBHd","../palette":"bNJmu","./canvas":"2h2QK","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"3T44M":[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n);var a=e("../maths/maths"),s=e("../palette");r.interopDefault(s);n.default=class{constructor(e,t,n,r=!0,a={w:200,h:100}){console.log(typeof e),this.canvas=e,this.context=e.get2dContext("2d"),this.notes=new Map,this.isHorizontal=r,this.createPalette(),this.redrawNecessary=!0}createPalette(e=50,t=50,n=.8,r=256){this.palette=new Array(r).map(((e,t)=>{}))}draw(e){console.log(e);const t=this.context;this.notes.size>0&&this.notes,t.beginPath(),t.arc(0,0,12,0,a.TAU),t.fillStyle="red",t.fill(),t.closePath()}noteOn(e,t="a"){this.notes.get(t)!==e&&(this.notes.set(t,e),this.redrawNecessary=!0)}noteOff(e="a"){this.notes.set(e,-1),this.redrawNecessary=!0}allNotesOff(){this.notes.clear(),this.redrawNecessary=!0}update(e){this.redrawNecessary&&draw()}}},{"../maths/maths":"iDBHd","../palette":"bNJmu","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"6WcRe":[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"detectCameras",(()=>s)),r.export(n,"filterVideoCameras",(()=>o)),r.export(n,"fetchVideoCameras",(()=>i)),r.export(n,"setupCamera",(()=>l)),r.export(n,"loadCamera",(()=>c)),r.export(n,"findBestCamera",(()=>u));let a=!1;const s=async()=>navigator.mediaDevices.enumerateDevices(),o=e=>e.filter((e=>"videoinput"===e.kind)),i=async()=>{o(await s())},l=async(e,t)=>new Promise((async(n,r)=>{let a;e=e??document.createElement("video");let s=2;const o=()=>{if(--s<=0)try{e.play(),e.width=e.videoWidth,e.height=e.videoHeight,n(a)}catch(e){r(a)}};e.onloadedmetadata=e=>o(),e.onloadeddata=e=>o(),e.onerror=e=>{console.error("VIDEO:Connection Error",e),r(a)};const i={};t?i.deviceId={exact:t}:i.facingMode="user";const l={video:i,audio:!1};try{a=await navigator.mediaDevices.getUserMedia(l),e.srcObject=a}catch(e){r(e)}})),c=async(e,t,n="Default")=>{let r;a=!0;try{if(!(t&&t.length>0))throw console.log(t,"Camera unfound",{video:e,deviceId:t}),Error("Camera Device not specified "+t);r=await l(e,t)}catch(e){throw e}return a=!1,r},u=async(e,t)=>{let n,r=!1;const a=e.has("camera")?e.getItem("camera").deviceId:void 0,s=i();if(s.length<1)throw Error("No Cameras found on this device");if(!a)try{return n=await l(t),{camera:n,videoCameraDevices:s,saved:r}}catch(e){}try{n=await c(t,a,"Saved"),r=!0}catch(a){e.removeItem("camera"),r=!1,n=await l(t)}return{camera:n,videoCameraDevices:s,saved:r}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],kq8Be:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"getHelp",(()=>s)),r.export(n,"getInstruction",(()=>o)),r.export(n,"getNextInstruction",(()=>i));var a=e("../locales/en_GB");const s=(e,t="en-GB")=>a.QUICK_START[e%(a.QUICK_START.length-1)],o=(e,t="en-GB")=>a.INSTRUCTIONS[e%(a.INSTRUCTIONS.length-1)];const i=(e="en-GB")=>a.INSTRUCTIONS[1%(a.INSTRUCTIONS.length-1)]},{"../locales/en_GB":"h3TZu","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],h3TZu:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"QUICK_START",(()=>a)),r.export(n,"INSTRUCTIONS",(()=>s));const a=["Hello!","I'm looking for your pretty face","Look at me and open your mouth","Move your face close to the screen","Try and put it in the centre","I still cannot see you","Make sure you allowed the camera!"],s=["Welcome to the <strong>interFACE</strong>","Smile at the screen to begin...","Tilt your head forwards and backwards to change octave","Roll your head left and right to change pitch","Then open you mouth to make it louder!","Change instruments by closing both eyes for 1 bar","or by tapping your face on screen","to select an instrument from a list","hold your finger on your face for one bar to see all instruments","Facing left plays the black keys","Facing right plays the white keys","Use your eyes to shape the sound","Connect a MIDI instrument and click the MIDI button","In order to play the MIDI instrument with your head","You can change tempo using the arrow keys","Or just type a 3 digit number to set a BPM","Or tap the Q key in rhythm a few times","","","","","","","","","Hotkeys<br>(* means beta feature)","Type any three numbers to set the tempo","eg. 090 for 90BPM","eg. 120 for 120BPM","Arrow Up - add more bars","Arrow Down - remove a bar","Arrow Left - previous instrument","Arrow Right - next instrument","A - 808","B - Backing Percussion","C - Clear","D - Closed Hat","E - Clack","G - ","H - ","J - ","K - ","M - Metronome toggle on or off","Q - Quiet mode (mute / unmute)","R - Record*","S - Snare","T - Hide Instrument Text","V - Toggle video on screen","W - Cowbell","","","","","","","","","","","","","","","","","OMG I can't believe you are still here!","Secret Keys are as follows","CAPS Lock - developer debug","TAB - show more info on screen"]},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"2GQJM":[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"setupReporting",(()=>c)),r.export(n,"track",(()=>u)),r.export(n,"trackExit",(()=>d)),r.export(n,"trackError",(()=>h));var a=e("analytics"),s=r.interopDefault(a),o=e("@analytics/google-analytics"),i=r.interopDefault(o);let l;const c=(e="Interface",t="G-1XT0GV0L6J")=>(l=s.default({app:e,plugins:[i.default({trackingId:t})]}),l.page(),l),u=(e,t)=>{l&&l.track(e,t)},d=()=>{},h=(e,t=42,n="Fails")=>{l&&l.track("Error",{category:n,label:e,value:t})}},{analytics:"3rmoW","@analytics/google-analytics":"396Ua","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"3rmoW":[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"CONSTANTS",(()=>a.CONSTANTS)),r.export(n,"EVENTS",(()=>a.EVENTS)),r.export(n,"Analytics",(()=>u)),r.export(n,"default",(()=>u)),r.export(n,"init",(()=>u));var a=e("@analytics/core"),s=e("@analytics/storage-utils"),o=r.interopDefault(s);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={storage:o.default};return a.Analytics(c(c({},t),e))}},{"@analytics/core":"cIAAA","@analytics/storage-utils":"f4AHx","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],cIAAA:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"Analytics",(()=>Se)),r.export(n,"CONSTANTS",(()=>E)),r.export(n,"EVENTS",(()=>N)),r.export(n,"default",(()=>Se)),r.export(n,"init",(()=>Se));var a=e("analytics-utils"),s=e("@analytics/global-storage-utils"),o=e("@analytics/type-utils");function i(){return i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i.apply(this,arguments)}var l="function",c="undefined",u="@@redux/"+Math.random().toString(36),d=function(){return typeof Symbol===l&&Symbol.observable||"@@observable"}(),h=" != "+l;function p(e,t,n){var r;if(typeof t===l&&typeof n===c&&(n=t,t=void 0),typeof n!==c){if(typeof n!==l)throw new Error("enhancer"+h);return n(p)(e,t)}if(typeof e!==l)throw new Error("reducer"+h);var a=e,s=t,i=[],u=i,m=!1;function f(){u===i&&(u=i.slice())}function g(){return s}function v(e){if(typeof e!==l)throw new Error("Listener"+h);var t=!0;return f(),u.push(e),function(){if(t){t=!1,f();var n=u.indexOf(e);u.splice(n,1)}}}function y(e){if(!o.isObject(e))throw new Error("Act != obj");if(typeof e.type===c)throw new Error("ActType "+c);if(m)throw new Error("Dispatch in reducer");try{m=!0,s=a(s,e)}finally{m=!1}for(var t=i=u,n=0;n<t.length;n++)(0,t[n])();return e}return y({type:"@@redux/INIT"}),(r={dispatch:y,subscribe:v,getState:g,replaceReducer:function(e){if(typeof e!==l)throw new Error("next reducer"+h);a=e,y({type:"@@redux/INIT"})}})[d]=function(){var e,t=v;return(e={subscribe:function(e){if("object"!=typeof e)throw new TypeError("Observer != obj");function n(){e.next&&e.next(g())}return n(),{unsubscribe:t(n)}}})[d]=function(){return this},e},r}function m(e,t){var n=t&&t.type;return"action "+(n&&n.toString()||"?")+"reducer "+e+" returns "+c}function f(){var e=[].slice.call(arguments);return 0===e.length?function(e){return e}:1===e.length?e[0]:e.reduce((function(e,t){return function(){return e(t.apply(void 0,[].slice.call(arguments)))}}))}function g(){var e=arguments;return function(t){return function(n,r,a){var s,o=t(n,r,a),l=o.dispatch,c={getState:o.getState,dispatch:function(e){return l(e)}};return s=[].slice.call(e).map((function(e){return e(c)})),i({},o,{dispatch:l=f.apply(void 0,s)(o.dispatch)})}}}var v=o.PREFIX+"anon_id",y=o.PREFIX+"user_id",b=o.PREFIX+"user_traits",E={__proto__:null,ANON_ID:v,USER_ID:y,USER_TRAITS:b},w="userId",I="anonymousId",x=["bootstrap","params","campaign","initializeStart","initialize","initializeEnd","ready","resetStart","reset","resetEnd","pageStart","page","pageEnd","pageAborted","trackStart","track","trackEnd","trackAborted","identifyStart","identify","identifyEnd","identifyAborted","userIdChanged","registerPlugins","enablePlugin","disablePlugin","online","offline","setItemStart","setItem","setItemEnd","setItemAborted","removeItemStart","removeItem","removeItemEnd","removeItemAborted"],S=["name","EVENTS","config","loaded"],N=x.reduce((function(e,t){return e[t]=t,e}),{registerPluginType:function(e){return"registerPlugin:"+e},pluginReadyType:function(e){return"ready:"+e}}),_=/^utm_/,T=/^an_prop_/,M=/^an_trait_/;function A(e){return function(t,n){if(void 0===t&&(t={}),void 0===n&&(n={}),n.type===N.setItemEnd){if(n.key===v)return i({},t,{anonymousId:n.value});if(n.key===y)return i({},t,{userId:n.value})}switch(n.type){case N.identify:return Object.assign({},t,{userId:n.userId,traits:i({},t.traits,n.traits)});case N.reset:return[y,v,b].forEach((function(t){e.removeItem(t)})),Object.assign({},t,{userId:null,anonymousId:null,traits:{}});default:return t}}}function C(e){return{userId:e.getItem(y),anonymousId:e.getItem(v),traits:e.getItem(b)}}var k=function(e){return o.PREFIX+"TEMP"+o.PREFIX+e};var O={};function R(e,t){O[e]&&o.isFunction(O[e])&&(O[e](t),delete O[e])}function L(e,t,n){return new Promise((function(r,a){return t()?r(e):n<1?a(i({},e,{queue:!0})):new Promise((function(e){return setTimeout(e,10)})).then((function(s){return L(e,t,n-10).then(r,a)}))}))}function D(e,t,n){var r=t(),a=e.getState(),s=a.plugins,l=a.queue,c=a.user;if(!a.context.offline&&l&&l.actions&&l.actions.length){var u=l.actions.reduce((function(e,t,n){return s[t.plugin].loaded?(e.process.push(t),e.processIndex.push(n)):(e.requeue.push(t),e.requeueIndex.push(n)),e}),{processIndex:[],process:[],requeue:[],requeueIndex:[]});if(u.processIndex&&u.processIndex.length){u.processIndex.forEach((function(t){var a,u,d=l.actions[t],h=d.plugin,p=d.payload.type,m=r[h][p];if(m&&o.isFunction(m)){var f=(void 0===(a=d.payload)&&(a={}),void 0===(u=c)&&(u={}),[w,I].reduce((function(e,t){return a.hasOwnProperty(t)&&u[t]&&u[t]!==a[t]&&(e[t]=u[t]),e}),a));m({payload:f,config:s[h].config,instance:n});var g=p+":"+h;e.dispatch(i({},f,{type:g,_:{called:g,from:"queueDrain"}}))}}));var d=l.actions.filter((function(e,t){return!~u.processIndex.indexOf(t)}));l.actions=d}}}var P=function(e){var t,n,r=e.data,a=e.action,s=e.instance,l=e.state,c=e.allPlugins,u=e.allMatches,d=e.store,h=e.EVENTS;try{var p=l.plugins,m=l.context,f=a.type,g=f.match(j),v=r.exact.map((function(e){return e.pluginName}));g&&(v=u.during.map((function(e){return e.pluginName})));var y=(t=s,n=v,function(e,r,a){var s=r.config,o=r.name,l=o+"."+e.type;a&&(l=a.event);var c,u,d,h,p,m=e.type.match(j)?(c=o,u=l,d=n,h=a,p=e,function(e,t){var n=h?h.name:c,r=t&&z(t)?t:d;if(h&&(!(r=t&&z(t)?t:[c]).includes(c)||1!==r.length))throw new Error("Method "+u+" can only abort "+c+" plugin. "+JSON.stringify(r)+" input valid");return i({},p,{abort:{reason:e,plugins:r,caller:u,_:n}})}):function(e,t){return function(){throw new Error(e.type+" action not cancellable. Remove abort in "+t)}}(e,l);return{payload:K(e),instance:t,config:s||{},abort:m}}),b=r.exact.reduce((function(e,t){var n=t.pluginName,r=t.methodName,a=!1;return r.match(/^initialize/)||r.match(/^reset/)||(a=!p[n].loaded),m.offline&&r.match(/^(page|track|identify)/)&&(a=!0),e[""+n]=a,e}),{});return Promise.resolve(r.exact.reduce((function(e,t,n){var l=t.pluginName;return Promise.resolve(e).then((function(e){function t(){return Promise.resolve(e)}var n=function(){if(r.namespaced&&r.namespaced[l])return Promise.resolve(r.namespaced[l].reduce((function(e,t,n){return Promise.resolve(e).then((function(e){var n,r,a;return t.method&&o.isFunction(t.method)?(function(e,t){var n=Y(e);if(n&&n.name===t){var r=Y(n.method);throw new Error([t+" plugin is calling method "+e,"Plugins cant call self","Use "+n.method+" "+(r?"or "+r.method:"")+" in "+t+" plugin insteadof "+e].join("\n"))}}(t.methodName,t.pluginName),Promise.resolve(t.method({payload:e,instance:s,abort:(n=e,r=l,a=t.pluginName,function(e,t){return i({},n,{abort:{reason:e,plugins:t||[r],caller:f,from:a||r}})}),config:G(t.pluginName,p,c),plugins:p})).then((function(t){var n=o.isObject(t)?t:{};return Promise.resolve(i({},e,n))}))):e}))}),Promise.resolve(a))).then((function(t){e[l]=t}));e[l]=a}();return n&&n.then?n.then(t):t()}))}),Promise.resolve({}))).then((function(e){return Promise.resolve(r.exact.reduce((function(t,n,a){try{var l=r.exact.length===a+1,u=n.pluginName,h=c[u];return Promise.resolve(t).then((function(t){var n=e[u]?e[u]:{};if(g&&(n=t),$(n,u))return F({data:n,method:f,instance:s,pluginName:u,store:d}),Promise.resolve(t);if($(t,u))return l&&F({data:t,method:f,instance:s,store:d}),Promise.resolve(t);if(b.hasOwnProperty(u)&&!0===b[u])return d.dispatch({type:"queue",plugin:u,payload:n,_:{called:"queue",from:"queueMechanism"}}),Promise.resolve(t);var r=y(e[u],c[u]);return Promise.resolve(h[f]({abort:r.abort,payload:n,instance:s,config:G(u,p,c),plugins:p})).then((function(r){var a=o.isObject(r)?r:{},l=i({},t,a),c=e[u];if($(c,u))F({data:c,method:f,instance:s,pluginName:u,store:d});else{var h=f+":"+u;(h.match(/:/g)||[]).length<2&&!f.match(B)&&!f.match(U)&&s.dispatch(i({},g?l:n,{type:h,_:{called:h,from:"submethod"}}))}return Promise.resolve(l)}))}))}catch(e){return Promise.reject(e)}}),Promise.resolve(a))).then((function(e){if(!(f.match(j)||f.match(/^registerPlugin/)||f.match(U)||f.match(B)||f.match(/^params/)||f.match(/^userIdChanged/))){if(h.plugins.includes(f),e._&&e._.originalAction===f)return e;var t=i({},e,{_:{originalAction:e.type,called:e.type,from:"engineEnd"}});q(e,r.exact.length)&&!f.match(/End$/)&&(t=i({},t,{type:e.type+"Aborted"})),d.dispatch(t)}return e}))}))}catch(e){return Promise.reject(e)}},j=/Start$/,B=/^bootstrap/,U=/^ready/;function F(e){var t=e.pluginName,n=e.method+"Aborted"+(t?":"+t:"");e.store.dispatch(i({},e.data,{type:n,_:{called:n,from:"abort"}}))}function G(e,t,n){var r=t[e]||n[e];return r&&r.config?r.config:{}}function H(e,t){return t.reduce((function(t,n){return n[e]?t.concat({methodName:e,pluginName:n.name,method:n[e]}):t}),[])}function V(e,t){var n=e.replace(j,""),r=t?":"+t:"";return[""+e+r,""+n+r,n+"End"+r]}function $(e,t){var n=e.abort;return!!n&&(!0===n||W(n,t)||n&&W(n.plugins,t))}function q(e,t){var n=e.abort;if(!n)return!1;if(!0===n||o.isString(n))return!0;var r=n.plugins;return z(n)&&n.length===t||z(r)&&r.length===t}function z(e){return Array.isArray(e)}function W(e,t){return!(!e||!z(e))&&e.includes(t)}function Y(e){var t=e.match(/(.*):(.*)/);return!!t&&{method:t[1],name:t[2]}}function K(e){return Object.keys(e).reduce((function(t,n){return"type"===n||(t[n]=o.isObject(e[n])?Object.assign({},e[n]):e[n]),t}),{})}function Q(e,t,n){var r={};return function(a){return function(s){return function(l){try{var c,u=function(e){return c?e:s(p)},d=l.type,h=l.plugins,p=l;if(l.abort)return Promise.resolve(s(l));if(d===N.enablePlugin&&a.dispatch({type:N.initializeStart,plugins:h,disabled:[],fromEnable:!0,meta:l.meta}),d===N.disablePlugin&&setTimeout((function(){return R(l.meta.rid,{payload:l})}),0),d===N.initializeEnd){var m=t(),f=Object.keys(m),g=f.filter((function(e){return h.includes(e)})).map((function(e){return m[e]})),v=[],y=[],b=l.disabled,E=g.map((function(e){var t=e.name;return L(e,e.loaded,1e4).then((function(n){return r[t]||(a.dispatch({type:N.pluginReadyType(t),name:t,events:Object.keys(e).filter((function(e){return!S.includes(e)}))}),r[t]=!0),v=v.concat(t),e})).catch((function(e){if(e instanceof Error)throw new Error(e);return y=y.concat(e.name),e}))}));Promise.all(E).then((function(e){var t={plugins:v,failed:y,disabled:b};setTimeout((function(){f.length===E.length+b.length&&a.dispatch(i({},{type:N.ready},t))}),0)}))}var w=function(){if(d!==N.bootstrap)return/^ready:([^:]*)$/.test(d)&&setTimeout((function(){return D(a,t,e)}),0),Promise.resolve(function(e,t,n,r,a){try{var s=o.isFunction(t)?t():t,l=e.type,c=l.replace(j,"");if(e._&&e._.called)return Promise.resolve(e);var u=n.getState(),d=(v=s,void 0===(y=u.plugins)&&(y={}),void 0===(b=e.options)&&(b={}),Object.keys(v).filter((function(e){var t=b.plugins||{};return o.isBoolean(t[e])?t[e]:!1!==t.all&&(!y[e]||!1!==y[e].enabled)})).map((function(e){return v[e]})));l===N.initializeStart&&e.fromEnable&&(d=Object.keys(u.plugins).filter((function(t){var n=u.plugins[t];return e.plugins.includes(t)&&!n.initialized})).map((function(e){return s[e]})));var h=d.map((function(e){return e.name})),p=(f=d,g=V(m=l).map((function(e){return H(e,f)})),f.reduce((function(e,t){var n=t.name,r=V(m,n).map((function(e){return H(e,f)})),a=r[0],s=r[1],o=r[2];return a.length&&(e.beforeNS[n]=a),s.length&&(e.duringNS[n]=s),o.length&&(e.afterNS[n]=o),e}),{before:g[0],beforeNS:{},during:g[1],duringNS:{},after:g[2],afterNS:{}}));return Promise.resolve(P({action:e,data:{exact:p.before,namespaced:p.beforeNS},state:u,allPlugins:s,allMatches:p,instance:n,store:r,EVENTS:a})).then((function(e){function t(){var t=function(){if(l.match(j))return Promise.resolve(P({action:i({},o,{type:c+"End"}),data:{exact:p.after,namespaced:p.afterNS},state:u,allPlugins:s,allMatches:p,instance:n,store:r,EVENTS:a})).then((function(e){e.meta&&e.meta.hasCallback&&R(e.meta.rid,{payload:e})}))}();return t&&t.then?t.then((function(){return e})):e}if(q(e,h.length))return e;var o,d=function(){if(l!==c)return Promise.resolve(P({action:i({},e,{type:c}),data:{exact:p.during,namespaced:p.duringNS},state:u,allPlugins:s,allMatches:p,instance:n,store:r,EVENTS:a})).then((function(e){o=e}));o=e}();return d&&d.then?d.then(t):t()}))}catch(e){return Promise.reject(e)}var m,f,g,v,y,b}(l,t,e,a,n)).then((function(e){var t=s(e);return c=1,t}))}();return Promise.resolve(w&&w.then?w.then(u):u(w))}catch(e){return Promise.reject(e)}}}}}function X(e){return function(t){return function(t){return function(n){var r=n.type,a=n.key,s=n.value,o=n.options;if(r===N.setItem||r===N.removeItem){if(n.abort)return t(n);r===N.setItem?e.setItem(a,s,o):e.removeItem(a,o)}return t(n)}}}}var J=function(){var e=this;this.before=[],this.after=[],this.addMiddleware=function(t,n){e[n]=e[n].concat(t)},this.removeMiddleware=function(t,n){var r=e[n].findIndex((function(e){return e===t}));-1!==r&&(e[n]=[].concat(e[n].slice(0,r),e[n].slice(r+1)))},this.dynamicMiddlewares=function(t){return function(n){return function(r){return function(a){var s={getState:n.getState,dispatch:function(e){return n.dispatch(e)}},o=e[t].map((function(e){return e(s)}));return f.apply(void 0,o)(r)(a)}}}}};function Z(e){return function(t,n){void 0===t&&(t={});var r={};if("initialize:aborted"===n.type)return t;if(/^registerPlugin:([^:]*)$/.test(n.type)){var a=ee(n.type,"registerPlugin"),s=e()[a];if(!s||!a)return t;var o=n.enabled;return r[a]={enabled:o,initialized:!!o&&Boolean(!s.initialize),loaded:!!o&&Boolean(s.loaded()),config:s.config||{}},i({},t,r)}if(/^initialize:([^:]*)$/.test(n.type)){var l=ee(n.type,N.initialize),c=e()[l];return c&&l?(r[l]=i({},t[l],{initialized:!0,loaded:Boolean(c.loaded())}),i({},t,r)):t}if(/^ready:([^:]*)$/.test(n.type))return r[n.name]=i({},t[n.name],{loaded:!0}),i({},t,r);switch(n.type){case N.disablePlugin:return i({},t,te(n.plugins,!1,t));case N.enablePlugin:return i({},t,te(n.plugins,!0,t));default:return t}}}function ee(e,t){return e.substring(t.length+1,e.length)}function te(e,t,n){return e.reduce((function(e,r){return e[r]=i({},n[r],{enabled:t}),e}),n)}function ne(e){try{return JSON.parse(JSON.stringify(e))}catch(e){}return e}var re={last:{},history:[]};function ae(e,t){void 0===e&&(e=re);var n=t.options,r=t.meta;if(t.type===N.track){var a=ne(i({event:t.event,properties:t.properties},Object.keys(n).length&&{options:n},{meta:r}));return i({},e,{last:a,history:e.history.concat(a)})}return e}var se={actions:[]};function oe(e,t){void 0===e&&(e=se);var n=t.payload;switch(t.type){case"queue":var r;return r=n&&n.type&&n.type===N.identify?[t].concat(e.actions):e.actions.concat(t),i({},e,{actions:r});case"dequeue":return[];default:return e}}var ie=/#.*$/;var le,ce,ue,de,he=function(e){if(void 0===e&&(e={}),!o.isBrowser)return e;var t,n,r,a,s=document,l=s.title,c=s.referrer,u=window,d=u.location,h=u.innerWidth,p=u.innerHeight,m=d.hash,f=d.search,g=(r=f,a=function(){if(o.isBrowser)for(var e,t=document.getElementsByTagName("link"),n=0;e=t[n];n++)if("canonical"===e.getAttribute("rel"))return e.getAttribute("href")}(),a?a.match(/\?/)?a:a+r:window.location.href.replace(ie,"")),v={title:l,url:g,path:(t=g,n=/(http[s]?:\/\/)?([^\/\s]+\/)(.*)/g.exec(t),"/"+(n&&n[3]?n[3].split("?")[0].replace(ie,""):"")),hash:m,search:f,width:h,height:p};return c&&""!==c&&(v.referrer=c),i({},v,e)},pe={last:{},history:[]};function me(e,t){void 0===e&&(e=pe);var n=t.options;if(t.type===N.page){var r=ne(i({properties:t.properties,meta:t.meta},Object.keys(n).length&&{options:n}));return i({},e,{last:r,history:e.history.concat(r)})}return e}le=function(){if(!o.isBrowser)return!1;var e=navigator.appVersion;return~e.indexOf("Win")?"Windows":~e.indexOf("Mac")?"MacOS":~e.indexOf("X11")?"UNIX":~e.indexOf("Linux")?"Linux":"Unknown OS"}(),ce=o.isBrowser?document.referrer:null,ue=a.getBrowserLocale(),de=a.getTimeZone();var fe={initialized:!1,sessionId:a.uuid(),app:null,version:null,debug:!1,offline:!!o.isBrowser&&!navigator.onLine,os:{name:le},userAgent:o.isBrowser?navigator.userAgent:"node",library:{name:"analytics",version:"0.11.0"},timezone:de,locale:ue,campaign:{},referrer:ce};function ge(e,t){void 0===e&&(e=fe);var n=e.initialized,r=t.campaign;switch(t.type){case N.campaign:return i({},e,{campaign:r});case N.offline:return i({},e,{offline:!0});case N.online:return i({},e,{offline:!1});default:return n?e:i({},fe,e,{initialized:!0})}}var ve=["plugins","reducers","storage"];function ye(e,t,n){if(o.isBrowser){var r=window[(n?"add":"remove")+"EventListener"];e.split(" ").forEach((function(e){r(e,t)}))}}function be(e){var t=ye.bind(null,"online offline",(function(t){return Promise.resolve(!navigator.onLine).then(e)}));return t(!0),function(e){return t(!1)}}function Ee(){return s.set("analytics",[]),function(e){return function(t,n,r){var a=e(t,n,r),o=a.dispatch;return Object.assign(a,{dispatch:function(e){return s.globalContext[s.KEY].analytics.push(e.action||e),o(e)}})}}}function we(e){return function(){return f(f.apply(null,arguments),Ee())}}function Ie(e){return e?o.isArray(e)?e:[e]:[]}function xe(e,t,n){void 0===e&&(e={});var r,s,l=a.uuid();return t&&(O[l]=(r=t,s=function(e){for(var t,n=e||Array.prototype.slice.call(arguments),r=0;r<n.length;r++)if(o.isFunction(n[r])){t=n[r];break}return t}(n),function(e){s&&s(e),r(e)})),i({},e,{rid:l,ts:(new Date).getTime()},t?{hasCallback:!0}:{})}function Se(e){void 0===e&&(e={});var t,n=e.reducers||{},r=e.initialUser||{},d=(e.plugins||[]).reduce((function(e,t){if(o.isFunction(t))return e.middlewares=e.middlewares.concat(t),e;if(t.NAMESPACE&&(t.name=t.NAMESPACE),!t.name)throw new Error("https://lytics.dev/errors/1");var n=t.EVENTS?Object.keys(t.EVENTS).map((function(e){return t.EVENTS[e]})):[];e.pluginEnabled[t.name]=!(!1===t.enabled||t.config&&!1===t.config.enabled),delete t.enabled,t.methods&&(e.methods[t.name]=Object.keys(t.methods).reduce((function(e,n){var r;return e[n]=(r=t.methods[n],function(){for(var e=Array.prototype.slice.call(arguments),t=new Array(r.length),n=0;n<e.length;n++)t[n]=e[n];return t[t.length]=se,r.apply({instance:se},t)}),e}),{}),delete t.methods);var r=Object.keys(t).concat(n),a=new Set(e.events.concat(r));if(e.events=Array.from(a),e.pluginsArray=e.pluginsArray.concat(t),e.plugins[t.name])throw new Error(t.name+"AlreadyLoaded");return e.plugins[t.name]=t,e.plugins[t.name].loaded||(e.plugins[t.name].loaded=function(){return!0}),e}),{plugins:{},pluginEnabled:{},methods:{},pluginsArray:[],middlewares:[],events:[]}),h=e.storage?e.storage:{getItem:s.get,setItem:s.set,removeItem:s.remove},E=(t=h,function(e,n,r){return n.getState("user")[e]||(r&&o.isObject(r)&&r[e]?r[e]:C(t)[e]||s.get(k(e))||null)}),O=d.plugins,R=d.events.filter((function(e){return!S.includes(e)})).sort(),L=new Set(R.concat(x).filter((function(e){return!S.includes(e)}))),P=Array.from(L).sort(),j=function(){return O},B=new J,U=B.addMiddleware,F=B.removeMiddleware,G=B.dynamicMiddlewares,H=function(){throw new Error("Abort disabled inListener")},V=a.paramsParse(),$=C(h),q=i({},$,r,V.an_uid?{userId:V.an_uid}:{},V.an_aid?{anonymousId:V.an_aid}:{});q.anonymousId||(q.anonymousId=a.uuid());var z,W,Y,K,ee,te,ne,re=i({enable:function(e,t){return new Promise((function(n){Te.dispatch({type:N.enablePlugin,plugins:Ie(e),_:{originalAction:N.enablePlugin}},n,[t])}))},disable:function(e,t){return new Promise((function(n){Te.dispatch({type:N.disablePlugin,plugins:Ie(e),_:{originalAction:N.disablePlugin}},n,[t])}))}},d.methods),se={identify:function(e,t,n,r){try{var a=o.isString(e)?e:null,l=o.isObject(e)?e:t,c=n||{},u=se.user();s.set(k(w),a);var d=a||l.userId||E(w,se,l);return Promise.resolve(new Promise((function(e){Te.dispatch(i({type:N.identifyStart,userId:d,traits:l||{},options:c,anonymousId:u.anonymousId},u.id&&u.id!==a&&{previousId:u.id}),e,[t,n,r])})))}catch(e){return Promise.reject(e)}},track:function(e,t,n,r){try{var a=o.isObject(e)?e.event:e;if(!a||!o.isString(a))throw new Error("EventMissing");var s=o.isObject(e)?e:t||{},i=o.isObject(n)?n:{};return Promise.resolve(new Promise((function(e){Te.dispatch({type:N.trackStart,event:a,properties:s,options:i,userId:E(w,se,t),anonymousId:E(I,se,t)},e,[t,n,r])})))}catch(e){return Promise.reject(e)}},page:function(e,t,n){try{var r=o.isObject(e)?e:{},a=o.isObject(t)?t:{};return Promise.resolve(new Promise((function(s){Te.dispatch({type:N.pageStart,properties:he(r),options:a,userId:E(w,se,r),anonymousId:E(I,se,r)},s,[e,t,n])})))}catch(e){return Promise.reject(e)}},user:function(e){if(e===w||"id"===e)return E(w,se);if(e===I||"anonId"===e)return E(I,se);var t=se.getState("user");return e?a.dotProp(t,e):t},reset:function(e){return new Promise((function(t){Te.dispatch({type:N.resetStart},t,e)}))},ready:function(e){return se.on(N.ready,e)},on:function(e,t){if(!e||!o.isFunction(t))return!1;if(e===N.bootstrap)throw new Error(".on disabled for "+e);var n=/Start$|Start:/;if("*"===e){var r=function(e){return function(e){return function(r){return r.type.match(n)&&t({payload:r,instance:se,plugins:O}),e(r)}}},a=function(e){return function(e){return function(r){return r.type.match(n)||t({payload:r,instance:se,plugins:O}),e(r)}}};return U(r,Ne),U(a,_e),function(){F(r,Ne),F(a,_e)}}var s=e.match(n)?Ne:_e,i=function(n){return function(n){return function(r){return r.type===e&&t({payload:r,instance:se,plugins:O,abort:H}),n(r)}}};return U(i,s),function(){return F(i,s)}},once:function(e,t){if(!e||!o.isFunction(t))return!1;if(e===N.bootstrap)throw new Error(".once disabled for "+e);var n=se.on(e,(function(e){t({payload:e.payload,instance:se,plugins:O,abort:H}),n()}));return n},getState:function(e){var t=Te.getState();return e?a.dotProp(t,e):Object.assign({},t)},dispatch:function(e){var t=o.isString(e)?{type:e}:e;if(x.includes(t.type))throw new Error("reserved action "+t.type);var n=i({},t,{_:i({originalAction:t.type},e._||{})});Te.dispatch(n)},enablePlugin:re.enable,disablePlugin:re.disable,plugins:re,storage:{getItem:h.getItem,setItem:function(e,t,n){Te.dispatch({type:N.setItemStart,key:e,value:t,options:n})},removeItem:function(e,t){Te.dispatch({type:N.removeItemStart,key:e,options:t})}},setAnonymousId:function(e,t){se.storage.setItem(v,e,t)},events:{core:x,plugins:R}},ie=d.middlewares.concat([function(e){return function(e){return function(t){return t.meta||(t.meta=xe()),e(t)}}},G(Ne),Q(se,j,{all:P,plugins:R}),X(h),(te=se,ne=te.storage.setItem,function(e){return function(t){return function(n){if(n.type===N.bootstrap){var r=n.params,a=n.user,s=n.persistedUser,o=n.initialUser,l=s.userId===a.userId;s.anonymousId!==a.anonymousId&&ne(v,a.anonymousId),l||ne(y,a.userId),o.traits&&ne(b,i({},l&&s.traits?s.traits:{},o.traits));var c=Object.keys(n.params);if(c.length){var u=r.an_uid,d=r.an_event,h=c.reduce((function(e,t){if(t.match(_)||t.match(/^(d|g)clid/)){var n=t.replace(_,"");e.campaign["campaign"===n?"name":n]=r[t]}return t.match(T)&&(e.props[t.replace(T,"")]=r[t]),t.match(M)&&(e.traits[t.replace(M,"")]=r[t]),e}),{campaign:{},props:{},traits:{}});e.dispatch(i({type:N.params,raw:r},h,u?{userId:u}:{})),u&&setTimeout((function(){return te.identify(u,h.traits)}),0),d&&setTimeout((function(){return te.track(d,h.props)}),0),Object.keys(h.campaign).length&&e.dispatch({type:N.campaign,campaign:h.campaign})}}return t(n)}}}),(z=se,W=z.storage,Y=W.setItem,K=W.removeItem,ee=W.getItem,function(e){return function(t){return function(n){var r=n.userId,o=n.traits,l=n.options;if(n.type===N.reset&&([y,b,v].forEach((function(e){K(e)})),[w,I,"traits"].forEach((function(e){s.remove(k(e))}))),n.type===N.identify){ee(v)||Y(v,a.uuid());var c=ee(y),u=ee(b)||{};c&&c!==r&&e.dispatch({type:N.userIdChanged,old:{userId:c,traits:u},new:{userId:r,traits:o},options:l}),r&&Y(y,r),o&&Y(b,i({},u,o))}return t(n)}}}),G(_e)]),le={context:ge,user:A(h),page:me,track:ae,plugins:Z(j),queue:oe},ce=f,ue=f;if(o.isBrowser&&e.debug){var de=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__;de&&(ce=de({trace:!0,traceLimit:25})),ue=function(){return 0===arguments.length?Ee():o.isObject(typeof arguments[0])?we():we().apply(null,arguments)}}var pe,fe=function(e){return Object.keys(e).reduce((function(t,n){return ve.includes(n)||(t[n]=e[n]),t}),{})}(e),ye=d.pluginsArray.reduce((function(e,t){var n=t.name,r=t.config,a=t.loaded,s=d.pluginEnabled[n];return e[n]={enabled:s,initialized:!!s&&Boolean(!t.initialize),loaded:Boolean(a()),config:r||{}},e}),{}),Se={context:fe,user:q,plugins:ye},Te=p(function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++){var a=t[r];typeof e[a]===l&&(n[a]=e[a])}var s,o=Object.keys(n);try{!function(e){Object.keys(e).forEach((function(t){var n=e[t];if(typeof n(void 0,{type:"@@redux/INIT"})===c||typeof n(void 0,{type:u})===c)throw new Error("reducer "+t+" "+c)}))}(n)}catch(e){s=e}return function(e,t){if(void 0===e&&(e={}),s)throw s;for(var r=!1,a={},i=0;i<o.length;i++){var l=o[i],u=e[l],d=(0,n[l])(u,t);if(typeof d===c){var h=m(l,t);throw new Error(h)}a[l]=d,r=r||d!==u}return r?a:e}}(i({},le,n)),Se,ue(ce(g.apply(void 0,ie))));Te.dispatch=(pe=Te.dispatch,function(e,t,n){var r=i({},e,{meta:xe(e.meta,t,Ie(n))});return pe.apply(null,[r])});var Me=Object.keys(O);Te.dispatch({type:N.bootstrap,plugins:Me,config:fe,params:V,user:q,initialUser:r,persistedUser:$});var Ae=Me.filter((function(e){return d.pluginEnabled[e]})),Ce=Me.filter((function(e){return!d.pluginEnabled[e]}));return Te.dispatch({type:N.registerPlugins,plugins:Me,enabled:d.pluginEnabled}),d.pluginsArray.map((function(e,t){var n=e.bootstrap,r=e.config,a=e.name;n&&o.isFunction(n)&&n({instance:se,config:r,payload:e}),Te.dispatch({type:N.registerPluginType(a),name:a,enabled:d.pluginEnabled[a],plugin:e}),d.pluginsArray.length===t+1&&Te.dispatch({type:N.initializeStart,plugins:Ae,disabled:Ce})})),be((function(e){Te.dispatch({type:e?N.offline:N.online})})),function(e,t,n){setInterval((function(){return D(e,t,n)}),3e3)}(Te,j,se),se}var Ne="before",_e="after"},{"analytics-utils":"fcceB","@analytics/global-storage-utils":"eAh5e","@analytics/type-utils":"cTB4S","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],fcceB:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"dotProp",(()=>o.default)),r.export(n,"decodeUri",(()=>i)),r.export(n,"getBrowserLocale",(()=>l)),r.export(n,"getTimeZone",(()=>c)),r.export(n,"isExternalReferrer",(()=>u)),r.export(n,"isScriptLoaded",(()=>d)),r.export(n,"paramsClean",(()=>h)),r.export(n,"paramsGet",(()=>p)),r.export(n,"paramsParse",(()=>m)),r.export(n,"paramsRemove",(()=>g)),r.export(n,"parseReferrer",(()=>w)),r.export(n,"throttle",(()=>N)),r.export(n,"url",(()=>E)),r.export(n,"uuid",(()=>S));var a=e("@analytics/type-utils"),s=e("dlv"),o=r.interopDefault(s);function i(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function l(){if(a.isBrowser){var e=navigator,t=e.languages;return e.userLanguage||(t&&t.length?t[0]:e.language)}}function c(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}}function u(e){if(!a.isBrowser)return!1;var t=e||document.referrer;if(t){var n=window.document.location.port,r=t.split("/")[2];return n&&(r=r.replace(":"+n,"")),r!==window.location.hostname}return!1}function d(e){if(!a.isBrowser)return!0;var t=document.getElementsByTagName("script");return!!Object.keys(t).filter((function(n){var r=t[n].src;return a.isString(e)?-1!==r.indexOf(e):!!a.isRegex(e)&&r.match(e)})).length}function h(e,t){var n=(e.split("?")||[,])[1];if(!n||-1===n.indexOf(t))return e;var r=new RegExp("(\\&|\\?)"+t+'([_A-Za-z0-9"+=.\\/\\-@%]+)',"g"),a=("?"+n).replace(r,"").replace(/^&/,"?");return e.replace("?"+n,a)}function p(e,t){return i((RegExp(e+"=(.+?)(&|$)").exec(t)||[,""])[1])}function m(e){return function(e){for(var t,n=Object.create(null),r=/([^&=]+)=?([^&]*)/g;t=r.exec(e);){var a=i(t[1]),s=i(t[2]);"[]"===a.substring(a.length-2)?(n[a=a.substring(0,a.length-2)]||(n[a]=[])).push(s):n[a]=""===s||s}for(var o in n){var l=o.split("[");l.length>1&&(f(n,l.map((function(e){return e.replace(/[?[\]\\ ]/g,"")})),n[o]),delete n[o])}return n}(function(e){if(e){var t=e.match(/\?(.*)/);return t&&t[1]?t[1].split("#")[0]:""}return a.isBrowser&&window.location.search.substring(1)}(e))}function f(e,t,n){for(var r=t.length-1,a=0;a<r;++a){var s=t[a];if("__proto__"===s||"constructor"===s)break;s in e||(e[s]={}),e=e[s]}e[t[r]]=n}function g(e,t){return a.isBrowser?new Promise((function(n,r){if(window.history&&window.history.replaceState){var a=window.location.href,s=h(a,e);a!==s&&history.replaceState({},"",s)}return t&&t(),n()})):Promise.resolve()}function v(e){if(!a.isBrowser)return null;var t=document.createElement("a");return t.setAttribute("href",e),t.hostname}function y(e){return(v(e)||"").split(".").slice(-2).join(".")}function b(e){var t=e.split(".");return t.length>1?t.slice(0,-1).join("."):e}var E={trimTld:b,getDomainBase:y,getDomainHost:v};function w(e,t){if(!a.isBrowser)return!1;var n={source:"(direct)",medium:"(none)",campaign:"(not set)"};e&&u(e)&&(n.referrer=e);var r=function(e){if(!e||!a.isBrowser)return!1;var t=y(e),n=document.createElement("a");if(n.href=e,n.hostname.indexOf("google")>-1&&(t="google"),x[t]){var r=x[t],s=new RegExp(("string"==typeof r?r:r.p)+"=.*?([^&#]*|$)","gi"),o=n.search.match(s);return{source:r.n||b(t),medium:"organic",term:(o?o[0].split("=")[1]:"")||"(not provided)"}}var i=u(e)?"referral":"internal";return{source:n.hostname,medium:i}}(e);r&&Object.keys(r).length&&(n=Object.assign({},n,r));var s=m(t),o=Object.keys(s);if(!o.length)return n;var i=o.reduce((function(e,t){return t.match(/^utm_/)&&(e[""+t.replace(/^utm_/,"")]=s[t]),t.match(/^(d|g)clid/)&&(e.source="google",e.medium=s.gclid?"cpc":"cpm",e[t]=s[t]),e}),{});return Object.assign({},n,i)}var I="q",x={"daum.net":I,"eniro.se":"search_word","naver.com":"query","yahoo.com":"p","msn.com":I,"aol.com":I,"ask.com":I,"baidu.com":"wd","yandex.com":"text","rambler.ru":"words",google:I,"bing.com":{p:I,n:"live"}};function S(){for(var e="",t=0,n=4294967295*Math.random()|0;t++<36;){var r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx"[t-1],a=15&n;e+="-"==r||"4"==r?r:("x"==r?a:3&a|8).toString(16),n=t%8==0?4294967295*Math.random()|0:n>>4}return e}function N(e,t){var n,r,a,s=null,o=0,i=function(){o=new Date,s=null,a=e.apply(n,r)};return function(){var l=new Date;o||(o=l);var c=t-(l-o);return n=this,r=arguments,c<=0?(clearTimeout(s),s=null,o=l,a=e.apply(n,r)):s||(s=setTimeout(i,c)),a}}},{"@analytics/type-utils":"cTB4S",dlv:"2OlTU","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],cTB4S:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"ALL",(()=>I)),r.export(n,"ANY",(()=>w)),r.export(n,"ARRAY",(()=>u)),r.export(n,"ASYNC_FUNCTION",(()=>v)),r.export(n,"ASYNC_GENERATOR_FUNCTION",(()=>b)),r.export(n,"BOOLEAN",(()=>l)),r.export(n,"BUTTON",(()=>M)),r.export(n,"CHANGE",(()=>C)),r.export(n,"ENV",(()=>P)),r.export(n,"ERROR",(()=>m)),r.export(n,"FORM",(()=>_)),r.export(n,"FUNCTION",(()=>s)),r.export(n,"GENERATOR_FUNCTION",(()=>y)),r.export(n,"HIDDEN",(()=>S)),r.export(n,"INPUT",(()=>T)),r.export(n,"NONE",(()=>x)),r.export(n,"NULL",(()=>p)),r.export(n,"NUMBER",(()=>d)),r.export(n,"OBJECT",(()=>c)),r.export(n,"PREFIX",(()=>N)),r.export(n,"REGEX_EMAIL",(()=>R)),r.export(n,"REGEX_ISO",(()=>O)),r.export(n,"REGEX_JSON",(()=>L)),r.export(n,"SELECT",(()=>A)),r.export(n,"STRING",(()=>o)),r.export(n,"SUBMIT",(()=>k)),r.export(n,"SYMBOL",(()=>h)),r.export(n,"SYNTAX_ERROR",(()=>g)),r.export(n,"TYPE_ERROR",(()=>f)),r.export(n,"UNDEFINED",(()=>i)),r.export(n,"ctorName",(()=>ye)),r.export(n,"ensureArray",(()=>We)),r.export(n,"getType",(()=>Q)),r.export(n,"getTypeName",(()=>K)),r.export(n,"isArguments",(()=>Ae)),r.export(n,"isArray",(()=>le)),r.export(n,"isAsyncFunction",(()=>ve)),r.export(n,"isBoolean",(()=>ne)),r.export(n,"isBrowser",(()=>F)),r.export(n,"isBuffer",(()=>Ie)),r.export(n,"isButton",(()=>Ve)),r.export(n,"isClass",(()=>ie)),r.export(n,"isDate",(()=>De)),r.export(n,"isDefined",(()=>te)),r.export(n,"isDeno",(()=>V)),r.export(n,"isDev",(()=>U)),r.export(n,"isElement",(()=>Ue)),r.export(n,"isEmail",(()=>Le)),r.export(n,"isEmpty",(()=>je)),r.export(n,"isError",(()=>xe)),r.export(n,"isErrorLike",(()=>Se)),r.export(n,"isFalse",(()=>Re)),r.export(n,"isFalsy",(()=>ke)),r.export(n,"isForm",(()=>He)),r.export(n,"isFunction",(()=>J)),r.export(n,"isGenerator",(()=>fe)),r.export(n,"isGeneratorFunction",(()=>ge)),r.export(n,"isHidden",(()=>ze)),r.export(n,"isInput",(()=>$e)),r.export(n,"isIsoDate",(()=>Pe)),r.export(n,"isJsDom",(()=>q)),r.export(n,"isJson",(()=>de)),r.export(n,"isLocalHost",(()=>G)),r.export(n,"isMap",(()=>Ee)),r.export(n,"isMethod",(()=>pe)),r.export(n,"isNoOp",(()=>Me)),r.export(n,"isNode",(()=>H)),r.export(n,"isNodeList",(()=>Be)),r.export(n,"isNodeType",(()=>Fe)),r.export(n,"isNull",(()=>ae)),r.export(n,"isNumber",(()=>se)),r.export(n,"isNumberLike",(()=>oe)),r.export(n,"isObject",(()=>ce)),r.export(n,"isObjectLike",(()=>ue)),r.export(n,"isPrimitive",(()=>he)),r.export(n,"isProd",(()=>j)),r.export(n,"isPromise",(()=>me)),r.export(n,"isRegex",(()=>we)),r.export(n,"isSelect",(()=>qe)),r.export(n,"isSet",(()=>be)),r.export(n,"isStaging",(()=>B)),r.export(n,"isString",(()=>Z)),r.export(n,"isSymbol",(()=>re)),r.export(n,"isSyntaxError",(()=>Te)),r.export(n,"isTrue",(()=>Oe)),r.export(n,"isTruthy",(()=>Ce)),r.export(n,"isTypeError",(()=>_e)),r.export(n,"isUndefined",(()=>ee)),r.export(n,"isWebWorker",(()=>$)),r.export(n,"noOp",(()=>E));var a=e("process"),s="function",o="string",i="undefined",l="boolean",c="object",u="array",d="number",h="symbol",p="null",m="error",f="typeError",g="syntaxError",v="asyncFunction",y="generatorFunction",b="asyncGeneratorFunction",E=function(){},w="any",I="*",x="none",S="hidden",N="__",_="form",T="input",M="button",A="select",C="change",k="submit",O=/^\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)$/,R=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,L=/^\{[\s\S]*\}$|^\[[\s\S]*\]$/,D=void 0!==a?a:{},P=D.env&&D.env.NODE_ENV||"",j="production"===P,B="staging"===P,U="development"===P,F="undefined"!=typeof window,G=F&&"localhost"===window.location.hostname,H=null!=D.versions&&null!=D.versions.node,V="undefined"!=typeof Deno&&void 0!==Deno.core,$="object"==typeof self&&self.constructor&&"DedicatedWorkerGlobalScope"===self.constructor.name,q=F&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"));function z(e,t){return t.charAt(0)[e]()+t.slice(1)}var W=z.bind(null,"toUpperCase"),Y=z.bind(null,"toLowerCase");function K(e){return ae(e)?W("null"):"object"==typeof e?ye(e):Object.prototype.toString.call(e).slice(8,-1)}function Q(e,t){void 0===t&&(t=!0);var n=K(e);return t?Y(n):n}function X(e,t){return typeof t===e}var J=X.bind(null,"function"),Z=X.bind(null,"string"),ee=X.bind(null,"undefined");function te(e){return!ee(e)}var ne=X.bind(null,"boolean"),re=X.bind(null,"symbol");function ae(e){return null===e}function se(e){return"number"===Q(e)&&!isNaN(e)}function oe(e){return!isNaN(parseFloat(e))}function ie(e){return!!J(e)&&/^class /.test(Function.prototype.toString.call(e))}function le(e){return"array"===Q(e)}function ce(e){if(!ue(e))return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function ue(e){return e&&("object"==typeof e||null!==e)}function de(e){if(!Z(e)||!L.test(e))return!1;try{JSON.parse(e)}catch(e){return!1}return!0}function he(e){if(ae(e))return!0;switch(typeof e){case"string":case"number":case"symbol":case"undefined":case"boolean":return!0;default:return!1}}function pe(e,t){return ce(e)&&J(e[t])}function me(e){return!!e&&!!(!ee(Promise)&&e instanceof Promise||e.then&&J(e.then))}function fe(e){return ue(e)&&J(e.throw)&&J(e.return)&&J(e.next)}function ge(e){return"generatorFunction"===Q(e)}function ve(e){return"asyncFunction"===Q(e)}function ye(e){return J(e.constructor)?e.constructor.name:null}function be(e){return e instanceof Set}function Ee(e){return e instanceof Map}function we(e){return e instanceof RegExp}function Ie(e){return!(!e.constructor||!J(e.constructor.isBuffer))&&e.constructor.isBuffer(e)}function xe(e){return e instanceof Error||Z(e.message)&&e.constructor&&se(e.constructor.stackTraceLimit)}function Se(e){return ue(e)&&Z(e.message)&&Z(e.name)}function Ne(e,t){if("object"!=typeof t||ae(t))return!1;if(t instanceof e)return!0;var n=Q(new e(""));if(xe(t))for(;t;){if(Q(t)===n)return!0;t=Object.getPrototypeOf(t)}return!1}var _e=Ne.bind(null,TypeError),Te=Ne.bind(null,SyntaxError);function Me(e){if(!J(e))return!1;var t=/{(\r|\n|\s)*}/gm,n=E+"";return n===(e.toString().match(t)||[""])[0].replace(t,n)}function Ae(e){try{if(se(e.length)&&J(e.callee))return!0}catch(e){if(-1!==e.message.indexOf("callee"))return!0}return!1}function Ce(e){return!(Z(e)&&"false"===e.toLowerCase()||!e)}function ke(e){return!e}function Oe(e){return!0===e}function Re(e){return!1===e}function Le(e){return!(e.length>320)&&R.test(e)}function De(e){return e instanceof Date||J(e.toDateString)&&J(e.getDate)&&J(e.setDate)}function Pe(e){return O.test(e)}function je(e){return!(!ae(e)&&(le(e)?e.length:be(e)||Ee(e)?e.size:ce(e)&&Object.keys(e).length))}function Be(e){return NodeList.prototype.isPrototypeOf(e)}function Ue(e,t){var n=e instanceof Element||e instanceof HTMLDocument;return n&&t?Fe(e,t):n}function Fe(e,t){return void 0===t&&(t=""),e&&e.nodeName===t.toUpperCase()}function Ge(e){var t=[].slice.call(arguments,1);return function(){return e.apply(void 0,[].slice.call(arguments).concat(t))}}var He=Ge(Ue,"form"),Ve=Ge(Ue,"button"),$e=Ge(Ue,"input"),qe=Ge(Ue,"select");function ze(e,t){if(!e||"hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(null!=t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}function We(e){return e?le(e)?e:[e]:[]}},{process:"5xM3z","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"5xM3z":[function(e,t,n){var r,a,s=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function l(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{a="function"==typeof clearTimeout?clearTimeout:i}catch(e){a=i}}();var c,u=[],d=!1,h=-1;function p(){d&&c&&(d=!1,c.length?u=c.concat(u):h=-1,u.length&&m())}function m(){if(!d){var e=l(p);d=!0;for(var t=u.length;t;){for(c=u,u=[];++h<t;)c&&c[h].run();h=-1,t=u.length}c=null,d=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===i||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new f(e,t)),1!==u.length||d||l(m)},f.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=g,s.addListener=g,s.once=g,s.off=g,s.removeListener=g,s.removeAllListeners=g,s.emit=g,s.prependListener=g,s.prependOnceListener=g,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},{}],"2OlTU":[function(e,t,n){t.exports=function(e,t,n,r,a){for(t=t.split?t.split("."):t,r=0;r<t.length;r++)e=e?e[t[r]]:a;return e===a?n:e}},{}],eAh5e:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"GLOBAL",(()=>o)),r.export(n,"KEY",(()=>i)),r.export(n,"get",(()=>c)),r.export(n,"globalContext",(()=>l)),r.export(n,"hasSupport",(()=>m)),r.export(n,"remove",(()=>d)),r.export(n,"set",(()=>u)),r.export(n,"wrap",(()=>h));var a=e("@analytics/type-utils"),s=arguments[3],o="global",i=a.PREFIX+"global"+a.PREFIX,l=typeof self===a.OBJECT&&self.self===self&&self||typeof s===a.OBJECT&&s.global===s&&s||void 0;function c(e){return l[i][e]}function u(e,t){return l[i][e]=t}function d(e){delete l[i][e]}function h(e,t,n){var r;try{if(m(e)){var a=window[e];r=a[t].bind(a)}}catch(e){}return r||n}l[i]||(l[i]={});var p={};function m(e){if(typeof p[e]!==a.UNDEFINED)return p[e];try{var t=window[e];t.setItem(a.UNDEFINED,a.UNDEFINED),t.removeItem(a.UNDEFINED)}catch(t){return p[e]=!1}return p[e]=!0}},{"@analytics/type-utils":"cTB4S","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],f4AHx:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"GLOBAL",(()=>a.GLOBAL)),r.export(n,"globalContext",(()=>a.globalContext)),r.export(n,"COOKIE",(()=>s.COOKIE)),r.export(n,"getCookie",(()=>s.getCookie)),r.export(n,"hasCookies",(()=>s.hasCookies)),r.export(n,"removeCookie",(()=>s.removeCookie)),r.export(n,"setCookie",(()=>s.setCookie)),r.export(n,"LOCAL_STORAGE",(()=>o.LOCAL_STORAGE)),r.export(n,"hasLocalStorage",(()=>o.hasLocalStorage)),r.export(n,"SESSION_STORAGE",(()=>i.SESSION_STORAGE)),r.export(n,"hasSessionStorage",(()=>i.hasSessionStorage)),r.export(n,"ALL",(()=>l.ALL)),r.export(n,"ANY",(()=>l.ANY)),r.export(n,"default",(()=>x)),r.export(n,"getItem",(()=>p)),r.export(n,"removeItem",(()=>f)),r.export(n,"setItem",(()=>m));var a=e("@analytics/global-storage-utils"),s=e("@analytics/cookie-utils"),o=e("@analytics/localstorage-utils"),i=e("@analytics/session-storage-utils"),l=e("@analytics/type-utils");function c(e){var t=e;try{if("true"===(t=JSON.parse(e)))return!0;if("false"===t)return!1;if(l.isObject(t))return t;parseFloat(t)===t&&(t=parseFloat(t))}catch(e){}if(null!==t&&""!==t)return t}var u=o.hasLocalStorage(),d=i.hasSessionStorage(),h=s.hasCookies();function p(e,t){if(e){var n=g(t),r=!E(n),o=v(n)?c(localStorage.getItem(e)):void 0;if(r&&!l.isUndefined(o))return o;var i=y(n)?c(s.getCookie(e)):void 0;if(r&&i)return i;var u=b(n)?c(sessionStorage.getItem(e)):void 0;if(r&&u)return u;var d=a.get(e);return r?d:{localStorage:o,sessionStorage:u,cookie:i,global:d}}}function m(e,t,n){if(e&&!l.isUndefined(t)){var r={},u=g(n),d=JSON.stringify(t),h=!E(u);return v(u)&&(r[o.LOCAL_STORAGE]=I(o.LOCAL_STORAGE,t,c(localStorage.getItem(e))),localStorage.setItem(e,d),h)?r[o.LOCAL_STORAGE]:y(u)&&(r[s.COOKIE]=I(s.COOKIE,t,c(s.getCookie(e))),s.setCookie(e,d),h)?r[s.COOKIE]:b(u)&&(r[i.SESSION_STORAGE]=I(i.SESSION_STORAGE,t,c(sessionStorage.getItem(e))),sessionStorage.setItem(e,d),h)?r[i.SESSION_STORAGE]:(r[a.GLOBAL]=I(a.GLOBAL,t,a.get(e)),a.set(e,t),h?r[a.GLOBAL]:r)}}function f(e,t){if(e){var n=g(t),r=p(e,l.ALL),c={};return!l.isUndefined(r.localStorage)&&v(n)&&(localStorage.removeItem(e),c[o.LOCAL_STORAGE]=r.localStorage),!l.isUndefined(r.cookie)&&y(n)&&(s.removeCookie(e),c[s.COOKIE]=r.cookie),!l.isUndefined(r.sessionStorage)&&b(n)&&(sessionStorage.removeItem(e),c[i.SESSION_STORAGE]=r.sessionStorage),!l.isUndefined(r.global)&&w(n,a.GLOBAL)&&(a.remove(e),c[a.GLOBAL]=r.global),c}}function g(e){return e?l.isString(e)?e:e.storage:l.ANY}function v(e){return u&&w(e,o.LOCAL_STORAGE)}function y(e){return h&&w(e,s.COOKIE)}function b(e){return d&&w(e,i.SESSION_STORAGE)}function E(e){return e===l.ALL||"all"===e}function w(e,t){return e===l.ANY||e===t||E(e)}function I(e,t,n){return{location:e,current:t,previous:n}}var x={setItem:m,getItem:p,removeItem:f}},{"@analytics/global-storage-utils":"eAh5e","@analytics/cookie-utils":"83XMz","@analytics/localstorage-utils":"iyhA3","@analytics/session-storage-utils":"65YBC","@analytics/type-utils":"cTB4S","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"83XMz":[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"COOKIE",(()=>s)),r.export(n,"getCookie",(()=>i)),r.export(n,"hasCookies",(()=>u)),r.export(n,"removeCookie",(()=>c)),r.export(n,"setCookie",(()=>l));var a=e("@analytics/global-storage-utils"),s="cookie",o=u(),i=d,l=d;function c(e){return o?d(e,"",-1):a.remove(e)}function u(){if(void 0!==o)return o;var e="cookiecookie";try{d(e,e),o=-1!==document.cookie.indexOf(e),c(e)}catch(e){o=!1}return o}function d(e,t,n,r,s,i){if("undefined"!=typeof window){var l=arguments.length>1;return!1===o&&(l?a.set(e,t):a.get(e)),l?document.cookie=e+"="+encodeURIComponent(t)+(n?"; expires="+new Date(+new Date+1e3*n).toUTCString()+(r?"; path="+r:"")+(s?"; domain="+s:"")+(i?"; secure":""):""):decodeURIComponent((("; "+document.cookie).split("; "+e+"=")[1]||"").split(";")[0])}}},{"@analytics/global-storage-utils":"eAh5e","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],iyhA3:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"LOCAL_STORAGE",(()=>s)),r.export(n,"getItem",(()=>i)),r.export(n,"hasLocalStorage",(()=>o)),r.export(n,"removeItem",(()=>c)),r.export(n,"setItem",(()=>l));var a=e("@analytics/global-storage-utils"),s="localStorage",o=a.hasSupport.bind(null,"localStorage"),i=a.wrap("localStorage","getItem",a.get),l=a.wrap("localStorage","setItem",a.set),c=a.wrap("localStorage","removeItem",a.remove)},{"@analytics/global-storage-utils":"eAh5e","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"65YBC":[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"SESSION_STORAGE",(()=>s)),r.export(n,"getSessionItem",(()=>i)),r.export(n,"hasSessionStorage",(()=>o)),r.export(n,"removeSessionItem",(()=>c)),r.export(n,"setSessionItem",(()=>l));var a=e("@analytics/global-storage-utils"),s="sessionStorage",o=a.hasSupport.bind(null,"sessionStorage"),i=a.wrap("sessionStorage","getItem",a.get),l=a.wrap("sessionStorage","setItem",a.set),c=a.wrap("sessionStorage","removeItem",a.remove)},{"@analytics/global-storage-utils":"eAh5e","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"396Ua":[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){a(e,t,n[t])}))}return e}r.defineInteropFlag(n),r.export(n,"init",(()=>b)),r.export(n,"identify",(()=>x)),r.export(n,"track",(()=>I)),r.export(n,"page",(()=>w)),r.export(n,"initialize",(()=>E));var o={trackingId:null,debug:!1,anonymizeIp:!1,customDimensions:{},resetCustomDimensionsOnPage:[],setCustomDimensionsToPage:!0},i={};function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!1,n=u(e),r=n.instanceName,a=n.instancePrefix;return{name:"google-analytics",config:s({},o,e),initialize:function(e){var t=e.config,n=e.instance;if(!t.trackingId)throw new Error("No GA trackingId defined");var o,l,u,d,h,m,f,g=t.customDimensions,v=t.customScriptSrc||"https://www.google-analytics.com/analytics.js";if(c(v)&&(o=window,l=document,u="script",d=v,h="ga",o.GoogleAnalyticsObject=h,o.ga=o.ga||function(){(o.ga.q=o.ga.q||[]).push(arguments)},o.ga.l=1*new Date,m=l.createElement(u),f=l.getElementsByTagName(u)[0],m.async=1,m.src=d,f.parentNode.insertBefore(m,f)),!i[r]){var y=s({cookieDomain:t.domain||"auto",siteSpeedSampleRate:t.siteSpeedSampleRate||1,sampleRate:t.sampleRate||100,allowLinker:!0},t.cookieConfig);if(r&&(y.name=r),ga("create",t.trackingId,y),t.debug&&(ga("".concat(a,"set"),"sendHitTask",null),window.ga_debug={trace:!0}),t.anonymizeIp&&ga("".concat(a,"set"),"anonymizeIp",!0),t.tasks){["customTask","previewTask","checkProtocolTask","validationTask","checkStorageTask","historyImportTask","samplerTask","buildHitTask","sendHitTask","timingTask","displayFeaturesTask"].forEach((function(e){if(t.tasks.hasOwnProperty(e)){var n=t.tasks[e];"function"==typeof n?ga(t.tasks[e]):null===n&&ga("".concat(a,"set"),e,n)}}))}var b=(n.user()||{}).traits||{};if(Object.keys(b).length&&g&&Object.keys(g).length){var E=p(b,t);ga("".concat(a,"set"),E)}i[r]=!0}},page:function(e){var n=e.payload,r=e.config,o=e.instance,i=n.properties,l=r.resetCustomDimensionsOnPage,u=r.customDimensions,d=o.getState("context.campaign");if(!c()){if(l&&l.length){var p=l.reduce((function(e,t){return u[t]&&(e[u[t]]=null),e}),{});Object.keys(p).length&&ga("".concat(a,"set"),p)}var m=i.path||document.location.pathname,g={page:m,title:i.title,location:i.url},v={page:m,title:i.title};i.referrer!==document.referrer&&(v.referrer=i.referrer);var y=s({},g,h(d),f(i,r,a));ga("".concat(a,"set"),v),t&&delete y.location,ga("".concat(a,"send"),"pageview",y),t=!0}},track:function(e){var t=e.payload,n=e.config,r=e.instance,a=t.properties,s=t.event,o=a.label,i=a.value;d({hitType:"event",event:s,label:o,category:a.category||"All",value:i,nonInteraction:a.nonInteraction,campaign:r.getState("context.campaign")},n,t)},identify:function(e){var t=e.payload,n=e.config;g(t.userId,t.traits,n)},loaded:function(){return!!window.gaplugins}}}function c(e){return e?!function(e){var t=document.querySelectorAll("script[src]");return!!Object.keys(t).filter((function(n){return(t[n].src||"")===e})).length}(e):"undefined"==typeof ga}function u(e){var t=e.instanceName;return{instancePrefix:t?"".concat(t,"."):"",instanceName:t}}function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;if(!c()){var r=u(t),a=r.instancePrefix,o={hitType:e.hitType||"event",eventAction:e.event,eventLabel:e.label,eventCategory:e.category||"All",nonInteraction:void 0!==e.nonInteraction&&!!e.nonInteraction};e.value&&(o.eventValue=v(e.value));var i=h(e),l=f(n.properties,t,a),d=s({},o,i,l);return ga("".concat(a,"send"),"event",d),d}}function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={},n=e.name,r=e.source,a=e.medium,s=e.content,o=e.keyword;return n&&(t.campaignName=n),r&&(t.campaignSource=r),a&&(t.campaignMedium=a),s&&(t.campaignContent=s),o&&(t.campaignKeyword=o),t}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.customDimensions;return Object.keys(n).reduce((function(t,r){var a=n[r],s=m(e,r)||e[r];return"boolean"==typeof s&&(s=s.toString()),s||0===s?(t[a]=s,t):t}),{})}function m(e,t,n,r,a){for(t=t.split?t.split("."):t,r=0;r<t.length;r++)e=e?e[t[r]]:a;return e===a?n:e}function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=p(e,t);return Object.keys(r).length?t.setCustomDimensionsToPage?(ga("".concat(n,"set"),r),{}):r:{}}function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!c()){var r=u(n),a=r.instancePrefix;if(e&&ga("".concat(a,"set"),"userId",e),Object.keys(t).length){var s=p(t,n);ga("".concat(a,"set"),s)}}}function v(e){return!e||e<0?0:Math.round(e)}var y=l,b=l,E=void 0,w=void 0,I=d,x=g;n.default=y},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],iikaL:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"EYE_COLOURS",(()=>m));var a=e("./maths/maths"),s=(e("./maths/easing"),e("./timing/timing.js"),e("./audio/audio")),o=e("./audio/notes"),i=e("./audio/instruments"),l=e("./dom/ui"),c=e("./parameter-recorder"),u=e("./visual/2d"),d=e("./visual/2d.eyes"),h=e("./visual/2d.mouth"),p=e("./settings");const m=["blue","green","brown","orange"];n.default=class{constructor(e,t,n,r={}){if(this.options=Object.assign({},p.DEFAULT_PERSON_OPTIONS,r),this.name=e,this.counter=0,this.instrumentPointer=0,this.instrumentLoading=!1,this.data=null,this.active=!1,this.audioContext=t,this.tracks=0,this.octave=4,this.midi=null,this.midiActive=!1,this.midiChannel="all",this.isLooping=!1,this.isPlayingBack=!1,this.setPalette(this.options),this.precision=Math.pow(10,parseInt(this.options.precision)),this.parameterRecorder=new c.ParamaterRecorder(t),this.yaw=0,this.pitch=0,this.roll=0,this.singing=!1,this.isMouthOpen=!1,this.isLeftEyeOpen=!0,this.isRightEyeOpen=!0,this.isRecordingParameters=!1,this.mouseDownAt=-1,this.leftEyeClosedAt=-1,this.rightEyeClosedAt=-1,this.lastNoteName="A0",this.lastNoteSound="-",this.debug=this.options.debug,this.mouthScale=a.rescale(this.options.mouthCutOff),this.gainNode=t.createGain(),this.gainNode.gain.value=0,this.options.stereoPan?(this.stereoNode=t.createStereoPanner(),this.stereoNode.connect(this.gainNode),this.outputNode=this.stereoNode):this.outputNode=this.gainNode,this.options.useDelay){const e=t.createDelay(this.options.delayLength),r=t.createGain();e.delayTime.value=this.options.delayTime,r.gain.value=this.options.feedback,this.gainNode.connect(e),e.connect(n)}else this.gainNode.connect(n);this.button=document.getElementById(e),this.button.addEventListener("mousedown",(e=>{this.mouseDownAt=t.currentTime;const n=()=>{this.mouseDownFor<this.options.mouseHoldDuration?requestAnimationFrame(n):this.isMouseDown&&(this.mouseDownAt=-1,this.showForm())};n(),e.preventDefault()})),this.button.addEventListener("mouseup",(e=>{this.mouseDownFor;this.instrumentLoading||this.loadInstrument(s.randomInstrument()),this.mouseDownAt=-1,e.preventDefault()})),this.button.addEventListener("mouseover",(e=>{this.isMouseOver=!0})),this.button.addEventListener("mouseout",(e=>{this.isMouseOver=!1}))}get areEyesOpen(){return this.isLeftEyeOpen&&this.isRightEyeOpen}get mouseDownFor(){return this.audioContext.currentTime-this.mouseDownAt}get isMouseDown(){return this.mouseDownAt>-1}get isMouseHeld(){return this.options.mouseHoldDuration<this.mouseDownFor}get controlsID(){return`${this.name}-controls`}get controls(){return document.getElementById(this.controlsID)}get instrumentName(){return this.instrument?this.instrument.name:"loading"}get instrumentTitle(){return this.instrument?this.instrument.title:"loading"}get instrumentIndex(){return i.INSTRUMENT_FOLDERS.indexOf(this.instrumentName)}get hasMIDI(){return null!==this.midi&&this.midiChannel&&this.midiChannel.length>0}get MIDIDeviceName(){return this.midi?this.midi.name:"unknown"}get history(){return this.parameterRecorder.recording}setPalette(e){this.saturation=e.saturation,this.luminosity=e.luminosity,this.hueRange=e.hueRange,this.hue=e.hue??Math.random()*this.hueRange}update(e){this.counter++,this.data=e,this.isRecordingParameters&&this.parameterRecorder.save(e),this.isLeftEyeOpen!==!e.leftEyeClosed&&(e.leftEyeClosed?this.onLeftEyeClose(e.time):this.onLeftEyeOpen(e.time-this.leftEyeClosedAt),this.isLeftEyeOpen=!e.leftEyeClosed),this.isRightEyeOpen!==!e.rightEyeClosed&&(e.rightEyeClosed?this.onRightEyeClose(e.time):this.onRightEyeOpen(e.time-this.rightEyeClosedAt),this.isRightEyeOpen=!e.rightEyeClosed)}draw(e,t=!0,n=!1,r=!1){if(!(n||e||this.prediction||this.isPlayingBack))return;e&&!n||(e=this.prediction),this.isPlayingBack;let s=this.hue;this.instrumentLoading&&(s+=120);const i=this.options,l=this.isRightEyeOpen?-1:e.time-this.rightEyeClosedAt,c=this.isLeftEyeOpen?-1:e.time-this.leftEyeClosedAt,p=`${i.saturation}%, ${i.luminosity+(r?10:0)}%`;i.mouth=`hsla(${(s+30)%360},${p},0.8)`,i.mouthClosed=`hsla(${(s+30)%360},${p},0.9)`,i.lipsUpperInner=`hsla(${(s+50)%360},${p},1)`,i.lipsLowerInner=`hsla(${(s+50)%360},${p},1)`,i.midwayBetweenEyes=`hsla(${(s+270)%360},${p},1)`,i.leftEyeLower0=`hsla(${(s+300)%360},${p},0.8)`,i.rightEyeLower0=`hsla(${(s+300)%360},${p},0.8)`,i.leftEyeIris=`hsla(${(this.isLeftEyeOpen?s+90:s-90)%360},${i.saturation}%,${i.luminosity}%, 1)`,i.rightEyeIris=`hsla(${(this.isRightEyeOpen?s+90:s-90)%360},${i.saturation}%, ${i.luminosity}%, 1)`;const m={h:s,s:i.saturation,l:i.luminosity,a:1};if(i.drawMask&&(i.drawNodes||i.drawMesh||!i.meshOnSing?i.drawNodes?u.drawPoints(e,m,3,this.instrumentLoading,this.debug):i.drawMesh&&u.drawFaceMesh(e,m,.5,this.instrumentLoading,this.isMouthOpen,this.debug):this.singing?u.drawFaceMesh(e,m,.5,this.instrumentLoading,this.isMouthOpen,this.debug):u.drawPoints(e,m,3,this.instrumentLoading,this.debug)),i.drawMouth){const t={h:s,s:i.saturation,l:i.luminosity,a:1},n={h:s,s:i.saturation,l:20,a:1};this.isMouthOpen&&this.singing?h.drawMouth(e,t,this.debug):h.drawMouth(e,n,this.debug)}const{bottomRight:f,topLeft:g}=e.boundingBox,v=Math.abs(f[0]-g[0]),y=Math.abs(f[1]-g[1]);this.counter%22==0&&this.button.setAttribute("style",`--${this.name}-x:${f[0]};--${this.name}-y:${g[1]};--${this.name}-w:${v};--${this.name}-h:${y};`);const{annotations:b}=e,{silhouette:E}=b;if((this.instrumentLoading||this.isRightEyeOpen||this.isLeftEyeOpen?-1:Math.max(c,l))>i.eyeShutHolddDuration)this.leftEyeClosedAt=e.time,this.rightEyeClosedAt=e.time,this.loadNextInstrument((e=>console.log("instrumnetName",e)));else if(i.drawEyes){const t={iris:i.leftEyeIris,irisRadius:i.irisRadius,pupil:"rgba(0,0,0,0.8)",pupilRadius:i.pupilRadius,sclera:"white",scleraRadius:i.scleraRadius,ratio:i.eyeRatio},n=a.clamp(e.eyeDirection,-1,1);d.drawEye(b,!0,this.isLeftEyeOpen,n,t),t.iris=i.rightEyeIris,d.drawEye(b,!1,this.isRightEyeOpen,n,t)}if(t)if(this.isMouseOver||this.instrumentLoading)if(this.isMouseDown&&!this.instrumentLoading){const t=1-this.mouseDownFor/this.options.mouseHoldDuration,n=100-Math.ceil(100*t);this.isMouseHeld?(u.drawInstrument(e.boundingBox,this.instrumentTitle,"Select"),u.drawPart(E,4,`hsla(${s},50%,${n}%,0.3)`,!0,!1,!1),u.drawParagraph(e.boundingBox.topLeft[0],e.boundingBox.topLeft[1]+40,["Press me"],"14px")):(u.drawInstrument(e.boundingBox,this.instrumentTitle,""+(100-n)),u.drawPart(E,4,`hsla(${s},50%,${n}%,${t})`,!0),u.drawParagraph(e.boundingBox.topLeft[0],e.boundingBox.topLeft[1]+40,["Hold me to see all instruments"],"14px"))}else u.drawInstrument(e.boundingBox,this.instrumentTitle,"Hold to choose instrument"),u.drawPart(E,4,"hsla("+s+",50%,50%,0.3)",!0);else if(this.instrumentLoading)u.drawInstrument(e.boundingBox,this.instrumentTitle,"loading...");else{const t=(this.debug,` ${o.getNoteText(this.lastNoteName)}`),n=this.singing?`| ♫ ${this.lastNoteSound}`:this.isMouthOpen?"<":"-";if(u.drawInstrument(e.boundingBox,this.instrumentTitle,`${t} ${n}`),this.debug){const t=[`Gain:${this.gainNode.gain.value.toFixed(2)}`,`Happiness:${e.happiness.toFixed(3)}`,`Smirks left:${e.leftSmirk.toFixed(3)} / right:${e.rightSmirk.toFixed(3)}`,`mouthRange:${e.mouthRange.toFixed(3)}`,`mouthRatio:${e.mouthRatio.toFixed(3)}`,`mouthWidth:${e.mouthWidth.toFixed(3)}`,`mouthOpen:${e.mouthOpen.toFixed(3)}`,`pitch:${e.pitch.toFixed(3)} roll:${e.roll.toFixed(3)} yaw:${e.yaw.toFixed(3)}`,`eyes direction:${e.eyeDirection.toFixed(3)} left:${e.leftEye.toFixed(3)} right:${e.rightEye.toFixed(3)}`,`eyes open :${this.areEyesOpen} left:${!e.leftEyeClosed} right:${!e.rightEyeClosed}`,`eye closed left:${e.leftEyeClosed} right:${e.rightEyeClosed}`,`dims:${e.mouthWidth.toFixed(2)}x${e.mouthRange.toFixed(2)}`,(e.lookingRight,"left")];u.drawParagraph(e.boundingBox.topLeft[0],e.boundingBox.topLeft[1]+40,t,"14px")}}}sing(){if(!this.data||this.tracks>18)return{yaw:0,pitch:0,roll:0,lipPercentage:0,eyeDirection:0};const e=[],t=this.data,n=this.options,r=t.mouthOpen,i=t.yaw,l=a.clamp(.5*(t.pitch+1)*this.options.pitchSensitivity,0,1),c=a.clamp((t.roll+.5)*this.options.rollSensitivity,0,1),u=this.options.swapControls?c:l,d=this.options.swapControls?l:c,h=a.clamp(t.eyeDirection,-1,1),p=a.clamp(r,0,1),m=(n.ease(p),Math.round(7*u));this.octave=a.clamp(m,1,7);const f=t.lookingRight,g=o.getNoteName(d,this.octave,f),v=o.getNoteSound(d,f);let y;if(this.lastNoteName=g,this.lastNoteSound=v,this.hue=d*this.hueRange,this.saturation=100*r,this.options.stereoPan&&(this.stereoNode.pan.value=h),this.instrument&&p>=n.mouthCutOff){const t=this.instrument[g];t||console.log("note not found!",{noteName:g,roll:d,octave:this.octave,isMinor:f}),this.tracks++;s.playTrack(t,0,this.outputNode).then((()=>{this.active=!1,this.tracks--}));if(e.push(t),y=this.mouthScale(p),y=n.ease(y),y=Math.round(y*this.precision)/this.precision,this.options.sendMIDI&&this.hasMIDI){const e={};"all"!==this.midiChannel&&(e.channel=this.midiChannel),this.midi.playNote(g,e),console.log(this.midi,"MIDI noteOn",g,"Channel:"+this.midiChannel,{newVolume:y,midiOptions:e,channel:this.midiChannel,hasMIDI:this.hasMIDI}),this.midiActive||(this.midiActive=!0),0!==h&&this.midi.sendKeyAftertouch(g,.5*(h+1))}this.singing=!0,this.isMouthOpen=!0,this.active=!0}else p>n.mouthSilence&&p<n.mouthCutOff?(y=0,this.singing=!1,this.isMouthOpen=!0):(y=0,this.singing=!1,this.isMouthOpen=!1);return this.options.sendMIDI&&this.hasMIDI&&(this.midi.sendClock(),this.singing||(this.midi.stopNote(g,{release:.2}),this.midiActive=!1)),this.gainNode.gain.value=y,this.yaw=i,this.pitch=u,this.roll=d,{played:e,yaw:i,pitch:u,roll:d,lipPercentage:r,eyeDirection:h}}async loadRandomInstrument(e){return await this.loadInstrument(s.randomInstrument(),e)}async loadPreviousInstrument(e){const t=this.instrumentPointer,n=t-1<0?0:t-1;return await this.loadInstrument(i.INSTRUMENT_FOLDERS[n],e)}async loadNextInstrument(e){const t=this.instrumentPointer,n=t+1>=i.INSTRUMENT_FOLDERS.length?0:t+1;return await this.loadInstrument(i.INSTRUMENT_FOLDERS[n],e)}async reloadInstrument(e){return await this.loadInstrument(i.INSTRUMENT_FOLDERS[this.instrumentPointer],e)}async loadInstrument(e,t){return this.instrumentLoading=!0,this.instrument=await s.loadInstrumentPack(e,this.options.instrumentPack),this.instrumentPointer=i.INSTRUMENT_FOLDERS.indexOf(e),this.instrumentLoading=!1,t&&t(e),this.button.dispatchEvent(new CustomEvent("instrumentchange",{detail:{instrument:this.instrument,instrumentName:e}})),e}setMIDI(e,t="all"){this.midiChannel=t,this.midi=e,console.log("MIDI set for person",this,"Channel:"+this.midiChannel,{midi:e,channel:t,hasMIDI:this.hasMIDI})}onInstrumentInput(e){const t=e.target.id;this.hideForm(),this.loadInstrument(t),e.preventDefault()}onLeftEyeOpen(e){this.leftEyeClosedAt=-1}onLeftEyeClose(e){this.leftEyeClosedAt=e}onRightEyeOpen(e){this.rightEyeClosedAt=-1}onRightEyeClose(e){this.rightEyeClosedAt=e}showForm(){this.controls.innerHTML=l.setupInstrumentForm((()=>{}));this.controls.querySelectorAll("input").forEach((e=>e.addEventListener("change",(e=>this.onInstrumentInput(e)))),!1);const e=document.getElementById(this.instrumentName);e?e.focus():this.controls.focus(),this.controls.classList.toggle("showing",!0)}hideForm(){this.controls.innerHTML="",setTimeout((()=>this.controls.classList.toggle("showing",!1)),303)}}},{"./maths/maths":"iDBHd","./maths/easing":"8aGct","./timing/timing.js":"adRuD","./audio/audio":"kGLQw","./audio/notes":"5HewV","./audio/instruments":"ftlvJ","./dom/ui":"dAURW","./parameter-recorder":"gRdVk","./visual/2d":"2Ac2W","./visual/2d.eyes":"fpOBR","./visual/2d.mouth":"kijht","./settings":"h7RGC","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],gRdVk:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"ParamaterRecorder",(()=>a));class a{constructor(e,t={}){this.isRecording=!1,this.context=e,this.parameters,this.startTime}get recording(){return this.parameters}get isActive(){return this.isRecording}reset(){this.parameters={}}save(e){let t=this.context.currentTime;this.isRecording||(this.startTime=t,this.isRecording=!0);const n=this.startTime-t;this.parameters[n]=parameters}getValuesAtTime(e){return this.parameters[e]}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],fpOBR:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"drawEye",(()=>l));var a=e("./canvas"),s=e("../maths/maths"),o=e("../palette");r.interopDefault(o);const i={iris:"rgba(100,255,100,0.8)",irisRadius:1,pupil:"rgba(0,0,0,0.8)",pupilRadius:.3,sclera:"white",scleraRadius:4},l=(e,t=!0,n=!0,r=0,o=i)=>{const l=t?e.leftEyeIris:e.rightEyeIris,c=l[0],u=l[1],d=l[2],h=l[3],p=l[4],m=Math.abs(h[0]-u[0]),f=p[1]-d[1],g=o.ratio||.8,v=.5*Math.max(m,f);if(a.canvasContext.strokeWidth=0,n){const e=v*o.scleraRadius,t=v*o.irisRadius,n=v*o.pupilRadius,i=(e-t)*-r;a.canvasContext.beginPath(),a.canvasContext.arc(c[0]+i,c[1],e,0,s.TAU),a.canvasContext.fillStyle=o.sclera,a.canvasContext.fill(),a.canvasContext.closePath(),a.canvasContext.beginPath(),a.canvasContext.fillStyle=o.iris,a.canvasContext.arc(c[0],c[1],t,0,s.TAU*g),a.canvasContext.lineTo(c[0],c[1]),a.canvasContext.fill(),a.canvasContext.closePath(),a.canvasContext.beginPath(),a.canvasContext.fillStyle=o.pupil,a.canvasContext.arc(c[0],c[1],n,0,s.TAU*g),a.canvasContext.fill()}else{const n=t?e.leftEyeLower0:e.rightEyeLower0;a.canvasContext.beginPath(),a.canvasContext.lineStyle=o.iris,a.canvasContext.fillStyle=o.pupil,a.canvasContext.moveTo(n[0][0],n[0][1]),a.canvasContext.lineTo(n[4][0],n[4][1]),a.canvasContext.lineTo(n[6][0],n[6][1]),a.canvasContext.closePath(),a.canvasContext.stroke(),a.canvasContext.fill()}}},{"./canvas":"2h2QK","../maths/maths":"iDBHd","../palette":"bNJmu","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],kijht:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"drawMouth",(()=>l));var a=e("../palette"),s=r.interopDefault(a),o=e("./canvas"),i=e("./2d");const l=(e,t={h:90,s:50,l:50,a:.6},n=!0)=>{const{annotations:r,mouthRange:a,mouthWidth:l,mouthOpen:c}=e,{lipsUpperInner:u,lipsLowerInner:d}=r,h=[u,d],p=`hsla(${t.h},${t.s}%,${t.l}%, ${t.a})`,m=`hsla(${t.h},${t.s}%,10%, ${t.a})`,f=u[5],g=d[5],v=o.canvasContext.createLinearGradient(0,0,l,a);v.addColorStop(0,p),v.addColorStop(.5,m),v.addColorStop(1,p),o.canvasContext.lineWidth=2,o.canvasContext.strokeStyle=m,o.canvasContext.beginPath(),o.canvasContext.moveTo(u[0][0],u[0][1]),o.canvasContext.fillStyle=v;for(let e=0,t=h.length;e<t;e++){const t=h[e];for(let e=0,n=t.length;e<n;e++){const n=t[e][0],r=t[e][1];o.canvasContext.lineTo(n,r)}}return o.canvasContext.closePath(),o.canvasContext.fill(),o.canvasContext.stroke(),n&&(i.drawNode(g,f,5),o.canvasContext.fillStyle=s.default.blue,o.canvasContext.font="12px Oxanium",o.canvasContext.textAlign="center",o.canvasContext.fillText(`${Math.floor(a)}px`,g[0],g[1]-20)),o.canvasContext.stroke(),o.canvasContext.lineWidth=1,{lipUpperMiddle:f,lipLowerMiddle:g}}},{"../palette":"bNJmu","./canvas":"2h2QK","./2d":"2Ac2W","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],h7RGC:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"DEFAULT_TENSORFLOW_OPTIONS",(()=>i)),r.export(n,"DEFAULT_OPTIONS",(()=>l)),r.export(n,"KIDS_OPTIONS",(()=>c)),r.export(n,"BODY_OPTIONS",(()=>u)),r.export(n,"DANCE_OPTIONS",(()=>d)),r.export(n,"NAMES",(()=>h)),r.export(n,"getFactoryDefaults",(()=>p)),r.export(n,"getDomainDefaults",(()=>m)),r.export(n,"DEFAULT_PERSON_OPTIONS",(()=>f));var a=e("./audio/instruments"),s=e("./palette"),o=e("./maths/easing");const i={runtime:"mediapipe",solutionPath:"https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh",maxFaces:1,shouldLoadIrisModel:!0},l={advancedMode:!0,showSettings:!1,metronome:!1,backingTrack:!1,clear:!0,transparent:!0,synch:!0,debug:!1,muted:!1,duet:!1,masks:!0,stereo:!1,eyes:!0,quantise:!0,text:!0,spectrogram:!0,speak:!0,midiChannel:"all",bpm:200,model:"face",instrumentPack:a.INSTRUMENT_PACK_FATBOY,instrumentPacks:[a.INSTRUMENT_PACK_FATBOY,a.INSTRUMENT_PACK_FM,a.INSTRUMENT_PACK_MUSYNGKITE].join(","),photoSensitive:window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches||!1},c={...l,advancedMode:!1,text:!1,masks:!1},u={...l,backingTrack:!0},d={...l,instrumentPack:a.INSTRUMENT_PACK_MUSYNGKITE,instrumentPacks:[a.INSTRUMENT_PACK_MUSYNGKITE].join(",")},h=["a","b","c","d"].map((e=>`person-${e}`)),p=(e=l)=>Object.assign({},e),m=e=>{switch(e.toLowerCase()){case"lol":return p(c);case"band":default:return p();case"dance":return p(d)}},f={...s.DEFAULT_COLOURS,useDelay:!1,delayTime:.14,delayLength:10,stereoPan:!0,sendMIDI:!0,swapControls:!1,photoSensitive:!1,drawMesh:!1,drawNodes:!0,meshOnSing:!1,drawMask:!0,drawMouth:!0,drawEyes:!0,scleraRadius:3,irisRadius:1,pupilRadius:.3,eyeRatio:.8,mouseHoldDuration:.3,eyeShutHolddDuration:3500,feedback:.1,rollSensitivity:1.2,pitchSensitivity:1,mouthCutOff:.2,mouthSilence:.05,volumeRate:.7,instrumentPack:a.INSTRUMENT_PACK_MUSYNGKITE,precision:3,ease:o.easeInSine}},{"./audio/instruments":"ftlvJ","./palette":"bNJmu","./maths/easing":"8aGct","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],xOeWy:[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"trimLocaleCode",(()=>a)),r.export(n,"getBrowserLocales",(()=>s));const a=e=>e.split(/-|_/)[0],s=(e={})=>{const t=Object.assign({},{languageCodeOnly:!1,fallback:"en-GB"},e),n=void 0===navigator.languages?[navigator.language]:navigator.languages;return n?n.map((e=>{const n=e.trim();return t.languageCodeOnly?a(n):n})):t.fallback?[t.fallback]:void 0}},{"@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"6fCzM":[function(e,t,n){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(n),r.export(n,"isSupportingBrowser",(()=>v)),r.export(n,"installOrUpdate",(()=>N));var a=e("../version"),s=e("url:../manifest.webmanifest");r.interopDefault(s);let o;const i=["standalone","fullscreen","minimal-ui"],l="standalone"in navigator&&!0===window.navigator.standalone,c=i.filter((e=>window.matchMedia(`(display-mode:${e})`).matches)),u=i.includes(c),d=document.referrer.includes("android-app://"),h=Array.isArray(navigator.userAgent.match(/MSAppHost/i)),p=l||u||d||h||!1,m=null===navigator.serviceWorker.controller,f=navigator.onLine,g={android:d,microsoft:h,pwa:p,offline:!f,displayMode:c},v=window.hasOwnProperty("BeforeInstallPromptEvent");let y;let b=!1,E=!1,w=!1,I=!1;const x=a.VERSION;let S;const N=async(t=!1)=>{let n=[],r={};if(!v)throw Error("Browser does not support PWA installation");p?n.push(`PWA ${a.VERSION} Installed, checking for updates`,{deferredPrompt:o,isFirstRun:m,isInWebAppiOS:l,isInWebAppChrome:u}):m?n.push(`PWA ${a.VERSION} AVAILABLE WWW / PWA`,{deferredPrompt:o,isFirstRun:m,first:navigator.serviceWorker.controller}):n.push(`WWW ${a.VERSION}`,{deferredPrompt:o,isFirstRun:m,first:navigator.serviceWorker.controller});const s=await navigator.serviceWorker.getRegistration();if(console.log("Checking for installed service worker",s),s&&s.installing&&navigator.storage){const e=await navigator.storage.estimate();console.log("Checking for installed storage space",e)}if(s){const e=s.active,t=new URL(e.scriptURL);S=t.search.split("=")[1]||"-.-.-",w=S!==a.VERSION;const r=e.state;n.push("PREVIOUS SW URL",`${t}`),n.push("SW Reg v",`${S} -> ${x}`,{updatesAvailable:w,previousVersion:S,registration:s,activatedState:r,activeWorker:e,previousServiceWorkerURL:t}),n.push(`SW State ${r}`),s.addEventListener("updatefound",(async()=>{const r=s.installing;n.push("Update found",{registration:s,installWorker:r,activeWorker:e,previousServiceWorkerURL:t}),E=!0,r.waiting&&navigator.serviceWorker.controller&&n.push("sanity check",{installWorker:r,nav:navigator.serviceWorker.controller}),r.addEventListener("statechange",(()=>{"installed"===r.state?(E=!1,I=!0,n.push("update installed expected truth",navigator.serviceWorker.controller,{registration:s,installWorker:r})):n.push("update",r.state,{registration:s,installWorker:r})}))}),{once:!0})}else n.push("PWA NO service worker registered");const i=`../service-worker.js#v=${a.VERSION}`;let c=await navigator.serviceWorker.register(i);if(n.push("Service worker with #",i,c),!c){const e=`../service-worker.js?v=${a.VERSION}`;c=await navigator.serviceWorker.register(e),n.push("Service worker with ?",e,c)}if(c||(c=await navigator.serviceWorker.register(e("859dbabfced9cec8")),n.push("Service worker falling back to default :*(",c)),m?n.push("PWA FRESH service worker registering",{serviceWorker:c}):n.push("PWA registering service worker",{serviceWorker:c}),p||o||(o=await _(),b=!0,n.push("Waiting prompts",o)),r={log:n,online:f,offline:!f,previousVersion:S,currentVersion:x,isInstallable:b,isFirstRun:m,isRunningAsApp:p,install:e=>{return t=e,n=o,new Promise((async(e,r)=>{if(!n)return r();window.addEventListener("appinstalled",(t=>{e({success:!0,log:"Your PWA has been installed"})}),{once:!0}),n.prompt(),t.disabled=!0,"accepted"===(await n.userChoice).outcome?(new URLSearchParams(window.location.search).installing=!0,y=!0,t.hidden=!0):(y=!1,e({success:!1,log:"User chose to not install"})),t.disabled=!1}));var t,n},prompt:o,updatesAvailable:w,updating:E,updated:I,update:()=>{s.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload()},...g},w){const t=await(async()=>{const{injectChangeLog:t,fetchChangesAsText:n}=await e("3ff03aacb10143d6");return await n("changelog")})();r.changes=t}return r},_=()=>new Promise(((e,t)=>v?o?e(o):void window.addEventListener("beforeinstallprompt",(t=>{t.preventDefault(),e(t)}),{once:!0}):t("Unsupported Browser")));p||_().then((e=>o=e))},{"../version":"98oCg","url:../manifest.webmanifest":"3Gevj","3ff03aacb10143d6":"6ja6U","859dbabfced9cec8":"lTsCa","@parcel/transformer-js/src/esmodule-helpers.js":"14tkN"}],"3Gevj":[function(e,t,n){t.exports=e("./helpers/bundle-url").getBundleURL("kPWjp")+e("./helpers/bundle-manifest").resolve("9Dn3o")},{"./helpers/bundle-url":"bGZ1f","./helpers/bundle-manifest":"6jNRu"}],"6ja6U":[function(e,t,n){t.exports=e("./helpers/browser/js-loader")(e("./helpers/bundle-url").getBundleURL("kPWjp")+e("./helpers/bundle-manifest").resolve("ecLhi")).then((()=>t.bundle.root("fkDEI")))},{"./helpers/browser/js-loader":"7mk4K","./helpers/bundle-url":"bGZ1f","./helpers/bundle-manifest":"6jNRu"}],"7mk4K":[function(e,t,n){"use strict";var r=e("../cacheLoader");t.exports=r((function(e){return new Promise((function(t,n){var r=document.getElementsByTagName("script");if([].concat(r).some((function(t){return t.src===e})))t();else{var a=document.createElement("link");a.href=e,a.rel="preload",a.as="script",document.head.appendChild(a);var s=document.createElement("script");s.async=!0,s.type="text/javascript",s.charset="utf-8",s.src=e,s.onerror=function(t){var r=new TypeError("Failed to fetch dynamically imported module: ".concat(e,". Error: ").concat(t.message));s.onerror=s.onload=null,s.remove(),n(r)},s.onload=function(){s.onerror=s.onload=null,t()},document.getElementsByTagName("head")[0].appendChild(s)}}))}))},{"../cacheLoader":"beMRV"}],beMRV:[function(e,t,n){"use strict";var r={},a={},s={};function o(e){switch(e){case"preload":return a;case"prefetch":return s;default:return r}}t.exports=function(e,t){return function(n){var r=o(t);return r[n]?r[n]:r[n]=e.apply(null,arguments).catch((function(e){throw delete r[n],e}))}}},{}],lTsCa:[function(e,t,n){t.exports=e("./helpers/bundle-url").getBundleURL("kPWjp")+e("./helpers/bundle-manifest").resolve("6ZiDd")},{"./helpers/bundle-url":"bGZ1f","./helpers/bundle-manifest":"6jNRu"}],bGgTT:[function(e,t,n){t.exports=Promise.all([e("./helpers/browser/js-loader")(e("./helpers/bundle-url").getBundleURL("kPWjp")+e("./helpers/bundle-manifest").resolve("5AKhY")),e("./helpers/browser/js-loader")(e("./helpers/bundle-url").getBundleURL("kPWjp")+e("./helpers/bundle-manifest").resolve("257vJ"))]).then((()=>t.bundle.root("4Cz1G")))},{"./helpers/browser/js-loader":"7mk4K","./helpers/bundle-url":"bGZ1f","./helpers/bundle-manifest":"6jNRu"}],M23qu:[function(e,t,n){t.exports=Promise.all([e("./helpers/browser/js-loader")(e("./helpers/bundle-url").getBundleURL("kPWjp")+e("./helpers/bundle-manifest").resolve("5AKhY")),e("./helpers/browser/js-loader")(e("./helpers/bundle-url").getBundleURL("kPWjp")+e("./helpers/bundle-manifest").resolve("d5l0U"))]).then((()=>t.bundle.root("gi7kh")))},{"./helpers/browser/js-loader":"7mk4K","./helpers/bundle-url":"bGZ1f","./helpers/bundle-manifest":"6jNRu"}],"7LLzG":[function(e,t,n){t.exports=e("./helpers/browser/js-loader")(e("./helpers/bundle-url").getBundleURL("kPWjp")+e("./helpers/bundle-manifest").resolve("blv9t")).then((()=>t.bundle.root("kuYJW")))},{"./helpers/browser/js-loader":"7mk4K","./helpers/bundle-url":"bGZ1f","./helpers/bundle-manifest":"6jNRu"}]},["4dg9m","gPDLX"],"gPDLX");